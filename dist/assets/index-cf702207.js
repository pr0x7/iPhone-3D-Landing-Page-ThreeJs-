(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const it of document.querySelectorAll('link[rel="modulepreload"]'))d(it);new MutationObserver(it=>{for(const ct of it)if(ct.type==="childList")for(const pt of ct.addedNodes)pt.tagName==="LINK"&&pt.rel==="modulepreload"&&d(pt)}).observe(document,{childList:!0,subtree:!0});function _e(it){const ct={};return it.integrity&&(ct.integrity=it.integrity),it.referrerPolicy&&(ct.referrerPolicy=it.referrerPolicy),it.crossOrigin==="use-credentials"?ct.credentials="include":it.crossOrigin==="anonymous"?ct.credentials="omit":ct.credentials="same-origin",ct}function d(it){if(it.ep)return;it.ep=!0;const ct=_e(it);fetch(it.href,ct)}})();var jsxRuntimeExports={},jsxRuntime={get exports(){return jsxRuntimeExports},set exports(j){jsxRuntimeExports=j}},reactJsxRuntime_production_min={},reactExports={},react={get exports(){return reactExports},set exports(j){reactExports=j}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(j){return j===null||typeof j!="object"?null:(j=z$1&&j[z$1]||j["@@iterator"],typeof j=="function"?j:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(j,_,_e){this.props=j,this.context=_,this.refs=D$1,this.updater=_e||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(j,_){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,_,"setState")};E$1.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(j,_,_e){this.props=j,this.context=_,this.refs=D$1,this.updater=_e||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(j,_,_e){var d,it={},ct=null,pt=null;if(_!=null)for(d in _.ref!==void 0&&(pt=_.ref),_.key!==void 0&&(ct=""+_.key),_)J.call(_,d)&&!L$1.hasOwnProperty(d)&&(it[d]=_[d]);var At=arguments.length-2;if(At===1)it.children=_e;else if(1<At){for(var St=Array(At),Ot=0;Ot<At;Ot++)St[Ot]=arguments[Ot+2];it.children=St}if(j&&j.defaultProps)for(d in At=j.defaultProps,At)it[d]===void 0&&(it[d]=At[d]);return{$$typeof:l$1,type:j,key:ct,ref:pt,props:it,_owner:K$1.current}}function N$1(j,_){return{$$typeof:l$1,type:j.type,key:_,ref:j.ref,props:j.props,_owner:j._owner}}function O$1(j){return typeof j=="object"&&j!==null&&j.$$typeof===l$1}function escape$1(j){var _={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(_e){return _[_e]})}var P$1=/\/+/g;function Q$1(j,_){return typeof j=="object"&&j!==null&&j.key!=null?escape$1(""+j.key):_.toString(36)}function R$1(j,_,_e,d,it){var ct=typeof j;(ct==="undefined"||ct==="boolean")&&(j=null);var pt=!1;if(j===null)pt=!0;else switch(ct){case"string":case"number":pt=!0;break;case"object":switch(j.$$typeof){case l$1:case n$1:pt=!0}}if(pt)return pt=j,it=it(pt),j=d===""?"."+Q$1(pt,0):d,I$1(it)?(_e="",j!=null&&(_e=j.replace(P$1,"$&/")+"/"),R$1(it,_,_e,"",function(Ot){return Ot})):it!=null&&(O$1(it)&&(it=N$1(it,_e+(!it.key||pt&&pt.key===it.key?"":(""+it.key).replace(P$1,"$&/")+"/")+j)),_.push(it)),1;if(pt=0,d=d===""?".":d+":",I$1(j))for(var At=0;At<j.length;At++){ct=j[At];var St=d+Q$1(ct,At);pt+=R$1(ct,_,_e,St,it)}else if(St=A$1(j),typeof St=="function")for(j=St.call(j),At=0;!(ct=j.next()).done;)ct=ct.value,St=d+Q$1(ct,At++),pt+=R$1(ct,_,_e,St,it);else if(ct==="object")throw _=String(j),Error("Objects are not valid as a React child (found: "+(_==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":_)+"). If you meant to render a collection of children, use an array instead.");return pt}function S$1(j,_,_e){if(j==null)return j;var d=[],it=0;return R$1(j,d,"","",function(ct){return _.call(_e,ct,it++)}),d}function T$1(j){if(j._status===-1){var _=j._result;_=_(),_.then(function(_e){(j._status===0||j._status===-1)&&(j._status=1,j._result=_e)},function(_e){(j._status===0||j._status===-1)&&(j._status=2,j._result=_e)}),j._status===-1&&(j._status=0,j._result=_)}if(j._status===1)return j._result.default;throw j._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function(j,_,_e){S$1(j,function(){_.apply(this,arguments)},_e)},count:function(j){var _=0;return S$1(j,function(){_++}),_},toArray:function(j){return S$1(j,function(_){return _})||[]},only:function(j){if(!O$1(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function(j,_,_e){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var d=C$1({},j.props),it=j.key,ct=j.ref,pt=j._owner;if(_!=null){if(_.ref!==void 0&&(ct=_.ref,pt=K$1.current),_.key!==void 0&&(it=""+_.key),j.type&&j.type.defaultProps)var At=j.type.defaultProps;for(St in _)J.call(_,St)&&!L$1.hasOwnProperty(St)&&(d[St]=_[St]===void 0&&At!==void 0?At[St]:_[St])}var St=arguments.length-2;if(St===1)d.children=_e;else if(1<St){At=Array(St);for(var Ot=0;Ot<St;Ot++)At[Ot]=arguments[Ot+2];d.children=At}return{$$typeof:l$1,type:j.type,key:it,ref:ct,props:d,_owner:pt}};react_production_min.createContext=function(j){return j={$$typeof:u,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:t,_context:j},j.Consumer=j};react_production_min.createElement=M$1;react_production_min.createFactory=function(j){var _=M$1.bind(null,j);return _.type=j,_};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(j){return{$$typeof:v$1,render:j}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(j){return{$$typeof:y,_payload:{_status:-1,_result:j},_init:T$1}};react_production_min.memo=function(j,_){return{$$typeof:x,type:j,compare:_===void 0?null:_}};react_production_min.startTransition=function(j){var _=V$1.transition;V$1.transition={};try{j()}finally{V$1.transition=_}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(j,_){return U$1.current.useCallback(j,_)};react_production_min.useContext=function(j){return U$1.current.useContext(j)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(j){return U$1.current.useDeferredValue(j)};react_production_min.useEffect=function(j,_){return U$1.current.useEffect(j,_)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(j,_,_e){return U$1.current.useImperativeHandle(j,_,_e)};react_production_min.useInsertionEffect=function(j,_){return U$1.current.useInsertionEffect(j,_)};react_production_min.useLayoutEffect=function(j,_){return U$1.current.useLayoutEffect(j,_)};react_production_min.useMemo=function(j,_){return U$1.current.useMemo(j,_)};react_production_min.useReducer=function(j,_,_e){return U$1.current.useReducer(j,_,_e)};react_production_min.useRef=function(j){return U$1.current.useRef(j)};react_production_min.useState=function(j){return U$1.current.useState(j)};react_production_min.useSyncExternalStore=function(j,_,_e){return U$1.current.useSyncExternalStore(j,_,_e)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";(function(j){j.exports=react_production_min})(react);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(j,_,_e){var d,it={},ct=null,pt=null;_e!==void 0&&(ct=""+_e),_.key!==void 0&&(ct=""+_.key),_.ref!==void 0&&(pt=_.ref);for(d in _)m$1.call(_,d)&&!p$1.hasOwnProperty(d)&&(it[d]=_[d]);if(j&&j.defaultProps)for(d in _=j.defaultProps,_)it[d]===void 0&&(it[d]=_[d]);return{$$typeof:k,type:j,key:ct,ref:pt,props:it,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;(function(j){j.exports=reactJsxRuntime_production_min})(jsxRuntime);const jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;var client={},reactDomExports={},reactDom={get exports(){return reactDomExports},set exports(j){reactDomExports=j}},reactDom_production_min={},schedulerExports={},scheduler={get exports(){return schedulerExports},set exports(j){schedulerExports=j}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(j){function _(Vn,Kn){var un=Vn.length;Vn.push(Kn);e:for(;0<un;){var er=un-1>>>1,$n=Vn[er];if(0<it($n,Kn))Vn[er]=Kn,Vn[un]=$n,un=er;else break e}}function _e(Vn){return Vn.length===0?null:Vn[0]}function d(Vn){if(Vn.length===0)return null;var Kn=Vn[0],un=Vn.pop();if(un!==Kn){Vn[0]=un;e:for(var er=0,$n=Vn.length,xr=$n>>>1;er<xr;){var Wn=2*(er+1)-1,on=Vn[Wn],pn=Wn+1,On=Vn[pn];if(0>it(on,un))pn<$n&&0>it(On,on)?(Vn[er]=On,Vn[pn]=un,er=pn):(Vn[er]=on,Vn[Wn]=un,er=Wn);else if(pn<$n&&0>it(On,un))Vn[er]=On,Vn[pn]=un,er=pn;else break e}}return Kn}function it(Vn,Kn){var un=Vn.sortIndex-Kn.sortIndex;return un!==0?un:Vn.id-Kn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var ct=performance;j.unstable_now=function(){return ct.now()}}else{var pt=Date,At=pt.now();j.unstable_now=function(){return pt.now()-At}}var St=[],Ot=[],Qt=1,Yt=null,Vt=3,qt=!1,Jt=!1,jt=!1,sn=typeof setTimeout=="function"?setTimeout:null,Ft=typeof clearTimeout=="function"?clearTimeout:null,Ut=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ht(Vn){for(var Kn=_e(Ot);Kn!==null;){if(Kn.callback===null)d(Ot);else if(Kn.startTime<=Vn)d(Ot),Kn.sortIndex=Kn.expirationTime,_(St,Kn);else break;Kn=_e(Ot)}}function an(Vn){if(jt=!1,Ht(Vn),!Jt)if(_e(St)!==null)Jt=!0,Zn(nn);else{var Kn=_e(Ot);Kn!==null&&wr(an,Kn.startTime-Vn)}}function nn(Vn,Kn){Jt=!1,jt&&(jt=!1,Ft(Wt),Wt=-1),qt=!0;var un=Vt;try{for(Ht(Kn),Yt=_e(St);Yt!==null&&(!(Yt.expirationTime>Kn)||Vn&&!hn());){var er=Yt.callback;if(typeof er=="function"){Yt.callback=null,Vt=Yt.priorityLevel;var $n=er(Yt.expirationTime<=Kn);Kn=j.unstable_now(),typeof $n=="function"?Yt.callback=$n:Yt===_e(St)&&d(St),Ht(Kn)}else d(St);Yt=_e(St)}if(Yt!==null)var xr=!0;else{var Wn=_e(Ot);Wn!==null&&wr(an,Wn.startTime-Kn),xr=!1}return xr}finally{Yt=null,Vt=un,qt=!1}}var dn=!1,zt=null,Wt=-1,Zt=5,mn=-1;function hn(){return!(j.unstable_now()-mn<Zt)}function zn(){if(zt!==null){var Vn=j.unstable_now();mn=Vn;var Kn=!0;try{Kn=zt(!0,Vn)}finally{Kn?lr():(dn=!1,zt=null)}}else dn=!1}var lr;if(typeof Ut=="function")lr=function(){Ut(zn)};else if(typeof MessageChannel<"u"){var ar=new MessageChannel,ur=ar.port2;ar.port1.onmessage=zn,lr=function(){ur.postMessage(null)}}else lr=function(){sn(zn,0)};function Zn(Vn){zt=Vn,dn||(dn=!0,lr())}function wr(Vn,Kn){Wt=sn(function(){Vn(j.unstable_now())},Kn)}j.unstable_IdlePriority=5,j.unstable_ImmediatePriority=1,j.unstable_LowPriority=4,j.unstable_NormalPriority=3,j.unstable_Profiling=null,j.unstable_UserBlockingPriority=2,j.unstable_cancelCallback=function(Vn){Vn.callback=null},j.unstable_continueExecution=function(){Jt||qt||(Jt=!0,Zn(nn))},j.unstable_forceFrameRate=function(Vn){0>Vn||125<Vn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<Vn?Math.floor(1e3/Vn):5},j.unstable_getCurrentPriorityLevel=function(){return Vt},j.unstable_getFirstCallbackNode=function(){return _e(St)},j.unstable_next=function(Vn){switch(Vt){case 1:case 2:case 3:var Kn=3;break;default:Kn=Vt}var un=Vt;Vt=Kn;try{return Vn()}finally{Vt=un}},j.unstable_pauseExecution=function(){},j.unstable_requestPaint=function(){},j.unstable_runWithPriority=function(Vn,Kn){switch(Vn){case 1:case 2:case 3:case 4:case 5:break;default:Vn=3}var un=Vt;Vt=Vn;try{return Kn()}finally{Vt=un}},j.unstable_scheduleCallback=function(Vn,Kn,un){var er=j.unstable_now();switch(typeof un=="object"&&un!==null?(un=un.delay,un=typeof un=="number"&&0<un?er+un:er):un=er,Vn){case 1:var $n=-1;break;case 2:$n=250;break;case 5:$n=1073741823;break;case 4:$n=1e4;break;default:$n=5e3}return $n=un+$n,Vn={id:Qt++,callback:Kn,priorityLevel:Vn,startTime:un,expirationTime:$n,sortIndex:-1},un>er?(Vn.sortIndex=un,_(Ot,Vn),_e(St)===null&&Vn===_e(Ot)&&(jt?(Ft(Wt),Wt=-1):jt=!0,wr(an,un-er))):(Vn.sortIndex=$n,_(St,Vn),Jt||qt||(Jt=!0,Zn(nn))),Vn},j.unstable_shouldYield=hn,j.unstable_wrapCallback=function(Vn){var Kn=Vt;return function(){var un=Vt;Vt=Kn;try{return Vn.apply(this,arguments)}finally{Vt=un}}}})(scheduler_production_min);(function(j){j.exports=scheduler_production_min})(scheduler);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(j){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+j,_e=1;_e<arguments.length;_e++)_+="&args[]="+encodeURIComponent(arguments[_e]);return"Minified React error #"+j+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(j,_){ha(j,_),ha(j+"Capture",_)}function ha(j,_){for(ea[j]=_,j=0;j<_.length;j++)da.add(_[j])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(j){return ja.call(ma,j)?!0:ja.call(la,j)?!1:ka.test(j)?ma[j]=!0:(la[j]=!0,!1)}function pa(j,_,_e,d){if(_e!==null&&_e.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return d?!1:_e!==null?!_e.acceptsBooleans:(j=j.toLowerCase().slice(0,5),j!=="data-"&&j!=="aria-");default:return!1}}function qa(j,_,_e,d){if(_===null||typeof _>"u"||pa(j,_,_e,d))return!0;if(d)return!1;if(_e!==null)switch(_e.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function v(j,_,_e,d,it,ct,pt){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=d,this.attributeNamespace=it,this.mustUseProperty=_e,this.propertyName=j,this.type=_,this.sanitizeURL=ct,this.removeEmptyString=pt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(j){z[j]=new v(j,0,!1,j,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(j){var _=j[0];z[_]=new v(_,1,!1,j[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(j){z[j]=new v(j,2,!1,j.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(j){z[j]=new v(j,2,!1,j,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(j){z[j]=new v(j,3,!1,j.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(j){z[j]=new v(j,3,!0,j,null,!1,!1)});["capture","download"].forEach(function(j){z[j]=new v(j,4,!1,j,null,!1,!1)});["cols","rows","size","span"].forEach(function(j){z[j]=new v(j,6,!1,j,null,!1,!1)});["rowSpan","start"].forEach(function(j){z[j]=new v(j,5,!1,j.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(j){return j[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(j){var _=j.replace(ra,sa);z[_]=new v(_,1,!1,j,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(j){var _=j.replace(ra,sa);z[_]=new v(_,1,!1,j,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(j){var _=j.replace(ra,sa);z[_]=new v(_,1,!1,j,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(j){z[j]=new v(j,1,!1,j.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(j){z[j]=new v(j,1,!1,j.toLowerCase(),null,!0,!0)});function ta(j,_,_e,d){var it=z.hasOwnProperty(_)?z[_]:null;(it!==null?it.type!==0:d||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(qa(_,_e,it,d)&&(_e=null),d||it===null?oa(_)&&(_e===null?j.removeAttribute(_):j.setAttribute(_,""+_e)):it.mustUseProperty?j[it.propertyName]=_e===null?it.type===3?!1:"":_e:(_=it.attributeName,d=it.attributeNamespace,_e===null?j.removeAttribute(_):(it=it.type,_e=it===3||it===4&&_e===!0?"":""+_e,d?j.setAttributeNS(d,_,_e):j.setAttribute(_,_e))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(j){return j===null||typeof j!="object"?null:(j=Ja&&j[Ja]||j["@@iterator"],typeof j=="function"?j:null)}var A=Object.assign,La;function Ma(j){if(La===void 0)try{throw Error()}catch(_e){var _=_e.stack.trim().match(/\n( *(at )?)/);La=_&&_[1]||""}return`
`+La+j}var Na=!1;function Oa(j,_){if(!j||Na)return"";Na=!0;var _e=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(Ot){var d=Ot}Reflect.construct(j,[],_)}else{try{_.call()}catch(Ot){d=Ot}j.call(_.prototype)}else{try{throw Error()}catch(Ot){d=Ot}j()}}catch(Ot){if(Ot&&d&&typeof Ot.stack=="string"){for(var it=Ot.stack.split(`
`),ct=d.stack.split(`
`),pt=it.length-1,At=ct.length-1;1<=pt&&0<=At&&it[pt]!==ct[At];)At--;for(;1<=pt&&0<=At;pt--,At--)if(it[pt]!==ct[At]){if(pt!==1||At!==1)do if(pt--,At--,0>At||it[pt]!==ct[At]){var St=`
`+it[pt].replace(" at new "," at ");return j.displayName&&St.includes("<anonymous>")&&(St=St.replace("<anonymous>",j.displayName)),St}while(1<=pt&&0<=At);break}}}finally{Na=!1,Error.prepareStackTrace=_e}return(j=j?j.displayName||j.name:"")?Ma(j):""}function Pa(j){switch(j.tag){case 5:return Ma(j.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return j=Oa(j.type,!1),j;case 11:return j=Oa(j.type.render,!1),j;case 1:return j=Oa(j.type,!0),j;default:return""}}function Qa(j){if(j==null)return null;if(typeof j=="function")return j.displayName||j.name||null;if(typeof j=="string")return j;switch(j){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof j=="object")switch(j.$$typeof){case Ca:return(j.displayName||"Context")+".Consumer";case Ba:return(j._context.displayName||"Context")+".Provider";case Da:var _=j.render;return j=j.displayName,j||(j=_.displayName||_.name||"",j=j!==""?"ForwardRef("+j+")":"ForwardRef"),j;case Ga:return _=j.displayName||null,_!==null?_:Qa(j.type)||"Memo";case Ha:_=j._payload,j=j._init;try{return Qa(j(_))}catch{}}return null}function Ra(j){var _=j.type;switch(j.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return j=_.render,j=j.displayName||j.name||"",_.displayName||(j!==""?"ForwardRef("+j+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(_);case 8:return _===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function Sa(j){switch(typeof j){case"boolean":case"number":case"string":case"undefined":return j;case"object":return j;default:return""}}function Ta(j){var _=j.type;return(j=j.nodeName)&&j.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Ua(j){var _=Ta(j)?"checked":"value",_e=Object.getOwnPropertyDescriptor(j.constructor.prototype,_),d=""+j[_];if(!j.hasOwnProperty(_)&&typeof _e<"u"&&typeof _e.get=="function"&&typeof _e.set=="function"){var it=_e.get,ct=_e.set;return Object.defineProperty(j,_,{configurable:!0,get:function(){return it.call(this)},set:function(pt){d=""+pt,ct.call(this,pt)}}),Object.defineProperty(j,_,{enumerable:_e.enumerable}),{getValue:function(){return d},setValue:function(pt){d=""+pt},stopTracking:function(){j._valueTracker=null,delete j[_]}}}}function Va(j){j._valueTracker||(j._valueTracker=Ua(j))}function Wa(j){if(!j)return!1;var _=j._valueTracker;if(!_)return!0;var _e=_.getValue(),d="";return j&&(d=Ta(j)?j.checked?"true":"false":j.value),j=d,j!==_e?(_.setValue(j),!0):!1}function Xa(j){if(j=j||(typeof document<"u"?document:void 0),typeof j>"u")return null;try{return j.activeElement||j.body}catch{return j.body}}function Ya(j,_){var _e=_.checked;return A({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_e??j._wrapperState.initialChecked})}function Za(j,_){var _e=_.defaultValue==null?"":_.defaultValue,d=_.checked!=null?_.checked:_.defaultChecked;_e=Sa(_.value!=null?_.value:_e),j._wrapperState={initialChecked:d,initialValue:_e,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function ab(j,_){_=_.checked,_!=null&&ta(j,"checked",_,!1)}function bb(j,_){ab(j,_);var _e=Sa(_.value),d=_.type;if(_e!=null)d==="number"?(_e===0&&j.value===""||j.value!=_e)&&(j.value=""+_e):j.value!==""+_e&&(j.value=""+_e);else if(d==="submit"||d==="reset"){j.removeAttribute("value");return}_.hasOwnProperty("value")?cb(j,_.type,_e):_.hasOwnProperty("defaultValue")&&cb(j,_.type,Sa(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(j.defaultChecked=!!_.defaultChecked)}function db(j,_,_e){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var d=_.type;if(!(d!=="submit"&&d!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+j._wrapperState.initialValue,_e||_===j.value||(j.value=_),j.defaultValue=_}_e=j.name,_e!==""&&(j.name=""),j.defaultChecked=!!j._wrapperState.initialChecked,_e!==""&&(j.name=_e)}function cb(j,_,_e){(_!=="number"||Xa(j.ownerDocument)!==j)&&(_e==null?j.defaultValue=""+j._wrapperState.initialValue:j.defaultValue!==""+_e&&(j.defaultValue=""+_e))}var eb=Array.isArray;function fb(j,_,_e,d){if(j=j.options,_){_={};for(var it=0;it<_e.length;it++)_["$"+_e[it]]=!0;for(_e=0;_e<j.length;_e++)it=_.hasOwnProperty("$"+j[_e].value),j[_e].selected!==it&&(j[_e].selected=it),it&&d&&(j[_e].defaultSelected=!0)}else{for(_e=""+Sa(_e),_=null,it=0;it<j.length;it++){if(j[it].value===_e){j[it].selected=!0,d&&(j[it].defaultSelected=!0);return}_!==null||j[it].disabled||(_=j[it])}_!==null&&(_.selected=!0)}}function gb(j,_){if(_.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},_,{value:void 0,defaultValue:void 0,children:""+j._wrapperState.initialValue})}function hb(j,_){var _e=_.value;if(_e==null){if(_e=_.children,_=_.defaultValue,_e!=null){if(_!=null)throw Error(p(92));if(eb(_e)){if(1<_e.length)throw Error(p(93));_e=_e[0]}_=_e}_==null&&(_=""),_e=_}j._wrapperState={initialValue:Sa(_e)}}function ib(j,_){var _e=Sa(_.value),d=Sa(_.defaultValue);_e!=null&&(_e=""+_e,_e!==j.value&&(j.value=_e),_.defaultValue==null&&j.defaultValue!==_e&&(j.defaultValue=_e)),d!=null&&(j.defaultValue=""+d)}function jb(j){var _=j.textContent;_===j._wrapperState.initialValue&&_!==""&&_!==null&&(j.value=_)}function kb(j){switch(j){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(j,_){return j==null||j==="http://www.w3.org/1999/xhtml"?kb(_):j==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":j}var mb,nb=function(j){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,_e,d,it){MSApp.execUnsafeLocalFunction(function(){return j(_,_e,d,it)})}:j}(function(j,_){if(j.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in j)j.innerHTML=_;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=mb.firstChild;j.firstChild;)j.removeChild(j.firstChild);for(;_.firstChild;)j.appendChild(_.firstChild)}});function ob(j,_){if(_){var _e=j.firstChild;if(_e&&_e===j.lastChild&&_e.nodeType===3){_e.nodeValue=_;return}}j.textContent=_}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(j){qb.forEach(function(_){_=_+j.charAt(0).toUpperCase()+j.substring(1),pb[_]=pb[j]})});function rb(j,_,_e){return _==null||typeof _=="boolean"||_===""?"":_e||typeof _!="number"||_===0||pb.hasOwnProperty(j)&&pb[j]?(""+_).trim():_+"px"}function sb(j,_){j=j.style;for(var _e in _)if(_.hasOwnProperty(_e)){var d=_e.indexOf("--")===0,it=rb(_e,_[_e],d);_e==="float"&&(_e="cssFloat"),d?j.setProperty(_e,it):j[_e]=it}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(j,_){if(_){if(tb[j]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(p(137,j));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(p(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(p(61))}if(_.style!=null&&typeof _.style!="object")throw Error(p(62))}}function vb(j,_){if(j.indexOf("-")===-1)return typeof _.is=="string";switch(j){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(j){return j=j.target||j.srcElement||window,j.correspondingUseElement&&(j=j.correspondingUseElement),j.nodeType===3?j.parentNode:j}var yb=null,zb=null,Ab=null;function Bb(j){if(j=Cb(j)){if(typeof yb!="function")throw Error(p(280));var _=j.stateNode;_&&(_=Db(_),yb(j.stateNode,j.type,_))}}function Eb(j){zb?Ab?Ab.push(j):Ab=[j]:zb=j}function Fb(){if(zb){var j=zb,_=Ab;if(Ab=zb=null,Bb(j),_)for(j=0;j<_.length;j++)Bb(_[j])}}function Gb(j,_){return j(_)}function Hb(){}var Ib=!1;function Jb(j,_,_e){if(Ib)return j(_,_e);Ib=!0;try{return Gb(j,_,_e)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(j,_){var _e=j.stateNode;if(_e===null)return null;var d=Db(_e);if(d===null)return null;_e=d[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(j=j.type,d=!(j==="button"||j==="input"||j==="select"||j==="textarea")),j=!d;break e;default:j=!1}if(j)return null;if(_e&&typeof _e!="function")throw Error(p(231,_,typeof _e));return _e}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(j,_,_e,d,it,ct,pt,At,St){var Ot=Array.prototype.slice.call(arguments,3);try{_.apply(_e,Ot)}catch(Qt){this.onError(Qt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(j){Ob=!0,Pb=j}};function Tb(j,_,_e,d,it,ct,pt,At,St){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(j,_,_e,d,it,ct,pt,At,St){if(Tb.apply(this,arguments),Ob){if(Ob){var Ot=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=Ot)}}function Vb(j){var _=j,_e=j;if(j.alternate)for(;_.return;)_=_.return;else{j=_;do _=j,_.flags&4098&&(_e=_.return),j=_.return;while(j)}return _.tag===3?_e:null}function Wb(j){if(j.tag===13){var _=j.memoizedState;if(_===null&&(j=j.alternate,j!==null&&(_=j.memoizedState)),_!==null)return _.dehydrated}return null}function Xb(j){if(Vb(j)!==j)throw Error(p(188))}function Yb(j){var _=j.alternate;if(!_){if(_=Vb(j),_===null)throw Error(p(188));return _!==j?null:j}for(var _e=j,d=_;;){var it=_e.return;if(it===null)break;var ct=it.alternate;if(ct===null){if(d=it.return,d!==null){_e=d;continue}break}if(it.child===ct.child){for(ct=it.child;ct;){if(ct===_e)return Xb(it),j;if(ct===d)return Xb(it),_;ct=ct.sibling}throw Error(p(188))}if(_e.return!==d.return)_e=it,d=ct;else{for(var pt=!1,At=it.child;At;){if(At===_e){pt=!0,_e=it,d=ct;break}if(At===d){pt=!0,d=it,_e=ct;break}At=At.sibling}if(!pt){for(At=ct.child;At;){if(At===_e){pt=!0,_e=ct,d=it;break}if(At===d){pt=!0,d=ct,_e=it;break}At=At.sibling}if(!pt)throw Error(p(189))}}if(_e.alternate!==d)throw Error(p(190))}if(_e.tag!==3)throw Error(p(188));return _e.stateNode.current===_e?j:_}function Zb(j){return j=Yb(j),j!==null?$b(j):null}function $b(j){if(j.tag===5||j.tag===6)return j;for(j=j.child;j!==null;){var _=$b(j);if(_!==null)return _;j=j.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(j){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,j,void 0,(j.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(j){return j>>>=0,j===0?32:31-(pc(j)/qc|0)|0}var rc=64,sc=4194304;function tc(j){switch(j&-j){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return j&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return j&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return j}}function uc(j,_){var _e=j.pendingLanes;if(_e===0)return 0;var d=0,it=j.suspendedLanes,ct=j.pingedLanes,pt=_e&268435455;if(pt!==0){var At=pt&~it;At!==0?d=tc(At):(ct&=pt,ct!==0&&(d=tc(ct)))}else pt=_e&~it,pt!==0?d=tc(pt):ct!==0&&(d=tc(ct));if(d===0)return 0;if(_!==0&&_!==d&&!(_&it)&&(it=d&-d,ct=_&-_,it>=ct||it===16&&(ct&4194240)!==0))return _;if(d&4&&(d|=_e&16),_=j.entangledLanes,_!==0)for(j=j.entanglements,_&=d;0<_;)_e=31-oc(_),it=1<<_e,d|=j[_e],_&=~it;return d}function vc(j,_){switch(j){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(j,_){for(var _e=j.suspendedLanes,d=j.pingedLanes,it=j.expirationTimes,ct=j.pendingLanes;0<ct;){var pt=31-oc(ct),At=1<<pt,St=it[pt];St===-1?(!(At&_e)||At&d)&&(it[pt]=vc(At,_)):St<=_&&(j.expiredLanes|=At),ct&=~At}}function xc(j){return j=j.pendingLanes&-1073741825,j!==0?j:j&1073741824?1073741824:0}function yc(){var j=rc;return rc<<=1,!(rc&4194240)&&(rc=64),j}function zc(j){for(var _=[],_e=0;31>_e;_e++)_.push(j);return _}function Ac(j,_,_e){j.pendingLanes|=_,_!==536870912&&(j.suspendedLanes=0,j.pingedLanes=0),j=j.eventTimes,_=31-oc(_),j[_]=_e}function Bc(j,_){var _e=j.pendingLanes&~_;j.pendingLanes=_,j.suspendedLanes=0,j.pingedLanes=0,j.expiredLanes&=_,j.mutableReadLanes&=_,j.entangledLanes&=_,_=j.entanglements;var d=j.eventTimes;for(j=j.expirationTimes;0<_e;){var it=31-oc(_e),ct=1<<it;_[it]=0,d[it]=-1,j[it]=-1,_e&=~ct}}function Cc(j,_){var _e=j.entangledLanes|=_;for(j=j.entanglements;_e;){var d=31-oc(_e),it=1<<d;it&_|j[d]&_&&(j[d]|=_),_e&=~it}}var C=0;function Dc(j){return j&=-j,1<j?4<j?j&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(j,_){switch(j){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(_.pointerId)}}function Tc(j,_,_e,d,it,ct){return j===null||j.nativeEvent!==ct?(j={blockedOn:_,domEventName:_e,eventSystemFlags:d,nativeEvent:ct,targetContainers:[it]},_!==null&&(_=Cb(_),_!==null&&Fc(_)),j):(j.eventSystemFlags|=d,_=j.targetContainers,it!==null&&_.indexOf(it)===-1&&_.push(it),j)}function Uc(j,_,_e,d,it){switch(_){case"focusin":return Lc=Tc(Lc,j,_,_e,d,it),!0;case"dragenter":return Mc=Tc(Mc,j,_,_e,d,it),!0;case"mouseover":return Nc=Tc(Nc,j,_,_e,d,it),!0;case"pointerover":var ct=it.pointerId;return Oc.set(ct,Tc(Oc.get(ct)||null,j,_,_e,d,it)),!0;case"gotpointercapture":return ct=it.pointerId,Pc.set(ct,Tc(Pc.get(ct)||null,j,_,_e,d,it)),!0}return!1}function Vc(j){var _=Wc(j.target);if(_!==null){var _e=Vb(_);if(_e!==null){if(_=_e.tag,_===13){if(_=Wb(_e),_!==null){j.blockedOn=_,Ic(j.priority,function(){Gc(_e)});return}}else if(_===3&&_e.stateNode.current.memoizedState.isDehydrated){j.blockedOn=_e.tag===3?_e.stateNode.containerInfo:null;return}}}j.blockedOn=null}function Xc(j){if(j.blockedOn!==null)return!1;for(var _=j.targetContainers;0<_.length;){var _e=Yc(j.domEventName,j.eventSystemFlags,_[0],j.nativeEvent);if(_e===null){_e=j.nativeEvent;var d=new _e.constructor(_e.type,_e);wb=d,_e.target.dispatchEvent(d),wb=null}else return _=Cb(_e),_!==null&&Fc(_),j.blockedOn=_e,!1;_.shift()}return!0}function Zc(j,_,_e){Xc(j)&&_e.delete(_)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(j,_){j.blockedOn===_&&(j.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(j){function _(it){return ad(it,j)}if(0<Kc.length){ad(Kc[0],j);for(var _e=1;_e<Kc.length;_e++){var d=Kc[_e];d.blockedOn===j&&(d.blockedOn=null)}}for(Lc!==null&&ad(Lc,j),Mc!==null&&ad(Mc,j),Nc!==null&&ad(Nc,j),Oc.forEach(_),Pc.forEach(_),_e=0;_e<Qc.length;_e++)d=Qc[_e],d.blockedOn===j&&(d.blockedOn=null);for(;0<Qc.length&&(_e=Qc[0],_e.blockedOn===null);)Vc(_e),_e.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(j,_,_e,d){var it=C,ct=cd.transition;cd.transition=null;try{C=1,fd(j,_,_e,d)}finally{C=it,cd.transition=ct}}function gd(j,_,_e,d){var it=C,ct=cd.transition;cd.transition=null;try{C=4,fd(j,_,_e,d)}finally{C=it,cd.transition=ct}}function fd(j,_,_e,d){if(dd){var it=Yc(j,_,_e,d);if(it===null)hd(j,_,d,id,_e),Sc(j,d);else if(Uc(it,j,_,_e,d))d.stopPropagation();else if(Sc(j,d),_&4&&-1<Rc.indexOf(j)){for(;it!==null;){var ct=Cb(it);if(ct!==null&&Ec(ct),ct=Yc(j,_,_e,d),ct===null&&hd(j,_,d,id,_e),ct===it)break;it=ct}it!==null&&d.stopPropagation()}else hd(j,_,d,null,_e)}}var id=null;function Yc(j,_,_e,d){if(id=null,j=xb(d),j=Wc(j),j!==null)if(_=Vb(j),_===null)j=null;else if(_e=_.tag,_e===13){if(j=Wb(_),j!==null)return j;j=null}else if(_e===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;j=null}else _!==j&&(j=null);return id=j,null}function jd(j){switch(j){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var j,_=ld,_e=_.length,d,it="value"in kd?kd.value:kd.textContent,ct=it.length;for(j=0;j<_e&&_[j]===it[j];j++);var pt=_e-j;for(d=1;d<=pt&&_[_e-d]===it[ct-d];d++);return md=it.slice(j,1<d?1-d:void 0)}function od(j){var _=j.keyCode;return"charCode"in j?(j=j.charCode,j===0&&_===13&&(j=13)):j=_,j===10&&(j=13),32<=j||j===13?j:0}function pd(){return!0}function qd(){return!1}function rd(j){function _(_e,d,it,ct,pt){this._reactName=_e,this._targetInst=it,this.type=d,this.nativeEvent=ct,this.target=pt,this.currentTarget=null;for(var At in j)j.hasOwnProperty(At)&&(_e=j[At],this[At]=_e?_e(ct):ct[At]);return this.isDefaultPrevented=(ct.defaultPrevented!=null?ct.defaultPrevented:ct.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _e=this.nativeEvent;_e&&(_e.preventDefault?_e.preventDefault():typeof _e.returnValue!="unknown"&&(_e.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var _e=this.nativeEvent;_e&&(_e.stopPropagation?_e.stopPropagation():typeof _e.cancelBubble!="unknown"&&(_e.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),_}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(j){return j.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(j){return j.relatedTarget===void 0?j.fromElement===j.srcElement?j.toElement:j.fromElement:j.relatedTarget},movementX:function(j){return"movementX"in j?j.movementX:(j!==yd&&(yd&&j.type==="mousemove"?(wd=j.screenX-yd.screenX,xd=j.screenY-yd.screenY):xd=wd=0,yd=j),wd)},movementY:function(j){return"movementY"in j?j.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(j){return"clipboardData"in j?j.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(j){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(j):(j=Od[j])?!!_[j]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(j){if(j.key){var _=Md[j.key]||j.key;if(_!=="Unidentified")return _}return j.type==="keypress"?(j=od(j),j===13?"Enter":String.fromCharCode(j)):j.type==="keydown"||j.type==="keyup"?Nd[j.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(j){return j.type==="keypress"?od(j):0},keyCode:function(j){return j.type==="keydown"||j.type==="keyup"?j.keyCode:0},which:function(j){return j.type==="keypress"?od(j):j.type==="keydown"||j.type==="keyup"?j.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(j){return"deltaX"in j?j.deltaX:"wheelDeltaX"in j?-j.wheelDeltaX:0},deltaY:function(j){return"deltaY"in j?j.deltaY:"wheelDeltaY"in j?-j.wheelDeltaY:"wheelDelta"in j?-j.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(j,_){switch(j){case"keyup":return $d.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(j){return j=j.detail,typeof j=="object"&&"data"in j?j.data:null}var ie=!1;function je(j,_){switch(j){case"compositionend":return he(_);case"keypress":return _.which!==32?null:(fe=!0,ee);case"textInput":return j=_.data,j===ee&&fe?null:j;default:return null}}function ke(j,_){if(ie)return j==="compositionend"||!ae&&ge(j,_)?(j=nd(),md=ld=kd=null,ie=!1,j):null;switch(j){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return de&&_.locale!=="ko"?null:_.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(j){var _=j&&j.nodeName&&j.nodeName.toLowerCase();return _==="input"?!!le[j.type]:_==="textarea"}function ne(j,_,_e,d){Eb(d),_=oe(_,"onChange"),0<_.length&&(_e=new td("onChange","change",null,_e,d),j.push({event:_e,listeners:_}))}var pe=null,qe=null;function re(j){se(j,0)}function te(j){var _=ue(j);if(Wa(_))return j}function ve(j,_){if(j==="change")return _}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(j){if(j.propertyName==="value"&&te(qe)){var _=[];ne(_,qe,j,xb(j)),Jb(re,_)}}function Ce(j,_,_e){j==="focusin"?(Ae(),pe=_,qe=_e,pe.attachEvent("onpropertychange",Be)):j==="focusout"&&Ae()}function De(j){if(j==="selectionchange"||j==="keyup"||j==="keydown")return te(qe)}function Ee(j,_){if(j==="click")return te(_)}function Fe(j,_){if(j==="input"||j==="change")return te(_)}function Ge(j,_){return j===_&&(j!==0||1/j===1/_)||j!==j&&_!==_}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(j,_){if(He(j,_))return!0;if(typeof j!="object"||j===null||typeof _!="object"||_===null)return!1;var _e=Object.keys(j),d=Object.keys(_);if(_e.length!==d.length)return!1;for(d=0;d<_e.length;d++){var it=_e[d];if(!ja.call(_,it)||!He(j[it],_[it]))return!1}return!0}function Je(j){for(;j&&j.firstChild;)j=j.firstChild;return j}function Ke(j,_){var _e=Je(j);j=0;for(var d;_e;){if(_e.nodeType===3){if(d=j+_e.textContent.length,j<=_&&d>=_)return{node:_e,offset:_-j};j=d}e:{for(;_e;){if(_e.nextSibling){_e=_e.nextSibling;break e}_e=_e.parentNode}_e=void 0}_e=Je(_e)}}function Le(j,_){return j&&_?j===_?!0:j&&j.nodeType===3?!1:_&&_.nodeType===3?Le(j,_.parentNode):"contains"in j?j.contains(_):j.compareDocumentPosition?!!(j.compareDocumentPosition(_)&16):!1:!1}function Me(){for(var j=window,_=Xa();_ instanceof j.HTMLIFrameElement;){try{var _e=typeof _.contentWindow.location.href=="string"}catch{_e=!1}if(_e)j=_.contentWindow;else break;_=Xa(j.document)}return _}function Ne(j){var _=j&&j.nodeName&&j.nodeName.toLowerCase();return _&&(_==="input"&&(j.type==="text"||j.type==="search"||j.type==="tel"||j.type==="url"||j.type==="password")||_==="textarea"||j.contentEditable==="true")}function Oe(j){var _=Me(),_e=j.focusedElem,d=j.selectionRange;if(_!==_e&&_e&&_e.ownerDocument&&Le(_e.ownerDocument.documentElement,_e)){if(d!==null&&Ne(_e)){if(_=d.start,j=d.end,j===void 0&&(j=_),"selectionStart"in _e)_e.selectionStart=_,_e.selectionEnd=Math.min(j,_e.value.length);else if(j=(_=_e.ownerDocument||document)&&_.defaultView||window,j.getSelection){j=j.getSelection();var it=_e.textContent.length,ct=Math.min(d.start,it);d=d.end===void 0?ct:Math.min(d.end,it),!j.extend&&ct>d&&(it=d,d=ct,ct=it),it=Ke(_e,ct);var pt=Ke(_e,d);it&&pt&&(j.rangeCount!==1||j.anchorNode!==it.node||j.anchorOffset!==it.offset||j.focusNode!==pt.node||j.focusOffset!==pt.offset)&&(_=_.createRange(),_.setStart(it.node,it.offset),j.removeAllRanges(),ct>d?(j.addRange(_),j.extend(pt.node,pt.offset)):(_.setEnd(pt.node,pt.offset),j.addRange(_)))}}for(_=[],j=_e;j=j.parentNode;)j.nodeType===1&&_.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof _e.focus=="function"&&_e.focus(),_e=0;_e<_.length;_e++)j=_[_e],j.element.scrollLeft=j.left,j.element.scrollTop=j.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(j,_,_e){var d=_e.window===_e?_e.document:_e.nodeType===9?_e:_e.ownerDocument;Te||Qe==null||Qe!==Xa(d)||(d=Qe,"selectionStart"in d&&Ne(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Se&&Ie(Se,d)||(Se=d,d=oe(Re,"onSelect"),0<d.length&&(_=new td("onSelect","select",null,_,_e),j.push({event:_,listeners:d}),_.target=Qe)))}function Ve(j,_){var _e={};return _e[j.toLowerCase()]=_.toLowerCase(),_e["Webkit"+j]="webkit"+_,_e["Moz"+j]="moz"+_,_e}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(j){if(Xe[j])return Xe[j];if(!We[j])return j;var _=We[j],_e;for(_e in _)if(_.hasOwnProperty(_e)&&_e in Ye)return Xe[j]=_[_e];return j}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(j,_){df.set(j,_),fa(_,[j])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(j,_,_e){var d=j.type||"unknown-event";j.currentTarget=_e,Ub(d,_,void 0,j),j.currentTarget=null}function se(j,_){_=(_&4)!==0;for(var _e=0;_e<j.length;_e++){var d=j[_e],it=d.event;d=d.listeners;e:{var ct=void 0;if(_)for(var pt=d.length-1;0<=pt;pt--){var At=d[pt],St=At.instance,Ot=At.currentTarget;if(At=At.listener,St!==ct&&it.isPropagationStopped())break e;nf(it,At,Ot),ct=St}else for(pt=0;pt<d.length;pt++){if(At=d[pt],St=At.instance,Ot=At.currentTarget,At=At.listener,St!==ct&&it.isPropagationStopped())break e;nf(it,At,Ot),ct=St}}}if(Qb)throw j=Rb,Qb=!1,Rb=null,j}function D(j,_){var _e=_[of];_e===void 0&&(_e=_[of]=new Set);var d=j+"__bubble";_e.has(d)||(pf(_,j,2,!1),_e.add(d))}function qf(j,_,_e){var d=0;_&&(d|=4),pf(_e,j,d,_)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(j){if(!j[rf]){j[rf]=!0,da.forEach(function(_e){_e!=="selectionchange"&&(mf.has(_e)||qf(_e,!1,j),qf(_e,!0,j))});var _=j.nodeType===9?j:j.ownerDocument;_===null||_[rf]||(_[rf]=!0,qf("selectionchange",!1,_))}}function pf(j,_,_e,d){switch(jd(_)){case 1:var it=ed;break;case 4:it=gd;break;default:it=fd}_e=it.bind(null,_,_e,j),it=void 0,!Lb||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(it=!0),d?it!==void 0?j.addEventListener(_,_e,{capture:!0,passive:it}):j.addEventListener(_,_e,!0):it!==void 0?j.addEventListener(_,_e,{passive:it}):j.addEventListener(_,_e,!1)}function hd(j,_,_e,d,it){var ct=d;if(!(_&1)&&!(_&2)&&d!==null)e:for(;;){if(d===null)return;var pt=d.tag;if(pt===3||pt===4){var At=d.stateNode.containerInfo;if(At===it||At.nodeType===8&&At.parentNode===it)break;if(pt===4)for(pt=d.return;pt!==null;){var St=pt.tag;if((St===3||St===4)&&(St=pt.stateNode.containerInfo,St===it||St.nodeType===8&&St.parentNode===it))return;pt=pt.return}for(;At!==null;){if(pt=Wc(At),pt===null)return;if(St=pt.tag,St===5||St===6){d=ct=pt;continue e}At=At.parentNode}}d=d.return}Jb(function(){var Ot=ct,Qt=xb(_e),Yt=[];e:{var Vt=df.get(j);if(Vt!==void 0){var qt=td,Jt=j;switch(j){case"keypress":if(od(_e)===0)break e;case"keydown":case"keyup":qt=Rd;break;case"focusin":Jt="focus",qt=Fd;break;case"focusout":Jt="blur",qt=Fd;break;case"beforeblur":case"afterblur":qt=Fd;break;case"click":if(_e.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=Vd;break;case $e:case af:case bf:qt=Hd;break;case cf:qt=Xd;break;case"scroll":qt=vd;break;case"wheel":qt=Zd;break;case"copy":case"cut":case"paste":qt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=Td}var jt=(_&4)!==0,sn=!jt&&j==="scroll",Ft=jt?Vt!==null?Vt+"Capture":null:Vt;jt=[];for(var Ut=Ot,Ht;Ut!==null;){Ht=Ut;var an=Ht.stateNode;if(Ht.tag===5&&an!==null&&(Ht=an,Ft!==null&&(an=Kb(Ut,Ft),an!=null&&jt.push(tf(Ut,an,Ht)))),sn)break;Ut=Ut.return}0<jt.length&&(Vt=new qt(Vt,Jt,null,_e,Qt),Yt.push({event:Vt,listeners:jt}))}}if(!(_&7)){e:{if(Vt=j==="mouseover"||j==="pointerover",qt=j==="mouseout"||j==="pointerout",Vt&&_e!==wb&&(Jt=_e.relatedTarget||_e.fromElement)&&(Wc(Jt)||Jt[uf]))break e;if((qt||Vt)&&(Vt=Qt.window===Qt?Qt:(Vt=Qt.ownerDocument)?Vt.defaultView||Vt.parentWindow:window,qt?(Jt=_e.relatedTarget||_e.toElement,qt=Ot,Jt=Jt?Wc(Jt):null,Jt!==null&&(sn=Vb(Jt),Jt!==sn||Jt.tag!==5&&Jt.tag!==6)&&(Jt=null)):(qt=null,Jt=Ot),qt!==Jt)){if(jt=Bd,an="onMouseLeave",Ft="onMouseEnter",Ut="mouse",(j==="pointerout"||j==="pointerover")&&(jt=Td,an="onPointerLeave",Ft="onPointerEnter",Ut="pointer"),sn=qt==null?Vt:ue(qt),Ht=Jt==null?Vt:ue(Jt),Vt=new jt(an,Ut+"leave",qt,_e,Qt),Vt.target=sn,Vt.relatedTarget=Ht,an=null,Wc(Qt)===Ot&&(jt=new jt(Ft,Ut+"enter",Jt,_e,Qt),jt.target=Ht,jt.relatedTarget=sn,an=jt),sn=an,qt&&Jt)t:{for(jt=qt,Ft=Jt,Ut=0,Ht=jt;Ht;Ht=vf(Ht))Ut++;for(Ht=0,an=Ft;an;an=vf(an))Ht++;for(;0<Ut-Ht;)jt=vf(jt),Ut--;for(;0<Ht-Ut;)Ft=vf(Ft),Ht--;for(;Ut--;){if(jt===Ft||Ft!==null&&jt===Ft.alternate)break t;jt=vf(jt),Ft=vf(Ft)}jt=null}else jt=null;qt!==null&&wf(Yt,Vt,qt,jt,!1),Jt!==null&&sn!==null&&wf(Yt,sn,Jt,jt,!0)}}e:{if(Vt=Ot?ue(Ot):window,qt=Vt.nodeName&&Vt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&Vt.type==="file")var nn=ve;else if(me(Vt))if(we)nn=Fe;else{nn=De;var dn=Ce}else(qt=Vt.nodeName)&&qt.toLowerCase()==="input"&&(Vt.type==="checkbox"||Vt.type==="radio")&&(nn=Ee);if(nn&&(nn=nn(j,Ot))){ne(Yt,nn,_e,Qt);break e}dn&&dn(j,Vt,Ot),j==="focusout"&&(dn=Vt._wrapperState)&&dn.controlled&&Vt.type==="number"&&cb(Vt,"number",Vt.value)}switch(dn=Ot?ue(Ot):window,j){case"focusin":(me(dn)||dn.contentEditable==="true")&&(Qe=dn,Re=Ot,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(Yt,_e,Qt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Yt,_e,Qt)}var zt;if(ae)e:{switch(j){case"compositionstart":var Wt="onCompositionStart";break e;case"compositionend":Wt="onCompositionEnd";break e;case"compositionupdate":Wt="onCompositionUpdate";break e}Wt=void 0}else ie?ge(j,_e)&&(Wt="onCompositionEnd"):j==="keydown"&&_e.keyCode===229&&(Wt="onCompositionStart");Wt&&(de&&_e.locale!=="ko"&&(ie||Wt!=="onCompositionStart"?Wt==="onCompositionEnd"&&ie&&(zt=nd()):(kd=Qt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),dn=oe(Ot,Wt),0<dn.length&&(Wt=new Ld(Wt,j,null,_e,Qt),Yt.push({event:Wt,listeners:dn}),zt?Wt.data=zt:(zt=he(_e),zt!==null&&(Wt.data=zt)))),(zt=ce?je(j,_e):ke(j,_e))&&(Ot=oe(Ot,"onBeforeInput"),0<Ot.length&&(Qt=new Ld("onBeforeInput","beforeinput",null,_e,Qt),Yt.push({event:Qt,listeners:Ot}),Qt.data=zt))}se(Yt,_)})}function tf(j,_,_e){return{instance:j,listener:_,currentTarget:_e}}function oe(j,_){for(var _e=_+"Capture",d=[];j!==null;){var it=j,ct=it.stateNode;it.tag===5&&ct!==null&&(it=ct,ct=Kb(j,_e),ct!=null&&d.unshift(tf(j,ct,it)),ct=Kb(j,_),ct!=null&&d.push(tf(j,ct,it))),j=j.return}return d}function vf(j){if(j===null)return null;do j=j.return;while(j&&j.tag!==5);return j||null}function wf(j,_,_e,d,it){for(var ct=_._reactName,pt=[];_e!==null&&_e!==d;){var At=_e,St=At.alternate,Ot=At.stateNode;if(St!==null&&St===d)break;At.tag===5&&Ot!==null&&(At=Ot,it?(St=Kb(_e,ct),St!=null&&pt.unshift(tf(_e,St,At))):it||(St=Kb(_e,ct),St!=null&&pt.push(tf(_e,St,At)))),_e=_e.return}pt.length!==0&&j.push({event:_,listeners:pt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(j){return(typeof j=="string"?j:""+j).replace(xf,`
`).replace(yf,"")}function Af(j,_,_e){if(_=zf(_),zf(j)!==_&&_e)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(j,_){return j==="textarea"||j==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(j){return Hf.resolve(null).then(j).catch(If)}:Ff;function If(j){setTimeout(function(){throw j})}function Kf(j,_){var _e=_,d=0;do{var it=_e.nextSibling;if(j.removeChild(_e),it&&it.nodeType===8)if(_e=it.data,_e==="/$"){if(d===0){j.removeChild(it),bd(_);return}d--}else _e!=="$"&&_e!=="$?"&&_e!=="$!"||d++;_e=it}while(_e);bd(_)}function Lf(j){for(;j!=null;j=j.nextSibling){var _=j.nodeType;if(_===1||_===3)break;if(_===8){if(_=j.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return j}function Mf(j){j=j.previousSibling;for(var _=0;j;){if(j.nodeType===8){var _e=j.data;if(_e==="$"||_e==="$!"||_e==="$?"){if(_===0)return j;_--}else _e==="/$"&&_++}j=j.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(j){var _=j[Of];if(_)return _;for(var _e=j.parentNode;_e;){if(_=_e[uf]||_e[Of]){if(_e=_.alternate,_.child!==null||_e!==null&&_e.child!==null)for(j=Mf(j);j!==null;){if(_e=j[Of])return _e;j=Mf(j)}return _}j=_e,_e=j.parentNode}return null}function Cb(j){return j=j[Of]||j[uf],!j||j.tag!==5&&j.tag!==6&&j.tag!==13&&j.tag!==3?null:j}function ue(j){if(j.tag===5||j.tag===6)return j.stateNode;throw Error(p(33))}function Db(j){return j[Pf]||null}var Sf=[],Tf=-1;function Uf(j){return{current:j}}function E(j){0>Tf||(j.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(j,_){Tf++,Sf[Tf]=j.current,j.current=_}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(j,_){var _e=j.type.contextTypes;if(!_e)return Vf;var d=j.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===_)return d.__reactInternalMemoizedMaskedChildContext;var it={},ct;for(ct in _e)it[ct]=_[ct];return d&&(j=j.stateNode,j.__reactInternalMemoizedUnmaskedChildContext=_,j.__reactInternalMemoizedMaskedChildContext=it),it}function Zf(j){return j=j.childContextTypes,j!=null}function $f(){E(Wf),E(H)}function ag(j,_,_e){if(H.current!==Vf)throw Error(p(168));G(H,_),G(Wf,_e)}function bg(j,_,_e){var d=j.stateNode;if(_=_.childContextTypes,typeof d.getChildContext!="function")return _e;d=d.getChildContext();for(var it in d)if(!(it in _))throw Error(p(108,Ra(j)||"Unknown",it));return A({},_e,d)}function cg(j){return j=(j=j.stateNode)&&j.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,j),G(Wf,Wf.current),!0}function dg(j,_,_e){var d=j.stateNode;if(!d)throw Error(p(169));_e?(j=bg(j,_,Xf),d.__reactInternalMemoizedMergedChildContext=j,E(Wf),E(H),G(H,j)):E(Wf),G(Wf,_e)}var eg=null,fg=!1,gg=!1;function hg(j){eg===null?eg=[j]:eg.push(j)}function ig(j){fg=!0,hg(j)}function jg(){if(!gg&&eg!==null){gg=!0;var j=0,_=C;try{var _e=eg;for(C=1;j<_e.length;j++){var d=_e[j];do d=d(!0);while(d!==null)}eg=null,fg=!1}catch(it){throw eg!==null&&(eg=eg.slice(j+1)),ac(fc,jg),it}finally{C=_,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(j,_){kg[lg++]=ng,kg[lg++]=mg,mg=j,ng=_}function ug(j,_,_e){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=j;var d=rg;j=sg;var it=32-oc(d)-1;d&=~(1<<it),_e+=1;var ct=32-oc(_)+it;if(30<ct){var pt=it-it%5;ct=(d&(1<<pt)-1).toString(32),d>>=pt,it-=pt,rg=1<<32-oc(_)+it|_e<<it|d,sg=ct+j}else rg=1<<ct|_e<<it|d,sg=j}function vg(j){j.return!==null&&(tg(j,1),ug(j,1,0))}function wg(j){for(;j===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;j===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(j,_){var _e=Bg(5,null,null,0);_e.elementType="DELETED",_e.stateNode=_,_e.return=j,_=j.deletions,_===null?(j.deletions=[_e],j.flags|=16):_.push(_e)}function Cg(j,_){switch(j.tag){case 5:var _e=j.type;return _=_.nodeType!==1||_e.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(j.stateNode=_,xg=j,yg=Lf(_.firstChild),!0):!1;case 6:return _=j.pendingProps===""||_.nodeType!==3?null:_,_!==null?(j.stateNode=_,xg=j,yg=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(_e=qg!==null?{id:rg,overflow:sg}:null,j.memoizedState={dehydrated:_,treeContext:_e,retryLane:1073741824},_e=Bg(18,null,null,0),_e.stateNode=_,_e.return=j,j.child=_e,xg=j,yg=null,!0):!1;default:return!1}}function Dg(j){return(j.mode&1)!==0&&(j.flags&128)===0}function Eg(j){if(I){var _=yg;if(_){var _e=_;if(!Cg(j,_)){if(Dg(j))throw Error(p(418));_=Lf(_e.nextSibling);var d=xg;_&&Cg(j,_)?Ag(d,_e):(j.flags=j.flags&-4097|2,I=!1,xg=j)}}else{if(Dg(j))throw Error(p(418));j.flags=j.flags&-4097|2,I=!1,xg=j}}}function Fg(j){for(j=j.return;j!==null&&j.tag!==5&&j.tag!==3&&j.tag!==13;)j=j.return;xg=j}function Gg(j){if(j!==xg)return!1;if(!I)return Fg(j),I=!0,!1;var _;if((_=j.tag!==3)&&!(_=j.tag!==5)&&(_=j.type,_=_!=="head"&&_!=="body"&&!Ef(j.type,j.memoizedProps)),_&&(_=yg)){if(Dg(j))throw Hg(),Error(p(418));for(;_;)Ag(j,_),_=Lf(_.nextSibling)}if(Fg(j),j.tag===13){if(j=j.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(p(317));e:{for(j=j.nextSibling,_=0;j;){if(j.nodeType===8){var _e=j.data;if(_e==="/$"){if(_===0){yg=Lf(j.nextSibling);break e}_--}else _e!=="$"&&_e!=="$!"&&_e!=="$?"||_++}j=j.nextSibling}yg=null}}else yg=xg?Lf(j.stateNode.nextSibling):null;return!0}function Hg(){for(var j=yg;j;)j=Lf(j.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(j){zg===null?zg=[j]:zg.push(j)}var Kg=ua.ReactCurrentBatchConfig;function Lg(j,_){if(j&&j.defaultProps){_=A({},_),j=j.defaultProps;for(var _e in j)_[_e]===void 0&&(_[_e]=j[_e]);return _}return _}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(j){var _=Mg.current;E(Mg),j._currentValue=_}function Sg(j,_,_e){for(;j!==null;){var d=j.alternate;if((j.childLanes&_)!==_?(j.childLanes|=_,d!==null&&(d.childLanes|=_)):d!==null&&(d.childLanes&_)!==_&&(d.childLanes|=_),j===_e)break;j=j.return}}function Tg(j,_){Ng=j,Pg=Og=null,j=j.dependencies,j!==null&&j.firstContext!==null&&(j.lanes&_&&(Ug=!0),j.firstContext=null)}function Vg(j){var _=j._currentValue;if(Pg!==j)if(j={context:j,memoizedValue:_,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=j,Ng.dependencies={lanes:0,firstContext:j}}else Og=Og.next=j;return _}var Wg=null;function Xg(j){Wg===null?Wg=[j]:Wg.push(j)}function Yg(j,_,_e,d){var it=_.interleaved;return it===null?(_e.next=_e,Xg(_)):(_e.next=it.next,it.next=_e),_.interleaved=_e,Zg(j,d)}function Zg(j,_){j.lanes|=_;var _e=j.alternate;for(_e!==null&&(_e.lanes|=_),_e=j,j=j.return;j!==null;)j.childLanes|=_,_e=j.alternate,_e!==null&&(_e.childLanes|=_),_e=j,j=j.return;return _e.tag===3?_e.stateNode:null}var $g=!1;function ah(j){j.updateQueue={baseState:j.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(j,_){j=j.updateQueue,_.updateQueue===j&&(_.updateQueue={baseState:j.baseState,firstBaseUpdate:j.firstBaseUpdate,lastBaseUpdate:j.lastBaseUpdate,shared:j.shared,effects:j.effects})}function ch(j,_){return{eventTime:j,lane:_,tag:0,payload:null,callback:null,next:null}}function dh(j,_,_e){var d=j.updateQueue;if(d===null)return null;if(d=d.shared,K&2){var it=d.pending;return it===null?_.next=_:(_.next=it.next,it.next=_),d.pending=_,Zg(j,_e)}return it=d.interleaved,it===null?(_.next=_,Xg(d)):(_.next=it.next,it.next=_),d.interleaved=_,Zg(j,_e)}function eh(j,_,_e){if(_=_.updateQueue,_!==null&&(_=_.shared,(_e&4194240)!==0)){var d=_.lanes;d&=j.pendingLanes,_e|=d,_.lanes=_e,Cc(j,_e)}}function fh(j,_){var _e=j.updateQueue,d=j.alternate;if(d!==null&&(d=d.updateQueue,_e===d)){var it=null,ct=null;if(_e=_e.firstBaseUpdate,_e!==null){do{var pt={eventTime:_e.eventTime,lane:_e.lane,tag:_e.tag,payload:_e.payload,callback:_e.callback,next:null};ct===null?it=ct=pt:ct=ct.next=pt,_e=_e.next}while(_e!==null);ct===null?it=ct=_:ct=ct.next=_}else it=ct=_;_e={baseState:d.baseState,firstBaseUpdate:it,lastBaseUpdate:ct,shared:d.shared,effects:d.effects},j.updateQueue=_e;return}j=_e.lastBaseUpdate,j===null?_e.firstBaseUpdate=_:j.next=_,_e.lastBaseUpdate=_}function gh(j,_,_e,d){var it=j.updateQueue;$g=!1;var ct=it.firstBaseUpdate,pt=it.lastBaseUpdate,At=it.shared.pending;if(At!==null){it.shared.pending=null;var St=At,Ot=St.next;St.next=null,pt===null?ct=Ot:pt.next=Ot,pt=St;var Qt=j.alternate;Qt!==null&&(Qt=Qt.updateQueue,At=Qt.lastBaseUpdate,At!==pt&&(At===null?Qt.firstBaseUpdate=Ot:At.next=Ot,Qt.lastBaseUpdate=St))}if(ct!==null){var Yt=it.baseState;pt=0,Qt=Ot=St=null,At=ct;do{var Vt=At.lane,qt=At.eventTime;if((d&Vt)===Vt){Qt!==null&&(Qt=Qt.next={eventTime:qt,lane:0,tag:At.tag,payload:At.payload,callback:At.callback,next:null});e:{var Jt=j,jt=At;switch(Vt=_,qt=_e,jt.tag){case 1:if(Jt=jt.payload,typeof Jt=="function"){Yt=Jt.call(qt,Yt,Vt);break e}Yt=Jt;break e;case 3:Jt.flags=Jt.flags&-65537|128;case 0:if(Jt=jt.payload,Vt=typeof Jt=="function"?Jt.call(qt,Yt,Vt):Jt,Vt==null)break e;Yt=A({},Yt,Vt);break e;case 2:$g=!0}}At.callback!==null&&At.lane!==0&&(j.flags|=64,Vt=it.effects,Vt===null?it.effects=[At]:Vt.push(At))}else qt={eventTime:qt,lane:Vt,tag:At.tag,payload:At.payload,callback:At.callback,next:null},Qt===null?(Ot=Qt=qt,St=Yt):Qt=Qt.next=qt,pt|=Vt;if(At=At.next,At===null){if(At=it.shared.pending,At===null)break;Vt=At,At=Vt.next,Vt.next=null,it.lastBaseUpdate=Vt,it.shared.pending=null}}while(1);if(Qt===null&&(St=Yt),it.baseState=St,it.firstBaseUpdate=Ot,it.lastBaseUpdate=Qt,_=it.shared.interleaved,_!==null){it=_;do pt|=it.lane,it=it.next;while(it!==_)}else ct===null&&(it.shared.lanes=0);hh|=pt,j.lanes=pt,j.memoizedState=Yt}}function ih(j,_,_e){if(j=_.effects,_.effects=null,j!==null)for(_=0;_<j.length;_++){var d=j[_],it=d.callback;if(it!==null){if(d.callback=null,d=_e,typeof it!="function")throw Error(p(191,it));it.call(d)}}}var jh=new aa.Component().refs;function kh(j,_,_e,d){_=j.memoizedState,_e=_e(d,_),_e=_e==null?_:A({},_,_e),j.memoizedState=_e,j.lanes===0&&(j.updateQueue.baseState=_e)}var nh={isMounted:function(j){return(j=j._reactInternals)?Vb(j)===j:!1},enqueueSetState:function(j,_,_e){j=j._reactInternals;var d=L(),it=lh(j),ct=ch(d,it);ct.payload=_,_e!=null&&(ct.callback=_e),_=dh(j,ct,it),_!==null&&(mh(_,j,it,d),eh(_,j,it))},enqueueReplaceState:function(j,_,_e){j=j._reactInternals;var d=L(),it=lh(j),ct=ch(d,it);ct.tag=1,ct.payload=_,_e!=null&&(ct.callback=_e),_=dh(j,ct,it),_!==null&&(mh(_,j,it,d),eh(_,j,it))},enqueueForceUpdate:function(j,_){j=j._reactInternals;var _e=L(),d=lh(j),it=ch(_e,d);it.tag=2,_!=null&&(it.callback=_),_=dh(j,it,d),_!==null&&(mh(_,j,d,_e),eh(_,j,d))}};function oh(j,_,_e,d,it,ct,pt){return j=j.stateNode,typeof j.shouldComponentUpdate=="function"?j.shouldComponentUpdate(d,ct,pt):_.prototype&&_.prototype.isPureReactComponent?!Ie(_e,d)||!Ie(it,ct):!0}function ph(j,_,_e){var d=!1,it=Vf,ct=_.contextType;return typeof ct=="object"&&ct!==null?ct=Vg(ct):(it=Zf(_)?Xf:H.current,d=_.contextTypes,ct=(d=d!=null)?Yf(j,it):Vf),_=new _(_e,ct),j.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=nh,j.stateNode=_,_._reactInternals=j,d&&(j=j.stateNode,j.__reactInternalMemoizedUnmaskedChildContext=it,j.__reactInternalMemoizedMaskedChildContext=ct),_}function qh(j,_,_e,d){j=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(_e,d),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(_e,d),_.state!==j&&nh.enqueueReplaceState(_,_.state,null)}function rh(j,_,_e,d){var it=j.stateNode;it.props=_e,it.state=j.memoizedState,it.refs=jh,ah(j);var ct=_.contextType;typeof ct=="object"&&ct!==null?it.context=Vg(ct):(ct=Zf(_)?Xf:H.current,it.context=Yf(j,ct)),it.state=j.memoizedState,ct=_.getDerivedStateFromProps,typeof ct=="function"&&(kh(j,_,ct,_e),it.state=j.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof it.getSnapshotBeforeUpdate=="function"||typeof it.UNSAFE_componentWillMount!="function"&&typeof it.componentWillMount!="function"||(_=it.state,typeof it.componentWillMount=="function"&&it.componentWillMount(),typeof it.UNSAFE_componentWillMount=="function"&&it.UNSAFE_componentWillMount(),_!==it.state&&nh.enqueueReplaceState(it,it.state,null),gh(j,_e,it,d),it.state=j.memoizedState),typeof it.componentDidMount=="function"&&(j.flags|=4194308)}function sh(j,_,_e){if(j=_e.ref,j!==null&&typeof j!="function"&&typeof j!="object"){if(_e._owner){if(_e=_e._owner,_e){if(_e.tag!==1)throw Error(p(309));var d=_e.stateNode}if(!d)throw Error(p(147,j));var it=d,ct=""+j;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===ct?_.ref:(_=function(pt){var At=it.refs;At===jh&&(At=it.refs={}),pt===null?delete At[ct]:At[ct]=pt},_._stringRef=ct,_)}if(typeof j!="string")throw Error(p(284));if(!_e._owner)throw Error(p(290,j))}return j}function th(j,_){throw j=Object.prototype.toString.call(_),Error(p(31,j==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":j))}function uh(j){var _=j._init;return _(j._payload)}function vh(j){function _(Ft,Ut){if(j){var Ht=Ft.deletions;Ht===null?(Ft.deletions=[Ut],Ft.flags|=16):Ht.push(Ut)}}function _e(Ft,Ut){if(!j)return null;for(;Ut!==null;)_(Ft,Ut),Ut=Ut.sibling;return null}function d(Ft,Ut){for(Ft=new Map;Ut!==null;)Ut.key!==null?Ft.set(Ut.key,Ut):Ft.set(Ut.index,Ut),Ut=Ut.sibling;return Ft}function it(Ft,Ut){return Ft=wh(Ft,Ut),Ft.index=0,Ft.sibling=null,Ft}function ct(Ft,Ut,Ht){return Ft.index=Ht,j?(Ht=Ft.alternate,Ht!==null?(Ht=Ht.index,Ht<Ut?(Ft.flags|=2,Ut):Ht):(Ft.flags|=2,Ut)):(Ft.flags|=1048576,Ut)}function pt(Ft){return j&&Ft.alternate===null&&(Ft.flags|=2),Ft}function At(Ft,Ut,Ht,an){return Ut===null||Ut.tag!==6?(Ut=xh(Ht,Ft.mode,an),Ut.return=Ft,Ut):(Ut=it(Ut,Ht),Ut.return=Ft,Ut)}function St(Ft,Ut,Ht,an){var nn=Ht.type;return nn===ya?Qt(Ft,Ut,Ht.props.children,an,Ht.key):Ut!==null&&(Ut.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===Ha&&uh(nn)===Ut.type)?(an=it(Ut,Ht.props),an.ref=sh(Ft,Ut,Ht),an.return=Ft,an):(an=yh(Ht.type,Ht.key,Ht.props,null,Ft.mode,an),an.ref=sh(Ft,Ut,Ht),an.return=Ft,an)}function Ot(Ft,Ut,Ht,an){return Ut===null||Ut.tag!==4||Ut.stateNode.containerInfo!==Ht.containerInfo||Ut.stateNode.implementation!==Ht.implementation?(Ut=zh(Ht,Ft.mode,an),Ut.return=Ft,Ut):(Ut=it(Ut,Ht.children||[]),Ut.return=Ft,Ut)}function Qt(Ft,Ut,Ht,an,nn){return Ut===null||Ut.tag!==7?(Ut=Ah(Ht,Ft.mode,an,nn),Ut.return=Ft,Ut):(Ut=it(Ut,Ht),Ut.return=Ft,Ut)}function Yt(Ft,Ut,Ht){if(typeof Ut=="string"&&Ut!==""||typeof Ut=="number")return Ut=xh(""+Ut,Ft.mode,Ht),Ut.return=Ft,Ut;if(typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case va:return Ht=yh(Ut.type,Ut.key,Ut.props,null,Ft.mode,Ht),Ht.ref=sh(Ft,null,Ut),Ht.return=Ft,Ht;case wa:return Ut=zh(Ut,Ft.mode,Ht),Ut.return=Ft,Ut;case Ha:var an=Ut._init;return Yt(Ft,an(Ut._payload),Ht)}if(eb(Ut)||Ka(Ut))return Ut=Ah(Ut,Ft.mode,Ht,null),Ut.return=Ft,Ut;th(Ft,Ut)}return null}function Vt(Ft,Ut,Ht,an){var nn=Ut!==null?Ut.key:null;if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return nn!==null?null:At(Ft,Ut,""+Ht,an);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:return Ht.key===nn?St(Ft,Ut,Ht,an):null;case wa:return Ht.key===nn?Ot(Ft,Ut,Ht,an):null;case Ha:return nn=Ht._init,Vt(Ft,Ut,nn(Ht._payload),an)}if(eb(Ht)||Ka(Ht))return nn!==null?null:Qt(Ft,Ut,Ht,an,null);th(Ft,Ht)}return null}function qt(Ft,Ut,Ht,an,nn){if(typeof an=="string"&&an!==""||typeof an=="number")return Ft=Ft.get(Ht)||null,At(Ut,Ft,""+an,nn);if(typeof an=="object"&&an!==null){switch(an.$$typeof){case va:return Ft=Ft.get(an.key===null?Ht:an.key)||null,St(Ut,Ft,an,nn);case wa:return Ft=Ft.get(an.key===null?Ht:an.key)||null,Ot(Ut,Ft,an,nn);case Ha:var dn=an._init;return qt(Ft,Ut,Ht,dn(an._payload),nn)}if(eb(an)||Ka(an))return Ft=Ft.get(Ht)||null,Qt(Ut,Ft,an,nn,null);th(Ut,an)}return null}function Jt(Ft,Ut,Ht,an){for(var nn=null,dn=null,zt=Ut,Wt=Ut=0,Zt=null;zt!==null&&Wt<Ht.length;Wt++){zt.index>Wt?(Zt=zt,zt=null):Zt=zt.sibling;var mn=Vt(Ft,zt,Ht[Wt],an);if(mn===null){zt===null&&(zt=Zt);break}j&&zt&&mn.alternate===null&&_(Ft,zt),Ut=ct(mn,Ut,Wt),dn===null?nn=mn:dn.sibling=mn,dn=mn,zt=Zt}if(Wt===Ht.length)return _e(Ft,zt),I&&tg(Ft,Wt),nn;if(zt===null){for(;Wt<Ht.length;Wt++)zt=Yt(Ft,Ht[Wt],an),zt!==null&&(Ut=ct(zt,Ut,Wt),dn===null?nn=zt:dn.sibling=zt,dn=zt);return I&&tg(Ft,Wt),nn}for(zt=d(Ft,zt);Wt<Ht.length;Wt++)Zt=qt(zt,Ft,Wt,Ht[Wt],an),Zt!==null&&(j&&Zt.alternate!==null&&zt.delete(Zt.key===null?Wt:Zt.key),Ut=ct(Zt,Ut,Wt),dn===null?nn=Zt:dn.sibling=Zt,dn=Zt);return j&&zt.forEach(function(hn){return _(Ft,hn)}),I&&tg(Ft,Wt),nn}function jt(Ft,Ut,Ht,an){var nn=Ka(Ht);if(typeof nn!="function")throw Error(p(150));if(Ht=nn.call(Ht),Ht==null)throw Error(p(151));for(var dn=nn=null,zt=Ut,Wt=Ut=0,Zt=null,mn=Ht.next();zt!==null&&!mn.done;Wt++,mn=Ht.next()){zt.index>Wt?(Zt=zt,zt=null):Zt=zt.sibling;var hn=Vt(Ft,zt,mn.value,an);if(hn===null){zt===null&&(zt=Zt);break}j&&zt&&hn.alternate===null&&_(Ft,zt),Ut=ct(hn,Ut,Wt),dn===null?nn=hn:dn.sibling=hn,dn=hn,zt=Zt}if(mn.done)return _e(Ft,zt),I&&tg(Ft,Wt),nn;if(zt===null){for(;!mn.done;Wt++,mn=Ht.next())mn=Yt(Ft,mn.value,an),mn!==null&&(Ut=ct(mn,Ut,Wt),dn===null?nn=mn:dn.sibling=mn,dn=mn);return I&&tg(Ft,Wt),nn}for(zt=d(Ft,zt);!mn.done;Wt++,mn=Ht.next())mn=qt(zt,Ft,Wt,mn.value,an),mn!==null&&(j&&mn.alternate!==null&&zt.delete(mn.key===null?Wt:mn.key),Ut=ct(mn,Ut,Wt),dn===null?nn=mn:dn.sibling=mn,dn=mn);return j&&zt.forEach(function(zn){return _(Ft,zn)}),I&&tg(Ft,Wt),nn}function sn(Ft,Ut,Ht,an){if(typeof Ht=="object"&&Ht!==null&&Ht.type===ya&&Ht.key===null&&(Ht=Ht.props.children),typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:e:{for(var nn=Ht.key,dn=Ut;dn!==null;){if(dn.key===nn){if(nn=Ht.type,nn===ya){if(dn.tag===7){_e(Ft,dn.sibling),Ut=it(dn,Ht.props.children),Ut.return=Ft,Ft=Ut;break e}}else if(dn.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===Ha&&uh(nn)===dn.type){_e(Ft,dn.sibling),Ut=it(dn,Ht.props),Ut.ref=sh(Ft,dn,Ht),Ut.return=Ft,Ft=Ut;break e}_e(Ft,dn);break}else _(Ft,dn);dn=dn.sibling}Ht.type===ya?(Ut=Ah(Ht.props.children,Ft.mode,an,Ht.key),Ut.return=Ft,Ft=Ut):(an=yh(Ht.type,Ht.key,Ht.props,null,Ft.mode,an),an.ref=sh(Ft,Ut,Ht),an.return=Ft,Ft=an)}return pt(Ft);case wa:e:{for(dn=Ht.key;Ut!==null;){if(Ut.key===dn)if(Ut.tag===4&&Ut.stateNode.containerInfo===Ht.containerInfo&&Ut.stateNode.implementation===Ht.implementation){_e(Ft,Ut.sibling),Ut=it(Ut,Ht.children||[]),Ut.return=Ft,Ft=Ut;break e}else{_e(Ft,Ut);break}else _(Ft,Ut);Ut=Ut.sibling}Ut=zh(Ht,Ft.mode,an),Ut.return=Ft,Ft=Ut}return pt(Ft);case Ha:return dn=Ht._init,sn(Ft,Ut,dn(Ht._payload),an)}if(eb(Ht))return Jt(Ft,Ut,Ht,an);if(Ka(Ht))return jt(Ft,Ut,Ht,an);th(Ft,Ht)}return typeof Ht=="string"&&Ht!==""||typeof Ht=="number"?(Ht=""+Ht,Ut!==null&&Ut.tag===6?(_e(Ft,Ut.sibling),Ut=it(Ut,Ht),Ut.return=Ft,Ft=Ut):(_e(Ft,Ut),Ut=xh(Ht,Ft.mode,an),Ut.return=Ft,Ft=Ut),pt(Ft)):_e(Ft,Ut)}return sn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(j){if(j===Dh)throw Error(p(174));return j}function Ih(j,_){switch(G(Gh,_),G(Fh,j),G(Eh,Dh),j=_.nodeType,j){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:lb(null,"");break;default:j=j===8?_.parentNode:_,_=j.namespaceURI||null,j=j.tagName,_=lb(_,j)}E(Eh),G(Eh,_)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(j){Hh(Gh.current);var _=Hh(Eh.current),_e=lb(_,j.type);_!==_e&&(G(Fh,j),G(Eh,_e))}function Lh(j){Fh.current===j&&(E(Eh),E(Fh))}var M=Uf(0);function Mh(j){for(var _=j;_!==null;){if(_.tag===13){var _e=_.memoizedState;if(_e!==null&&(_e=_e.dehydrated,_e===null||_e.data==="$?"||_e.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if(_.flags&128)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===j)break;for(;_.sibling===null;){if(_.return===null||_.return===j)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Nh=[];function Oh(){for(var j=0;j<Nh.length;j++)Nh[j]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p(321))}function Wh(j,_){if(_===null)return!1;for(var _e=0;_e<_.length&&_e<j.length;_e++)if(!He(j[_e],_[_e]))return!1;return!0}function Xh(j,_,_e,d,it,ct){if(Rh=ct,N=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Ph.current=j===null||j.memoizedState===null?Yh:Zh,j=_e(d,it),Th){ct=0;do{if(Th=!1,Uh=0,25<=ct)throw Error(p(301));ct+=1,P=O=null,_.updateQueue=null,Ph.current=$h,j=_e(d,it)}while(Th)}if(Ph.current=ai,_=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,_)throw Error(p(300));return j}function bi(){var j=Uh!==0;return Uh=0,j}function ci(){var j={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=j:P=P.next=j,P}function di(){if(O===null){var j=N.alternate;j=j!==null?j.memoizedState:null}else j=O.next;var _=P===null?N.memoizedState:P.next;if(_!==null)P=_,O=j;else{if(j===null)throw Error(p(310));O=j,j={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=j:P=P.next=j}return P}function ei(j,_){return typeof _=="function"?_(j):_}function fi(j){var _=di(),_e=_.queue;if(_e===null)throw Error(p(311));_e.lastRenderedReducer=j;var d=O,it=d.baseQueue,ct=_e.pending;if(ct!==null){if(it!==null){var pt=it.next;it.next=ct.next,ct.next=pt}d.baseQueue=it=ct,_e.pending=null}if(it!==null){ct=it.next,d=d.baseState;var At=pt=null,St=null,Ot=ct;do{var Qt=Ot.lane;if((Rh&Qt)===Qt)St!==null&&(St=St.next={lane:0,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null}),d=Ot.hasEagerState?Ot.eagerState:j(d,Ot.action);else{var Yt={lane:Qt,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null};St===null?(At=St=Yt,pt=d):St=St.next=Yt,N.lanes|=Qt,hh|=Qt}Ot=Ot.next}while(Ot!==null&&Ot!==ct);St===null?pt=d:St.next=At,He(d,_.memoizedState)||(Ug=!0),_.memoizedState=d,_.baseState=pt,_.baseQueue=St,_e.lastRenderedState=d}if(j=_e.interleaved,j!==null){it=j;do ct=it.lane,N.lanes|=ct,hh|=ct,it=it.next;while(it!==j)}else it===null&&(_e.lanes=0);return[_.memoizedState,_e.dispatch]}function gi(j){var _=di(),_e=_.queue;if(_e===null)throw Error(p(311));_e.lastRenderedReducer=j;var d=_e.dispatch,it=_e.pending,ct=_.memoizedState;if(it!==null){_e.pending=null;var pt=it=it.next;do ct=j(ct,pt.action),pt=pt.next;while(pt!==it);He(ct,_.memoizedState)||(Ug=!0),_.memoizedState=ct,_.baseQueue===null&&(_.baseState=ct),_e.lastRenderedState=ct}return[ct,d]}function hi(){}function ii(j,_){var _e=N,d=di(),it=_(),ct=!He(d.memoizedState,it);if(ct&&(d.memoizedState=it,Ug=!0),d=d.queue,ji(ki.bind(null,_e,d,j),[j]),d.getSnapshot!==_||ct||P!==null&&P.memoizedState.tag&1){if(_e.flags|=2048,li(9,mi.bind(null,_e,d,it,_),void 0,null),R===null)throw Error(p(349));Rh&30||ni(_e,_,it)}return it}function ni(j,_,_e){j.flags|=16384,j={getSnapshot:_,value:_e},_=N.updateQueue,_===null?(_={lastEffect:null,stores:null},N.updateQueue=_,_.stores=[j]):(_e=_.stores,_e===null?_.stores=[j]:_e.push(j))}function mi(j,_,_e,d){_.value=_e,_.getSnapshot=d,oi(_)&&pi(j)}function ki(j,_,_e){return _e(function(){oi(_)&&pi(j)})}function oi(j){var _=j.getSnapshot;j=j.value;try{var _e=_();return!He(j,_e)}catch{return!0}}function pi(j){var _=Zg(j,1);_!==null&&mh(_,j,1,-1)}function qi(j){var _=ci();return typeof j=="function"&&(j=j()),_.memoizedState=_.baseState=j,j={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:j},_.queue=j,j=j.dispatch=ri.bind(null,N,j),[_.memoizedState,j]}function li(j,_,_e,d){return j={tag:j,create:_,destroy:_e,deps:d,next:null},_=N.updateQueue,_===null?(_={lastEffect:null,stores:null},N.updateQueue=_,_.lastEffect=j.next=j):(_e=_.lastEffect,_e===null?_.lastEffect=j.next=j:(d=_e.next,_e.next=j,j.next=d,_.lastEffect=j)),j}function si(){return di().memoizedState}function ti(j,_,_e,d){var it=ci();N.flags|=j,it.memoizedState=li(1|_,_e,void 0,d===void 0?null:d)}function ui(j,_,_e,d){var it=di();d=d===void 0?null:d;var ct=void 0;if(O!==null){var pt=O.memoizedState;if(ct=pt.destroy,d!==null&&Wh(d,pt.deps)){it.memoizedState=li(_,_e,ct,d);return}}N.flags|=j,it.memoizedState=li(1|_,_e,ct,d)}function vi(j,_){return ti(8390656,8,j,_)}function ji(j,_){return ui(2048,8,j,_)}function wi(j,_){return ui(4,2,j,_)}function xi(j,_){return ui(4,4,j,_)}function yi(j,_){if(typeof _=="function")return j=j(),_(j),function(){_(null)};if(_!=null)return j=j(),_.current=j,function(){_.current=null}}function zi(j,_,_e){return _e=_e!=null?_e.concat([j]):null,ui(4,4,yi.bind(null,_,j),_e)}function Ai(){}function Bi(j,_){var _e=di();_=_===void 0?null:_;var d=_e.memoizedState;return d!==null&&_!==null&&Wh(_,d[1])?d[0]:(_e.memoizedState=[j,_],j)}function Ci(j,_){var _e=di();_=_===void 0?null:_;var d=_e.memoizedState;return d!==null&&_!==null&&Wh(_,d[1])?d[0]:(j=j(),_e.memoizedState=[j,_],j)}function Di(j,_,_e){return Rh&21?(He(_e,_)||(_e=yc(),N.lanes|=_e,hh|=_e,j.baseState=!0),_):(j.baseState&&(j.baseState=!1,Ug=!0),j.memoizedState=_e)}function Ei(j,_){var _e=C;C=_e!==0&&4>_e?_e:4,j(!0);var d=Qh.transition;Qh.transition={};try{j(!1),_()}finally{C=_e,Qh.transition=d}}function Fi(){return di().memoizedState}function Gi(j,_,_e){var d=lh(j);if(_e={lane:d,action:_e,hasEagerState:!1,eagerState:null,next:null},Hi(j))Ii(_,_e);else if(_e=Yg(j,_,_e,d),_e!==null){var it=L();mh(_e,j,d,it),Ji(_e,_,d)}}function ri(j,_,_e){var d=lh(j),it={lane:d,action:_e,hasEagerState:!1,eagerState:null,next:null};if(Hi(j))Ii(_,it);else{var ct=j.alternate;if(j.lanes===0&&(ct===null||ct.lanes===0)&&(ct=_.lastRenderedReducer,ct!==null))try{var pt=_.lastRenderedState,At=ct(pt,_e);if(it.hasEagerState=!0,it.eagerState=At,He(At,pt)){var St=_.interleaved;St===null?(it.next=it,Xg(_)):(it.next=St.next,St.next=it),_.interleaved=it;return}}catch{}finally{}_e=Yg(j,_,it,d),_e!==null&&(it=L(),mh(_e,j,d,it),Ji(_e,_,d))}}function Hi(j){var _=j.alternate;return j===N||_!==null&&_===N}function Ii(j,_){Th=Sh=!0;var _e=j.pending;_e===null?_.next=_:(_.next=_e.next,_e.next=_),j.pending=_}function Ji(j,_,_e){if(_e&4194240){var d=_.lanes;d&=j.pendingLanes,_e|=d,_.lanes=_e,Cc(j,_e)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(j,_){return ci().memoizedState=[j,_===void 0?null:_],j},useContext:Vg,useEffect:vi,useImperativeHandle:function(j,_,_e){return _e=_e!=null?_e.concat([j]):null,ti(4194308,4,yi.bind(null,_,j),_e)},useLayoutEffect:function(j,_){return ti(4194308,4,j,_)},useInsertionEffect:function(j,_){return ti(4,2,j,_)},useMemo:function(j,_){var _e=ci();return _=_===void 0?null:_,j=j(),_e.memoizedState=[j,_],j},useReducer:function(j,_,_e){var d=ci();return _=_e!==void 0?_e(_):_,d.memoizedState=d.baseState=_,j={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:j,lastRenderedState:_},d.queue=j,j=j.dispatch=Gi.bind(null,N,j),[d.memoizedState,j]},useRef:function(j){var _=ci();return j={current:j},_.memoizedState=j},useState:qi,useDebugValue:Ai,useDeferredValue:function(j){return ci().memoizedState=j},useTransition:function(){var j=qi(!1),_=j[0];return j=Ei.bind(null,j[1]),ci().memoizedState=j,[_,j]},useMutableSource:function(){},useSyncExternalStore:function(j,_,_e){var d=N,it=ci();if(I){if(_e===void 0)throw Error(p(407));_e=_e()}else{if(_e=_(),R===null)throw Error(p(349));Rh&30||ni(d,_,_e)}it.memoizedState=_e;var ct={value:_e,getSnapshot:_};return it.queue=ct,vi(ki.bind(null,d,ct,j),[j]),d.flags|=2048,li(9,mi.bind(null,d,ct,_e,_),void 0,null),_e},useId:function(){var j=ci(),_=R.identifierPrefix;if(I){var _e=sg,d=rg;_e=(d&~(1<<32-oc(d)-1)).toString(32)+_e,_=":"+_+"R"+_e,_e=Uh++,0<_e&&(_+="H"+_e.toString(32)),_+=":"}else _e=Vh++,_=":"+_+"r"+_e.toString(32)+":";return j.memoizedState=_},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(j){var _=di();return Di(_,O.memoizedState,j)},useTransition:function(){var j=fi(ei)[0],_=di().memoizedState;return[j,_]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(j){var _=di();return O===null?_.memoizedState=j:Di(_,O.memoizedState,j)},useTransition:function(){var j=gi(ei)[0],_=di().memoizedState;return[j,_]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(j,_){try{var _e="",d=_;do _e+=Pa(d),d=d.return;while(d);var it=_e}catch(ct){it=`
Error generating stack: `+ct.message+`
`+ct.stack}return{value:j,source:_,stack:it,digest:null}}function Li(j,_,_e){return{value:j,source:null,stack:_e??null,digest:_??null}}function Mi(j,_){try{console.error(_.value)}catch(_e){setTimeout(function(){throw _e})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(j,_,_e){_e=ch(-1,_e),_e.tag=3,_e.payload={element:null};var d=_.value;return _e.callback=function(){Pi||(Pi=!0,Qi=d),Mi(j,_)},_e}function Ri(j,_,_e){_e=ch(-1,_e),_e.tag=3;var d=j.type.getDerivedStateFromError;if(typeof d=="function"){var it=_.value;_e.payload=function(){return d(it)},_e.callback=function(){Mi(j,_)}}var ct=j.stateNode;return ct!==null&&typeof ct.componentDidCatch=="function"&&(_e.callback=function(){Mi(j,_),typeof d!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var pt=_.stack;this.componentDidCatch(_.value,{componentStack:pt!==null?pt:""})}),_e}function Ti(j,_,_e){var d=j.pingCache;if(d===null){d=j.pingCache=new Ni;var it=new Set;d.set(_,it)}else it=d.get(_),it===void 0&&(it=new Set,d.set(_,it));it.has(_e)||(it.add(_e),j=Ui.bind(null,j,_,_e),_.then(j,j))}function Vi(j){do{var _;if((_=j.tag===13)&&(_=j.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return j;j=j.return}while(j!==null);return null}function Wi(j,_,_e,d,it){return j.mode&1?(j.flags|=65536,j.lanes=it,j):(j===_?j.flags|=65536:(j.flags|=128,_e.flags|=131072,_e.flags&=-52805,_e.tag===1&&(_e.alternate===null?_e.tag=17:(_=ch(-1,1),_.tag=2,dh(_e,_,1))),_e.lanes|=1),j)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(j,_,_e,d){_.child=j===null?Ch(_,null,_e,d):Bh(_,j.child,_e,d)}function Zi(j,_,_e,d,it){_e=_e.render;var ct=_.ref;return Tg(_,it),d=Xh(j,_,_e,d,ct,it),_e=bi(),j!==null&&!Ug?(_.updateQueue=j.updateQueue,_.flags&=-2053,j.lanes&=~it,$i(j,_,it)):(I&&_e&&vg(_),_.flags|=1,Yi(j,_,d,it),_.child)}function aj(j,_,_e,d,it){if(j===null){var ct=_e.type;return typeof ct=="function"&&!bj(ct)&&ct.defaultProps===void 0&&_e.compare===null&&_e.defaultProps===void 0?(_.tag=15,_.type=ct,cj(j,_,ct,d,it)):(j=yh(_e.type,null,d,_,_.mode,it),j.ref=_.ref,j.return=_,_.child=j)}if(ct=j.child,!(j.lanes&it)){var pt=ct.memoizedProps;if(_e=_e.compare,_e=_e!==null?_e:Ie,_e(pt,d)&&j.ref===_.ref)return $i(j,_,it)}return _.flags|=1,j=wh(ct,d),j.ref=_.ref,j.return=_,_.child=j}function cj(j,_,_e,d,it){if(j!==null){var ct=j.memoizedProps;if(Ie(ct,d)&&j.ref===_.ref)if(Ug=!1,_.pendingProps=d=ct,(j.lanes&it)!==0)j.flags&131072&&(Ug=!0);else return _.lanes=j.lanes,$i(j,_,it)}return dj(j,_,_e,d,it)}function ej(j,_,_e){var d=_.pendingProps,it=d.children,ct=j!==null?j.memoizedState:null;if(d.mode==="hidden")if(!(_.mode&1))_.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=_e;else{if(!(_e&1073741824))return j=ct!==null?ct.baseLanes|_e:_e,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:j,cachePool:null,transitions:null},_.updateQueue=null,G(fj,gj),gj|=j,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=ct!==null?ct.baseLanes:_e,G(fj,gj),gj|=d}else ct!==null?(d=ct.baseLanes|_e,_.memoizedState=null):d=_e,G(fj,gj),gj|=d;return Yi(j,_,it,_e),_.child}function hj(j,_){var _e=_.ref;(j===null&&_e!==null||j!==null&&j.ref!==_e)&&(_.flags|=512,_.flags|=2097152)}function dj(j,_,_e,d,it){var ct=Zf(_e)?Xf:H.current;return ct=Yf(_,ct),Tg(_,it),_e=Xh(j,_,_e,d,ct,it),d=bi(),j!==null&&!Ug?(_.updateQueue=j.updateQueue,_.flags&=-2053,j.lanes&=~it,$i(j,_,it)):(I&&d&&vg(_),_.flags|=1,Yi(j,_,_e,it),_.child)}function ij(j,_,_e,d,it){if(Zf(_e)){var ct=!0;cg(_)}else ct=!1;if(Tg(_,it),_.stateNode===null)jj(j,_),ph(_,_e,d),rh(_,_e,d,it),d=!0;else if(j===null){var pt=_.stateNode,At=_.memoizedProps;pt.props=At;var St=pt.context,Ot=_e.contextType;typeof Ot=="object"&&Ot!==null?Ot=Vg(Ot):(Ot=Zf(_e)?Xf:H.current,Ot=Yf(_,Ot));var Qt=_e.getDerivedStateFromProps,Yt=typeof Qt=="function"||typeof pt.getSnapshotBeforeUpdate=="function";Yt||typeof pt.UNSAFE_componentWillReceiveProps!="function"&&typeof pt.componentWillReceiveProps!="function"||(At!==d||St!==Ot)&&qh(_,pt,d,Ot),$g=!1;var Vt=_.memoizedState;pt.state=Vt,gh(_,d,pt,it),St=_.memoizedState,At!==d||Vt!==St||Wf.current||$g?(typeof Qt=="function"&&(kh(_,_e,Qt,d),St=_.memoizedState),(At=$g||oh(_,_e,At,d,Vt,St,Ot))?(Yt||typeof pt.UNSAFE_componentWillMount!="function"&&typeof pt.componentWillMount!="function"||(typeof pt.componentWillMount=="function"&&pt.componentWillMount(),typeof pt.UNSAFE_componentWillMount=="function"&&pt.UNSAFE_componentWillMount()),typeof pt.componentDidMount=="function"&&(_.flags|=4194308)):(typeof pt.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=d,_.memoizedState=St),pt.props=d,pt.state=St,pt.context=Ot,d=At):(typeof pt.componentDidMount=="function"&&(_.flags|=4194308),d=!1)}else{pt=_.stateNode,bh(j,_),At=_.memoizedProps,Ot=_.type===_.elementType?At:Lg(_.type,At),pt.props=Ot,Yt=_.pendingProps,Vt=pt.context,St=_e.contextType,typeof St=="object"&&St!==null?St=Vg(St):(St=Zf(_e)?Xf:H.current,St=Yf(_,St));var qt=_e.getDerivedStateFromProps;(Qt=typeof qt=="function"||typeof pt.getSnapshotBeforeUpdate=="function")||typeof pt.UNSAFE_componentWillReceiveProps!="function"&&typeof pt.componentWillReceiveProps!="function"||(At!==Yt||Vt!==St)&&qh(_,pt,d,St),$g=!1,Vt=_.memoizedState,pt.state=Vt,gh(_,d,pt,it);var Jt=_.memoizedState;At!==Yt||Vt!==Jt||Wf.current||$g?(typeof qt=="function"&&(kh(_,_e,qt,d),Jt=_.memoizedState),(Ot=$g||oh(_,_e,Ot,d,Vt,Jt,St)||!1)?(Qt||typeof pt.UNSAFE_componentWillUpdate!="function"&&typeof pt.componentWillUpdate!="function"||(typeof pt.componentWillUpdate=="function"&&pt.componentWillUpdate(d,Jt,St),typeof pt.UNSAFE_componentWillUpdate=="function"&&pt.UNSAFE_componentWillUpdate(d,Jt,St)),typeof pt.componentDidUpdate=="function"&&(_.flags|=4),typeof pt.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof pt.componentDidUpdate!="function"||At===j.memoizedProps&&Vt===j.memoizedState||(_.flags|=4),typeof pt.getSnapshotBeforeUpdate!="function"||At===j.memoizedProps&&Vt===j.memoizedState||(_.flags|=1024),_.memoizedProps=d,_.memoizedState=Jt),pt.props=d,pt.state=Jt,pt.context=St,d=Ot):(typeof pt.componentDidUpdate!="function"||At===j.memoizedProps&&Vt===j.memoizedState||(_.flags|=4),typeof pt.getSnapshotBeforeUpdate!="function"||At===j.memoizedProps&&Vt===j.memoizedState||(_.flags|=1024),d=!1)}return kj(j,_,_e,d,ct,it)}function kj(j,_,_e,d,it,ct){hj(j,_);var pt=(_.flags&128)!==0;if(!d&&!pt)return it&&dg(_,_e,!1),$i(j,_,ct);d=_.stateNode,Xi.current=_;var At=pt&&typeof _e.getDerivedStateFromError!="function"?null:d.render();return _.flags|=1,j!==null&&pt?(_.child=Bh(_,j.child,null,ct),_.child=Bh(_,null,At,ct)):Yi(j,_,At,ct),_.memoizedState=d.state,it&&dg(_,_e,!0),_.child}function lj(j){var _=j.stateNode;_.pendingContext?ag(j,_.pendingContext,_.pendingContext!==_.context):_.context&&ag(j,_.context,!1),Ih(j,_.containerInfo)}function mj(j,_,_e,d,it){return Ig(),Jg(it),_.flags|=256,Yi(j,_,_e,d),_.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(j){return{baseLanes:j,cachePool:null,transitions:null}}function pj(j,_,_e){var d=_.pendingProps,it=M.current,ct=!1,pt=(_.flags&128)!==0,At;if((At=pt)||(At=j!==null&&j.memoizedState===null?!1:(it&2)!==0),At?(ct=!0,_.flags&=-129):(j===null||j.memoizedState!==null)&&(it|=1),G(M,it&1),j===null)return Eg(_),j=_.memoizedState,j!==null&&(j=j.dehydrated,j!==null)?(_.mode&1?j.data==="$!"?_.lanes=8:_.lanes=1073741824:_.lanes=1,null):(pt=d.children,j=d.fallback,ct?(d=_.mode,ct=_.child,pt={mode:"hidden",children:pt},!(d&1)&&ct!==null?(ct.childLanes=0,ct.pendingProps=pt):ct=qj(pt,d,0,null),j=Ah(j,d,_e,null),ct.return=_,j.return=_,ct.sibling=j,_.child=ct,_.child.memoizedState=oj(_e),_.memoizedState=nj,j):rj(_,pt));if(it=j.memoizedState,it!==null&&(At=it.dehydrated,At!==null))return sj(j,_,pt,d,At,it,_e);if(ct){ct=d.fallback,pt=_.mode,it=j.child,At=it.sibling;var St={mode:"hidden",children:d.children};return!(pt&1)&&_.child!==it?(d=_.child,d.childLanes=0,d.pendingProps=St,_.deletions=null):(d=wh(it,St),d.subtreeFlags=it.subtreeFlags&14680064),At!==null?ct=wh(At,ct):(ct=Ah(ct,pt,_e,null),ct.flags|=2),ct.return=_,d.return=_,d.sibling=ct,_.child=d,d=ct,ct=_.child,pt=j.child.memoizedState,pt=pt===null?oj(_e):{baseLanes:pt.baseLanes|_e,cachePool:null,transitions:pt.transitions},ct.memoizedState=pt,ct.childLanes=j.childLanes&~_e,_.memoizedState=nj,d}return ct=j.child,j=ct.sibling,d=wh(ct,{mode:"visible",children:d.children}),!(_.mode&1)&&(d.lanes=_e),d.return=_,d.sibling=null,j!==null&&(_e=_.deletions,_e===null?(_.deletions=[j],_.flags|=16):_e.push(j)),_.child=d,_.memoizedState=null,d}function rj(j,_){return _=qj({mode:"visible",children:_},j.mode,0,null),_.return=j,j.child=_}function tj(j,_,_e,d){return d!==null&&Jg(d),Bh(_,j.child,null,_e),j=rj(_,_.pendingProps.children),j.flags|=2,_.memoizedState=null,j}function sj(j,_,_e,d,it,ct,pt){if(_e)return _.flags&256?(_.flags&=-257,d=Li(Error(p(422))),tj(j,_,pt,d)):_.memoizedState!==null?(_.child=j.child,_.flags|=128,null):(ct=d.fallback,it=_.mode,d=qj({mode:"visible",children:d.children},it,0,null),ct=Ah(ct,it,pt,null),ct.flags|=2,d.return=_,ct.return=_,d.sibling=ct,_.child=d,_.mode&1&&Bh(_,j.child,null,pt),_.child.memoizedState=oj(pt),_.memoizedState=nj,ct);if(!(_.mode&1))return tj(j,_,pt,null);if(it.data==="$!"){if(d=it.nextSibling&&it.nextSibling.dataset,d)var At=d.dgst;return d=At,ct=Error(p(419)),d=Li(ct,d,void 0),tj(j,_,pt,d)}if(At=(pt&j.childLanes)!==0,Ug||At){if(d=R,d!==null){switch(pt&-pt){case 4:it=2;break;case 16:it=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:it=32;break;case 536870912:it=268435456;break;default:it=0}it=it&(d.suspendedLanes|pt)?0:it,it!==0&&it!==ct.retryLane&&(ct.retryLane=it,Zg(j,it),mh(d,j,it,-1))}return uj(),d=Li(Error(p(421))),tj(j,_,pt,d)}return it.data==="$?"?(_.flags|=128,_.child=j.child,_=vj.bind(null,j),it._reactRetry=_,null):(j=ct.treeContext,yg=Lf(it.nextSibling),xg=_,I=!0,zg=null,j!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=j.id,sg=j.overflow,qg=_),_=rj(_,d.children),_.flags|=4096,_)}function wj(j,_,_e){j.lanes|=_;var d=j.alternate;d!==null&&(d.lanes|=_),Sg(j.return,_,_e)}function xj(j,_,_e,d,it){var ct=j.memoizedState;ct===null?j.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:d,tail:_e,tailMode:it}:(ct.isBackwards=_,ct.rendering=null,ct.renderingStartTime=0,ct.last=d,ct.tail=_e,ct.tailMode=it)}function yj(j,_,_e){var d=_.pendingProps,it=d.revealOrder,ct=d.tail;if(Yi(j,_,d.children,_e),d=M.current,d&2)d=d&1|2,_.flags|=128;else{if(j!==null&&j.flags&128)e:for(j=_.child;j!==null;){if(j.tag===13)j.memoizedState!==null&&wj(j,_e,_);else if(j.tag===19)wj(j,_e,_);else if(j.child!==null){j.child.return=j,j=j.child;continue}if(j===_)break e;for(;j.sibling===null;){if(j.return===null||j.return===_)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}d&=1}if(G(M,d),!(_.mode&1))_.memoizedState=null;else switch(it){case"forwards":for(_e=_.child,it=null;_e!==null;)j=_e.alternate,j!==null&&Mh(j)===null&&(it=_e),_e=_e.sibling;_e=it,_e===null?(it=_.child,_.child=null):(it=_e.sibling,_e.sibling=null),xj(_,!1,it,_e,ct);break;case"backwards":for(_e=null,it=_.child,_.child=null;it!==null;){if(j=it.alternate,j!==null&&Mh(j)===null){_.child=it;break}j=it.sibling,it.sibling=_e,_e=it,it=j}xj(_,!0,_e,null,ct);break;case"together":xj(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function jj(j,_){!(_.mode&1)&&j!==null&&(j.alternate=null,_.alternate=null,_.flags|=2)}function $i(j,_,_e){if(j!==null&&(_.dependencies=j.dependencies),hh|=_.lanes,!(_e&_.childLanes))return null;if(j!==null&&_.child!==j.child)throw Error(p(153));if(_.child!==null){for(j=_.child,_e=wh(j,j.pendingProps),_.child=_e,_e.return=_;j.sibling!==null;)j=j.sibling,_e=_e.sibling=wh(j,j.pendingProps),_e.return=_;_e.sibling=null}return _.child}function zj(j,_,_e){switch(_.tag){case 3:lj(_),Ig();break;case 5:Kh(_);break;case 1:Zf(_.type)&&cg(_);break;case 4:Ih(_,_.stateNode.containerInfo);break;case 10:var d=_.type._context,it=_.memoizedProps.value;G(Mg,d._currentValue),d._currentValue=it;break;case 13:if(d=_.memoizedState,d!==null)return d.dehydrated!==null?(G(M,M.current&1),_.flags|=128,null):_e&_.child.childLanes?pj(j,_,_e):(G(M,M.current&1),j=$i(j,_,_e),j!==null?j.sibling:null);G(M,M.current&1);break;case 19:if(d=(_e&_.childLanes)!==0,j.flags&128){if(d)return yj(j,_,_e);_.flags|=128}if(it=_.memoizedState,it!==null&&(it.rendering=null,it.tail=null,it.lastEffect=null),G(M,M.current),d)break;return null;case 22:case 23:return _.lanes=0,ej(j,_,_e)}return $i(j,_,_e)}var Aj,Bj,Cj,Dj;Aj=function(j,_){for(var _e=_.child;_e!==null;){if(_e.tag===5||_e.tag===6)j.appendChild(_e.stateNode);else if(_e.tag!==4&&_e.child!==null){_e.child.return=_e,_e=_e.child;continue}if(_e===_)break;for(;_e.sibling===null;){if(_e.return===null||_e.return===_)return;_e=_e.return}_e.sibling.return=_e.return,_e=_e.sibling}};Bj=function(){};Cj=function(j,_,_e,d){var it=j.memoizedProps;if(it!==d){j=_.stateNode,Hh(Eh.current);var ct=null;switch(_e){case"input":it=Ya(j,it),d=Ya(j,d),ct=[];break;case"select":it=A({},it,{value:void 0}),d=A({},d,{value:void 0}),ct=[];break;case"textarea":it=gb(j,it),d=gb(j,d),ct=[];break;default:typeof it.onClick!="function"&&typeof d.onClick=="function"&&(j.onclick=Bf)}ub(_e,d);var pt;_e=null;for(Ot in it)if(!d.hasOwnProperty(Ot)&&it.hasOwnProperty(Ot)&&it[Ot]!=null)if(Ot==="style"){var At=it[Ot];for(pt in At)At.hasOwnProperty(pt)&&(_e||(_e={}),_e[pt]="")}else Ot!=="dangerouslySetInnerHTML"&&Ot!=="children"&&Ot!=="suppressContentEditableWarning"&&Ot!=="suppressHydrationWarning"&&Ot!=="autoFocus"&&(ea.hasOwnProperty(Ot)?ct||(ct=[]):(ct=ct||[]).push(Ot,null));for(Ot in d){var St=d[Ot];if(At=it!=null?it[Ot]:void 0,d.hasOwnProperty(Ot)&&St!==At&&(St!=null||At!=null))if(Ot==="style")if(At){for(pt in At)!At.hasOwnProperty(pt)||St&&St.hasOwnProperty(pt)||(_e||(_e={}),_e[pt]="");for(pt in St)St.hasOwnProperty(pt)&&At[pt]!==St[pt]&&(_e||(_e={}),_e[pt]=St[pt])}else _e||(ct||(ct=[]),ct.push(Ot,_e)),_e=St;else Ot==="dangerouslySetInnerHTML"?(St=St?St.__html:void 0,At=At?At.__html:void 0,St!=null&&At!==St&&(ct=ct||[]).push(Ot,St)):Ot==="children"?typeof St!="string"&&typeof St!="number"||(ct=ct||[]).push(Ot,""+St):Ot!=="suppressContentEditableWarning"&&Ot!=="suppressHydrationWarning"&&(ea.hasOwnProperty(Ot)?(St!=null&&Ot==="onScroll"&&D("scroll",j),ct||At===St||(ct=[])):(ct=ct||[]).push(Ot,St))}_e&&(ct=ct||[]).push("style",_e);var Ot=ct;(_.updateQueue=Ot)&&(_.flags|=4)}};Dj=function(j,_,_e,d){_e!==d&&(_.flags|=4)};function Ej(j,_){if(!I)switch(j.tailMode){case"hidden":_=j.tail;for(var _e=null;_!==null;)_.alternate!==null&&(_e=_),_=_.sibling;_e===null?j.tail=null:_e.sibling=null;break;case"collapsed":_e=j.tail;for(var d=null;_e!==null;)_e.alternate!==null&&(d=_e),_e=_e.sibling;d===null?_||j.tail===null?j.tail=null:j.tail.sibling=null:d.sibling=null}}function S(j){var _=j.alternate!==null&&j.alternate.child===j.child,_e=0,d=0;if(_)for(var it=j.child;it!==null;)_e|=it.lanes|it.childLanes,d|=it.subtreeFlags&14680064,d|=it.flags&14680064,it.return=j,it=it.sibling;else for(it=j.child;it!==null;)_e|=it.lanes|it.childLanes,d|=it.subtreeFlags,d|=it.flags,it.return=j,it=it.sibling;return j.subtreeFlags|=d,j.childLanes=_e,_}function Fj(j,_,_e){var d=_.pendingProps;switch(wg(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(_),null;case 1:return Zf(_.type)&&$f(),S(_),null;case 3:return d=_.stateNode,Jh(),E(Wf),E(H),Oh(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(j===null||j.child===null)&&(Gg(_)?_.flags|=4:j===null||j.memoizedState.isDehydrated&&!(_.flags&256)||(_.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(j,_),S(_),null;case 5:Lh(_);var it=Hh(Gh.current);if(_e=_.type,j!==null&&_.stateNode!=null)Cj(j,_,_e,d,it),j.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!d){if(_.stateNode===null)throw Error(p(166));return S(_),null}if(j=Hh(Eh.current),Gg(_)){d=_.stateNode,_e=_.type;var ct=_.memoizedProps;switch(d[Of]=_,d[Pf]=ct,j=(_.mode&1)!==0,_e){case"dialog":D("cancel",d),D("close",d);break;case"iframe":case"object":case"embed":D("load",d);break;case"video":case"audio":for(it=0;it<lf.length;it++)D(lf[it],d);break;case"source":D("error",d);break;case"img":case"image":case"link":D("error",d),D("load",d);break;case"details":D("toggle",d);break;case"input":Za(d,ct),D("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!ct.multiple},D("invalid",d);break;case"textarea":hb(d,ct),D("invalid",d)}ub(_e,ct),it=null;for(var pt in ct)if(ct.hasOwnProperty(pt)){var At=ct[pt];pt==="children"?typeof At=="string"?d.textContent!==At&&(ct.suppressHydrationWarning!==!0&&Af(d.textContent,At,j),it=["children",At]):typeof At=="number"&&d.textContent!==""+At&&(ct.suppressHydrationWarning!==!0&&Af(d.textContent,At,j),it=["children",""+At]):ea.hasOwnProperty(pt)&&At!=null&&pt==="onScroll"&&D("scroll",d)}switch(_e){case"input":Va(d),db(d,ct,!0);break;case"textarea":Va(d),jb(d);break;case"select":case"option":break;default:typeof ct.onClick=="function"&&(d.onclick=Bf)}d=it,_.updateQueue=d,d!==null&&(_.flags|=4)}else{pt=it.nodeType===9?it:it.ownerDocument,j==="http://www.w3.org/1999/xhtml"&&(j=kb(_e)),j==="http://www.w3.org/1999/xhtml"?_e==="script"?(j=pt.createElement("div"),j.innerHTML="<script><\/script>",j=j.removeChild(j.firstChild)):typeof d.is=="string"?j=pt.createElement(_e,{is:d.is}):(j=pt.createElement(_e),_e==="select"&&(pt=j,d.multiple?pt.multiple=!0:d.size&&(pt.size=d.size))):j=pt.createElementNS(j,_e),j[Of]=_,j[Pf]=d,Aj(j,_,!1,!1),_.stateNode=j;e:{switch(pt=vb(_e,d),_e){case"dialog":D("cancel",j),D("close",j),it=d;break;case"iframe":case"object":case"embed":D("load",j),it=d;break;case"video":case"audio":for(it=0;it<lf.length;it++)D(lf[it],j);it=d;break;case"source":D("error",j),it=d;break;case"img":case"image":case"link":D("error",j),D("load",j),it=d;break;case"details":D("toggle",j),it=d;break;case"input":Za(j,d),it=Ya(j,d),D("invalid",j);break;case"option":it=d;break;case"select":j._wrapperState={wasMultiple:!!d.multiple},it=A({},d,{value:void 0}),D("invalid",j);break;case"textarea":hb(j,d),it=gb(j,d),D("invalid",j);break;default:it=d}ub(_e,it),At=it;for(ct in At)if(At.hasOwnProperty(ct)){var St=At[ct];ct==="style"?sb(j,St):ct==="dangerouslySetInnerHTML"?(St=St?St.__html:void 0,St!=null&&nb(j,St)):ct==="children"?typeof St=="string"?(_e!=="textarea"||St!=="")&&ob(j,St):typeof St=="number"&&ob(j,""+St):ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&ct!=="autoFocus"&&(ea.hasOwnProperty(ct)?St!=null&&ct==="onScroll"&&D("scroll",j):St!=null&&ta(j,ct,St,pt))}switch(_e){case"input":Va(j),db(j,d,!1);break;case"textarea":Va(j),jb(j);break;case"option":d.value!=null&&j.setAttribute("value",""+Sa(d.value));break;case"select":j.multiple=!!d.multiple,ct=d.value,ct!=null?fb(j,!!d.multiple,ct,!1):d.defaultValue!=null&&fb(j,!!d.multiple,d.defaultValue,!0);break;default:typeof it.onClick=="function"&&(j.onclick=Bf)}switch(_e){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return S(_),null;case 6:if(j&&_.stateNode!=null)Dj(j,_,j.memoizedProps,d);else{if(typeof d!="string"&&_.stateNode===null)throw Error(p(166));if(_e=Hh(Gh.current),Hh(Eh.current),Gg(_)){if(d=_.stateNode,_e=_.memoizedProps,d[Of]=_,(ct=d.nodeValue!==_e)&&(j=xg,j!==null))switch(j.tag){case 3:Af(d.nodeValue,_e,(j.mode&1)!==0);break;case 5:j.memoizedProps.suppressHydrationWarning!==!0&&Af(d.nodeValue,_e,(j.mode&1)!==0)}ct&&(_.flags|=4)}else d=(_e.nodeType===9?_e:_e.ownerDocument).createTextNode(d),d[Of]=_,_.stateNode=d}return S(_),null;case 13:if(E(M),d=_.memoizedState,j===null||j.memoizedState!==null&&j.memoizedState.dehydrated!==null){if(I&&yg!==null&&_.mode&1&&!(_.flags&128))Hg(),Ig(),_.flags|=98560,ct=!1;else if(ct=Gg(_),d!==null&&d.dehydrated!==null){if(j===null){if(!ct)throw Error(p(318));if(ct=_.memoizedState,ct=ct!==null?ct.dehydrated:null,!ct)throw Error(p(317));ct[Of]=_}else Ig(),!(_.flags&128)&&(_.memoizedState=null),_.flags|=4;S(_),ct=!1}else zg!==null&&(Gj(zg),zg=null),ct=!0;if(!ct)return _.flags&65536?_:null}return _.flags&128?(_.lanes=_e,_):(d=d!==null,d!==(j!==null&&j.memoizedState!==null)&&d&&(_.child.flags|=8192,_.mode&1&&(j===null||M.current&1?T===0&&(T=3):uj())),_.updateQueue!==null&&(_.flags|=4),S(_),null);case 4:return Jh(),Bj(j,_),j===null&&sf(_.stateNode.containerInfo),S(_),null;case 10:return Rg(_.type._context),S(_),null;case 17:return Zf(_.type)&&$f(),S(_),null;case 19:if(E(M),ct=_.memoizedState,ct===null)return S(_),null;if(d=(_.flags&128)!==0,pt=ct.rendering,pt===null)if(d)Ej(ct,!1);else{if(T!==0||j!==null&&j.flags&128)for(j=_.child;j!==null;){if(pt=Mh(j),pt!==null){for(_.flags|=128,Ej(ct,!1),d=pt.updateQueue,d!==null&&(_.updateQueue=d,_.flags|=4),_.subtreeFlags=0,d=_e,_e=_.child;_e!==null;)ct=_e,j=d,ct.flags&=14680066,pt=ct.alternate,pt===null?(ct.childLanes=0,ct.lanes=j,ct.child=null,ct.subtreeFlags=0,ct.memoizedProps=null,ct.memoizedState=null,ct.updateQueue=null,ct.dependencies=null,ct.stateNode=null):(ct.childLanes=pt.childLanes,ct.lanes=pt.lanes,ct.child=pt.child,ct.subtreeFlags=0,ct.deletions=null,ct.memoizedProps=pt.memoizedProps,ct.memoizedState=pt.memoizedState,ct.updateQueue=pt.updateQueue,ct.type=pt.type,j=pt.dependencies,ct.dependencies=j===null?null:{lanes:j.lanes,firstContext:j.firstContext}),_e=_e.sibling;return G(M,M.current&1|2),_.child}j=j.sibling}ct.tail!==null&&B()>Hj&&(_.flags|=128,d=!0,Ej(ct,!1),_.lanes=4194304)}else{if(!d)if(j=Mh(pt),j!==null){if(_.flags|=128,d=!0,_e=j.updateQueue,_e!==null&&(_.updateQueue=_e,_.flags|=4),Ej(ct,!0),ct.tail===null&&ct.tailMode==="hidden"&&!pt.alternate&&!I)return S(_),null}else 2*B()-ct.renderingStartTime>Hj&&_e!==1073741824&&(_.flags|=128,d=!0,Ej(ct,!1),_.lanes=4194304);ct.isBackwards?(pt.sibling=_.child,_.child=pt):(_e=ct.last,_e!==null?_e.sibling=pt:_.child=pt,ct.last=pt)}return ct.tail!==null?(_=ct.tail,ct.rendering=_,ct.tail=_.sibling,ct.renderingStartTime=B(),_.sibling=null,_e=M.current,G(M,d?_e&1|2:_e&1),_):(S(_),null);case 22:case 23:return Ij(),d=_.memoizedState!==null,j!==null&&j.memoizedState!==null!==d&&(_.flags|=8192),d&&_.mode&1?gj&1073741824&&(S(_),_.subtreeFlags&6&&(_.flags|=8192)):S(_),null;case 24:return null;case 25:return null}throw Error(p(156,_.tag))}function Jj(j,_){switch(wg(_),_.tag){case 1:return Zf(_.type)&&$f(),j=_.flags,j&65536?(_.flags=j&-65537|128,_):null;case 3:return Jh(),E(Wf),E(H),Oh(),j=_.flags,j&65536&&!(j&128)?(_.flags=j&-65537|128,_):null;case 5:return Lh(_),null;case 13:if(E(M),j=_.memoizedState,j!==null&&j.dehydrated!==null){if(_.alternate===null)throw Error(p(340));Ig()}return j=_.flags,j&65536?(_.flags=j&-65537|128,_):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(_.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj(j,_){var _e=j.ref;if(_e!==null)if(typeof _e=="function")try{_e(null)}catch(d){W(j,_,d)}else _e.current=null}function Nj(j,_,_e){try{_e()}catch(d){W(j,_,d)}}var Oj=!1;function Pj(j,_){if(Cf=dd,j=Me(),Ne(j)){if("selectionStart"in j)var _e={start:j.selectionStart,end:j.selectionEnd};else e:{_e=(_e=j.ownerDocument)&&_e.defaultView||window;var d=_e.getSelection&&_e.getSelection();if(d&&d.rangeCount!==0){_e=d.anchorNode;var it=d.anchorOffset,ct=d.focusNode;d=d.focusOffset;try{_e.nodeType,ct.nodeType}catch{_e=null;break e}var pt=0,At=-1,St=-1,Ot=0,Qt=0,Yt=j,Vt=null;t:for(;;){for(var qt;Yt!==_e||it!==0&&Yt.nodeType!==3||(At=pt+it),Yt!==ct||d!==0&&Yt.nodeType!==3||(St=pt+d),Yt.nodeType===3&&(pt+=Yt.nodeValue.length),(qt=Yt.firstChild)!==null;)Vt=Yt,Yt=qt;for(;;){if(Yt===j)break t;if(Vt===_e&&++Ot===it&&(At=pt),Vt===ct&&++Qt===d&&(St=pt),(qt=Yt.nextSibling)!==null)break;Yt=Vt,Vt=Yt.parentNode}Yt=qt}_e=At===-1||St===-1?null:{start:At,end:St}}else _e=null}_e=_e||{start:0,end:0}}else _e=null;for(Df={focusedElem:j,selectionRange:_e},dd=!1,V=_;V!==null;)if(_=V,j=_.child,(_.subtreeFlags&1028)!==0&&j!==null)j.return=_,V=j;else for(;V!==null;){_=V;try{var Jt=_.alternate;if(_.flags&1024)switch(_.tag){case 0:case 11:case 15:break;case 1:if(Jt!==null){var jt=Jt.memoizedProps,sn=Jt.memoizedState,Ft=_.stateNode,Ut=Ft.getSnapshotBeforeUpdate(_.elementType===_.type?jt:Lg(_.type,jt),sn);Ft.__reactInternalSnapshotBeforeUpdate=Ut}break;case 3:var Ht=_.stateNode.containerInfo;Ht.nodeType===1?Ht.textContent="":Ht.nodeType===9&&Ht.documentElement&&Ht.removeChild(Ht.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(an){W(_,_.return,an)}if(j=_.sibling,j!==null){j.return=_.return,V=j;break}V=_.return}return Jt=Oj,Oj=!1,Jt}function Qj(j,_,_e){var d=_.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var it=d=d.next;do{if((it.tag&j)===j){var ct=it.destroy;it.destroy=void 0,ct!==void 0&&Nj(_,_e,ct)}it=it.next}while(it!==d)}}function Rj(j,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var _e=_=_.next;do{if((_e.tag&j)===j){var d=_e.create;_e.destroy=d()}_e=_e.next}while(_e!==_)}}function Sj(j){var _=j.ref;if(_!==null){var _e=j.stateNode;switch(j.tag){case 5:j=_e;break;default:j=_e}typeof _=="function"?_(j):_.current=j}}function Tj(j){var _=j.alternate;_!==null&&(j.alternate=null,Tj(_)),j.child=null,j.deletions=null,j.sibling=null,j.tag===5&&(_=j.stateNode,_!==null&&(delete _[Of],delete _[Pf],delete _[of],delete _[Qf],delete _[Rf])),j.stateNode=null,j.return=null,j.dependencies=null,j.memoizedProps=null,j.memoizedState=null,j.pendingProps=null,j.stateNode=null,j.updateQueue=null}function Uj(j){return j.tag===5||j.tag===3||j.tag===4}function Vj(j){e:for(;;){for(;j.sibling===null;){if(j.return===null||Uj(j.return))return null;j=j.return}for(j.sibling.return=j.return,j=j.sibling;j.tag!==5&&j.tag!==6&&j.tag!==18;){if(j.flags&2||j.child===null||j.tag===4)continue e;j.child.return=j,j=j.child}if(!(j.flags&2))return j.stateNode}}function Wj(j,_,_e){var d=j.tag;if(d===5||d===6)j=j.stateNode,_?_e.nodeType===8?_e.parentNode.insertBefore(j,_):_e.insertBefore(j,_):(_e.nodeType===8?(_=_e.parentNode,_.insertBefore(j,_e)):(_=_e,_.appendChild(j)),_e=_e._reactRootContainer,_e!=null||_.onclick!==null||(_.onclick=Bf));else if(d!==4&&(j=j.child,j!==null))for(Wj(j,_,_e),j=j.sibling;j!==null;)Wj(j,_,_e),j=j.sibling}function Xj(j,_,_e){var d=j.tag;if(d===5||d===6)j=j.stateNode,_?_e.insertBefore(j,_):_e.appendChild(j);else if(d!==4&&(j=j.child,j!==null))for(Xj(j,_,_e),j=j.sibling;j!==null;)Xj(j,_,_e),j=j.sibling}var X=null,Yj=!1;function Zj(j,_,_e){for(_e=_e.child;_e!==null;)ak(j,_,_e),_e=_e.sibling}function ak(j,_,_e){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,_e)}catch{}switch(_e.tag){case 5:U||Mj(_e,_);case 6:var d=X,it=Yj;X=null,Zj(j,_,_e),X=d,Yj=it,X!==null&&(Yj?(j=X,_e=_e.stateNode,j.nodeType===8?j.parentNode.removeChild(_e):j.removeChild(_e)):X.removeChild(_e.stateNode));break;case 18:X!==null&&(Yj?(j=X,_e=_e.stateNode,j.nodeType===8?Kf(j.parentNode,_e):j.nodeType===1&&Kf(j,_e),bd(j)):Kf(X,_e.stateNode));break;case 4:d=X,it=Yj,X=_e.stateNode.containerInfo,Yj=!0,Zj(j,_,_e),X=d,Yj=it;break;case 0:case 11:case 14:case 15:if(!U&&(d=_e.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){it=d=d.next;do{var ct=it,pt=ct.destroy;ct=ct.tag,pt!==void 0&&(ct&2||ct&4)&&Nj(_e,_,pt),it=it.next}while(it!==d)}Zj(j,_,_e);break;case 1:if(!U&&(Mj(_e,_),d=_e.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=_e.memoizedProps,d.state=_e.memoizedState,d.componentWillUnmount()}catch(At){W(_e,_,At)}Zj(j,_,_e);break;case 21:Zj(j,_,_e);break;case 22:_e.mode&1?(U=(d=U)||_e.memoizedState!==null,Zj(j,_,_e),U=d):Zj(j,_,_e);break;default:Zj(j,_,_e)}}function bk(j){var _=j.updateQueue;if(_!==null){j.updateQueue=null;var _e=j.stateNode;_e===null&&(_e=j.stateNode=new Lj),_.forEach(function(d){var it=ck.bind(null,j,d);_e.has(d)||(_e.add(d),d.then(it,it))})}}function dk(j,_){var _e=_.deletions;if(_e!==null)for(var d=0;d<_e.length;d++){var it=_e[d];try{var ct=j,pt=_,At=pt;e:for(;At!==null;){switch(At.tag){case 5:X=At.stateNode,Yj=!1;break e;case 3:X=At.stateNode.containerInfo,Yj=!0;break e;case 4:X=At.stateNode.containerInfo,Yj=!0;break e}At=At.return}if(X===null)throw Error(p(160));ak(ct,pt,it),X=null,Yj=!1;var St=it.alternate;St!==null&&(St.return=null),it.return=null}catch(Ot){W(it,_,Ot)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)ek(_,j),_=_.sibling}function ek(j,_){var _e=j.alternate,d=j.flags;switch(j.tag){case 0:case 11:case 14:case 15:if(dk(_,j),fk(j),d&4){try{Qj(3,j,j.return),Rj(3,j)}catch(jt){W(j,j.return,jt)}try{Qj(5,j,j.return)}catch(jt){W(j,j.return,jt)}}break;case 1:dk(_,j),fk(j),d&512&&_e!==null&&Mj(_e,_e.return);break;case 5:if(dk(_,j),fk(j),d&512&&_e!==null&&Mj(_e,_e.return),j.flags&32){var it=j.stateNode;try{ob(it,"")}catch(jt){W(j,j.return,jt)}}if(d&4&&(it=j.stateNode,it!=null)){var ct=j.memoizedProps,pt=_e!==null?_e.memoizedProps:ct,At=j.type,St=j.updateQueue;if(j.updateQueue=null,St!==null)try{At==="input"&&ct.type==="radio"&&ct.name!=null&&ab(it,ct),vb(At,pt);var Ot=vb(At,ct);for(pt=0;pt<St.length;pt+=2){var Qt=St[pt],Yt=St[pt+1];Qt==="style"?sb(it,Yt):Qt==="dangerouslySetInnerHTML"?nb(it,Yt):Qt==="children"?ob(it,Yt):ta(it,Qt,Yt,Ot)}switch(At){case"input":bb(it,ct);break;case"textarea":ib(it,ct);break;case"select":var Vt=it._wrapperState.wasMultiple;it._wrapperState.wasMultiple=!!ct.multiple;var qt=ct.value;qt!=null?fb(it,!!ct.multiple,qt,!1):Vt!==!!ct.multiple&&(ct.defaultValue!=null?fb(it,!!ct.multiple,ct.defaultValue,!0):fb(it,!!ct.multiple,ct.multiple?[]:"",!1))}it[Pf]=ct}catch(jt){W(j,j.return,jt)}}break;case 6:if(dk(_,j),fk(j),d&4){if(j.stateNode===null)throw Error(p(162));it=j.stateNode,ct=j.memoizedProps;try{it.nodeValue=ct}catch(jt){W(j,j.return,jt)}}break;case 3:if(dk(_,j),fk(j),d&4&&_e!==null&&_e.memoizedState.isDehydrated)try{bd(_.containerInfo)}catch(jt){W(j,j.return,jt)}break;case 4:dk(_,j),fk(j);break;case 13:dk(_,j),fk(j),it=j.child,it.flags&8192&&(ct=it.memoizedState!==null,it.stateNode.isHidden=ct,!ct||it.alternate!==null&&it.alternate.memoizedState!==null||(gk=B())),d&4&&bk(j);break;case 22:if(Qt=_e!==null&&_e.memoizedState!==null,j.mode&1?(U=(Ot=U)||Qt,dk(_,j),U=Ot):dk(_,j),fk(j),d&8192){if(Ot=j.memoizedState!==null,(j.stateNode.isHidden=Ot)&&!Qt&&j.mode&1)for(V=j,Qt=j.child;Qt!==null;){for(Yt=V=Qt;V!==null;){switch(Vt=V,qt=Vt.child,Vt.tag){case 0:case 11:case 14:case 15:Qj(4,Vt,Vt.return);break;case 1:Mj(Vt,Vt.return);var Jt=Vt.stateNode;if(typeof Jt.componentWillUnmount=="function"){d=Vt,_e=Vt.return;try{_=d,Jt.props=_.memoizedProps,Jt.state=_.memoizedState,Jt.componentWillUnmount()}catch(jt){W(d,_e,jt)}}break;case 5:Mj(Vt,Vt.return);break;case 22:if(Vt.memoizedState!==null){hk(Yt);continue}}qt!==null?(qt.return=Vt,V=qt):hk(Yt)}Qt=Qt.sibling}e:for(Qt=null,Yt=j;;){if(Yt.tag===5){if(Qt===null){Qt=Yt;try{it=Yt.stateNode,Ot?(ct=it.style,typeof ct.setProperty=="function"?ct.setProperty("display","none","important"):ct.display="none"):(At=Yt.stateNode,St=Yt.memoizedProps.style,pt=St!=null&&St.hasOwnProperty("display")?St.display:null,At.style.display=rb("display",pt))}catch(jt){W(j,j.return,jt)}}}else if(Yt.tag===6){if(Qt===null)try{Yt.stateNode.nodeValue=Ot?"":Yt.memoizedProps}catch(jt){W(j,j.return,jt)}}else if((Yt.tag!==22&&Yt.tag!==23||Yt.memoizedState===null||Yt===j)&&Yt.child!==null){Yt.child.return=Yt,Yt=Yt.child;continue}if(Yt===j)break e;for(;Yt.sibling===null;){if(Yt.return===null||Yt.return===j)break e;Qt===Yt&&(Qt=null),Yt=Yt.return}Qt===Yt&&(Qt=null),Yt.sibling.return=Yt.return,Yt=Yt.sibling}}break;case 19:dk(_,j),fk(j),d&4&&bk(j);break;case 21:break;default:dk(_,j),fk(j)}}function fk(j){var _=j.flags;if(_&2){try{e:{for(var _e=j.return;_e!==null;){if(Uj(_e)){var d=_e;break e}_e=_e.return}throw Error(p(160))}switch(d.tag){case 5:var it=d.stateNode;d.flags&32&&(ob(it,""),d.flags&=-33);var ct=Vj(j);Xj(j,ct,it);break;case 3:case 4:var pt=d.stateNode.containerInfo,At=Vj(j);Wj(j,At,pt);break;default:throw Error(p(161))}}catch(St){W(j,j.return,St)}j.flags&=-3}_&4096&&(j.flags&=-4097)}function ik(j,_,_e){V=j,jk(j)}function jk(j,_,_e){for(var d=(j.mode&1)!==0;V!==null;){var it=V,ct=it.child;if(it.tag===22&&d){var pt=it.memoizedState!==null||Kj;if(!pt){var At=it.alternate,St=At!==null&&At.memoizedState!==null||U;At=Kj;var Ot=U;if(Kj=pt,(U=St)&&!Ot)for(V=it;V!==null;)pt=V,St=pt.child,pt.tag===22&&pt.memoizedState!==null?kk(it):St!==null?(St.return=pt,V=St):kk(it);for(;ct!==null;)V=ct,jk(ct),ct=ct.sibling;V=it,Kj=At,U=Ot}lk(j)}else it.subtreeFlags&8772&&ct!==null?(ct.return=it,V=ct):lk(j)}}function lk(j){for(;V!==null;){var _=V;if(_.flags&8772){var _e=_.alternate;try{if(_.flags&8772)switch(_.tag){case 0:case 11:case 15:U||Rj(5,_);break;case 1:var d=_.stateNode;if(_.flags&4&&!U)if(_e===null)d.componentDidMount();else{var it=_.elementType===_.type?_e.memoizedProps:Lg(_.type,_e.memoizedProps);d.componentDidUpdate(it,_e.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var ct=_.updateQueue;ct!==null&&ih(_,ct,d);break;case 3:var pt=_.updateQueue;if(pt!==null){if(_e=null,_.child!==null)switch(_.child.tag){case 5:_e=_.child.stateNode;break;case 1:_e=_.child.stateNode}ih(_,pt,_e)}break;case 5:var At=_.stateNode;if(_e===null&&_.flags&4){_e=At;var St=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":St.autoFocus&&_e.focus();break;case"img":St.src&&(_e.src=St.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var Ot=_.alternate;if(Ot!==null){var Qt=Ot.memoizedState;if(Qt!==null){var Yt=Qt.dehydrated;Yt!==null&&bd(Yt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||_.flags&512&&Sj(_)}catch(Vt){W(_,_.return,Vt)}}if(_===j){V=null;break}if(_e=_.sibling,_e!==null){_e.return=_.return,V=_e;break}V=_.return}}function hk(j){for(;V!==null;){var _=V;if(_===j){V=null;break}var _e=_.sibling;if(_e!==null){_e.return=_.return,V=_e;break}V=_.return}}function kk(j){for(;V!==null;){var _=V;try{switch(_.tag){case 0:case 11:case 15:var _e=_.return;try{Rj(4,_)}catch(St){W(_,_e,St)}break;case 1:var d=_.stateNode;if(typeof d.componentDidMount=="function"){var it=_.return;try{d.componentDidMount()}catch(St){W(_,it,St)}}var ct=_.return;try{Sj(_)}catch(St){W(_,ct,St)}break;case 5:var pt=_.return;try{Sj(_)}catch(St){W(_,pt,St)}}}catch(St){W(_,_.return,St)}if(_===j){V=null;break}var At=_.sibling;if(At!==null){At.return=_.return,V=At;break}V=_.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(j){return j.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(j=C,j!==0||(j=window.event,j=j===void 0?16:jd(j.type)),j):1}function mh(j,_,_e,d){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac(j,_e,d),(!(K&2)||j!==R)&&(j===R&&(!(K&2)&&(rk|=_e),T===4&&Dk(j,Z)),Ek(j,d),_e===1&&K===0&&!(_.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(j,_){var _e=j.callbackNode;wc(j,_);var d=uc(j,j===R?Z:0);if(d===0)_e!==null&&bc(_e),j.callbackNode=null,j.callbackPriority=0;else if(_=d&-d,j.callbackPriority!==_){if(_e!=null&&bc(_e),_===1)j.tag===0?ig(Fk.bind(null,j)):hg(Fk.bind(null,j)),Jf(function(){!(K&6)&&jg()}),_e=null;else{switch(Dc(d)){case 1:_e=fc;break;case 4:_e=gc;break;case 16:_e=hc;break;case 536870912:_e=jc;break;default:_e=hc}_e=Gk(_e,Hk.bind(null,j))}j.callbackPriority=_,j.callbackNode=_e}}function Hk(j,_){if(Bk=-1,Ck=0,K&6)throw Error(p(327));var _e=j.callbackNode;if(Ik()&&j.callbackNode!==_e)return null;var d=uc(j,j===R?Z:0);if(d===0)return null;if(d&30||d&j.expiredLanes||_)_=Jk(j,d);else{_=d;var it=K;K|=2;var ct=Kk();(R!==j||Z!==_)&&(vk=null,Hj=B()+500,Lk(j,_));do try{Mk();break}catch(At){Nk(j,At)}while(1);Qg(),nk.current=ct,K=it,Y!==null?_=0:(R=null,Z=0,_=T)}if(_!==0){if(_===2&&(it=xc(j),it!==0&&(d=it,_=Ok(j,it))),_===1)throw _e=qk,Lk(j,0),Dk(j,d),Ek(j,B()),_e;if(_===6)Dk(j,d);else{if(it=j.current.alternate,!(d&30)&&!Pk(it)&&(_=Jk(j,d),_===2&&(ct=xc(j),ct!==0&&(d=ct,_=Ok(j,ct))),_===1))throw _e=qk,Lk(j,0),Dk(j,d),Ek(j,B()),_e;switch(j.finishedWork=it,j.finishedLanes=d,_){case 0:case 1:throw Error(p(345));case 2:Qk(j,uk,vk);break;case 3:if(Dk(j,d),(d&130023424)===d&&(_=gk+500-B(),10<_)){if(uc(j,0)!==0)break;if(it=j.suspendedLanes,(it&d)!==d){L(),j.pingedLanes|=j.suspendedLanes&it;break}j.timeoutHandle=Ff(Qk.bind(null,j,uk,vk),_);break}Qk(j,uk,vk);break;case 4:if(Dk(j,d),(d&4194240)===d)break;for(_=j.eventTimes,it=-1;0<d;){var pt=31-oc(d);ct=1<<pt,pt=_[pt],pt>it&&(it=pt),d&=~ct}if(d=it,d=B()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*mk(d/1960))-d,10<d){j.timeoutHandle=Ff(Qk.bind(null,j,uk,vk),d);break}Qk(j,uk,vk);break;case 5:Qk(j,uk,vk);break;default:throw Error(p(329))}}}return Ek(j,B()),j.callbackNode===_e?Hk.bind(null,j):null}function Ok(j,_){var _e=tk;return j.current.memoizedState.isDehydrated&&(Lk(j,_).flags|=256),j=Jk(j,_),j!==2&&(_=uk,uk=_e,_!==null&&Gj(_)),j}function Gj(j){uk===null?uk=j:uk.push.apply(uk,j)}function Pk(j){for(var _=j;;){if(_.flags&16384){var _e=_.updateQueue;if(_e!==null&&(_e=_e.stores,_e!==null))for(var d=0;d<_e.length;d++){var it=_e[d],ct=it.getSnapshot;it=it.value;try{if(!He(ct(),it))return!1}catch{return!1}}}if(_e=_.child,_.subtreeFlags&16384&&_e!==null)_e.return=_,_=_e;else{if(_===j)break;for(;_.sibling===null;){if(_.return===null||_.return===j)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Dk(j,_){for(_&=~sk,_&=~rk,j.suspendedLanes|=_,j.pingedLanes&=~_,j=j.expirationTimes;0<_;){var _e=31-oc(_),d=1<<_e;j[_e]=-1,_&=~d}}function Fk(j){if(K&6)throw Error(p(327));Ik();var _=uc(j,0);if(!(_&1))return Ek(j,B()),null;var _e=Jk(j,_);if(j.tag!==0&&_e===2){var d=xc(j);d!==0&&(_=d,_e=Ok(j,d))}if(_e===1)throw _e=qk,Lk(j,0),Dk(j,_),Ek(j,B()),_e;if(_e===6)throw Error(p(345));return j.finishedWork=j.current.alternate,j.finishedLanes=_,Qk(j,uk,vk),Ek(j,B()),null}function Rk(j,_){var _e=K;K|=1;try{return j(_)}finally{K=_e,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(j){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var _=K;K|=1;var _e=pk.transition,d=C;try{if(pk.transition=null,C=1,j)return j()}finally{C=d,pk.transition=_e,K=_,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(j,_){j.finishedWork=null,j.finishedLanes=0;var _e=j.timeoutHandle;if(_e!==-1&&(j.timeoutHandle=-1,Gf(_e)),Y!==null)for(_e=Y.return;_e!==null;){var d=_e;switch(wg(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(d);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(d.type._context);break;case 22:case 23:Ij()}_e=_e.return}if(R=j,Y=j=wh(j.current,null),Z=gj=_,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(_=0;_<Wg.length;_++)if(_e=Wg[_],d=_e.interleaved,d!==null){_e.interleaved=null;var it=d.next,ct=_e.pending;if(ct!==null){var pt=ct.next;ct.next=it,d.next=pt}_e.pending=d}Wg=null}return j}function Nk(j,_){do{var _e=Y;try{if(Qg(),Ph.current=ai,Sh){for(var d=N.memoizedState;d!==null;){var it=d.queue;it!==null&&(it.pending=null),d=d.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,_e===null||_e.return===null){T=1,qk=_,Y=null;break}e:{var ct=j,pt=_e.return,At=_e,St=_;if(_=Z,At.flags|=32768,St!==null&&typeof St=="object"&&typeof St.then=="function"){var Ot=St,Qt=At,Yt=Qt.tag;if(!(Qt.mode&1)&&(Yt===0||Yt===11||Yt===15)){var Vt=Qt.alternate;Vt?(Qt.updateQueue=Vt.updateQueue,Qt.memoizedState=Vt.memoizedState,Qt.lanes=Vt.lanes):(Qt.updateQueue=null,Qt.memoizedState=null)}var qt=Vi(pt);if(qt!==null){qt.flags&=-257,Wi(qt,pt,At,ct,_),qt.mode&1&&Ti(ct,Ot,_),_=qt,St=Ot;var Jt=_.updateQueue;if(Jt===null){var jt=new Set;jt.add(St),_.updateQueue=jt}else Jt.add(St);break e}else{if(!(_&1)){Ti(ct,Ot,_),uj();break e}St=Error(p(426))}}else if(I&&At.mode&1){var sn=Vi(pt);if(sn!==null){!(sn.flags&65536)&&(sn.flags|=256),Wi(sn,pt,At,ct,_),Jg(Ki(St,At));break e}}ct=St=Ki(St,At),T!==4&&(T=2),tk===null?tk=[ct]:tk.push(ct),ct=pt;do{switch(ct.tag){case 3:ct.flags|=65536,_&=-_,ct.lanes|=_;var Ft=Oi(ct,St,_);fh(ct,Ft);break e;case 1:At=St;var Ut=ct.type,Ht=ct.stateNode;if(!(ct.flags&128)&&(typeof Ut.getDerivedStateFromError=="function"||Ht!==null&&typeof Ht.componentDidCatch=="function"&&(Si===null||!Si.has(Ht)))){ct.flags|=65536,_&=-_,ct.lanes|=_;var an=Ri(ct,At,_);fh(ct,an);break e}}ct=ct.return}while(ct!==null)}Tk(_e)}catch(nn){_=nn,Y===_e&&_e!==null&&(Y=_e=_e.return);continue}break}while(1)}function Kk(){var j=nk.current;return nk.current=ai,j===null?ai:j}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk(j,_){var _e=K;K|=2;var d=Kk();(R!==j||Z!==_)&&(vk=null,Lk(j,_));do try{Uk();break}catch(it){Nk(j,it)}while(1);if(Qg(),K=_e,nk.current=d,Y!==null)throw Error(p(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk(j){var _=Wk(j.alternate,j,gj);j.memoizedProps=j.pendingProps,_===null?Tk(j):Y=_,ok.current=null}function Tk(j){var _=j;do{var _e=_.alternate;if(j=_.return,_.flags&32768){if(_e=Jj(_e,_),_e!==null){_e.flags&=32767,Y=_e;return}if(j!==null)j.flags|=32768,j.subtreeFlags=0,j.deletions=null;else{T=6,Y=null;return}}else if(_e=Fj(_e,_,gj),_e!==null){Y=_e;return}if(_=_.sibling,_!==null){Y=_;return}Y=_=j}while(_!==null);T===0&&(T=5)}function Qk(j,_,_e){var d=C,it=pk.transition;try{pk.transition=null,C=1,Xk(j,_,_e,d)}finally{pk.transition=it,C=d}return null}function Xk(j,_,_e,d){do Ik();while(xk!==null);if(K&6)throw Error(p(327));_e=j.finishedWork;var it=j.finishedLanes;if(_e===null)return null;if(j.finishedWork=null,j.finishedLanes=0,_e===j.current)throw Error(p(177));j.callbackNode=null,j.callbackPriority=0;var ct=_e.lanes|_e.childLanes;if(Bc(j,ct),j===R&&(Y=R=null,Z=0),!(_e.subtreeFlags&2064)&&!(_e.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),ct=(_e.flags&15990)!==0,_e.subtreeFlags&15990||ct){ct=pk.transition,pk.transition=null;var pt=C;C=1;var At=K;K|=4,ok.current=null,Pj(j,_e),ek(_e,j),Oe(Df),dd=!!Cf,Df=Cf=null,j.current=_e,ik(_e),dc(),K=At,C=pt,pk.transition=ct}else j.current=_e;if(wk&&(wk=!1,xk=j,yk=it),ct=j.pendingLanes,ct===0&&(Si=null),mc(_e.stateNode),Ek(j,B()),_!==null)for(d=j.onRecoverableError,_e=0;_e<_.length;_e++)it=_[_e],d(it.value,{componentStack:it.stack,digest:it.digest});if(Pi)throw Pi=!1,j=Qi,Qi=null,j;return yk&1&&j.tag!==0&&Ik(),ct=j.pendingLanes,ct&1?j===Ak?zk++:(zk=0,Ak=j):zk=0,jg(),null}function Ik(){if(xk!==null){var j=Dc(yk),_=pk.transition,_e=C;try{if(pk.transition=null,C=16>j?16:j,xk===null)var d=!1;else{if(j=xk,xk=null,yk=0,K&6)throw Error(p(331));var it=K;for(K|=4,V=j.current;V!==null;){var ct=V,pt=ct.child;if(V.flags&16){var At=ct.deletions;if(At!==null){for(var St=0;St<At.length;St++){var Ot=At[St];for(V=Ot;V!==null;){var Qt=V;switch(Qt.tag){case 0:case 11:case 15:Qj(8,Qt,ct)}var Yt=Qt.child;if(Yt!==null)Yt.return=Qt,V=Yt;else for(;V!==null;){Qt=V;var Vt=Qt.sibling,qt=Qt.return;if(Tj(Qt),Qt===Ot){V=null;break}if(Vt!==null){Vt.return=qt,V=Vt;break}V=qt}}}var Jt=ct.alternate;if(Jt!==null){var jt=Jt.child;if(jt!==null){Jt.child=null;do{var sn=jt.sibling;jt.sibling=null,jt=sn}while(jt!==null)}}V=ct}}if(ct.subtreeFlags&2064&&pt!==null)pt.return=ct,V=pt;else e:for(;V!==null;){if(ct=V,ct.flags&2048)switch(ct.tag){case 0:case 11:case 15:Qj(9,ct,ct.return)}var Ft=ct.sibling;if(Ft!==null){Ft.return=ct.return,V=Ft;break e}V=ct.return}}var Ut=j.current;for(V=Ut;V!==null;){pt=V;var Ht=pt.child;if(pt.subtreeFlags&2064&&Ht!==null)Ht.return=pt,V=Ht;else e:for(pt=Ut;V!==null;){if(At=V,At.flags&2048)try{switch(At.tag){case 0:case 11:case 15:Rj(9,At)}}catch(nn){W(At,At.return,nn)}if(At===pt){V=null;break e}var an=At.sibling;if(an!==null){an.return=At.return,V=an;break e}V=At.return}}if(K=it,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,j)}catch{}d=!0}return d}finally{C=_e,pk.transition=_}}return!1}function Yk(j,_,_e){_=Ki(_e,_),_=Oi(j,_,1),j=dh(j,_,1),_=L(),j!==null&&(Ac(j,1,_),Ek(j,_))}function W(j,_,_e){if(j.tag===3)Yk(j,j,_e);else for(;_!==null;){if(_.tag===3){Yk(_,j,_e);break}else if(_.tag===1){var d=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Si===null||!Si.has(d))){j=Ki(_e,j),j=Ri(_,j,1),_=dh(_,j,1),j=L(),_!==null&&(Ac(_,1,j),Ek(_,j));break}}_=_.return}}function Ui(j,_,_e){var d=j.pingCache;d!==null&&d.delete(_),_=L(),j.pingedLanes|=j.suspendedLanes&_e,R===j&&(Z&_e)===_e&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk(j,0):sk|=_e),Ek(j,_)}function Zk(j,_){_===0&&(j.mode&1?(_=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):_=1);var _e=L();j=Zg(j,_),j!==null&&(Ac(j,_,_e),Ek(j,_e))}function vj(j){var _=j.memoizedState,_e=0;_!==null&&(_e=_.retryLane),Zk(j,_e)}function ck(j,_){var _e=0;switch(j.tag){case 13:var d=j.stateNode,it=j.memoizedState;it!==null&&(_e=it.retryLane);break;case 19:d=j.stateNode;break;default:throw Error(p(314))}d!==null&&d.delete(_),Zk(j,_e)}var Wk;Wk=function(j,_,_e){if(j!==null)if(j.memoizedProps!==_.pendingProps||Wf.current)Ug=!0;else{if(!(j.lanes&_e)&&!(_.flags&128))return Ug=!1,zj(j,_,_e);Ug=!!(j.flags&131072)}else Ug=!1,I&&_.flags&1048576&&ug(_,ng,_.index);switch(_.lanes=0,_.tag){case 2:var d=_.type;jj(j,_),j=_.pendingProps;var it=Yf(_,H.current);Tg(_,_e),it=Xh(null,_,d,j,it,_e);var ct=bi();return _.flags|=1,typeof it=="object"&&it!==null&&typeof it.render=="function"&&it.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Zf(d)?(ct=!0,cg(_)):ct=!1,_.memoizedState=it.state!==null&&it.state!==void 0?it.state:null,ah(_),it.updater=nh,_.stateNode=it,it._reactInternals=_,rh(_,d,j,_e),_=kj(null,_,d,!0,ct,_e)):(_.tag=0,I&&ct&&vg(_),Yi(null,_,it,_e),_=_.child),_;case 16:d=_.elementType;e:{switch(jj(j,_),j=_.pendingProps,it=d._init,d=it(d._payload),_.type=d,it=_.tag=$k(d),j=Lg(d,j),it){case 0:_=dj(null,_,d,j,_e);break e;case 1:_=ij(null,_,d,j,_e);break e;case 11:_=Zi(null,_,d,j,_e);break e;case 14:_=aj(null,_,d,Lg(d.type,j),_e);break e}throw Error(p(306,d,""))}return _;case 0:return d=_.type,it=_.pendingProps,it=_.elementType===d?it:Lg(d,it),dj(j,_,d,it,_e);case 1:return d=_.type,it=_.pendingProps,it=_.elementType===d?it:Lg(d,it),ij(j,_,d,it,_e);case 3:e:{if(lj(_),j===null)throw Error(p(387));d=_.pendingProps,ct=_.memoizedState,it=ct.element,bh(j,_),gh(_,d,null,_e);var pt=_.memoizedState;if(d=pt.element,ct.isDehydrated)if(ct={element:d,isDehydrated:!1,cache:pt.cache,pendingSuspenseBoundaries:pt.pendingSuspenseBoundaries,transitions:pt.transitions},_.updateQueue.baseState=ct,_.memoizedState=ct,_.flags&256){it=Ki(Error(p(423)),_),_=mj(j,_,d,_e,it);break e}else if(d!==it){it=Ki(Error(p(424)),_),_=mj(j,_,d,_e,it);break e}else for(yg=Lf(_.stateNode.containerInfo.firstChild),xg=_,I=!0,zg=null,_e=Ch(_,null,d,_e),_.child=_e;_e;)_e.flags=_e.flags&-3|4096,_e=_e.sibling;else{if(Ig(),d===it){_=$i(j,_,_e);break e}Yi(j,_,d,_e)}_=_.child}return _;case 5:return Kh(_),j===null&&Eg(_),d=_.type,it=_.pendingProps,ct=j!==null?j.memoizedProps:null,pt=it.children,Ef(d,it)?pt=null:ct!==null&&Ef(d,ct)&&(_.flags|=32),hj(j,_),Yi(j,_,pt,_e),_.child;case 6:return j===null&&Eg(_),null;case 13:return pj(j,_,_e);case 4:return Ih(_,_.stateNode.containerInfo),d=_.pendingProps,j===null?_.child=Bh(_,null,d,_e):Yi(j,_,d,_e),_.child;case 11:return d=_.type,it=_.pendingProps,it=_.elementType===d?it:Lg(d,it),Zi(j,_,d,it,_e);case 7:return Yi(j,_,_.pendingProps,_e),_.child;case 8:return Yi(j,_,_.pendingProps.children,_e),_.child;case 12:return Yi(j,_,_.pendingProps.children,_e),_.child;case 10:e:{if(d=_.type._context,it=_.pendingProps,ct=_.memoizedProps,pt=it.value,G(Mg,d._currentValue),d._currentValue=pt,ct!==null)if(He(ct.value,pt)){if(ct.children===it.children&&!Wf.current){_=$i(j,_,_e);break e}}else for(ct=_.child,ct!==null&&(ct.return=_);ct!==null;){var At=ct.dependencies;if(At!==null){pt=ct.child;for(var St=At.firstContext;St!==null;){if(St.context===d){if(ct.tag===1){St=ch(-1,_e&-_e),St.tag=2;var Ot=ct.updateQueue;if(Ot!==null){Ot=Ot.shared;var Qt=Ot.pending;Qt===null?St.next=St:(St.next=Qt.next,Qt.next=St),Ot.pending=St}}ct.lanes|=_e,St=ct.alternate,St!==null&&(St.lanes|=_e),Sg(ct.return,_e,_),At.lanes|=_e;break}St=St.next}}else if(ct.tag===10)pt=ct.type===_.type?null:ct.child;else if(ct.tag===18){if(pt=ct.return,pt===null)throw Error(p(341));pt.lanes|=_e,At=pt.alternate,At!==null&&(At.lanes|=_e),Sg(pt,_e,_),pt=ct.sibling}else pt=ct.child;if(pt!==null)pt.return=ct;else for(pt=ct;pt!==null;){if(pt===_){pt=null;break}if(ct=pt.sibling,ct!==null){ct.return=pt.return,pt=ct;break}pt=pt.return}ct=pt}Yi(j,_,it.children,_e),_=_.child}return _;case 9:return it=_.type,d=_.pendingProps.children,Tg(_,_e),it=Vg(it),d=d(it),_.flags|=1,Yi(j,_,d,_e),_.child;case 14:return d=_.type,it=Lg(d,_.pendingProps),it=Lg(d.type,it),aj(j,_,d,it,_e);case 15:return cj(j,_,_.type,_.pendingProps,_e);case 17:return d=_.type,it=_.pendingProps,it=_.elementType===d?it:Lg(d,it),jj(j,_),_.tag=1,Zf(d)?(j=!0,cg(_)):j=!1,Tg(_,_e),ph(_,d,it),rh(_,d,it,_e),kj(null,_,d,!0,j,_e);case 19:return yj(j,_,_e);case 22:return ej(j,_,_e)}throw Error(p(156,_.tag))};function Gk(j,_){return ac(j,_)}function al(j,_,_e,d){this.tag=j,this.key=_e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(j,_,_e,d){return new al(j,_,_e,d)}function bj(j){return j=j.prototype,!(!j||!j.isReactComponent)}function $k(j){if(typeof j=="function")return bj(j)?1:0;if(j!=null){if(j=j.$$typeof,j===Da)return 11;if(j===Ga)return 14}return 2}function wh(j,_){var _e=j.alternate;return _e===null?(_e=Bg(j.tag,_,j.key,j.mode),_e.elementType=j.elementType,_e.type=j.type,_e.stateNode=j.stateNode,_e.alternate=j,j.alternate=_e):(_e.pendingProps=_,_e.type=j.type,_e.flags=0,_e.subtreeFlags=0,_e.deletions=null),_e.flags=j.flags&14680064,_e.childLanes=j.childLanes,_e.lanes=j.lanes,_e.child=j.child,_e.memoizedProps=j.memoizedProps,_e.memoizedState=j.memoizedState,_e.updateQueue=j.updateQueue,_=j.dependencies,_e.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},_e.sibling=j.sibling,_e.index=j.index,_e.ref=j.ref,_e}function yh(j,_,_e,d,it,ct){var pt=2;if(d=j,typeof j=="function")bj(j)&&(pt=1);else if(typeof j=="string")pt=5;else e:switch(j){case ya:return Ah(_e.children,it,ct,_);case za:pt=8,it|=8;break;case Aa:return j=Bg(12,_e,_,it|2),j.elementType=Aa,j.lanes=ct,j;case Ea:return j=Bg(13,_e,_,it),j.elementType=Ea,j.lanes=ct,j;case Fa:return j=Bg(19,_e,_,it),j.elementType=Fa,j.lanes=ct,j;case Ia:return qj(_e,it,ct,_);default:if(typeof j=="object"&&j!==null)switch(j.$$typeof){case Ba:pt=10;break e;case Ca:pt=9;break e;case Da:pt=11;break e;case Ga:pt=14;break e;case Ha:pt=16,d=null;break e}throw Error(p(130,j==null?j:typeof j,""))}return _=Bg(pt,_e,_,it),_.elementType=j,_.type=d,_.lanes=ct,_}function Ah(j,_,_e,d){return j=Bg(7,j,d,_),j.lanes=_e,j}function qj(j,_,_e,d){return j=Bg(22,j,d,_),j.elementType=Ia,j.lanes=_e,j.stateNode={isHidden:!1},j}function xh(j,_,_e){return j=Bg(6,j,null,_),j.lanes=_e,j}function zh(j,_,_e){return _=Bg(4,j.children!==null?j.children:[],j.key,_),_.lanes=_e,_.stateNode={containerInfo:j.containerInfo,pendingChildren:null,implementation:j.implementation},_}function bl(j,_,_e,d,it){this.tag=_,this.containerInfo=j,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=d,this.onRecoverableError=it,this.mutableSourceEagerHydrationData=null}function cl(j,_,_e,d,it,ct,pt,At,St){return j=new bl(j,_,_e,At,St),_===1?(_=1,ct===!0&&(_|=8)):_=0,ct=Bg(3,null,null,_),j.current=ct,ct.stateNode=j,ct.memoizedState={element:d,isDehydrated:_e,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(ct),j}function dl(j,_,_e){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:d==null?null:""+d,children:j,containerInfo:_,implementation:_e}}function el(j){if(!j)return Vf;j=j._reactInternals;e:{if(Vb(j)!==j||j.tag!==1)throw Error(p(170));var _=j;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Zf(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(p(171))}if(j.tag===1){var _e=j.type;if(Zf(_e))return bg(j,_e,_)}return _}function fl(j,_,_e,d,it,ct,pt,At,St){return j=cl(_e,d,!0,j,it,ct,pt,At,St),j.context=el(null),_e=j.current,d=L(),it=lh(_e),ct=ch(d,it),ct.callback=_??null,dh(_e,ct,it),j.current.lanes=it,Ac(j,it,d),Ek(j,d),j}function gl(j,_,_e,d){var it=_.current,ct=L(),pt=lh(it);return _e=el(_e),_.context===null?_.context=_e:_.pendingContext=_e,_=ch(ct,pt),_.payload={element:j},d=d===void 0?null:d,d!==null&&(_.callback=d),j=dh(it,_,pt),j!==null&&(mh(j,it,pt,ct),eh(j,it,pt)),pt}function hl(j){if(j=j.current,!j.child)return null;switch(j.child.tag){case 5:return j.child.stateNode;default:return j.child.stateNode}}function il(j,_){if(j=j.memoizedState,j!==null&&j.dehydrated!==null){var _e=j.retryLane;j.retryLane=_e!==0&&_e<_?_e:_}}function jl(j,_){il(j,_),(j=j.alternate)&&il(j,_)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(j){console.error(j)};function ml(j){this._internalRoot=j}nl.prototype.render=ml.prototype.render=function(j){var _=this._internalRoot;if(_===null)throw Error(p(409));gl(j,_,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var j=this._internalRoot;if(j!==null){this._internalRoot=null;var _=j.containerInfo;Sk(function(){gl(null,j,null,null)}),_[uf]=null}};function nl(j){this._internalRoot=j}nl.prototype.unstable_scheduleHydration=function(j){if(j){var _=Hc();j={blockedOn:null,target:j,priority:_};for(var _e=0;_e<Qc.length&&_!==0&&_<Qc[_e].priority;_e++);Qc.splice(_e,0,j),_e===0&&Vc(j)}};function ol(j){return!(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11)}function pl(j){return!(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11&&(j.nodeType!==8||j.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(j,_,_e,d,it){if(it){if(typeof d=="function"){var ct=d;d=function(){var Ot=hl(pt);ct.call(Ot)}}var pt=fl(_,d,j,0,null,!1,!1,"",ql);return j._reactRootContainer=pt,j[uf]=pt.current,sf(j.nodeType===8?j.parentNode:j),Sk(),pt}for(;it=j.lastChild;)j.removeChild(it);if(typeof d=="function"){var At=d;d=function(){var Ot=hl(St);At.call(Ot)}}var St=cl(j,0,!1,null,null,!1,!1,"",ql);return j._reactRootContainer=St,j[uf]=St.current,sf(j.nodeType===8?j.parentNode:j),Sk(function(){gl(_,St,_e,d)}),St}function sl(j,_,_e,d,it){var ct=_e._reactRootContainer;if(ct){var pt=ct;if(typeof it=="function"){var At=it;it=function(){var St=hl(pt);At.call(St)}}gl(_,pt,j,it)}else pt=rl(_e,_,j,it,d);return hl(pt)}Ec=function(j){switch(j.tag){case 3:var _=j.stateNode;if(_.current.memoizedState.isDehydrated){var _e=tc(_.pendingLanes);_e!==0&&(Cc(_,_e|1),Ek(_,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var d=Zg(j,1);if(d!==null){var it=L();mh(d,j,1,it)}}),jl(j,1)}};Fc=function(j){if(j.tag===13){var _=Zg(j,134217728);if(_!==null){var _e=L();mh(_,j,134217728,_e)}jl(j,134217728)}};Gc=function(j){if(j.tag===13){var _=lh(j),_e=Zg(j,_);if(_e!==null){var d=L();mh(_e,j,_,d)}jl(j,_)}};Hc=function(){return C};Ic=function(j,_){var _e=C;try{return C=j,_()}finally{C=_e}};yb=function(j,_,_e){switch(_){case"input":if(bb(j,_e),_=_e.name,_e.type==="radio"&&_!=null){for(_e=j;_e.parentNode;)_e=_e.parentNode;for(_e=_e.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<_e.length;_++){var d=_e[_];if(d!==j&&d.form===j.form){var it=Db(d);if(!it)throw Error(p(90));Wa(d),bb(d,it)}}}break;case"textarea":ib(j,_e);break;case"select":_=_e.value,_!=null&&fb(j,!!_e.multiple,_,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(j){return j=Zb(j),j===null?null:j.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(j,_){var _e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(_))throw Error(p(200));return dl(j,_,null,_e)};reactDom_production_min.createRoot=function(j,_){if(!ol(j))throw Error(p(299));var _e=!1,d="",it=ll;return _!=null&&(_.unstable_strictMode===!0&&(_e=!0),_.identifierPrefix!==void 0&&(d=_.identifierPrefix),_.onRecoverableError!==void 0&&(it=_.onRecoverableError)),_=cl(j,1,!1,null,null,_e,!1,d,it),j[uf]=_.current,sf(j.nodeType===8?j.parentNode:j),new ml(_)};reactDom_production_min.findDOMNode=function(j){if(j==null)return null;if(j.nodeType===1)return j;var _=j._reactInternals;if(_===void 0)throw typeof j.render=="function"?Error(p(188)):(j=Object.keys(j).join(","),Error(p(268,j)));return j=Zb(_),j=j===null?null:j.stateNode,j};reactDom_production_min.flushSync=function(j){return Sk(j)};reactDom_production_min.hydrate=function(j,_,_e){if(!pl(_))throw Error(p(200));return sl(null,j,_,!0,_e)};reactDom_production_min.hydrateRoot=function(j,_,_e){if(!ol(j))throw Error(p(405));var d=_e!=null&&_e.hydratedSources||null,it=!1,ct="",pt=ll;if(_e!=null&&(_e.unstable_strictMode===!0&&(it=!0),_e.identifierPrefix!==void 0&&(ct=_e.identifierPrefix),_e.onRecoverableError!==void 0&&(pt=_e.onRecoverableError)),_=fl(_,null,j,1,_e??null,it,!1,ct,pt),j[uf]=_.current,sf(j),d)for(j=0;j<d.length;j++)_e=d[j],it=_e._getVersion,it=it(_e._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[_e,it]:_.mutableSourceEagerHydrationData.push(_e,it);return new nl(_)};reactDom_production_min.render=function(j,_,_e){if(!pl(_))throw Error(p(200));return sl(null,j,_,!1,_e)};reactDom_production_min.unmountComponentAtNode=function(j){if(!pl(j))throw Error(p(40));return j._reactRootContainer?(Sk(function(){sl(null,null,j,!1,function(){j._reactRootContainer=null,j[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(j,_,_e,d){if(!pl(_e))throw Error(p(200));if(j==null||j._reactInternals===void 0)throw Error(p(38));return sl(j,_,_e,!1,d)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";(function(j){function _(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_)}catch(_e){console.error(_e)}}_(),j.exports=reactDom_production_min})(reactDom);var m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const Logo="/assets/logo-4c5a80d0.svg",Search="/assets/search-963383a4.svg",Store="/assets/Store-ca9861af.svg";function Nav(j){return jsx("nav",{className:"nav-wrapper",children:jsx("div",{className:"nav-content",children:jsxs("ul",{className:"list-styled",children:[jsx("li",{children:jsx("img",{src:Logo,alt:"Apple"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Store"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Mac"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"iPad"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Watch"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Airpords"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Tv & Home"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Entertainment"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Accessories"})}),jsx("li",{children:jsx("a",{className:"link-styled",children:"Support"})}),jsx("li",{children:jsx("img",{src:Search,alt:""})}),jsx("li",{children:jsx("img",{src:Store,alt:""})})]})})})}const iPhone="/assets/iphone-14-d945bd17.jpg",iHold="/assets/iphone-hand-83782827.png";function Jumbotron(){return jsxs("div",{className:"jumbotron-section wrapper",children:[jsx("h2",{className:"title",children:"New"}),jsx("img",{className:"logo",src:iPhone,alt:"iPhone 14 Pro"}),jsx("p",{className:"text",children:"Bigger and Better."}),jsx("span",{className:"description",children:"From $41.62/mo. fro 24 mo. or $999 before trade-in"}),jsxs("ul",{className:"links",children:[jsx("li",{children:jsx("button",{className:"button",children:"Buy"})}),jsx("li",{children:jsx("a",{className:"link",onClick:()=>{const _=document.querySelector(".sound-section");window.scrollTo({top:_.getBoundingClientRect().top,left:0,behavior:"smooth"})},children:"Learn More"})})]}),jsx("img",{className:"iphone-img",src:iHold,alt:"iPhone"})]})}function SoundSection(){return jsx("div",{className:"sound-section wrapper",children:jsx("div",{className:"body",children:jsxs("div",{className:"sound-section-content content",children:[jsx("h2",{className:"title",children:"New Sound System"}),jsx("p",{className:"text",children:"Feel the base."}),jsxs("span",{className:"description",children:[" ","From $41.62/mo. fro 24 mo. or $999 before trade-in"]}),jsxs("ul",{className:"links",children:[jsx("li",{children:jsx("button",{className:"button",children:"Buy"})}),jsx("li",{children:jsx("a",{className:"link",onClick:()=>{const _=document.querySelector(".display-section");window.scrollTo({top:_.getBoundingClientRect().bottom,left:0,behavior:"smooth"})},children:"Learn More"})})]})]})})})}function DisplaySection({triggerPreview:j}){return jsxs("div",{className:"display-section wrapper",children:[jsx("h2",{className:"title",children:"New"}),jsx("p",{className:"text",children:"Brilliant."}),jsx("span",{className:"description",children:"A Display that's up to 2x brighter in the sun."}),jsx("button",{className:"button",onClick:j,children:"Try me!"}),jsx("button",{className:"back-button",onClick:()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},children:"Top"})]})}/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={798:function(j,_,_e){var d=_e(352),it=_e.n(d)()(function(ct){return ct[1]});it.push([j.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),_.Z=it},898:function(j,_,_e){var d=_e(352),it=_e.n(d)()(function(ct){return ct[1]});it.push([j.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),_.Z=it},513:function(j,_,_e){var d=_e(352),it=_e.n(d)()(function(ct){return ct[1]});it.push([j.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),_.Z=it},476:function(j){var _;_=function(){return function(_e){var d={};function it(ct){if(d[ct])return d[ct].exports;var pt=d[ct]={i:ct,l:!1,exports:{}};return _e[ct].call(pt.exports,pt,pt.exports,it),pt.l=!0,pt.exports}return it.m=_e,it.c=d,it.i=function(ct){return ct},it.d=function(ct,pt,At){it.o(ct,pt)||Object.defineProperty(ct,pt,{configurable:!1,enumerable:!0,get:At})},it.n=function(ct){var pt=ct&&ct.__esModule?function(){return ct.default}:function(){return ct};return it.d(pt,"a",pt),pt},it.o=function(ct,pt){return Object.prototype.hasOwnProperty.call(ct,pt)},it.p="",it(it.s=5)}([function(_e,d,it){Object.defineProperty(d,"__esModule",{value:!0});var ct={convertToObject:function(pt){var At=pt.substring(pt.indexOf("{")+1).trim().slice(0,-1),St={};return At.split(";").map(function(Ot){if(Ot=Ot.trim()){var Qt=Ot.split(":");St[Qt[0].trim()]=Qt[1].trim()}}),St},getFromSheets:function(pt){var At=document.styleSheets;for(var St in At){var Ot=null;try{Ot=At[St].rules||At[St].cssRules}catch{}if(Ot){for(var Qt in Ot)if(Ot[Qt].selectorText&&Ot[Qt].selectorText.split(",").indexOf(pt)!=-1)return Ot[Qt].cssText?ct.convertToObject(Ot[Qt].cssText):ct.convertToObject(Ot[Qt].style.cssText)}}return{}},getPropertyDefault:function(pt){return pt=="timing-function"?"ease":pt=="iteration-count"?1:pt=="direction"?"normal":pt=="fill-mode"?"none":null}};d.default=ct},function(_e,d,it){Object.defineProperty(d,"__esModule",{value:!0});var ct={generateId:function(){for(var pt="",At="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",St=0;St<8;++St)pt+=At.charAt(Math.floor(Math.random()*At.length));return pt},frameToString:function(pt){var At="";for(var St in pt)At+=St+":"+pt[St]+";";return At},convertTimeToMs:function(pt){if(!pt)return 0;if(typeof pt=="number")return pt;var At=parseFloat(pt);return pt.indexOf("ms")!=-1?At:1e3*At},prefixes:["","-webkit-","-moz-","-o-"]};d.default=ct},function(_e,d,it){Object.defineProperty(d,"__esModule",{value:!0});var ct,pt=(ct=it(0))&&ct.__esModule?ct:{default:ct};d.default=function At(St,Ot){if(function(Vt,qt){if(!(Vt instanceof qt))throw new TypeError("Cannot call a class as a function")}(this,At),this.styles=typeof St=="string"?pt.default.getFromSheets(St):St,typeof Ot=="string"){var Qt=pt.default.getFromSheets(Ot);for(var Yt in this.options={},Qt)this.options[Yt.replace("animation-","")]=Qt[Yt]}else this.options=typeof Ot=="number"?{duration:Ot}:Ot}},function(_e,d,it){Object.defineProperty(d,"__esModule",{value:!0});var ct=function(){function Yt(Vt,qt){for(var Jt=0;Jt<qt.length;Jt++){var jt=qt[Jt];jt.enumerable=jt.enumerable||!1,jt.configurable=!0,"value"in jt&&(jt.writable=!0),Object.defineProperty(Vt,jt.key,jt)}}return function(Vt,qt,Jt){return qt&&Yt(Vt.prototype,qt),Jt&&Yt(Vt,Jt),Vt}}(),pt=Ot(it(4)),At=Ot(it(1)),St=Ot(it(0));function Ot(Yt){return Yt&&Yt.__esModule?Yt:{default:Yt}}var Qt=function(){function Yt(Vt,qt,Jt,jt){if(function(Ut,Ht){if(!(Ut instanceof Ht))throw new TypeError("Cannot call a class as a function")}(this,Yt),Vt.constructor===Array?this.doms=Vt:this.doms=[Vt],qt.constructor===Array?this.frames=qt:this.frames=[qt],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},Jt!=null&&Jt!=null)if(typeof Jt=="boolean")this.options.instant=Jt;else if(typeof Jt=="number")this.options.count=Jt,typeof jt=="boolean"&&(this.options.instant=jt);else for(var sn in Jt)sn=="pauseAt"&&Jt.pauseAt.constructor!==Array?this.options[sn]=[Jt[sn]]:this.options[sn]=Jt[sn];for(var Ft in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=At.default.prefixes:this.prefixes=[""],Vt)this.countRemainder[Ft]=this.options.count-1;this.options.instant&&this.play()}return ct(Yt,[{key:"play",value:function(){var Vt=this;for(var qt in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(jt){Vt.promiseResolve=jt})),this.doms){var Jt=this.makeAnimation(this.doms[qt]);this.animations[qt]=Jt.names,this.styleDoms[qt]=Jt.styleDom,this.superSets[qt]=this.makeSuperSet(this.doms[qt],this.animations[qt]),this.playAnimation(this.doms[qt],this.superSets[qt]),this.eventHandler[qt]=this.handleAnimationEnd.bind(this,qt),this.doms[qt].addEventListener("animationend",this.eventHandler[qt])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(Vt){if(!Vt){for(var qt in this.doms)this.clear(qt);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var Jt=this.styleDoms[Vt];for(var jt in Jt&&Jt.parentNode&&Jt.parentNode.removeChild(Jt),this.superSets[Vt])for(var sn in this.prefixes)this.doms[Vt].style[this.prefixes[sn]+"animation-"+jt]=null;for(var Ft in this.prefixes)this.doms[Vt].style[this.prefixes[Ft]+"animation-play-state"]=null;this.doms[Vt].removeEventListener("animationend",this.eventHandler[Vt]),this.countRemainder[Vt]=this.options.count-1}},{key:"replay",value:function(Vt){var qt=this.doms[Vt],Jt=qt.cloneNode(!0);qt.parentNode.replaceChild(Jt,qt),this.doms[Vt].removeEventListener("animationend",this.eventHandler[Vt]),this.doms[Vt]=Jt,this.doms[Vt].addEventListener("animationend",this.eventHandler[Vt])}},{key:"pause",value:function(){for(var Vt in this.doms)this.pauseDom(this.doms[Vt])}},{key:"resume",value:function(){for(var Vt in this.doms)this.resumeDom(this.doms[Vt])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(Vt,qt){var Jt=qt.animationName,jt=Jt.substring(Jt.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(jt))&&this.pauseDom(this.doms[Vt]),jt==this.frames.length&&(this.countRemainder[Vt]==-1?this.replay(Vt):this.countRemainder[Vt]>0?(this.countRemainder[Vt]--,this.replay(Vt)):(this.options.applyOnEnd&&this.applyOnEnd(Vt),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(Vt){for(var qt in this.prefixes)Vt.style[this.prefixes[qt]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(Vt){for(var qt in this.prefixes)Vt.style[this.prefixes[qt]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(Vt){var qt=this.newFrames[this.frames.length];for(var Jt in qt)this.doms[Vt].style[Jt]=qt[Jt]}},{key:"makeAnimation",value:function(Vt){var qt={},Jt=[],jt={};for(var sn in this.frames)for(var Ft in Jt.push(this.frames[sn].styles),Jt[sn])jt[Ft]=!0;var Ut=window.getComputedStyle(Vt);for(var Ht in jt)qt[Ht]=Ut[Ht];Jt.unshift(qt);for(var an=[Jt[0]],nn=1;nn<Jt.length;++nn){var dn=JSON.parse(JSON.stringify(an[nn-1]));for(var zt in Jt[nn])dn[zt]=Jt[nn][zt];an.push(dn)}return this.newFrames=an,pt.default.make(an,this.prefixes)}},{key:"makeSuperSet",value:function(Vt,qt){var Jt=0,jt={};for(var sn in this.frames)for(var Ft in this.frames[sn].options)jt[Ft]="";jt.name="",jt.duration="",jt.delay="";for(var Ut=0;Ut<this.frames.length;++Ut){if(Ut)for(var Ht in jt)jt[Ht]+=",";var an=At.default.convertTimeToMs(this.frames[Ut].options.duration),nn=At.default.convertTimeToMs(this.frames[Ut].options.delay);for(var dn in Ut<this.options.startFrom&&(an=0,nn=0),jt.name+=qt[Ut],jt.duration+=an+"ms",jt.delay+=Jt+nn+"ms",jt)dn!="name"&&dn!="duration"&&dn!="delay"&&(jt[dn]+=this.frames[Ut].options[dn]?this.frames[Ut].options[dn]:St.default.getPropertyDefault(dn));var zt=this.frames[Ut].options["iteration-count"];Jt+=an*parseInt(zt||1)+nn}return jt}},{key:"playAnimation",value:function(Vt,qt){for(var Jt in qt)for(var jt in this.prefixes)Vt.style[this.prefixes[jt]+"animation-"+Jt]=qt[Jt];this.options.pauseAt.includes(0)&&this.pauseDom(Vt)}}]),Yt}();d.default=Qt},function(_e,d,it){Object.defineProperty(d,"__esModule",{value:!0});var ct,pt=(ct=it(1))&&ct.__esModule?ct:{default:ct},At={make:function(St,Ot){for(var Qt=[],Yt="",Vt="atr-"+pt.default.generateId(),qt=document.createElement("style"),Jt=0;Jt<St.length-1;++Jt)Qt.push(Vt+"-"+(Jt+1)),Yt+=At.makeFromTwoFrames(St[Jt],St[Jt+1],Qt[Jt],Ot);return qt.innerHTML=Yt,qt.class="foo",document.getElementsByTagName("head")[0].appendChild(qt),{names:Qt,styleDom:qt}},makeFromTwoFrames:function(St,Ot,Qt,Yt){var Vt="";for(var qt in Yt)Vt+="@"+Yt[qt]+"keyframes "+Qt+" {",Vt+="0%",Vt+="{"+pt.default.frameToString(St)+"}",Vt+="100%",Vt+="{"+pt.default.frameToString(Ot)+"}",Vt+="}";return Vt}};d.default=At},function(_e,d,it){Object.defineProperty(d,"__esModule",{value:!0}),d.Queue=d.Frame=void 0;var ct=At(it(2)),pt=At(it(3));function At(St){return St&&St.__esModule?St:{default:St}}d.Frame=ct.default,d.Queue=pt.default}])},j.exports=_()},352:function(j){j.exports=function(_){var _e=[];return _e.toString=function(){return this.map(function(d){var it=_(d);return d[2]?"@media ".concat(d[2]," {").concat(it,"}"):it}).join("")},_e.i=function(d,it,ct){typeof d=="string"&&(d=[[null,d,""]]);var pt={};if(ct)for(var At=0;At<this.length;At++){var St=this[At][0];St!=null&&(pt[St]=!0)}for(var Ot=0;Ot<d.length;Ot++){var Qt=[].concat(d[Ot]);ct&&pt[Qt[0]]||(it&&(Qt[2]?Qt[2]="".concat(it," and ").concat(Qt[2]):Qt[2]=it),_e.push(Qt))}},_e}},388:function(j){j.exports=function _(_e,d,it){function ct(St,Ot){if(!d[St]){if(!_e[St]){if(pt)return pt(St,!0);throw new Error("Cannot find module '"+St+"'")}var Qt=d[St]={exports:{}};_e[St][0].call(Qt.exports,function(Yt){return ct(_e[St][1][Yt]||Yt)},Qt,Qt.exports,_,_e,d,it)}return d[St].exports}for(var pt=void 0,At=0;At<it.length;At++)ct(it[At]);return ct}({1:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){var qt=_("crypto");function Jt(nn,dn){return function(zt,Wt){var Zt;if((Zt=Wt.algorithm!=="passthrough"?qt.createHash(Wt.algorithm):new an).write===void 0&&(Zt.write=Zt.update,Zt.end=Zt.update),Ht(Wt,Zt).dispatch(zt),Zt.update||Zt.end(""),Zt.digest)return Zt.digest(Wt.encoding==="buffer"?void 0:Wt.encoding);var mn=Zt.read();return Wt.encoding!=="buffer"?mn.toString(Wt.encoding):mn}(nn,dn=Ft(nn,dn))}(d=_e.exports=Jt).sha1=function(nn){return Jt(nn)},d.keys=function(nn){return Jt(nn,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},d.MD5=function(nn){return Jt(nn,{algorithm:"md5",encoding:"hex"})},d.keysMD5=function(nn){return Jt(nn,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var jt=qt.getHashes?qt.getHashes().slice():["sha1","md5"];jt.push("passthrough");var sn=["buffer","hex","binary","base64"];function Ft(nn,dn){dn=dn||{};var zt={};if(zt.algorithm=dn.algorithm||"sha1",zt.encoding=dn.encoding||"hex",zt.excludeValues=!!dn.excludeValues,zt.algorithm=zt.algorithm.toLowerCase(),zt.encoding=zt.encoding.toLowerCase(),zt.ignoreUnknown=dn.ignoreUnknown===!0,zt.respectType=dn.respectType!==!1,zt.respectFunctionNames=dn.respectFunctionNames!==!1,zt.respectFunctionProperties=dn.respectFunctionProperties!==!1,zt.unorderedArrays=dn.unorderedArrays===!0,zt.unorderedSets=dn.unorderedSets!==!1,zt.unorderedObjects=dn.unorderedObjects!==!1,zt.replacer=dn.replacer||void 0,zt.excludeKeys=dn.excludeKeys||void 0,nn===void 0)throw new Error("Object argument required.");for(var Wt=0;Wt<jt.length;++Wt)jt[Wt].toLowerCase()===zt.algorithm.toLowerCase()&&(zt.algorithm=jt[Wt]);if(jt.indexOf(zt.algorithm)===-1)throw new Error('Algorithm "'+zt.algorithm+'"  not supported. supported values: '+jt.join(", "));if(sn.indexOf(zt.encoding)===-1&&zt.algorithm!=="passthrough")throw new Error('Encoding "'+zt.encoding+'"  not supported. supported values: '+sn.join(", "));return zt}function Ut(nn){if(typeof nn=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(nn))!=null}function Ht(nn,dn,zt){function Wt(Zt){return dn.update?dn.update(Zt,"utf8"):dn.write(Zt,"utf8")}return zt=zt||[],{dispatch:function(Zt){return nn.replacer&&(Zt=nn.replacer(Zt)),this["_"+(Zt===null?"null":typeof Zt)](Zt)},_object:function(Zt){var mn,hn=Object.prototype.toString.call(Zt),zn=/\[object (.*)\]/i.exec(hn);if(zn=(zn=zn?zn[1]:"unknown:["+hn+"]").toLowerCase(),0<=(mn=zt.indexOf(Zt)))return this.dispatch("[CIRCULAR:"+mn+"]");if(zt.push(Zt),pt!==void 0&&pt.isBuffer&&pt.isBuffer(Zt))return Wt("buffer:"),Wt(Zt);if(zn==="object"||zn==="function"||zn==="asyncfunction"){var lr=Object.keys(Zt);nn.unorderedObjects&&(lr=lr.sort()),nn.respectType===!1||Ut(Zt)||lr.splice(0,0,"prototype","__proto__","constructor"),nn.excludeKeys&&(lr=lr.filter(function(ur){return!nn.excludeKeys(ur)})),Wt("object:"+lr.length+":");var ar=this;return lr.forEach(function(ur){ar.dispatch(ur),Wt(":"),nn.excludeValues||ar.dispatch(Zt[ur]),Wt(",")})}if(!this["_"+zn]){if(nn.ignoreUnknown)return Wt("["+zn+"]");throw new Error('Unknown object type "'+zn+'"')}this["_"+zn](Zt)},_array:function(Zt,mn){mn=mn!==void 0?mn:nn.unorderedArrays!==!1;var hn=this;if(Wt("array:"+Zt.length+":"),!mn||Zt.length<=1)return Zt.forEach(function(ar){return hn.dispatch(ar)});var zn=[],lr=Zt.map(function(ar){var ur=new an,Zn=zt.slice();return Ht(nn,ur,Zn).dispatch(ar),zn=zn.concat(Zn.slice(zt.length)),ur.read().toString()});return zt=zt.concat(zn),lr.sort(),this._array(lr,!1)},_date:function(Zt){return Wt("date:"+Zt.toJSON())},_symbol:function(Zt){return Wt("symbol:"+Zt.toString())},_error:function(Zt){return Wt("error:"+Zt.toString())},_boolean:function(Zt){return Wt("bool:"+Zt.toString())},_string:function(Zt){Wt("string:"+Zt.length+":"),Wt(Zt.toString())},_function:function(Zt){Wt("fn:"),Ut(Zt)?this.dispatch("[native]"):this.dispatch(Zt.toString()),nn.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Zt.name)),nn.respectFunctionProperties&&this._object(Zt)},_number:function(Zt){return Wt("number:"+Zt.toString())},_xml:function(Zt){return Wt("xml:"+Zt.toString())},_null:function(){return Wt("Null")},_undefined:function(){return Wt("Undefined")},_regexp:function(Zt){return Wt("regex:"+Zt.toString())},_uint8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint8clampedarray:function(Zt){return Wt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Zt))},_int8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float32array:function(Zt){return Wt("float32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float64array:function(Zt){return Wt("float64array:"),this.dispatch(Array.prototype.slice.call(Zt))},_arraybuffer:function(Zt){return Wt("arraybuffer:"),this.dispatch(new Uint8Array(Zt))},_url:function(Zt){return Wt("url:"+Zt.toString())},_map:function(Zt){Wt("map:");var mn=Array.from(Zt);return this._array(mn,nn.unorderedSets!==!1)},_set:function(Zt){Wt("set:");var mn=Array.from(Zt);return this._array(mn,nn.unorderedSets!==!1)},_file:function(Zt){return Wt("file:"),this.dispatch([Zt.name,Zt.size,Zt.type,Zt.lastModfied])},_blob:function(){if(nn.ignoreUnknown)return Wt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Wt("domwindow")},_bigint:function(Zt){return Wt("bigint:"+Zt.toString())},_process:function(){return Wt("process")},_timer:function(){return Wt("timer")},_pipe:function(){return Wt("pipe")},_tcp:function(){return Wt("tcp")},_udp:function(){return Wt("udp")},_tty:function(){return Wt("tty")},_statwatcher:function(){return Wt("statwatcher")},_securecontext:function(){return Wt("securecontext")},_connection:function(){return Wt("connection")},_zlib:function(){return Wt("zlib")},_context:function(){return Wt("context")},_nodescript:function(){return Wt("nodescript")},_httpparser:function(){return Wt("httpparser")},_dataview:function(){return Wt("dataview")},_signal:function(){return Wt("signal")},_fsevent:function(){return Wt("fsevent")},_tlswrap:function(){return Wt("tlswrap")}}}function an(){return{buf:"",write:function(nn){this.buf+=nn},end:function(nn){this.buf+=nn},read:function(){return this.buf}}}d.writeToStream=function(nn,dn,zt){return zt===void 0&&(zt=dn,dn={}),Ht(dn=Ft(nn,dn),zt).dispatch(nn)}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){(function(qt){var Jt=typeof Uint8Array<"u"?Uint8Array:Array,jt="+".charCodeAt(0),sn="/".charCodeAt(0),Ft="0".charCodeAt(0),Ut="a".charCodeAt(0),Ht="A".charCodeAt(0),an="-".charCodeAt(0),nn="_".charCodeAt(0);function dn(zt){var Wt=zt.charCodeAt(0);return Wt===jt||Wt===an?62:Wt===sn||Wt===nn?63:Wt<Ft?-1:Wt<Ft+10?Wt-Ft+26+26:Wt<Ht+26?Wt-Ht:Wt<Ut+26?Wt-Ut+26:void 0}qt.toByteArray=function(zt){var Wt,Zt;if(0<zt.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var mn=zt.length,hn=zt.charAt(mn-2)==="="?2:zt.charAt(mn-1)==="="?1:0,zn=new Jt(3*zt.length/4-hn),lr=0<hn?zt.length-4:zt.length,ar=0;function ur(Zn){zn[ar++]=Zn}for(Wt=0;Wt<lr;Wt+=4,0)ur((16711680&(Zt=dn(zt.charAt(Wt))<<18|dn(zt.charAt(Wt+1))<<12|dn(zt.charAt(Wt+2))<<6|dn(zt.charAt(Wt+3))))>>16),ur((65280&Zt)>>8),ur(255&Zt);return hn==2?ur(255&(Zt=dn(zt.charAt(Wt))<<2|dn(zt.charAt(Wt+1))>>4)):hn==1&&(ur((Zt=dn(zt.charAt(Wt))<<10|dn(zt.charAt(Wt+1))<<4|dn(zt.charAt(Wt+2))>>2)>>8&255),ur(255&Zt)),zn},qt.fromByteArray=function(zt){var Wt,Zt,mn,hn,zn=zt.length%3,lr="";function ar(ur){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(ur)}for(Wt=0,mn=zt.length-zn;Wt<mn;Wt+=3)lr+=ar((hn=Zt=(zt[Wt]<<16)+(zt[Wt+1]<<8)+zt[Wt+2])>>18&63)+ar(hn>>12&63)+ar(hn>>6&63)+ar(63&hn);switch(zn){case 1:lr+=ar((Zt=zt[zt.length-1])>>2),lr+=ar(Zt<<4&63),lr+="==";break;case 2:lr+=ar((Zt=(zt[zt.length-2]<<8)+zt[zt.length-1])>>10),lr+=ar(Zt>>4&63),lr+=ar(Zt<<2&63),lr+="="}return lr}})(d===void 0?this.base64js={}:d)}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(_,_e,d){(function(it,ct,jt,At,St,Ot,Qt,Yt,Vt){var qt=_("base64-js"),Jt=_("ieee754");function jt(on,pn,On){if(!(this instanceof jt))return new jt(on,pn,On);var Tr,kr,Br,ds,is,Us=typeof on;if(pn==="base64"&&Us=="string")for(on=(Tr=on).trim?Tr.trim():Tr.replace(/^\s+|\s+$/g,"");on.length%4!=0;)on+="=";if(Us=="number")kr=ar(on);else if(Us=="string")kr=jt.byteLength(on,pn);else{if(Us!="object")throw new Error("First argument needs to be a number, array or string.");kr=ar(on.length)}if(jt._useTypedArrays?Br=jt._augment(new Uint8Array(kr)):((Br=this).length=kr,Br._isBuffer=!0),jt._useTypedArrays&&typeof on.byteLength=="number")Br._set(on);else if(ur(is=on)||jt.isBuffer(is)||is&&typeof is=="object"&&typeof is.length=="number")for(ds=0;ds<kr;ds++)jt.isBuffer(on)?Br[ds]=on.readUInt8(ds):Br[ds]=on[ds];else if(Us=="string")Br.write(on,0,pn);else if(Us=="number"&&!jt._useTypedArrays&&!On)for(ds=0;ds<kr;ds++)Br[ds]=0;return Br}function sn(on,pn,On,Tr){Tr||(Wn(typeof On=="boolean","missing or invalid endian"),Wn(pn!=null,"missing offset"),Wn(pn+1<on.length,"Trying to read beyond buffer length"));var kr,Br=on.length;if(!(Br<=pn))return On?(kr=on[pn],pn+1<Br&&(kr|=on[pn+1]<<8)):(kr=on[pn]<<8,pn+1<Br&&(kr|=on[pn+1])),kr}function Ft(on,pn,On,Tr){Tr||(Wn(typeof On=="boolean","missing or invalid endian"),Wn(pn!=null,"missing offset"),Wn(pn+3<on.length,"Trying to read beyond buffer length"));var kr,Br=on.length;if(!(Br<=pn))return On?(pn+2<Br&&(kr=on[pn+2]<<16),pn+1<Br&&(kr|=on[pn+1]<<8),kr|=on[pn],pn+3<Br&&(kr+=on[pn+3]<<24>>>0)):(pn+1<Br&&(kr=on[pn+1]<<16),pn+2<Br&&(kr|=on[pn+2]<<8),pn+3<Br&&(kr|=on[pn+3]),kr+=on[pn]<<24>>>0),kr}function Ut(on,pn,On,Tr){if(Tr||(Wn(typeof On=="boolean","missing or invalid endian"),Wn(pn!=null,"missing offset"),Wn(pn+1<on.length,"Trying to read beyond buffer length")),!(on.length<=pn)){var kr=sn(on,pn,On,!0);return 32768&kr?-1*(65535-kr+1):kr}}function Ht(on,pn,On,Tr){if(Tr||(Wn(typeof On=="boolean","missing or invalid endian"),Wn(pn!=null,"missing offset"),Wn(pn+3<on.length,"Trying to read beyond buffer length")),!(on.length<=pn)){var kr=Ft(on,pn,On,!0);return 2147483648&kr?-1*(4294967295-kr+1):kr}}function an(on,pn,On,Tr){return Tr||(Wn(typeof On=="boolean","missing or invalid endian"),Wn(pn+3<on.length,"Trying to read beyond buffer length")),Jt.read(on,pn,On,23,4)}function nn(on,pn,On,Tr){return Tr||(Wn(typeof On=="boolean","missing or invalid endian"),Wn(pn+7<on.length,"Trying to read beyond buffer length")),Jt.read(on,pn,On,52,8)}function dn(on,pn,On,Tr,kr){kr||(Wn(pn!=null,"missing value"),Wn(typeof Tr=="boolean","missing or invalid endian"),Wn(On!=null,"missing offset"),Wn(On+1<on.length,"trying to write beyond buffer length"),er(pn,65535));var Br=on.length;if(!(Br<=On))for(var ds=0,is=Math.min(Br-On,2);ds<is;ds++)on[On+ds]=(pn&255<<8*(Tr?ds:1-ds))>>>8*(Tr?ds:1-ds)}function zt(on,pn,On,Tr,kr){kr||(Wn(pn!=null,"missing value"),Wn(typeof Tr=="boolean","missing or invalid endian"),Wn(On!=null,"missing offset"),Wn(On+3<on.length,"trying to write beyond buffer length"),er(pn,4294967295));var Br=on.length;if(!(Br<=On))for(var ds=0,is=Math.min(Br-On,4);ds<is;ds++)on[On+ds]=pn>>>8*(Tr?ds:3-ds)&255}function Wt(on,pn,On,Tr,kr){kr||(Wn(pn!=null,"missing value"),Wn(typeof Tr=="boolean","missing or invalid endian"),Wn(On!=null,"missing offset"),Wn(On+1<on.length,"Trying to write beyond buffer length"),$n(pn,32767,-32768)),on.length<=On||dn(on,0<=pn?pn:65535+pn+1,On,Tr,kr)}function Zt(on,pn,On,Tr,kr){kr||(Wn(pn!=null,"missing value"),Wn(typeof Tr=="boolean","missing or invalid endian"),Wn(On!=null,"missing offset"),Wn(On+3<on.length,"Trying to write beyond buffer length"),$n(pn,2147483647,-2147483648)),on.length<=On||zt(on,0<=pn?pn:4294967295+pn+1,On,Tr,kr)}function mn(on,pn,On,Tr,kr){kr||(Wn(pn!=null,"missing value"),Wn(typeof Tr=="boolean","missing or invalid endian"),Wn(On!=null,"missing offset"),Wn(On+3<on.length,"Trying to write beyond buffer length"),xr(pn,34028234663852886e22,-34028234663852886e22)),on.length<=On||Jt.write(on,pn,On,Tr,23,4)}function hn(on,pn,On,Tr,kr){kr||(Wn(pn!=null,"missing value"),Wn(typeof Tr=="boolean","missing or invalid endian"),Wn(On!=null,"missing offset"),Wn(On+7<on.length,"Trying to write beyond buffer length"),xr(pn,17976931348623157e292,-17976931348623157e292)),on.length<=On||Jt.write(on,pn,On,Tr,52,8)}d.Buffer=jt,d.SlowBuffer=jt,d.INSPECT_MAX_BYTES=50,jt.poolSize=8192,jt._useTypedArrays=function(){try{var on=new ArrayBuffer(0),pn=new Uint8Array(on);return pn.foo=function(){return 42},pn.foo()===42&&typeof pn.subarray=="function"}catch{return!1}}(),jt.isEncoding=function(on){switch(String(on).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},jt.isBuffer=function(on){return!(on==null||!on._isBuffer)},jt.byteLength=function(on,pn){var On;switch(on+="",pn||"utf8"){case"hex":On=on.length/2;break;case"utf8":case"utf-8":On=wr(on).length;break;case"ascii":case"binary":case"raw":On=on.length;break;case"base64":On=Vn(on).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":On=2*on.length;break;default:throw new Error("Unknown encoding")}return On},jt.concat=function(on,pn){if(Wn(ur(on),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),on.length===0)return new jt(0);if(on.length===1)return on[0];if(typeof pn!="number")for(kr=pn=0;kr<on.length;kr++)pn+=on[kr].length;for(var On=new jt(pn),Tr=0,kr=0;kr<on.length;kr++){var Br=on[kr];Br.copy(On,Tr),Tr+=Br.length}return On},jt.prototype.write=function(on,pn,On,Tr){var kr;isFinite(pn)?isFinite(On)||(Tr=On,On=void 0):(kr=Tr,Tr=pn,pn=On,On=kr),pn=Number(pn)||0;var Br,ds,is,Us,Os,go,ks,or=this.length-pn;switch((!On||or<(On=Number(On)))&&(On=or),Tr=String(Tr||"utf8").toLowerCase()){case"hex":Br=function(to,co,Bl,Oo){Bl=Number(Bl)||0;var Mo=to.length-Bl;(!Oo||Mo<(Oo=Number(Oo)))&&(Oo=Mo);var To=co.length;Wn(To%2==0,"Invalid hex string"),To/2<Oo&&(Oo=To/2);for(var Io=0;Io<Oo;Io++){var Hl=parseInt(co.substr(2*Io,2),16);Wn(!isNaN(Hl),"Invalid hex string"),to[Bl+Io]=Hl}return jt._charsWritten=2*Io,Io}(this,on,pn,On);break;case"utf8":case"utf-8":Os=on,go=pn,ks=On,Br=jt._charsWritten=Kn(wr(Os),this,go,ks);break;case"ascii":case"binary":Br=function(to,co,Bl,Oo){return jt._charsWritten=Kn(function(Mo){for(var To=[],Io=0;Io<Mo.length;Io++)To.push(255&Mo.charCodeAt(Io));return To}(co),to,Bl,Oo)}(this,on,pn,On);break;case"base64":ds=on,is=pn,Us=On,Br=jt._charsWritten=Kn(Vn(ds),this,is,Us);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Br=function(to,co,Bl,Oo){return jt._charsWritten=Kn(function(Mo){for(var To,Io,Hl,vo=[],no=0;no<Mo.length;no++)Io=(To=Mo.charCodeAt(no))>>8,Hl=To%256,vo.push(Hl),vo.push(Io);return vo}(co),to,Bl,Oo)}(this,on,pn,On);break;default:throw new Error("Unknown encoding")}return Br},jt.prototype.toString=function(on,pn,On){var Tr,kr,Br,ds,is=this;if(on=String(on||"utf8").toLowerCase(),pn=Number(pn)||0,(On=On!==void 0?Number(On):On=is.length)===pn)return"";switch(on){case"hex":Tr=function(Us,Os,go){var ks=Us.length;(!Os||Os<0)&&(Os=0),(!go||go<0||ks<go)&&(go=ks);for(var or="",to=Os;to<go;to++)or+=Zn(Us[to]);return or}(is,pn,On);break;case"utf8":case"utf-8":Tr=function(Us,Os,go){var ks="",or="";go=Math.min(Us.length,go);for(var to=Os;to<go;to++)Us[to]<=127?(ks+=un(or)+String.fromCharCode(Us[to]),or=""):or+="%"+Us[to].toString(16);return ks+un(or)}(is,pn,On);break;case"ascii":case"binary":Tr=function(Us,Os,go){var ks="";go=Math.min(Us.length,go);for(var or=Os;or<go;or++)ks+=String.fromCharCode(Us[or]);return ks}(is,pn,On);break;case"base64":kr=is,ds=On,Tr=(Br=pn)===0&&ds===kr.length?qt.fromByteArray(kr):qt.fromByteArray(kr.slice(Br,ds));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Tr=function(Us,Os,go){for(var ks=Us.slice(Os,go),or="",to=0;to<ks.length;to+=2)or+=String.fromCharCode(ks[to]+256*ks[to+1]);return or}(is,pn,On);break;default:throw new Error("Unknown encoding")}return Tr},jt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},jt.prototype.copy=function(on,pn,On,Tr){if(On=On||0,Tr||Tr===0||(Tr=this.length),pn=pn||0,Tr!==On&&on.length!==0&&this.length!==0){Wn(On<=Tr,"sourceEnd < sourceStart"),Wn(0<=pn&&pn<on.length,"targetStart out of bounds"),Wn(0<=On&&On<this.length,"sourceStart out of bounds"),Wn(0<=Tr&&Tr<=this.length,"sourceEnd out of bounds"),Tr>this.length&&(Tr=this.length),on.length-pn<Tr-On&&(Tr=on.length-pn+On);var kr=Tr-On;if(kr<100||!jt._useTypedArrays)for(var Br=0;Br<kr;Br++)on[Br+pn]=this[Br+On];else on._set(this.subarray(On,On+kr),pn)}},jt.prototype.slice=function(on,pn){var On=this.length;if(on=lr(on,On,0),pn=lr(pn,On,On),jt._useTypedArrays)return jt._augment(this.subarray(on,pn));for(var Tr=pn-on,kr=new jt(Tr,void 0,!0),Br=0;Br<Tr;Br++)kr[Br]=this[Br+on];return kr},jt.prototype.get=function(on){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(on)},jt.prototype.set=function(on,pn){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(on,pn)},jt.prototype.readUInt8=function(on,pn){if(pn||(Wn(on!=null,"missing offset"),Wn(on<this.length,"Trying to read beyond buffer length")),!(on>=this.length))return this[on]},jt.prototype.readUInt16LE=function(on,pn){return sn(this,on,!0,pn)},jt.prototype.readUInt16BE=function(on,pn){return sn(this,on,!1,pn)},jt.prototype.readUInt32LE=function(on,pn){return Ft(this,on,!0,pn)},jt.prototype.readUInt32BE=function(on,pn){return Ft(this,on,!1,pn)},jt.prototype.readInt8=function(on,pn){if(pn||(Wn(on!=null,"missing offset"),Wn(on<this.length,"Trying to read beyond buffer length")),!(on>=this.length))return 128&this[on]?-1*(255-this[on]+1):this[on]},jt.prototype.readInt16LE=function(on,pn){return Ut(this,on,!0,pn)},jt.prototype.readInt16BE=function(on,pn){return Ut(this,on,!1,pn)},jt.prototype.readInt32LE=function(on,pn){return Ht(this,on,!0,pn)},jt.prototype.readInt32BE=function(on,pn){return Ht(this,on,!1,pn)},jt.prototype.readFloatLE=function(on,pn){return an(this,on,!0,pn)},jt.prototype.readFloatBE=function(on,pn){return an(this,on,!1,pn)},jt.prototype.readDoubleLE=function(on,pn){return nn(this,on,!0,pn)},jt.prototype.readDoubleBE=function(on,pn){return nn(this,on,!1,pn)},jt.prototype.writeUInt8=function(on,pn,On){On||(Wn(on!=null,"missing value"),Wn(pn!=null,"missing offset"),Wn(pn<this.length,"trying to write beyond buffer length"),er(on,255)),pn>=this.length||(this[pn]=on)},jt.prototype.writeUInt16LE=function(on,pn,On){dn(this,on,pn,!0,On)},jt.prototype.writeUInt16BE=function(on,pn,On){dn(this,on,pn,!1,On)},jt.prototype.writeUInt32LE=function(on,pn,On){zt(this,on,pn,!0,On)},jt.prototype.writeUInt32BE=function(on,pn,On){zt(this,on,pn,!1,On)},jt.prototype.writeInt8=function(on,pn,On){On||(Wn(on!=null,"missing value"),Wn(pn!=null,"missing offset"),Wn(pn<this.length,"Trying to write beyond buffer length"),$n(on,127,-128)),pn>=this.length||(0<=on?this.writeUInt8(on,pn,On):this.writeUInt8(255+on+1,pn,On))},jt.prototype.writeInt16LE=function(on,pn,On){Wt(this,on,pn,!0,On)},jt.prototype.writeInt16BE=function(on,pn,On){Wt(this,on,pn,!1,On)},jt.prototype.writeInt32LE=function(on,pn,On){Zt(this,on,pn,!0,On)},jt.prototype.writeInt32BE=function(on,pn,On){Zt(this,on,pn,!1,On)},jt.prototype.writeFloatLE=function(on,pn,On){mn(this,on,pn,!0,On)},jt.prototype.writeFloatBE=function(on,pn,On){mn(this,on,pn,!1,On)},jt.prototype.writeDoubleLE=function(on,pn,On){hn(this,on,pn,!0,On)},jt.prototype.writeDoubleBE=function(on,pn,On){hn(this,on,pn,!1,On)},jt.prototype.fill=function(on,pn,On){if(on=on||0,pn=pn||0,On=On||this.length,typeof on=="string"&&(on=on.charCodeAt(0)),Wn(typeof on=="number"&&!isNaN(on),"value is not a number"),Wn(pn<=On,"end < start"),On!==pn&&this.length!==0){Wn(0<=pn&&pn<this.length,"start out of bounds"),Wn(0<=On&&On<=this.length,"end out of bounds");for(var Tr=pn;Tr<On;Tr++)this[Tr]=on}},jt.prototype.inspect=function(){for(var on=[],pn=this.length,On=0;On<pn;On++)if(on[On]=Zn(this[On]),On===d.INSPECT_MAX_BYTES){on[On+1]="...";break}return"<Buffer "+on.join(" ")+">"},jt.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(jt._useTypedArrays)return new jt(this).buffer;for(var on=new Uint8Array(this.length),pn=0,On=on.length;pn<On;pn+=1)on[pn]=this[pn];return on.buffer};var zn=jt.prototype;function lr(on,pn,On){return typeof on!="number"?On:pn<=(on=~~on)?pn:0<=on||0<=(on+=pn)?on:0}function ar(on){return(on=~~Math.ceil(+on))<0?0:on}function ur(on){return(Array.isArray||function(pn){return Object.prototype.toString.call(pn)==="[object Array]"})(on)}function Zn(on){return on<16?"0"+on.toString(16):on.toString(16)}function wr(on){for(var pn=[],On=0;On<on.length;On++){var Tr=on.charCodeAt(On);if(Tr<=127)pn.push(on.charCodeAt(On));else{var kr=On;55296<=Tr&&Tr<=57343&&On++;for(var Br=encodeURIComponent(on.slice(kr,On+1)).substr(1).split("%"),ds=0;ds<Br.length;ds++)pn.push(parseInt(Br[ds],16))}}return pn}function Vn(on){return qt.toByteArray(on)}function Kn(on,pn,On,Tr){for(var kr=0;kr<Tr&&!(kr+On>=pn.length||kr>=on.length);kr++)pn[kr+On]=on[kr];return kr}function un(on){try{return decodeURIComponent(on)}catch{return String.fromCharCode(65533)}}function er(on,pn){Wn(typeof on=="number","cannot write a non-number as a number"),Wn(0<=on,"specified a negative value for writing an unsigned value"),Wn(on<=pn,"value is larger than maximum value for type"),Wn(Math.floor(on)===on,"value has a fractional component")}function $n(on,pn,On){Wn(typeof on=="number","cannot write a non-number as a number"),Wn(on<=pn,"value larger than maximum allowed value"),Wn(On<=on,"value smaller than minimum allowed value"),Wn(Math.floor(on)===on,"value has a fractional component")}function xr(on,pn,On){Wn(typeof on=="number","cannot write a non-number as a number"),Wn(on<=pn,"value larger than maximum allowed value"),Wn(On<=on,"value smaller than minimum allowed value")}function Wn(on,pn){if(!on)throw new Error(pn||"Failed assertion")}jt._augment=function(on){return on._isBuffer=!0,on._get=on.get,on._set=on.set,on.get=zn.get,on.set=zn.set,on.write=zn.write,on.toString=zn.toString,on.toLocaleString=zn.toString,on.toJSON=zn.toJSON,on.copy=zn.copy,on.slice=zn.slice,on.readUInt8=zn.readUInt8,on.readUInt16LE=zn.readUInt16LE,on.readUInt16BE=zn.readUInt16BE,on.readUInt32LE=zn.readUInt32LE,on.readUInt32BE=zn.readUInt32BE,on.readInt8=zn.readInt8,on.readInt16LE=zn.readInt16LE,on.readInt16BE=zn.readInt16BE,on.readInt32LE=zn.readInt32LE,on.readInt32BE=zn.readInt32BE,on.readFloatLE=zn.readFloatLE,on.readFloatBE=zn.readFloatBE,on.readDoubleLE=zn.readDoubleLE,on.readDoubleBE=zn.readDoubleBE,on.writeUInt8=zn.writeUInt8,on.writeUInt16LE=zn.writeUInt16LE,on.writeUInt16BE=zn.writeUInt16BE,on.writeUInt32LE=zn.writeUInt32LE,on.writeUInt32BE=zn.writeUInt32BE,on.writeInt8=zn.writeInt8,on.writeInt16LE=zn.writeInt16LE,on.writeInt16BE=zn.writeInt16BE,on.writeInt32LE=zn.writeInt32LE,on.writeInt32BE=zn.writeInt32BE,on.writeFloatLE=zn.writeFloatLE,on.writeFloatBE=zn.writeFloatBE,on.writeDoubleLE=zn.writeDoubleLE,on.writeDoubleBE=zn.writeDoubleBE,on.fill=zn.fill,on.inspect=zn.inspect,on.toArrayBuffer=zn.toArrayBuffer,on}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){pt=_("buffer").Buffer;var qt=new pt(4);qt.fill(0),_e.exports={hash:function(Jt,jt,sn,Ft){return pt.isBuffer(Jt)||(Jt=new pt(Jt)),function(Ut,Ht,an){for(var nn=new pt(Ht),dn=an?nn.writeInt32BE:nn.writeInt32LE,zt=0;zt<Ut.length;zt++)dn.call(nn,Ut[zt],4*zt,!0);return nn}(jt(function(Ut,Ht){var an;Ut.length%4!=0&&(an=Ut.length+(4-Ut.length%4),Ut=pt.concat([Ut,qt],an));for(var nn=[],dn=Ht?Ut.readInt32BE:Ut.readInt32LE,zt=0;zt<Ut.length;zt+=4)nn.push(dn.call(Ut,zt));return nn}(Jt,Ft),8*Jt.length),sn,Ft)}}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){pt=_("buffer").Buffer;var qt=_("./sha"),Jt=_("./sha256"),jt=_("./rng"),sn={sha1:qt,sha256:Jt,md5:_("./md5")},Ft=64,Ut=new pt(Ft);function Ht(nn,dn){var zt=sn[nn=nn||"sha1"],Wt=[];return zt||an("algorithm:",nn,"is not yet supported"),{update:function(Zt){return pt.isBuffer(Zt)||(Zt=new pt(Zt)),Wt.push(Zt),Zt.length,this},digest:function(Zt){var mn=pt.concat(Wt),hn=dn?function(zn,lr,ar){pt.isBuffer(lr)||(lr=new pt(lr)),pt.isBuffer(ar)||(ar=new pt(ar)),lr.length>Ft?lr=zn(lr):lr.length<Ft&&(lr=pt.concat([lr,Ut],Ft));for(var ur=new pt(Ft),Zn=new pt(Ft),wr=0;wr<Ft;wr++)ur[wr]=54^lr[wr],Zn[wr]=92^lr[wr];var Vn=zn(pt.concat([ur,ar]));return zn(pt.concat([Zn,Vn]))}(zt,dn,mn):zt(mn);return Wt=null,Zt?hn.toString(Zt):hn}}}function an(){var nn=[].slice.call(arguments).join(" ");throw new Error([nn,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Ut.fill(0),d.createHash=function(nn){return Ht(nn)},d.createHmac=Ht,d.randomBytes=function(nn,dn){if(!dn||!dn.call)return new pt(jt(nn));try{dn.call(this,void 0,new pt(jt(nn)))}catch(zt){dn(zt)}},function(nn,dn){for(var zt in nn)dn(nn[zt])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(nn){d[nn]=function(){an("sorry,",nn,"is not implemented yet")}})}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){var qt=_("./helpers");function Jt(nn,dn){nn[dn>>5]|=128<<dn%32,nn[14+(dn+64>>>9<<4)]=dn;for(var zt=1732584193,Wt=-271733879,Zt=-1732584194,mn=271733878,hn=0;hn<nn.length;hn+=16){var zn=zt,lr=Wt,ar=Zt,ur=mn;zt=sn(zt,Wt,Zt,mn,nn[hn+0],7,-680876936),mn=sn(mn,zt,Wt,Zt,nn[hn+1],12,-389564586),Zt=sn(Zt,mn,zt,Wt,nn[hn+2],17,606105819),Wt=sn(Wt,Zt,mn,zt,nn[hn+3],22,-1044525330),zt=sn(zt,Wt,Zt,mn,nn[hn+4],7,-176418897),mn=sn(mn,zt,Wt,Zt,nn[hn+5],12,1200080426),Zt=sn(Zt,mn,zt,Wt,nn[hn+6],17,-1473231341),Wt=sn(Wt,Zt,mn,zt,nn[hn+7],22,-45705983),zt=sn(zt,Wt,Zt,mn,nn[hn+8],7,1770035416),mn=sn(mn,zt,Wt,Zt,nn[hn+9],12,-1958414417),Zt=sn(Zt,mn,zt,Wt,nn[hn+10],17,-42063),Wt=sn(Wt,Zt,mn,zt,nn[hn+11],22,-1990404162),zt=sn(zt,Wt,Zt,mn,nn[hn+12],7,1804603682),mn=sn(mn,zt,Wt,Zt,nn[hn+13],12,-40341101),Zt=sn(Zt,mn,zt,Wt,nn[hn+14],17,-1502002290),zt=Ft(zt,Wt=sn(Wt,Zt,mn,zt,nn[hn+15],22,1236535329),Zt,mn,nn[hn+1],5,-165796510),mn=Ft(mn,zt,Wt,Zt,nn[hn+6],9,-1069501632),Zt=Ft(Zt,mn,zt,Wt,nn[hn+11],14,643717713),Wt=Ft(Wt,Zt,mn,zt,nn[hn+0],20,-373897302),zt=Ft(zt,Wt,Zt,mn,nn[hn+5],5,-701558691),mn=Ft(mn,zt,Wt,Zt,nn[hn+10],9,38016083),Zt=Ft(Zt,mn,zt,Wt,nn[hn+15],14,-660478335),Wt=Ft(Wt,Zt,mn,zt,nn[hn+4],20,-405537848),zt=Ft(zt,Wt,Zt,mn,nn[hn+9],5,568446438),mn=Ft(mn,zt,Wt,Zt,nn[hn+14],9,-1019803690),Zt=Ft(Zt,mn,zt,Wt,nn[hn+3],14,-187363961),Wt=Ft(Wt,Zt,mn,zt,nn[hn+8],20,1163531501),zt=Ft(zt,Wt,Zt,mn,nn[hn+13],5,-1444681467),mn=Ft(mn,zt,Wt,Zt,nn[hn+2],9,-51403784),Zt=Ft(Zt,mn,zt,Wt,nn[hn+7],14,1735328473),zt=Ut(zt,Wt=Ft(Wt,Zt,mn,zt,nn[hn+12],20,-1926607734),Zt,mn,nn[hn+5],4,-378558),mn=Ut(mn,zt,Wt,Zt,nn[hn+8],11,-2022574463),Zt=Ut(Zt,mn,zt,Wt,nn[hn+11],16,1839030562),Wt=Ut(Wt,Zt,mn,zt,nn[hn+14],23,-35309556),zt=Ut(zt,Wt,Zt,mn,nn[hn+1],4,-1530992060),mn=Ut(mn,zt,Wt,Zt,nn[hn+4],11,1272893353),Zt=Ut(Zt,mn,zt,Wt,nn[hn+7],16,-155497632),Wt=Ut(Wt,Zt,mn,zt,nn[hn+10],23,-1094730640),zt=Ut(zt,Wt,Zt,mn,nn[hn+13],4,681279174),mn=Ut(mn,zt,Wt,Zt,nn[hn+0],11,-358537222),Zt=Ut(Zt,mn,zt,Wt,nn[hn+3],16,-722521979),Wt=Ut(Wt,Zt,mn,zt,nn[hn+6],23,76029189),zt=Ut(zt,Wt,Zt,mn,nn[hn+9],4,-640364487),mn=Ut(mn,zt,Wt,Zt,nn[hn+12],11,-421815835),Zt=Ut(Zt,mn,zt,Wt,nn[hn+15],16,530742520),zt=Ht(zt,Wt=Ut(Wt,Zt,mn,zt,nn[hn+2],23,-995338651),Zt,mn,nn[hn+0],6,-198630844),mn=Ht(mn,zt,Wt,Zt,nn[hn+7],10,1126891415),Zt=Ht(Zt,mn,zt,Wt,nn[hn+14],15,-1416354905),Wt=Ht(Wt,Zt,mn,zt,nn[hn+5],21,-57434055),zt=Ht(zt,Wt,Zt,mn,nn[hn+12],6,1700485571),mn=Ht(mn,zt,Wt,Zt,nn[hn+3],10,-1894986606),Zt=Ht(Zt,mn,zt,Wt,nn[hn+10],15,-1051523),Wt=Ht(Wt,Zt,mn,zt,nn[hn+1],21,-2054922799),zt=Ht(zt,Wt,Zt,mn,nn[hn+8],6,1873313359),mn=Ht(mn,zt,Wt,Zt,nn[hn+15],10,-30611744),Zt=Ht(Zt,mn,zt,Wt,nn[hn+6],15,-1560198380),Wt=Ht(Wt,Zt,mn,zt,nn[hn+13],21,1309151649),zt=Ht(zt,Wt,Zt,mn,nn[hn+4],6,-145523070),mn=Ht(mn,zt,Wt,Zt,nn[hn+11],10,-1120210379),Zt=Ht(Zt,mn,zt,Wt,nn[hn+2],15,718787259),Wt=Ht(Wt,Zt,mn,zt,nn[hn+9],21,-343485551),zt=an(zt,zn),Wt=an(Wt,lr),Zt=an(Zt,ar),mn=an(mn,ur)}return Array(zt,Wt,Zt,mn)}function jt(nn,dn,zt,Wt,Zt,mn){return an((hn=an(an(dn,nn),an(Wt,mn)))<<(zn=Zt)|hn>>>32-zn,zt);var hn,zn}function sn(nn,dn,zt,Wt,Zt,mn,hn){return jt(dn&zt|~dn&Wt,nn,dn,Zt,mn,hn)}function Ft(nn,dn,zt,Wt,Zt,mn,hn){return jt(dn&Wt|zt&~Wt,nn,dn,Zt,mn,hn)}function Ut(nn,dn,zt,Wt,Zt,mn,hn){return jt(dn^zt^Wt,nn,dn,Zt,mn,hn)}function Ht(nn,dn,zt,Wt,Zt,mn,hn){return jt(zt^(dn|~Wt),nn,dn,Zt,mn,hn)}function an(nn,dn){var zt=(65535&nn)+(65535&dn);return(nn>>16)+(dn>>16)+(zt>>16)<<16|65535&zt}_e.exports=function(nn){return qt.hash(nn,Jt,16)}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){var qt;qt=function(Jt){for(var jt,sn=new Array(Jt),Ft=0;Ft<Jt;Ft++)!(3&Ft)&&(jt=4294967296*Math.random()),sn[Ft]=jt>>>((3&Ft)<<3)&255;return sn},_e.exports=qt}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){var qt=_("./helpers");function Jt(Ft,Ut){Ft[Ut>>5]|=128<<24-Ut%32,Ft[15+(Ut+64>>9<<4)]=Ut;for(var Ht,an,nn,dn,zt,Wt=Array(80),Zt=1732584193,mn=-271733879,hn=-1732584194,zn=271733878,lr=-1009589776,ar=0;ar<Ft.length;ar+=16){for(var ur=Zt,Zn=mn,wr=hn,Vn=zn,Kn=lr,un=0;un<80;un++){Wt[un]=un<16?Ft[ar+un]:sn(Wt[un-3]^Wt[un-8]^Wt[un-14]^Wt[un-16],1);var er=jt(jt(sn(Zt,5),(nn=mn,dn=hn,zt=zn,(an=un)<20?nn&dn|~nn&zt:!(an<40)&&an<60?nn&dn|nn&zt|dn&zt:nn^dn^zt)),jt(jt(lr,Wt[un]),(Ht=un)<20?1518500249:Ht<40?1859775393:Ht<60?-1894007588:-899497514));lr=zn,zn=hn,hn=sn(mn,30),mn=Zt,Zt=er}Zt=jt(Zt,ur),mn=jt(mn,Zn),hn=jt(hn,wr),zn=jt(zn,Vn),lr=jt(lr,Kn)}return Array(Zt,mn,hn,zn,lr)}function jt(Ft,Ut){var Ht=(65535&Ft)+(65535&Ut);return(Ft>>16)+(Ut>>16)+(Ht>>16)<<16|65535&Ht}function sn(Ft,Ut){return Ft<<Ut|Ft>>>32-Ut}_e.exports=function(Ft){return qt.hash(Ft,Jt,20,!0)}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){function qt(Ft,Ut){var Ht=(65535&Ft)+(65535&Ut);return(Ft>>16)+(Ut>>16)+(Ht>>16)<<16|65535&Ht}function Jt(Ft,Ut){return Ft>>>Ut|Ft<<32-Ut}function jt(Ft,Ut){var Ht,an,nn,dn,zt,Wt,Zt,mn,hn,zn,lr=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),ar=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),ur=new Array(64);Ft[Ut>>5]|=128<<24-Ut%32,Ft[15+(Ut+64>>9<<4)]=Ut;for(var Zn,wr,Vn,Kn,un,er,$n,xr,Wn=0;Wn<Ft.length;Wn+=16){Ht=ar[0],an=ar[1],nn=ar[2],dn=ar[3],zt=ar[4],Wt=ar[5],Zt=ar[6],mn=ar[7];for(var on=0;on<64;on++)ur[on]=on<16?Ft[on+Wn]:qt(qt(qt(Jt(xr=ur[on-2],17)^Jt(xr,19)^xr>>>10,ur[on-7]),Jt($n=ur[on-15],7)^Jt($n,18)^$n>>>3),ur[on-16]),hn=qt(qt(qt(qt(mn,Jt(er=zt,6)^Jt(er,11)^Jt(er,25)),(un=zt)&Wt^~un&Zt),lr[on]),ur[on]),zn=qt(Jt(Kn=Ht,2)^Jt(Kn,13)^Jt(Kn,22),(Zn=Ht)&(wr=an)^Zn&(Vn=nn)^wr&Vn),mn=Zt,Zt=Wt,Wt=zt,zt=qt(dn,hn),dn=nn,nn=an,an=Ht,Ht=qt(hn,zn);ar[0]=qt(Ht,ar[0]),ar[1]=qt(an,ar[1]),ar[2]=qt(nn,ar[2]),ar[3]=qt(dn,ar[3]),ar[4]=qt(zt,ar[4]),ar[5]=qt(Wt,ar[5]),ar[6]=qt(Zt,ar[6]),ar[7]=qt(mn,ar[7])}return ar}var sn=_("./helpers");_e.exports=function(Ft){return sn.hash(Ft,jt,32,!0)}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){function qt(){}(it=_e.exports={}).nextTick=function(){var Jt=typeof window<"u"&&window.setImmediate,jt=typeof window<"u"&&window.postMessage&&window.addEventListener;if(Jt)return function(Ft){return window.setImmediate(Ft)};if(jt){var sn=[];return window.addEventListener("message",function(Ft){var Ut=Ft.source;Ut!==window&&Ut!==null||Ft.data!=="process-tick"||(Ft.stopPropagation(),0<sn.length&&sn.shift()())},!0),function(Ft){sn.push(Ft),window.postMessage("process-tick","*")}}return function(Ft){setTimeout(Ft,0)}}(),it.title="browser",it.browser=!0,it.env={},it.argv=[],it.on=qt,it.addListener=qt,it.once=qt,it.off=qt,it.removeListener=qt,it.removeAllListeners=qt,it.emit=qt,it.binding=function(Jt){throw new Error("process.binding is not supported")},it.cwd=function(){return"/"},it.chdir=function(Jt){throw new Error("process.chdir is not supported")}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(_,_e,d){(function(it,ct,pt,At,St,Ot,Qt,Yt,Vt){d.read=function(qt,Jt,jt,sn,Ft){var Ut,Ht,an=8*Ft-sn-1,nn=(1<<an)-1,dn=nn>>1,zt=-7,Wt=jt?Ft-1:0,Zt=jt?-1:1,mn=qt[Jt+Wt];for(Wt+=Zt,Ut=mn&(1<<-zt)-1,mn>>=-zt,zt+=an;0<zt;Ut=256*Ut+qt[Jt+Wt],Wt+=Zt,zt-=8);for(Ht=Ut&(1<<-zt)-1,Ut>>=-zt,zt+=sn;0<zt;Ht=256*Ht+qt[Jt+Wt],Wt+=Zt,zt-=8);if(Ut===0)Ut=1-dn;else{if(Ut===nn)return Ht?NaN:1/0*(mn?-1:1);Ht+=Math.pow(2,sn),Ut-=dn}return(mn?-1:1)*Ht*Math.pow(2,Ut-sn)},d.write=function(qt,Jt,jt,sn,Ft,Ut){var Ht,an,nn,dn=8*Ut-Ft-1,zt=(1<<dn)-1,Wt=zt>>1,Zt=Ft===23?Math.pow(2,-24)-Math.pow(2,-77):0,mn=sn?0:Ut-1,hn=sn?1:-1,zn=Jt<0||Jt===0&&1/Jt<0?1:0;for(Jt=Math.abs(Jt),isNaN(Jt)||Jt===1/0?(an=isNaN(Jt)?1:0,Ht=zt):(Ht=Math.floor(Math.log(Jt)/Math.LN2),Jt*(nn=Math.pow(2,-Ht))<1&&(Ht--,nn*=2),2<=(Jt+=1<=Ht+Wt?Zt/nn:Zt*Math.pow(2,1-Wt))*nn&&(Ht++,nn/=2),zt<=Ht+Wt?(an=0,Ht=zt):1<=Ht+Wt?(an=(Jt*nn-1)*Math.pow(2,Ft),Ht+=Wt):(an=Jt*Math.pow(2,Wt-1)*Math.pow(2,Ft),Ht=0));8<=Ft;qt[jt+mn]=255&an,mn+=hn,an/=256,Ft-=8);for(Ht=Ht<<Ft|an,dn+=Ft;0<dn;qt[jt+mn]=255&Ht,mn+=hn,Ht/=256,dn-=8);qt[jt+mn-hn]|=128*zn}}).call(this,_("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(j){var _=function(){function _e(jt){return Qt(jt,Yt(Ot(Vt(jt.length),jt),1/jt.length))}function d(jt){return Ot(qt(jt),jt)}function it(jt,sn){return Yt(jt,sn?1/(jt.length-1):1/jt.length)}function ct(jt){var sn=function(Ut){var Ht,an=Math.pow(2,-52),nn=1e-64/an,dn=0,zt=0,Wt=0,Zt=0,mn=0,hn=Jt(Ut),zn=hn.length,lr=hn[0].length;if(zn<lr)throw"Need more rows than columns";var ar=new Array(lr),ur=new Array(lr);for(zt=0;zt<lr;zt++)ar[zt]=ur[zt]=0;var Zn=function Tr(kr,Br,ds){ds===void 0&&(ds=0);var is,Us=kr[ds],Os=Array(Us);if(ds===kr.length-1){for(is=Us-2;is>=0;is-=2)Os[is+1]=Br,Os[is]=Br;return is===-1&&(Os[0]=Br),Os}for(is=Us-1;is>=0;is--)Os[is]=Tr(kr,Br,ds+1);return Os}([lr,lr],0);function wr(Tr,kr){return(Tr=Math.abs(Tr))>(kr=Math.abs(kr))?Tr*Math.sqrt(1+kr*kr/Tr/Tr):kr==0?Tr:kr*Math.sqrt(1+Tr*Tr/kr/kr)}var Vn=0,Kn=0,un=0,er=0,$n=0,xr=0,Wn=0;for(zt=0;zt<lr;zt++){for(ar[zt]=Kn,Wn=0,mn=zt+1,Wt=zt;Wt<zn;Wt++)Wn+=hn[Wt][zt]*hn[Wt][zt];if(Wn<=nn)Kn=0;else for(Vn=hn[zt][zt],Kn=Math.sqrt(Wn),Vn>=0&&(Kn=-Kn),un=Vn*Kn-Wn,hn[zt][zt]=Vn-Kn,Wt=mn;Wt<lr;Wt++){for(Wn=0,Zt=zt;Zt<zn;Zt++)Wn+=hn[Zt][zt]*hn[Zt][Wt];for(Vn=Wn/un,Zt=zt;Zt<zn;Zt++)hn[Zt][Wt]+=Vn*hn[Zt][zt]}for(ur[zt]=Kn,Wn=0,Wt=mn;Wt<lr;Wt++)Wn+=hn[zt][Wt]*hn[zt][Wt];if(Wn<=nn)Kn=0;else{for(Vn=hn[zt][zt+1],Kn=Math.sqrt(Wn),Vn>=0&&(Kn=-Kn),un=Vn*Kn-Wn,hn[zt][zt+1]=Vn-Kn,Wt=mn;Wt<lr;Wt++)ar[Wt]=hn[zt][Wt]/un;for(Wt=mn;Wt<zn;Wt++){for(Wn=0,Zt=mn;Zt<lr;Zt++)Wn+=hn[Wt][Zt]*hn[zt][Zt];for(Zt=mn;Zt<lr;Zt++)hn[Wt][Zt]+=Wn*ar[Zt]}}($n=Math.abs(ur[zt])+Math.abs(ar[zt]))>er&&(er=$n)}for(zt=lr-1;zt!=-1;zt+=-1){if(Kn!=0){for(un=Kn*hn[zt][zt+1],Wt=mn;Wt<lr;Wt++)Zn[Wt][zt]=hn[zt][Wt]/un;for(Wt=mn;Wt<lr;Wt++){for(Wn=0,Zt=mn;Zt<lr;Zt++)Wn+=hn[zt][Zt]*Zn[Zt][Wt];for(Zt=mn;Zt<lr;Zt++)Zn[Zt][Wt]+=Wn*Zn[Zt][zt]}}for(Wt=mn;Wt<lr;Wt++)Zn[zt][Wt]=0,Zn[Wt][zt]=0;Zn[zt][zt]=1,Kn=ar[zt],mn=zt}for(zt=lr-1;zt!=-1;zt+=-1){for(mn=zt+1,Kn=ur[zt],Wt=mn;Wt<lr;Wt++)hn[zt][Wt]=0;if(Kn!=0){for(un=hn[zt][zt]*Kn,Wt=mn;Wt<lr;Wt++){for(Wn=0,Zt=mn;Zt<zn;Zt++)Wn+=hn[Zt][zt]*hn[Zt][Wt];for(Vn=Wn/un,Zt=zt;Zt<zn;Zt++)hn[Zt][Wt]+=Vn*hn[Zt][zt]}for(Wt=zt;Wt<zn;Wt++)hn[Wt][zt]=hn[Wt][zt]/Kn}else for(Wt=zt;Wt<zn;Wt++)hn[Wt][zt]=0;hn[zt][zt]+=1}for(an*=er,Zt=lr-1;Zt!=-1;Zt+=-1)for(var on=0;on<50;on++){var pn=!1;for(mn=Zt;mn!=-1;mn+=-1){if(Math.abs(ar[mn])<=an){pn=!0;break}if(Math.abs(ur[mn-1])<=an)break}if(!pn){dn=0,Wn=1;var On=mn-1;for(zt=mn;zt<Zt+1&&(Vn=Wn*ar[zt],ar[zt]=dn*ar[zt],!(Math.abs(Vn)<=an));zt++)for(un=wr(Vn,Kn=ur[zt]),ur[zt]=un,dn=Kn/un,Wn=-Vn/un,Wt=0;Wt<zn;Wt++)$n=hn[Wt][On],xr=hn[Wt][zt],hn[Wt][On]=$n*dn+xr*Wn,hn[Wt][zt]=-$n*Wn+xr*dn}if(xr=ur[Zt],mn==Zt){if(xr<0)for(ur[Zt]=-xr,Wt=0;Wt<lr;Wt++)Zn[Wt][Zt]=-Zn[Wt][Zt];break}if(on>=49)throw"Error: no convergence.";for(er=ur[mn],Kn=wr(Vn=((($n=ur[Zt-1])-xr)*($n+xr)+((Kn=ar[Zt-1])-(un=ar[Zt]))*(Kn+un))/(2*un*$n),1),Vn=Vn<0?((er-xr)*(er+xr)+un*($n/(Vn-Kn)-un))/er:((er-xr)*(er+xr)+un*($n/(Vn+Kn)-un))/er,dn=1,Wn=1,zt=mn+1;zt<Zt+1;zt++){for(Kn=ar[zt],$n=ur[zt],un=Wn*Kn,Kn*=dn,xr=wr(Vn,un),ar[zt-1]=xr,Vn=er*(dn=Vn/xr)+Kn*(Wn=un/xr),Kn=-er*Wn+Kn*dn,un=$n*Wn,$n*=dn,Wt=0;Wt<lr;Wt++)er=Zn[Wt][zt-1],xr=Zn[Wt][zt],Zn[Wt][zt-1]=er*dn+xr*Wn,Zn[Wt][zt]=-er*Wn+xr*dn;for(xr=wr(Vn,un),ur[zt-1]=xr,Vn=(dn=Vn/xr)*Kn+(Wn=un/xr)*$n,er=-Wn*Kn+dn*$n,Wt=0;Wt<zn;Wt++)$n=hn[Wt][zt-1],xr=hn[Wt][zt],hn[Wt][zt-1]=$n*dn+xr*Wn,hn[Wt][zt]=-$n*Wn+xr*dn}ar[mn]=0,ar[Zt]=Vn,ur[Zt]=er}for(zt=0;zt<ur.length;zt++)ur[zt]<an&&(ur[zt]=0);for(zt=0;zt<lr;zt++)for(Wt=zt-1;Wt>=0;Wt--)if(ur[Wt]<ur[zt]){for(dn=ur[Wt],ur[Wt]=ur[zt],ur[zt]=dn,Zt=0;Zt<hn.length;Zt++)Ht=hn[Zt][zt],hn[Zt][zt]=hn[Zt][Wt],hn[Zt][Wt]=Ht;for(Zt=0;Zt<Zn.length;Zt++)Ht=Zn[Zt][zt],Zn[Zt][zt]=Zn[Zt][Wt],Zn[Zt][Wt]=Ht;zt=Wt}return{U:hn,S:ur,V:Zn}}(jt);console.log(sn);var Ft=sn.U;return sn.S.map(function(Ut,Ht){var an={};return an.eigenvalue=Ut,an.vector=Ft.map(function(nn,dn){return-1*nn[Ht]}),an})}function pt(jt,...sn){var Ft=sn.map(function(an){return an.vector}),Ut=Ot(Ft,qt(_e(jt))),Ht=Yt(Ot(Vt(jt.length),jt),-1/jt.length);return{adjustedData:Ut,formattedAdjustedData:St(Ut,2),avgData:Ht,selectedVectors:Ft}}function At(jt){return ct(it(d(_e(jt)),!1))}function St(jt,sn){var Ft=Math.pow(10,sn||2);return jt.map(function(Ut,Ht){return Ut.map(function(an){return Math.round(an*Ft)/Ft})})}function Ot(jt,sn){if(!(jt[0]&&sn[0]&&jt.length&&sn.length))throw new Error("Both A and B should be matrices");if(sn.length!==jt[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var Ft=[],Ut=0;Ut<jt.length;Ut++){Ft[Ut]=[];for(var Ht=0;Ht<sn[0].length;Ht++)for(var an=0;an<jt[0].length;an++)Ft[Ut][Ht]=Ft[Ut][Ht]?Ft[Ut][Ht]+jt[Ut][an]*sn[an][Ht]:jt[Ut][an]*sn[an][Ht]}return Ft}function Qt(jt,sn){if(jt.length!==sn.length||jt[0].length!==sn[0].length)throw new Error("Both A and B should have the same dimensions");for(var Ft=[],Ut=0;Ut<jt.length;Ut++){Ft[Ut]=[];for(var Ht=0;Ht<sn[0].length;Ht++)Ft[Ut][Ht]=jt[Ut][Ht]-sn[Ut][Ht]}return Ft}function Yt(jt,sn){for(var Ft=[],Ut=0;Ut<jt.length;Ut++){Ft[Ut]=[];for(var Ht=0;Ht<jt[0].length;Ht++)Ft[Ut][Ht]=jt[Ut][Ht]*sn}return Ft}function Vt(jt){for(var sn=[],Ft=0;Ft<jt;Ft++){sn[Ft]=[];for(var Ut=0;Ut<jt;Ut++)sn[Ft][Ut]=1}return sn}function qt(jt){return Jt(jt)[0].map(function(sn,Ft){return jt.map(function(Ut){return Ut[Ft]})})}function Jt(jt){var sn=JSON.stringify(jt);return JSON.parse(sn)}return{computeDeviationScores:d,computeDeviationMatrix:_e,computeSVD:ct,computePercentageExplained:function(jt,...sn){var Ft=jt.map(function(Ut){return Ut.eigenvalue}).reduce(function(Ut,Ht){return Ut+Ht});return sn.map(function(Ut){return Ut.eigenvalue}).reduce(function(Ut,Ht){return Ut+Ht})/Ft},computeOriginalData:function(jt,sn,Ft){var Ut=Qt(qt(Ot(qt(sn),jt)),Ft);return{originalData:Ut,formattedOriginalData:St(Ut,2)}},computeVarianceCovariance:it,computeAdjustedData:pt,getEigenVectors:At,analyseTopResult:function(jt){var sn=At(jt).sort(function(Ft,Ut){return Ut.eigenvalue-Ft.eigenvalue});return console.log("Sorted Vectors",sn),pt(jt,sn[0].vector)},transpose:qt,multiply:Ot,clone:Jt,scale:Yt}}();j.exports=_},701:function(j){var _=[];function _e(ct){for(var pt=-1,At=0;At<_.length;At++)if(_[At].identifier===ct){pt=At;break}return pt}function d(ct,pt){for(var At={},St=[],Ot=0;Ot<ct.length;Ot++){var Qt=ct[Ot],Yt=pt.base?Qt[0]+pt.base:Qt[0],Vt=At[Yt]||0,qt="".concat(Yt," ").concat(Vt);At[Yt]=Vt+1;var Jt=_e(qt),jt={css:Qt[1],media:Qt[2],sourceMap:Qt[3],supports:Qt[4],layer:Qt[5]};if(Jt!==-1)_[Jt].references++,_[Jt].updater(jt);else{var sn=it(jt,pt);pt.byIndex=Ot,_.splice(Ot,0,{identifier:qt,updater:sn,references:1})}St.push(qt)}return St}function it(ct,pt){var At=pt.domAPI(pt);return At.update(ct),function(St){if(St){if(St.css===ct.css&&St.media===ct.media&&St.sourceMap===ct.sourceMap&&St.supports===ct.supports&&St.layer===ct.layer)return;At.update(ct=St)}else At.remove()}}j.exports=function(ct,pt){var At=d(ct=ct||[],pt=pt||{});return function(St){St=St||[];for(var Ot=0;Ot<At.length;Ot++){var Qt=_e(At[Ot]);_[Qt].references--}for(var Yt=d(St,pt),Vt=0;Vt<At.length;Vt++){var qt=_e(At[Vt]);_[qt].references===0&&(_[qt].updater(),_.splice(qt,1))}At=Yt}}},182:function(j){j.exports=function(_){var _e=document.createElement("style");return _.setAttributes(_e,_.attributes),_.insert(_e,_.options),_e}},850:function(j,_,_e){j.exports=function(d){var it=_e.nc;it&&d.setAttribute("nonce",it)}},236:function(j){j.exports=function(_){var _e=_.insertStyleElement(_);return{update:function(d){(function(it,ct,pt){var At="";pt.supports&&(At+="@supports (".concat(pt.supports,") {")),pt.media&&(At+="@media ".concat(pt.media," {"));var St=pt.layer!==void 0;St&&(At+="@layer".concat(pt.layer.length>0?" ".concat(pt.layer):""," {")),At+=pt.css,St&&(At+="}"),pt.media&&(At+="}"),pt.supports&&(At+="}");var Ot=pt.sourceMap;Ot&&typeof btoa<"u"&&(At+=`
/`,At+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Ot))))," *"),At+="/"),ct.styleTagTransform(At,it,ct.options)})(_e,_,d)},remove:function(){(function(d){if(d.parentNode===null)return!1;d.parentNode.removeChild(d)})(_e)}}}},213:function(j){j.exports=function(_,_e){if(_e.styleSheet)_e.styleSheet.cssText=_;else{for(;_e.firstChild;)_e.removeChild(_e.firstChild);_e.appendChild(document.createTextNode(_))}}},1:function(j){j.exports=function(){var _={820:function(ct,pt,At){var St=At(537),Ot=At.n(St),Qt=At(645),Yt=At.n(Qt)()(Ot());Yt.push([ct.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),pt.Z=Yt},645:function(ct){ct.exports=function(pt){var At=[];return At.toString=function(){return this.map(function(St){var Ot="",Qt=St[5]!==void 0;return St[4]&&(Ot+="@supports (".concat(St[4],") {")),St[2]&&(Ot+="@media ".concat(St[2]," {")),Qt&&(Ot+="@layer".concat(St[5].length>0?" ".concat(St[5]):""," {")),Ot+=pt(St),Qt&&(Ot+="}"),St[2]&&(Ot+="}"),St[4]&&(Ot+="}"),Ot}).join("")},At.i=function(St,Ot,Qt,Yt,Vt){typeof St=="string"&&(St=[[null,St,void 0]]);var qt={};if(Qt)for(var Jt=0;Jt<this.length;Jt++){var jt=this[Jt][0];jt!=null&&(qt[jt]=!0)}for(var sn=0;sn<St.length;sn++){var Ft=[].concat(St[sn]);Qt&&qt[Ft[0]]||(Vt!==void 0&&(Ft[5]===void 0||(Ft[1]="@layer".concat(Ft[5].length>0?" ".concat(Ft[5]):""," {").concat(Ft[1],"}")),Ft[5]=Vt),Ot&&(Ft[2]&&(Ft[1]="@media ".concat(Ft[2]," {").concat(Ft[1],"}")),Ft[2]=Ot),Yt&&(Ft[4]?(Ft[1]="@supports (".concat(Ft[4],") {").concat(Ft[1],"}"),Ft[4]=Yt):Ft[4]="".concat(Yt)),At.push(Ft))}},At}},537:function(ct){ct.exports=function(pt){var At=pt[1],St=pt[3];if(!St)return At;if(typeof btoa=="function"){var Ot=btoa(unescape(encodeURIComponent(JSON.stringify(St)))),Qt="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(Ot),Yt="/*# ".concat(Qt," */"),Vt=St.sources.map(function(qt){return"/*# sourceURL=".concat(St.sourceRoot||"").concat(qt," */")});return[At].concat(Vt).concat([Yt]).join(`
`)}return[At].join(`
`)}},379:function(ct){var pt=[];function At(Qt){for(var Yt=-1,Vt=0;Vt<pt.length;Vt++)if(pt[Vt].identifier===Qt){Yt=Vt;break}return Yt}function St(Qt,Yt){for(var Vt={},qt=[],Jt=0;Jt<Qt.length;Jt++){var jt=Qt[Jt],sn=Yt.base?jt[0]+Yt.base:jt[0],Ft=Vt[sn]||0,Ut="".concat(sn," ").concat(Ft);Vt[sn]=Ft+1;var Ht=At(Ut),an={css:jt[1],media:jt[2],sourceMap:jt[3],supports:jt[4],layer:jt[5]};if(Ht!==-1)pt[Ht].references++,pt[Ht].updater(an);else{var nn=Ot(an,Yt);Yt.byIndex=Jt,pt.splice(Jt,0,{identifier:Ut,updater:nn,references:1})}qt.push(Ut)}return qt}function Ot(Qt,Yt){var Vt=Yt.domAPI(Yt);return Vt.update(Qt),function(qt){if(qt){if(qt.css===Qt.css&&qt.media===Qt.media&&qt.sourceMap===Qt.sourceMap&&qt.supports===Qt.supports&&qt.layer===Qt.layer)return;Vt.update(Qt=qt)}else Vt.remove()}}ct.exports=function(Qt,Yt){var Vt=St(Qt=Qt||[],Yt=Yt||{});return function(qt){qt=qt||[];for(var Jt=0;Jt<Vt.length;Jt++){var jt=At(Vt[Jt]);pt[jt].references--}for(var sn=St(qt,Yt),Ft=0;Ft<Vt.length;Ft++){var Ut=At(Vt[Ft]);pt[Ut].references===0&&(pt[Ut].updater(),pt.splice(Ut,1))}Vt=sn}}},216:function(ct){ct.exports=function(pt){var At=document.createElement("style");return pt.setAttributes(At,pt.attributes),pt.insert(At,pt.options),At}},636:function(ct,pt,At){ct.exports=function(St){var Ot=At.nc;Ot&&St.setAttribute("nonce",Ot)}},795:function(ct){ct.exports=function(pt){var At=pt.insertStyleElement(pt);return{update:function(St){(function(Ot,Qt,Yt){var Vt="";Yt.supports&&(Vt+="@supports (".concat(Yt.supports,") {")),Yt.media&&(Vt+="@media ".concat(Yt.media," {"));var qt=Yt.layer!==void 0;qt&&(Vt+="@layer".concat(Yt.layer.length>0?" ".concat(Yt.layer):""," {")),Vt+=Yt.css,qt&&(Vt+="}"),Yt.media&&(Vt+="}"),Yt.supports&&(Vt+="}");var Jt=Yt.sourceMap;Jt&&typeof btoa<"u"&&(Vt+=`
/`,Vt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Jt))))," *"),Vt+="/"),Qt.styleTagTransform(Vt,Ot,Qt.options)})(At,pt,St)},remove:function(){(function(St){if(St.parentNode===null)return!1;St.parentNode.removeChild(St)})(At)}}}},589:function(ct){ct.exports=function(pt,At){if(At.styleSheet)At.styleSheet.cssText=pt;else{for(;At.firstChild;)At.removeChild(At.firstChild);At.appendChild(document.createTextNode(pt))}}}},_e={};function d(ct){var pt=_e[ct];if(pt!==void 0)return pt.exports;var At=_e[ct]={id:ct,exports:{}};return _[ct](At,At.exports,d),At.exports}d.n=function(ct){var pt=ct&&ct.__esModule?function(){return ct.default}:function(){return ct};return d.d(pt,{a:pt}),pt},d.d=function(ct,pt){for(var At in pt)d.o(pt,At)&&!d.o(ct,At)&&Object.defineProperty(ct,At,{enumerable:!0,get:pt[At]})},d.o=function(ct,pt){return Object.prototype.hasOwnProperty.call(ct,pt)},d.nc=void 0;var it={};return function(){d.d(it,{default:function(){return ur}});var ct=d(379),pt=d.n(ct),At=d(795),St=d.n(At),Ot=d(636),Qt=d.n(Ot),Yt=d(216),Vt=d.n(Yt),qt=d(589),Jt=d.n(qt),jt=d(820),sn={};jt.Z&&jt.Z.locals&&(sn.locals=jt.Z.locals);var Ft,Ut=0,Ht={};Ht.styleTagTransform=Jt(),Ht.setAttributes=Qt(),Ht.insert=function(Zn,wr){(wr.target||document.head).appendChild(Zn)},Ht.domAPI=St(),Ht.insertStyleElement=Vt(),sn.use=function(Zn){return Ht.options=Zn||{},Ut++||(Ft=pt()(jt.Z,Ht)),sn},sn.unuse=function(){Ut>0&&!--Ut&&(Ft(),Ft=null)};var an=sn;function nn(Zn,wr){return function(Vn){if(Array.isArray(Vn))return Vn}(Zn)||function(Vn,Kn){var un=Vn==null?null:typeof Symbol<"u"&&Vn[Symbol.iterator]||Vn["@@iterator"];if(un!=null){var er,$n,xr=[],Wn=!0,on=!1;try{for(un=un.call(Vn);!(Wn=(er=un.next()).done)&&(xr.push(er.value),!Kn||xr.length!==Kn);Wn=!0);}catch(pn){on=!0,$n=pn}finally{try{Wn||un.return==null||un.return()}finally{if(on)throw $n}}return xr}}(Zn,wr)||function(Vn,Kn){if(Vn){if(typeof Vn=="string")return dn(Vn,Kn);var un=Object.prototype.toString.call(Vn).slice(8,-1);return un==="Object"&&Vn.constructor&&(un=Vn.constructor.name),un==="Map"||un==="Set"?Array.from(Vn):un==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(un)?dn(Vn,Kn):void 0}}(Zn,wr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function dn(Zn,wr){(wr==null||wr>Zn.length)&&(wr=Zn.length);for(var Vn=0,Kn=new Array(wr);Vn<wr;Vn++)Kn[Vn]=Zn[Vn];return Kn}function zt(Zn,wr){var Vn=Object.keys(Zn);if(Object.getOwnPropertySymbols){var Kn=Object.getOwnPropertySymbols(Zn);wr&&(Kn=Kn.filter(function(un){return Object.getOwnPropertyDescriptor(Zn,un).enumerable})),Vn.push.apply(Vn,Kn)}return Vn}function Wt(Zn){for(var wr=1;wr<arguments.length;wr++){var Vn=arguments[wr]!=null?arguments[wr]:{};wr%2?zt(Object(Vn),!0).forEach(function(Kn){Zt(Zn,Kn,Vn[Kn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Zn,Object.getOwnPropertyDescriptors(Vn)):zt(Object(Vn)).forEach(function(Kn){Object.defineProperty(Zn,Kn,Object.getOwnPropertyDescriptor(Vn,Kn))})}return Zn}function Zt(Zn,wr,Vn){return wr in Zn?Object.defineProperty(Zn,wr,{value:Vn,enumerable:!0,configurable:!0,writable:!0}):Zn[wr]=Vn,Zn}function mn(Zn,wr){for(var Vn=0;Vn<wr.length;Vn++){var Kn=wr[Vn];Kn.enumerable=Kn.enumerable||!1,Kn.configurable=!0,"value"in Kn&&(Kn.writable=!0),Object.defineProperty(Zn,Kn.key,Kn)}}function hn(Zn){var wr={};return Zn.reduce(function(Vn,Kn){return wr[Kn]||(wr[Kn]=!0,Vn.push(Kn)),Vn},[])}function zn(Zn,wr){requestAnimationFrame(function(){wr.enter(),requestAnimationFrame(function(){wr.active(),setTimeout(function(){wr.leave()},Zn)})})}function lr(Zn,wr){try{var Vn=Zn.liElementsById[wr.parent.id];Vn.classList.contains("treejs-node__close")||Vn.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(wr,"parent")&&lr(Zn,wr.parent)}function ar(Zn,wr){var Vn=Zn.liElementsById[wr.id];Vn.classList.contains("treejs-node__close")&&Vn.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(wr,"children")&&wr.children.forEach(function(Kn){return ar(Zn,Kn)})}var ur=function(){function Zn(un,er){(function($n,xr){if(!($n instanceof xr))throw new TypeError("Cannot call a class as a function")})(this,Zn),an.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=un,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},er),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function($n){this.setValues(hn($n))}},disables:{get:function(){return this.getDisables()},set:function($n){this.setDisables(hn($n))}},selectedNodes:{get:function(){var $n=[],xr=this.nodesById;return Object.keys(xr).forEach(function(Wn){if(Object.prototype.hasOwnProperty.call(xr,Wn)&&(xr[Wn].status===1||xr[Wn].status===2)){var on=Wt({},xr[Wn]);delete on.parent,delete on.children,$n.push(on)}}),$n}},disabledNodes:{get:function(){var $n=[],xr=this.nodesById;return Object.keys(xr).forEach(function(Wn){if(Object.prototype.hasOwnProperty.call(xr,Wn)&&xr[Wn].disabled){var on=Wt({},xr[Wn]);delete on.parent,$n.push(on)}}),$n}}}),this.init(this.options.data)}var wr,Vn,Kn;return wr=Zn,Kn=[{key:"onSwitcherClick",value:function(un){var er=un.parentNode,$n=er.lastChild,xr=$n.scrollHeight;er.classList.contains("treejs-node__close")?zn(150,{enter:function(){$n.style.height=0,$n.style.opacity=0},active:function(){$n.style.height="".concat(xr,"px"),$n.style.opacity=1},leave:function(){$n.style.height="",$n.style.opacity="",er.classList.remove("treejs-node__close")}}):zn(150,{enter:function(){$n.style.height="".concat(xr,"px"),$n.style.opacity=1},active:function(){$n.style.height=0,$n.style.opacity=0},leave:function(){$n.style.height="",$n.style.opacity="",er.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(un){var er,$n=(er=un,JSON.parse(JSON.stringify(er))),xr={},Wn={},on=[],pn=[];return function On(Tr,kr){Tr.forEach(function(Br){xr[Br.id]=Br,Br.checked&&on.push(Br.id),Br.disabled&&pn.push(Br.id),kr&&(Br.parent=kr),Br.children&&Br.children.length?On(Br.children,Br):Wn[Br.id]=Br})}($n),{treeNodes:$n,nodesById:xr,leafNodesById:Wn,defaultValues:on,defaultDisables:pn}}},{key:"createRootEle",value:function(){var un=document.createElement("div");return un.classList.add("treejs"),un}},{key:"createUlEle",value:function(){var un=document.createElement("ul");return un.classList.add("treejs-nodes"),un}},{key:"createLiEle",value:function(un,er){var $n=document.createElement("li");if($n.classList.add("treejs-node"),er&&$n.classList.add("treejs-node__close"),un.children&&un.children.length){var xr=document.createElement("span");xr.classList.add("treejs-switcher"),$n.appendChild(xr)}else $n.classList.add("treejs-placeholder");var Wn=document.createElement("span");Wn.classList.add("treejs-checkbox"),$n.appendChild(Wn);var on=document.createElement("span");on.classList.add("treejs-label");var pn=document.createTextNode(un.text);return on.appendChild(pn),$n.appendChild(on),$n.nodeId=un.id,$n}}],(Vn=[{key:"init",value:function(un){var er=Zn.parseTreeData(un),$n=er.treeNodes,xr=er.nodesById,Wn=er.leafNodesById,on=er.defaultValues,pn=er.defaultDisables;this.treeNodes=$n,this.nodesById=xr,this.leafNodesById=Wn,this.render(this.treeNodes);var On=this.options,Tr=On.values,kr=On.disables,Br=On.loaded;Tr&&Tr.length?this.setValues(Tr):on&&on.length&&this.setValues(on),kr&&kr.length?this.setDisables(kr):pn&&pn.length&&this.setDisables(pn),typeof Br=="function"&&Br.call(this)}},{key:"render",value:function(un){var er=Zn.createRootEle();er.appendChild(this.buildTree(un,0)),this.bindEvent(er);var $n=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(xr){for(;xr.firstChild;)xr.removeChild(xr.firstChild)})($n),$n.appendChild(er)}},{key:"buildTree",value:function(un,er){var $n=this,xr=Zn.createUlEle();return un&&un.length&&un.forEach(function(Wn){var on=Zn.createLiEle(Wn,er===$n.options.closeDepth-1);$n.liElementsById[Wn.id]=on;var pn=null;Wn.children&&Wn.children.length&&(pn=$n.buildTree(Wn.children,er+1)),pn&&on.appendChild(pn),xr.appendChild(on)}),xr}},{key:"bindEvent",value:function(un){var er=this;un.addEventListener("click",function($n){var xr=$n.target;xr.nodeName==="SPAN"&&xr.classList.contains("treejs-checkbox")?er.onItemClick(xr.parentNode.nodeId):xr.nodeName==="SPAN"&&xr.classList.contains("treejs-label")?er.onItemLabelClick(xr.parentNode.nodeId):xr.nodeName==="LI"&&xr.classList.contains("treejs-node")?er.onItemClick(xr.nodeId):xr.nodeName==="SPAN"&&xr.classList.contains("treejs-switcher")&&Zn.onSwitcherClick(xr)},!1)}},{key:"onItemClick",value:function(un){var er=this.nodesById[un],$n=this.options.onChange;er.disabled||(this.setValue(un),this.updateLiElements()),$n&&$n.call(this)}},{key:"onItemLabelClick",value:function(un){var er=this.options.onItemLabelClick;er&&er.call(this,un)}},{key:"setValue",value:function(un){var er=this.nodesById[un];if(er){var $n=er.status,xr=$n===1||$n===2?0:2;er.status=xr,this.markWillUpdateNode(er),this.walkUp(er,"status"),this.walkDown(er,"status")}}},{key:"getValues",value:function(){var un=this,er=[];return Object.keys(this.leafNodesById).forEach(function($n){Object.prototype.hasOwnProperty.call(un.leafNodesById,$n)&&(un.leafNodesById[$n].status!==1&&un.leafNodesById[$n].status!==2||er.push($n))}),er}},{key:"setValues",value:function(un){var er=this;this.emptyNodesCheckStatus(),un.forEach(function(xr){er.setValue(xr)}),this.updateLiElements();var $n=this.options.onChange;$n&&$n.call(this)}},{key:"setDisable",value:function(un){var er=this.nodesById[un];er&&(er.disabled||(er.disabled=!0,this.markWillUpdateNode(er),this.walkUp(er,"disabled"),this.walkDown(er,"disabled")))}},{key:"getDisables",value:function(){var un=this,er=[];return Object.keys(this.leafNodesById).forEach(function($n){Object.prototype.hasOwnProperty.call(un.leafNodesById,$n)&&un.leafNodesById[$n].disabled&&er.push($n)}),er}},{key:"setDisables",value:function(un){var er=this;this.emptyNodesDisable(),un.forEach(function($n){er.setDisable($n)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(un){un.disabled||(un.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(un){un.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(un,er){var $n=nn(er,2),xr=$n[0],Wn=$n[1];return Wn.status!==1&&Wn.status!==2||(un[xr]=Wn),un},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(un,er){var $n=nn(er,2),xr=$n[0],Wn=$n[1];return Wn.disabled&&(un[xr]=Wn),un},{})}},{key:"updateLiElements",value:function(){var un=this;Object.values(this.willUpdateNodesById).forEach(function(er){un.updateLiElement(er)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(un){this.willUpdateNodesById[un.id]=un}},{key:"walkUp",value:function(un,er){var $n=un.parent;if($n){if(er==="status"){var xr,Wn=$n.children.reduce(function(pn,On){return Number.isNaN(On.status)?pn:pn+On.status},0);if(xr=Wn?Wn===2*$n.children.length?2:1:0,$n.status===xr)return;$n.status=xr}else{var on=$n.children.reduce(function(pn,On){return pn&&On.disabled},!0);if($n.disabled===on)return;$n.disabled=on}this.markWillUpdateNode($n),this.walkUp($n,er)}}},{key:"walkDown",value:function(un,er){var $n=this;un.children&&un.children.length&&un.children.forEach(function(xr){er==="status"&&xr.disabled||(xr[er]=un[er],$n.markWillUpdateNode(xr),$n.walkDown(xr,er))})}},{key:"updateLiElement",value:function(un){var er=this.liElementsById[un.id].classList;switch(un.status){case 0:er.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:er.remove("treejs-node__checked"),er.add("treejs-node__halfchecked");break;case 2:er.remove("treejs-node__halfchecked"),er.add("treejs-node__checked")}switch(un.disabled){case!0:er.contains("treejs-node__disabled")||er.add("treejs-node__disabled");break;case!1:er.contains("treejs-node__disabled")&&er.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var un=this;Object.keys(this.leafNodesById).forEach(function(er){var $n=un.leafNodesById[er];lr(un,$n)})}},{key:"expandAll",value:function(){ar(this,this.treeNodes[0])}}])&&mn(wr.prototype,Vn),Kn&&mn(wr,Kn),Object.defineProperty(wr,"prototype",{writable:!1}),Zn}()}(),it.default}()},819:function(j,_){(function(_e){const d="tp";function it(sn){return Ft=>Ut=>{if(!Ft&&Ut===void 0)return{succeeded:!1,value:void 0};if(Ft&&Ut===void 0)return{succeeded:!0,value:void 0};const Ht=sn(Ut);return Ht!==void 0?{succeeded:!0,value:Ht}:{succeeded:!1,value:void 0}}}function ct(sn){return{custom:Ft=>it(Ft)(sn),boolean:it(Ft=>typeof Ft=="boolean"?Ft:void 0)(sn),number:it(Ft=>typeof Ft=="number"?Ft:void 0)(sn),string:it(Ft=>typeof Ft=="string"?Ft:void 0)(sn),function:it(Ft=>typeof Ft=="function"?Ft:void 0)(sn),constant:Ft=>it(Ut=>Ut===Ft?Ft:void 0)(sn),raw:it(Ft=>Ft)(sn),object:Ft=>it(Ut=>{if((Ht=Ut)!==null&&typeof Ht=="object")return function(an,nn){return Object.keys(nn).reduce((dn,zt)=>{if(dn===void 0)return;const Wt=(0,nn[zt])(an[zt]);return Wt.succeeded?Object.assign(Object.assign({},dn),{[zt]:Wt.value}):void 0},{})}(Ut,Ft);var Ht})(sn),array:Ft=>it(Ut=>{if(Array.isArray(Ut))return Ht=Ft,Ut.reduce((an,nn)=>{if(an===void 0)return;const dn=Ht(nn);return dn.succeeded&&dn.value!==void 0?[...an,dn.value]:void 0},[]);var Ht})(sn)}}const pt={optional:ct(!0),required:ct(!1)};function At(sn,Ft,Ut,Ht){return new(Ut||(Ut=Promise))(function(an,nn){function dn(Zt){try{Wt(Ht.next(Zt))}catch(mn){nn(mn)}}function zt(Zt){try{Wt(Ht.throw(Zt))}catch(mn){nn(mn)}}function Wt(Zt){var mn;Zt.done?an(Zt.value):(mn=Zt.value,mn instanceof Ut?mn:new Ut(function(hn){hn(mn)})).then(dn,zt)}Wt((Ht=Ht.apply(sn,Ft||[])).next())})}function St(sn){return At(this,void 0,void 0,function*(){const Ft=new Image;return Ft.crossOrigin="anonymous",new Promise((Ut,Ht)=>{Ft.src=sn,Ft.onload=()=>{Ut(Ft)},Ft.onerror=Ht})})}const Ot=(Qt="img",(sn,Ft)=>[d,"-",Qt,"v",sn?`_${sn}`:"",Ft?`-${Ft}`:""].join(""));var Qt;class Yt{constructor(Ft,Ut){this.element=Ft.createElement("div"),this.element.classList.add(Ot()),Ut.viewProps.bindClassModifiers(this.element),this.input=Ft.createElement("input"),this.input.classList.add(Ot("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Ut.extensions.join(",")),this.image_=Ft.createElement("img"),this.image_.classList.add(Ot("image")),this.image_.classList.add(Ot(`image_${Ut.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Ht=>{Ut.clickCallback?Ut.clickCallback(Ht,this.input):this.input.click()},this.element.classList.add(Ot("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Ft){this.image_.src=Ft}changeDraggingState(Ft){const Ut=this.element;Ft?Ut==null||Ut.classList.add(Ot("area_dragging")):Ut==null||Ut.classList.remove(Ot("area_dragging"))}}let Vt=null;class qt{constructor(Ft,Ut){this.value=Ut.value,this.viewProps=Ut.viewProps,this.view=new Yt(Ft,{viewProps:this.viewProps,extensions:Ut.extensions,imageFit:Ut.imageFit,clickCallback:Ut.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Ft){const Ut=(Ft==null?void 0:Ft.target).files;if(!Ut||!Ut.length)return;const Ht=Ut[0];this.setValue(Ht)}onDrop(Ft){return At(this,void 0,void 0,function*(){Ft.preventDefault();try{const{dataTransfer:Ut}=Ft,Ht=Ut==null?void 0:Ut.files[0];if(Ht)this.setValue(Ht);else{const an=Ut==null?void 0:Ut.getData("url");if(!an)throw new Error("No url");this.setValue(an)}}catch(Ut){console.error("Could not parse the dropped image",Ut)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Ft){Ft.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Ft){return At(this,void 0,void 0,function*(){Ft instanceof HTMLImageElement?this.updateImage(Ft.src):typeof Ft!="string"&&Ft?yield this.setValue(Ft):(Ft!=="placeholder"&&Ft||(Ft=(yield this.handlePlaceholderImage()).src),this.updateImage(Ft))})}updateImage(Ft){this.view.changeImage(Ft)}setValue(Ft){return At(this,void 0,void 0,function*(){if(Ft instanceof HTMLImageElement)this.value.setRawValue(Ft);else if(Ft instanceof File){const Ut=URL.createObjectURL(Ft)+"#"+Ft.name;Ft.src=Ut;const Ht=yield St(Ut).catch(()=>{});this.value.setRawValue(Ht||Ft)}else Ft?this.value.setRawValue(yield St(Ft)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return At(this,void 0,void 0,function*(){return Vt||(Vt=yield function(){const Ft=document.createElement("canvas");Ft.width=320,Ft.height=50;const Ut=Ft.getContext("2d");return Ut.fillStyle="#00000004",Ut.fillRect(0,0,Ft.width,Ft.height),Ut.fillStyle="#eee",Ut.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Ut.textAlign="center",Ut.textBaseline="middle",Ut.fillText("No image",.5*Ft.width,.5*Ft.height),new Promise(Ht=>{Ft.toBlob(an=>{const nn=new Image;nn.src=URL.createObjectURL(an),nn.isPlaceholder=!0,nn.onload=()=>{Ht(nn)}})})}()),Vt})}}const Jt=[".jpg",".png",".gif"],jt={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(sn,Ft){if(!(sn instanceof HTMLImageElement||typeof sn=="string"))return null;const Ut=pt,Ht=function(an,nn){const dn=pt.required.object(nn)(an);return dn.succeeded?dn.value:void 0}(Ft,{view:Ut.required.constant("input-image"),acceptUrl:Ut.optional.boolean,clickCallback:Ut.optional.function,imageFit:Ut.optional.custom(an=>an==="contain"||an==="cover"?an:void 0),extensions:Ut.optional.array(Ut.required.string)});return Ht?{initialValue:sn,params:Ht}:null},binding:{reader:sn=>Ft=>Ft.src!==void 0?Ft.src===""?"placeholder":Ft.src:Ft,writer:sn=>(Ft,Ut)=>{Ft.write(Ut)}},controller(sn){var Ft,Ut;return new qt(sn.document,{value:sn.value,imageFit:(Ft=sn.params.imageFit)!==null&&Ft!==void 0?Ft:"cover",clickCallback:sn.params.clickCallback,viewProps:sn.viewProps,extensions:(Ut=sn.params.extensions)!==null&&Ut!==void 0?Ut:Jt})}};_e.plugin=jt,Object.defineProperty(_e,"__esModule",{value:!0})})(_)},665:function(j,_){(function(_e){class d{constructor(at){this.controller_=at}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(at){this.controller_.viewProps.set("disabled",at)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(at){this.controller_.viewProps.set("hidden",at)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class it{constructor(at){this.target=at}}class ct extends it{constructor(at,ft,Dt,tn){super(at),this.value=ft,this.presetKey=Dt,this.last=tn==null||tn}}class pt extends it{constructor(at,ft,Dt){super(at),this.value=ft,this.presetKey=Dt}}class At extends it{constructor(at,ft){super(at),this.expanded=ft}}function St(bt){return bt==null}function Ot(bt,at){if(bt.length!==at.length)return!1;for(let ft=0;ft<bt.length;ft++)if(bt[ft]!==at[ft])return!1;return!0}const Qt={alreadydisposed:()=>"View has been already disposed",invalidparams:bt=>`Invalid parameters for '${bt.name}'`,nomatchingcontroller:bt=>`No matching controller for '${bt.key}'`,nomatchingview:bt=>`No matching view for '${JSON.stringify(bt.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:bt=>`Property '${bt.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Yt{constructor(at){var ft;this.message=(ft=Qt[at.type](at.context))!==null&&ft!==void 0?ft:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=at.type}static alreadyDisposed(){return new Yt({type:"alreadydisposed"})}static notBindable(){return new Yt({type:"notbindable"})}static propertyNotFound(at){return new Yt({type:"propertynotfound",context:{name:at}})}static shouldNeverHappen(){return new Yt({type:"shouldneverhappen"})}}class Vt{constructor(at,ft,Dt){this.obj_=at,this.key_=ft,this.presetKey_=Dt??ft}static isBindable(at){return at!==null&&typeof at=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(at){this.obj_[this.key_]=at}writeProperty(at,ft){const Dt=this.read();if(!Vt.isBindable(Dt))throw Yt.notBindable();if(!(at in Dt))throw Yt.propertyNotFound(at);Dt[at]=ft}}class qt extends d{get label(){return this.controller_.props.get("label")}set label(at){this.controller_.props.set("label",at)}get title(){var at;return(at=this.controller_.valueController.props.get("title"))!==null&&at!==void 0?at:""}set title(at){this.controller_.valueController.props.set("title",at)}on(at,ft){const Dt=ft.bind(this);return this.controller_.valueController.emitter.on(at,()=>{Dt(new it(this))}),this}}class Jt{constructor(){this.observers_={}}on(at,ft){let Dt=this.observers_[at];return Dt||(Dt=this.observers_[at]=[]),Dt.push({handler:ft}),this}off(at,ft){const Dt=this.observers_[at];return Dt&&(this.observers_[at]=Dt.filter(tn=>tn.handler!==ft)),this}emit(at,ft){const Dt=this.observers_[at];Dt&&Dt.forEach(tn=>{tn.handler(ft)})}}const jt="tp";function sn(bt){return(at,ft)=>[jt,"-",bt,"v",at?`_${at}`:"",ft?`-${ft}`:""].join("")}function Ft(bt){return bt.rawValue}function Ut(bt,at){var ft,Dt;bt.emitter.on("change",(ft=Ft,Dt=at,tn=>Dt(ft(tn)))),at(bt.rawValue)}function Ht(bt,at,ft){Ut(bt.value(at),ft)}function an(bt,at){return ft=>{(function(Dt,tn,Sn){Sn?Dt.classList.add(tn):Dt.classList.remove(tn)})(bt,at,ft)}}function nn(bt,at){Ut(bt,ft=>{at.textContent=ft??""})}const dn=sn("btn");class zt{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(dn()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("button");Dt.classList.add(dn("b")),ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.buttonElement=Dt;const tn=at.createElement("div");tn.classList.add(dn("t")),nn(ft.props.value("title"),tn),this.buttonElement.appendChild(tn)}}class Wt{constructor(at,ft){this.emitter=new Jt,this.onClick_=this.onClick_.bind(this),this.props=ft.props,this.viewProps=ft.viewProps,this.view=new zt(at,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Zt{constructor(at,ft){var Dt;this.constraint_=ft==null?void 0:ft.constraint,this.equals_=(Dt=ft==null?void 0:ft.equals)!==null&&Dt!==void 0?Dt:(tn,Sn)=>tn===Sn,this.emitter=new Jt,this.rawValue_=at}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(at){this.setRawValue(at,{forceEmit:!1,last:!0})}setRawValue(at,ft){const Dt=ft??{forceEmit:!1,last:!0},tn=this.constraint_?this.constraint_.constrain(at):at;(!this.equals_(this.rawValue_,tn)||Dt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=tn,this.emitter.emit("change",{options:Dt,rawValue:tn,sender:this}))}}class mn{constructor(at){this.emitter=new Jt,this.value_=at}get rawValue(){return this.value_}set rawValue(at){this.setRawValue(at,{forceEmit:!1,last:!0})}setRawValue(at,ft){const Dt=ft??{forceEmit:!1,last:!0};(this.value_!==at||Dt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=at,this.emitter.emit("change",{options:Dt,rawValue:this.value_,sender:this}))}}function hn(bt,at){const ft=at==null?void 0:at.constraint,Dt=at==null?void 0:at.equals;return ft||Dt?new Zt(bt,at):new mn(bt)}class zn{constructor(at){this.emitter=new Jt,this.valMap_=at;for(const ft in this.valMap_)this.valMap_[ft].emitter.on("change",()=>{this.emitter.emit("change",{key:ft,sender:this})})}static createCore(at){return Object.keys(at).reduce((ft,Dt)=>Object.assign(ft,{[Dt]:hn(at[Dt])}),{})}static fromObject(at){const ft=this.createCore(at);return new zn(ft)}get(at){return this.valMap_[at].rawValue}set(at,ft){this.valMap_[at].rawValue=ft}value(at){return this.valMap_[at]}}function lr(bt){return at=>ft=>{if(!at&&ft===void 0)return{succeeded:!1,value:void 0};if(at&&ft===void 0)return{succeeded:!0,value:void 0};const Dt=bt(ft);return Dt!==void 0?{succeeded:!0,value:Dt}:{succeeded:!1,value:void 0}}}function ar(bt){return{custom:at=>lr(at)(bt),boolean:lr(at=>typeof at=="boolean"?at:void 0)(bt),number:lr(at=>typeof at=="number"?at:void 0)(bt),string:lr(at=>typeof at=="string"?at:void 0)(bt),function:lr(at=>typeof at=="function"?at:void 0)(bt),constant:at=>lr(ft=>ft===at?at:void 0)(bt),raw:lr(at=>at)(bt),object:at=>lr(ft=>{if((Dt=ft)!==null&&typeof Dt=="object")return function(tn,Sn){return Object.keys(Sn).reduce((Bn,pr)=>{if(Bn===void 0)return;const Or=(0,Sn[pr])(tn[pr]);return Or.succeeded?Object.assign(Object.assign({},Bn),{[pr]:Or.value}):void 0},{})}(ft,at);var Dt})(bt),array:at=>lr(ft=>{if(Array.isArray(ft))return Dt=at,ft.reduce((tn,Sn)=>{if(tn===void 0)return;const Bn=Dt(Sn);return Bn.succeeded&&Bn.value!==void 0?[...tn,Bn.value]:void 0},[]);var Dt})(bt)}}const ur={optional:ar(!0),required:ar(!1)};function Zn(bt,at){const ft=ur.required.object(at)(bt);return ft.succeeded?ft.value:void 0}const wr=sn(""),Vn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Kn{constructor(at){this.parent_=null,this.blade=at.blade,this.view=at.view,this.viewProps=at.viewProps;const ft=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Dt=>{ft.classList.remove(wr(void 0,Vn[Dt]))}),this.blade.get("positions").forEach(Dt=>{ft.classList.add(wr(void 0,Vn[Dt]))})}),this.viewProps.handleDispose(()=>{(function(Dt){Dt&&Dt.parentElement&&Dt.parentElement.removeChild(Dt)})(ft)})}get parent(){return this.parent_}}const un="http://www.w3.org/2000/svg";function er(bt){bt.offsetHeight}function $n(bt){return bt.ontouchstart!==void 0}function xr(){return new Function("return this")().document}const Wn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function on(bt,at){const ft=bt.createElementNS(un,"svg");return ft.innerHTML=Wn[at],ft}function pn(bt,at,ft){bt.insertBefore(at,bt.children[ft])}function On(bt){bt.parentElement&&bt.parentElement.removeChild(bt)}function Tr(bt){for(;bt.children.length>0;)bt.removeChild(bt.children[0])}function kr(bt){return bt.relatedTarget?bt.relatedTarget:"explicitOriginalTarget"in bt?bt.explicitOriginalTarget:null}const Br=sn("lbl");class ds{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(Br()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("div");Dt.classList.add(Br("l")),Ht(ft.props,"label",Sn=>{St(Sn)?this.element.classList.add(Br(void 0,"nol")):(this.element.classList.remove(Br(void 0,"nol")),function(Bn){for(;Bn.childNodes.length>0;)Bn.removeChild(Bn.childNodes[0])}(Dt),Dt.appendChild(function(Bn,pr){const Or=Bn.createDocumentFragment();return pr.split(`
`).map(As=>Bn.createTextNode(As)).forEach((As,Ds)=>{Ds>0&&Or.appendChild(Bn.createElement("br")),Or.appendChild(As)}),Or}(at,Sn)))}),this.element.appendChild(Dt),this.labelElement=Dt;const tn=at.createElement("div");tn.classList.add(Br("v")),this.element.appendChild(tn),this.valueElement=tn}}class is extends Kn{constructor(at,ft){const Dt=ft.valueController.viewProps;super(Object.assign(Object.assign({},ft),{view:new ds(at,{props:ft.props,viewProps:Dt}),viewProps:Dt})),this.props=ft.props,this.valueController=ft.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Us={id:"button",type:"blade",accept(bt){const at=ur,ft=Zn(bt,{title:at.required.string,view:at.required.constant("button"),label:at.optional.string});return ft?{params:ft}:null},controller:bt=>new is(bt.document,{blade:bt.blade,props:zn.fromObject({label:bt.params.label}),valueController:new Wt(bt.document,{props:zn.fromObject({title:bt.params.title}),viewProps:bt.viewProps})}),api:bt=>bt.controller instanceof is&&bt.controller.valueController instanceof Wt?new qt(bt.controller):null};class Os extends Kn{constructor(at){super(at),this.value=at.value}}function go(){return new zn({positions:hn([],{equals:Ot})})}class ks extends zn{constructor(at){super(at)}static create(at){const ft={completed:!0,expanded:at,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Dt=zn.createCore(ft);return new ks(Dt)}get styleExpanded(){var at;return(at=this.get("temporaryExpanded"))!==null&&at!==void 0?at:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const at=this.get("expandedHeight");return this.get("shouldFixHeight")&&!St(at)?`${at}px`:"auto"}bindExpandedClass(at,ft){const Dt=()=>{this.styleExpanded?at.classList.add(ft):at.classList.remove(ft)};Ht(this,"expanded",Dt),Ht(this,"temporaryExpanded",Dt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function or(bt,at){at.style.height=bt.styleHeight}function to(bt,at){bt.value("expanded").emitter.on("beforechange",()=>{bt.set("completed",!1),St(bt.get("expandedHeight"))&&bt.set("expandedHeight",function(ft,Dt){let tn=0;return function(Sn,Bn){const pr=Sn.style.transition;Sn.style.transition="none",Bn(),Sn.style.transition=pr}(Dt,()=>{ft.set("expandedHeight",null),ft.set("temporaryExpanded",!0),er(Dt),tn=Dt.clientHeight,ft.set("temporaryExpanded",null),er(Dt)}),tn}(bt,at)),bt.set("shouldFixHeight",!0),er(at)}),bt.emitter.on("change",()=>{or(bt,at)}),or(bt,at),at.addEventListener("transitionend",ft=>{ft.propertyName==="height"&&bt.cleanUpTransition()})}class co extends d{constructor(at,ft){super(at),this.rackApi_=ft}}class Bl{constructor(at){this.emitter=new Jt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=at}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(at){for(const ft of this.allItems())if(at(ft))return ft;return null}includes(at){return this.cache_.has(at)}add(at,ft){if(this.includes(at))throw Yt.shouldNeverHappen();const Dt=ft!==void 0?ft:this.items_.length;this.items_.splice(Dt,0,at),this.cache_.add(at);const tn=this.extract_(at);tn&&(tn.emitter.on("add",this.onSubListAdd_),tn.emitter.on("remove",this.onSubListRemove_),tn.allItems().forEach(Sn=>{this.cache_.add(Sn)})),this.emitter.emit("add",{index:Dt,item:at,root:this,target:this})}remove(at){const ft=this.items_.indexOf(at);if(ft<0)return;this.items_.splice(ft,1),this.cache_.delete(at);const Dt=this.extract_(at);Dt&&(Dt.emitter.off("add",this.onSubListAdd_),Dt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:ft,item:at,root:this,target:this})}onSubListAdd_(at){this.cache_.add(at.item),this.emitter.emit("add",{index:at.index,item:at.item,root:this,target:at.target})}onSubListRemove_(at){this.cache_.delete(at.item),this.emitter.emit("remove",{index:at.index,item:at.item,root:this,target:at.target})}}class Oo extends d{constructor(at){super(at),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Jt,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(at){this.controller_.props.set("label",at)}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(at){const ft=at.sender.target.read();this.emitter_.emit("change",{event:new ct(this,ft,this.controller_.binding.target.presetKey,at.options.last)})}}class Mo extends is{constructor(at,ft){super(at,ft),this.binding=ft.binding}}class To extends d{constructor(at){super(at),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Jt,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(at){this.controller_.props.set("label",at)}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(at){const ft=at.sender.target.read();this.emitter_.emit("update",{event:new pt(this,ft,this.controller_.binding.target.presetKey)})}}class Io extends is{constructor(at,ft){super(at,ft),this.binding=ft.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Hl(bt){return bt instanceof Al?bt.apiSet_:bt instanceof co?bt.rackApi_.apiSet_:null}function vo(bt,at){const ft=bt.find(Dt=>Dt.controller_===at);if(!ft)throw Yt.shouldNeverHappen();return ft}function no(bt,at,ft){if(!Vt.isBindable(bt))throw Yt.notBindable();return new Vt(bt,at,ft)}class Al extends d{constructor(at,ft){super(at),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Jt,this.apiSet_=new Bl(Hl),this.pool_=ft;const Dt=this.controller_.rack;Dt.emitter.on("add",this.onRackAdd_),Dt.emitter.on("remove",this.onRackRemove_),Dt.emitter.on("inputchange",this.onRackInputChange_),Dt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Dt.children.forEach(tn=>{this.setUpApi_(tn)})}get children(){return this.controller_.rack.children.map(at=>vo(this.apiSet_,at))}addInput(at,ft,Dt){const tn=Dt||{},Sn=this.controller_.view.element.ownerDocument,Bn=this.pool_.createInput(Sn,no(at,ft,tn.presetKey),tn),pr=new Oo(Bn);return this.add(pr,tn.index)}addMonitor(at,ft,Dt){const tn=Dt||{},Sn=this.controller_.view.element.ownerDocument,Bn=this.pool_.createMonitor(Sn,no(at,ft),tn),pr=new To(Bn);return this.add(pr,tn.index)}addFolder(at){return function(ft,Dt){return ft.addBlade(Object.assign(Object.assign({},Dt),{view:"folder"}))}(this,at)}addButton(at){return function(ft,Dt){return ft.addBlade(Object.assign(Object.assign({},Dt),{view:"button"}))}(this,at)}addSeparator(at){return function(ft,Dt){const tn=Dt||{};return ft.addBlade(Object.assign(Object.assign({},tn),{view:"separator"}))}(this,at)}addTab(at){return function(ft,Dt){return ft.addBlade(Object.assign(Object.assign({},Dt),{view:"tab"}))}(this,at)}add(at,ft){this.controller_.rack.add(at.controller_,ft);const Dt=this.apiSet_.find(tn=>tn.controller_===at.controller_);return Dt&&this.apiSet_.remove(Dt),this.apiSet_.add(at),at}remove(at){this.controller_.rack.remove(at.controller_)}addBlade(at){const ft=this.controller_.view.element.ownerDocument,Dt=this.pool_.createBlade(ft,at),tn=this.pool_.createBladeApi(Dt);return this.add(tn,at.index)}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}setUpApi_(at){this.apiSet_.find(ft=>ft.controller_===at)||this.apiSet_.add(this.pool_.createBladeApi(at))}onRackAdd_(at){this.setUpApi_(at.bladeController)}onRackRemove_(at){if(at.isRoot){const ft=vo(this.apiSet_,at.bladeController);this.apiSet_.remove(ft)}}onRackInputChange_(at){const ft=at.bladeController;if(ft instanceof Mo){const Dt=vo(this.apiSet_,ft),tn=ft.binding;this.emitter_.emit("change",{event:new ct(Dt,tn.target.read(),tn.target.presetKey,at.options.last)})}else if(ft instanceof Os){const Dt=vo(this.apiSet_,ft);this.emitter_.emit("change",{event:new ct(Dt,ft.value.rawValue,void 0,at.options.last)})}}onRackMonitorUpdate_(at){if(!(at.bladeController instanceof Io))throw Yt.shouldNeverHappen();const ft=vo(this.apiSet_,at.bladeController),Dt=at.bladeController.binding;this.emitter_.emit("update",{event:new pt(ft,Dt.target.read(),Dt.target.presetKey)})}}class qo extends co{constructor(at,ft){super(at,new Al(at.rackController,ft)),this.emitter_=new Jt,this.controller_.foldable.value("expanded").emitter.on("change",Dt=>{this.emitter_.emit("fold",{event:new At(this,Dt.sender.rawValue)})}),this.rackApi_.on("change",Dt=>{this.emitter_.emit("change",{event:Dt})}),this.rackApi_.on("update",Dt=>{this.emitter_.emit("update",{event:Dt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(at){this.controller_.foldable.set("expanded",at)}get title(){return this.controller_.props.get("title")}set title(at){this.controller_.props.set("title",at)}get children(){return this.rackApi_.children}addInput(at,ft,Dt){return this.rackApi_.addInput(at,ft,Dt)}addMonitor(at,ft,Dt){return this.rackApi_.addMonitor(at,ft,Dt)}addFolder(at){return this.rackApi_.addFolder(at)}addButton(at){return this.rackApi_.addButton(at)}addSeparator(at){return this.rackApi_.addSeparator(at)}addTab(at){return this.rackApi_.addTab(at)}add(at,ft){return this.rackApi_.add(at,ft)}remove(at){this.rackApi_.remove(at)}addBlade(at){return this.rackApi_.addBlade(at)}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}}class Lo extends Kn{constructor(at){super({blade:at.blade,view:at.view,viewProps:at.rackController.viewProps}),this.rackController=at.rackController}}class Pp{constructor(at,ft){const Dt=sn(ft.viewName);this.element=at.createElement("div"),this.element.classList.add(Dt()),ft.viewProps.bindClassModifiers(this.element)}}function Yo(bt){return bt instanceof Mu?bt.rack:bt instanceof Lo?bt.rackController.rack:null}function du(bt){const at=Yo(bt);return at?at.bcSet_:null}class Vo{constructor(at){var ft;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Jt,this.blade_=at??null,(ft=this.blade_)===null||ft===void 0||ft.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Bl(du),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(at,ft){at.parent&&at.parent.remove(at),at.parent_=this,this.bcSet_.add(at,ft)}remove(at){at.parent_=null,this.bcSet_.remove(at)}find(at){return this.bcSet_.allItems().filter(ft=>ft instanceof at)}onSetAdd_(at){this.updatePositions_();const ft=at.target===at.root;if(this.emitter.emit("add",{bladeController:at.item,index:at.index,isRoot:ft,sender:this}),!ft)return;const Dt=at.item;if(Dt.viewProps.emitter.on("change",this.onChildViewPropsChange_),Dt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Dt.viewProps.handleDispose(this.onChildDispose_),Dt instanceof Mo)Dt.binding.emitter.on("change",this.onChildInputChange_);else if(Dt instanceof Io)Dt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Dt instanceof Os)Dt.value.emitter.on("change",this.onChildValueChange_);else{const tn=Yo(Dt);if(tn){const Sn=tn.emitter;Sn.on("layout",this.onDescendantLayout_),Sn.on("inputchange",this.onDescendantInputChange_),Sn.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(at){this.updatePositions_();const ft=at.target===at.root;if(this.emitter.emit("remove",{bladeController:at.item,isRoot:ft,sender:this}),!ft)return;const Dt=at.item;if(Dt instanceof Mo)Dt.binding.emitter.off("change",this.onChildInputChange_);else if(Dt instanceof Io)Dt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Dt instanceof Os)Dt.value.emitter.off("change",this.onChildValueChange_);else{const tn=Yo(Dt);if(tn){const Sn=tn.emitter;Sn.off("layout",this.onDescendantLayout_),Sn.off("inputchange",this.onDescendantInputChange_),Sn.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const at=this.bcSet_.items.filter(tn=>!tn.viewProps.get("hidden")),ft=at[0],Dt=at[at.length-1];this.bcSet_.items.forEach(tn=>{const Sn=[];tn===ft&&(Sn.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||Sn.push("veryfirst")),tn===Dt&&(Sn.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||Sn.push("verylast")),tn.blade.set("positions",Sn)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(at){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(at=>at.viewProps.get("disposed")).forEach(at=>{this.bcSet_.remove(at)})}onChildInputChange_(at){const ft=function(Dt,tn){for(let Sn=0;Sn<Dt.length;Sn++){const Bn=Dt[Sn];if(Bn instanceof Mo&&Bn.binding===tn)return Bn}return null}(this.find(Mo),at.sender);if(!ft)throw Yt.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ft,options:at.options,sender:this})}onChildMonitorUpdate_(at){const ft=function(Dt,tn){for(let Sn=0;Sn<Dt.length;Sn++){const Bn=Dt[Sn];if(Bn instanceof Io&&Bn.binding===tn)return Bn}return null}(this.find(Io),at.sender);if(!ft)throw Yt.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:ft,sender:this})}onChildValueChange_(at){const ft=function(Dt,tn){for(let Sn=0;Sn<Dt.length;Sn++){const Bn=Dt[Sn];if(Bn instanceof Os&&Bn.value===tn)return Bn}return null}(this.find(Os),at.sender);if(!ft)throw Yt.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ft,options:at.options,sender:this})}onDescendantLayout_(at){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(at){this.emitter.emit("inputchange",{bladeController:at.bladeController,options:at.options,sender:this})}onDescendantMonitorUpdate_(at){this.emitter.emit("monitorupdate",{bladeController:at.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Mu extends Kn{constructor(at,ft){super(Object.assign(Object.assign({},ft),{view:new Pp(at,{viewName:"brk",viewProps:ft.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Dt=new Vo(ft.root?void 0:ft.blade);Dt.emitter.on("add",this.onRackAdd_),Dt.emitter.on("remove",this.onRackRemove_),this.rack=Dt,this.viewProps.handleDispose(()=>{for(let tn=this.rack.children.length-1;tn>=0;tn--)this.rack.children[tn].viewProps.set("disposed",!0)})}onRackAdd_(at){at.isRoot&&pn(this.view.element,at.bladeController.view.element,at.index)}onRackRemove_(at){at.isRoot&&On(at.bladeController.view.element)}}const Dp=sn("cnt");class hs{constructor(at,ft){this.className_=sn(ft.viewName||"fld"),this.element=at.createElement("div"),this.element.classList.add(this.className_(),Dp()),ft.viewProps.bindClassModifiers(this.element),this.foldable_=ft.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ht(this.foldable_,"completed",an(this.element,this.className_(void 0,"cpl")));const Dt=at.createElement("button");Dt.classList.add(this.className_("b")),Ht(ft.props,"title",pr=>{St(pr)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.buttonElement=Dt;const tn=at.createElement("div");tn.classList.add(this.className_("t")),nn(ft.props.value("title"),tn),this.buttonElement.appendChild(tn),this.titleElement=tn;const Sn=at.createElement("div");Sn.classList.add(this.className_("m")),this.buttonElement.appendChild(Sn);const Bn=ft.containerElement;Bn.classList.add(this.className_("c")),this.element.appendChild(Bn),this.containerElement=Bn}}class So extends Lo{constructor(at,ft){var Dt;const tn=ks.create((Dt=ft.expanded)===null||Dt===void 0||Dt),Sn=new Mu(at,{blade:ft.blade,root:ft.root,viewProps:ft.viewProps});super(Object.assign(Object.assign({},ft),{rackController:Sn,view:new hs(at,{containerElement:Sn.view.element,foldable:tn,props:ft.props,viewName:ft.root?"rot":void 0,viewProps:ft.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=ft.props,this.foldable=tn,to(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const $l={id:"folder",type:"blade",accept(bt){const at=ur,ft=Zn(bt,{title:at.required.string,view:at.required.constant("folder"),expanded:at.optional.boolean});return ft?{params:ft}:null},controller:bt=>new So(bt.document,{blade:bt.blade,expanded:bt.params.expanded,props:zn.fromObject({title:bt.params.title}),viewProps:bt.viewProps}),api:bt=>bt.controller instanceof So?new qo(bt.controller,bt.pool):null};class Cl extends Os{constructor(at,ft){const Dt=ft.valueController.viewProps;super(Object.assign(Object.assign({},ft),{value:ft.valueController.value,view:new ds(at,{props:ft.props,viewProps:Dt}),viewProps:Dt})),this.props=ft.props,this.valueController=ft.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class rp extends d{}const Hu=sn("spr");class vp{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(Hu()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("hr");Dt.classList.add(Hu("r")),this.element.appendChild(Dt)}}class Qn extends Kn{constructor(at,ft){super(Object.assign(Object.assign({},ft),{view:new vp(at,{viewProps:ft.viewProps})}))}}const ba={id:"separator",type:"blade",accept(bt){const at=Zn(bt,{view:ur.required.constant("separator")});return at?{params:at}:null},controller:bt=>new Qn(bt.document,{blade:bt.blade,viewProps:bt.viewProps}),api:bt=>bt.controller instanceof Qn?new rp(bt.controller):null},Wu=sn("");function Gs(bt,at){return an(bt,Wu(void 0,at))}class Xr extends zn{constructor(at){super(at)}static create(at){var ft,Dt;const tn=at??{},Sn={disabled:(ft=tn.disabled)!==null&&ft!==void 0&&ft,disposed:!1,hidden:(Dt=tn.hidden)!==null&&Dt!==void 0&&Dt},Bn=zn.createCore(Sn);return new Xr(Bn)}bindClassModifiers(at){Ht(this,"disabled",Gs(at,"disabled")),Ht(this,"hidden",Gs(at,"hidden"))}bindDisabled(at){Ht(this,"disabled",ft=>{at.disabled=ft})}bindTabIndex(at){Ht(this,"disabled",ft=>{at.tabIndex=ft?-1:0})}handleDispose(at){this.value("disposed").emitter.on("change",ft=>{ft&&at()})}}const br=sn("tbi");class Is{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(br()),ft.viewProps.bindClassModifiers(this.element),Ht(ft.props,"selected",Sn=>{Sn?this.element.classList.add(br(void 0,"sel")):this.element.classList.remove(br(void 0,"sel"))});const Dt=at.createElement("button");Dt.classList.add(br("b")),ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.buttonElement=Dt;const tn=at.createElement("div");tn.classList.add(br("t")),nn(ft.props.value("title"),tn),this.buttonElement.appendChild(tn),this.titleElement=tn}}class Ps{constructor(at,ft){this.emitter=new Jt,this.onClick_=this.onClick_.bind(this),this.props=ft.props,this.viewProps=ft.viewProps,this.view=new Is(at,{props:ft.props,viewProps:ft.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class bs{constructor(at,ft){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ps(at,{props:ft.itemProps,viewProps:Xr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Mu(at,{blade:go(),viewProps:Xr.create()}),this.props=ft.props,Ht(this.props,"selected",Dt=>{this.itemController.props.set("selected",Dt),this.contentController.viewProps.set("hidden",!Dt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Qo{constructor(at,ft){this.controller_=at,this.rackApi_=ft}get title(){var at;return(at=this.controller_.itemController.props.get("title"))!==null&&at!==void 0?at:""}set title(at){this.controller_.itemController.props.set("title",at)}get selected(){return this.controller_.props.get("selected")}set selected(at){this.controller_.props.set("selected",at)}get children(){return this.rackApi_.children}addButton(at){return this.rackApi_.addButton(at)}addFolder(at){return this.rackApi_.addFolder(at)}addSeparator(at){return this.rackApi_.addSeparator(at)}addTab(at){return this.rackApi_.addTab(at)}add(at,ft){this.rackApi_.add(at,ft)}remove(at){this.rackApi_.remove(at)}addInput(at,ft,Dt){return this.rackApi_.addInput(at,ft,Dt)}addMonitor(at,ft,Dt){return this.rackApi_.addMonitor(at,ft,Dt)}addBlade(at){return this.rackApi_.addBlade(at)}}class Js extends co{constructor(at,ft){super(at,new Al(at.rackController,ft)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new Jt,this.pageApiMap_=new Map,this.rackApi_.on("change",Dt=>{this.emitter_.emit("change",{event:Dt})}),this.rackApi_.on("update",Dt=>{this.emitter_.emit("update",{event:Dt})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Dt=>{this.setUpPageApi_(Dt)})}get pages(){return this.controller_.pageSet.items.map(at=>{const ft=this.pageApiMap_.get(at);if(!ft)throw Yt.shouldNeverHappen();return ft})}addPage(at){const ft=this.controller_.view.element.ownerDocument,Dt=new bs(ft,{itemProps:zn.fromObject({selected:!1,title:at.title}),props:zn.fromObject({selected:!1})});this.controller_.add(Dt,at.index);const tn=this.pageApiMap_.get(Dt);if(!tn)throw Yt.shouldNeverHappen();return tn}removePage(at){this.controller_.remove(at)}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}setUpPageApi_(at){const ft=this.rackApi_.apiSet_.find(tn=>tn.controller_===at.contentController);if(!ft)throw Yt.shouldNeverHappen();const Dt=new Qo(at,ft);this.pageApiMap_.set(at,Dt)}onPageAdd_(at){this.setUpPageApi_(at.item)}onPageRemove_(at){if(!this.pageApiMap_.get(at.item))throw Yt.shouldNeverHappen();this.pageApiMap_.delete(at.item)}}const Do=sn("tab");class Go{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(Do(),Dp()),ft.viewProps.bindClassModifiers(this.element),Ut(ft.empty,an(this.element,Do(void 0,"nop")));const Dt=at.createElement("div");Dt.classList.add(Do("i")),this.element.appendChild(Dt),this.itemsElement=Dt;const tn=ft.contentsElement;tn.classList.add(Do("c")),this.element.appendChild(tn),this.contentsElement=tn}}class qu extends Lo{constructor(at,ft){const Dt=new Mu(at,{blade:ft.blade,viewProps:ft.viewProps}),tn=hn(!0);super({blade:ft.blade,rackController:Dt,view:new Go(at,{contentsElement:Dt.view.element,empty:tn,viewProps:ft.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Bl(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=tn,this.applyPages_()}get pageSet(){return this.pageSet_}add(at,ft){this.pageSet_.add(at,ft??this.pageSet_.items.length)}remove(at){this.pageSet_.remove(this.pageSet_.items[at])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(at){const ft=at.item;pn(this.view.itemsElement,ft.itemController.view.element,at.index),this.rackController.rack.add(ft.contentController,at.index),ft.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(at){const ft=at.item;On(ft.itemController.view.element),this.rackController.rack.remove(ft.contentController),ft.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const at=this.pageSet_.items.findIndex(ft=>ft.props.get("selected"));at<0?this.pageSet_.items.forEach((ft,Dt)=>{ft.props.set("selected",Dt===0)}):this.pageSet_.items.forEach((ft,Dt)=>{ft.props.set("selected",Dt===at)})}onPageSelectedChange_(at){if(at.rawValue){const ft=this.pageSet_.items.findIndex(Dt=>Dt.props.value("selected")===at.sender);this.pageSet_.items.forEach((Dt,tn)=>{Dt.props.set("selected",tn===ft)})}else this.keepSelection_()}}const ro={id:"tab",type:"blade",accept(bt){const at=ur,ft=Zn(bt,{pages:at.required.array(at.required.object({title:at.required.string})),view:at.required.constant("tab")});return ft&&ft.pages.length!==0?{params:ft}:null},controller(bt){const at=new qu(bt.document,{blade:bt.blade,viewProps:bt.viewProps});return bt.params.pages.forEach(ft=>{const Dt=new bs(bt.document,{itemProps:zn.fromObject({selected:!1,title:ft.title}),props:zn.fromObject({selected:!1})});at.add(Dt)}),at},api:bt=>bt.controller instanceof qu?new Js(bt.controller,bt.pool):null};class Wl{constructor(){this.disabled=!1,this.emitter=new Jt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class _p{constructor(at,ft){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=at,this.emitter=new Jt,this.interval_=ft,this.setTimer_()}get disabled(){return this.disabled_}set disabled(at){this.disabled_=at,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const at=this.doc_.defaultView;at&&at.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const at=this.doc_.defaultView;at&&(this.timerId_=at.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ho{constructor(at){this.constraints=at}constrain(at){return this.constraints.reduce((ft,Dt)=>Dt.constrain(ft),at)}}function yo(bt,at){if(bt instanceof at)return bt;if(bt instanceof Ho){const ft=bt.constraints.reduce((Dt,tn)=>Dt||(tn instanceof at?tn:null),null);if(ft)return ft}return null}class Zo{constructor(at){this.options=at}constrain(at){const ft=this.options;return ft.length===0||ft.filter(Dt=>Dt.value===at).length>0?at:ft[0].value}}class _o{constructor(at){this.maxValue=at.max,this.minValue=at.min}constrain(at){let ft=at;return St(this.minValue)||(ft=Math.max(ft,this.minValue)),St(this.maxValue)||(ft=Math.min(ft,this.maxValue)),ft}}class pu{constructor(at){this.step=at}constrain(at){return(at<0?-Math.round(-at/this.step):Math.round(at/this.step))*this.step}}const Ao=sn("lst");class na{constructor(at,ft){this.onValueChange_=this.onValueChange_.bind(this),this.props_=ft.props,this.element=at.createElement("div"),this.element.classList.add(Ao()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("select");Dt.classList.add(Ao("s")),Ht(this.props_,"options",Sn=>{Tr(Dt),Sn.forEach((Bn,pr)=>{const Or=at.createElement("option");Or.dataset.index=String(pr),Or.textContent=Bn.text,Or.value=String(Bn.value),Dt.appendChild(Or)})}),ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.selectElement=Dt;const tn=at.createElement("div");tn.classList.add(Ao("m")),tn.appendChild(on(at,"dropdown")),this.element.appendChild(tn),ft.value.emitter.on("change",this.onValueChange_),this.value_=ft.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class xl{constructor(at,ft){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=ft.props,this.value=ft.value,this.viewProps=ft.viewProps,this.view=new na(at,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(at){const ft=at.currentTarget.selectedOptions.item(0);if(!ft)return;const Dt=Number(ft.dataset.index);this.value.rawValue=this.props.get("options")[Dt].value}}const rs=sn("pop");class Fm{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(rs()),ft.viewProps.bindClassModifiers(this.element),Ut(ft.shows,an(this.element,rs(void 0,"v")))}}class ls{constructor(at,ft){this.shows=hn(!1),this.viewProps=ft.viewProps,this.view=new Fm(at,{shows:this.shows,viewProps:this.viewProps})}}const Jl=sn("txt");class yp{constructor(at,ft){this.onChange_=this.onChange_.bind(this),this.element=at.createElement("div"),this.element.classList.add(Jl()),ft.viewProps.bindClassModifiers(this.element),this.props_=ft.props,this.props_.emitter.on("change",this.onChange_);const Dt=at.createElement("input");Dt.classList.add(Jl("i")),Dt.type="text",ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.inputElement=Dt,ft.value.emitter.on("change",this.onChange_),this.value_=ft.value,this.refresh()}refresh(){const at=this.props_.get("formatter");this.inputElement.value=at(this.value_.rawValue)}onChange_(){this.refresh()}}class No{constructor(at,ft){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=ft.parser,this.props=ft.props,this.value=ft.value,this.viewProps=ft.viewProps,this.view=new yp(at,{props:ft.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(at){const ft=at.currentTarget.value,Dt=this.parser_(ft);St(Dt)||(this.value.rawValue=Dt),this.view.refresh()}}function uo(bt){return bt!=="false"&&!!bt}function cv(bt){return function(at){return String(at)}(bt)}class Sy{constructor(at){this.text=at}evaluate(){return Number(this.text)}toString(){return this.text}}const zv={"**":(bt,at)=>Math.pow(bt,at),"*":(bt,at)=>bt*at,"/":(bt,at)=>bt/at,"%":(bt,at)=>bt%at,"+":(bt,at)=>bt+at,"-":(bt,at)=>bt-at,"<<":(bt,at)=>bt<<at,">>":(bt,at)=>bt>>at,">>>":(bt,at)=>bt>>>at,"&":(bt,at)=>bt&at,"^":(bt,at)=>bt^at,"|":(bt,at)=>bt|at};class w_{constructor(at,ft,Dt){this.left=ft,this.operator=at,this.right=Dt}evaluate(){const at=zv[this.operator];if(!at)throw new Error(`unexpected binary operator: '${this.operator}`);return at(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ho={"+":bt=>bt,"-":bt=>-bt,"~":bt=>~bt};class gA{constructor(at,ft){this.operator=at,this.expression=ft}evaluate(){const at=ho[this.operator];if(!at)throw new Error(`unexpected unary operator: '${this.operator}`);return at(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function x_(bt){return(at,ft)=>{for(let Dt=0;Dt<bt.length;Dt++){const tn=bt[Dt](at,ft);if(tn!=="")return tn}return""}}function Vv(bt,at){var ft;const Dt=bt.substr(at).match(/^\s+/);return(ft=Dt&&Dt[0])!==null&&ft!==void 0?ft:""}function Qv(bt,at){var ft;const Dt=bt.substr(at).match(/^[0-9]+/);return(ft=Dt&&Dt[0])!==null&&ft!==void 0?ft:""}function Xo(bt,at){const ft=bt.substr(at,1);if(at+=1,ft.toLowerCase()!=="e")return"";const Dt=function(tn,Sn){const Bn=Qv(tn,Sn);if(Bn!=="")return Bn;const pr=tn.substr(Sn,1);if(pr!=="-"&&pr!=="+")return"";const Or=Qv(tn,Sn+=1);return Or===""?"":pr+Or}(bt,at);return Dt===""?"":ft+Dt}function Fo(bt,at){const ft=bt.substr(at,1);if(ft==="0")return ft;const Dt=function(tn,Sn){const Bn=tn.substr(Sn,1);return Bn.match(/^[1-9]$/)?Bn:""}(bt,at);return at+=Dt.length,Dt===""?"":Dt+Qv(bt,at)}const uv=x_([function(bt,at){const ft=Fo(bt,at);if(at+=ft.length,ft==="")return"";const Dt=bt.substr(at,1);if(at+=Dt.length,Dt!==".")return"";const tn=Qv(bt,at);return ft+Dt+tn+Xo(bt,at+=tn.length)},function(bt,at){const ft=bt.substr(at,1);if(at+=ft.length,ft!==".")return"";const Dt=Qv(bt,at);return at+=Dt.length,Dt===""?"":ft+Dt+Xo(bt,at)},function(bt,at){const ft=Fo(bt,at);return at+=ft.length,ft===""?"":ft+Xo(bt,at)}]),Ap=x_([function(bt,at){const ft=bt.substr(at,2);if(at+=ft.length,ft.toLowerCase()!=="0b")return"";const Dt=function(tn,Sn){var Bn;const pr=tn.substr(Sn).match(/^[01]+/);return(Bn=pr&&pr[0])!==null&&Bn!==void 0?Bn:""}(bt,at);return Dt===""?"":ft+Dt},function(bt,at){const ft=bt.substr(at,2);if(at+=ft.length,ft.toLowerCase()!=="0o")return"";const Dt=function(tn,Sn){var Bn;const pr=tn.substr(Sn).match(/^[0-7]+/);return(Bn=pr&&pr[0])!==null&&Bn!==void 0?Bn:""}(bt,at);return Dt===""?"":ft+Dt},function(bt,at){const ft=bt.substr(at,2);if(at+=ft.length,ft.toLowerCase()!=="0x")return"";const Dt=function(tn,Sn){var Bn;const pr=tn.substr(Sn).match(/^[0-9a-f]+/i);return(Bn=pr&&pr[0])!==null&&Bn!==void 0?Bn:""}(bt,at);return Dt===""?"":ft+Dt}]),vA=x_([Ap,uv]);function b_(bt,at){return function(ft,Dt){const tn=vA(ft,Dt);return Dt+=tn.length,tn===""?null:{evaluable:new Sy(tn),cursor:Dt}}(bt,at)||function(ft,Dt){const tn=ft.substr(Dt,1);if(Dt+=tn.length,tn!=="(")return null;const Sn=Tu(ft,Dt);if(!Sn)return null;Dt=Sn.cursor,Dt+=Vv(ft,Dt).length;const Bn=ft.substr(Dt,1);return Dt+=Bn.length,Bn!==")"?null:{evaluable:Sn.evaluable,cursor:Dt}}(bt,at)}function E_(bt,at,ft){ft+=Vv(at,ft).length;const Dt=bt.filter(tn=>at.startsWith(tn,ft))[0];return Dt?(ft+=Dt.length,{cursor:ft+=Vv(at,ft).length,operator:Dt}):null}const x0=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((bt,at)=>function(ft,Dt){return(tn,Sn)=>{const Bn=ft(tn,Sn);if(!Bn)return null;Sn=Bn.cursor;let pr=Bn.evaluable;for(;;){const Or=E_(Dt,tn,Sn);if(!Or)break;Sn=Or.cursor;const As=ft(tn,Sn);if(!As)return null;Sn=As.cursor,pr=new w_(Or.operator,pr,As.evaluable)}return pr?{cursor:Sn,evaluable:pr}:null}}(bt,at),function bt(at,ft){const Dt=b_(at,ft);if(Dt)return Dt;const tn=at.substr(ft,1);if(ft+=tn.length,tn!=="+"&&tn!=="-"&&tn!=="~")return null;const Sn=bt(at,ft);return Sn?{cursor:ft=Sn.cursor,evaluable:new gA(tn,Sn.evaluable)}:null});function Tu(bt,at){return at+=Vv(bt,at).length,x0(bt,at)}function gu(bt){var at;const ft=function(Dt){const tn=Tu(Dt,0);return tn?tn.cursor+Vv(Dt,tn.cursor).length!==Dt.length?null:tn.evaluable:null}(bt);return(at=ft==null?void 0:ft.evaluate())!==null&&at!==void 0?at:null}function Wp(bt){if(typeof bt=="number")return bt;if(typeof bt=="string"){const at=gu(bt);if(!St(at))return at}return 0}function S_(bt){return String(bt)}function Ml(bt){return at=>at.toFixed(Math.max(Math.min(bt,20),0))}const _A=Ml(0);function Gv(bt){return _A(bt)+"%"}function y1(bt){return String(bt)}function C_(bt){return bt}function vm(bt,at){for(;bt.length<at;)bt.push(void 0)}function po(bt){const at=[];return vm(at,bt),hn(at)}function Pw(bt){const at=bt.indexOf(void 0);return at<0?bt:bt.slice(0,at)}function M_({primary:bt,secondary:at,forward:ft,backward:Dt}){let tn=!1;function Sn(Bn){tn||(tn=!0,Bn(),tn=!1)}bt.emitter.on("change",Bn=>{Sn(()=>{at.setRawValue(ft(bt,at),Bn.options)})}),at.emitter.on("change",Bn=>{Sn(()=>{bt.setRawValue(Dt(bt,at),Bn.options)}),Sn(()=>{at.setRawValue(ft(bt,at),Bn.options)})}),Sn(()=>{at.setRawValue(ft(bt,at),{forceEmit:!1,last:!0})})}function ip(bt,at){const ft=bt*(at.altKey?.1:1)*(at.shiftKey?10:1);return at.upKey?+ft:at.downKey?-ft:0}function b0(bt){return{altKey:bt.altKey,downKey:bt.key==="ArrowDown",shiftKey:bt.shiftKey,upKey:bt.key==="ArrowUp"}}function Iu(bt){return{altKey:bt.altKey,downKey:bt.key==="ArrowLeft",shiftKey:bt.shiftKey,upKey:bt.key==="ArrowRight"}}function Pu(bt){return function(at){return at==="ArrowUp"||at==="ArrowDown"}(bt)||bt==="ArrowLeft"||bt==="ArrowRight"}function T_(bt,at){const ft=at.ownerDocument.defaultView,Dt=at.getBoundingClientRect();return{x:bt.pageX-((ft&&ft.scrollX||0)+Dt.left),y:bt.pageY-((ft&&ft.scrollY||0)+Dt.top)}}class Du{constructor(at){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=at,this.emitter=new Jt,at.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),at.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),at.addEventListener("touchend",this.onTouchEnd_),at.addEventListener("mousedown",this.onMouseDown_)}computePosition_(at){const ft=this.elem_.getBoundingClientRect();return{bounds:{width:ft.width,height:ft.height},point:at?{x:at.x,y:at.y}:null}}onMouseDown_(at){var ft;at.preventDefault(),(ft=at.currentTarget)===null||ft===void 0||ft.focus();const Dt=this.elem_.ownerDocument;Dt.addEventListener("mousemove",this.onDocumentMouseMove_),Dt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:at.altKey,data:this.computePosition_(T_(at,this.elem_)),sender:this,shiftKey:at.shiftKey})}onDocumentMouseMove_(at){this.emitter.emit("move",{altKey:at.altKey,data:this.computePosition_(T_(at,this.elem_)),sender:this,shiftKey:at.shiftKey})}onDocumentMouseUp_(at){const ft=this.elem_.ownerDocument;ft.removeEventListener("mousemove",this.onDocumentMouseMove_),ft.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:at.altKey,data:this.computePosition_(T_(at,this.elem_)),sender:this,shiftKey:at.shiftKey})}onTouchStart_(at){at.preventDefault();const ft=at.targetTouches.item(0),Dt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:at.altKey,data:this.computePosition_(ft?{x:ft.clientX-Dt.left,y:ft.clientY-Dt.top}:void 0),sender:this,shiftKey:at.shiftKey}),this.lastTouch_=ft}onTouchMove_(at){const ft=at.targetTouches.item(0),Dt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:at.altKey,data:this.computePosition_(ft?{x:ft.clientX-Dt.left,y:ft.clientY-Dt.top}:void 0),sender:this,shiftKey:at.shiftKey}),this.lastTouch_=ft}onTouchEnd_(at){var ft;const Dt=(ft=at.targetTouches.item(0))!==null&&ft!==void 0?ft:this.lastTouch_,tn=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:at.altKey,data:this.computePosition_(Dt?{x:Dt.clientX-tn.left,y:Dt.clientY-tn.top}:void 0),sender:this,shiftKey:at.shiftKey})}}function wo(bt,at,ft,Dt,tn){return Dt+(bt-at)/(ft-at)*(tn-Dt)}function Au(bt){return String(bt.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Wo(bt,at,ft){return Math.min(Math.max(bt,at),ft)}function yA(bt,at){return(bt%at+at)%at}const qp=sn("txt");class Hv{constructor(at,ft){this.onChange_=this.onChange_.bind(this),this.props_=ft.props,this.props_.emitter.on("change",this.onChange_),this.element=at.createElement("div"),this.element.classList.add(qp(),qp(void 0,"num")),ft.arrayPosition&&this.element.classList.add(qp(void 0,ft.arrayPosition)),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("input");Dt.classList.add(qp("i")),Dt.type="text",ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.inputElement=Dt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=ft.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(qp()),this.inputElement.classList.add(qp("i"));const tn=at.createElement("div");tn.classList.add(qp("k")),this.element.appendChild(tn),this.knobElement=tn;const Sn=at.createElementNS(un,"svg");Sn.classList.add(qp("g")),this.knobElement.appendChild(Sn);const Bn=at.createElementNS(un,"path");Bn.classList.add(qp("gb")),Sn.appendChild(Bn),this.guideBodyElem_=Bn;const pr=at.createElementNS(un,"path");pr.classList.add(qp("gh")),Sn.appendChild(pr),this.guideHeadElem_=pr;const Or=at.createElement("div");Or.classList.add(sn("tt")()),this.knobElement.appendChild(Or),this.tooltipElem_=Or,ft.value.emitter.on("change",this.onChange_),this.value=ft.value,this.refresh()}onDraggingChange_(at){if(at.rawValue===null)return void this.element.classList.remove(qp(void 0,"drg"));this.element.classList.add(qp(void 0,"drg"));const ft=at.rawValue/this.props_.get("draggingScale"),Dt=ft+(ft>0?-1:ft<0?1:0),tn=Wo(-Dt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Dt+tn},0 L${Dt},4 L${Dt+tn},8`,`M ${ft},-1 L${ft},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${ft},4`);const Sn=this.props_.get("formatter");this.tooltipElem_.textContent=Sn(this.value.rawValue),this.tooltipElem_.style.left=`${ft}px`}refresh(){const at=this.props_.get("formatter");this.inputElement.value=at(this.value.rawValue)}onChange_(){this.refresh()}}class I_{constructor(at,ft){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ft.baseStep,this.parser_=ft.parser,this.props=ft.props,this.value=ft.value,this.viewProps=ft.viewProps,this.dragging_=hn(null),this.view=new Hv(at,{arrayPosition:ft.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Dt=new Du(this.view.knobElement);Dt.emitter.on("down",this.onPointerDown_),Dt.emitter.on("move",this.onPointerMove_),Dt.emitter.on("up",this.onPointerUp_)}onInputChange_(at){const ft=at.currentTarget.value,Dt=this.parser_(ft);St(Dt)||(this.value.rawValue=Dt),this.view.refresh()}onInputKeyDown_(at){const ft=ip(this.baseStep_,b0(at));ft!==0&&this.value.setRawValue(this.value.rawValue+ft,{forceEmit:!1,last:!1})}onInputKeyUp_(at){ip(this.baseStep_,b0(at))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(at){if(!at.point)return null;const ft=at.point.x-at.bounds.width/2;return this.originRawValue_+ft*this.props.get("draggingScale")}onPointerMove_(at){const ft=this.computeDraggingValue_(at.data);ft!==null&&(this.value.setRawValue(ft,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(at){const ft=this.computeDraggingValue_(at.data);ft!==null&&(this.value.setRawValue(ft,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Fl=sn("sld");class Dw{constructor(at,ft){this.onChange_=this.onChange_.bind(this),this.props_=ft.props,this.props_.emitter.on("change",this.onChange_),this.element=at.createElement("div"),this.element.classList.add(Fl()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("div");Dt.classList.add(Fl("t")),ft.viewProps.bindTabIndex(Dt),this.element.appendChild(Dt),this.trackElement=Dt;const tn=at.createElement("div");tn.classList.add(Fl("k")),this.trackElement.appendChild(tn),this.knobElement=tn,ft.value.emitter.on("change",this.onChange_),this.value=ft.value,this.update_()}update_(){const at=Wo(wo(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${at}%`}onChange_(){this.update_()}}class Rw{constructor(at,ft){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ft.baseStep,this.value=ft.value,this.viewProps=ft.viewProps,this.props=ft.props,this.view=new Dw(at,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Du(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(at,ft){at.point&&this.value.setRawValue(wo(Wo(at.point.x,0,at.bounds.width),0,at.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),ft)}onPointerDownOrMove_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerUp_(at){this.handlePointerEvent_(at.data,{forceEmit:!0,last:!0})}onKeyDown_(at){const ft=ip(this.baseStep_,Iu(at));ft!==0&&this.value.setRawValue(this.value.rawValue+ft,{forceEmit:!1,last:!1})}onKeyUp_(at){ip(this.baseStep_,Iu(at))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Yu=sn("sldtxt");class kw{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(Yu());const Dt=at.createElement("div");Dt.classList.add(Yu("s")),this.sliderView_=ft.sliderView,Dt.appendChild(this.sliderView_.element),this.element.appendChild(Dt);const tn=at.createElement("div");tn.classList.add(Yu("t")),this.textView_=ft.textView,tn.appendChild(this.textView_.element),this.element.appendChild(tn)}}class Yp{constructor(at,ft){this.value=ft.value,this.viewProps=ft.viewProps,this.sliderC_=new Rw(at,{baseStep:ft.baseStep,props:ft.sliderProps,value:ft.value,viewProps:this.viewProps}),this.textC_=new I_(at,{baseStep:ft.baseStep,parser:ft.parser,props:ft.textProps,value:ft.value,viewProps:ft.viewProps}),this.view=new kw(at,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Wv(bt,at){bt.write(at)}function E0(bt){const at=ur;return Array.isArray(bt)?at.required.array(at.required.object({text:at.required.string,value:at.required.raw}))(bt).value:typeof bt=="object"?at.required.raw(bt).value:void 0}function A1(bt){if(bt==="inline"||bt==="popup")return bt}function Um(bt){const at=ur;return at.required.object({max:at.optional.number,min:at.optional.number,step:at.optional.number})(bt).value}function P_(bt){if(Array.isArray(bt))return bt;const at=[];return Object.keys(bt).forEach(ft=>{at.push({text:ft,value:bt[ft]})}),at}function Ul(bt){return St(bt)?null:new Zo(P_(bt))}function AA(bt){const at=bt?yo(bt,Zo):null;return at?at.options:null}function wA(bt,at){const ft=bt&&yo(bt,pu);return ft?Au(ft.step):Math.max(Au(at),2)}function hv(bt){const at=function(ft){const Dt=ft?yo(ft,pu):null;return Dt?Dt.step:null}(bt);return at??1}function D_(bt,at){var ft;const Dt=bt&&yo(bt,pu),tn=Math.abs((ft=Dt==null?void 0:Dt.step)!==null&&ft!==void 0?ft:at);return tn===0?.1:Math.pow(10,Math.floor(Math.log10(tn))-1)}const S0=sn("ckb");class xA{constructor(at,ft){this.onValueChange_=this.onValueChange_.bind(this),this.element=at.createElement("div"),this.element.classList.add(S0()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("label");Dt.classList.add(S0("l")),this.element.appendChild(Dt);const tn=at.createElement("input");tn.classList.add(S0("i")),tn.type="checkbox",Dt.appendChild(tn),this.inputElement=tn,ft.viewProps.bindDisabled(this.inputElement);const Sn=at.createElement("div");Sn.classList.add(S0("w")),Dt.appendChild(Sn);const Bn=on(at,"check");Sn.appendChild(Bn),ft.value.emitter.on("change",this.onValueChange_),this.value=ft.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class DS{constructor(at,ft){this.onInputChange_=this.onInputChange_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.view=new xA(at,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(at){const ft=at.currentTarget;this.value.rawValue=ft.checked}}const w1={id:"input-bool",type:"input",accept:(bt,at)=>{if(typeof bt!="boolean")return null;const ft=Zn(at,{options:ur.optional.custom(E0)});return ft?{initialValue:bt,params:ft}:null},binding:{reader:bt=>uo,constraint:bt=>function(at){const ft=[],Dt=Ul(at.options);return Dt&&ft.push(Dt),new Ho(ft)}(bt.params),writer:bt=>Wv},controller:bt=>{var at;const ft=bt.document,Dt=bt.value,tn=bt.constraint;return tn&&yo(tn,Zo)?new xl(ft,{props:zn.fromObject({options:(at=AA(tn))!==null&&at!==void 0?at:[]}),value:Dt,viewProps:bt.viewProps}):new DS(ft,{value:Dt,viewProps:bt.viewProps})}},dv=sn("col");class bA{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(dv()),ft.foldable.bindExpandedClass(this.element,dv(void 0,"expanded")),Ht(ft.foldable,"completed",an(this.element,dv(void 0,"cpl")));const Dt=at.createElement("div");Dt.classList.add(dv("h")),this.element.appendChild(Dt);const tn=at.createElement("div");tn.classList.add(dv("s")),Dt.appendChild(tn),this.swatchElement=tn;const Sn=at.createElement("div");if(Sn.classList.add(dv("t")),Dt.appendChild(Sn),this.textElement=Sn,ft.pickerLayout==="inline"){const Bn=at.createElement("div");Bn.classList.add(dv("p")),this.element.appendChild(Bn),this.pickerElement=Bn}else this.pickerElement=null}}function js(bt,at,ft){const Dt=yA(bt,360),tn=Wo(at/100,0,1),Sn=Wo(ft/100,0,1),Bn=Sn*tn,pr=Bn*(1-Math.abs(Dt/60%2-1)),Or=Sn-Bn;let As,Ds,ms;return[As,Ds,ms]=Dt>=0&&Dt<60?[Bn,pr,0]:Dt>=60&&Dt<120?[pr,Bn,0]:Dt>=120&&Dt<180?[0,Bn,pr]:Dt>=180&&Dt<240?[0,pr,Bn]:Dt>=240&&Dt<300?[pr,0,Bn]:[Bn,0,pr],[255*(As+Or),255*(Ds+Or),255*(ms+Or)]}function nu(bt){return[bt[0],bt[1],bt[2]]}function Bw(bt,at){return[bt[0],bt[1],bt[2],at]}const R_={hsl:{hsl:(bt,at,ft)=>[bt,at,ft],hsv:function(bt,at,ft){const Dt=ft+at*(100-Math.abs(2*ft-100))/200;return[bt,Dt!==0?at*(100-Math.abs(2*ft-100))/Dt:0,ft+at*(100-Math.abs(2*ft-100))/200]},rgb:function(bt,at,ft){const Dt=(bt%360+360)%360,tn=Wo(at/100,0,1),Sn=Wo(ft/100,0,1),Bn=(1-Math.abs(2*Sn-1))*tn,pr=Bn*(1-Math.abs(Dt/60%2-1)),Or=Sn-Bn/2;let As,Ds,ms;return[As,Ds,ms]=Dt>=0&&Dt<60?[Bn,pr,0]:Dt>=60&&Dt<120?[pr,Bn,0]:Dt>=120&&Dt<180?[0,Bn,pr]:Dt>=180&&Dt<240?[0,pr,Bn]:Dt>=240&&Dt<300?[pr,0,Bn]:[Bn,0,pr],[255*(As+Or),255*(Ds+Or),255*(ms+Or)]}},hsv:{hsl:function(bt,at,ft){const Dt=100-Math.abs(ft*(200-at)/100-100);return[bt,Dt!==0?at*ft/Dt:0,ft*(200-at)/200]},hsv:(bt,at,ft)=>[bt,at,ft],rgb:js},rgb:{hsl:function(bt,at,ft){const Dt=Wo(bt/255,0,1),tn=Wo(at/255,0,1),Sn=Wo(ft/255,0,1),Bn=Math.max(Dt,tn,Sn),pr=Math.min(Dt,tn,Sn),Or=Bn-pr;let As=0,Ds=0;const ms=(pr+Bn)/2;return Or!==0&&(Ds=Or/(1-Math.abs(Bn+pr-1)),As=Dt===Bn?(tn-Sn)/Or:tn===Bn?2+(Sn-Dt)/Or:4+(Dt-tn)/Or,As=As/6+(As<0?1:0)),[360*As,100*Ds,100*ms]},hsv:function(bt,at,ft){const Dt=Wo(bt/255,0,1),tn=Wo(at/255,0,1),Sn=Wo(ft/255,0,1),Bn=Math.max(Dt,tn,Sn),pr=Bn-Math.min(Dt,tn,Sn);let Or;return Or=pr===0?0:Bn===Dt?((tn-Sn)/pr%6+6)%6*60:Bn===tn?60*((Sn-Dt)/pr+2):60*((Dt-tn)/pr+4),[Or,100*(Bn===0?0:pr/Bn),100*Bn]},rgb:(bt,at,ft)=>[bt,at,ft]}},Cy={hsl:bt=>{var at;return[yA(bt[0],360),Wo(bt[1],0,100),Wo(bt[2],0,100),Wo((at=bt[3])!==null&&at!==void 0?at:1,0,1)]},hsv:bt=>{var at;return[yA(bt[0],360),Wo(bt[1],0,100),Wo(bt[2],0,100),Wo((at=bt[3])!==null&&at!==void 0?at:1,0,1)]},rgb:bt=>{var at;return[Wo(bt[0],0,255),Wo(bt[1],0,255),Wo(bt[2],0,255),Wo((at=bt[3])!==null&&at!==void 0?at:1,0,1)]}};function Xu(bt,at){return typeof bt=="object"&&!St(bt)&&at in bt&&typeof bt[at]=="number"}class Ts{constructor(at,ft){this.mode_=ft,this.comps_=Cy[ft](at)}static black(){return new Ts([0,0,0],"rgb")}static fromObject(at){const ft="a"in at?[at.r,at.g,at.b,at.a]:[at.r,at.g,at.b];return new Ts(ft,"rgb")}static toRgbaObject(at){return at.toRgbaObject()}static isRgbColorObject(at){return Xu(at,"r")&&Xu(at,"g")&&Xu(at,"b")}static isRgbaColorObject(at){return this.isRgbColorObject(at)&&Xu(at,"a")}static isColorObject(at){return this.isRgbColorObject(at)}static equals(at,ft){if(at.mode_!==ft.mode_)return!1;const Dt=at.comps_,tn=ft.comps_;for(let Sn=0;Sn<Dt.length;Sn++)if(Dt[Sn]!==tn[Sn])return!1;return!0}get mode(){return this.mode_}getComponents(at){return Bw((ft=nu(this.comps_),Dt=this.mode_,tn=at||this.mode_,R_[Dt][tn](...ft)),this.comps_[3]);var ft,Dt,tn}toRgbaObject(){const at=this.getComponents("rgb");return{r:at[0],g:at[1],b:at[2],a:at[3]}}}const jm=sn("colp");class My{constructor(at,ft){this.alphaViews_=null,this.element=at.createElement("div"),this.element.classList.add(jm());const Dt=at.createElement("div");Dt.classList.add(jm("hsv"));const tn=at.createElement("div");tn.classList.add(jm("sv")),this.svPaletteView_=ft.svPaletteView,tn.appendChild(this.svPaletteView_.element),Dt.appendChild(tn);const Sn=at.createElement("div");Sn.classList.add(jm("h")),this.hPaletteView_=ft.hPaletteView,Sn.appendChild(this.hPaletteView_.element),Dt.appendChild(Sn),this.element.appendChild(Dt);const Bn=at.createElement("div");if(Bn.classList.add(jm("rgb")),this.textView_=ft.textView,Bn.appendChild(this.textView_.element),this.element.appendChild(Bn),ft.alphaViews){this.alphaViews_={palette:ft.alphaViews.palette,text:ft.alphaViews.text};const pr=at.createElement("div");pr.classList.add(jm("a"));const Or=at.createElement("div");Or.classList.add(jm("ap")),Or.appendChild(this.alphaViews_.palette.element),pr.appendChild(Or);const As=at.createElement("div");As.classList.add(jm("at")),As.appendChild(this.alphaViews_.text.element),pr.appendChild(As),this.element.appendChild(pr)}}get allFocusableElements(){const at=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(ft=>ft.inputElement)];return this.alphaViews_&&at.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),at}}function Ty(bt){const at=ur;return Zn(bt,{alpha:at.optional.boolean,expanded:at.optional.boolean,picker:at.optional.custom(A1)})}function qv(bt){return bt?.1:1}function sp(bt,at){const ft=bt.match(/^(.+)%$/);return Math.min(ft?.01*parseFloat(ft[1])*at:parseFloat(bt),at)}const pv={deg:bt=>bt,grad:bt=>360*bt/400,rad:bt=>360*bt/(2*Math.PI),turn:bt=>360*bt};function $a(bt){const at=bt.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!at)return parseFloat(bt);const ft=parseFloat(at[1]),Dt=at[2];return pv[Dt](ft)}const EA={"func.rgb":bt=>{const at=bt.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!at)return null;const ft=[sp(at[1],255),sp(at[2],255),sp(at[3],255)];return isNaN(ft[0])||isNaN(ft[1])||isNaN(ft[2])?null:new Ts(ft,"rgb")},"func.rgba":bt=>{const at=bt.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!at)return null;const ft=[sp(at[1],255),sp(at[2],255),sp(at[3],255),sp(at[4],1)];return isNaN(ft[0])||isNaN(ft[1])||isNaN(ft[2])||isNaN(ft[3])?null:new Ts(ft,"rgb")},"func.hsl":bt=>{const at=bt.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!at)return null;const ft=[$a(at[1]),sp(at[2],100),sp(at[3],100)];return isNaN(ft[0])||isNaN(ft[1])||isNaN(ft[2])?null:new Ts(ft,"hsl")},"func.hsla":bt=>{const at=bt.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!at)return null;const ft=[$a(at[1]),sp(at[2],100),sp(at[3],100),sp(at[4],1)];return isNaN(ft[0])||isNaN(ft[1])||isNaN(ft[2])||isNaN(ft[3])?null:new Ts(ft,"hsl")},"hex.rgb":bt=>{const at=bt.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(at)return new Ts([parseInt(at[1]+at[1],16),parseInt(at[2]+at[2],16),parseInt(at[3]+at[3],16)],"rgb");const ft=bt.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ft?new Ts([parseInt(ft[1],16),parseInt(ft[2],16),parseInt(ft[3],16)],"rgb"):null},"hex.rgba":bt=>{const at=bt.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(at)return new Ts([parseInt(at[1]+at[1],16),parseInt(at[2]+at[2],16),parseInt(at[3]+at[3],16),wo(parseInt(at[4]+at[4],16),0,255,0,1)],"rgb");const ft=bt.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ft?new Ts([parseInt(ft[1],16),parseInt(ft[2],16),parseInt(ft[3],16),wo(parseInt(ft[4],16),0,255,0,1)],"rgb"):null}};function Lr(bt){return Object.keys(EA).reduce((at,ft)=>at||((0,EA[ft])(bt)?ft:null),null)}const Ru=bt=>{const at=Lr(bt);return at?EA[at](bt):null};function x1(bt){return bt==="func.hsla"||bt==="func.rgba"||bt==="hex.rgba"}function Ow(bt){if(typeof bt=="string"){const at=Ru(bt);if(at)return at}return Ts.black()}function k_(bt){const at=Wo(Math.floor(bt),0,255).toString(16);return at.length===1?`0${at}`:at}function B_(bt,at="#"){return`${at}${nu(bt.getComponents("rgb")).map(k_).join("")}`}function _m(bt,at="#"){const ft=bt.getComponents("rgb");return`${at}${[ft[0],ft[1],ft[2],255*ft[3]].map(k_).join("")}`}function Iy(bt){const at=Ml(0);return`rgb(${nu(bt.getComponents("rgb")).map(ft=>at(ft)).join(", ")})`}function C0(bt){const at=Ml(2),ft=Ml(0);return`rgba(${bt.getComponents("rgb").map((Dt,tn)=>(tn===3?at:ft)(Dt)).join(", ")})`}const Ku={"func.hsl":function(bt){const at=[Ml(0),Gv,Gv];return`hsl(${nu(bt.getComponents("hsl")).map((ft,Dt)=>at[Dt](ft)).join(", ")})`},"func.hsla":function(bt){const at=[Ml(0),Gv,Gv,Ml(2)];return`hsla(${bt.getComponents("hsl").map((ft,Dt)=>at[Dt](ft)).join(", ")})`},"func.rgb":Iy,"func.rgba":C0,"hex.rgb":B_,"hex.rgba":_m};function SA(bt){return Ku[bt]}const zl=sn("apl");class Xp{constructor(at,ft){this.onValueChange_=this.onValueChange_.bind(this),this.value=ft.value,this.value.emitter.on("change",this.onValueChange_),this.element=at.createElement("div"),this.element.classList.add(zl()),ft.viewProps.bindTabIndex(this.element);const Dt=at.createElement("div");Dt.classList.add(zl("b")),this.element.appendChild(Dt);const tn=at.createElement("div");tn.classList.add(zl("c")),Dt.appendChild(tn),this.colorElem_=tn;const Sn=at.createElement("div");Sn.classList.add(zl("m")),this.element.appendChild(Sn),this.markerElem_=Sn;const Bn=at.createElement("div");Bn.classList.add(zl("p")),this.markerElem_.appendChild(Bn),this.previewElem_=Bn,this.update_()}update_(){const at=this.value.rawValue,ft=at.getComponents("rgb"),Dt=new Ts([ft[0],ft[1],ft[2],0],"rgb"),tn=new Ts([ft[0],ft[1],ft[2],255],"rgb"),Sn=["to right",C0(Dt),C0(tn)];this.colorElem_.style.background=`linear-gradient(${Sn.join(",")})`,this.previewElem_.style.backgroundColor=C0(at);const Bn=wo(ft[3],0,1,0,100);this.markerElem_.style.left=`${Bn}%`}onValueChange_(){this.update_()}}class M0{constructor(at,ft){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.view=new Xp(at,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Du(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(at,ft){if(!at.point)return;const Dt=at.point.x/at.bounds.width,tn=this.value.rawValue,[Sn,Bn,pr]=tn.getComponents("hsv");this.value.setRawValue(new Ts([Sn,Bn,pr,Dt],"hsv"),ft)}onPointerDown_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerMove_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerUp_(at){this.handlePointerEvent_(at.data,{forceEmit:!0,last:!0})}onKeyDown_(at){const ft=ip(qv(!0),Iu(at));if(ft===0)return;const Dt=this.value.rawValue,[tn,Sn,Bn,pr]=Dt.getComponents("hsv");this.value.setRawValue(new Ts([tn,Sn,Bn,pr+ft],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(at){ip(qv(!0),Iu(at))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Rp=sn("coltxt");class CA{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(Rp());const Dt=at.createElement("div");Dt.classList.add(Rp("m")),this.modeElem_=function(Bn){const pr=Bn.createElement("select");return pr.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Or,As)=>{const Ds=Bn.createElement("option");return Ds.textContent=As.text,Ds.value=As.value,Or.appendChild(Ds),Or},Bn.createDocumentFragment())),pr}(at),this.modeElem_.classList.add(Rp("ms")),Dt.appendChild(this.modeSelectElement);const tn=at.createElement("div");tn.classList.add(Rp("mm")),tn.appendChild(on(at,"dropdown")),Dt.appendChild(tn),this.element.appendChild(Dt);const Sn=at.createElement("div");Sn.classList.add(Rp("w")),this.element.appendChild(Sn),this.textsElem_=Sn,this.textViews_=ft.textViews,this.applyTextViews_(),Ut(ft.colorMode,Bn=>{this.modeElem_.value=Bn})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(at){this.textViews_=at,this.applyTextViews_()}applyTextViews_(){Tr(this.textsElem_);const at=this.element.ownerDocument;this.textViews_.forEach(ft=>{const Dt=at.createElement("div");Dt.classList.add(Rp("c")),Dt.appendChild(ft.element),this.textsElem_.appendChild(Dt)})}}const as=Ml(0),Kp={rgb:()=>new _o({min:0,max:255}),hsl:bt=>new _o(bt===0?{min:0,max:360}:{min:0,max:100}),hsv:bt=>new _o(bt===0?{min:0,max:360}:{min:0,max:100})};function Py(bt,at,ft){return new I_(bt,{arrayPosition:ft===0?"fst":ft===2?"lst":"mid",baseStep:qv(!1),parser:at.parser,props:zn.fromObject({draggingScale:1,formatter:as}),value:hn(0,{constraint:Kp[at.colorMode](ft)}),viewProps:at.viewProps})}class O_{constructor(at,ft){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=ft.parser,this.value=ft.value,this.viewProps=ft.viewProps,this.colorMode=hn(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(at),this.view=new CA(at,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(at){const ft={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},Dt=[Py(at,ft,0),Py(at,ft,1),Py(at,ft,2)];return Dt.forEach((tn,Sn)=>{M_({primary:this.value,secondary:tn.value,forward:Bn=>Bn.rawValue.getComponents(this.colorMode.rawValue)[Sn],backward:(Bn,pr)=>{const Or=this.colorMode.rawValue,As=Bn.rawValue.getComponents(Or);return As[Sn]=pr.rawValue,new Ts(Bw(nu(As),As[3]),Or)}})}),Dt}onModeSelectChange_(at){const ft=at.currentTarget;this.colorMode.rawValue=ft.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const T0=sn("hpl");class Lw{constructor(at,ft){this.onValueChange_=this.onValueChange_.bind(this),this.value=ft.value,this.value.emitter.on("change",this.onValueChange_),this.element=at.createElement("div"),this.element.classList.add(T0()),ft.viewProps.bindTabIndex(this.element);const Dt=at.createElement("div");Dt.classList.add(T0("c")),this.element.appendChild(Dt);const tn=at.createElement("div");tn.classList.add(T0("m")),this.element.appendChild(tn),this.markerElem_=tn,this.update_()}update_(){const at=this.value.rawValue,[ft]=at.getComponents("hsv");this.markerElem_.style.backgroundColor=Iy(new Ts([ft,100,100],"hsv"));const Dt=wo(ft,0,360,0,100);this.markerElem_.style.left=`${Dt}%`}onValueChange_(){this.update_()}}class vu{constructor(at,ft){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.view=new Lw(at,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Du(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(at,ft){if(!at.point)return;const Dt=wo(Wo(at.point.x,0,at.bounds.width),0,at.bounds.width,0,359),tn=this.value.rawValue,[,Sn,Bn,pr]=tn.getComponents("hsv");this.value.setRawValue(new Ts([Dt,Sn,Bn,pr],"hsv"),ft)}onPointerDown_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerMove_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerUp_(at){this.handlePointerEvent_(at.data,{forceEmit:!0,last:!0})}onKeyDown_(at){const ft=ip(qv(!1),Iu(at));if(ft===0)return;const Dt=this.value.rawValue,[tn,Sn,Bn,pr]=Dt.getComponents("hsv");this.value.setRawValue(new Ts([tn+ft,Sn,Bn,pr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(at){ip(qv(!1),Iu(at))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Uo=sn("svp");class wp{constructor(at,ft){this.onValueChange_=this.onValueChange_.bind(this),this.value=ft.value,this.value.emitter.on("change",this.onValueChange_),this.element=at.createElement("div"),this.element.classList.add(Uo()),ft.viewProps.bindTabIndex(this.element);const Dt=at.createElement("canvas");Dt.height=64,Dt.width=64,Dt.classList.add(Uo("c")),this.element.appendChild(Dt),this.canvasElement=Dt;const tn=at.createElement("div");tn.classList.add(Uo("m")),this.element.appendChild(tn),this.markerElem_=tn,this.update_()}update_(){const at=function(As){const Ds=As.ownerDocument.defaultView;return Ds&&"document"in Ds?As.getContext("2d"):null}(this.canvasElement);if(!at)return;const ft=this.value.rawValue.getComponents("hsv"),Dt=this.canvasElement.width,tn=this.canvasElement.height,Sn=at.getImageData(0,0,Dt,tn),Bn=Sn.data;for(let As=0;As<tn;As++)for(let Ds=0;Ds<Dt;Ds++){const ms=wo(Ds,0,Dt,0,100),Il=wo(As,0,tn,100,0),ru=js(ft[0],ms,Il),om=4*(As*Dt+Ds);Bn[om]=ru[0],Bn[om+1]=ru[1],Bn[om+2]=ru[2],Bn[om+3]=255}at.putImageData(Sn,0,0);const pr=wo(ft[1],0,100,0,100);this.markerElem_.style.left=`${pr}%`;const Or=wo(ft[2],0,100,100,0);this.markerElem_.style.top=`${Or}%`}onValueChange_(){this.update_()}}class I0{constructor(at,ft){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.view=new wp(at,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Du(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(at,ft){if(!at.point)return;const Dt=wo(at.point.x,0,at.bounds.width,0,100),tn=wo(at.point.y,0,at.bounds.height,100,0),[Sn,,,Bn]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Ts([Sn,Dt,tn,Bn],"hsv"),ft)}onPointerDown_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerMove_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerUp_(at){this.handlePointerEvent_(at.data,{forceEmit:!0,last:!0})}onKeyDown_(at){Pu(at.key)&&at.preventDefault();const[ft,Dt,tn,Sn]=this.value.rawValue.getComponents("hsv"),Bn=qv(!1),pr=ip(Bn,Iu(at)),Or=ip(Bn,b0(at));pr===0&&Or===0||this.value.setRawValue(new Ts([ft,Dt+pr,tn+Or,Sn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(at){const ft=qv(!1),Dt=ip(ft,Iu(at)),tn=ip(ft,b0(at));Dt===0&&tn===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class b1{constructor(at,ft){this.value=ft.value,this.viewProps=ft.viewProps,this.hPaletteC_=new vu(at,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new I0(at,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=ft.supportsAlpha?{palette:new M0(at,{value:this.value,viewProps:this.viewProps}),text:new I_(at,{parser:gu,baseStep:.1,props:zn.fromObject({draggingScale:.01,formatter:Ml(2)}),value:hn(0,{constraint:new _o({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&M_({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Dt=>Dt.rawValue.getComponents()[3],backward:(Dt,tn)=>{const Sn=Dt.rawValue.getComponents();return Sn[3]=tn.rawValue,new Ts(Sn,Dt.rawValue.mode)}}),this.textC_=new O_(at,{parser:gu,value:this.value,viewProps:this.viewProps}),this.view=new My(at,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:ft.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const L_=sn("colsw");class MA{constructor(at,ft){this.onValueChange_=this.onValueChange_.bind(this),ft.value.emitter.on("change",this.onValueChange_),this.value=ft.value,this.element=at.createElement("div"),this.element.classList.add(L_()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("div");Dt.classList.add(L_("sw")),this.element.appendChild(Dt),this.swatchElem_=Dt;const tn=at.createElement("button");tn.classList.add(L_("b")),ft.viewProps.bindDisabled(tn),this.element.appendChild(tn),this.buttonElement=tn,this.update_()}update_(){const at=this.value.rawValue;this.swatchElem_.style.backgroundColor=_m(at)}onValueChange_(){this.update_()}}class $p{constructor(at,ft){this.value=ft.value,this.viewProps=ft.viewProps,this.view=new MA(at,{value:this.value,viewProps:this.viewProps})}}class ku{constructor(at,ft){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.foldable_=ks.create(ft.expanded),this.swatchC_=new $p(at,{value:this.value,viewProps:this.viewProps});const Dt=this.swatchC_.view.buttonElement;Dt.addEventListener("blur",this.onButtonBlur_),Dt.addEventListener("click",this.onButtonClick_),this.textC_=new No(at,{parser:ft.parser,props:zn.fromObject({formatter:ft.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new bA(at,{foldable:this.foldable_,pickerLayout:ft.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=ft.pickerLayout==="popup"?new ls(at,{viewProps:this.viewProps}):null;const tn=new b1(at,{supportsAlpha:ft.supportsAlpha,value:this.value,viewProps:this.viewProps});tn.view.allFocusableElements.forEach(Sn=>{Sn.addEventListener("blur",this.onPopupChildBlur_),Sn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=tn,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(tn.view.element),M_({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Sn=>Sn.rawValue,backward:(Sn,Bn)=>Bn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),to(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(at){if(!this.popC_)return;const ft=this.view.element,Dt=at.relatedTarget;Dt&&ft.contains(Dt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(at){if(!this.popC_)return;const ft=this.popC_.view.element,Dt=kr(at);Dt&&ft.contains(Dt)||Dt&&Dt===this.swatchC_.view.buttonElement&&!$n(ft.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(at){this.popC_?at.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&at.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function xn(bt){return Ts.isColorObject(bt)?Ts.fromObject(bt):Ts.black()}function fv(bt){return nu(bt.getComponents("rgb")).reduce((at,ft)=>at<<8|255&Math.floor(ft),0)}function Jp(bt){return bt.getComponents("rgb").reduce((at,ft,Dt)=>at<<8|255&Math.floor(Dt===3?255*ft:ft),0)>>>0}function N_(bt){return typeof bt!="number"?Ts.black():new Ts([(at=bt)>>16&255,at>>8&255,255&at],"rgb");var at}function mv(bt){return typeof bt!="number"?Ts.black():new Ts([(at=bt)>>24&255,at>>16&255,at>>8&255,wo(255&at,0,255,0,1)],"rgb");var at}function F_(bt,at){const ft=at.toRgbaObject();bt.writeProperty("r",ft.r),bt.writeProperty("g",ft.g),bt.writeProperty("b",ft.b),bt.writeProperty("a",ft.a)}function TA(bt,at){const ft=at.toRgbaObject();bt.writeProperty("r",ft.r),bt.writeProperty("g",ft.g),bt.writeProperty("b",ft.b)}function ym(bt){return"alpha"in bt&&bt.alpha===!0}function Yv(bt){return bt?at=>_m(at,"0x"):at=>B_(at,"0x")}const gv={id:"input-color-number",type:"input",accept:(bt,at)=>{if(typeof bt!="number"||!("view"in at)||at.view!=="color")return null;const ft=Ty(at);return ft?{initialValue:bt,params:ft}:null},binding:{reader:bt=>ym(bt.params)?mv:N_,equals:Ts.equals,writer:bt=>function(at){const ft=at?Jp:fv;return(Dt,tn)=>{Wv(Dt,ft(tn))}}(ym(bt.params))},controller:bt=>{const at=ym(bt.params),ft="expanded"in bt.params?bt.params.expanded:void 0,Dt="picker"in bt.params?bt.params.picker:void 0;return new ku(bt.document,{expanded:ft!=null&&ft,formatter:Yv(at),parser:Ru,pickerLayout:Dt??"popup",supportsAlpha:at,value:bt.value,viewProps:bt.viewProps})}},Am={id:"input-color-object",type:"input",accept:(bt,at)=>{if(!Ts.isColorObject(bt))return null;const ft=Ty(at);return ft?{initialValue:bt,params:ft}:null},binding:{reader:bt=>xn,equals:Ts.equals,writer:bt=>{return at=bt.initialValue,Ts.isRgbaColorObject(at)?F_:TA;var at}},controller:bt=>{const at=Ts.isRgbaColorObject(bt.initialValue),ft="expanded"in bt.params?bt.params.expanded:void 0,Dt="picker"in bt.params?bt.params.picker:void 0,tn=at?_m:B_;return new ku(bt.document,{expanded:ft!=null&&ft,formatter:tn,parser:Ru,pickerLayout:Dt??"popup",supportsAlpha:at,value:bt.value,viewProps:bt.viewProps})}},Xv={id:"input-color-string",type:"input",accept:(bt,at)=>{if(typeof bt!="string"||"view"in at&&at.view==="text"||!Lr(bt))return null;const ft=Ty(at);return ft?{initialValue:bt,params:ft}:null},binding:{reader:bt=>Ow,equals:Ts.equals,writer:bt=>{const at=Lr(bt.initialValue);if(!at)throw Yt.shouldNeverHappen();return function(ft){const Dt=SA(ft);return(tn,Sn)=>{Wv(tn,Dt(Sn))}}(at)}},controller:bt=>{const at=Lr(bt.initialValue);if(!at)throw Yt.shouldNeverHappen();const ft=SA(at),Dt="expanded"in bt.params?bt.params.expanded:void 0,tn="picker"in bt.params?bt.params.picker:void 0;return new ku(bt.document,{expanded:Dt!=null&&Dt,formatter:ft,parser:Ru,pickerLayout:tn??"popup",supportsAlpha:x1(at),value:bt.value,viewProps:bt.viewProps})}};class xp{constructor(at){this.components=at.components,this.asm_=at.assembly}constrain(at){const ft=this.asm_.toComponents(at).map((Dt,tn)=>{var Sn,Bn;return(Bn=(Sn=this.components[tn])===null||Sn===void 0?void 0:Sn.constrain(Dt))!==null&&Bn!==void 0?Bn:Dt});return this.asm_.fromComponents(ft)}}const P0=sn("pndtxt");class IA{constructor(at,ft){this.textViews=ft.textViews,this.element=at.createElement("div"),this.element.classList.add(P0()),this.textViews.forEach(Dt=>{const tn=at.createElement("div");tn.classList.add(P0("a")),tn.appendChild(Dt.element),this.element.appendChild(tn)})}}class U_{constructor(at,ft){this.value=ft.value,this.viewProps=ft.viewProps,this.acs_=ft.axes.map((Dt,tn)=>function(Sn,Bn,pr){return new I_(Sn,{arrayPosition:pr===0?"fst":pr===Bn.axes.length-1?"lst":"mid",baseStep:Bn.axes[pr].baseStep,parser:Bn.parser,props:Bn.axes[pr].textProps,value:hn(0,{constraint:Bn.axes[pr].constraint}),viewProps:Bn.viewProps})}(at,ft,tn)),this.acs_.forEach((Dt,tn)=>{M_({primary:this.value,secondary:Dt.value,forward:Sn=>ft.assembly.toComponents(Sn.rawValue)[tn],backward:(Sn,Bn)=>{const pr=ft.assembly.toComponents(Sn.rawValue);return pr[tn]=Bn.rawValue,ft.assembly.fromComponents(pr)}})}),this.view=new IA(at,{textViews:this.acs_.map(Dt=>Dt.view)})}}function Kv(bt){const at=[],ft=function(Sn){return"step"in Sn&&!St(Sn.step)?new pu(Sn.step):null}(bt);ft&&at.push(ft);const Dt=function(Sn){return"max"in Sn&&!St(Sn.max)||"min"in Sn&&!St(Sn.min)?new _o({max:Sn.max,min:Sn.min}):null}(bt);Dt&&at.push(Dt);const tn=Ul(bt.options);return tn&&at.push(tn),new Ho(at)}function PA(bt){const[at,ft]=function(Dt){const tn=Dt?yo(Dt,_o):null;return tn?[tn.minValue,tn.maxValue]:[void 0,void 0]}(bt);return[at??0,ft??100]}const xo={id:"input-number",type:"input",accept:(bt,at)=>{if(typeof bt!="number")return null;const ft=ur,Dt=Zn(at,{format:ft.optional.function,max:ft.optional.number,min:ft.optional.number,options:ft.optional.custom(E0),step:ft.optional.number});return Dt?{initialValue:bt,params:Dt}:null},binding:{reader:bt=>Wp,constraint:bt=>Kv(bt.params),writer:bt=>Wv},controller:bt=>{var at,ft;const Dt=bt.value,tn=bt.constraint;if(tn&&yo(tn,Zo))return new xl(bt.document,{props:zn.fromObject({options:(at=AA(tn))!==null&&at!==void 0?at:[]}),value:Dt,viewProps:bt.viewProps});const Sn=(ft="format"in bt.params?bt.params.format:void 0)!==null&&ft!==void 0?ft:Ml(wA(tn,Dt.rawValue));if(tn&&yo(tn,_o)){const[Bn,pr]=PA(tn);return new Yp(bt.document,{baseStep:hv(tn),parser:gu,sliderProps:zn.fromObject({maxValue:pr,minValue:Bn}),textProps:zn.fromObject({draggingScale:D_(tn,Dt.rawValue),formatter:Sn}),value:Dt,viewProps:bt.viewProps})}return new I_(bt.document,{baseStep:hv(tn),parser:gu,props:zn.fromObject({draggingScale:D_(tn,Dt.rawValue),formatter:Sn}),value:Dt,viewProps:bt.viewProps})}};class Tl{constructor(at=0,ft=0){this.x=at,this.y=ft}getComponents(){return[this.x,this.y]}static isObject(at){if(St(at))return!1;const ft=at.x,Dt=at.y;return typeof ft=="number"&&typeof Dt=="number"}static equals(at,ft){return at.x===ft.x&&at.y===ft.y}toObject(){return{x:this.x,y:this.y}}}const Zp={toComponents:bt=>bt.getComponents(),fromComponents:bt=>new Tl(...bt)},kp=sn("p2d");class _f{constructor(at,ft){this.element=at.createElement("div"),this.element.classList.add(kp()),ft.viewProps.bindClassModifiers(this.element),Ut(ft.expanded,an(this.element,kp(void 0,"expanded")));const Dt=at.createElement("div");Dt.classList.add(kp("h")),this.element.appendChild(Dt);const tn=at.createElement("button");tn.classList.add(kp("b")),tn.appendChild(on(at,"p2dpad")),ft.viewProps.bindDisabled(tn),Dt.appendChild(tn),this.buttonElement=tn;const Sn=at.createElement("div");if(Sn.classList.add(kp("t")),Dt.appendChild(Sn),this.textElement=Sn,ft.pickerLayout==="inline"){const Bn=at.createElement("div");Bn.classList.add(kp("p")),this.element.appendChild(Bn),this.pickerElement=Bn}else this.pickerElement=null}}const fu=sn("p2dp");class DA{constructor(at,ft){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=ft.invertsY,this.maxValue_=ft.maxValue,this.element=at.createElement("div"),this.element.classList.add(fu()),ft.layout==="popup"&&this.element.classList.add(fu(void 0,"p"));const Dt=at.createElement("div");Dt.classList.add(fu("p")),ft.viewProps.bindTabIndex(Dt),this.element.appendChild(Dt),this.padElement=Dt;const tn=at.createElementNS(un,"svg");tn.classList.add(fu("g")),this.padElement.appendChild(tn),this.svgElem_=tn;const Sn=at.createElementNS(un,"line");Sn.classList.add(fu("ax")),Sn.setAttributeNS(null,"x1","0"),Sn.setAttributeNS(null,"y1","50%"),Sn.setAttributeNS(null,"x2","100%"),Sn.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(Sn);const Bn=at.createElementNS(un,"line");Bn.classList.add(fu("ax")),Bn.setAttributeNS(null,"x1","50%"),Bn.setAttributeNS(null,"y1","0"),Bn.setAttributeNS(null,"x2","50%"),Bn.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Bn);const pr=at.createElementNS(un,"line");pr.classList.add(fu("l")),pr.setAttributeNS(null,"x1","50%"),pr.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(pr),this.lineElem_=pr;const Or=at.createElement("div");Or.classList.add(fu("m")),this.padElement.appendChild(Or),this.markerElem_=Or,ft.value.emitter.on("change",this.onValueChange_),this.value=ft.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[at,ft]=this.value.rawValue.getComponents(),Dt=this.maxValue_,tn=wo(at,-Dt,+Dt,0,100),Sn=wo(ft,-Dt,+Dt,0,100),Bn=this.invertsY_?100-Sn:Sn;this.lineElem_.setAttributeNS(null,"x2",`${tn}%`),this.lineElem_.setAttributeNS(null,"y2",`${Bn}%`),this.markerElem_.style.left=`${tn}%`,this.markerElem_.style.top=`${Bn}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function D0(bt,at,ft){return[ip(at[0],Iu(bt)),ip(at[1],b0(bt))*(ft?1:-1)]}class zm{constructor(at,ft){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.baseSteps_=ft.baseSteps,this.maxValue_=ft.maxValue,this.invertsY_=ft.invertsY,this.view=new DA(at,{invertsY:this.invertsY_,layout:ft.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Du(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(at,ft){if(!at.point)return;const Dt=this.maxValue_,tn=wo(at.point.x,0,at.bounds.width,-Dt,+Dt),Sn=wo(this.invertsY_?at.bounds.height-at.point.y:at.point.y,0,at.bounds.height,-Dt,+Dt);this.value.setRawValue(new Tl(tn,Sn),ft)}onPointerDown_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerMove_(at){this.handlePointerEvent_(at.data,{forceEmit:!1,last:!1})}onPointerUp_(at){this.handlePointerEvent_(at.data,{forceEmit:!0,last:!0})}onPadKeyDown_(at){Pu(at.key)&&at.preventDefault();const[ft,Dt]=D0(at,this.baseSteps_,this.invertsY_);ft===0&&Dt===0||this.value.setRawValue(new Tl(this.value.rawValue.x+ft,this.value.rawValue.y+Dt),{forceEmit:!1,last:!1})}onPadKeyUp_(at){const[ft,Dt]=D0(at,this.baseSteps_,this.invertsY_);ft===0&&Dt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class R0{constructor(at,ft){var Dt,tn;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.foldable_=ks.create(ft.expanded),this.popC_=ft.pickerLayout==="popup"?new ls(at,{viewProps:this.viewProps}):null;const Sn=new zm(at,{baseSteps:[ft.axes[0].baseStep,ft.axes[1].baseStep],invertsY:ft.invertsY,layout:ft.pickerLayout,maxValue:ft.maxValue,value:this.value,viewProps:this.viewProps});Sn.view.allFocusableElements.forEach(Bn=>{Bn.addEventListener("blur",this.onPopupChildBlur_),Bn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Sn,this.textC_=new U_(at,{assembly:Zp,axes:ft.axes,parser:ft.parser,value:this.value,viewProps:this.viewProps}),this.view=new _f(at,{expanded:this.foldable_.value("expanded"),pickerLayout:ft.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Dt=this.view.buttonElement)===null||Dt===void 0||Dt.addEventListener("blur",this.onPadButtonBlur_),(tn=this.view.buttonElement)===null||tn===void 0||tn.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),M_({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Bn=>Bn.rawValue,backward:(Bn,pr)=>pr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),to(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(at){if(!this.popC_)return;const ft=this.view.element,Dt=at.relatedTarget;Dt&&ft.contains(Dt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(at){if(!this.popC_)return;const ft=this.popC_.view.element,Dt=kr(at);Dt&&ft.contains(Dt)||Dt&&Dt===this.view.buttonElement&&!$n(ft.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(at){this.popC_?at.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&at.key==="Escape"&&this.view.buttonElement.focus()}}function Dy(bt){return Tl.isObject(bt)?new Tl(bt.x,bt.y):new Tl}function RA(bt,at){bt.writeProperty("x",at.x),bt.writeProperty("y",at.y)}function $v(bt){if(!bt)return;const at=[];return St(bt.step)||at.push(new pu(bt.step)),St(bt.max)&&St(bt.min)||at.push(new _o({max:bt.max,min:bt.min})),new Ho(at)}function zs(bt,at){const ft=bt&&yo(bt,_o);if(ft)return Math.max(Math.abs(ft.minValue||0),Math.abs(ft.maxValue||0));const Dt=hv(bt);return Math.max(10*Math.abs(Dt),10*Math.abs(at))}function Ko(bt,at){const ft=at instanceof xp?at.components[0]:void 0,Dt=at instanceof xp?at.components[1]:void 0,tn=zs(ft,bt.x),Sn=zs(Dt,bt.y);return Math.max(tn,Sn)}function wu(bt,at){return{baseStep:hv(at),constraint:at,textProps:zn.fromObject({draggingScale:D_(at,bt),formatter:Ml(wA(at,bt))})}}function em(bt){if(!("y"in bt))return!1;const at=bt.y;return!!at&&"inverted"in at&&!!at.inverted}const vv={id:"input-point2d",type:"input",accept:(bt,at)=>{if(!Tl.isObject(bt))return null;const ft=ur,Dt=Zn(at,{expanded:ft.optional.boolean,picker:ft.optional.custom(A1),x:ft.optional.custom(Um),y:ft.optional.object({inverted:ft.optional.boolean,max:ft.optional.number,min:ft.optional.number,step:ft.optional.number})});return Dt?{initialValue:bt,params:Dt}:null},binding:{reader:bt=>Dy,constraint:bt=>{return at=bt.params,new xp({assembly:Zp,components:[$v("x"in at?at.x:void 0),$v("y"in at?at.y:void 0)]});var at},equals:Tl.equals,writer:bt=>RA},controller:bt=>{const at=bt.document,ft=bt.value,Dt=bt.constraint;if(!(Dt instanceof xp))throw Yt.shouldNeverHappen();const tn="expanded"in bt.params?bt.params.expanded:void 0,Sn="picker"in bt.params?bt.params.picker:void 0;return new R0(at,{axes:[wu(ft.rawValue.x,Dt.components[0]),wu(ft.rawValue.y,Dt.components[1])],expanded:tn!=null&&tn,invertsY:em(bt.params),maxValue:Ko(ft.rawValue,Dt),parser:gu,pickerLayout:Sn??"popup",value:ft,viewProps:bt.viewProps})}};class xu{constructor(at=0,ft=0,Dt=0){this.x=at,this.y=ft,this.z=Dt}getComponents(){return[this.x,this.y,this.z]}static isObject(at){if(St(at))return!1;const ft=at.x,Dt=at.y,tn=at.z;return typeof ft=="number"&&typeof Dt=="number"&&typeof tn=="number"}static equals(at,ft){return at.x===ft.x&&at.y===ft.y&&at.z===ft.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const k0={toComponents:bt=>bt.getComponents(),fromComponents:bt=>new xu(...bt)};function bp(bt){return xu.isObject(bt)?new xu(bt.x,bt.y,bt.z):new xu}function Nw(bt,at){bt.writeProperty("x",at.x),bt.writeProperty("y",at.y),bt.writeProperty("z",at.z)}function Ry(bt){if(!bt)return;const at=[];return St(bt.step)||at.push(new pu(bt.step)),St(bt.max)&&St(bt.min)||at.push(new _o({max:bt.max,min:bt.min})),new Ho(at)}function wm(bt,at){return{baseStep:hv(at),constraint:at,textProps:zn.fromObject({draggingScale:D_(at,bt),formatter:Ml(wA(at,bt))})}}const op={id:"input-point3d",type:"input",accept:(bt,at)=>{if(!xu.isObject(bt))return null;const ft=ur,Dt=Zn(at,{x:ft.optional.custom(Um),y:ft.optional.custom(Um),z:ft.optional.custom(Um)});return Dt?{initialValue:bt,params:Dt}:null},binding:{reader:bt=>bp,constraint:bt=>{return at=bt.params,new xp({assembly:k0,components:[Ry("x"in at?at.x:void 0),Ry("y"in at?at.y:void 0),Ry("z"in at?at.z:void 0)]});var at},equals:xu.equals,writer:bt=>Nw},controller:bt=>{const at=bt.value,ft=bt.constraint;if(!(ft instanceof xp))throw Yt.shouldNeverHappen();return new U_(bt.document,{assembly:k0,axes:[wm(at.rawValue.x,ft.components[0]),wm(at.rawValue.y,ft.components[1]),wm(at.rawValue.z,ft.components[2])],parser:gu,value:at,viewProps:bt.viewProps})}};class _v{constructor(at=0,ft=0,Dt=0,tn=0){this.x=at,this.y=ft,this.z=Dt,this.w=tn}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(at){if(St(at))return!1;const ft=at.x,Dt=at.y,tn=at.z,Sn=at.w;return typeof ft=="number"&&typeof Dt=="number"&&typeof tn=="number"&&typeof Sn=="number"}static equals(at,ft){return at.x===ft.x&&at.y===ft.y&&at.z===ft.z&&at.w===ft.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const j_={toComponents:bt=>bt.getComponents(),fromComponents:bt=>new _v(...bt)};function Bu(bt){return _v.isObject(bt)?new _v(bt.x,bt.y,bt.z,bt.w):new _v}function Bp(bt,at){bt.writeProperty("x",at.x),bt.writeProperty("y",at.y),bt.writeProperty("z",at.z),bt.writeProperty("w",at.w)}function $u(bt){if(!bt)return;const at=[];return St(bt.step)||at.push(new pu(bt.step)),St(bt.max)&&St(bt.min)||at.push(new _o({max:bt.max,min:bt.min})),new Ho(at)}const Vm={id:"input-point4d",type:"input",accept:(bt,at)=>{if(!_v.isObject(bt))return null;const ft=ur,Dt=Zn(at,{x:ft.optional.custom(Um),y:ft.optional.custom(Um),z:ft.optional.custom(Um),w:ft.optional.custom(Um)});return Dt?{initialValue:bt,params:Dt}:null},binding:{reader:bt=>Bu,constraint:bt=>{return at=bt.params,new xp({assembly:j_,components:[$u("x"in at?at.x:void 0),$u("y"in at?at.y:void 0),$u("z"in at?at.z:void 0),$u("w"in at?at.w:void 0)]});var at},equals:_v.equals,writer:bt=>Bp},controller:bt=>{const at=bt.value,ft=bt.constraint;if(!(ft instanceof xp))throw Yt.shouldNeverHappen();return new U_(bt.document,{assembly:j_,axes:at.rawValue.getComponents().map((Dt,tn)=>{return Sn=Dt,{baseStep:hv(Bn=ft.components[tn]),constraint:Bn,textProps:zn.fromObject({draggingScale:D_(Bn,Sn),formatter:Ml(wA(Bn,Sn))})};var Sn,Bn}),parser:gu,value:at,viewProps:bt.viewProps})}},kA={id:"input-string",type:"input",accept:(bt,at)=>{if(typeof bt!="string")return null;const ft=Zn(at,{options:ur.optional.custom(E0)});return ft?{initialValue:bt,params:ft}:null},binding:{reader:bt=>y1,constraint:bt=>function(at){const ft=[],Dt=Ul(at.options);return Dt&&ft.push(Dt),new Ho(ft)}(bt.params),writer:bt=>Wv},controller:bt=>{var at;const ft=bt.document,Dt=bt.value,tn=bt.constraint;return tn&&yo(tn,Zo)?new xl(ft,{props:zn.fromObject({options:(at=AA(tn))!==null&&at!==void 0?at:[]}),value:Dt,viewProps:bt.viewProps}):new No(ft,{parser:Sn=>Sn,props:zn.fromObject({formatter:C_}),value:Dt,viewProps:bt.viewProps})}},Jv={defaultInterval:200,defaultLineCount:3},ky=sn("mll");class z_{constructor(at,ft){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ft.formatter,this.element=at.createElement("div"),this.element.classList.add(ky()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("textarea");Dt.classList.add(ky("i")),Dt.style.height=`calc(var(--bld-us) * ${ft.lineCount})`,Dt.readOnly=!0,ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.textareaElem_=Dt,ft.value.emitter.on("change",this.onValueUpdate_),this.value=ft.value,this.update_()}update_(){const at=this.textareaElem_,ft=at.scrollTop===at.scrollHeight-at.clientHeight,Dt=[];this.value.rawValue.forEach(tn=>{tn!==void 0&&Dt.push(this.formatter_(tn))}),at.textContent=Dt.join(`
`),ft&&(at.scrollTop=at.scrollHeight)}onValueUpdate_(){this.update_()}}class Zv{constructor(at,ft){this.value=ft.value,this.viewProps=ft.viewProps,this.view=new z_(at,{formatter:ft.formatter,lineCount:ft.lineCount,value:this.value,viewProps:this.viewProps})}}const BA=sn("sgl");class Fw{constructor(at,ft){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ft.formatter,this.element=at.createElement("div"),this.element.classList.add(BA()),ft.viewProps.bindClassModifiers(this.element);const Dt=at.createElement("input");Dt.classList.add(BA("i")),Dt.readOnly=!0,Dt.type="text",ft.viewProps.bindDisabled(Dt),this.element.appendChild(Dt),this.inputElement=Dt,ft.value.emitter.on("change",this.onValueUpdate_),this.value=ft.value,this.update_()}update_(){const at=this.value.rawValue,ft=at[at.length-1];this.inputElement.value=ft!==void 0?this.formatter_(ft):""}onValueUpdate_(){this.update_()}}class Zs{constructor(at,ft){this.value=ft.value,this.viewProps=ft.viewProps,this.view=new Fw(at,{formatter:ft.formatter,value:this.value,viewProps:this.viewProps})}}const tm={id:"monitor-bool",type:"monitor",accept:(bt,at)=>{if(typeof bt!="boolean")return null;const ft=Zn(at,{lineCount:ur.optional.number});return ft?{initialValue:bt,params:ft}:null},binding:{reader:bt=>uo},controller:bt=>{var at;return bt.value.rawValue.length===1?new Zs(bt.document,{formatter:cv,value:bt.value,viewProps:bt.viewProps}):new Zv(bt.document,{formatter:cv,lineCount:(at=bt.params.lineCount)!==null&&at!==void 0?at:Jv.defaultLineCount,value:bt.value,viewProps:bt.viewProps})}};class Qm{constructor(){this.emitter=new Jt,this.index_=-1}get index(){return this.index_}set index(at){this.index_!==at&&(this.index_=at,this.emitter.emit("change",{index:at,sender:this}))}}const ap=sn("grl");class xm{constructor(at,ft){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=at.createElement("div"),this.element.classList.add(ap()),ft.viewProps.bindClassModifiers(this.element),this.formatter_=ft.formatter,this.minValue_=ft.minValue,this.maxValue_=ft.maxValue,this.cursor_=ft.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Dt=at.createElementNS(un,"svg");Dt.classList.add(ap("g")),Dt.style.height=`calc(var(--bld-us) * ${ft.lineCount})`,this.element.appendChild(Dt),this.svgElem_=Dt;const tn=at.createElementNS(un,"polyline");this.svgElem_.appendChild(tn),this.lineElem_=tn;const Sn=at.createElement("div");Sn.classList.add(ap("t"),sn("tt")()),this.element.appendChild(Sn),this.tooltipElem_=Sn,ft.value.emitter.on("change",this.onValueUpdate_),this.value=ft.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const at=this.svgElem_.getBoundingClientRect(),ft=this.value.rawValue.length-1,Dt=this.minValue_,tn=this.maxValue_,Sn=[];this.value.rawValue.forEach((Ds,ms)=>{if(Ds===void 0)return;const Il=wo(ms,0,ft,0,at.width),ru=wo(Ds,Dt,tn,at.height,0);Sn.push([Il,ru].join(","))}),this.lineElem_.setAttributeNS(null,"points",Sn.join(" "));const Bn=this.tooltipElem_,pr=this.value.rawValue[this.cursor_.index];if(pr===void 0)return void Bn.classList.remove(ap("t","a"));const Or=wo(this.cursor_.index,0,ft,0,at.width),As=wo(pr,Dt,tn,at.height,0);Bn.style.left=`${Or}px`,Bn.style.top=`${As}px`,Bn.textContent=`${this.formatter_(pr)}`,Bn.classList.contains(ap("t","a"))||(Bn.classList.add(ap("t","a"),ap("t","in")),er(Bn),Bn.classList.remove(ap("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class nm{constructor(at,ft){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=ft.value,this.viewProps=ft.viewProps,this.cursor_=new Qm,this.view=new xm(at,{cursor:this.cursor_,formatter:ft.formatter,lineCount:ft.lineCount,maxValue:ft.maxValue,minValue:ft.minValue,value:this.value,viewProps:this.viewProps}),$n(at)){const Dt=new Du(this.view.element);Dt.emitter.on("down",this.onGraphPointerDown_),Dt.emitter.on("move",this.onGraphPointerMove_),Dt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(at){const ft=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(wo(at.offsetX,0,ft.width,0,this.value.rawValue.length))}onGraphPointerDown_(at){this.onGraphPointerMove_(at)}onGraphPointerMove_(at){at.data.point?this.cursor_.index=Math.floor(wo(at.data.point.x,0,at.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function rm(bt){return"format"in bt&&!St(bt.format)?bt.format:Ml(2)}function OA(bt){return"view"in bt&&bt.view==="graph"}const B0={id:"monitor-number",type:"monitor",accept:(bt,at)=>{if(typeof bt!="number")return null;const ft=ur,Dt=Zn(at,{format:ft.optional.function,lineCount:ft.optional.number,max:ft.optional.number,min:ft.optional.number,view:ft.optional.string});return Dt?{initialValue:bt,params:Dt}:null},binding:{defaultBufferSize:bt=>OA(bt)?64:1,reader:bt=>Wp},controller:bt=>OA(bt.params)?function(at){var ft,Dt,tn;return new nm(at.document,{formatter:rm(at.params),lineCount:(ft=at.params.lineCount)!==null&&ft!==void 0?ft:Jv.defaultLineCount,maxValue:(Dt="max"in at.params?at.params.max:null)!==null&&Dt!==void 0?Dt:100,minValue:(tn="min"in at.params?at.params.min:null)!==null&&tn!==void 0?tn:0,value:at.value,viewProps:at.viewProps})}(bt):function(at){var ft;return at.value.rawValue.length===1?new Zs(at.document,{formatter:rm(at.params),value:at.value,viewProps:at.viewProps}):new Zv(at.document,{formatter:rm(at.params),lineCount:(ft=at.params.lineCount)!==null&&ft!==void 0?ft:Jv.defaultLineCount,value:at.value,viewProps:at.viewProps})}(bt)},LA={id:"monitor-string",type:"monitor",accept:(bt,at)=>{if(typeof bt!="string")return null;const ft=ur,Dt=Zn(at,{lineCount:ft.optional.number,multiline:ft.optional.boolean});return Dt?{initialValue:bt,params:Dt}:null},binding:{reader:bt=>y1},controller:bt=>{var at;const ft=bt.value;return ft.rawValue.length>1||"multiline"in bt.params&&bt.params.multiline?new Zv(bt.document,{formatter:C_,lineCount:(at=bt.params.lineCount)!==null&&at!==void 0?at:Jv.defaultLineCount,value:ft,viewProps:bt.viewProps}):new Zs(bt.document,{formatter:C_,value:ft,viewProps:bt.viewProps})}};class e_{constructor(at){this.onValueChange_=this.onValueChange_.bind(this),this.reader=at.reader,this.writer=at.writer,this.emitter=new Jt,this.value=at.value,this.value.emitter.on("change",this.onValueChange_),this.target=at.target,this.read()}read(){const at=this.target.read();at!==void 0&&(this.value.rawValue=this.reader(at))}write_(at){this.writer(this.target,at)}onValueChange_(at){this.write_(at.rawValue),this.emitter.emit("change",{options:at.options,rawValue:at.rawValue,sender:this})}}class Ou{constructor(at){this.onTick_=this.onTick_.bind(this),this.reader_=at.reader,this.target=at.target,this.emitter=new Jt,this.value=at.value,this.ticker=at.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const at=this.target.read();if(at===void 0)return;const ft=this.value.rawValue,Dt=this.reader_(at);this.value.rawValue=function(tn,Sn){const Bn=[...Pw(tn),Sn];return Bn.length>tn.length?Bn.splice(0,Bn.length-tn.length):vm(Bn,tn.length),Bn}(ft,Dt),this.emitter.emit("update",{rawValue:Dt,sender:this})}onTick_(at){this.read()}}function E1(bt,at){return at===0?new Wl:new _p(bt,at??Jv.defaultInterval)}class Lu{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(at){at.type==="blade"?this.pluginsMap_.blades.unshift(at):at.type==="input"?this.pluginsMap_.inputs.unshift(at):at.type==="monitor"&&this.pluginsMap_.monitors.unshift(at)}createInput(at,ft,Dt){if(St(ft.read()))throw new Yt({context:{key:ft.key},type:"nomatchingcontroller"});const tn=this.pluginsMap_.inputs.reduce((Sn,Bn)=>Sn||function(pr,Or){const As=pr.accept(Or.target.read(),Or.params);if(St(As))return null;const Ds=ur,ms={target:Or.target,initialValue:As.initialValue,params:As.params},Il=pr.binding.reader(ms),ru=pr.binding.constraint?pr.binding.constraint(ms):void 0,om=hn(Il(As.initialValue),{constraint:ru,equals:pr.binding.equals}),Ju=new e_({reader:Il,target:Or.target,value:om,writer:pr.binding.writer(ms)}),Op=Ds.optional.boolean(Or.params.disabled).value,bm=Ds.optional.boolean(Or.params.hidden).value,V_=pr.controller({constraint:ru,document:Or.document,initialValue:As.initialValue,params:As.params,value:Ju.value,viewProps:Xr.create({disabled:Op,hidden:bm})}),t_=Ds.optional.string(Or.params.label).value;return new Mo(Or.document,{binding:Ju,blade:go(),props:zn.fromObject({label:t_||Or.target.key}),valueController:V_})}(Bn,{document:at,target:ft,params:Dt}),null);if(tn)return tn;throw new Yt({context:{key:ft.key},type:"nomatchingcontroller"})}createMonitor(at,ft,Dt){const tn=this.pluginsMap_.monitors.reduce((Sn,Bn)=>Sn||function(pr,Or){var As,Ds,ms;const Il=ur,ru=pr.accept(Or.target.read(),Or.params);if(St(ru))return null;const om={target:Or.target,initialValue:ru.initialValue,params:ru.params},Ju=pr.binding.reader(om),Op=(Ds=(As=Il.optional.number(Or.params.bufferSize).value)!==null&&As!==void 0?As:pr.binding.defaultBufferSize&&pr.binding.defaultBufferSize(ru.params))!==null&&Ds!==void 0?Ds:1,bm=Il.optional.number(Or.params.interval).value,V_=new Ou({reader:Ju,target:Or.target,ticker:E1(Or.document,bm),value:po(Op)}),t_=Il.optional.boolean(Or.params.disabled).value,N0=Il.optional.boolean(Or.params.hidden).value,By=pr.controller({document:Or.document,params:ru.params,value:V_.value,viewProps:Xr.create({disabled:t_,hidden:N0})}),Oy=(ms=Il.optional.string(Or.params.label).value)!==null&&ms!==void 0?ms:Or.target.key;return new Io(Or.document,{binding:V_,blade:go(),props:zn.fromObject({label:Oy}),valueController:By})}(Bn,{document:at,params:Dt,target:ft}),null);if(tn)return tn;throw new Yt({context:{key:ft.key},type:"nomatchingcontroller"})}createBlade(at,ft){const Dt=this.pluginsMap_.blades.reduce((tn,Sn)=>tn||function(Bn,pr){const Or=Bn.accept(pr.params);if(!Or)return null;const As=ur.optional.boolean(pr.params.disabled).value,Ds=ur.optional.boolean(pr.params.hidden).value;return Bn.controller({blade:go(),document:pr.document,params:Object.assign(Object.assign({},Or.params),{disabled:As,hidden:Ds}),viewProps:Xr.create({disabled:As,hidden:Ds})})}(Sn,{document:at,params:ft}),null);if(!Dt)throw new Yt({type:"nomatchingview",context:{params:ft}});return Dt}createBladeApi(at){if(at instanceof Mo)return new Oo(at);if(at instanceof Io)return new To(at);if(at instanceof Mu)return new Al(at,this);const ft=this.pluginsMap_.blades.reduce((Dt,tn)=>Dt||tn.api({controller:at,pool:this}),null);if(!ft)throw Yt.shouldNeverHappen();return ft}}class Gm extends d{constructor(at){super(at),this.emitter_=new Jt,this.controller_.valueController.value.emitter.on("change",ft=>{this.emitter_.emit("change",{event:new ct(this,ft.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(at){this.controller_.props.set("label",at)}get options(){return this.controller_.valueController.props.get("options")}set options(at){this.controller_.valueController.props.set("options",at)}get value(){return this.controller_.valueController.value.rawValue}set value(at){this.controller_.valueController.value.rawValue=at}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}}class Zl extends d{constructor(at){super(at),this.emitter_=new Jt,this.controller_.valueController.value.emitter.on("change",ft=>{this.emitter_.emit("change",{event:new ct(this,ft.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(at){this.controller_.props.set("label",at)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(at){this.controller_.valueController.sliderController.props.set("maxValue",at)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(at){this.controller_.valueController.sliderController.props.set("minValue",at)}get value(){return this.controller_.valueController.value.rawValue}set value(at){this.controller_.valueController.value.rawValue=at}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}}class im extends d{constructor(at){super(at),this.emitter_=new Jt,this.controller_.valueController.value.emitter.on("change",ft=>{this.emitter_.emit("change",{event:new ct(this,ft.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(at){this.controller_.props.set("label",at)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(at){this.controller_.valueController.props.set("formatter",at)}get value(){return this.controller_.valueController.value.rawValue}set value(at){this.controller_.valueController.value.rawValue=at}on(at,ft){const Dt=ft.bind(this);return this.emitter_.on(at,tn=>{Dt(tn.event)}),this}}const ga={id:"list",type:"blade",accept(bt){const at=ur,ft=Zn(bt,{options:at.required.custom(E0),value:at.required.raw,view:at.required.constant("list"),label:at.optional.string});return ft?{params:ft}:null},controller(bt){const at=new xl(bt.document,{props:zn.fromObject({options:P_(bt.params.options)}),value:hn(bt.params.value),viewProps:bt.viewProps});return new Cl(bt.document,{blade:bt.blade,props:zn.fromObject({label:bt.params.label}),valueController:at})},api:bt=>bt.controller instanceof Cl&&bt.controller.valueController instanceof xl?new Gm(bt.controller):null};class O0 extends qo{constructor(at,ft){super(at,ft)}get element(){return this.controller_.view.element}importPreset(at){(function(ft,Dt){ft.forEach(tn=>{const Sn=Dt[tn.presetKey];Sn!==void 0&&tn.write(Sn)})})(this.controller_.rackController.rack.find(Mo).map(ft=>ft.binding.target),at),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Mo).map(at=>at.binding.target).reduce((at,ft)=>Object.assign(at,{[ft.presetKey]:ft.read()}),{})}refresh(){this.controller_.rackController.rack.find(Mo).forEach(at=>{at.binding.read()}),this.controller_.rackController.rack.find(Io).forEach(at=>{at.binding.read()})}}class sm extends So{constructor(at,ft){super(at,{expanded:ft.expanded,blade:ft.blade,props:ft.props,root:!0,viewProps:ft.viewProps})}}const L0={id:"slider",type:"blade",accept(bt){const at=ur,ft=Zn(bt,{max:at.required.number,min:at.required.number,view:at.required.constant("slider"),format:at.optional.function,label:at.optional.string,value:at.optional.number});return ft?{params:ft}:null},controller(bt){var at,ft;const Dt=(at=bt.params.value)!==null&&at!==void 0?at:0,tn=new Yp(bt.document,{baseStep:1,parser:gu,sliderProps:zn.fromObject({maxValue:bt.params.max,minValue:bt.params.min}),textProps:zn.fromObject({draggingScale:D_(void 0,Dt),formatter:(ft=bt.params.format)!==null&&ft!==void 0?ft:S_}),value:hn(Dt),viewProps:bt.viewProps});return new Cl(bt.document,{blade:bt.blade,props:zn.fromObject({label:bt.params.label}),valueController:tn})},api:bt=>bt.controller instanceof Cl&&bt.controller.valueController instanceof Yp?new Zl(bt.controller):null},lp={id:"text",type:"blade",accept(bt){const at=ur,ft=Zn(bt,{parse:at.required.function,value:at.required.raw,view:at.required.constant("text"),format:at.optional.function,label:at.optional.string});return ft?{params:ft}:null},controller(bt){var at;const ft=new No(bt.document,{parser:bt.params.parse,props:zn.fromObject({formatter:(at=bt.params.format)!==null&&at!==void 0?at:Dt=>String(Dt)}),value:hn(bt.params.value),viewProps:bt.viewProps});return new Cl(bt.document,{blade:bt.blade,props:zn.fromObject({label:bt.params.label}),valueController:ft})},api:bt=>bt.controller instanceof Cl&&bt.controller.valueController instanceof No?new im(bt.controller):null};function Vl(bt,at,ft){if(bt.querySelector(`style[data-tp-style=${at}]`))return;const Dt=bt.createElement("style");Dt.dataset.tpStyle=at,Dt.textContent=ft,bt.head.appendChild(Dt)}const Uw=new class{constructor(bt){const[at,ft]=bt.split("-"),Dt=at.split(".");this.major=parseInt(Dt[0],10),this.minor=parseInt(Dt[1],10),this.patch=parseInt(Dt[2],10),this.prerelease=ft??null}toString(){const bt=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[bt,this.prerelease].join("-"):bt}}("3.0.8");_e.BladeApi=d,_e.ButtonApi=qt,_e.FolderApi=qo,_e.InputBindingApi=Oo,_e.ListApi=Gm,_e.MonitorBindingApi=To,_e.Pane=class extends O0{constructor(bt){var at;const ft=bt||{},Dt=(at=ft.document)!==null&&at!==void 0?at:xr(),tn=function(){const Sn=new Lu;return[vv,op,Vm,kA,xo,Xv,Am,gv,w1,tm,LA,B0,Us,$l,ba,ro].forEach(Bn=>{Sn.register(Bn)}),Sn}();super(new sm(Dt,{expanded:ft.expanded,blade:go(),props:zn.fromObject({title:ft.title}),viewProps:Xr.create()}),tn),this.pool_=tn,this.containerElem_=ft.container||function(Sn){const Bn=Sn.createElement("div");return Bn.classList.add(sn("dfw")()),Sn.body&&Sn.body.appendChild(Bn),Bn}(Dt),this.containerElem_.appendChild(this.element),this.doc_=Dt,this.usesDefaultWrapper_=!ft.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Yt.alreadyDisposed();return this.doc_}dispose(){const bt=this.containerElem_;if(!bt)throw Yt.alreadyDisposed();if(this.usesDefaultWrapper_){const at=bt.parentElement;at&&at.removeChild(bt)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(bt){("plugin"in bt?[bt.plugin]:"plugins"in bt?bt.plugins:[]).forEach(at=>{this.pool_.register(at),this.embedPluginStyle_(at)})}embedPluginStyle_(bt){bt.css&&Vl(this.document,`plugin-${bt.id}`,bt.css)}setUpDefaultPlugins_(){Vl(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(bt=>{this.embedPluginStyle_(bt)}),this.registerPlugin({plugins:[L0,ga,ro,lp]})}},_e.SeparatorApi=rp,_e.SliderApi=Zl,_e.TabApi=Js,_e.TabPageApi=Qo,_e.TextApi=im,_e.TpChangeEvent=ct,_e.VERSION=Uw,Object.defineProperty(_e,"__esModule",{value:!0})})(_)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(j){super(j),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(j,_){const _e=await super.loadAsync(j,_);return _e?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(_e,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(j=!0,_=!1){return j&&super.preload(),_&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async j=>j.text()).then(j=>{const _=j.indexOf("/* worker */");if(_<1)throw new Error("unable to load decoder module");return j.substring(0,_-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(j,_,_e){_e.d(_,{$TI:function(){return BE},$V:function(){return wP},$Vf:function(){return oI},$YQ:function(){return rC},A5E:function(){return dw},AHu:function(){return Vx},AXT:function(){return cx},Aip:function(){return hI},B02:function(){return Ot},BFQ:function(){return Zo},BG$:function(){return zv},BKK:function(){return mw},BVF:function(){return xr},BVQ:function(){return hx},BbS:function(){return l0},Bf4:function(){return Io},BtG:function(){return UA},CJI:function(){return Ou},CN8:function(){return rI},CP7:function(){return su},CaW:function(){return rs},CdI:function(){return ks},Cne:function(){return WC},CtA:function(){return _p},CtF:function(){return t0},D1R:function(){return hs},D9w:function(){return ro},DT1:function(){return Qx},Djp:function(){return Sy},DqL:function(){return Fp},DvJ:function(){return Hm},E2K:function(){return Ho},EB7:function(){return lx},EJi:function(){return EC},EoG:function(){return go},F5T:function(){return Lu},FDw:function(){return So},FE5:function(){return _d},FIo:function(){return FT},FM8:function(){return Lr},FT0:function(){return CC},FUD:function(){return Qv},FvO:function(){return ep},GG6:function(){return x_},GQ:function(){return $m},GUF:function(){return wo},GVz:function(){return b1},GZb:function(){return aI},Gih:function(){return Vv},Gql:function(){return BC},H$k:function(){return Xy},HTd:function(){return Pp},HW6:function(){return uI},HgB:function(){return S0},HkE:function(){return nC},Hmr:function(){return Rx},Hw6:function(){return O_},Hy8:function(){return Kn},Hyl:function(){return Cv},IEO:function(){return YA},IFH:function(){return Ml},IKL:function(){return UT},ILR:function(){return pu},IOt:function(){return Iu},Ilk:function(){return as},Inb:function(){return M_},Ir4:function(){return D_},JOQ:function(){return Q_},JQ4:function(){return Qn},JUT:function(){return L_},JWc:function(){return wA},KI_:function(){return Du},Kgo:function(){return dx},KhW:function(){return ar},Kj0:function(){return Nu},Kz5:function(){return vp},L5g:function(){return iy},L5s:function(){return mm},LBq:function(){return $T},LSk:function(){return dv},LY2:function(){return to},L_r:function(){return bA},Lcc:function(){return Zm},LgE:function(){return Pw},LgZ:function(){return wr},LsT:function(){return Hu},Ltg:function(){return Uo},Lun:function(){return GA},M5h:function(){return nn},M6v:function(){return Br},M8C:function(){return EA},Mig:function(){return GT},MyG:function(){return Rw},N$j:function(){return oC},N4l:function(){return an},NDo:function(){return Us},NMF:function(){return x0},NYV:function(){return w_},Ns1:function(){return ds},NwF:function(){return Km},Ny0:function(){return aE},O7d:function(){return _x},OAl:function(){return Wv},OM3:function(){return Dt},OTo:function(){return Is},OdW:function(){return nx},OoA:function(){return Al},Ox3:function(){return QT},PA7:function(){return Pu},PMe:function(){return RC},Pa4:function(){return xn},PeU:function(){return pt},Pnf:function(){return gu},PpQ:function(){return Py},QM0:function(){return hv},QRU:function(){return OC},QZ1:function(){return AA},QmN:function(){return ct},Qpg:function(){return tI},R2R:function(){return Z_},REq:function(){return fw},RNb:function(){return O0},ROQ:function(){return fC},RSm:function(){return xx},Rki:function(){return nI},RlZ:function(){return $n},RsA:function(){return it},RvT:function(){return E0},S2y:function(){return St},S3k:function(){return iw},S9g:function(){return op},SJI:function(){return XT},SPe:function(){return eE},SUY:function(){return TE},Se2:function(){return Wn},Sm8:function(){return hn},So8:function(){return LC},SvJ:function(){return Fo},Syv:function(){return E_},T95:function(){return Cl},TOt:function(){return pE},TUj:function(){return xP},TUv:function(){return sC},T_1:function(){return jE},T_J:function(){return Fl},T__:function(){return DT},T_f:function(){return HT},TlE:function(){return ga},Tme:function(){return Zs},Tn7:function(){return vE},TyD:function(){return qo},U7:function(){return vC},UCm:function(){return Ps},USm:function(){return wm},UY4:function(){return rE},UZH:function(){return d},Uk6:function(){return NT},UlW:function(){return y1},Uol:function(){return $_},V1s:function(){return FA},V4E:function(){return cI},VLJ:function(){return VC},VYz:function(){return KT},Vdb:function(){return un},Vj0:function(){return am},Vkp:function(){return Ru},VzW:function(){return ba},W2J:function(){return P_},WMw:function(){return Ht},WTc:function(){return sm},WXh:function(){return Ax},Wbm:function(){return Wt},WdD:function(){return io},Wid:function(){return bC},Wjw:function(){return zE},Wl3:function(){return Jt},Wpd:function(){return er},Wqd:function(){return yC},WwZ:function(){return Gv},Wzm:function(){return ax},XZw:function(){return gw},Xaj:function(){return dn},Xcj:function(){return NC},XvJ:function(){return $0},Y8D:function(){return Qo},YBo:function(){return SC},YGz:function(){return or},YKA:function(){return vA},YLQ:function(){return Lo},YN5:function(){return sI},YT8:function(){return RT},Ywn:function(){return MA},Z6B:function(){return DS},ZAu:function(){return W_},ZQ6:function(){return K_},ZRs:function(){return qp},ZZA:function(){return Ex},Zp0:function(){return c_},Zr5:function(){return on},ZzF:function(){return N_},Zzh:function(){return ZT},_12:function(){return z0},_3:function(){return HC},_AM:function(){return Ao},_C8:function(){return Ky},_Li:function(){return jt},_MY:function(){return Qt},_YM:function(){return J_},_YX:function(){return Fx},_am:function(){return RS},_fP:function(){return ku},_iA:function(){return Yt},_kC:function(){return a_},_lf:function(){return Wp},_sL:function(){return S_},a$l:function(){return ft},aCh:function(){return T_},aH4:function(){return Yo},aLr:function(){return _f},aNw:function(){return Uu},aVm:function(){return lp},ad5:function(){return Au},anP:function(){return D1},aq0:function(){return jx},av9:function(){return Wl},b5g:function(){return iC},bGH:function(){return zt},b_z:function(){return Ol},bdR:function(){return Ut},blk:function(){return XA},bnF:function(){return Wy},brP:function(){return Go},bsb:function(){return uv},c8b:function(){return zn},cBI:function(){return u0},cBK:function(){return IC},cJO:function(){return tw},cLu:function(){return Wu},cPb:function(){return Zu},cRx:function(){return Js},cU9:function(){return TC},ce8:function(){return yA},cek:function(){return VT},cum:function(){return Um},dSO:function(){return To},dUE:function(){return e0},dYG:function(){return _E},dZ3:function(){return co},dd2:function(){return wp},dj0:function(){return Ul},dpR:function(){return PC},dwk:function(){return qt},e62:function(){return at},eD:function(){return On},eMJ:function(){return Dw},eaV:function(){return xl},ehD:function(){return sn},ejS:function(){return o_},ekQ:function(){return Jl},epp:function(){return Ku},fHI:function(){return Fu},fO1:function(){return pC},fQA:function(){return FE},fQK:function(){return W1},fSK:function(){return Vn},fY$:function(){return Oo},fto:function(){return Fm},g8_:function(){return Hl},gH0:function(){return Nx},gSk:function(){return _A},g_z:function(){return ux},ghN:function(){return lr},gi4:function(){return cv},gti:function(){return _C},hEm:function(){return qu},hH6:function(){return r0},iAb:function(){return rp},iDF:function(){return Iv},iKG:function(){return M1},iLg:function(){return fm},iMs:function(){return OE},iUV:function(){return Po},iWC:function(){return ur},iWj:function(){return Qw},i_9:function(){return CE},iiP:function(){return Xo},irR:function(){return Xr},j4z:function(){return A1},j87:function(){return Uw},jAl:function(){return Ap},jFi:function(){return Ft},jZA:function(){return No},jfJ:function(){return Hv},jwo:function(){return kw},jyi:function(){return J1},jyz:function(){return yv},k0A:function(){return Gs},k74:function(){return Zn},kB5:function(){return r_},kFz:function(){return $p},kaV:function(){return bx},knz:function(){return po},kqm:function(){return ty},ksN:function(){return Tr},l0P:function(){return ls},l8J:function(){return xA},lCJ:function(){return bt},lDi:function(){return Dx},lLk:function(){return n0},lRF:function(){return Zw},lRj:function(){return Dp},lb7:function(){return Gy},lfu:function(){return MC},lk7:function(){return bE},m7l:function(){return Cx},mSO:function(){return b0},mTL:function(){return yP},mXe:function(){return dE},m_w:function(){return tA},mzJ:function(){return Zy},nls:function(){return Lp},ntZ:function(){return Vt},nvb:function(){return iI},o8S:function(){return Yy},oAp:function(){return LM},oa8:function(){return yx},oqc:function(){return I_},p3g:function(){return I0},p7A:function(){return GC},p7y:function(){return Yl},pBf:function(){return js},pIN:function(){return Tu},pKu:function(){return gA},pQR:function(){return up},ptH:function(){return yp},qhX:function(){return is},qkB:function(){return Do},qlB:function(){return Vl},qyh:function(){return Mu},rAo:function(){return L0},rBU:function(){return es},rDY:function(){return OM},rOj:function(){return Zt},r_:function(){return mn},rnI:function(){return vm},rpg:function(){return vo},s4_:function(){return WT},sYA:function(){return Mx},tEQ:function(){return $y},tGC:function(){return h_},tJx:function(){return UE},tUh:function(){return Pv},tf:function(){return Bx},tm_:function(){return At},trn:function(){return pw},u37:function(){return Jy},u7G:function(){return s0},u9r:function(){return ms},uEv:function(){return b_},uL9:function(){return Os},uWy:function(){return no},uXU:function(){return Yu},ujx:function(){return lI},v3W:function(){return _o},v9Y:function(){return w1},vBJ:function(){return Gm},vCF:function(){return pn},vCx:function(){return na},vZf:function(){return du},vmT:function(){return zT},vpT:function(){return Y1},vxC:function(){return Mo},w$m:function(){return kr},wJv:function(){return br},wem:function(){return Vo},wk1:function(){return bs},woe:function(){return oE},wuA:function(){return yo},x12:function(){return s_},x5V:function(){return Wo},xEZ:function(){return vu},xG9:function(){return eI},xJs:function(){return ho},xWb:function(){return ny},xeV:function(){return X1},xfE:function(){return Bl},xo$:function(){return nw},xoR:function(){return wx},xsS:function(){return wT},y$t:function(){return JA},y2t:function(){return uo},y8_:function(){return hw},yC1:function(){return rw},yGw:function(){return zs},ybr:function(){return HA},yj7:function(){return gC},ylh:function(){return lw},yo9:function(){return G0},yt0:function(){return Yp},ywz:function(){return $l},yxD:function(){return i0},z$h:function(){return C_},z81:function(){return ip},z8B:function(){return qA},zHn:function(){return $v},zbs:function(){return Sx},zf8:function(){return Sm},zob:function(){return d0}});const d="144dev",it={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ct={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},pt=0,At=1,St=2,Ot=3,Qt=0,Yt=1,Vt=2,qt=3,Jt=0,jt=1,sn=2,Ft=0,Ut=1,Ht=2,an=3,nn=4,dn=5,zt=100,Wt=101,Zt=102,mn=103,hn=104,zn=200,lr=201,ar=202,ur=203,Zn=204,wr=205,Vn=206,Kn=207,un=208,er=209,$n=210,xr=0,Wn=1,on=2,pn=3,On=4,Tr=5,kr=6,Br=7,ds=0,is=1,Us=2,Os=0,go=1,ks=2,or=3,to=4,co=5,Bl=300,Oo=301,Mo=302,To=303,Io=304,Hl=306,vo=1e3,no=1001,Al=1002,qo=1003,Lo=1004,Pp=1004,Yo=1005,du=1005,Vo=1006,Mu=1007,Dp=1007,hs=1008,So=1008,$l=1009,Cl=1010,rp=1011,Hu=1012,vp=1013,Qn=1014,ba=1015,Wu=1016,Gs=1017,Xr=1018,br=1020,Is=1021,Ps=1022,bs=1023,Qo=1024,Js=1025,Do=1026,Go=1027,qu=1028,ro=1029,Wl=1030,_p=1031,Ho=1033,yo=33776,Zo=33777,_o=33778,pu=33779,Ao=35840,na=35841,xl=35842,rs=35843,Fm=36196,ls=37492,Jl=37496,yp=37808,No=37809,uo=37810,cv=37811,Sy=37812,zv=37813,w_=37814,ho=37815,gA=37816,x_=37817,Vv=37818,Qv=37819,Xo=37820,Fo=37821,uv=36492,Ap=2200,vA=2201,b_=2202,E_=2300,x0=2301,Tu=2302,gu=2400,Wp=2401,S_=2402,Ml=2500,_A=2501,Gv=0,y1=1,C_=2,vm=3e3,po=3001,Pw=3004,M_=3005,ip=3200,b0=3201,Iu=0,Pu=1,T_="",Du="srgb",wo="srgb-linear",Au=0,Wo=7680,yA=7681,qp=7682,Hv=7683,I_=34055,Fl=34056,Dw=5386,Rw=512,Yu=513,kw=514,Yp=515,Wv=516,E0=517,A1=518,Um=519,P_=35044,Ul=35048,AA=35040,wA=35045,hv=35049,D_=35041,S0=35046,xA=35050,DS=35042,w1="100",dv="300 es",bA=1035;class js{addEventListener(o,b){this._listeners===void 0&&(this._listeners={});const et=this._listeners;et[o]===void 0&&(et[o]=[]),et[o].indexOf(b)===-1&&et[o].push(b)}hasEventListener(o,b){if(this._listeners===void 0)return!1;const et=this._listeners;return et[o]!==void 0&&et[o].indexOf(b)!==-1}removeEventListener(o,b){if(this._listeners===void 0)return;const et=this._listeners[o];if(et!==void 0){const tt=et.indexOf(b);tt!==-1&&et.splice(tt,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const b=this._listeners[o.type];if(b!==void 0){o.target=this;const et=b.slice(0);for(let tt=0,ot=et.length;tt<ot;tt++)et[tt].call(this,o);o.target=null}}}const nu=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Bw=1234567;const R_=Math.PI/180,Cy=180/Math.PI;function Xu(){const dt=4294967295*Math.random()|0,o=4294967295*Math.random()|0,b=4294967295*Math.random()|0,et=4294967295*Math.random()|0;return(nu[255&dt]+nu[dt>>8&255]+nu[dt>>16&255]+nu[dt>>24&255]+"-"+nu[255&o]+nu[o>>8&255]+"-"+nu[o>>16&15|64]+nu[o>>24&255]+"-"+nu[63&b|128]+nu[b>>8&255]+"-"+nu[b>>16&255]+nu[b>>24&255]+nu[255&et]+nu[et>>8&255]+nu[et>>16&255]+nu[et>>24&255]).toLowerCase()}function Ts(dt,o,b){return Math.max(o,Math.min(b,dt))}function jm(dt,o){return(dt%o+o)%o}function My(dt,o,b){return(1-b)*dt+b*o}function Ty(dt){return(dt&dt-1)==0&&dt!==0}function qv(dt){return Math.pow(2,Math.ceil(Math.log(dt)/Math.LN2))}function sp(dt){return Math.pow(2,Math.floor(Math.log(dt)/Math.LN2))}function pv(dt,o){switch(o.constructor){case Float32Array:return dt;case Uint16Array:return dt/65535;case Uint8Array:return dt/255;case Int16Array:return Math.max(dt/32767,-1);case Int8Array:return Math.max(dt/127,-1);default:throw new Error("Invalid component type.")}}function $a(dt,o){switch(o.constructor){case Float32Array:return dt;case Uint16Array:return Math.round(65535*dt);case Uint8Array:return Math.round(255*dt);case Int16Array:return Math.round(32767*dt);case Int8Array:return Math.round(127*dt);default:throw new Error("Invalid component type.")}}var EA=Object.freeze({__proto__:null,DEG2RAD:R_,RAD2DEG:Cy,generateUUID:Xu,clamp:Ts,euclideanModulo:jm,mapLinear:function(dt,o,b,et,tt){return et+(dt-o)*(tt-et)/(b-o)},inverseLerp:function(dt,o,b){return dt!==o?(b-dt)/(o-dt):0},lerp:My,damp:function(dt,o,b,et){return My(dt,o,1-Math.exp(-b*et))},pingpong:function(dt,o=1){return o-Math.abs(jm(dt,2*o)-o)},smoothstep:function(dt,o,b){return dt<=o?0:dt>=b?1:(dt=(dt-o)/(b-o))*dt*(3-2*dt)},smootherstep:function(dt,o,b){return dt<=o?0:dt>=b?1:(dt=(dt-o)/(b-o))*dt*dt*(dt*(6*dt-15)+10)},randInt:function(dt,o){return dt+Math.floor(Math.random()*(o-dt+1))},randFloat:function(dt,o){return dt+Math.random()*(o-dt)},randFloatSpread:function(dt){return dt*(.5-Math.random())},seededRandom:function(dt){dt!==void 0&&(Bw=dt);let o=Bw+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296},degToRad:function(dt){return dt*R_},radToDeg:function(dt){return dt*Cy},isPowerOfTwo:Ty,ceilPowerOfTwo:qv,floorPowerOfTwo:sp,setQuaternionFromProperEuler:function(dt,o,b,et,tt){const ot=Math.cos,lt=Math.sin,ht=ot(b/2),vt=lt(b/2),_t=ot((o+et)/2),Mt=lt((o+et)/2),Pt=ot((o-et)/2),Tt=lt((o-et)/2),Rt=ot((et-o)/2),Nt=lt((et-o)/2);switch(tt){case"XYX":dt.set(ht*Mt,vt*Pt,vt*Tt,ht*_t);break;case"YZY":dt.set(vt*Tt,ht*Mt,vt*Pt,ht*_t);break;case"ZXZ":dt.set(vt*Pt,vt*Tt,ht*Mt,ht*_t);break;case"XZX":dt.set(ht*Mt,vt*Nt,vt*Rt,ht*_t);break;case"YXY":dt.set(vt*Rt,ht*Mt,vt*Nt,ht*_t);break;case"ZYZ":dt.set(vt*Nt,vt*Rt,ht*Mt,ht*_t);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+tt)}},normalize:$a,denormalize:pv});class Lr{constructor(o=0,b=0){Lr.prototype.isVector2=!0,this.x=o,this.y=b}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,b){return this.x=o,this.y=b,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,b){switch(o){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,b){return this.x=o.x+b.x,this.y=o.y+b.y,this}addScaledVector(o,b){return this.x+=o.x*b,this.y+=o.y*b,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,b){return this.x=o.x-b.x,this.y=o.y-b.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const b=this.x,et=this.y,tt=o.elements;return this.x=tt[0]*b+tt[3]*et+tt[6],this.y=tt[1]*b+tt[4]*et+tt[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,b){return this.x=Math.max(o.x,Math.min(b.x,this.x)),this.y=Math.max(o.y,Math.min(b.y,this.y)),this}clampScalar(o,b){return this.x=Math.max(o,Math.min(b,this.x)),this.y=Math.max(o,Math.min(b,this.y)),this}clampLength(o,b){const et=this.length();return this.divideScalar(et||1).multiplyScalar(Math.max(o,Math.min(b,et)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const b=this.x-o.x,et=this.y-o.y;return b*b+et*et}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,b){return this.x+=(o.x-this.x)*b,this.y+=(o.y-this.y)*b,this}lerpVectors(o,b,et){return this.x=o.x+(b.x-o.x)*et,this.y=o.y+(b.y-o.y)*et,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,b=0){return this.x=o[b],this.y=o[b+1],this}toArray(o=[],b=0){return o[b]=this.x,o[b+1]=this.y,o}fromBufferAttribute(o,b){return this.x=o.getX(b),this.y=o.getY(b),this}rotateAround(o,b){const et=Math.cos(b),tt=Math.sin(b),ot=this.x-o.x,lt=this.y-o.y;return this.x=ot*et-lt*tt+o.x,this.y=ot*tt+lt*et+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ru{constructor(){Ru.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,b,et,tt,ot,lt,ht,vt,_t){const Mt=this.elements;return Mt[0]=o,Mt[1]=tt,Mt[2]=ht,Mt[3]=b,Mt[4]=ot,Mt[5]=vt,Mt[6]=et,Mt[7]=lt,Mt[8]=_t,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const b=this.elements,et=o.elements;return b[0]=et[0],b[1]=et[1],b[2]=et[2],b[3]=et[3],b[4]=et[4],b[5]=et[5],b[6]=et[6],b[7]=et[7],b[8]=et[8],this}extractBasis(o,b,et){return o.setFromMatrix3Column(this,0),b.setFromMatrix3Column(this,1),et.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const b=o.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,b){const et=o.elements,tt=b.elements,ot=this.elements,lt=et[0],ht=et[3],vt=et[6],_t=et[1],Mt=et[4],Pt=et[7],Tt=et[2],Rt=et[5],Nt=et[8],kt=tt[0],Kt=tt[3],$t=tt[6],en=tt[1],ln=tt[4],gn=tt[7],_n=tt[2],An=tt[5],Ln=tt[8];return ot[0]=lt*kt+ht*en+vt*_n,ot[3]=lt*Kt+ht*ln+vt*An,ot[6]=lt*$t+ht*gn+vt*Ln,ot[1]=_t*kt+Mt*en+Pt*_n,ot[4]=_t*Kt+Mt*ln+Pt*An,ot[7]=_t*$t+Mt*gn+Pt*Ln,ot[2]=Tt*kt+Rt*en+Nt*_n,ot[5]=Tt*Kt+Rt*ln+Nt*An,ot[8]=Tt*$t+Rt*gn+Nt*Ln,this}multiplyScalar(o){const b=this.elements;return b[0]*=o,b[3]*=o,b[6]*=o,b[1]*=o,b[4]*=o,b[7]*=o,b[2]*=o,b[5]*=o,b[8]*=o,this}determinant(){const o=this.elements,b=o[0],et=o[1],tt=o[2],ot=o[3],lt=o[4],ht=o[5],vt=o[6],_t=o[7],Mt=o[8];return b*lt*Mt-b*ht*_t-et*ot*Mt+et*ht*vt+tt*ot*_t-tt*lt*vt}invert(){const o=this.elements,b=o[0],et=o[1],tt=o[2],ot=o[3],lt=o[4],ht=o[5],vt=o[6],_t=o[7],Mt=o[8],Pt=Mt*lt-ht*_t,Tt=ht*vt-Mt*ot,Rt=_t*ot-lt*vt,Nt=b*Pt+et*Tt+tt*Rt;if(Nt===0)return this.set(0,0,0,0,0,0,0,0,0);const kt=1/Nt;return o[0]=Pt*kt,o[1]=(tt*_t-Mt*et)*kt,o[2]=(ht*et-tt*lt)*kt,o[3]=Tt*kt,o[4]=(Mt*b-tt*vt)*kt,o[5]=(tt*ot-ht*b)*kt,o[6]=Rt*kt,o[7]=(et*vt-_t*b)*kt,o[8]=(lt*b-et*ot)*kt,this}transpose(){let o;const b=this.elements;return o=b[1],b[1]=b[3],b[3]=o,o=b[2],b[2]=b[6],b[6]=o,o=b[5],b[5]=b[7],b[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const b=this.elements;return o[0]=b[0],o[1]=b[3],o[2]=b[6],o[3]=b[1],o[4]=b[4],o[5]=b[7],o[6]=b[2],o[7]=b[5],o[8]=b[8],this}setUvTransform(o,b,et,tt,ot,lt,ht){const vt=Math.cos(ot),_t=Math.sin(ot);return this.set(et*vt,et*_t,-et*(vt*lt+_t*ht)+lt+o,-tt*_t,tt*vt,-tt*(-_t*lt+vt*ht)+ht+b,0,0,1),this}scale(o,b){const et=this.elements;return et[0]*=o,et[3]*=o,et[6]*=o,et[1]*=b,et[4]*=b,et[7]*=b,this}rotate(o){const b=Math.cos(o),et=Math.sin(o),tt=this.elements,ot=tt[0],lt=tt[3],ht=tt[6],vt=tt[1],_t=tt[4],Mt=tt[7];return tt[0]=b*ot+et*vt,tt[3]=b*lt+et*_t,tt[6]=b*ht+et*Mt,tt[1]=-et*ot+b*vt,tt[4]=-et*lt+b*_t,tt[7]=-et*ht+b*Mt,this}translate(o,b){const et=this.elements;return et[0]+=o*et[2],et[3]+=o*et[5],et[6]+=o*et[8],et[1]+=b*et[2],et[4]+=b*et[5],et[7]+=b*et[8],this}equals(o){const b=this.elements,et=o.elements;for(let tt=0;tt<9;tt++)if(b[tt]!==et[tt])return!1;return!0}fromArray(o,b=0){for(let et=0;et<9;et++)this.elements[et]=o[et+b];return this}toArray(o=[],b=0){const et=this.elements;return o[b]=et[0],o[b+1]=et[1],o[b+2]=et[2],o[b+3]=et[3],o[b+4]=et[4],o[b+5]=et[5],o[b+6]=et[6],o[b+7]=et[7],o[b+8]=et[8],o}clone(){return new this.constructor().fromArray(this.elements)}}function x1(dt){for(let o=dt.length-1;o>=0;--o)if(dt[o]>65535)return!0;return!1}const Ow={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function k_(dt,o){return new Ow[dt](o)}function B_(dt){return document.createElementNS("http://www.w3.org/1999/xhtml",dt)}function _m(dt){return dt<.04045?.0773993808*dt:Math.pow(.9478672986*dt+.0521327014,2.4)}function Iy(dt){return dt<.0031308?12.92*dt:1.055*Math.pow(dt,.41666)-.055}const C0={[Du]:{[wo]:_m},[wo]:{[Du]:Iy}},Ku={legacyMode:!0,get workingColorSpace(){return wo},set workingColorSpace(dt){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(dt,o,b){if(this.legacyMode||o===b||!o||!b)return dt;if(C0[o]&&C0[o][b]!==void 0){const et=C0[o][b];return dt.r=et(dt.r),dt.g=et(dt.g),dt.b=et(dt.b),dt}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(dt,o){return this.convert(dt,this.workingColorSpace,o)},toWorkingColorSpace:function(dt,o){return this.convert(dt,o,this.workingColorSpace)}},SA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},zl={r:0,g:0,b:0},Xp={h:0,s:0,l:0},M0={h:0,s:0,l:0};function Rp(dt,o,b){return b<0&&(b+=1),b>1&&(b-=1),b<1/6?dt+6*(o-dt)*b:b<.5?o:b<2/3?dt+6*(o-dt)*(2/3-b):dt}function CA(dt,o){return o.r=dt.r,o.g=dt.g,o.b=dt.b,o}class as{constructor(o,b,et){return this.isColor=!0,this.r=1,this.g=1,this.b=1,b===void 0&&et===void 0?this.set(o):this.setRGB(o,b,et)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,b=Du){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(255&o)/255,Ku.toWorkingColorSpace(this,b),this}setRGB(o,b,et,tt=wo){return this.r=o,this.g=b,this.b=et,Ku.toWorkingColorSpace(this,tt),this}setHSL(o,b,et,tt=wo){if(o=jm(o,1),b=Ts(b,0,1),et=Ts(et,0,1),b===0)this.r=this.g=this.b=et;else{const ot=et<=.5?et*(1+b):et+b-et*b,lt=2*et-ot;this.r=Rp(lt,ot,o+1/3),this.g=Rp(lt,ot,o),this.b=Rp(lt,ot,o-1/3)}return Ku.toWorkingColorSpace(this,tt),this}setStyle(o,b=Du){function et(ot){ot!==void 0&&parseFloat(ot)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let tt;if(tt=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(o)){let ot;const lt=tt[1],ht=tt[2];switch(lt){case"rgb":case"rgba":if(ot=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ht))return this.r=Math.min(255,parseInt(ot[1],10))/255,this.g=Math.min(255,parseInt(ot[2],10))/255,this.b=Math.min(255,parseInt(ot[3],10))/255,Ku.toWorkingColorSpace(this,b),et(ot[4]),this;if(ot=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ht))return this.r=Math.min(100,parseInt(ot[1],10))/100,this.g=Math.min(100,parseInt(ot[2],10))/100,this.b=Math.min(100,parseInt(ot[3],10))/100,Ku.toWorkingColorSpace(this,b),et(ot[4]),this;break;case"hsl":case"hsla":if(ot=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ht)){const vt=parseFloat(ot[1])/360,_t=parseFloat(ot[2])/100,Mt=parseFloat(ot[3])/100;return et(ot[4]),this.setHSL(vt,_t,Mt,b)}}}else if(tt=/^\#([A-Fa-f\d]+)$/.exec(o)){const ot=tt[1],lt=ot.length;if(lt===3)return this.r=parseInt(ot.charAt(0)+ot.charAt(0),16)/255,this.g=parseInt(ot.charAt(1)+ot.charAt(1),16)/255,this.b=parseInt(ot.charAt(2)+ot.charAt(2),16)/255,Ku.toWorkingColorSpace(this,b),this;if(lt===6)return this.r=parseInt(ot.charAt(0)+ot.charAt(1),16)/255,this.g=parseInt(ot.charAt(2)+ot.charAt(3),16)/255,this.b=parseInt(ot.charAt(4)+ot.charAt(5),16)/255,Ku.toWorkingColorSpace(this,b),this}return o&&o.length>0?this.setColorName(o,b):this}setColorName(o,b=Du){const et=SA[o.toLowerCase()];return et!==void 0?this.setHex(et,b):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=_m(o.r),this.g=_m(o.g),this.b=_m(o.b),this}copyLinearToSRGB(o){return this.r=Iy(o.r),this.g=Iy(o.g),this.b=Iy(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=Du){return Ku.fromWorkingColorSpace(CA(this,zl),o),Ts(255*zl.r,0,255)<<16^Ts(255*zl.g,0,255)<<8^Ts(255*zl.b,0,255)<<0}getHexString(o=Du){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,b=wo){Ku.fromWorkingColorSpace(CA(this,zl),b);const et=zl.r,tt=zl.g,ot=zl.b,lt=Math.max(et,tt,ot),ht=Math.min(et,tt,ot);let vt,_t;const Mt=(ht+lt)/2;if(ht===lt)vt=0,_t=0;else{const Pt=lt-ht;switch(_t=Mt<=.5?Pt/(lt+ht):Pt/(2-lt-ht),lt){case et:vt=(tt-ot)/Pt+(tt<ot?6:0);break;case tt:vt=(ot-et)/Pt+2;break;case ot:vt=(et-tt)/Pt+4}vt/=6}return o.h=vt,o.s=_t,o.l=Mt,o}getRGB(o,b=wo){return Ku.fromWorkingColorSpace(CA(this,zl),b),o.r=zl.r,o.g=zl.g,o.b=zl.b,o}getStyle(o=Du){return Ku.fromWorkingColorSpace(CA(this,zl),o),o!==Du?`color(${o} ${zl.r} ${zl.g} ${zl.b})`:`rgb(${255*zl.r|0},${255*zl.g|0},${255*zl.b|0})`}offsetHSL(o,b,et){return this.getHSL(Xp),Xp.h+=o,Xp.s+=b,Xp.l+=et,this.setHSL(Xp.h,Xp.s,Xp.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,b){return this.r=o.r+b.r,this.g=o.g+b.g,this.b=o.b+b.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,b){return this.r+=(o.r-this.r)*b,this.g+=(o.g-this.g)*b,this.b+=(o.b-this.b)*b,this}lerpColors(o,b,et){return this.r=o.r+(b.r-o.r)*et,this.g=o.g+(b.g-o.g)*et,this.b=o.b+(b.b-o.b)*et,this}lerpHSL(o,b){this.getHSL(Xp),o.getHSL(M0);const et=My(Xp.h,M0.h,b),tt=My(Xp.s,M0.s,b),ot=My(Xp.l,M0.l,b);return this.setHSL(et,tt,ot),this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,b=0){return this.r=o[b],this.g=o[b+1],this.b=o[b+2],this}toArray(o=[],b=0){return o[b]=this.r,o[b+1]=this.g,o[b+2]=this.b,o}fromBufferAttribute(o,b){return this.r=o.getX(b),this.g=o.getY(b),this.b=o.getZ(b),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Kp;as.NAMES=SA;class Py{static getDataURL(o,b=!1){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let et;if(o instanceof HTMLCanvasElement)et=o;else{Kp===void 0&&(Kp=B_("canvas")),Kp.width=o.width,Kp.height=o.height;const tt=Kp.getContext("2d");o instanceof ImageData?tt.putImageData(o,0,0):tt.drawImage(o,0,0,o.width,o.height),et=Kp}return!b&&(et.width>2048||et.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),et.toDataURL("image/jpeg",.6)):et.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const b=B_("canvas");b.width=o.width,b.height=o.height;const et=b.getContext("2d");et.drawImage(o,0,0,o.width,o.height);const tt=et.getImageData(0,0,o.width,o.height),ot=tt.data;for(let lt=0;lt<ot.length;lt++)ot[lt]=255*_m(ot[lt]/255);return et.putImageData(tt,0,0),b}if(o.data){const b=o.data.slice(0);for(let et=0;et<b.length;et++)b instanceof Uint8Array||b instanceof Uint8ClampedArray?b[et]=Math.floor(255*_m(b[et]/255)):b[et]=_m(b[et]);return{data:b,width:o.width,height:o.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class O_{constructor(o=null){this.isSource=!0,this.uuid=Xu(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const b=o===void 0||typeof o=="string";if(!b&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const et={uuid:this.uuid,url:""},tt=this.data;if(tt!==null){let ot;if(Array.isArray(tt)){ot=[];for(let lt=0,ht=tt.length;lt<ht;lt++)tt[lt].isDataTexture?ot.push(T0(tt[lt].image)):ot.push(T0(tt[lt]))}else ot=T0(tt);et.url=ot}return b||(o.images[this.uuid]=et),et}}function T0(dt){if(typeof HTMLImageElement<"u"&&dt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&dt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&dt instanceof ImageBitmap)return Py.getDataURL(dt);if(dt.data){let o=[];try{o=Array.from(dt.data)}catch(b){b.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(b),o=dt.data}return{data:o,width:dt.width,height:dt.height,type:dt.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let Lw=0;class vu extends js{constructor(o=vu.DEFAULT_IMAGE,b=vu.DEFAULT_MAPPING,et=no,tt=no,ot=Vo,lt=hs,ht=bs,vt=$l,_t=1,Mt=vm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Lw++}),this.uuid=Xu(),this.name="",this.source=new O_(o),this.mipmaps=[],this.mapping=b,this.wrapS=et,this.wrapT=tt,this.magFilter=ot,this.minFilter=lt,this.anisotropy=_t,this.format=ht,this.internalFormat=null,this.type=vt,this.offset=new Lr(0,0),this.repeat=new Lr(1,1),this.center=new Lr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ru,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=Mt,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.encoding=o.encoding,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const b=o===void 0||typeof o=="string";if(!b&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const et={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(et.userData=this.userData),b||(o.textures[this.uuid]=et),et}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==Bl)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case vo:o.x=o.x-Math.floor(o.x);break;case no:o.x=o.x<0?0:1;break;case Al:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x)}if(o.y<0||o.y>1)switch(this.wrapT){case vo:o.y=o.y-Math.floor(o.y);break;case no:o.y=o.y<0?0:1;break;case Al:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y)}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0)}}vu.DEFAULT_IMAGE=null,vu.DEFAULT_MAPPING=Bl;class Uo{constructor(o=0,b=0,et=0,tt=1){Uo.prototype.isVector4=!0,this.x=o,this.y=b,this.z=et,this.w=tt}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,b,et,tt){return this.x=o,this.y=b,this.z=et,this.w=tt,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,b){switch(o){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,b){return this.x=o.x+b.x,this.y=o.y+b.y,this.z=o.z+b.z,this.w=o.w+b.w,this}addScaledVector(o,b){return this.x+=o.x*b,this.y+=o.y*b,this.z+=o.z*b,this.w+=o.w*b,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,b){return this.x=o.x-b.x,this.y=o.y-b.y,this.z=o.z-b.z,this.w=o.w-b.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const b=this.x,et=this.y,tt=this.z,ot=this.w,lt=o.elements;return this.x=lt[0]*b+lt[4]*et+lt[8]*tt+lt[12]*ot,this.y=lt[1]*b+lt[5]*et+lt[9]*tt+lt[13]*ot,this.z=lt[2]*b+lt[6]*et+lt[10]*tt+lt[14]*ot,this.w=lt[3]*b+lt[7]*et+lt[11]*tt+lt[15]*ot,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const b=Math.sqrt(1-o.w*o.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/b,this.y=o.y/b,this.z=o.z/b),this}setAxisAngleFromRotationMatrix(o){let b,et,tt,ot;const vt=o.elements,_t=vt[0],Mt=vt[4],Pt=vt[8],Tt=vt[1],Rt=vt[5],Nt=vt[9],kt=vt[2],Kt=vt[6],$t=vt[10];if(Math.abs(Mt-Tt)<.01&&Math.abs(Pt-kt)<.01&&Math.abs(Nt-Kt)<.01){if(Math.abs(Mt+Tt)<.1&&Math.abs(Pt+kt)<.1&&Math.abs(Nt+Kt)<.1&&Math.abs(_t+Rt+$t-3)<.1)return this.set(1,0,0,0),this;b=Math.PI;const ln=(_t+1)/2,gn=(Rt+1)/2,_n=($t+1)/2,An=(Mt+Tt)/4,Ln=(Pt+kt)/4,Nn=(Nt+Kt)/4;return ln>gn&&ln>_n?ln<.01?(et=0,tt=.707106781,ot=.707106781):(et=Math.sqrt(ln),tt=An/et,ot=Ln/et):gn>_n?gn<.01?(et=.707106781,tt=0,ot=.707106781):(tt=Math.sqrt(gn),et=An/tt,ot=Nn/tt):_n<.01?(et=.707106781,tt=.707106781,ot=0):(ot=Math.sqrt(_n),et=Ln/ot,tt=Nn/ot),this.set(et,tt,ot,b),this}let en=Math.sqrt((Kt-Nt)*(Kt-Nt)+(Pt-kt)*(Pt-kt)+(Tt-Mt)*(Tt-Mt));return Math.abs(en)<.001&&(en=1),this.x=(Kt-Nt)/en,this.y=(Pt-kt)/en,this.z=(Tt-Mt)/en,this.w=Math.acos((_t+Rt+$t-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,b){return this.x=Math.max(o.x,Math.min(b.x,this.x)),this.y=Math.max(o.y,Math.min(b.y,this.y)),this.z=Math.max(o.z,Math.min(b.z,this.z)),this.w=Math.max(o.w,Math.min(b.w,this.w)),this}clampScalar(o,b){return this.x=Math.max(o,Math.min(b,this.x)),this.y=Math.max(o,Math.min(b,this.y)),this.z=Math.max(o,Math.min(b,this.z)),this.w=Math.max(o,Math.min(b,this.w)),this}clampLength(o,b){const et=this.length();return this.divideScalar(et||1).multiplyScalar(Math.max(o,Math.min(b,et)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,b){return this.x+=(o.x-this.x)*b,this.y+=(o.y-this.y)*b,this.z+=(o.z-this.z)*b,this.w+=(o.w-this.w)*b,this}lerpVectors(o,b,et){return this.x=o.x+(b.x-o.x)*et,this.y=o.y+(b.y-o.y)*et,this.z=o.z+(b.z-o.z)*et,this.w=o.w+(b.w-o.w)*et,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,b=0){return this.x=o[b],this.y=o[b+1],this.z=o[b+2],this.w=o[b+3],this}toArray(o=[],b=0){return o[b]=this.x,o[b+1]=this.y,o[b+2]=this.z,o[b+3]=this.w,o}fromBufferAttribute(o,b){return this.x=o.getX(b),this.y=o.getY(b),this.z=o.getZ(b),this.w=o.getW(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class wp extends js{constructor(o,b,et={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=b,this.depth=1,this.scissor=new Uo(0,0,o,b),this.scissorTest=!1,this.viewport=new Uo(0,0,o,b);const tt={width:o,height:b,depth:1};this.texture=new vu(tt,et.mapping,et.wrapS,et.wrapT,et.magFilter,et.minFilter,et.format,et.type,et.anisotropy,et.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=et.generateMipmaps!==void 0&&et.generateMipmaps,this.texture.internalFormat=et.internalFormat!==void 0?et.internalFormat:null,this.texture.minFilter=et.minFilter!==void 0?et.minFilter:Vo,this.depthBuffer=et.depthBuffer===void 0||et.depthBuffer,this.stencilBuffer=et.stencilBuffer!==void 0&&et.stencilBuffer,this.depthTexture=et.depthTexture!==void 0?et.depthTexture:null,this.samples=et.samples!==void 0?et.samples:0}setSize(o,b,et=1){this.width===o&&this.height===b&&this.depth===et||(this.width=o,this.height=b,this.depth=et,this.texture.image.width=o,this.texture.image.height=b,this.texture.image.depth=et,this.dispose()),this.viewport.set(0,0,o,b),this.scissor.set(0,0,o,b)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const b=Object.assign({},o.texture.image);return this.texture.source=new O_(b),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class I0 extends vu{constructor(o=null,b=1,et=1,tt=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:b,height:et,depth:tt},this.magFilter=qo,this.minFilter=qo,this.wrapR=no,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class b1 extends wp{constructor(o,b,et){super(o,b),this.isWebGLArrayRenderTarget=!0,this.depth=et,this.texture=new I0(null,o,b,et),this.texture.isRenderTargetTexture=!0}}class L_ extends vu{constructor(o=null,b=1,et=1,tt=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:b,height:et,depth:tt},this.magFilter=qo,this.minFilter=qo,this.wrapR=no,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class MA extends wp{constructor(o,b,et){super(o,b),this.isWebGL3DRenderTarget=!0,this.depth=et,this.texture=new L_(null,o,b,et),this.texture.isRenderTargetTexture=!0}}class $p extends wp{constructor(o,b,et,tt={}){super(o,b,tt),this.isWebGLMultipleRenderTargets=!0;const ot=this.texture;this.texture=[];for(let lt=0;lt<et;lt++)this.texture[lt]=ot.clone(),this.texture[lt].isRenderTargetTexture=!0}setSize(o,b,et=1){if(this.width!==o||this.height!==b||this.depth!==et){this.width=o,this.height=b,this.depth=et;for(let tt=0,ot=this.texture.length;tt<ot;tt++)this.texture[tt].image.width=o,this.texture[tt].image.height=b,this.texture[tt].image.depth=et;this.dispose()}return this.viewport.set(0,0,o,b),this.scissor.set(0,0,o,b),this}copy(o){this.dispose(),this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.texture.length=0;for(let b=0,et=o.texture.length;b<et;b++)this.texture[b]=o.texture[b].clone(),this.texture[b].isRenderTargetTexture=!0;return this}}class ku{constructor(o=0,b=0,et=0,tt=1){this.isQuaternion=!0,this._x=o,this._y=b,this._z=et,this._w=tt}static slerpFlat(o,b,et,tt,ot,lt,ht){let vt=et[tt+0],_t=et[tt+1],Mt=et[tt+2],Pt=et[tt+3];const Tt=ot[lt+0],Rt=ot[lt+1],Nt=ot[lt+2],kt=ot[lt+3];if(ht===0)return o[b+0]=vt,o[b+1]=_t,o[b+2]=Mt,void(o[b+3]=Pt);if(ht===1)return o[b+0]=Tt,o[b+1]=Rt,o[b+2]=Nt,void(o[b+3]=kt);if(Pt!==kt||vt!==Tt||_t!==Rt||Mt!==Nt){let Kt=1-ht;const $t=vt*Tt+_t*Rt+Mt*Nt+Pt*kt,en=$t>=0?1:-1,ln=1-$t*$t;if(ln>Number.EPSILON){const _n=Math.sqrt(ln),An=Math.atan2(_n,$t*en);Kt=Math.sin(Kt*An)/_n,ht=Math.sin(ht*An)/_n}const gn=ht*en;if(vt=vt*Kt+Tt*gn,_t=_t*Kt+Rt*gn,Mt=Mt*Kt+Nt*gn,Pt=Pt*Kt+kt*gn,Kt===1-ht){const _n=1/Math.sqrt(vt*vt+_t*_t+Mt*Mt+Pt*Pt);vt*=_n,_t*=_n,Mt*=_n,Pt*=_n}}o[b]=vt,o[b+1]=_t,o[b+2]=Mt,o[b+3]=Pt}static multiplyQuaternionsFlat(o,b,et,tt,ot,lt){const ht=et[tt],vt=et[tt+1],_t=et[tt+2],Mt=et[tt+3],Pt=ot[lt],Tt=ot[lt+1],Rt=ot[lt+2],Nt=ot[lt+3];return o[b]=ht*Nt+Mt*Pt+vt*Rt-_t*Tt,o[b+1]=vt*Nt+Mt*Tt+_t*Pt-ht*Rt,o[b+2]=_t*Nt+Mt*Rt+ht*Tt-vt*Pt,o[b+3]=Mt*Nt-ht*Pt-vt*Tt-_t*Rt,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,b,et,tt){return this._x=o,this._y=b,this._z=et,this._w=tt,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,b){const et=o._x,tt=o._y,ot=o._z,lt=o._order,ht=Math.cos,vt=Math.sin,_t=ht(et/2),Mt=ht(tt/2),Pt=ht(ot/2),Tt=vt(et/2),Rt=vt(tt/2),Nt=vt(ot/2);switch(lt){case"XYZ":this._x=Tt*Mt*Pt+_t*Rt*Nt,this._y=_t*Rt*Pt-Tt*Mt*Nt,this._z=_t*Mt*Nt+Tt*Rt*Pt,this._w=_t*Mt*Pt-Tt*Rt*Nt;break;case"YXZ":this._x=Tt*Mt*Pt+_t*Rt*Nt,this._y=_t*Rt*Pt-Tt*Mt*Nt,this._z=_t*Mt*Nt-Tt*Rt*Pt,this._w=_t*Mt*Pt+Tt*Rt*Nt;break;case"ZXY":this._x=Tt*Mt*Pt-_t*Rt*Nt,this._y=_t*Rt*Pt+Tt*Mt*Nt,this._z=_t*Mt*Nt+Tt*Rt*Pt,this._w=_t*Mt*Pt-Tt*Rt*Nt;break;case"ZYX":this._x=Tt*Mt*Pt-_t*Rt*Nt,this._y=_t*Rt*Pt+Tt*Mt*Nt,this._z=_t*Mt*Nt-Tt*Rt*Pt,this._w=_t*Mt*Pt+Tt*Rt*Nt;break;case"YZX":this._x=Tt*Mt*Pt+_t*Rt*Nt,this._y=_t*Rt*Pt+Tt*Mt*Nt,this._z=_t*Mt*Nt-Tt*Rt*Pt,this._w=_t*Mt*Pt-Tt*Rt*Nt;break;case"XZY":this._x=Tt*Mt*Pt-_t*Rt*Nt,this._y=_t*Rt*Pt-Tt*Mt*Nt,this._z=_t*Mt*Nt+Tt*Rt*Pt,this._w=_t*Mt*Pt+Tt*Rt*Nt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+lt)}return b!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,b){const et=b/2,tt=Math.sin(et);return this._x=o.x*tt,this._y=o.y*tt,this._z=o.z*tt,this._w=Math.cos(et),this._onChangeCallback(),this}setFromRotationMatrix(o){const b=o.elements,et=b[0],tt=b[4],ot=b[8],lt=b[1],ht=b[5],vt=b[9],_t=b[2],Mt=b[6],Pt=b[10],Tt=et+ht+Pt;if(Tt>0){const Rt=.5/Math.sqrt(Tt+1);this._w=.25/Rt,this._x=(Mt-vt)*Rt,this._y=(ot-_t)*Rt,this._z=(lt-tt)*Rt}else if(et>ht&&et>Pt){const Rt=2*Math.sqrt(1+et-ht-Pt);this._w=(Mt-vt)/Rt,this._x=.25*Rt,this._y=(tt+lt)/Rt,this._z=(ot+_t)/Rt}else if(ht>Pt){const Rt=2*Math.sqrt(1+ht-et-Pt);this._w=(ot-_t)/Rt,this._x=(tt+lt)/Rt,this._y=.25*Rt,this._z=(vt+Mt)/Rt}else{const Rt=2*Math.sqrt(1+Pt-et-ht);this._w=(lt-tt)/Rt,this._x=(ot+_t)/Rt,this._y=(vt+Mt)/Rt,this._z=.25*Rt}return this._onChangeCallback(),this}setFromUnitVectors(o,b){let et=o.dot(b)+1;return et<Number.EPSILON?(et=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=et):(this._x=0,this._y=-o.z,this._z=o.y,this._w=et)):(this._x=o.y*b.z-o.z*b.y,this._y=o.z*b.x-o.x*b.z,this._z=o.x*b.y-o.y*b.x,this._w=et),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(Ts(this.dot(o),-1,1)))}rotateTowards(o,b){const et=this.angleTo(o);if(et===0)return this;const tt=Math.min(1,b/et);return this.slerp(o,tt),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,b){const et=o._x,tt=o._y,ot=o._z,lt=o._w,ht=b._x,vt=b._y,_t=b._z,Mt=b._w;return this._x=et*Mt+lt*ht+tt*_t-ot*vt,this._y=tt*Mt+lt*vt+ot*ht-et*_t,this._z=ot*Mt+lt*_t+et*vt-tt*ht,this._w=lt*Mt-et*ht-tt*vt-ot*_t,this._onChangeCallback(),this}slerp(o,b){if(b===0)return this;if(b===1)return this.copy(o);const et=this._x,tt=this._y,ot=this._z,lt=this._w;let ht=lt*o._w+et*o._x+tt*o._y+ot*o._z;if(ht<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,ht=-ht):this.copy(o),ht>=1)return this._w=lt,this._x=et,this._y=tt,this._z=ot,this;const vt=1-ht*ht;if(vt<=Number.EPSILON){const Rt=1-b;return this._w=Rt*lt+b*this._w,this._x=Rt*et+b*this._x,this._y=Rt*tt+b*this._y,this._z=Rt*ot+b*this._z,this.normalize(),this._onChangeCallback(),this}const _t=Math.sqrt(vt),Mt=Math.atan2(_t,ht),Pt=Math.sin((1-b)*Mt)/_t,Tt=Math.sin(b*Mt)/_t;return this._w=lt*Pt+this._w*Tt,this._x=et*Pt+this._x*Tt,this._y=tt*Pt+this._y*Tt,this._z=ot*Pt+this._z*Tt,this._onChangeCallback(),this}slerpQuaternions(o,b,et){return this.copy(o).slerp(b,et)}random(){const o=Math.random(),b=Math.sqrt(1-o),et=Math.sqrt(o),tt=2*Math.PI*Math.random(),ot=2*Math.PI*Math.random();return this.set(b*Math.cos(tt),et*Math.sin(ot),et*Math.cos(ot),b*Math.sin(tt))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,b=0){return this._x=o[b],this._y=o[b+1],this._z=o[b+2],this._w=o[b+3],this._onChangeCallback(),this}toArray(o=[],b=0){return o[b]=this._x,o[b+1]=this._y,o[b+2]=this._z,o[b+3]=this._w,o}fromBufferAttribute(o,b){return this._x=o.getX(b),this._y=o.getY(b),this._z=o.getZ(b),this._w=o.getW(b),this}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class xn{constructor(o=0,b=0,et=0){xn.prototype.isVector3=!0,this.x=o,this.y=b,this.z=et}set(o,b,et){return et===void 0&&(et=this.z),this.x=o,this.y=b,this.z=et,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,b){switch(o){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,b){return this.x=o.x+b.x,this.y=o.y+b.y,this.z=o.z+b.z,this}addScaledVector(o,b){return this.x+=o.x*b,this.y+=o.y*b,this.z+=o.z*b,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,b){return this.x=o.x-b.x,this.y=o.y-b.y,this.z=o.z-b.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,b){return this.x=o.x*b.x,this.y=o.y*b.y,this.z=o.z*b.z,this}applyEuler(o){return this.applyQuaternion(Jp.setFromEuler(o))}applyAxisAngle(o,b){return this.applyQuaternion(Jp.setFromAxisAngle(o,b))}applyMatrix3(o){const b=this.x,et=this.y,tt=this.z,ot=o.elements;return this.x=ot[0]*b+ot[3]*et+ot[6]*tt,this.y=ot[1]*b+ot[4]*et+ot[7]*tt,this.z=ot[2]*b+ot[5]*et+ot[8]*tt,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const b=this.x,et=this.y,tt=this.z,ot=o.elements,lt=1/(ot[3]*b+ot[7]*et+ot[11]*tt+ot[15]);return this.x=(ot[0]*b+ot[4]*et+ot[8]*tt+ot[12])*lt,this.y=(ot[1]*b+ot[5]*et+ot[9]*tt+ot[13])*lt,this.z=(ot[2]*b+ot[6]*et+ot[10]*tt+ot[14])*lt,this}applyQuaternion(o){const b=this.x,et=this.y,tt=this.z,ot=o.x,lt=o.y,ht=o.z,vt=o.w,_t=vt*b+lt*tt-ht*et,Mt=vt*et+ht*b-ot*tt,Pt=vt*tt+ot*et-lt*b,Tt=-ot*b-lt*et-ht*tt;return this.x=_t*vt+Tt*-ot+Mt*-ht-Pt*-lt,this.y=Mt*vt+Tt*-lt+Pt*-ot-_t*-ht,this.z=Pt*vt+Tt*-ht+_t*-lt-Mt*-ot,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const b=this.x,et=this.y,tt=this.z,ot=o.elements;return this.x=ot[0]*b+ot[4]*et+ot[8]*tt,this.y=ot[1]*b+ot[5]*et+ot[9]*tt,this.z=ot[2]*b+ot[6]*et+ot[10]*tt,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,b){return this.x=Math.max(o.x,Math.min(b.x,this.x)),this.y=Math.max(o.y,Math.min(b.y,this.y)),this.z=Math.max(o.z,Math.min(b.z,this.z)),this}clampScalar(o,b){return this.x=Math.max(o,Math.min(b,this.x)),this.y=Math.max(o,Math.min(b,this.y)),this.z=Math.max(o,Math.min(b,this.z)),this}clampLength(o,b){const et=this.length();return this.divideScalar(et||1).multiplyScalar(Math.max(o,Math.min(b,et)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,b){return this.x+=(o.x-this.x)*b,this.y+=(o.y-this.y)*b,this.z+=(o.z-this.z)*b,this}lerpVectors(o,b,et){return this.x=o.x+(b.x-o.x)*et,this.y=o.y+(b.y-o.y)*et,this.z=o.z+(b.z-o.z)*et,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,b){const et=o.x,tt=o.y,ot=o.z,lt=b.x,ht=b.y,vt=b.z;return this.x=tt*vt-ot*ht,this.y=ot*lt-et*vt,this.z=et*ht-tt*lt,this}projectOnVector(o){const b=o.lengthSq();if(b===0)return this.set(0,0,0);const et=o.dot(this)/b;return this.copy(o).multiplyScalar(et)}projectOnPlane(o){return fv.copy(this).projectOnVector(o),this.sub(fv)}reflect(o){return this.sub(fv.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const b=Math.sqrt(this.lengthSq()*o.lengthSq());if(b===0)return Math.PI/2;const et=this.dot(o)/b;return Math.acos(Ts(et,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const b=this.x-o.x,et=this.y-o.y,tt=this.z-o.z;return b*b+et*et+tt*tt}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,b,et){const tt=Math.sin(b)*o;return this.x=tt*Math.sin(et),this.y=Math.cos(b)*o,this.z=tt*Math.cos(et),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,b,et){return this.x=o*Math.sin(b),this.y=et,this.z=o*Math.cos(b),this}setFromMatrixPosition(o){const b=o.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this}setFromMatrixScale(o){const b=this.setFromMatrixColumn(o,0).length(),et=this.setFromMatrixColumn(o,1).length(),tt=this.setFromMatrixColumn(o,2).length();return this.x=b,this.y=et,this.z=tt,this}setFromMatrixColumn(o,b){return this.fromArray(o.elements,4*b)}setFromMatrix3Column(o,b){return this.fromArray(o.elements,3*b)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,b=0){return this.x=o[b],this.y=o[b+1],this.z=o[b+2],this}toArray(o=[],b=0){return o[b]=this.x,o[b+1]=this.y,o[b+2]=this.z,o}fromBufferAttribute(o,b){return this.x=o.getX(b),this.y=o.getY(b),this.z=o.getZ(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=2*(Math.random()-.5),b=Math.random()*Math.PI*2,et=Math.sqrt(1-o**2);return this.x=et*Math.cos(b),this.y=et*Math.sin(b),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const fv=new xn,Jp=new ku;class N_{constructor(o=new xn(1/0,1/0,1/0),b=new xn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=b}set(o,b){return this.min.copy(o),this.max.copy(b),this}setFromArray(o){let b=1/0,et=1/0,tt=1/0,ot=-1/0,lt=-1/0,ht=-1/0;for(let vt=0,_t=o.length;vt<_t;vt+=3){const Mt=o[vt],Pt=o[vt+1],Tt=o[vt+2];Mt<b&&(b=Mt),Pt<et&&(et=Pt),Tt<tt&&(tt=Tt),Mt>ot&&(ot=Mt),Pt>lt&&(lt=Pt),Tt>ht&&(ht=Tt)}return this.min.set(b,et,tt),this.max.set(ot,lt,ht),this}setFromBufferAttribute(o){let b=1/0,et=1/0,tt=1/0,ot=-1/0,lt=-1/0,ht=-1/0;for(let vt=0,_t=o.count;vt<_t;vt++){const Mt=o.getX(vt),Pt=o.getY(vt),Tt=o.getZ(vt);Mt<b&&(b=Mt),Pt<et&&(et=Pt),Tt<tt&&(tt=Tt),Mt>ot&&(ot=Mt),Pt>lt&&(lt=Pt),Tt>ht&&(ht=Tt)}return this.min.set(b,et,tt),this.max.set(ot,lt,ht),this}setFromPoints(o){this.makeEmpty();for(let b=0,et=o.length;b<et;b++)this.expandByPoint(o[b]);return this}setFromCenterAndSize(o,b){const et=F_.copy(b).multiplyScalar(.5);return this.min.copy(o).sub(et),this.max.copy(o).add(et),this}setFromObject(o,b=!1){return this.makeEmpty(),this.expandByObject(o,b)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,b=!1){o.updateWorldMatrix(!1,!1);const et=o.geometry;if(et!==void 0)if(b&&et.attributes!=null&&et.attributes.position!==void 0){const ot=et.attributes.position;for(let lt=0,ht=ot.count;lt<ht;lt++)F_.fromBufferAttribute(ot,lt).applyMatrix4(o.matrixWorld),this.expandByPoint(F_)}else et.boundingBox===null&&et.computeBoundingBox(),TA.copy(et.boundingBox),TA.applyMatrix4(o.matrixWorld),this.union(TA);const tt=o.children;for(let ot=0,lt=tt.length;ot<lt;ot++)this.expandByObject(tt[ot],b);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,b){return b.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,F_),F_.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let b,et;return o.normal.x>0?(b=o.normal.x*this.min.x,et=o.normal.x*this.max.x):(b=o.normal.x*this.max.x,et=o.normal.x*this.min.x),o.normal.y>0?(b+=o.normal.y*this.min.y,et+=o.normal.y*this.max.y):(b+=o.normal.y*this.max.y,et+=o.normal.y*this.min.y),o.normal.z>0?(b+=o.normal.z*this.min.z,et+=o.normal.z*this.max.z):(b+=o.normal.z*this.max.z,et+=o.normal.z*this.min.z),b<=-o.constant&&et>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(P0),IA.subVectors(this.max,P0),ym.subVectors(o.a,P0),Yv.subVectors(o.b,P0),gv.subVectors(o.c,P0),Am.subVectors(Yv,ym),Xv.subVectors(gv,Yv),xp.subVectors(ym,gv);let b=[0,-Am.z,Am.y,0,-Xv.z,Xv.y,0,-xp.z,xp.y,Am.z,0,-Am.x,Xv.z,0,-Xv.x,xp.z,0,-xp.x,-Am.y,Am.x,0,-Xv.y,Xv.x,0,-xp.y,xp.x,0];return!!PA(b,ym,Yv,gv,IA)&&(b=[1,0,0,0,1,0,0,0,1],!!PA(b,ym,Yv,gv,IA)&&(U_.crossVectors(Am,Xv),b=[U_.x,U_.y,U_.z],PA(b,ym,Yv,gv,IA)))}clampPoint(o,b){return b.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return F_.copy(o).clamp(this.min,this.max).sub(o).length()}getBoundingSphere(o){return this.getCenter(o.center),o.radius=.5*this.getSize(F_).length(),o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()||(mv[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),mv[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),mv[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),mv[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),mv[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),mv[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),mv[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),mv[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(mv)),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const mv=[new xn,new xn,new xn,new xn,new xn,new xn,new xn,new xn],F_=new xn,TA=new N_,ym=new xn,Yv=new xn,gv=new xn,Am=new xn,Xv=new xn,xp=new xn,P0=new xn,IA=new xn,U_=new xn,Kv=new xn;function PA(dt,o,b,et,tt){for(let ot=0,lt=dt.length-3;ot<=lt;ot+=3){Kv.fromArray(dt,ot);const ht=tt.x*Math.abs(Kv.x)+tt.y*Math.abs(Kv.y)+tt.z*Math.abs(Kv.z),vt=o.dot(Kv),_t=b.dot(Kv),Mt=et.dot(Kv);if(Math.max(-Math.max(vt,_t,Mt),Math.min(vt,_t,Mt))>ht)return!1}return!0}const xo=new N_,Tl=new xn,Zp=new xn,kp=new xn;class _f{constructor(o=new xn,b=-1){this.center=o,this.radius=b}set(o,b){return this.center.copy(o),this.radius=b,this}setFromPoints(o,b){const et=this.center;b!==void 0?et.copy(b):xo.setFromPoints(o).getCenter(et);let tt=0;for(let ot=0,lt=o.length;ot<lt;ot++)tt=Math.max(tt,et.distanceToSquared(o[ot]));return this.radius=Math.sqrt(tt),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const b=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=b*b}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,b){const et=this.center.distanceToSquared(o);return b.copy(o),et>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center)),b}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){kp.subVectors(o,this.center);const b=kp.lengthSq();if(b>this.radius*this.radius){const et=Math.sqrt(b),tt=.5*(et-this.radius);this.center.add(kp.multiplyScalar(tt/et)),this.radius+=tt}return this}union(o){return this.center.equals(o.center)===!0?Zp.set(0,0,1).multiplyScalar(o.radius):Zp.subVectors(o.center,this.center).normalize().multiplyScalar(o.radius),this.expandByPoint(Tl.copy(o.center).add(Zp)),this.expandByPoint(Tl.copy(o.center).sub(Zp)),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const fu=new xn,DA=new xn,D0=new xn,zm=new xn,R0=new xn,Dy=new xn,RA=new xn;class $v{constructor(o=new xn,b=new xn(0,0,-1)){this.origin=o,this.direction=b}set(o,b){return this.origin.copy(o),this.direction.copy(b),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,b){return b.copy(this.direction).multiplyScalar(o).add(this.origin)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,fu)),this}closestPointToPoint(o,b){b.subVectors(o,this.origin);const et=b.dot(this.direction);return et<0?b.copy(this.origin):b.copy(this.direction).multiplyScalar(et).add(this.origin)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const b=fu.subVectors(o,this.origin).dot(this.direction);return b<0?this.origin.distanceToSquared(o):(fu.copy(this.direction).multiplyScalar(b).add(this.origin),fu.distanceToSquared(o))}distanceSqToSegment(o,b,et,tt){DA.copy(o).add(b).multiplyScalar(.5),D0.copy(b).sub(o).normalize(),zm.copy(this.origin).sub(DA);const ot=.5*o.distanceTo(b),lt=-this.direction.dot(D0),ht=zm.dot(this.direction),vt=-zm.dot(D0),_t=zm.lengthSq(),Mt=Math.abs(1-lt*lt);let Pt,Tt,Rt,Nt;if(Mt>0)if(Pt=lt*vt-ht,Tt=lt*ht-vt,Nt=ot*Mt,Pt>=0)if(Tt>=-Nt)if(Tt<=Nt){const kt=1/Mt;Pt*=kt,Tt*=kt,Rt=Pt*(Pt+lt*Tt+2*ht)+Tt*(lt*Pt+Tt+2*vt)+_t}else Tt=ot,Pt=Math.max(0,-(lt*Tt+ht)),Rt=-Pt*Pt+Tt*(Tt+2*vt)+_t;else Tt=-ot,Pt=Math.max(0,-(lt*Tt+ht)),Rt=-Pt*Pt+Tt*(Tt+2*vt)+_t;else Tt<=-Nt?(Pt=Math.max(0,-(-lt*ot+ht)),Tt=Pt>0?-ot:Math.min(Math.max(-ot,-vt),ot),Rt=-Pt*Pt+Tt*(Tt+2*vt)+_t):Tt<=Nt?(Pt=0,Tt=Math.min(Math.max(-ot,-vt),ot),Rt=Tt*(Tt+2*vt)+_t):(Pt=Math.max(0,-(lt*ot+ht)),Tt=Pt>0?ot:Math.min(Math.max(-ot,-vt),ot),Rt=-Pt*Pt+Tt*(Tt+2*vt)+_t);else Tt=lt>0?-ot:ot,Pt=Math.max(0,-(lt*Tt+ht)),Rt=-Pt*Pt+Tt*(Tt+2*vt)+_t;return et&&et.copy(this.direction).multiplyScalar(Pt).add(this.origin),tt&&tt.copy(D0).multiplyScalar(Tt).add(DA),Rt}intersectSphere(o,b){fu.subVectors(o.center,this.origin);const et=fu.dot(this.direction),tt=fu.dot(fu)-et*et,ot=o.radius*o.radius;if(tt>ot)return null;const lt=Math.sqrt(ot-tt),ht=et-lt,vt=et+lt;return ht<0&&vt<0?null:ht<0?this.at(vt,b):this.at(ht,b)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const b=o.normal.dot(this.direction);if(b===0)return o.distanceToPoint(this.origin)===0?0:null;const et=-(this.origin.dot(o.normal)+o.constant)/b;return et>=0?et:null}intersectPlane(o,b){const et=this.distanceToPlane(o);return et===null?null:this.at(et,b)}intersectsPlane(o){const b=o.distanceToPoint(this.origin);return b===0||o.normal.dot(this.direction)*b<0}intersectBox(o,b){let et,tt,ot,lt,ht,vt;const _t=1/this.direction.x,Mt=1/this.direction.y,Pt=1/this.direction.z,Tt=this.origin;return _t>=0?(et=(o.min.x-Tt.x)*_t,tt=(o.max.x-Tt.x)*_t):(et=(o.max.x-Tt.x)*_t,tt=(o.min.x-Tt.x)*_t),Mt>=0?(ot=(o.min.y-Tt.y)*Mt,lt=(o.max.y-Tt.y)*Mt):(ot=(o.max.y-Tt.y)*Mt,lt=(o.min.y-Tt.y)*Mt),et>lt||ot>tt?null:((ot>et||et!=et)&&(et=ot),(lt<tt||tt!=tt)&&(tt=lt),Pt>=0?(ht=(o.min.z-Tt.z)*Pt,vt=(o.max.z-Tt.z)*Pt):(ht=(o.max.z-Tt.z)*Pt,vt=(o.min.z-Tt.z)*Pt),et>vt||ht>tt?null:((ht>et||et!=et)&&(et=ht),(vt<tt||tt!=tt)&&(tt=vt),tt<0?null:this.at(et>=0?et:tt,b)))}intersectsBox(o){return this.intersectBox(o,fu)!==null}intersectTriangle(o,b,et,tt,ot){R0.subVectors(b,o),Dy.subVectors(et,o),RA.crossVectors(R0,Dy);let lt,ht=this.direction.dot(RA);if(ht>0){if(tt)return null;lt=1}else{if(!(ht<0))return null;lt=-1,ht=-ht}zm.subVectors(this.origin,o);const vt=lt*this.direction.dot(Dy.crossVectors(zm,Dy));if(vt<0)return null;const _t=lt*this.direction.dot(R0.cross(zm));if(_t<0||vt+_t>ht)return null;const Mt=-lt*zm.dot(RA);return Mt<0?null:this.at(Mt/ht,ot)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class zs{constructor(){zs.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,b,et,tt,ot,lt,ht,vt,_t,Mt,Pt,Tt,Rt,Nt,kt,Kt){const $t=this.elements;return $t[0]=o,$t[4]=b,$t[8]=et,$t[12]=tt,$t[1]=ot,$t[5]=lt,$t[9]=ht,$t[13]=vt,$t[2]=_t,$t[6]=Mt,$t[10]=Pt,$t[14]=Tt,$t[3]=Rt,$t[7]=Nt,$t[11]=kt,$t[15]=Kt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new zs().fromArray(this.elements)}copy(o){const b=this.elements,et=o.elements;return b[0]=et[0],b[1]=et[1],b[2]=et[2],b[3]=et[3],b[4]=et[4],b[5]=et[5],b[6]=et[6],b[7]=et[7],b[8]=et[8],b[9]=et[9],b[10]=et[10],b[11]=et[11],b[12]=et[12],b[13]=et[13],b[14]=et[14],b[15]=et[15],this}copyPosition(o){const b=this.elements,et=o.elements;return b[12]=et[12],b[13]=et[13],b[14]=et[14],this}setFromMatrix3(o){const b=o.elements;return this.set(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1),this}extractBasis(o,b,et){return o.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),et.setFromMatrixColumn(this,2),this}makeBasis(o,b,et){return this.set(o.x,b.x,et.x,0,o.y,b.y,et.y,0,o.z,b.z,et.z,0,0,0,0,1),this}extractRotation(o){const b=this.elements,et=o.elements,tt=1/Ko.setFromMatrixColumn(o,0).length(),ot=1/Ko.setFromMatrixColumn(o,1).length(),lt=1/Ko.setFromMatrixColumn(o,2).length();return b[0]=et[0]*tt,b[1]=et[1]*tt,b[2]=et[2]*tt,b[3]=0,b[4]=et[4]*ot,b[5]=et[5]*ot,b[6]=et[6]*ot,b[7]=0,b[8]=et[8]*lt,b[9]=et[9]*lt,b[10]=et[10]*lt,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromEuler(o){const b=this.elements,et=o.x,tt=o.y,ot=o.z,lt=Math.cos(et),ht=Math.sin(et),vt=Math.cos(tt),_t=Math.sin(tt),Mt=Math.cos(ot),Pt=Math.sin(ot);if(o.order==="XYZ"){const Tt=lt*Mt,Rt=lt*Pt,Nt=ht*Mt,kt=ht*Pt;b[0]=vt*Mt,b[4]=-vt*Pt,b[8]=_t,b[1]=Rt+Nt*_t,b[5]=Tt-kt*_t,b[9]=-ht*vt,b[2]=kt-Tt*_t,b[6]=Nt+Rt*_t,b[10]=lt*vt}else if(o.order==="YXZ"){const Tt=vt*Mt,Rt=vt*Pt,Nt=_t*Mt,kt=_t*Pt;b[0]=Tt+kt*ht,b[4]=Nt*ht-Rt,b[8]=lt*_t,b[1]=lt*Pt,b[5]=lt*Mt,b[9]=-ht,b[2]=Rt*ht-Nt,b[6]=kt+Tt*ht,b[10]=lt*vt}else if(o.order==="ZXY"){const Tt=vt*Mt,Rt=vt*Pt,Nt=_t*Mt,kt=_t*Pt;b[0]=Tt-kt*ht,b[4]=-lt*Pt,b[8]=Nt+Rt*ht,b[1]=Rt+Nt*ht,b[5]=lt*Mt,b[9]=kt-Tt*ht,b[2]=-lt*_t,b[6]=ht,b[10]=lt*vt}else if(o.order==="ZYX"){const Tt=lt*Mt,Rt=lt*Pt,Nt=ht*Mt,kt=ht*Pt;b[0]=vt*Mt,b[4]=Nt*_t-Rt,b[8]=Tt*_t+kt,b[1]=vt*Pt,b[5]=kt*_t+Tt,b[9]=Rt*_t-Nt,b[2]=-_t,b[6]=ht*vt,b[10]=lt*vt}else if(o.order==="YZX"){const Tt=lt*vt,Rt=lt*_t,Nt=ht*vt,kt=ht*_t;b[0]=vt*Mt,b[4]=kt-Tt*Pt,b[8]=Nt*Pt+Rt,b[1]=Pt,b[5]=lt*Mt,b[9]=-ht*Mt,b[2]=-_t*Mt,b[6]=Rt*Pt+Nt,b[10]=Tt-kt*Pt}else if(o.order==="XZY"){const Tt=lt*vt,Rt=lt*_t,Nt=ht*vt,kt=ht*_t;b[0]=vt*Mt,b[4]=-Pt,b[8]=_t*Mt,b[1]=Tt*Pt+kt,b[5]=lt*Mt,b[9]=Rt*Pt-Nt,b[2]=Nt*Pt-Rt,b[6]=ht*Mt,b[10]=kt*Pt+Tt}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromQuaternion(o){return this.compose(em,o,vv)}lookAt(o,b,et){const tt=this.elements;return bp.subVectors(o,b),bp.lengthSq()===0&&(bp.z=1),bp.normalize(),xu.crossVectors(et,bp),xu.lengthSq()===0&&(Math.abs(et.z)===1?bp.x+=1e-4:bp.z+=1e-4,bp.normalize(),xu.crossVectors(et,bp)),xu.normalize(),k0.crossVectors(bp,xu),tt[0]=xu.x,tt[4]=k0.x,tt[8]=bp.x,tt[1]=xu.y,tt[5]=k0.y,tt[9]=bp.y,tt[2]=xu.z,tt[6]=k0.z,tt[10]=bp.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,b){const et=o.elements,tt=b.elements,ot=this.elements,lt=et[0],ht=et[4],vt=et[8],_t=et[12],Mt=et[1],Pt=et[5],Tt=et[9],Rt=et[13],Nt=et[2],kt=et[6],Kt=et[10],$t=et[14],en=et[3],ln=et[7],gn=et[11],_n=et[15],An=tt[0],Ln=tt[4],Nn=tt[8],Jn=tt[12],tr=tt[1],jn=tt[5],Cr=tt[9],Ur=tt[13],Er=tt[2],qr=tt[6],Yr=tt[10],fr=tt[14],_r=tt[3],Qr=tt[7],Mr=tt[11],Wr=tt[15];return ot[0]=lt*An+ht*tr+vt*Er+_t*_r,ot[4]=lt*Ln+ht*jn+vt*qr+_t*Qr,ot[8]=lt*Nn+ht*Cr+vt*Yr+_t*Mr,ot[12]=lt*Jn+ht*Ur+vt*fr+_t*Wr,ot[1]=Mt*An+Pt*tr+Tt*Er+Rt*_r,ot[5]=Mt*Ln+Pt*jn+Tt*qr+Rt*Qr,ot[9]=Mt*Nn+Pt*Cr+Tt*Yr+Rt*Mr,ot[13]=Mt*Jn+Pt*Ur+Tt*fr+Rt*Wr,ot[2]=Nt*An+kt*tr+Kt*Er+$t*_r,ot[6]=Nt*Ln+kt*jn+Kt*qr+$t*Qr,ot[10]=Nt*Nn+kt*Cr+Kt*Yr+$t*Mr,ot[14]=Nt*Jn+kt*Ur+Kt*fr+$t*Wr,ot[3]=en*An+ln*tr+gn*Er+_n*_r,ot[7]=en*Ln+ln*jn+gn*qr+_n*Qr,ot[11]=en*Nn+ln*Cr+gn*Yr+_n*Mr,ot[15]=en*Jn+ln*Ur+gn*fr+_n*Wr,this}multiplyScalar(o){const b=this.elements;return b[0]*=o,b[4]*=o,b[8]*=o,b[12]*=o,b[1]*=o,b[5]*=o,b[9]*=o,b[13]*=o,b[2]*=o,b[6]*=o,b[10]*=o,b[14]*=o,b[3]*=o,b[7]*=o,b[11]*=o,b[15]*=o,this}determinant(){const o=this.elements,b=o[0],et=o[4],tt=o[8],ot=o[12],lt=o[1],ht=o[5],vt=o[9],_t=o[13],Mt=o[2],Pt=o[6],Tt=o[10],Rt=o[14];return o[3]*(+ot*vt*Pt-tt*_t*Pt-ot*ht*Tt+et*_t*Tt+tt*ht*Rt-et*vt*Rt)+o[7]*(+b*vt*Rt-b*_t*Tt+ot*lt*Tt-tt*lt*Rt+tt*_t*Mt-ot*vt*Mt)+o[11]*(+b*_t*Pt-b*ht*Rt-ot*lt*Pt+et*lt*Rt+ot*ht*Mt-et*_t*Mt)+o[15]*(-tt*ht*Mt-b*vt*Pt+b*ht*Tt+tt*lt*Pt-et*lt*Tt+et*vt*Mt)}transpose(){const o=this.elements;let b;return b=o[1],o[1]=o[4],o[4]=b,b=o[2],o[2]=o[8],o[8]=b,b=o[6],o[6]=o[9],o[9]=b,b=o[3],o[3]=o[12],o[12]=b,b=o[7],o[7]=o[13],o[13]=b,b=o[11],o[11]=o[14],o[14]=b,this}setPosition(o,b,et){const tt=this.elements;return o.isVector3?(tt[12]=o.x,tt[13]=o.y,tt[14]=o.z):(tt[12]=o,tt[13]=b,tt[14]=et),this}invert(){const o=this.elements,b=o[0],et=o[1],tt=o[2],ot=o[3],lt=o[4],ht=o[5],vt=o[6],_t=o[7],Mt=o[8],Pt=o[9],Tt=o[10],Rt=o[11],Nt=o[12],kt=o[13],Kt=o[14],$t=o[15],en=Pt*Kt*_t-kt*Tt*_t+kt*vt*Rt-ht*Kt*Rt-Pt*vt*$t+ht*Tt*$t,ln=Nt*Tt*_t-Mt*Kt*_t-Nt*vt*Rt+lt*Kt*Rt+Mt*vt*$t-lt*Tt*$t,gn=Mt*kt*_t-Nt*Pt*_t+Nt*ht*Rt-lt*kt*Rt-Mt*ht*$t+lt*Pt*$t,_n=Nt*Pt*vt-Mt*kt*vt-Nt*ht*Tt+lt*kt*Tt+Mt*ht*Kt-lt*Pt*Kt,An=b*en+et*ln+tt*gn+ot*_n;if(An===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ln=1/An;return o[0]=en*Ln,o[1]=(kt*Tt*ot-Pt*Kt*ot-kt*tt*Rt+et*Kt*Rt+Pt*tt*$t-et*Tt*$t)*Ln,o[2]=(ht*Kt*ot-kt*vt*ot+kt*tt*_t-et*Kt*_t-ht*tt*$t+et*vt*$t)*Ln,o[3]=(Pt*vt*ot-ht*Tt*ot-Pt*tt*_t+et*Tt*_t+ht*tt*Rt-et*vt*Rt)*Ln,o[4]=ln*Ln,o[5]=(Mt*Kt*ot-Nt*Tt*ot+Nt*tt*Rt-b*Kt*Rt-Mt*tt*$t+b*Tt*$t)*Ln,o[6]=(Nt*vt*ot-lt*Kt*ot-Nt*tt*_t+b*Kt*_t+lt*tt*$t-b*vt*$t)*Ln,o[7]=(lt*Tt*ot-Mt*vt*ot+Mt*tt*_t-b*Tt*_t-lt*tt*Rt+b*vt*Rt)*Ln,o[8]=gn*Ln,o[9]=(Nt*Pt*ot-Mt*kt*ot-Nt*et*Rt+b*kt*Rt+Mt*et*$t-b*Pt*$t)*Ln,o[10]=(lt*kt*ot-Nt*ht*ot+Nt*et*_t-b*kt*_t-lt*et*$t+b*ht*$t)*Ln,o[11]=(Mt*ht*ot-lt*Pt*ot-Mt*et*_t+b*Pt*_t+lt*et*Rt-b*ht*Rt)*Ln,o[12]=_n*Ln,o[13]=(Mt*kt*tt-Nt*Pt*tt+Nt*et*Tt-b*kt*Tt-Mt*et*Kt+b*Pt*Kt)*Ln,o[14]=(Nt*ht*tt-lt*kt*tt-Nt*et*vt+b*kt*vt+lt*et*Kt-b*ht*Kt)*Ln,o[15]=(lt*Pt*tt-Mt*ht*tt+Mt*et*vt-b*Pt*vt-lt*et*Tt+b*ht*Tt)*Ln,this}scale(o){const b=this.elements,et=o.x,tt=o.y,ot=o.z;return b[0]*=et,b[4]*=tt,b[8]*=ot,b[1]*=et,b[5]*=tt,b[9]*=ot,b[2]*=et,b[6]*=tt,b[10]*=ot,b[3]*=et,b[7]*=tt,b[11]*=ot,this}getMaxScaleOnAxis(){const o=this.elements,b=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],et=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],tt=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(b,et,tt))}makeTranslation(o,b,et){return this.set(1,0,0,o,0,1,0,b,0,0,1,et,0,0,0,1),this}makeRotationX(o){const b=Math.cos(o),et=Math.sin(o);return this.set(1,0,0,0,0,b,-et,0,0,et,b,0,0,0,0,1),this}makeRotationY(o){const b=Math.cos(o),et=Math.sin(o);return this.set(b,0,et,0,0,1,0,0,-et,0,b,0,0,0,0,1),this}makeRotationZ(o){const b=Math.cos(o),et=Math.sin(o);return this.set(b,-et,0,0,et,b,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,b){const et=Math.cos(b),tt=Math.sin(b),ot=1-et,lt=o.x,ht=o.y,vt=o.z,_t=ot*lt,Mt=ot*ht;return this.set(_t*lt+et,_t*ht-tt*vt,_t*vt+tt*ht,0,_t*ht+tt*vt,Mt*ht+et,Mt*vt-tt*lt,0,_t*vt-tt*ht,Mt*vt+tt*lt,ot*vt*vt+et,0,0,0,0,1),this}makeScale(o,b,et){return this.set(o,0,0,0,0,b,0,0,0,0,et,0,0,0,0,1),this}makeShear(o,b,et,tt,ot,lt){return this.set(1,et,ot,0,o,1,lt,0,b,tt,1,0,0,0,0,1),this}compose(o,b,et){const tt=this.elements,ot=b._x,lt=b._y,ht=b._z,vt=b._w,_t=ot+ot,Mt=lt+lt,Pt=ht+ht,Tt=ot*_t,Rt=ot*Mt,Nt=ot*Pt,kt=lt*Mt,Kt=lt*Pt,$t=ht*Pt,en=vt*_t,ln=vt*Mt,gn=vt*Pt,_n=et.x,An=et.y,Ln=et.z;return tt[0]=(1-(kt+$t))*_n,tt[1]=(Rt+gn)*_n,tt[2]=(Nt-ln)*_n,tt[3]=0,tt[4]=(Rt-gn)*An,tt[5]=(1-(Tt+$t))*An,tt[6]=(Kt+en)*An,tt[7]=0,tt[8]=(Nt+ln)*Ln,tt[9]=(Kt-en)*Ln,tt[10]=(1-(Tt+kt))*Ln,tt[11]=0,tt[12]=o.x,tt[13]=o.y,tt[14]=o.z,tt[15]=1,this}decompose(o,b,et){const tt=this.elements;let ot=Ko.set(tt[0],tt[1],tt[2]).length();const lt=Ko.set(tt[4],tt[5],tt[6]).length(),ht=Ko.set(tt[8],tt[9],tt[10]).length();this.determinant()<0&&(ot=-ot),o.x=tt[12],o.y=tt[13],o.z=tt[14],wu.copy(this);const vt=1/ot,_t=1/lt,Mt=1/ht;return wu.elements[0]*=vt,wu.elements[1]*=vt,wu.elements[2]*=vt,wu.elements[4]*=_t,wu.elements[5]*=_t,wu.elements[6]*=_t,wu.elements[8]*=Mt,wu.elements[9]*=Mt,wu.elements[10]*=Mt,b.setFromRotationMatrix(wu),et.x=ot,et.y=lt,et.z=ht,this}makePerspective(o,b,et,tt,ot,lt){const ht=this.elements,vt=2*ot/(b-o),_t=2*ot/(et-tt),Mt=(b+o)/(b-o),Pt=(et+tt)/(et-tt),Tt=-(lt+ot)/(lt-ot),Rt=-2*lt*ot/(lt-ot);return ht[0]=vt,ht[4]=0,ht[8]=Mt,ht[12]=0,ht[1]=0,ht[5]=_t,ht[9]=Pt,ht[13]=0,ht[2]=0,ht[6]=0,ht[10]=Tt,ht[14]=Rt,ht[3]=0,ht[7]=0,ht[11]=-1,ht[15]=0,this}makeOrthographic(o,b,et,tt,ot,lt){const ht=this.elements,vt=1/(b-o),_t=1/(et-tt),Mt=1/(lt-ot),Pt=(b+o)*vt,Tt=(et+tt)*_t,Rt=(lt+ot)*Mt;return ht[0]=2*vt,ht[4]=0,ht[8]=0,ht[12]=-Pt,ht[1]=0,ht[5]=2*_t,ht[9]=0,ht[13]=-Tt,ht[2]=0,ht[6]=0,ht[10]=-2*Mt,ht[14]=-Rt,ht[3]=0,ht[7]=0,ht[11]=0,ht[15]=1,this}equals(o){const b=this.elements,et=o.elements;for(let tt=0;tt<16;tt++)if(b[tt]!==et[tt])return!1;return!0}fromArray(o,b=0){for(let et=0;et<16;et++)this.elements[et]=o[et+b];return this}toArray(o=[],b=0){const et=this.elements;return o[b]=et[0],o[b+1]=et[1],o[b+2]=et[2],o[b+3]=et[3],o[b+4]=et[4],o[b+5]=et[5],o[b+6]=et[6],o[b+7]=et[7],o[b+8]=et[8],o[b+9]=et[9],o[b+10]=et[10],o[b+11]=et[11],o[b+12]=et[12],o[b+13]=et[13],o[b+14]=et[14],o[b+15]=et[15],o}}const Ko=new xn,wu=new zs,em=new xn(0,0,0),vv=new xn(1,1,1),xu=new xn,k0=new xn,bp=new xn,Nw=new zs,Ry=new ku;class wm{constructor(o=0,b=0,et=0,tt=wm.DefaultOrder){this.isEuler=!0,this._x=o,this._y=b,this._z=et,this._order=tt}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,b,et,tt=this._order){return this._x=o,this._y=b,this._z=et,this._order=tt,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,b=this._order,et=!0){const tt=o.elements,ot=tt[0],lt=tt[4],ht=tt[8],vt=tt[1],_t=tt[5],Mt=tt[9],Pt=tt[2],Tt=tt[6],Rt=tt[10];switch(b){case"XYZ":this._y=Math.asin(Ts(ht,-1,1)),Math.abs(ht)<.9999999?(this._x=Math.atan2(-Mt,Rt),this._z=Math.atan2(-lt,ot)):(this._x=Math.atan2(Tt,_t),this._z=0);break;case"YXZ":this._x=Math.asin(-Ts(Mt,-1,1)),Math.abs(Mt)<.9999999?(this._y=Math.atan2(ht,Rt),this._z=Math.atan2(vt,_t)):(this._y=Math.atan2(-Pt,ot),this._z=0);break;case"ZXY":this._x=Math.asin(Ts(Tt,-1,1)),Math.abs(Tt)<.9999999?(this._y=Math.atan2(-Pt,Rt),this._z=Math.atan2(-lt,_t)):(this._y=0,this._z=Math.atan2(vt,ot));break;case"ZYX":this._y=Math.asin(-Ts(Pt,-1,1)),Math.abs(Pt)<.9999999?(this._x=Math.atan2(Tt,Rt),this._z=Math.atan2(vt,ot)):(this._x=0,this._z=Math.atan2(-lt,_t));break;case"YZX":this._z=Math.asin(Ts(vt,-1,1)),Math.abs(vt)<.9999999?(this._x=Math.atan2(-Mt,_t),this._y=Math.atan2(-Pt,ot)):(this._x=0,this._y=Math.atan2(ht,Rt));break;case"XZY":this._z=Math.asin(-Ts(lt,-1,1)),Math.abs(lt)<.9999999?(this._x=Math.atan2(Tt,_t),this._y=Math.atan2(ht,ot)):(this._x=Math.atan2(-Mt,Rt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}return this._order=b,et===!0&&this._onChangeCallback(),this}setFromQuaternion(o,b,et){return Nw.makeRotationFromQuaternion(o),this.setFromRotationMatrix(Nw,b,et)}setFromVector3(o,b=this._order){return this.set(o.x,o.y,o.z,b)}reorder(o){return Ry.setFromEuler(this),this.setFromQuaternion(Ry,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],b=0){return o[b]=this._x,o[b+1]=this._y,o[b+2]=this._z,o[b+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}wm.DefaultOrder="XYZ",wm.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class op{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!=0}isEnabled(o){return(this.mask&(1<<o|0))!=0}}let _v=0;const j_=new xn,Bu=new ku,Bp=new zs,$u=new xn,Vm=new xn,kA=new xn,Jv=new ku,ky=new xn(1,0,0),z_=new xn(0,1,0),Zv=new xn(0,0,1),BA={type:"added"},Fw={type:"removed"};class Zs extends js{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_v++}),this.uuid=Xu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zs.DefaultUp.clone();const o=new xn,b=new wm,et=new ku,tt=new xn(1,1,1);b._onChange(function(){et.setFromEuler(b,!1)}),et._onChange(function(){b.setFromQuaternion(et,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:b},quaternion:{configurable:!0,enumerable:!0,value:et},scale:{configurable:!0,enumerable:!0,value:tt},modelViewMatrix:{value:new zs},normalMatrix:{value:new Ru}}),this.matrix=new zs,this.matrixWorld=new zs,this.matrixAutoUpdate=Zs.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Zs.DefaultMatrixWorldAutoUpdate,this.layers=new op,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(o,b,et,tt,ot,lt){this.dispatchEvent({type:"beforeRender",renderer:o,scene:b,camera:et,geometry:tt,material:ot,group:lt})}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,b){this.quaternion.setFromAxisAngle(o,b)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,b){return Bu.setFromAxisAngle(o,b),this.quaternion.multiply(Bu),this}rotateOnWorldAxis(o,b){return Bu.setFromAxisAngle(o,b),this.quaternion.premultiply(Bu),this}rotateX(o){return this.rotateOnAxis(ky,o)}rotateY(o){return this.rotateOnAxis(z_,o)}rotateZ(o){return this.rotateOnAxis(Zv,o)}translateOnAxis(o,b){return j_.copy(o).applyQuaternion(this.quaternion),this.position.add(j_.multiplyScalar(b)),this}translateX(o){return this.translateOnAxis(ky,o)}translateY(o){return this.translateOnAxis(z_,o)}translateZ(o){return this.translateOnAxis(Zv,o)}localToWorld(o){return o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return o.applyMatrix4(Bp.copy(this.matrixWorld).invert())}lookAt(o,b,et){o.isVector3?$u.copy(o):$u.set(o,b,et);const tt=this.parent;this.updateWorldMatrix(!0,!1),Vm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bp.lookAt(Vm,$u,this.up):Bp.lookAt($u,Vm,this.up),this.quaternion.setFromRotationMatrix(Bp),tt&&(Bp.extractRotation(tt.matrixWorld),Bu.setFromRotationMatrix(Bp),this.quaternion.premultiply(Bu.invert()))}add(o){if(arguments.length>1){for(let b=0;b<arguments.length;b++)this.add(arguments[b]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(BA)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let et=0;et<arguments.length;et++)this.remove(arguments[et]);return this}const b=this.children.indexOf(o);return b!==-1&&(o.parent=null,this.children.splice(b,1),o.dispatchEvent(Fw)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const b=this.children[o];b.parent=null,b.dispatchEvent(Fw)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),Bp.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),Bp.multiply(o.parent.matrixWorld)),o.applyMatrix4(Bp),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,b){if(this[o]===b)return this;for(let et=0,tt=this.children.length;et<tt;et++){const ot=this.children[et].getObjectByProperty(o,b);if(ot!==void 0)return ot}}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vm,o,kA),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vm,Jv,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const b=this.matrixWorld.elements;return o.set(b[8],b[9],b[10]).normalize()}raycast(){}traverse(o){o(this);const b=this.children;for(let et=0,tt=b.length;et<tt;et++)b[et].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const b=this.children;for(let et=0,tt=b.length;et<tt;et++)b[et].traverseVisible(o)}traverseAncestors(o){const b=this.parent;b!==null&&(o(b),b.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const b=this.children;for(let et=0,tt=b.length;et<tt;et++){const ot=b[et];ot.matrixWorldAutoUpdate!==!0&&o!==!0||ot.updateMatrixWorld(o)}}updateWorldMatrix(o,b){const et=this.parent;if(o===!0&&et!==null&&et.matrixWorldAutoUpdate===!0&&et.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),b===!0){const tt=this.children;for(let ot=0,lt=tt.length;ot<lt;ot++){const ht=tt[ot];ht.matrixWorldAutoUpdate===!0&&ht.updateWorldMatrix(!1,!0)}}}toJSON(o){const b=o===void 0||typeof o=="string",et={};b&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},et.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const tt={};function ot(ht,vt){return ht[vt.uuid]===void 0&&(ht[vt.uuid]=vt.toJSON(o)),vt.uuid}if(tt.uuid=this.uuid,tt.type=this.type,this.name!==""&&(tt.name=this.name),this.castShadow===!0&&(tt.castShadow=!0),this.receiveShadow===!0&&(tt.receiveShadow=!0),this.visible===!1&&(tt.visible=!1),this.frustumCulled===!1&&(tt.frustumCulled=!1),this.renderOrder!==0&&(tt.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(tt.userData=this.userData),tt.layers=this.layers.mask,tt.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(tt.matrixAutoUpdate=!1),this.isInstancedMesh&&(tt.type="InstancedMesh",tt.count=this.count,tt.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(tt.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?tt.background=this.background.toJSON():this.background.isTexture&&(tt.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(tt.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){tt.geometry=ot(o.geometries,this.geometry);const ht=this.geometry.parameters;if(ht!==void 0&&ht.shapes!==void 0){const vt=ht.shapes;if(Array.isArray(vt))for(let _t=0,Mt=vt.length;_t<Mt;_t++){const Pt=vt[_t];ot(o.shapes,Pt)}else ot(o.shapes,vt)}}if(this.isSkinnedMesh&&(tt.bindMode=this.bindMode,tt.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(ot(o.skeletons,this.skeleton),tt.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const ht=[];for(let vt=0,_t=this.material.length;vt<_t;vt++)ht.push(ot(o.materials,this.material[vt]));tt.material=ht}else tt.material=ot(o.materials,this.material);if(this.children.length>0){tt.children=[];for(let ht=0;ht<this.children.length;ht++)tt.children.push(this.children[ht].toJSON(o).object)}if(this.animations.length>0){tt.animations=[];for(let ht=0;ht<this.animations.length;ht++){const vt=this.animations[ht];tt.animations.push(ot(o.animations,vt))}}if(b){const ht=lt(o.geometries),vt=lt(o.materials),_t=lt(o.textures),Mt=lt(o.images),Pt=lt(o.shapes),Tt=lt(o.skeletons),Rt=lt(o.animations),Nt=lt(o.nodes);ht.length>0&&(et.geometries=ht),vt.length>0&&(et.materials=vt),_t.length>0&&(et.textures=_t),Mt.length>0&&(et.images=Mt),Pt.length>0&&(et.shapes=Pt),Tt.length>0&&(et.skeletons=Tt),Rt.length>0&&(et.animations=Rt),Nt.length>0&&(et.nodes=Nt)}return et.object=tt,et;function lt(ht){const vt=[];for(const _t in ht){const Mt=ht[_t];delete Mt.metadata,vt.push(Mt)}return vt}}clone(o){return new this.constructor().copy(this,o)}copy(o,b=!0){this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.userData={};for(const[et,tt]of Object.entries(o.userData))this.userData[et]=!tt||tt&&(tt.isTexture||tt.isObject3D)?tt:JSON.parse(JSON.stringify(tt));if(b===!0)for(let et=0;et<o.children.length;et++){const tt=o.children[et];this.add(tt.clone())}return this}}Zs.DefaultUp=new xn(0,1,0),Zs.DefaultMatrixAutoUpdate=!0,Zs.DefaultMatrixWorldAutoUpdate=!0;const tm=new xn,Qm=new xn,ap=new xn,xm=new xn,nm=new xn,rm=new xn,OA=new xn,B0=new xn,LA=new xn,e_=new xn;class Ou{constructor(o=new xn,b=new xn,et=new xn){this.a=o,this.b=b,this.c=et}static getNormal(o,b,et,tt){tt.subVectors(et,b),tm.subVectors(o,b),tt.cross(tm);const ot=tt.lengthSq();return ot>0?tt.multiplyScalar(1/Math.sqrt(ot)):tt.set(0,0,0)}static getBarycoord(o,b,et,tt,ot){tm.subVectors(tt,b),Qm.subVectors(et,b),ap.subVectors(o,b);const lt=tm.dot(tm),ht=tm.dot(Qm),vt=tm.dot(ap),_t=Qm.dot(Qm),Mt=Qm.dot(ap),Pt=lt*_t-ht*ht;if(Pt===0)return ot.set(-2,-1,-1);const Tt=1/Pt,Rt=(_t*vt-ht*Mt)*Tt,Nt=(lt*Mt-ht*vt)*Tt;return ot.set(1-Rt-Nt,Nt,Rt)}static containsPoint(o,b,et,tt){return this.getBarycoord(o,b,et,tt,xm),xm.x>=0&&xm.y>=0&&xm.x+xm.y<=1}static getUV(o,b,et,tt,ot,lt,ht,vt){return this.getBarycoord(o,b,et,tt,xm),vt.set(0,0),vt.addScaledVector(ot,xm.x),vt.addScaledVector(lt,xm.y),vt.addScaledVector(ht,xm.z),vt}static isFrontFacing(o,b,et,tt){return tm.subVectors(et,b),Qm.subVectors(o,b),tm.cross(Qm).dot(tt)<0}set(o,b,et){return this.a.copy(o),this.b.copy(b),this.c.copy(et),this}setFromPointsAndIndices(o,b,et,tt){return this.a.copy(o[b]),this.b.copy(o[et]),this.c.copy(o[tt]),this}setFromAttributeAndIndices(o,b,et,tt){return this.a.fromBufferAttribute(o,b),this.b.fromBufferAttribute(o,et),this.c.fromBufferAttribute(o,tt),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return tm.subVectors(this.c,this.b),Qm.subVectors(this.a,this.b),.5*tm.cross(Qm).length()}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return Ou.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,b){return Ou.getBarycoord(o,this.a,this.b,this.c,b)}getUV(o,b,et,tt,ot){return Ou.getUV(o,this.a,this.b,this.c,b,et,tt,ot)}containsPoint(o){return Ou.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return Ou.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,b){const et=this.a,tt=this.b,ot=this.c;let lt,ht;nm.subVectors(tt,et),rm.subVectors(ot,et),B0.subVectors(o,et);const vt=nm.dot(B0),_t=rm.dot(B0);if(vt<=0&&_t<=0)return b.copy(et);LA.subVectors(o,tt);const Mt=nm.dot(LA),Pt=rm.dot(LA);if(Mt>=0&&Pt<=Mt)return b.copy(tt);const Tt=vt*Pt-Mt*_t;if(Tt<=0&&vt>=0&&Mt<=0)return lt=vt/(vt-Mt),b.copy(et).addScaledVector(nm,lt);e_.subVectors(o,ot);const Rt=nm.dot(e_),Nt=rm.dot(e_);if(Nt>=0&&Rt<=Nt)return b.copy(ot);const kt=Rt*_t-vt*Nt;if(kt<=0&&_t>=0&&Nt<=0)return ht=_t/(_t-Nt),b.copy(et).addScaledVector(rm,ht);const Kt=Mt*Nt-Rt*Pt;if(Kt<=0&&Pt-Mt>=0&&Rt-Nt>=0)return OA.subVectors(ot,tt),ht=(Pt-Mt)/(Pt-Mt+(Rt-Nt)),b.copy(tt).addScaledVector(OA,ht);const $t=1/(Kt+kt+Tt);return lt=kt*$t,ht=Tt*$t,b.copy(et).addScaledVector(nm,lt).addScaledVector(rm,ht)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let E1=0;class Lu extends js{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:E1++}),this.uuid=Xu(),this.name="",this.type="Material",this.blending=Ut,this.side=Jt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Zn,this.blendDst=wr,this.blendEquation=zt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=pn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Um,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wo,this.stencilZFail=Wo,this.stencilZPass=Wo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const b in o){const et=o[b];if(et===void 0){console.warn("THREE.Material: '"+b+"' parameter is undefined.");continue}const tt=this[b];tt!==void 0&&(tt&&tt.isColor?tt.set(et):tt&&tt.isVector3&&et&&et.isVector3?tt.copy(et):this[b]=et)}}toJSON(o){const b=o===void 0||typeof o=="string";b&&(o={textures:{},images:{}});const et={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function tt(ot){const lt=[];for(const ht in ot){const vt=ot[ht];delete vt.metadata,lt.push(vt)}return lt}if(et.uuid=this.uuid,et.type=this.type,this.name!==""&&(et.name=this.name),this.color&&this.color.isColor&&(et.color=this.color.getHex()),this.roughness!==void 0&&(et.roughness=this.roughness),this.metalness!==void 0&&(et.metalness=this.metalness),this.sheen!==void 0&&(et.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(et.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(et.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(et.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(et.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(et.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(et.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(et.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(et.shininess=this.shininess),this.clearcoat!==void 0&&(et.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(et.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(et.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(et.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(et.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,et.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(et.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(et.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(et.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(et.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(et.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&(et.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&(et.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&(et.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&(et.lightMap=this.lightMap.toJSON(o).uuid,et.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(et.aoMap=this.aoMap.toJSON(o).uuid,et.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(et.bumpMap=this.bumpMap.toJSON(o).uuid,et.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(et.normalMap=this.normalMap.toJSON(o).uuid,et.normalMapType=this.normalMapType,et.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(et.displacementMap=this.displacementMap.toJSON(o).uuid,et.displacementScale=this.displacementScale,et.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(et.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(et.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(et.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&(et.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(et.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(et.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&(et.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&(et.combine=this.combine)),this.envMapIntensity!==void 0&&(et.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(et.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(et.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(et.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&(et.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(et.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&(et.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(et.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&(et.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(et.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(et.size=this.size),this.shadowSide!==null&&(et.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(et.sizeAttenuation=this.sizeAttenuation),this.blending!==Ut&&(et.blending=this.blending),this.side!==Jt&&(et.side=this.side),this.vertexColors&&(et.vertexColors=!0),this.opacity<1&&(et.opacity=this.opacity),this.transparent===!0&&(et.transparent=this.transparent),et.depthFunc=this.depthFunc,et.depthTest=this.depthTest,et.depthWrite=this.depthWrite,et.colorWrite=this.colorWrite,et.stencilWrite=this.stencilWrite,et.stencilWriteMask=this.stencilWriteMask,et.stencilFunc=this.stencilFunc,et.stencilRef=this.stencilRef,et.stencilFuncMask=this.stencilFuncMask,et.stencilFail=this.stencilFail,et.stencilZFail=this.stencilZFail,et.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(et.rotation=this.rotation),this.polygonOffset===!0&&(et.polygonOffset=!0),this.polygonOffsetFactor!==0&&(et.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(et.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(et.linewidth=this.linewidth),this.dashSize!==void 0&&(et.dashSize=this.dashSize),this.gapSize!==void 0&&(et.gapSize=this.gapSize),this.scale!==void 0&&(et.scale=this.scale),this.dithering===!0&&(et.dithering=!0),this.alphaTest>0&&(et.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(et.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(et.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(et.wireframe=this.wireframe),this.wireframeLinewidth>1&&(et.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(et.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(et.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(et.flatShading=this.flatShading),this.visible===!1&&(et.visible=!1),this.toneMapped===!1&&(et.toneMapped=!1),this.fog===!1&&(et.fog=!1),JSON.stringify(this.userData)!=="{}"&&(et.userData=this.userData),b){const ot=tt(o.textures),lt=tt(o.images);ot.length>0&&(et.textures=ot),lt.length>0&&(et.images=lt)}return et}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const b=o.clippingPlanes;let et=null;if(b!==null){const tt=b.length;et=new Array(tt);for(let ot=0;ot!==tt;++ot)et[ot]=b[ot].clone()}this.clippingPlanes=et,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData={};for(const[tt,ot]of Object.entries(o.userData))this.userData[tt]=!ot||ot&&(ot.isTexture||ot.isObject3D)?ot:JSON.parse(JSON.stringify(ot));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}class Gm extends Lu{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new as(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ds,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const Zl=new xn,im=new Lr;class ga{constructor(o,b,et){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=b,this.count=o!==void 0?o.length/b:0,this.normalized=et===!0,this.usage=P_,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,b,et){o*=this.itemSize,et*=b.itemSize;for(let tt=0,ot=this.itemSize;tt<ot;tt++)this.array[o+tt]=b.array[et+tt];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let b=0,et=this.count;b<et;b++)im.fromBufferAttribute(this,b),im.applyMatrix3(o),this.setXY(b,im.x,im.y);else if(this.itemSize===3)for(let b=0,et=this.count;b<et;b++)Zl.fromBufferAttribute(this,b),Zl.applyMatrix3(o),this.setXYZ(b,Zl.x,Zl.y,Zl.z);return this}applyMatrix4(o){for(let b=0,et=this.count;b<et;b++)Zl.fromBufferAttribute(this,b),Zl.applyMatrix4(o),this.setXYZ(b,Zl.x,Zl.y,Zl.z);return this}applyNormalMatrix(o){for(let b=0,et=this.count;b<et;b++)Zl.fromBufferAttribute(this,b),Zl.applyNormalMatrix(o),this.setXYZ(b,Zl.x,Zl.y,Zl.z);return this}transformDirection(o){for(let b=0,et=this.count;b<et;b++)Zl.fromBufferAttribute(this,b),Zl.transformDirection(o),this.setXYZ(b,Zl.x,Zl.y,Zl.z);return this}set(o,b=0){return this.array.set(o,b),this}getX(o){let b=this.array[o*this.itemSize];return this.normalized&&(b=pv(b,this.array)),b}setX(o,b){return this.normalized&&(b=$a(b,this.array)),this.array[o*this.itemSize]=b,this}getY(o){let b=this.array[o*this.itemSize+1];return this.normalized&&(b=pv(b,this.array)),b}setY(o,b){return this.normalized&&(b=$a(b,this.array)),this.array[o*this.itemSize+1]=b,this}getZ(o){let b=this.array[o*this.itemSize+2];return this.normalized&&(b=pv(b,this.array)),b}setZ(o,b){return this.normalized&&(b=$a(b,this.array)),this.array[o*this.itemSize+2]=b,this}getW(o){let b=this.array[o*this.itemSize+3];return this.normalized&&(b=pv(b,this.array)),b}setW(o,b){return this.normalized&&(b=$a(b,this.array)),this.array[o*this.itemSize+3]=b,this}setXY(o,b,et){return o*=this.itemSize,this.normalized&&(b=$a(b,this.array),et=$a(et,this.array)),this.array[o+0]=b,this.array[o+1]=et,this}setXYZ(o,b,et,tt){return o*=this.itemSize,this.normalized&&(b=$a(b,this.array),et=$a(et,this.array),tt=$a(tt,this.array)),this.array[o+0]=b,this.array[o+1]=et,this.array[o+2]=tt,this}setXYZW(o,b,et,tt,ot){return o*=this.itemSize,this.normalized&&(b=$a(b,this.array),et=$a(et,this.array),tt=$a(tt,this.array),ot=$a(ot,this.array)),this.array[o+0]=b,this.array[o+1]=et,this.array[o+2]=tt,this.array[o+3]=ot,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==P_&&(o.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class O0 extends ga{constructor(o,b,et){super(new Int8Array(o),b,et)}}class sm extends ga{constructor(o,b,et){super(new Uint8Array(o),b,et)}}class L0 extends ga{constructor(o,b,et){super(new Uint8ClampedArray(o),b,et)}}class lp extends ga{constructor(o,b,et){super(new Int16Array(o),b,et)}}class Vl extends ga{constructor(o,b,et){super(new Uint16Array(o),b,et)}}class Uw extends ga{constructor(o,b,et){super(new Int32Array(o),b,et)}}class bt extends ga{constructor(o,b,et){super(new Uint32Array(o),b,et)}}class at extends ga{constructor(o,b,et){super(new Uint16Array(o),b,et),this.isFloat16BufferAttribute=!0}}class ft extends ga{constructor(o,b,et){super(new Float32Array(o),b,et)}}class Dt extends ga{constructor(o,b,et){super(new Float64Array(o),b,et)}}let tn=0;const Sn=new zs,Bn=new Zs,pr=new xn,Or=new N_,As=new N_,Ds=new xn;class ms extends js{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:tn++}),this.uuid=Xu(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(x1(o)?bt:Vl)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,b){return this.attributes[o]=b,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,b,et=0){this.groups.push({start:o,count:b,materialIndex:et})}clearGroups(){this.groups=[]}setDrawRange(o,b){this.drawRange.start=o,this.drawRange.count=b}applyMatrix4(o){const b=this.attributes.position;b!==void 0&&(b.applyMatrix4(o),b.needsUpdate=!0);const et=this.attributes.normal;if(et!==void 0){const ot=new Ru().getNormalMatrix(o);et.applyNormalMatrix(ot),et.needsUpdate=!0}const tt=this.attributes.tangent;return tt!==void 0&&(tt.transformDirection(o),tt.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return Sn.makeRotationFromQuaternion(o),this.applyMatrix4(Sn),this}rotateX(o){return Sn.makeRotationX(o),this.applyMatrix4(Sn),this}rotateY(o){return Sn.makeRotationY(o),this.applyMatrix4(Sn),this}rotateZ(o){return Sn.makeRotationZ(o),this.applyMatrix4(Sn),this}translate(o,b,et){return Sn.makeTranslation(o,b,et),this.applyMatrix4(Sn),this}scale(o,b,et){return Sn.makeScale(o,b,et),this.applyMatrix4(Sn),this}lookAt(o){return Bn.lookAt(o),Bn.updateMatrix(),this.applyMatrix4(Bn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pr).negate(),this.translate(pr.x,pr.y,pr.z),this}setFromPoints(o){const b=[];for(let et=0,tt=o.length;et<tt;et++){const ot=o[et];b.push(ot.x,ot.y,ot.z||0)}return this.setAttribute("position",new ft(b,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new N_);const o=this.attributes.position,b=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new xn(-1/0,-1/0,-1/0),new xn(1/0,1/0,1/0));if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),b)for(let et=0,tt=b.length;et<tt;et++){const ot=b[et];Or.setFromBufferAttribute(ot),this.morphTargetsRelative?(Ds.addVectors(this.boundingBox.min,Or.min),this.boundingBox.expandByPoint(Ds),Ds.addVectors(this.boundingBox.max,Or.max),this.boundingBox.expandByPoint(Ds)):(this.boundingBox.expandByPoint(Or.min),this.boundingBox.expandByPoint(Or.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _f);const o=this.attributes.position,b=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new xn,1/0);if(o){const et=this.boundingSphere.center;if(Or.setFromBufferAttribute(o),b)for(let ot=0,lt=b.length;ot<lt;ot++){const ht=b[ot];As.setFromBufferAttribute(ht),this.morphTargetsRelative?(Ds.addVectors(Or.min,As.min),Or.expandByPoint(Ds),Ds.addVectors(Or.max,As.max),Or.expandByPoint(Ds)):(Or.expandByPoint(As.min),Or.expandByPoint(As.max))}Or.getCenter(et);let tt=0;for(let ot=0,lt=o.count;ot<lt;ot++)Ds.fromBufferAttribute(o,ot),tt=Math.max(tt,et.distanceToSquared(Ds));if(b)for(let ot=0,lt=b.length;ot<lt;ot++){const ht=b[ot],vt=this.morphTargetsRelative;for(let _t=0,Mt=ht.count;_t<Mt;_t++)Ds.fromBufferAttribute(ht,_t),vt&&(pr.fromBufferAttribute(o,_t),Ds.add(pr)),tt=Math.max(tt,et.distanceToSquared(Ds))}this.boundingSphere.radius=Math.sqrt(tt),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,b=this.attributes;if(o===null||b.position===void 0||b.normal===void 0||b.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const et=o.array,tt=b.position.array,ot=b.normal.array,lt=b.uv.array,ht=tt.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ga(new Float32Array(4*ht),4));const vt=this.getAttribute("tangent").array,_t=[],Mt=[];for(let tr=0;tr<ht;tr++)_t[tr]=new xn,Mt[tr]=new xn;const Pt=new xn,Tt=new xn,Rt=new xn,Nt=new Lr,kt=new Lr,Kt=new Lr,$t=new xn,en=new xn;function ln(tr,jn,Cr){Pt.fromArray(tt,3*tr),Tt.fromArray(tt,3*jn),Rt.fromArray(tt,3*Cr),Nt.fromArray(lt,2*tr),kt.fromArray(lt,2*jn),Kt.fromArray(lt,2*Cr),Tt.sub(Pt),Rt.sub(Pt),kt.sub(Nt),Kt.sub(Nt);const Ur=1/(kt.x*Kt.y-Kt.x*kt.y);isFinite(Ur)&&($t.copy(Tt).multiplyScalar(Kt.y).addScaledVector(Rt,-kt.y).multiplyScalar(Ur),en.copy(Rt).multiplyScalar(kt.x).addScaledVector(Tt,-Kt.x).multiplyScalar(Ur),_t[tr].add($t),_t[jn].add($t),_t[Cr].add($t),Mt[tr].add(en),Mt[jn].add(en),Mt[Cr].add(en))}let gn=this.groups;gn.length===0&&(gn=[{start:0,count:et.length}]);for(let tr=0,jn=gn.length;tr<jn;++tr){const Cr=gn[tr],Ur=Cr.start;for(let Er=Ur,qr=Ur+Cr.count;Er<qr;Er+=3)ln(et[Er+0],et[Er+1],et[Er+2])}const _n=new xn,An=new xn,Ln=new xn,Nn=new xn;function Jn(tr){Ln.fromArray(ot,3*tr),Nn.copy(Ln);const jn=_t[tr];_n.copy(jn),_n.sub(Ln.multiplyScalar(Ln.dot(jn))).normalize(),An.crossVectors(Nn,jn);const Cr=An.dot(Mt[tr])<0?-1:1;vt[4*tr]=_n.x,vt[4*tr+1]=_n.y,vt[4*tr+2]=_n.z,vt[4*tr+3]=Cr}for(let tr=0,jn=gn.length;tr<jn;++tr){const Cr=gn[tr],Ur=Cr.start;for(let Er=Ur,qr=Ur+Cr.count;Er<qr;Er+=3)Jn(et[Er+0]),Jn(et[Er+1]),Jn(et[Er+2])}}computeVertexNormals(){const o=this.index,b=this.getAttribute("position");if(b!==void 0){let et=this.getAttribute("normal");if(et===void 0)et=new ga(new Float32Array(3*b.count),3),this.setAttribute("normal",et);else for(let Tt=0,Rt=et.count;Tt<Rt;Tt++)et.setXYZ(Tt,0,0,0);const tt=new xn,ot=new xn,lt=new xn,ht=new xn,vt=new xn,_t=new xn,Mt=new xn,Pt=new xn;if(o)for(let Tt=0,Rt=o.count;Tt<Rt;Tt+=3){const Nt=o.getX(Tt+0),kt=o.getX(Tt+1),Kt=o.getX(Tt+2);tt.fromBufferAttribute(b,Nt),ot.fromBufferAttribute(b,kt),lt.fromBufferAttribute(b,Kt),Mt.subVectors(lt,ot),Pt.subVectors(tt,ot),Mt.cross(Pt),ht.fromBufferAttribute(et,Nt),vt.fromBufferAttribute(et,kt),_t.fromBufferAttribute(et,Kt),ht.add(Mt),vt.add(Mt),_t.add(Mt),et.setXYZ(Nt,ht.x,ht.y,ht.z),et.setXYZ(kt,vt.x,vt.y,vt.z),et.setXYZ(Kt,_t.x,_t.y,_t.z)}else for(let Tt=0,Rt=b.count;Tt<Rt;Tt+=3)tt.fromBufferAttribute(b,Tt+0),ot.fromBufferAttribute(b,Tt+1),lt.fromBufferAttribute(b,Tt+2),Mt.subVectors(lt,ot),Pt.subVectors(tt,ot),Mt.cross(Pt),et.setXYZ(Tt+0,Mt.x,Mt.y,Mt.z),et.setXYZ(Tt+1,Mt.x,Mt.y,Mt.z),et.setXYZ(Tt+2,Mt.x,Mt.y,Mt.z);this.normalizeNormals(),et.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let b=0,et=o.count;b<et;b++)Ds.fromBufferAttribute(o,b),Ds.normalize(),o.setXYZ(b,Ds.x,Ds.y,Ds.z)}toNonIndexed(){function o(ht,vt){const _t=ht.array,Mt=ht.itemSize,Pt=ht.normalized,Tt=new _t.constructor(vt.length*Mt);let Rt=0,Nt=0;for(let kt=0,Kt=vt.length;kt<Kt;kt++){Rt=ht.isInterleavedBufferAttribute?vt[kt]*ht.data.stride+ht.offset:vt[kt]*Mt;for(let $t=0;$t<Mt;$t++)Tt[Nt++]=_t[Rt++]}return new ga(Tt,Mt,Pt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const b=new ms,et=this.index.array,tt=this.attributes;for(const ht in tt){const vt=o(tt[ht],et);b.setAttribute(ht,vt)}const ot=this.morphAttributes;for(const ht in ot){const vt=[],_t=ot[ht];for(let Mt=0,Pt=_t.length;Mt<Pt;Mt++){const Tt=o(_t[Mt],et);vt.push(Tt)}b.morphAttributes[ht]=vt}b.morphTargetsRelative=this.morphTargetsRelative;const lt=this.groups;for(let ht=0,vt=lt.length;ht<vt;ht++){const _t=lt[ht];b.addGroup(_t.start,_t.count,_t.materialIndex)}return b}toJSON(){const o={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const vt=this.parameters;for(const _t in vt)vt[_t]!==void 0&&(o[_t]=vt[_t]);return o}o.data={attributes:{}};const b=this.index;b!==null&&(o.data.index={type:b.array.constructor.name,array:Array.prototype.slice.call(b.array)});const et=this.attributes;for(const vt in et){const _t=et[vt];o.data.attributes[vt]=_t.toJSON(o.data)}const tt={};let ot=!1;for(const vt in this.morphAttributes){const _t=this.morphAttributes[vt],Mt=[];for(let Pt=0,Tt=_t.length;Pt<Tt;Pt++){const Rt=_t[Pt];Mt.push(Rt.toJSON(o.data))}Mt.length>0&&(tt[vt]=Mt,ot=!0)}ot&&(o.data.morphAttributes=tt,o.data.morphTargetsRelative=this.morphTargetsRelative);const lt=this.groups;lt.length>0&&(o.data.groups=JSON.parse(JSON.stringify(lt)));const ht=this.boundingSphere;return ht!==null&&(o.data.boundingSphere={center:ht.center.toArray(),radius:ht.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const b={};this.name=o.name;const et=o.index;et!==null&&this.setIndex(et.clone(b));const tt=o.attributes;for(const _t in tt){const Mt=tt[_t];this.setAttribute(_t,Mt.clone(b))}const ot=o.morphAttributes;for(const _t in ot){const Mt=[],Pt=ot[_t];for(let Tt=0,Rt=Pt.length;Tt<Rt;Tt++)Mt.push(Pt[Tt].clone(b));this.morphAttributes[_t]=Mt}this.morphTargetsRelative=o.morphTargetsRelative;const lt=o.groups;for(let _t=0,Mt=lt.length;_t<Mt;_t++){const Pt=lt[_t];this.addGroup(Pt.start,Pt.count,Pt.materialIndex)}const ht=o.boundingBox;ht!==null&&(this.boundingBox=ht.clone());const vt=o.boundingSphere;return vt!==null&&(this.boundingSphere=vt.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,o.parameters!==void 0&&(this.parameters=Object.assign({},o.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Il=new zs,ru=new $v,om=new _f,Ju=new xn,Op=new xn,bm=new xn,V_=new xn,t_=new xn,N0=new xn,By=new xn,Oy=new xn,Ly=new xn,NA=new Lr,S1=new Lr,C1=new Lr,jw=new xn,Ny=new xn;class Nu extends Zs{constructor(o=new ms,b=new Gm){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=b,this.updateMorphTargets()}copy(o,b){return super.copy(o,b),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,b=Object.keys(o);if(b.length>0){const et=o[b[0]];if(et!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let tt=0,ot=et.length;tt<ot;tt++){const lt=et[tt].name||String(tt);this.morphTargetInfluences.push(0),this.morphTargetDictionary[lt]=tt}}}}raycast(o,b){const et=this.geometry,tt=this.material,ot=this.matrixWorld;if(tt===void 0||(et.boundingSphere===null&&et.computeBoundingSphere(),om.copy(et.boundingSphere),om.applyMatrix4(ot),o.ray.intersectsSphere(om)===!1)||(Il.copy(ot).invert(),ru.copy(o.ray).applyMatrix4(Il),et.boundingBox!==null&&ru.intersectsBox(et.boundingBox)===!1))return;let lt;const ht=et.index,vt=et.attributes.position,_t=et.morphAttributes.position,Mt=et.morphTargetsRelative,Pt=et.attributes.uv,Tt=et.attributes.uv2,Rt=et.groups,Nt=et.drawRange;if(ht!==null)if(Array.isArray(tt))for(let kt=0,Kt=Rt.length;kt<Kt;kt++){const $t=Rt[kt],en=tt[$t.materialIndex];for(let ln=Math.max($t.start,Nt.start),gn=Math.min(ht.count,Math.min($t.start+$t.count,Nt.start+Nt.count));ln<gn;ln+=3){const _n=ht.getX(ln),An=ht.getX(ln+1),Ln=ht.getX(ln+2);lt=zw(this,en,o,ru,vt,_t,Mt,Pt,Tt,_n,An,Ln),lt&&(lt.faceIndex=Math.floor(ln/3),lt.face.materialIndex=$t.materialIndex,b.push(lt))}}else for(let kt=Math.max(0,Nt.start),Kt=Math.min(ht.count,Nt.start+Nt.count);kt<Kt;kt+=3){const $t=ht.getX(kt),en=ht.getX(kt+1),ln=ht.getX(kt+2);lt=zw(this,tt,o,ru,vt,_t,Mt,Pt,Tt,$t,en,ln),lt&&(lt.faceIndex=Math.floor(kt/3),b.push(lt))}else if(vt!==void 0)if(Array.isArray(tt))for(let kt=0,Kt=Rt.length;kt<Kt;kt++){const $t=Rt[kt],en=tt[$t.materialIndex];for(let ln=Math.max($t.start,Nt.start),gn=Math.min(vt.count,Math.min($t.start+$t.count,Nt.start+Nt.count));ln<gn;ln+=3)lt=zw(this,en,o,ru,vt,_t,Mt,Pt,Tt,ln,ln+1,ln+2),lt&&(lt.faceIndex=Math.floor(ln/3),lt.face.materialIndex=$t.materialIndex,b.push(lt))}else for(let kt=Math.max(0,Nt.start),Kt=Math.min(vt.count,Nt.start+Nt.count);kt<Kt;kt+=3)lt=zw(this,tt,o,ru,vt,_t,Mt,Pt,Tt,kt,kt+1,kt+2),lt&&(lt.faceIndex=Math.floor(kt/3),b.push(lt))}}function zw(dt,o,b,et,tt,ot,lt,ht,vt,_t,Mt,Pt){Ju.fromBufferAttribute(tt,_t),Op.fromBufferAttribute(tt,Mt),bm.fromBufferAttribute(tt,Pt);const Tt=dt.morphTargetInfluences;if(ot&&Tt){By.set(0,0,0),Oy.set(0,0,0),Ly.set(0,0,0);for(let Nt=0,kt=ot.length;Nt<kt;Nt++){const Kt=Tt[Nt],$t=ot[Nt];Kt!==0&&(V_.fromBufferAttribute($t,_t),t_.fromBufferAttribute($t,Mt),N0.fromBufferAttribute($t,Pt),lt?(By.addScaledVector(V_,Kt),Oy.addScaledVector(t_,Kt),Ly.addScaledVector(N0,Kt)):(By.addScaledVector(V_.sub(Ju),Kt),Oy.addScaledVector(t_.sub(Op),Kt),Ly.addScaledVector(N0.sub(bm),Kt)))}Ju.add(By),Op.add(Oy),bm.add(Ly)}dt.isSkinnedMesh&&(dt.boneTransform(_t,Ju),dt.boneTransform(Mt,Op),dt.boneTransform(Pt,bm));const Rt=function(Nt,kt,Kt,$t,en,ln,gn,_n){let An;if(An=kt.side===jt?$t.intersectTriangle(gn,ln,en,!0,_n):$t.intersectTriangle(en,ln,gn,kt.side!==sn,_n),An===null)return null;Ny.copy(_n),Ny.applyMatrix4(Nt.matrixWorld);const Ln=Kt.ray.origin.distanceTo(Ny);return Ln<Kt.near||Ln>Kt.far?null:{distance:Ln,point:Ny.clone(),object:Nt}}(dt,o,b,et,Ju,Op,bm,jw);if(Rt){ht&&(NA.fromBufferAttribute(ht,_t),S1.fromBufferAttribute(ht,Mt),C1.fromBufferAttribute(ht,Pt),Rt.uv=Ou.getUV(jw,Ju,Op,bm,NA,S1,C1,new Lr)),vt&&(NA.fromBufferAttribute(vt,_t),S1.fromBufferAttribute(vt,Mt),C1.fromBufferAttribute(vt,Pt),Rt.uv2=Ou.getUV(jw,Ju,Op,bm,NA,S1,C1,new Lr));const Nt={a:_t,b:Mt,c:Pt,normal:new xn,materialIndex:0};Ou.getNormal(Ju,Op,bm,Nt.normal),Rt.face=Nt}return Rt}class Hm extends ms{constructor(o=1,b=1,et=1,tt=1,ot=1,lt=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:b,depth:et,widthSegments:tt,heightSegments:ot,depthSegments:lt};const ht=this;tt=Math.floor(tt),ot=Math.floor(ot),lt=Math.floor(lt);const vt=[],_t=[],Mt=[],Pt=[];let Tt=0,Rt=0;function Nt(kt,Kt,$t,en,ln,gn,_n,An,Ln,Nn,Jn){const tr=gn/Ln,jn=_n/Nn,Cr=gn/2,Ur=_n/2,Er=An/2,qr=Ln+1,Yr=Nn+1;let fr=0,_r=0;const Qr=new xn;for(let Mr=0;Mr<Yr;Mr++){const Wr=Mr*jn-Ur;for(let ws=0;ws<qr;ws++){const fo=ws*tr-Cr;Qr[kt]=fo*en,Qr[Kt]=Wr*ln,Qr[$t]=Er,_t.push(Qr.x,Qr.y,Qr.z),Qr[kt]=0,Qr[Kt]=0,Qr[$t]=An>0?1:-1,Mt.push(Qr.x,Qr.y,Qr.z),Pt.push(ws/Ln),Pt.push(1-Mr/Nn),fr+=1}}for(let Mr=0;Mr<Nn;Mr++)for(let Wr=0;Wr<Ln;Wr++){const ws=Tt+Wr+qr*Mr,fo=Tt+Wr+qr*(Mr+1),Es=Tt+(Wr+1)+qr*(Mr+1),so=Tt+(Wr+1)+qr*Mr;vt.push(ws,fo,so),vt.push(fo,Es,so),_r+=6}ht.addGroup(Rt,_r,Jn),Rt+=_r,Tt+=fr}Nt("z","y","x",-1,-1,et,b,o,lt,ot,0),Nt("z","y","x",1,-1,et,b,-o,lt,ot,1),Nt("x","z","y",1,1,o,et,b,tt,lt,2),Nt("x","z","y",1,-1,o,et,-b,tt,lt,3),Nt("x","y","z",1,-1,o,b,et,tt,ot,4),Nt("x","y","z",-1,-1,o,b,-et,tt,ot,5),this.setIndex(vt),this.setAttribute("position",new ft(_t,3)),this.setAttribute("normal",new ft(Mt,3)),this.setAttribute("uv",new ft(Pt,2))}static fromJSON(o){return new Hm(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function F0(dt){const o={};for(const b in dt){o[b]={};for(const et in dt[b]){const tt=dt[b][et];tt&&(tt.isColor||tt.isMatrix3||tt.isMatrix4||tt.isVector2||tt.isVector3||tt.isVector4||tt.isTexture||tt.isQuaternion)?o[b][et]=tt.clone():Array.isArray(tt)?o[b][et]=tt.slice():o[b][et]=tt}}return o}function Ep(dt){const o={};for(let b=0;b<dt.length;b++){const et=F0(dt[b]);for(const tt in et)o[tt]=et[tt]}return o}const OM={clone:F0,merge:Ep};class yv extends Lu{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=F0(o.uniforms),this.uniformsGroups=function(b){const et=[];for(let tt=0;tt<b.length;tt++)et.push(b[tt].clone());return et}(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const b=super.toJSON(o);b.glslVersion=this.glslVersion,b.uniforms={};for(const tt in this.uniforms){const ot=this.uniforms[tt].value;ot&&ot.isTexture?b.uniforms[tt]={type:"t",value:ot.toJSON(o).uuid}:ot&&ot.isColor?b.uniforms[tt]={type:"c",value:ot.getHex()}:ot&&ot.isVector2?b.uniforms[tt]={type:"v2",value:ot.toArray()}:ot&&ot.isVector3?b.uniforms[tt]={type:"v3",value:ot.toArray()}:ot&&ot.isVector4?b.uniforms[tt]={type:"v4",value:ot.toArray()}:ot&&ot.isMatrix3?b.uniforms[tt]={type:"m3",value:ot.toArray()}:ot&&ot.isMatrix4?b.uniforms[tt]={type:"m4",value:ot.toArray()}:b.uniforms[tt]={value:ot}}Object.keys(this.defines).length>0&&(b.defines=this.defines),b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader;const et={};for(const tt in this.extensions)this.extensions[tt]===!0&&(et[tt]=!0);return Object.keys(et).length>0&&(b.extensions=et),b}}class FA extends Zs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zs,this.projectionMatrix=new zs,this.projectionMatrixInverse=new zs}copy(o,b){return super.copy(o,b),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const b=this.matrixWorld.elements;return o.set(-b[8],-b[9],-b[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,b){super.updateWorldMatrix(o,b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Zu extends FA{constructor(o=50,b=1,et=.1,tt=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=et,this.far=tt,this.focus=10,this.aspect=b,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,b){return super.copy(o,b),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const b=.5*this.getFilmHeight()/o;this.fov=2*Cy*Math.atan(b),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(.5*R_*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return 2*Cy*Math.atan(Math.tan(.5*R_*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,b,et,tt,ot,lt){this.aspect=o/b,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=b,this.view.offsetX=et,this.view.offsetY=tt,this.view.width=ot,this.view.height=lt,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let b=o*Math.tan(.5*R_*this.fov)/this.zoom,et=2*b,tt=this.aspect*et,ot=-.5*tt;const lt=this.view;if(this.view!==null&&this.view.enabled){const vt=lt.fullWidth,_t=lt.fullHeight;ot+=lt.offsetX*tt/vt,b-=lt.offsetY*et/_t,tt*=lt.width/vt,et*=lt.height/_t}const ht=this.filmOffset;ht!==0&&(ot+=o*ht/this.getFilmWidth()),this.projectionMatrix.makePerspective(ot,ot+tt,b,b-et,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const b=super.toJSON(o);return b.object.fov=this.fov,b.object.zoom=this.zoom,b.object.near=this.near,b.object.far=this.far,b.object.focus=this.focus,b.object.aspect=this.aspect,this.view!==null&&(b.object.view=Object.assign({},this.view)),b.object.filmGauge=this.filmGauge,b.object.filmOffset=this.filmOffset,b}}const U0=90;class RS extends Zs{constructor(o,b,et){super(),this.type="CubeCamera",this.renderTarget=et;const tt=new Zu(U0,1,o,b);tt.layers=this.layers,tt.up.set(0,-1,0),tt.lookAt(new xn(1,0,0)),this.add(tt);const ot=new Zu(U0,1,o,b);ot.layers=this.layers,ot.up.set(0,-1,0),ot.lookAt(new xn(-1,0,0)),this.add(ot);const lt=new Zu(U0,1,o,b);lt.layers=this.layers,lt.up.set(0,0,1),lt.lookAt(new xn(0,1,0)),this.add(lt);const ht=new Zu(U0,1,o,b);ht.layers=this.layers,ht.up.set(0,0,-1),ht.lookAt(new xn(0,-1,0)),this.add(ht);const vt=new Zu(U0,1,o,b);vt.layers=this.layers,vt.up.set(0,-1,0),vt.lookAt(new xn(0,0,1)),this.add(vt);const _t=new Zu(U0,1,o,b);_t.layers=this.layers,_t.up.set(0,-1,0),_t.lookAt(new xn(0,0,-1)),this.add(_t)}update(o,b){this.parent===null&&this.updateMatrixWorld();const et=this.renderTarget,[tt,ot,lt,ht,vt,_t]=this.children,Mt=o.getRenderTarget(),Pt=o.toneMapping,Tt=o.xr.enabled;o.toneMapping=Os,o.xr.enabled=!1;const Rt=et.texture.generateMipmaps;et.texture.generateMipmaps=!1,o.setRenderTarget(et,0),o.render(b,tt),o.setRenderTarget(et,1),o.render(b,ot),o.setRenderTarget(et,2),o.render(b,lt),o.setRenderTarget(et,3),o.render(b,ht),o.setRenderTarget(et,4),o.render(b,vt),et.texture.generateMipmaps=Rt,o.setRenderTarget(et,5),o.render(b,_t),o.setRenderTarget(Mt),o.toneMapping=Pt,o.xr.enabled=Tt,et.texture.needsPMREMUpdate=!0}}class UA extends vu{constructor(o,b,et,tt,ot,lt,ht,vt,_t,Mt){super(o=o!==void 0?o:[],b=b!==void 0?b:Oo,et,tt,ot,lt,ht,vt,_t,Mt),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class LM extends wp{constructor(o,b={}){super(o,o,b),this.isWebGLCubeRenderTarget=!0;const et={width:o,height:o,depth:1},tt=[et,et,et,et,et,et];this.texture=new UA(tt,b.mapping,b.wrapS,b.wrapT,b.magFilter,b.minFilter,b.format,b.type,b.anisotropy,b.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=b.generateMipmaps!==void 0&&b.generateMipmaps,this.texture.minFilter=b.minFilter!==void 0?b.minFilter:Vo}fromEquirectangularTexture(o,b){this.texture.type=b.type,this.texture.encoding=b.encoding,this.texture.generateMipmaps=b.generateMipmaps,this.texture.minFilter=b.minFilter,this.texture.magFilter=b.magFilter;const et={tEquirect:{value:null}},tt=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,ot=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,lt=new Hm(5,5,5),ht=new yv({name:"CubemapFromEquirect",uniforms:F0(et),vertexShader:tt,fragmentShader:ot,side:jt,blending:Ft});ht.uniforms.tEquirect.value=b;const vt=new Nu(lt,ht),_t=b.minFilter;return b.minFilter===hs&&(b.minFilter=Vo),new RS(1,10,this).update(o,vt),b.minFilter=_t,vt.geometry.dispose(),vt.material.dispose(),this}clear(o,b,et,tt){const ot=o.getRenderTarget();for(let lt=0;lt<6;lt++)o.setRenderTarget(this,lt),o.clear(b,et,tt);o.setRenderTarget(ot)}}const kS=new xn,j0=new xn,BS=new Ru;class Q_{constructor(o=new xn(1,0,0),b=0){this.isPlane=!0,this.normal=o,this.constant=b}set(o,b){return this.normal.copy(o),this.constant=b,this}setComponents(o,b,et,tt){return this.normal.set(o,b,et),this.constant=tt,this}setFromNormalAndCoplanarPoint(o,b){return this.normal.copy(o),this.constant=-b.dot(this.normal),this}setFromCoplanarPoints(o,b,et){const tt=kS.subVectors(et,b).cross(j0.subVectors(o,b)).normalize();return this.setFromNormalAndCoplanarPoint(tt,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,b){return b.copy(this.normal).multiplyScalar(-this.distanceToPoint(o)).add(o)}intersectLine(o,b){const et=o.delta(kS),tt=this.normal.dot(et);if(tt===0)return this.distanceToPoint(o.start)===0?b.copy(o.start):null;const ot=-(o.start.dot(this.normal)+this.constant)/tt;return ot<0||ot>1?null:b.copy(et).multiplyScalar(ot).add(o.start)}intersectsLine(o){const b=this.distanceToPoint(o.start),et=this.distanceToPoint(o.end);return b<0&&et>0||et<0&&b>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,b){const et=b||BS.getNormalMatrix(o),tt=this.coplanarPoint(kS).applyMatrix4(o),ot=this.normal.applyMatrix3(et).normalize();return this.constant=-tt.dot(ot),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Fy=new _f,Vw=new xn;class Qw{constructor(o=new Q_,b=new Q_,et=new Q_,tt=new Q_,ot=new Q_,lt=new Q_){this.planes=[o,b,et,tt,ot,lt]}set(o,b,et,tt,ot,lt){const ht=this.planes;return ht[0].copy(o),ht[1].copy(b),ht[2].copy(et),ht[3].copy(tt),ht[4].copy(ot),ht[5].copy(lt),this}copy(o){const b=this.planes;for(let et=0;et<6;et++)b[et].copy(o.planes[et]);return this}setFromProjectionMatrix(o){const b=this.planes,et=o.elements,tt=et[0],ot=et[1],lt=et[2],ht=et[3],vt=et[4],_t=et[5],Mt=et[6],Pt=et[7],Tt=et[8],Rt=et[9],Nt=et[10],kt=et[11],Kt=et[12],$t=et[13],en=et[14],ln=et[15];return b[0].setComponents(ht-tt,Pt-vt,kt-Tt,ln-Kt).normalize(),b[1].setComponents(ht+tt,Pt+vt,kt+Tt,ln+Kt).normalize(),b[2].setComponents(ht+ot,Pt+_t,kt+Rt,ln+$t).normalize(),b[3].setComponents(ht-ot,Pt-_t,kt-Rt,ln-$t).normalize(),b[4].setComponents(ht-lt,Pt-Mt,kt-Nt,ln-en).normalize(),b[5].setComponents(ht+lt,Pt+Mt,kt+Nt,ln+en).normalize(),this}intersectsObject(o){const b=o.geometry;return b.boundingSphere===null&&b.computeBoundingSphere(),Fy.copy(b.boundingSphere).applyMatrix4(o.matrixWorld),this.intersectsSphere(Fy)}intersectsSprite(o){return Fy.center.set(0,0,0),Fy.radius=.7071067811865476,Fy.applyMatrix4(o.matrixWorld),this.intersectsSphere(Fy)}intersectsSphere(o){const b=this.planes,et=o.center,tt=-o.radius;for(let ot=0;ot<6;ot++)if(b[ot].distanceToPoint(et)<tt)return!1;return!0}intersectsBox(o){const b=this.planes;for(let et=0;et<6;et++){const tt=b[et];if(Vw.x=tt.normal.x>0?o.max.x:o.min.x,Vw.y=tt.normal.y>0?o.max.y:o.min.y,Vw.z=tt.normal.z>0?o.max.z:o.min.z,tt.distanceToPoint(Vw)<0)return!1}return!0}containsPoint(o){const b=this.planes;for(let et=0;et<6;et++)if(b[et].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function G_(){let dt=null,o=!1,b=null,et=null;function tt(ot,lt){b(ot,lt),et=dt.requestAnimationFrame(tt)}return{start:function(){o!==!0&&b!==null&&(et=dt.requestAnimationFrame(tt),o=!0)},stop:function(){dt.cancelAnimationFrame(et),o=!1},setAnimationLoop:function(ot){b=ot},setContext:function(ot){dt=ot}}}function jA(dt,o){const b=o.isWebGL2,et=new WeakMap;return{get:function(tt){return tt.isInterleavedBufferAttribute&&(tt=tt.data),et.get(tt)},remove:function(tt){tt.isInterleavedBufferAttribute&&(tt=tt.data);const ot=et.get(tt);ot&&(dt.deleteBuffer(ot.buffer),et.delete(tt))},update:function(tt,ot){if(tt.isGLBufferAttribute){const ht=et.get(tt);return void((!ht||ht.version<tt.version)&&et.set(tt,{buffer:tt.buffer,type:tt.type,bytesPerElement:tt.elementSize,version:tt.version}))}tt.isInterleavedBufferAttribute&&(tt=tt.data);const lt=et.get(tt);lt===void 0?et.set(tt,function(ht,vt){const _t=ht.array,Mt=ht.usage,Pt=dt.createBuffer();let Tt;if(dt.bindBuffer(vt,Pt),dt.bufferData(vt,_t,Mt),ht.onUploadCallback(),_t instanceof Float32Array)Tt=5126;else if(_t instanceof Uint16Array)if(ht.isFloat16BufferAttribute){if(!b)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");Tt=5131}else Tt=5123;else if(_t instanceof Int16Array)Tt=5122;else if(_t instanceof Uint32Array)Tt=5125;else if(_t instanceof Int32Array)Tt=5124;else if(_t instanceof Int8Array)Tt=5120;else if(_t instanceof Uint8Array)Tt=5121;else{if(!(_t instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+_t);Tt=5121}return{buffer:Pt,type:Tt,bytesPerElement:_t.BYTES_PER_ELEMENT,version:ht.version}}(tt,ot)):lt.version<tt.version&&(function(ht,vt,_t){const Mt=vt.array,Pt=vt.updateRange;dt.bindBuffer(_t,ht),Pt.count===-1?dt.bufferSubData(_t,0,Mt):(b?dt.bufferSubData(_t,Pt.offset*Mt.BYTES_PER_ELEMENT,Mt,Pt.offset,Pt.count):dt.bufferSubData(_t,Pt.offset*Mt.BYTES_PER_ELEMENT,Mt.subarray(Pt.offset,Pt.offset+Pt.count)),Pt.count=-1)}(lt.buffer,tt,ot),lt.version=tt.version)}}}class z0 extends ms{constructor(o=1,b=1,et=1,tt=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:b,widthSegments:et,heightSegments:tt};const ot=o/2,lt=b/2,ht=Math.floor(et),vt=Math.floor(tt),_t=ht+1,Mt=vt+1,Pt=o/ht,Tt=b/vt,Rt=[],Nt=[],kt=[],Kt=[];for(let $t=0;$t<Mt;$t++){const en=$t*Tt-lt;for(let ln=0;ln<_t;ln++){const gn=ln*Pt-ot;Nt.push(gn,-en,0),kt.push(0,0,1),Kt.push(ln/ht),Kt.push(1-$t/vt)}}for(let $t=0;$t<vt;$t++)for(let en=0;en<ht;en++){const ln=en+_t*$t,gn=en+_t*($t+1),_n=en+1+_t*($t+1),An=en+1+_t*$t;Rt.push(ln,gn,An),Rt.push(gn,_n,An)}this.setIndex(Rt),this.setAttribute("position",new ft(Nt,3)),this.setAttribute("normal",new ft(kt,3)),this.setAttribute("uv",new ft(Kt,2))}static fromJSON(o){return new z0(o.width,o.height,o.widthSegments,o.heightSegments)}}const io={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},es={common:{diffuse:{value:new as(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ru},uv2Transform:{value:new Ru},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Lr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new as(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new as(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ru}},sprite:{diffuse:{value:new as(16777215)},opacity:{value:1},center:{value:new Lr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ru}}},am={basic:{uniforms:Ep([es.common,es.specularmap,es.envmap,es.aomap,es.lightmap,es.fog]),vertexShader:io.meshbasic_vert,fragmentShader:io.meshbasic_frag},lambert:{uniforms:Ep([es.common,es.specularmap,es.envmap,es.aomap,es.lightmap,es.emissivemap,es.bumpmap,es.normalmap,es.displacementmap,es.fog,es.lights,{emissive:{value:new as(0)}}]),vertexShader:io.meshlambert_vert,fragmentShader:io.meshlambert_frag},phong:{uniforms:Ep([es.common,es.specularmap,es.envmap,es.aomap,es.lightmap,es.emissivemap,es.bumpmap,es.normalmap,es.displacementmap,es.fog,es.lights,{emissive:{value:new as(0)},specular:{value:new as(1118481)},shininess:{value:30}}]),vertexShader:io.meshphong_vert,fragmentShader:io.meshphong_frag},standard:{uniforms:Ep([es.common,es.envmap,es.aomap,es.lightmap,es.emissivemap,es.bumpmap,es.normalmap,es.displacementmap,es.roughnessmap,es.metalnessmap,es.fog,es.lights,{emissive:{value:new as(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:io.meshphysical_vert,fragmentShader:io.meshphysical_frag},toon:{uniforms:Ep([es.common,es.aomap,es.lightmap,es.emissivemap,es.bumpmap,es.normalmap,es.displacementmap,es.gradientmap,es.fog,es.lights,{emissive:{value:new as(0)}}]),vertexShader:io.meshtoon_vert,fragmentShader:io.meshtoon_frag},matcap:{uniforms:Ep([es.common,es.bumpmap,es.normalmap,es.displacementmap,es.fog,{matcap:{value:null}}]),vertexShader:io.meshmatcap_vert,fragmentShader:io.meshmatcap_frag},points:{uniforms:Ep([es.points,es.fog]),vertexShader:io.points_vert,fragmentShader:io.points_frag},dashed:{uniforms:Ep([es.common,es.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:io.linedashed_vert,fragmentShader:io.linedashed_frag},depth:{uniforms:Ep([es.common,es.displacementmap]),vertexShader:io.depth_vert,fragmentShader:io.depth_frag},normal:{uniforms:Ep([es.common,es.bumpmap,es.normalmap,es.displacementmap,{opacity:{value:1}}]),vertexShader:io.meshnormal_vert,fragmentShader:io.meshnormal_frag},sprite:{uniforms:Ep([es.sprite,es.fog]),vertexShader:io.sprite_vert,fragmentShader:io.sprite_frag},background:{uniforms:{uvTransform:{value:new Ru},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:io.background_vert,fragmentShader:io.background_frag},cube:{uniforms:Ep([es.envmap,{opacity:{value:1}}]),vertexShader:io.cube_vert,fragmentShader:io.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:io.equirect_vert,fragmentShader:io.equirect_frag},distanceRGBA:{uniforms:Ep([es.common,es.displacementmap,{referencePosition:{value:new xn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:io.distanceRGBA_vert,fragmentShader:io.distanceRGBA_frag},shadow:{uniforms:Ep([es.lights,es.fog,{color:{value:new as(0)},opacity:{value:1}}]),vertexShader:io.shadow_vert,fragmentShader:io.shadow_frag}};function aP(dt,o,b,et,tt,ot){const lt=new as(0);let ht,vt,_t=tt===!0?0:1,Mt=null,Pt=0,Tt=null;function Rt(Nt,kt){b.buffers.color.setClear(Nt.r,Nt.g,Nt.b,kt,ot)}return{getClearColor:function(){return lt},setClearColor:function(Nt,kt=1){lt.set(Nt),_t=kt,Rt(lt,_t)},getClearAlpha:function(){return _t},setClearAlpha:function(Nt){_t=Nt,Rt(lt,_t)},getPlaneMesh:function(){return ht},getBoxMesh:function(){return vt},getBoxMesh2:function(){return vt===void 0&&(vt=new Nu(new Hm(1,1,1),new yv({name:"BackgroundCubeMaterial",uniforms:F0(am.cube.uniforms),vertexShader:am.cube.vertexShader,fragmentShader:am.cube.fragmentShader,side:jt,depthTest:!1,depthWrite:!1,fog:!1})),vt.geometry.deleteAttribute("normal"),vt.geometry.deleteAttribute("uv"),vt.onBeforeRender=function(Nt,kt,Kt){this.matrixWorld.copyPosition(Kt.matrixWorld)},Object.defineProperty(vt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),et.update(vt)),vt},render:function(Nt,kt){let Kt=!1,$t=kt.isScene===!0?kt.background:null;$t&&$t.isTexture&&($t=o.get($t));const en=dt.xr,ln=en.getSession&&en.getSession();ln&&ln.environmentBlendMode==="additive"&&($t=null),$t===null?Rt(lt,_t):$t&&$t.isColor&&(Rt($t,1),Kt=!0),(dt.autoClear||Kt)&&dt.clear(dt.autoClearColor,dt.autoClearDepth,dt.autoClearStencil),$t&&($t.isCubeTexture||$t.mapping===Hl)?(vt===void 0&&(vt=new Nu(new Hm(1,1,1),new yv({name:"BackgroundCubeMaterial",uniforms:F0(am.cube.uniforms),vertexShader:am.cube.vertexShader,fragmentShader:am.cube.fragmentShader,side:jt,depthTest:!1,depthWrite:!1,fog:!1})),vt.geometry.deleteAttribute("normal"),vt.geometry.deleteAttribute("uv"),vt.onBeforeRender=function(gn,_n,An){this.matrixWorld.copyPosition(An.matrixWorld)},Object.defineProperty(vt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),et.update(vt)),vt.material.uniforms.envMap.value=$t,vt.material.uniforms.envMapRotation.value=$t.rotation||0,vt.material.uniforms.flipEnvMap.value=$t.isCubeTexture&&$t.isRenderTargetTexture===!1?-1:1,Mt===$t&&Pt===$t.version&&Tt===dt.toneMapping||(vt.material.needsUpdate=!0,Mt=$t,Pt=$t.version,Tt=dt.toneMapping),vt.layers.enableAll(),Nt.unshift(vt,vt.geometry,vt.material,0,0,null)):$t&&$t.isTexture&&(ht===void 0&&(ht=new Nu(new z0(2,2),new yv({name:"BackgroundMaterial",uniforms:F0(am.background.uniforms),vertexShader:am.background.vertexShader,fragmentShader:am.background.fragmentShader,side:Jt,depthTest:!1,depthWrite:!1,fog:!1})),ht.geometry.deleteAttribute("normal"),Object.defineProperty(ht.material,"map",{get:function(){return this.uniforms.t2D.value}}),et.update(ht)),ht.material.uniforms.t2D.value=$t,ht.material.uniforms.flipX.value=$t.userData.flipX||!1,ht.material.uniforms.flipY.value=$t.userData.flipY||!1,$t.matrixAutoUpdate===!0&&$t.updateMatrix(),ht.material.uniforms.uvTransform.value.copy($t.matrix),Mt===$t&&Pt===$t.version&&Tt===dt.toneMapping||(ht.material.needsUpdate=!0,Mt=$t,Pt=$t.version,Tt=dt.toneMapping),ht.layers.enableAll(),Nt.unshift(ht,ht.geometry,ht.material,0,0,null))}}}function lP(dt,o,b,et){const tt=dt.getParameter(34921),ot=et.isWebGL2?null:o.get("OES_vertex_array_object"),lt=et.isWebGL2||ot!==null,ht={},vt=Rt(null);let _t=vt,Mt=!1;function Pt(_n){return et.isWebGL2?dt.bindVertexArray(_n):ot.bindVertexArrayOES(_n)}function Tt(_n){return et.isWebGL2?dt.deleteVertexArray(_n):ot.deleteVertexArrayOES(_n)}function Rt(_n){const An=[],Ln=[],Nn=[];for(let Jn=0;Jn<tt;Jn++)An[Jn]=0,Ln[Jn]=0,Nn[Jn]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:An,enabledAttributes:Ln,attributeDivisors:Nn,object:_n,attributes:{},index:null}}function Nt(){const _n=_t.newAttributes;for(let An=0,Ln=_n.length;An<Ln;An++)_n[An]=0}function kt(_n){Kt(_n,0)}function Kt(_n,An){const Ln=_t.newAttributes,Nn=_t.enabledAttributes,Jn=_t.attributeDivisors;Ln[_n]=1,Nn[_n]===0&&(dt.enableVertexAttribArray(_n),Nn[_n]=1),Jn[_n]!==An&&((et.isWebGL2?dt:o.get("ANGLE_instanced_arrays"))[et.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](_n,An),Jn[_n]=An)}function $t(){const _n=_t.newAttributes,An=_t.enabledAttributes;for(let Ln=0,Nn=An.length;Ln<Nn;Ln++)An[Ln]!==_n[Ln]&&(dt.disableVertexAttribArray(Ln),An[Ln]=0)}function en(_n,An,Ln,Nn,Jn,tr){et.isWebGL2!==!0||Ln!==5124&&Ln!==5125?dt.vertexAttribPointer(_n,An,Ln,Nn,Jn,tr):dt.vertexAttribIPointer(_n,An,Ln,Jn,tr)}function ln(){gn(),Mt=!0,_t!==vt&&(_t=vt,Pt(_t.object))}function gn(){vt.geometry=null,vt.program=null,vt.wireframe=!1}return{setup:function(_n,An,Ln,Nn,Jn){let tr=!1;if(lt){const jn=function(Cr,Ur,Er){const qr=Er.wireframe===!0;let Yr=ht[Cr.id];Yr===void 0&&(Yr={},ht[Cr.id]=Yr);let fr=Yr[Ur.id];fr===void 0&&(fr={},Yr[Ur.id]=fr);let _r=fr[qr];return _r===void 0&&(_r=Rt(et.isWebGL2?dt.createVertexArray():ot.createVertexArrayOES()),fr[qr]=_r),_r}(Nn,Ln,An);_t!==jn&&(_t=jn,Pt(_t.object)),tr=function(Cr,Ur,Er,qr){const Yr=_t.attributes,fr=Ur.attributes;let _r=0;const Qr=Er.getAttributes();for(const Mr in Qr)if(Qr[Mr].location>=0){const Wr=Yr[Mr];let ws=fr[Mr];if(ws===void 0&&(Mr==="instanceMatrix"&&Cr.instanceMatrix&&(ws=Cr.instanceMatrix),Mr==="instanceColor"&&Cr.instanceColor&&(ws=Cr.instanceColor)),Wr===void 0||Wr.attribute!==ws||ws&&Wr.data!==ws.data)return!0;_r++}return _t.attributesNum!==_r||_t.index!==qr}(_n,Nn,Ln,Jn),tr&&function(Cr,Ur,Er,qr){const Yr={},fr=Ur.attributes;let _r=0;const Qr=Er.getAttributes();for(const Mr in Qr)if(Qr[Mr].location>=0){let Wr=fr[Mr];Wr===void 0&&(Mr==="instanceMatrix"&&Cr.instanceMatrix&&(Wr=Cr.instanceMatrix),Mr==="instanceColor"&&Cr.instanceColor&&(Wr=Cr.instanceColor));const ws={};ws.attribute=Wr,Wr&&Wr.data&&(ws.data=Wr.data),Yr[Mr]=ws,_r++}_t.attributes=Yr,_t.attributesNum=_r,_t.index=qr}(_n,Nn,Ln,Jn)}else{const jn=An.wireframe===!0;_t.geometry===Nn.id&&_t.program===Ln.id&&_t.wireframe===jn||(_t.geometry=Nn.id,_t.program=Ln.id,_t.wireframe=jn,tr=!0)}Jn!==null&&b.update(Jn,34963),(tr||Mt)&&(Mt=!1,function(jn,Cr,Ur,Er){if(et.isWebGL2===!1&&(jn.isInstancedMesh||Er.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;Nt();const qr=Er.attributes,Yr=Ur.getAttributes(),fr=Cr.defaultAttributeValues;for(const _r in Yr){const Qr=Yr[_r];if(Qr.location>=0){let Mr=qr[_r];if(Mr===void 0&&(_r==="instanceMatrix"&&jn.instanceMatrix&&(Mr=jn.instanceMatrix),_r==="instanceColor"&&jn.instanceColor&&(Mr=jn.instanceColor)),Mr!==void 0){const Wr=Mr.normalized,ws=Mr.itemSize,fo=b.get(Mr);if(fo===void 0)continue;const Es=fo.buffer,so=fo.type,Rn=fo.bytesPerElement;if(Mr.isInterleavedBufferAttribute){const Mn=Mr.data,sr=Mn.stride,Xn=Mr.offset;if(Mn.isInstancedInterleavedBuffer){for(let kn=0;kn<Qr.locationSize;kn++)Kt(Qr.location+kn,Mn.meshPerAttribute);jn.isInstancedMesh!==!0&&Er._maxInstanceCount===void 0&&(Er._maxInstanceCount=Mn.meshPerAttribute*Mn.count)}else for(let kn=0;kn<Qr.locationSize;kn++)kt(Qr.location+kn);dt.bindBuffer(34962,Es);for(let kn=0;kn<Qr.locationSize;kn++)en(Qr.location+kn,ws/Qr.locationSize,so,Wr,sr*Rn,(Xn+ws/Qr.locationSize*kn)*Rn)}else{if(Mr.isInstancedBufferAttribute){for(let Mn=0;Mn<Qr.locationSize;Mn++)Kt(Qr.location+Mn,Mr.meshPerAttribute);jn.isInstancedMesh!==!0&&Er._maxInstanceCount===void 0&&(Er._maxInstanceCount=Mr.meshPerAttribute*Mr.count)}else for(let Mn=0;Mn<Qr.locationSize;Mn++)kt(Qr.location+Mn);dt.bindBuffer(34962,Es);for(let Mn=0;Mn<Qr.locationSize;Mn++)en(Qr.location+Mn,ws/Qr.locationSize,so,Wr,ws*Rn,ws/Qr.locationSize*Mn*Rn)}}else if(fr!==void 0){const Wr=fr[_r];if(Wr!==void 0)switch(Wr.length){case 2:dt.vertexAttrib2fv(Qr.location,Wr);break;case 3:dt.vertexAttrib3fv(Qr.location,Wr);break;case 4:dt.vertexAttrib4fv(Qr.location,Wr);break;default:dt.vertexAttrib1fv(Qr.location,Wr)}}}}$t()}(_n,An,Ln,Nn),Jn!==null&&dt.bindBuffer(34963,b.get(Jn).buffer))},reset:ln,resetDefaultState:gn,dispose:function(){ln();for(const _n in ht){const An=ht[_n];for(const Ln in An){const Nn=An[Ln];for(const Jn in Nn)Tt(Nn[Jn].object),delete Nn[Jn];delete An[Ln]}delete ht[_n]}},releaseStatesOfGeometry:function(_n){if(ht[_n.id]===void 0)return;const An=ht[_n.id];for(const Ln in An){const Nn=An[Ln];for(const Jn in Nn)Tt(Nn[Jn].object),delete Nn[Jn];delete An[Ln]}delete ht[_n.id]},releaseStatesOfProgram:function(_n){for(const An in ht){const Ln=ht[An];if(Ln[_n.id]===void 0)continue;const Nn=Ln[_n.id];for(const Jn in Nn)Tt(Nn[Jn].object),delete Nn[Jn];delete Ln[_n.id]}},initAttributes:Nt,enableAttribute:kt,disableUnusedAttributes:$t}}function NM(dt,o,b,et){const tt=et.isWebGL2;let ot;this.setMode=function(lt){ot=lt},this.render=function(lt,ht){dt.drawArrays(ot,lt,ht),b.update(ht,ot,1)},this.renderInstances=function(lt,ht,vt){if(vt===0)return;let _t,Mt;if(tt)_t=dt,Mt="drawArraysInstanced";else if(_t=o.get("ANGLE_instanced_arrays"),Mt="drawArraysInstancedANGLE",_t===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");_t[Mt](ot,lt,ht,vt),b.update(ht,ot,vt)}}function FM(dt,o,b){let et;function tt(gn){if(gn==="highp"){if(dt.getShaderPrecisionFormat(35633,36338).precision>0&&dt.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";gn="mediump"}return gn==="mediump"&&dt.getShaderPrecisionFormat(35633,36337).precision>0&&dt.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const ot=typeof WebGL2RenderingContext<"u"&&dt instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&dt instanceof WebGL2ComputeRenderingContext;let lt=b.precision!==void 0?b.precision:"highp";const ht=tt(lt);ht!==lt&&(console.warn("THREE.WebGLRenderer:",lt,"not supported, using",ht,"instead."),lt=ht);const vt=ot||o.has("WEBGL_draw_buffers"),_t=b.logarithmicDepthBuffer===!0,Mt=dt.getParameter(34930),Pt=dt.getParameter(35660),Tt=dt.getParameter(3379),Rt=dt.getParameter(34076),Nt=dt.getParameter(34921),kt=dt.getParameter(36347),Kt=dt.getParameter(36348),$t=dt.getParameter(36349),en=Pt>0,ln=ot||o.has("OES_texture_float");return{isWebGL2:ot,drawBuffers:vt,getMaxAnisotropy:function(){if(et!==void 0)return et;if(o.has("EXT_texture_filter_anisotropic")===!0){const gn=o.get("EXT_texture_filter_anisotropic");et=dt.getParameter(gn.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else et=0;return et},getMaxPrecision:tt,precision:lt,logarithmicDepthBuffer:_t,maxTextures:Mt,maxVertexTextures:Pt,maxTextureSize:Tt,maxCubemapSize:Rt,maxAttributes:Nt,maxVertexUniforms:kt,maxVaryings:Kt,maxFragmentUniforms:$t,vertexTextures:en,floatFragmentTextures:ln,floatVertexTextures:en&&ln,maxSamples:ot?dt.getParameter(36183):0}}function cP(dt){const o=this;let b=null,et=0,tt=!1,ot=!1;const lt=new Q_,ht=new Ru,vt={value:null,needsUpdate:!1};function _t(){vt.value!==b&&(vt.value=b,vt.needsUpdate=et>0),o.numPlanes=et,o.numIntersection=0}function Mt(Pt,Tt,Rt,Nt){const kt=Pt!==null?Pt.length:0;let Kt=null;if(kt!==0){if(Kt=vt.value,Nt!==!0||Kt===null){const $t=Rt+4*kt,en=Tt.matrixWorldInverse;ht.getNormalMatrix(en),(Kt===null||Kt.length<$t)&&(Kt=new Float32Array($t));for(let ln=0,gn=Rt;ln!==kt;++ln,gn+=4)lt.copy(Pt[ln]).applyMatrix4(en,ht),lt.normal.toArray(Kt,gn),Kt[gn+3]=lt.constant}vt.value=Kt,vt.needsUpdate=!0}return o.numPlanes=kt,o.numIntersection=0,Kt}this.uniform=vt,this.numPlanes=0,this.numIntersection=0,this.init=function(Pt,Tt,Rt){const Nt=Pt.length!==0||Tt||et!==0||tt;return tt=Tt,b=Mt(Pt,Rt,0),et=Pt.length,Nt},this.beginShadows=function(){ot=!0,Mt(null)},this.endShadows=function(){ot=!1,_t()},this.setState=function(Pt,Tt,Rt){const Nt=Pt.clippingPlanes,kt=Pt.clipIntersection,Kt=Pt.clipShadows,$t=dt.get(Pt);if(!tt||Nt===null||Nt.length===0||ot&&!Kt)ot?Mt(null):_t();else{const en=ot?0:et,ln=4*en;let gn=$t.clippingState||null;vt.value=gn,gn=Mt(Nt,Tt,ln,Rt);for(let _n=0;_n!==ln;++_n)gn[_n]=b[_n];$t.clippingState=gn,this.numIntersection=kt?this.numPlanes:0,this.numPlanes+=en}}}function uP(dt){let o=new WeakMap;function b(tt,ot){return ot===To?tt.mapping=Oo:ot===Io&&(tt.mapping=Mo),tt}function et(tt){const ot=tt.target;ot.removeEventListener("dispose",et);const lt=o.get(ot);lt!==void 0&&(o.delete(ot),lt.dispose())}return{get:function(tt){if(tt&&tt.isTexture&&tt.isRenderTargetTexture===!1){const ot=tt.mapping;if(ot===To||ot===Io){if(o.has(tt)){const lt=o.get(tt).texture;return lt.rotation=tt.rotation,b(lt,tt.mapping)}{const lt=tt.image;if(lt&&lt.height>0){const ht=new LM(lt.height/2);return ht.fromEquirectangularTexture(dt,tt),ht.texture.rotation=tt.rotation,o.set(tt,ht),tt.addEventListener("dispose",et),b(ht.texture,tt.mapping)}return null}}}return tt},dispose:function(){o=new WeakMap}}}am.physical={uniforms:Ep([am.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Lr(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new as(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Lr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new as(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new as(1,1,1)},specularColorMap:{value:null}}]),vertexShader:io.meshphysical_vert,fragmentShader:io.meshphysical_frag};class M1 extends FA{constructor(o=-1,b=1,et=1,tt=-1,ot=.1,lt=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=b,this.top=et,this.bottom=tt,this.near=ot,this.far=lt,this.updateProjectionMatrix()}copy(o,b){return super.copy(o,b),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,b,et,tt,ot,lt){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=b,this.view.offsetX=et,this.view.offsetY=tt,this.view.width=ot,this.view.height=lt,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),et=(this.right+this.left)/2,tt=(this.top+this.bottom)/2;let ot=et-o,lt=et+o,ht=tt+b,vt=tt-b;if(this.view!==null&&this.view.enabled){const _t=(this.right-this.left)/this.view.fullWidth/this.zoom,Mt=(this.top-this.bottom)/this.view.fullHeight/this.zoom;ot+=_t*this.view.offsetX,lt=ot+_t*this.view.width,ht-=Mt*this.view.offsetY,vt=ht-Mt*this.view.height}this.projectionMatrix.makeOrthographic(ot,lt,ht,vt,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const b=super.toJSON(o);return b.object.zoom=this.zoom,b.object.left=this.left,b.object.right=this.right,b.object.top=this.top,b.object.bottom=this.bottom,b.object.near=this.near,b.object.far=this.far,this.view!==null&&(b.object.view=Object.assign({},this.view)),b}}const UM=[.125,.215,.35,.446,.526,.582],T1=new M1,I1=new as;let P1=null;const n_=(1+Math.sqrt(5))/2,Uy=1/n_,OS=[new xn(1,1,1),new xn(-1,1,1),new xn(1,1,-1),new xn(-1,1,-1),new xn(0,n_,Uy),new xn(0,n_,-Uy),new xn(Uy,0,n_),new xn(-Uy,0,n_),new xn(n_,Uy,0),new xn(-n_,Uy,0)];class D1{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,b=0,et=.1,tt=100){P1=this._renderer.getRenderTarget(),this._setSize(256);const ot=this._allocateTargets();return ot.depthBuffer=!0,this._sceneToCubeUV(o,et,tt,ot),b>0&&this._blur(ot,0,0,b),this._applyPMREM(ot),this._cleanup(ot),ot}fromEquirectangular(o,b=null){return this._fromTexture(o,b)}fromCubemap(o,b=null){return this._fromTexture(o,b)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=LS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=R1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(P1),o.scissorTest=!1,oo(o,0,0,o.width,o.height)}_fromTexture(o,b){o.mapping===Oo||o.mapping===Mo?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),P1=this._renderer.getRenderTarget();const et=b||this._allocateTargets();return this._textureToCubeUV(o,et),this._applyPMREM(et),this._cleanup(et),et}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),b=4*this._cubeSize,et={magFilter:Vo,minFilter:Vo,generateMipmaps:!1,type:Wu,format:bs,encoding:vm,depthBuffer:!1},tt=jM(o,b,et);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=jM(o,b,et);const{_lodMax:ot}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(lt){const ht=[],vt=[],_t=[];let Mt=lt;const Pt=lt-4+1+UM.length;for(let Tt=0;Tt<Pt;Tt++){const Rt=Math.pow(2,Mt);vt.push(Rt);let Nt=1/Rt;Tt>lt-4?Nt=UM[Tt-lt+4-1]:Tt===0&&(Nt=0),_t.push(Nt);const kt=1/(Rt-2),Kt=-kt,$t=1+kt,en=[Kt,Kt,$t,Kt,$t,$t,Kt,Kt,$t,$t,Kt,$t],ln=6,gn=6,_n=3,An=2,Ln=1,Nn=new Float32Array(_n*gn*ln),Jn=new Float32Array(An*gn*ln),tr=new Float32Array(Ln*gn*ln);for(let Cr=0;Cr<ln;Cr++){const Ur=Cr%3*2/3-1,Er=Cr>2?0:-1,qr=[Ur,Er,0,Ur+2/3,Er,0,Ur+2/3,Er+1,0,Ur,Er,0,Ur+2/3,Er+1,0,Ur,Er+1,0];Nn.set(qr,_n*gn*Cr),Jn.set(en,An*gn*Cr);const Yr=[Cr,Cr,Cr,Cr,Cr,Cr];tr.set(Yr,Ln*gn*Cr)}const jn=new ms;jn.setAttribute("position",new ga(Nn,_n)),jn.setAttribute("uv",new ga(Jn,An)),jn.setAttribute("faceIndex",new ga(tr,Ln)),ht.push(jn),Mt>4&&Mt--}return{lodPlanes:ht,sizeLods:vt,sigmas:_t}}(ot)),this._blurMaterial=function(lt,ht,vt){const _t=new Float32Array(20),Mt=new xn(0,1,0);return new yv({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/ht,CUBEUV_TEXEL_HEIGHT:1/vt,CUBEUV_MAX_MIP:`${lt}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:_t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:Mt}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ft,depthTest:!1,depthWrite:!1})}(ot,o,b)}return tt}_compileMaterial(o){const b=new Nu(this._lodPlanes[0],o);this._renderer.compile(b,T1)}_sceneToCubeUV(o,b,et,tt){const ot=new Zu(90,1,b,et),lt=[1,-1,1,1,1,1],ht=[1,1,1,-1,-1,-1],vt=this._renderer,_t=vt.autoClear,Mt=vt.toneMapping;vt.getClearColor(I1),vt.toneMapping=Os,vt.autoClear=!1;const Pt=new Gm({name:"PMREM.Background",side:jt,depthWrite:!1,depthTest:!1}),Tt=new Nu(new Hm,Pt);let Rt=!1;const Nt=o.background;Nt?Nt.isColor&&(Pt.color.copy(Nt),o.background=null,Rt=!0):(Pt.color.copy(I1),Rt=!0);for(let kt=0;kt<6;kt++){const Kt=kt%3;Kt===0?(ot.up.set(0,lt[kt],0),ot.lookAt(ht[kt],0,0)):Kt===1?(ot.up.set(0,0,lt[kt]),ot.lookAt(0,ht[kt],0)):(ot.up.set(0,lt[kt],0),ot.lookAt(0,0,ht[kt]));const $t=this._cubeSize;oo(tt,Kt*$t,kt>2?$t:0,$t,$t),vt.setRenderTarget(tt),Rt&&vt.render(Tt,ot),vt.render(o,ot)}Tt.geometry.dispose(),Tt.material.dispose(),vt.toneMapping=Mt,vt.autoClear=_t,o.background=Nt}_textureToCubeUV(o,b){const et=this._renderer,tt=o.mapping===Oo||o.mapping===Mo;tt?(this._cubemapMaterial===null&&(this._cubemapMaterial=LS()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=R1());const ot=tt?this._cubemapMaterial:this._equirectMaterial,lt=new Nu(this._lodPlanes[0],ot);ot.uniforms.envMap.value=o;const ht=this._cubeSize;oo(b,0,0,3*ht,2*ht),et.setRenderTarget(b),et.render(lt,T1)}_applyPMREM(o){const b=this._renderer,et=b.autoClear;b.autoClear=!1;for(let tt=1;tt<this._lodPlanes.length;tt++){const ot=Math.sqrt(this._sigmas[tt]*this._sigmas[tt]-this._sigmas[tt-1]*this._sigmas[tt-1]),lt=OS[(tt-1)%OS.length];this._blur(o,tt-1,tt,ot,lt)}b.autoClear=et}_blur(o,b,et,tt,ot){const lt=this._pingPongRenderTarget;this._halfBlur(o,lt,b,et,tt,"latitudinal",ot),this._halfBlur(lt,o,et,et,tt,"longitudinal",ot)}_halfBlur(o,b,et,tt,ot,lt,ht){const vt=this._renderer,_t=this._blurMaterial;lt!=="latitudinal"&&lt!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const Mt=new Nu(this._lodPlanes[tt],_t),Pt=_t.uniforms,Tt=this._sizeLods[et]-1,Rt=isFinite(ot)?Math.PI/(2*Tt):2*Math.PI/39,Nt=ot/Rt,kt=isFinite(ot)?1+Math.floor(3*Nt):20;kt>20&&console.warn(`sigmaRadians, ${ot}, is too large and will clip, as it requested ${kt} samples when the maximum is set to 20`);const Kt=[];let $t=0;for(let gn=0;gn<20;++gn){const _n=gn/Nt,An=Math.exp(-_n*_n/2);Kt.push(An),gn===0?$t+=An:gn<kt&&($t+=2*An)}for(let gn=0;gn<Kt.length;gn++)Kt[gn]=Kt[gn]/$t;Pt.envMap.value=o.texture,Pt.samples.value=kt,Pt.weights.value=Kt,Pt.latitudinal.value=lt==="latitudinal",ht&&(Pt.poleAxis.value=ht);const{_lodMax:en}=this;Pt.dTheta.value=Rt,Pt.mipInt.value=en-et;const ln=this._sizeLods[tt];oo(b,3*ln*(tt>en-4?tt-en+4:0),4*(this._cubeSize-ln),3*ln,2*ln),vt.setRenderTarget(b),vt.render(Mt,T1)}}function jM(dt,o,b){const et=new wp(dt,o,b);return et.texture.mapping=Hl,et.texture.name="PMREM.cubeUv",et.scissorTest=!0,et}function oo(dt,o,b,et,tt){dt.viewport.set(o,b,et,tt),dt.scissor.set(o,b,et,tt)}function R1(){return new yv({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ft,depthTest:!1,depthWrite:!1})}function LS(){return new yv({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ft,depthTest:!1,depthWrite:!1})}function zM(dt){let o=new WeakMap,b=null;function et(tt){const ot=tt.target;ot.removeEventListener("dispose",et);const lt=o.get(ot);lt!==void 0&&(o.delete(ot),lt.dispose())}return{get:function(tt){if(tt&&tt.isTexture){const ot=tt.mapping,lt=ot===To||ot===Io,ht=ot===Oo||ot===Mo;if(lt||ht){if(tt.isRenderTargetTexture&&tt.needsPMREMUpdate===!0){tt.needsPMREMUpdate=!1;let vt=o.get(tt);return b===null&&(b=new D1(dt)),vt=lt?b.fromEquirectangular(tt,vt):b.fromCubemap(tt,vt),o.set(tt,vt),vt.texture}if(o.has(tt))return o.get(tt).texture;{const vt=tt.image;if(lt&&vt&&vt.height>0||ht&&vt&&function(_t){let Mt=0;for(let Pt=0;Pt<6;Pt++)_t[Pt]!==void 0&&Mt++;return Mt===6}(vt)){b===null&&(b=new D1(dt));const _t=lt?b.fromEquirectangular(tt):b.fromCubemap(tt);return o.set(tt,_t),tt.addEventListener("dispose",et),_t.texture}return null}}}return tt},dispose:function(){o=new WeakMap,b!==null&&(b.dispose(),b=null)}}}function Jr(dt){const o={};function b(et){if(o[et]!==void 0)return o[et];let tt;switch(et){case"WEBGL_depth_texture":tt=dt.getExtension("WEBGL_depth_texture")||dt.getExtension("MOZ_WEBGL_depth_texture")||dt.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":tt=dt.getExtension("EXT_texture_filter_anisotropic")||dt.getExtension("MOZ_EXT_texture_filter_anisotropic")||dt.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":tt=dt.getExtension("WEBGL_compressed_texture_s3tc")||dt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||dt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":tt=dt.getExtension("WEBGL_compressed_texture_pvrtc")||dt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:tt=dt.getExtension(et)}return o[et]=tt,tt}return{has:function(et){return b(et)!==null},init:function(et){et.isWebGL2?b("EXT_color_buffer_float"):(b("WEBGL_depth_texture"),b("OES_texture_float"),b("OES_texture_half_float"),b("OES_texture_half_float_linear"),b("OES_standard_derivatives"),b("OES_element_index_uint"),b("OES_vertex_array_object"),b("ANGLE_instanced_arrays")),b("OES_texture_float_linear"),b("EXT_color_buffer_half_float"),b("WEBGL_multisampled_render_to_texture")},get:function(et){const tt=b(et);return tt===null&&console.warn("THREE.WebGLRenderer: "+et+" extension not supported."),tt}}}function Ks(dt,o,b,et){const tt={},ot=new WeakMap;function lt(vt){const _t=vt.target;_t.index!==null&&o.remove(_t.index);for(const Pt in _t.attributes)o.remove(_t.attributes[Pt]);_t.removeEventListener("dispose",lt),delete tt[_t.id];const Mt=ot.get(_t);Mt&&(o.remove(Mt),ot.delete(_t)),et.releaseStatesOfGeometry(_t),_t.isInstancedBufferGeometry===!0&&delete _t._maxInstanceCount,b.memory.geometries--}function ht(vt){const _t=[],Mt=vt.index,Pt=vt.attributes.position;let Tt=0;if(Mt!==null){const kt=Mt.array;Tt=Mt.version;for(let Kt=0,$t=kt.length;Kt<$t;Kt+=3){const en=kt[Kt+0],ln=kt[Kt+1],gn=kt[Kt+2];_t.push(en,ln,ln,gn,gn,en)}}else{const kt=Pt.array;Tt=Pt.version;for(let Kt=0,$t=kt.length/3-1;Kt<$t;Kt+=3){const en=Kt+0,ln=Kt+1,gn=Kt+2;_t.push(en,ln,ln,gn,gn,en)}}const Rt=new(x1(_t)?bt:Vl)(_t,1);Rt.version=Tt;const Nt=ot.get(vt);Nt&&o.remove(Nt),ot.set(vt,Rt)}return{get:function(vt,_t){return tt[_t.id]===!0||(_t.addEventListener("dispose",lt),tt[_t.id]=!0,b.memory.geometries++),_t},update:function(vt){const _t=vt.attributes;for(const Pt in _t)o.update(_t[Pt],34962);const Mt=vt.morphAttributes;for(const Pt in Mt){const Tt=Mt[Pt];for(let Rt=0,Nt=Tt.length;Rt<Nt;Rt++)o.update(Tt[Rt],34962)}},getWireframeAttribute:function(vt){const _t=ot.get(vt);if(_t){const Mt=vt.index;Mt!==null&&_t.version<Mt.version&&ht(vt)}else ht(vt);return ot.get(vt)}}}function zA(dt,o,b,et){const tt=et.isWebGL2;let ot,lt,ht;this.setMode=function(vt){ot=vt},this.setIndex=function(vt){lt=vt.type,ht=vt.bytesPerElement},this.render=function(vt,_t){dt.drawElements(ot,_t,lt,vt*ht),b.update(_t,ot,1)},this.renderInstances=function(vt,_t,Mt){if(Mt===0)return;let Pt,Tt;if(tt)Pt=dt,Tt="drawElementsInstanced";else if(Pt=o.get("ANGLE_instanced_arrays"),Tt="drawElementsInstancedANGLE",Pt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Pt[Tt](ot,_t,lt,vt*ht,Mt),b.update(_t,ot,Mt)}}function Av(dt){const o={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:o,programs:null,autoReset:!0,reset:function(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0},update:function(b,et,tt){switch(o.calls++,et){case 4:o.triangles+=tt*(b/3);break;case 1:o.lines+=tt*(b/2);break;case 3:o.lines+=tt*(b-1);break;case 2:o.lines+=tt*b;break;case 0:o.points+=tt*b;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",et)}}}}function NS(dt,o){return dt[0]-o[0]}function FS(dt,o){return Math.abs(o[1])-Math.abs(dt[1])}function VM(dt,o,b){const et={},tt=new Float32Array(8),ot=new WeakMap,lt=new Uo,ht=[];for(let vt=0;vt<8;vt++)ht[vt]=[vt,0];return{update:function(vt,_t,Mt,Pt){const Tt=vt.morphTargetInfluences;if(o.isWebGL2===!0){const Rt=_t.morphAttributes.position||_t.morphAttributes.normal||_t.morphAttributes.color,Nt=Rt!==void 0?Rt.length:0;let kt=ot.get(_t);if(kt===void 0||kt.count!==Nt){kt!==void 0&&kt.texture.dispose();const en=_t.morphAttributes.position!==void 0,ln=_t.morphAttributes.normal!==void 0,gn=_t.morphAttributes.color!==void 0,_n=_t.morphAttributes.position||[],An=_t.morphAttributes.normal||[],Ln=_t.morphAttributes.color||[];let Nn=0;en===!0&&(Nn=1),ln===!0&&(Nn=2),gn===!0&&(Nn=3);let Jn=_t.attributes.position.count*Nn,tr=1;Jn>o.maxTextureSize&&(tr=Math.ceil(Jn/o.maxTextureSize),Jn=o.maxTextureSize);const jn=new Float32Array(Jn*tr*4*Nt),Cr=new I0(jn,Jn,tr,Nt);Cr.type=ba,Cr.needsUpdate=!0;const Ur=4*Nn;for(let Er=0;Er<Nt;Er++){const qr=_n[Er],Yr=An[Er],fr=Ln[Er],_r=Jn*tr*4*Er;for(let Qr=0;Qr<qr.count;Qr++){const Mr=Qr*Ur;en===!0&&(lt.fromBufferAttribute(qr,Qr),jn[_r+Mr+0]=lt.x,jn[_r+Mr+1]=lt.y,jn[_r+Mr+2]=lt.z,jn[_r+Mr+3]=0),ln===!0&&(lt.fromBufferAttribute(Yr,Qr),jn[_r+Mr+4]=lt.x,jn[_r+Mr+5]=lt.y,jn[_r+Mr+6]=lt.z,jn[_r+Mr+7]=0),gn===!0&&(lt.fromBufferAttribute(fr,Qr),jn[_r+Mr+8]=lt.x,jn[_r+Mr+9]=lt.y,jn[_r+Mr+10]=lt.z,jn[_r+Mr+11]=fr.itemSize===4?lt.w:1)}}kt={count:Nt,texture:Cr,size:new Lr(Jn,tr)},ot.set(_t,kt),_t.addEventListener("dispose",function Er(){Cr.dispose(),ot.delete(_t),_t.removeEventListener("dispose",Er)})}let Kt=0;for(let en=0;en<Tt.length;en++)Kt+=Tt[en];const $t=_t.morphTargetsRelative?1:1-Kt;Pt.getUniforms().setValue(dt,"morphTargetBaseInfluence",$t),Pt.getUniforms().setValue(dt,"morphTargetInfluences",Tt),Pt.getUniforms().setValue(dt,"morphTargetsTexture",kt.texture,b),Pt.getUniforms().setValue(dt,"morphTargetsTextureSize",kt.size)}else{const Rt=Tt===void 0?0:Tt.length;let Nt=et[_t.id];if(Nt===void 0||Nt.length!==Rt){Nt=[];for(let ln=0;ln<Rt;ln++)Nt[ln]=[ln,0];et[_t.id]=Nt}for(let ln=0;ln<Rt;ln++){const gn=Nt[ln];gn[0]=ln,gn[1]=Tt[ln]}Nt.sort(FS);for(let ln=0;ln<8;ln++)ln<Rt&&Nt[ln][1]?(ht[ln][0]=Nt[ln][0],ht[ln][1]=Nt[ln][1]):(ht[ln][0]=Number.MAX_SAFE_INTEGER,ht[ln][1]=0);ht.sort(NS);const kt=_t.morphAttributes.position,Kt=_t.morphAttributes.normal;let $t=0;for(let ln=0;ln<8;ln++){const gn=ht[ln],_n=gn[0],An=gn[1];_n!==Number.MAX_SAFE_INTEGER&&An?(kt&&_t.getAttribute("morphTarget"+ln)!==kt[_n]&&_t.setAttribute("morphTarget"+ln,kt[_n]),Kt&&_t.getAttribute("morphNormal"+ln)!==Kt[_n]&&_t.setAttribute("morphNormal"+ln,Kt[_n]),tt[ln]=An,$t+=An):(kt&&_t.hasAttribute("morphTarget"+ln)===!0&&_t.deleteAttribute("morphTarget"+ln),Kt&&_t.hasAttribute("morphNormal"+ln)===!0&&_t.deleteAttribute("morphNormal"+ln),tt[ln]=0)}const en=_t.morphTargetsRelative?1:1-$t;Pt.getUniforms().setValue(dt,"morphTargetBaseInfluence",en),Pt.getUniforms().setValue(dt,"morphTargetInfluences",tt)}}}}function El(dt,o,b,et){let tt=new WeakMap;function ot(lt){const ht=lt.target;ht.removeEventListener("dispose",ot),b.remove(ht.instanceMatrix),ht.instanceColor!==null&&b.remove(ht.instanceColor)}return{update:function(lt){const ht=et.render.frame,vt=lt.geometry,_t=o.get(lt,vt);return tt.get(_t)!==ht&&(o.update(_t),tt.set(_t,ht)),lt.isInstancedMesh&&(lt.hasEventListener("dispose",ot)===!1&&lt.addEventListener("dispose",ot),b.update(lt.instanceMatrix,34962),lt.instanceColor!==null&&b.update(lt.instanceColor,34962)),_t},dispose:function(){tt=new WeakMap}}}const QM=new vu,US=new I0,jS=new L_,zS=new UA,GM=[],k1=[],VS=new Float32Array(16),Wm=new Float32Array(9),wv=new Float32Array(4);function VA(dt,o,b){const et=dt[0];if(et<=0||et>0)return dt;const tt=o*b;let ot=GM[tt];if(ot===void 0&&(ot=new Float32Array(tt),GM[tt]=ot),o!==0){et.toArray(ot,0);for(let lt=1,ht=0;lt!==o;++lt)ht+=b,dt[lt].toArray(ot,ht)}return ot}function _h(dt,o){if(dt.length!==o.length)return!1;for(let b=0,et=dt.length;b<et;b++)if(dt[b]!==o[b])return!1;return!0}function iu(dt,o){for(let b=0,et=o.length;b<et;b++)dt[b]=o[b]}function Gw(dt,o){let b=k1[o];b===void 0&&(b=new Int32Array(o),k1[o]=b);for(let et=0;et!==o;++et)b[et]=dt.allocateTextureUnit();return b}function Hw(dt,o){const b=this.cache;b[0]!==o&&(dt.uniform1f(this.addr,o),b[0]=o)}function QS(dt,o){const b=this.cache;if(o.x!==void 0)b[0]===o.x&&b[1]===o.y||(dt.uniform2f(this.addr,o.x,o.y),b[0]=o.x,b[1]=o.y);else{if(_h(b,o))return;dt.uniform2fv(this.addr,o),iu(b,o)}}function Ww(dt,o){const b=this.cache;if(o.x!==void 0)b[0]===o.x&&b[1]===o.y&&b[2]===o.z||(dt.uniform3f(this.addr,o.x,o.y,o.z),b[0]=o.x,b[1]=o.y,b[2]=o.z);else if(o.r!==void 0)b[0]===o.r&&b[1]===o.g&&b[2]===o.b||(dt.uniform3f(this.addr,o.r,o.g,o.b),b[0]=o.r,b[1]=o.g,b[2]=o.b);else{if(_h(b,o))return;dt.uniform3fv(this.addr,o),iu(b,o)}}function HM(dt,o){const b=this.cache;if(o.x!==void 0)b[0]===o.x&&b[1]===o.y&&b[2]===o.z&&b[3]===o.w||(dt.uniform4f(this.addr,o.x,o.y,o.z,o.w),b[0]=o.x,b[1]=o.y,b[2]=o.z,b[3]=o.w);else{if(_h(b,o))return;dt.uniform4fv(this.addr,o),iu(b,o)}}function GS(dt,o){const b=this.cache,et=o.elements;if(et===void 0){if(_h(b,o))return;dt.uniformMatrix2fv(this.addr,!1,o),iu(b,o)}else{if(_h(b,et))return;wv.set(et),dt.uniformMatrix2fv(this.addr,!1,wv),iu(b,et)}}function cp(dt,o){const b=this.cache,et=o.elements;if(et===void 0){if(_h(b,o))return;dt.uniformMatrix3fv(this.addr,!1,o),iu(b,o)}else{if(_h(b,et))return;Wm.set(et),dt.uniformMatrix3fv(this.addr,!1,Wm),iu(b,et)}}function xv(dt,o){const b=this.cache,et=o.elements;if(et===void 0){if(_h(b,o))return;dt.uniformMatrix4fv(this.addr,!1,o),iu(b,o)}else{if(_h(b,et))return;VS.set(et),dt.uniformMatrix4fv(this.addr,!1,VS),iu(b,et)}}function qw(dt,o){const b=this.cache;b[0]!==o&&(dt.uniform1i(this.addr,o),b[0]=o)}function B1(dt,o){const b=this.cache;_h(b,o)||(dt.uniform2iv(this.addr,o),iu(b,o))}function bv(dt,o){const b=this.cache;_h(b,o)||(dt.uniform3iv(this.addr,o),iu(b,o))}function HS(dt,o){const b=this.cache;_h(b,o)||(dt.uniform4iv(this.addr,o),iu(b,o))}function O1(dt,o){const b=this.cache;b[0]!==o&&(dt.uniform1ui(this.addr,o),b[0]=o)}function WM(dt,o){const b=this.cache;_h(b,o)||(dt.uniform2uiv(this.addr,o),iu(b,o))}function L1(dt,o){const b=this.cache;_h(b,o)||(dt.uniform3uiv(this.addr,o),iu(b,o))}function Ev(dt,o){const b=this.cache;_h(b,o)||(dt.uniform4uiv(this.addr,o),iu(b,o))}function Em(dt,o,b){const et=this.cache,tt=b.allocateTextureUnit();et[0]!==tt&&(dt.uniform1i(this.addr,tt),et[0]=tt),b.setTexture2D(o||QM,tt)}function N1(dt,o,b){const et=this.cache,tt=b.allocateTextureUnit();et[0]!==tt&&(dt.uniform1i(this.addr,tt),et[0]=tt),b.setTexture3D(o||jS,tt)}function qM(dt,o,b){const et=this.cache,tt=b.allocateTextureUnit();et[0]!==tt&&(dt.uniform1i(this.addr,tt),et[0]=tt),b.setTextureCube(o||zS,tt)}function F1(dt,o,b){const et=this.cache,tt=b.allocateTextureUnit();et[0]!==tt&&(dt.uniform1i(this.addr,tt),et[0]=tt),b.setTexture2DArray(o||US,tt)}function YM(dt,o){dt.uniform1fv(this.addr,o)}function WS(dt,o){const b=VA(o,this.size,2);dt.uniform2fv(this.addr,b)}function U1(dt,o){const b=VA(o,this.size,3);dt.uniform3fv(this.addr,b)}function XM(dt,o){const b=VA(o,this.size,4);dt.uniform4fv(this.addr,b)}function KM(dt,o){const b=VA(o,this.size,4);dt.uniformMatrix2fv(this.addr,!1,b)}function hP(dt,o){const b=VA(o,this.size,9);dt.uniformMatrix3fv(this.addr,!1,b)}function $M(dt,o){const b=VA(o,this.size,16);dt.uniformMatrix4fv(this.addr,!1,b)}function JM(dt,o){dt.uniform1iv(this.addr,o)}function ZM(dt,o){dt.uniform2iv(this.addr,o)}function lm(dt,o){dt.uniform3iv(this.addr,o)}function Pl(dt,o){dt.uniform4iv(this.addr,o)}function eT(dt,o){dt.uniform1uiv(this.addr,o)}function jy(dt,o){dt.uniform2uiv(this.addr,o)}function cm(dt,o){dt.uniform3uiv(this.addr,o)}function V0(dt,o){dt.uniform4uiv(this.addr,o)}function _c(dt,o,b){const et=o.length,tt=Gw(b,et);dt.uniform1iv(this.addr,tt);for(let ot=0;ot!==et;++ot)b.setTexture2D(o[ot]||QM,tt[ot])}function tT(dt,o,b){const et=o.length,tt=Gw(b,et);dt.uniform1iv(this.addr,tt);for(let ot=0;ot!==et;++ot)b.setTexture3D(o[ot]||jS,tt[ot])}function qS(dt,o,b){const et=o.length,tt=Gw(b,et);dt.uniform1iv(this.addr,tt);for(let ot=0;ot!==et;++ot)b.setTextureCube(o[ot]||zS,tt[ot])}function nT(dt,o,b){const et=o.length,tt=Gw(b,et);dt.uniform1iv(this.addr,tt);for(let ot=0;ot!==et;++ot)b.setTexture2DArray(o[ot]||US,tt[ot])}class rT{constructor(o,b,et){this.id=o,this.addr=et,this.cache=[],this.setValue=function(tt){switch(tt){case 5126:return Hw;case 35664:return QS;case 35665:return Ww;case 35666:return HM;case 35674:return GS;case 35675:return cp;case 35676:return xv;case 5124:case 35670:return qw;case 35667:case 35671:return B1;case 35668:case 35672:return bv;case 35669:case 35673:return HS;case 5125:return O1;case 36294:return WM;case 36295:return L1;case 36296:return Ev;case 35678:case 36198:case 36298:case 36306:case 35682:return Em;case 35679:case 36299:case 36307:return N1;case 35680:case 36300:case 36308:case 36293:return qM;case 36289:case 36303:case 36311:case 36292:return F1}}(b.type)}}class iT{constructor(o,b,et){this.id=o,this.addr=et,this.cache=[],this.size=b.size,this.setValue=function(tt){switch(tt){case 5126:return YM;case 35664:return WS;case 35665:return U1;case 35666:return XM;case 35674:return KM;case 35675:return hP;case 35676:return $M;case 5124:case 35670:return JM;case 35667:case 35671:return ZM;case 35668:case 35672:return lm;case 35669:case 35673:return Pl;case 5125:return eT;case 36294:return jy;case 36295:return cm;case 36296:return V0;case 35678:case 36198:case 36298:case 36306:case 35682:return _c;case 35679:case 36299:case 36307:return tT;case 35680:case 36300:case 36308:case 36293:return qS;case 36289:case 36303:case 36311:case 36292:return nT}}(b.type)}}class dP{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,b,et){const tt=this.seq;for(let ot=0,lt=tt.length;ot!==lt;++ot){const ht=tt[ot];ht.setValue(o,b[ht.id],et)}}}const YS=/(\w+)(\])?(\[|\.)?/g;function sT(dt,o){dt.seq.push(o),dt.map[o.id]=o}function pP(dt,o,b){const et=dt.name,tt=et.length;for(YS.lastIndex=0;;){const ot=YS.exec(et),lt=YS.lastIndex;let ht=ot[1];const vt=ot[2]==="]",_t=ot[3];if(vt&&(ht|=0),_t===void 0||_t==="["&&lt+2===tt){sT(b,_t===void 0?new rT(ht,dt,o):new iT(ht,dt,o));break}{let Mt=b.map[ht];Mt===void 0&&(Mt=new dP(ht),sT(b,Mt)),b=Mt}}}class j1{constructor(o,b){this.seq=[],this.map={};const et=o.getProgramParameter(b,35718);for(let tt=0;tt<et;++tt){const ot=o.getActiveUniform(b,tt);pP(ot,o.getUniformLocation(b,ot.name),this)}}setValue(o,b,et,tt){const ot=this.map[b];ot!==void 0&&ot.setValue(o,et,tt)}setOptional(o,b,et){const tt=b[et];tt!==void 0&&this.setValue(o,et,tt)}static upload(o,b,et,tt){for(let ot=0,lt=b.length;ot!==lt;++ot){const ht=b[ot],vt=et[ht.id];vt.needsUpdate!==!1&&ht.setValue(o,vt.value,tt)}}static seqWithValue(o,b){const et=[];for(let tt=0,ot=o.length;tt!==ot;++tt){const lt=o[tt];lt.id in b&&et.push(lt)}return et}}function oT(dt,o,b){const et=dt.createShader(o);return dt.shaderSource(et,b),dt.compileShader(et),et}let XS=0;function Yw(dt){switch(dt){case vm:return["Linear","( value )"];case po:return["sRGB","( value )"];case M_:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",dt),["Linear","( value )"]}}function Dl(dt,o,b){const et=dt.getShaderParameter(o,35713),tt=dt.getShaderInfoLog(o).trim();if(et&&tt==="")return"";const ot=/ERROR: 0:(\d+)/.exec(tt);if(ot){const lt=parseInt(ot[1]);return b.toUpperCase()+`

`+tt+`

`+function(ht,vt){const _t=ht.split(`
`),Mt=[],Pt=Math.max(vt-6,0),Tt=Math.min(vt+6,_t.length);for(let Rt=Pt;Rt<Tt;Rt++){const Nt=Rt+1;Mt.push(`${Nt===vt?">":" "} ${Nt}: ${_t[Rt]}`)}return Mt.join(`
`)}(dt.getShaderSource(o),lt)}return tt}function aT(dt,o){const b=Yw(o);return"vec4 "+dt+"( vec4 value ) { return "+b[0]+"ToLinear"+b[1]+"; }"}function lT(dt,o){const b=Yw(o);return"vec4 "+dt+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"}function z1(dt,o){let b;switch(o){case go:b="Linear";break;case ks:b="Reinhard";break;case or:b="OptimizedCineon";break;case to:b="ACESFilmic";break;case co:b="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),b="Linear"}return"vec3 "+dt+"( vec3 color ) { return "+b+"ToneMapping( color ); }"}function Q0(dt){return dt!==""}function Sv(dt,o){const b=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return dt.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,b).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function KS(dt,o){return dt.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const Xw=/^[ \t]*#include +<([\w\d./]+)>/gm;function H_(dt){return dt.replace(Xw,Kw)}function Kw(dt,o){const b=io[o];if(b===void 0)throw new Error("Can not resolve #include <"+o+">");return H_(b)}const V1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function QA(dt){return dt.replace(V1,$w)}function $w(dt,o,b,et){let tt="";for(let ot=parseInt(o);ot<parseInt(b);ot++)tt+=et.replace(/\[\s*i\s*\]/g,"[ "+ot+" ]").replace(/UNROLLED_LOOP_INDEX/g,ot);return tt}function cT(dt){let o="precision "+dt.precision+` float;
precision `+dt.precision+" int;";return dt.precision==="highp"?o+=`
#define HIGH_PRECISION`:dt.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:dt.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function fP(dt,o,b,et){const tt=dt.getContext(),ot=b.defines;let lt=b.vertexShader,ht=b.fragmentShader;const vt=function(Nn){let Jn="SHADOWMAP_TYPE_BASIC";return Nn.shadowMapType===Yt?Jn="SHADOWMAP_TYPE_PCF":Nn.shadowMapType===Vt?Jn="SHADOWMAP_TYPE_PCF_SOFT":Nn.shadowMapType===qt&&(Jn="SHADOWMAP_TYPE_VSM"),Jn}(b),_t=function(Nn){let Jn="ENVMAP_TYPE_CUBE";if(Nn.envMap)switch(Nn.envMapMode){case Oo:case Mo:Jn="ENVMAP_TYPE_CUBE";break;case Hl:Jn="ENVMAP_TYPE_CUBE_UV"}return Jn}(b),Mt=function(Nn){let Jn="ENVMAP_MODE_REFLECTION";return Nn.envMap&&Nn.envMapMode===Mo&&(Jn="ENVMAP_MODE_REFRACTION"),Jn}(b),Pt=function(Nn){let Jn="ENVMAP_BLENDING_NONE";if(Nn.envMap)switch(Nn.combine){case ds:Jn="ENVMAP_BLENDING_MULTIPLY";break;case is:Jn="ENVMAP_BLENDING_MIX";break;case Us:Jn="ENVMAP_BLENDING_ADD"}return Jn}(b),Tt=function(Nn){const Jn=Nn.envMapCubeUVHeight;if(Jn===null)return null;const tr=Math.log2(Jn)-2,jn=1/Jn;return{texelWidth:1/(3*Math.max(Math.pow(2,tr),112)),texelHeight:jn,maxMip:tr}}(b),Rt=b.isWebGL2?"":function(Nn){return[Nn.extensionDerivatives||Nn.envMapCubeUVHeight||Nn.bumpMap||Nn.tangentSpaceNormalMap||Nn.clearcoatNormalMap||Nn.flatShading||Nn.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Nn.extensionFragDepth||Nn.logarithmicDepthBuffer)&&Nn.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Nn.extensionDrawBuffers&&Nn.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Nn.extensionShaderTextureLOD||Nn.envMap||Nn.transmission)&&Nn.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Q0).join(`
`)}(b),Nt=function(Nn){const Jn=[];for(const tr in Nn){const jn=Nn[tr];jn!==!1&&Jn.push("#define "+tr+" "+jn)}return Jn.join(`
`)}(ot),kt=tt.createProgram();let Kt,$t,en=b.glslVersion?"#version "+b.glslVersion+`
`:"";b.isRawShaderMaterial?(Kt=[Nt].filter(Q0).join(`
`),Kt.length>0&&(Kt+=`
`),$t=[Rt,Nt].filter(Q0).join(`
`),$t.length>0&&($t+=`
`)):(Kt=[cT(b),"#define SHADER_NAME "+b.shaderName,Nt,b.instancing?"#define USE_INSTANCING":"",b.instancingColor?"#define USE_INSTANCING_COLOR":"",b.supportsVertexTextures?"#define VERTEX_TEXTURES":"",b.useFog&&b.fog?"#define USE_FOG":"",b.useFog&&b.fogExp2?"#define FOG_EXP2":"",b.map?"#define USE_MAP":"",b.envMap?"#define USE_ENVMAP":"",b.envMap?"#define "+Mt:"",b.lightMap?"#define USE_LIGHTMAP":"",b.aoMap?"#define USE_AOMAP":"",b.emissiveMap?"#define USE_EMISSIVEMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.normalMap&&b.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",b.normalMap&&b.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",b.clearcoatMap?"#define USE_CLEARCOATMAP":"",b.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",b.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",b.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",b.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",b.displacementMap&&b.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",b.specularColorMap?"#define USE_SPECULARCOLORMAP":"",b.roughnessMap?"#define USE_ROUGHNESSMAP":"",b.metalnessMap?"#define USE_METALNESSMAP":"",b.alphaMap?"#define USE_ALPHAMAP":"",b.transmission?"#define USE_TRANSMISSION":"",b.transmissionMap?"#define USE_TRANSMISSIONMAP":"",b.thicknessMap?"#define USE_THICKNESSMAP":"",b.sheenColorMap?"#define USE_SHEENCOLORMAP":"",b.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",b.vertexTangents?"#define USE_TANGENT":"",b.vertexColors?"#define USE_COLOR":"",b.vertexAlphas?"#define USE_COLOR_ALPHA":"",b.vertexUvs?"#define USE_UV":"",b.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",b.flatShading?"#define FLAT_SHADED":"",b.skinning?"#define USE_SKINNING":"",b.morphTargets?"#define USE_MORPHTARGETS":"",b.morphNormals&&b.flatShading===!1?"#define USE_MORPHNORMALS":"",b.morphColors&&b.isWebGL2?"#define USE_MORPHCOLORS":"",b.morphTargetsCount>0&&b.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",b.morphTargetsCount>0&&b.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+b.morphTextureStride:"",b.morphTargetsCount>0&&b.isWebGL2?"#define MORPHTARGETS_COUNT "+b.morphTargetsCount:"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"",b.shadowMapEnabled?"#define USE_SHADOWMAP":"",b.shadowMapEnabled?"#define "+vt:"",b.sizeAttenuation?"#define USE_SIZEATTENUATION":"",b.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",b.logarithmicDepthBuffer&&b.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Q0).join(`
`),$t=[Rt,cT(b),"#define SHADER_NAME "+b.shaderName,Nt,b.useFog&&b.fog?"#define USE_FOG":"",b.useFog&&b.fogExp2?"#define FOG_EXP2":"",b.map?"#define USE_MAP":"",b.matcap?"#define USE_MATCAP":"",b.envMap?"#define USE_ENVMAP":"",b.envMap?"#define "+_t:"",b.envMap?"#define "+Mt:"",b.envMap?"#define "+Pt:"",Tt?"#define CUBEUV_TEXEL_WIDTH "+Tt.texelWidth:"",Tt?"#define CUBEUV_TEXEL_HEIGHT "+Tt.texelHeight:"",Tt?"#define CUBEUV_MAX_MIP "+Tt.maxMip+".0":"",b.lightMap?"#define USE_LIGHTMAP":"",b.aoMap?"#define USE_AOMAP":"",b.emissiveMap?"#define USE_EMISSIVEMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.normalMap&&b.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",b.normalMap&&b.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",b.clearcoat?"#define USE_CLEARCOAT":"",b.clearcoatMap?"#define USE_CLEARCOATMAP":"",b.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",b.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",b.iridescence?"#define USE_IRIDESCENCE":"",b.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",b.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",b.specularColorMap?"#define USE_SPECULARCOLORMAP":"",b.roughnessMap?"#define USE_ROUGHNESSMAP":"",b.metalnessMap?"#define USE_METALNESSMAP":"",b.alphaMap?"#define USE_ALPHAMAP":"",b.alphaTest?"#define USE_ALPHATEST":"",b.sheen?"#define USE_SHEEN":"",b.sheenColorMap?"#define USE_SHEENCOLORMAP":"",b.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",b.transmission?"#define USE_TRANSMISSION":"",b.transmissionMap?"#define USE_TRANSMISSIONMAP":"",b.thicknessMap?"#define USE_THICKNESSMAP":"",b.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",b.vertexTangents?"#define USE_TANGENT":"",b.vertexColors||b.instancingColor?"#define USE_COLOR":"",b.vertexAlphas?"#define USE_COLOR_ALPHA":"",b.vertexUvs?"#define USE_UV":"",b.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",b.gradientMap?"#define USE_GRADIENTMAP":"",b.flatShading?"#define FLAT_SHADED":"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"",b.shadowMapEnabled?"#define USE_SHADOWMAP":"",b.shadowMapEnabled?"#define "+vt:"",b.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",b.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",b.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",b.logarithmicDepthBuffer&&b.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",b.toneMapping!==Os?"#define TONE_MAPPING":"",b.toneMapping!==Os?io.tonemapping_pars_fragment:"",b.toneMapping!==Os?z1("toneMapping",b.toneMapping):"",b.dithering?"#define DITHERING":"",b.opaque?"#define OPAQUE":"",io.encodings_pars_fragment,lT("linearToOutputTexel",b.outputEncoding),b.transmissionSamplerMapEncoding?aT("transmissionSamplerMapTexelToLinear",b.transmissionSamplerMapEncoding):"",b.useDepthPacking?"#define DEPTH_PACKING "+b.depthPacking:"",`
`].filter(Q0).join(`
`)),lt=H_(lt),lt=Sv(lt,b),lt=KS(lt,b),ht=H_(ht),ht=Sv(ht,b),ht=KS(ht,b),lt=QA(lt),ht=QA(ht),b.isWebGL2&&b.isRawShaderMaterial!==!0&&(en=`#version 300 es
`,Kt=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Kt,$t=["#define varying in",b.glslVersion===dv?"":"layout(location = 0) out highp vec4 pc_fragColor;",b.glslVersion===dv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+$t);const ln=en+$t+ht,gn=oT(tt,35633,en+Kt+lt),_n=oT(tt,35632,ln);if(tt.attachShader(kt,gn),tt.attachShader(kt,_n),b.index0AttributeName!==void 0?tt.bindAttribLocation(kt,0,b.index0AttributeName):b.morphTargets===!0&&tt.bindAttribLocation(kt,0,"position"),tt.linkProgram(kt),dt.debug.checkShaderErrors){const Nn=tt.getProgramInfoLog(kt).trim(),Jn=tt.getShaderInfoLog(gn).trim(),tr=tt.getShaderInfoLog(_n).trim();let jn=!0,Cr=!0;if(tt.getProgramParameter(kt,35714)===!1){jn=!1;const Ur=Dl(tt,gn,"vertex"),Er=Dl(tt,_n,"fragment");console.error("THREE.WebGLProgram: Shader Error "+tt.getError()+" - VALIDATE_STATUS "+tt.getProgramParameter(kt,35715)+`

Program Info Log: `+Nn+`
`+Ur+`
`+Er)}else Nn!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Nn):Jn!==""&&tr!==""||(Cr=!1);Cr&&(this.diagnostics={runnable:jn,programLog:Nn,vertexShader:{log:Jn,prefix:Kt},fragmentShader:{log:tr,prefix:$t}})}let An,Ln;return tt.deleteShader(gn),tt.deleteShader(_n),this.getUniforms=function(){return An===void 0&&(An=new j1(tt,kt)),An},this.getAttributes=function(){return Ln===void 0&&(Ln=function(Nn,Jn){const tr={},jn=Nn.getProgramParameter(Jn,35721);for(let Cr=0;Cr<jn;Cr++){const Ur=Nn.getActiveAttrib(Jn,Cr),Er=Ur.name;let qr=1;Ur.type===35674&&(qr=2),Ur.type===35675&&(qr=3),Ur.type===35676&&(qr=4),tr[Er]={type:Ur.type,location:Nn.getAttribLocation(Jn,Er),locationSize:qr}}return tr}(tt,kt)),Ln},this.destroy=function(){et.releaseStatesOfProgram(this),tt.deleteProgram(kt),this.program=void 0},this.name=b.shaderName,this.id=XS++,this.cacheKey=o,this.usedTimes=1,this.program=kt,this.vertexShader=gn,this.fragmentShader=_n,this}let uT=0;class Q1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const b=o.vertexShader,et=o.fragmentShader,tt=this._getShaderStage(b),ot=this._getShaderStage(et),lt=this._getShaderCacheForMaterial(o);return lt.has(tt)===!1&&(lt.add(tt),tt.usedTimes++),lt.has(ot)===!1&&(lt.add(ot),ot.usedTimes++),this}remove(o){const b=this.materialCache.get(o);for(const et of b)et.usedTimes--,et.usedTimes===0&&this.shaderCache.delete(et.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const b=this.materialCache;let et=b.get(o);return et===void 0&&(et=new Set,b.set(o,et)),et}_getShaderStage(o){const b=this.shaderCache;let et=b.get(o);return et===void 0&&(et=new hT(o),b.set(o,et)),et}}class hT{constructor(o){this.id=uT++,this.code=o,this.usedTimes=0}}function mP(dt,o,b,et,tt,ot,lt){const ht=new op,vt=new Q1,_t=[],Mt=tt.isWebGL2,Pt=tt.logarithmicDepthBuffer,Tt=tt.vertexTextures;let Rt=tt.precision;const Nt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(kt,Kt,$t,en,ln){const gn=en.fog,_n=ln.geometry,An=kt.isMeshStandardMaterial?en.environment:null,Ln=(kt.isMeshStandardMaterial?b:o).get(kt.envMap||An),Nn=Ln&&Ln.mapping===Hl?Ln.image.height:null,Jn=Nt[kt.type];kt.precision!==null&&(Rt=tt.getMaxPrecision(kt.precision),Rt!==kt.precision&&console.warn("THREE.WebGLProgram.getParameters:",kt.precision,"not supported, using",Rt,"instead."));const tr=_n.morphAttributes.position||_n.morphAttributes.normal||_n.morphAttributes.color,jn=tr!==void 0?tr.length:0;let Cr,Ur,Er,qr,Yr=0;if(_n.morphAttributes.position!==void 0&&(Yr=1),_n.morphAttributes.normal!==void 0&&(Yr=2),_n.morphAttributes.color!==void 0&&(Yr=3),Jn){const ws=am[Jn];Cr=ws.vertexShader,Ur=ws.fragmentShader}else Cr=kt.vertexShader,Ur=kt.fragmentShader,vt.update(kt),Er=vt.getVertexShaderID(kt),qr=vt.getFragmentShaderID(kt);const fr=dt.getRenderTarget(),_r=dt.userData&&dt.userData.transmissionRenderTarget,Qr=kt.alphaTest>0,Mr=kt.clearcoat>0,Wr=kt.iridescence>0;return{isWebGL2:Mt,shaderID:Jn,shaderName:kt.type,vertexShader:Cr,fragmentShader:Ur,defines:kt.defines,customVertexShaderID:Er,customFragmentShaderID:qr,isRawShaderMaterial:kt.isRawShaderMaterial===!0,glslVersion:kt.glslVersion,precision:Rt,instancing:ln.isInstancedMesh===!0,instancingColor:ln.isInstancedMesh===!0&&ln.instanceColor!==null,supportsVertexTextures:Tt,outputEncoding:fr===null?dt.outputEncoding:fr.isXRRenderTarget===!0||fr.texture.encoding!==po?fr.texture.encoding:vm,map:!!kt.map,matcap:!!kt.matcap,envMap:!!Ln,envMapMode:Ln&&Ln.mapping,envMapCubeUVHeight:Nn,lightMap:!!kt.lightMap,aoMap:!!kt.aoMap,emissiveMap:!!kt.emissiveMap,bumpMap:!!kt.bumpMap,normalMap:!!kt.normalMap,objectSpaceNormalMap:kt.normalMapType===Pu,tangentSpaceNormalMap:kt.normalMapType===Iu,decodeVideoTexture:!!kt.map&&kt.map.isVideoTexture===!0&&kt.map.encoding===po,clearcoat:Mr,clearcoatMap:Mr&&!!kt.clearcoatMap,clearcoatRoughnessMap:Mr&&!!kt.clearcoatRoughnessMap,clearcoatNormalMap:Mr&&!!kt.clearcoatNormalMap,iridescence:Wr,iridescenceMap:Wr&&!!kt.iridescenceMap,iridescenceThicknessMap:Wr&&!!kt.iridescenceThicknessMap,displacementMap:!!kt.displacementMap,roughnessMap:!!kt.roughnessMap,metalnessMap:!!kt.metalnessMap,specularMap:!!kt.specularMap,specularIntensityMap:!!kt.specularIntensityMap,specularColorMap:!!kt.specularColorMap,opaque:kt.transparent===!1&&kt.blending===Ut&&!(kt.transmission>0),alphaMap:!!kt.alphaMap,alphaTest:Qr,gradientMap:!!kt.gradientMap,sheen:kt.sheen>0,sheenColorMap:!!kt.sheenColorMap,sheenRoughnessMap:!!kt.sheenRoughnessMap,transmission:kt.transmission>0,transmissionMap:!!kt.transmissionMap,transmissionSamplerMapEncoding:_r?_r.texture.encoding:vm,thicknessMap:!!kt.thicknessMap,combine:kt.combine,vertexTangents:!!kt.normalMap&&!!_n.attributes.tangent,vertexColors:kt.vertexColors,vertexAlphas:kt.vertexColors===!0&&!!_n.attributes.color&&_n.attributes.color.itemSize===4,vertexUvs:!!(kt.map||kt.bumpMap||kt.normalMap||kt.specularMap||kt.alphaMap||kt.emissiveMap||kt.roughnessMap||kt.metalnessMap||kt.clearcoatMap||kt.clearcoatRoughnessMap||kt.clearcoatNormalMap||kt.iridescenceMap||kt.iridescenceThicknessMap||kt.displacementMap||kt.transmissionMap||kt.thicknessMap||kt.specularIntensityMap||kt.specularColorMap||kt.sheenColorMap||kt.sheenRoughnessMap),uvsVertexOnly:!(kt.map||kt.bumpMap||kt.normalMap||kt.specularMap||kt.alphaMap||kt.emissiveMap||kt.roughnessMap||kt.metalnessMap||kt.clearcoatNormalMap||kt.iridescenceMap||kt.iridescenceThicknessMap||kt.transmission>0||kt.transmissionMap||kt.thicknessMap||kt.specularIntensityMap||kt.specularColorMap||kt.sheen>0||kt.sheenColorMap||kt.sheenRoughnessMap||!kt.displacementMap),fog:!!gn,useFog:kt.fog===!0,fogExp2:gn&&gn.isFogExp2,flatShading:!!kt.flatShading,sizeAttenuation:kt.sizeAttenuation,logarithmicDepthBuffer:Pt,skinning:ln.isSkinnedMesh===!0,morphTargets:_n.morphAttributes.position!==void 0,morphNormals:_n.morphAttributes.normal!==void 0,morphColors:_n.morphAttributes.color!==void 0,morphTargetsCount:jn,morphTextureStride:Yr,numDirLights:Kt.directional.length,numPointLights:Kt.point.length,numSpotLights:Kt.spot.length,numSpotLightMaps:Kt.spotLightMap.length,numRectAreaLights:Kt.rectArea.length,numHemiLights:Kt.hemi.length,numDirLightShadows:Kt.directionalShadowMap.length,numPointLightShadows:Kt.pointShadowMap.length,numSpotLightShadows:Kt.spotShadowMap.length,numSpotLightShadowsWithMaps:Kt.numSpotLightShadowsWithMaps,numClippingPlanes:lt.numPlanes,numClipIntersection:lt.numIntersection,dithering:kt.dithering,shadowMapEnabled:dt.shadowMap.enabled&&$t.length>0,shadowMapType:dt.shadowMap.type,toneMapping:kt.toneMapped?dt.toneMapping:Os,physicallyCorrectLights:dt.physicallyCorrectLights,premultipliedAlpha:kt.premultipliedAlpha,doubleSided:kt.side===sn,flipSided:kt.side===jt,useDepthPacking:!!kt.depthPacking,depthPacking:kt.depthPacking||0,index0AttributeName:kt.index0AttributeName,extensionDerivatives:kt.extensions&&kt.extensions.derivatives,extensionFragDepth:kt.extensions&&kt.extensions.fragDepth,extensionDrawBuffers:kt.extensions&&kt.extensions.drawBuffers,extensionShaderTextureLOD:kt.extensions&&kt.extensions.shaderTextureLOD,rendererExtensionFragDepth:Mt||et.has("EXT_frag_depth"),rendererExtensionDrawBuffers:Mt||et.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:Mt||et.has("EXT_shader_texture_lod"),customProgramCacheKey:kt.customProgramCacheKey()}},getProgramCacheKey:function(kt){const Kt=[];if(kt.shaderID?Kt.push(kt.shaderID):(Kt.push(kt.customVertexShaderID),Kt.push(kt.customFragmentShaderID)),kt.defines!==void 0)for(const $t in kt.defines)Kt.push($t),Kt.push(kt.defines[$t]);return kt.isRawShaderMaterial===!1&&(function($t,en){$t.push(en.precision),$t.push(en.outputEncoding),$t.push(en.envMapMode),$t.push(en.envMapCubeUVHeight),$t.push(en.combine),$t.push(en.vertexUvs),$t.push(en.fogExp2),$t.push(en.sizeAttenuation),$t.push(en.morphTargetsCount),$t.push(en.morphAttributeCount),$t.push(en.numDirLights),$t.push(en.numPointLights),$t.push(en.numSpotLights),$t.push(en.numSpotLightMaps),$t.push(en.numHemiLights),$t.push(en.numRectAreaLights),$t.push(en.numDirLightShadows),$t.push(en.numPointLightShadows),$t.push(en.numSpotLightShadows),$t.push(en.numSpotLightShadowsWithMaps),$t.push(en.shadowMapType),$t.push(en.toneMapping),$t.push(en.numClippingPlanes),$t.push(en.numClipIntersection),$t.push(en.depthPacking)}(Kt,kt),function($t,en){ht.disableAll(),en.isWebGL2&&ht.enable(0),en.supportsVertexTextures&&ht.enable(1),en.instancing&&ht.enable(2),en.instancingColor&&ht.enable(3),en.map&&ht.enable(4),en.matcap&&ht.enable(5),en.envMap&&ht.enable(6),en.lightMap&&ht.enable(7),en.aoMap&&ht.enable(8),en.emissiveMap&&ht.enable(9),en.bumpMap&&ht.enable(10),en.normalMap&&ht.enable(11),en.objectSpaceNormalMap&&ht.enable(12),en.tangentSpaceNormalMap&&ht.enable(13),en.clearcoat&&ht.enable(14),en.clearcoatMap&&ht.enable(15),en.clearcoatRoughnessMap&&ht.enable(16),en.clearcoatNormalMap&&ht.enable(17),en.iridescence&&ht.enable(18),en.iridescenceMap&&ht.enable(19),en.iridescenceThicknessMap&&ht.enable(20),en.displacementMap&&ht.enable(21),en.specularMap&&ht.enable(22),en.roughnessMap&&ht.enable(23),en.metalnessMap&&ht.enable(24),en.gradientMap&&ht.enable(25),en.alphaMap&&ht.enable(26),en.alphaTest&&ht.enable(27),en.vertexColors&&ht.enable(28),en.vertexAlphas&&ht.enable(29),en.vertexUvs&&ht.enable(30),en.vertexTangents&&ht.enable(31),en.uvsVertexOnly&&ht.enable(32),$t.push(ht.mask),ht.disableAll(),en.fog&&ht.enable(0),en.useFog&&ht.enable(1),en.flatShading&&ht.enable(2),en.logarithmicDepthBuffer&&ht.enable(3),en.skinning&&ht.enable(4),en.morphTargets&&ht.enable(5),en.morphNormals&&ht.enable(6),en.morphColors&&ht.enable(7),en.premultipliedAlpha&&ht.enable(8),en.shadowMapEnabled&&ht.enable(9),en.physicallyCorrectLights&&ht.enable(10),en.doubleSided&&ht.enable(11),en.flipSided&&ht.enable(12),en.useDepthPacking&&ht.enable(13),en.dithering&&ht.enable(14),en.specularIntensityMap&&ht.enable(15),en.specularColorMap&&ht.enable(16),en.transmission&&ht.enable(17),en.transmissionMap&&ht.enable(18),en.thicknessMap&&ht.enable(19),en.sheen&&ht.enable(20),en.sheenColorMap&&ht.enable(21),en.sheenRoughnessMap&&ht.enable(22),en.decodeVideoTexture&&ht.enable(23),en.opaque&&ht.enable(24),$t.push(ht.mask)}(Kt,kt),Kt.push(dt.outputEncoding)),Kt.push(kt.customProgramCacheKey),Kt.join()},getUniforms:function(kt){const Kt=Nt[kt.type];let $t;if(Kt){const en=am[Kt];$t=OM.clone(en.uniforms)}else $t=kt.uniforms;return $t},acquireProgram:function(kt,Kt){let $t;for(let en=0,ln=_t.length;en<ln;en++){const gn=_t[en];if(gn.cacheKey===Kt){$t=gn,++$t.usedTimes;break}}return $t===void 0&&($t=new fP(dt,Kt,kt,ot),_t.push($t)),$t},releaseProgram:function(kt){if(--kt.usedTimes==0){const Kt=_t.indexOf(kt);_t[Kt]=_t[_t.length-1],_t.pop(),kt.destroy()}},releaseShaderCache:function(kt){vt.remove(kt)},programs:_t,dispose:function(){vt.dispose()}}}function dT(){let dt=new WeakMap;return{get:function(o){let b=dt.get(o);return b===void 0&&(b={},dt.set(o,b)),b},remove:function(o){dt.delete(o)},update:function(o,b,et){dt.get(o)[b]=et},dispose:function(){dt=new WeakMap}}}function pT(dt,o){return dt.groupOrder!==o.groupOrder?dt.groupOrder-o.groupOrder:dt.renderOrder!==o.renderOrder?dt.renderOrder-o.renderOrder:dt.material.id!==o.material.id?dt.material.id-o.material.id:dt.z!==o.z?dt.z-o.z:dt.id-o.id}function $S(dt,o){return dt.groupOrder!==o.groupOrder?dt.groupOrder-o.groupOrder:dt.renderOrder!==o.renderOrder?dt.renderOrder-o.renderOrder:dt.z!==o.z?o.z-dt.z:dt.id-o.id}function fT(){const dt=[];let o=0;const b=[],et=[],tt=[];function ot(lt,ht,vt,_t,Mt,Pt){let Tt=dt[o];return Tt===void 0?(Tt={id:lt.id,object:lt,geometry:ht,material:vt,groupOrder:_t,renderOrder:lt.renderOrder,z:Mt,group:Pt},dt[o]=Tt):(Tt.id=lt.id,Tt.object=lt,Tt.geometry=ht,Tt.material=vt,Tt.groupOrder=_t,Tt.renderOrder=lt.renderOrder,Tt.z=Mt,Tt.group=Pt),o++,Tt}return{opaque:b,transmissive:et,transparent:tt,init:function(){o=0,b.length=0,et.length=0,tt.length=0},push:function(lt,ht,vt,_t,Mt,Pt){const Tt=ot(lt,ht,vt,_t,Mt,Pt);vt.transmission>0?et.push(Tt):vt.transparent===!0?tt.push(Tt):b.push(Tt)},unshift:function(lt,ht,vt,_t,Mt,Pt){const Tt=ot(lt,ht,vt,_t,Mt,Pt);vt.transmission>0?et.unshift(Tt):vt.transparent===!0?tt.unshift(Tt):b.unshift(Tt)},finish:function(){for(let lt=o,ht=dt.length;lt<ht;lt++){const vt=dt[lt];if(vt.id===null)break;vt.id=null,vt.object=null,vt.geometry=null,vt.material=null,vt.group=null}},sort:function(lt,ht){b.length>1&&b.sort(lt||pT),et.length>1&&et.sort(ht||$S),tt.length>1&&tt.sort(ht||$S)}}}function JS(){let dt=new WeakMap;return{get:function(o,b){const et=dt.get(o);let tt;return et===void 0?(tt=new fT,dt.set(o,[tt])):b>=et.length?(tt=new fT,et.push(tt)):tt=et[b],tt},dispose:function(){dt=new WeakMap}}}function ZS(){const dt={};return{get:function(o){if(dt[o.id]!==void 0)return dt[o.id];let b;switch(o.type){case"DirectionalLight":b={direction:new xn,color:new as};break;case"SpotLight":b={position:new xn,direction:new xn,color:new as,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":b={position:new xn,color:new as,distance:0,decay:0};break;case"HemisphereLight":b={direction:new xn,skyColor:new as,groundColor:new as};break;case"RectAreaLight":b={color:new as,position:new xn,halfWidth:new xn,halfHeight:new xn}}return dt[o.id]=b,b}}}let Jw=0;function G1(dt,o){return(o.castShadow?2:0)-(dt.castShadow?2:0)+(o.map?1:0)-(dt.map?1:0)}function mT(dt,o){const b=new ZS,et=function(){const vt={};return{get:function(_t){if(vt[_t.id]!==void 0)return vt[_t.id];let Mt;switch(_t.type){case"DirectionalLight":case"SpotLight":Mt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lr};break;case"PointLight":Mt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lr,shadowCameraNear:1,shadowCameraFar:1e3}}return vt[_t.id]=Mt,Mt}}}(),tt={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let vt=0;vt<9;vt++)tt.probe.push(new xn);const ot=new xn,lt=new zs,ht=new zs;return{setup:function(vt,_t){let Mt=0,Pt=0,Tt=0;for(let Jn=0;Jn<9;Jn++)tt.probe[Jn].set(0,0,0);let Rt=0,Nt=0,kt=0,Kt=0,$t=0,en=0,ln=0,gn=0,_n=0,An=0;vt.sort(G1);const Ln=_t!==!0?Math.PI:1;for(let Jn=0,tr=vt.length;Jn<tr;Jn++){const jn=vt[Jn],Cr=jn.color,Ur=jn.intensity,Er=jn.distance,qr=jn.shadow&&jn.shadow.map?jn.shadow.map.texture:null;if(jn.isAmbientLight)Mt+=Cr.r*Ur*Ln,Pt+=Cr.g*Ur*Ln,Tt+=Cr.b*Ur*Ln;else if(jn.isLightProbe)for(let Yr=0;Yr<9;Yr++)tt.probe[Yr].addScaledVector(jn.sh.coefficients[Yr],Ur);else if(jn.isDirectionalLight){const Yr=b.get(jn);if(Yr.color.copy(jn.color).multiplyScalar(jn.intensity*Ln),jn.castShadow){const fr=jn.shadow,_r=et.get(jn);_r.shadowBias=fr.bias,_r.shadowNormalBias=fr.normalBias,_r.shadowRadius=fr.radius,_r.shadowMapSize=fr.mapSize,tt.directionalShadow[Rt]=_r,tt.directionalShadowMap[Rt]=qr,tt.directionalShadowMatrix[Rt]=jn.shadow.matrix,en++}tt.directional[Rt]=Yr,Rt++}else if(jn.isSpotLight){const Yr=b.get(jn);Yr.position.setFromMatrixPosition(jn.matrixWorld),Yr.color.copy(Cr).multiplyScalar(Ur*Ln),Yr.distance=Er,Yr.coneCos=Math.cos(jn.angle),Yr.penumbraCos=Math.cos(jn.angle*(1-jn.penumbra)),Yr.decay=jn.decay,tt.spot[kt]=Yr;const fr=jn.shadow;if(jn.map&&(tt.spotLightMap[_n]=jn.map,_n++,fr.updateMatrices(jn),jn.castShadow&&An++),tt.spotLightMatrix[kt]=fr.matrix,jn.castShadow){const _r=et.get(jn);_r.shadowBias=fr.bias,_r.shadowNormalBias=fr.normalBias,_r.shadowRadius=fr.radius,_r.shadowMapSize=fr.mapSize,tt.spotShadow[kt]=_r,tt.spotShadowMap[kt]=qr,gn++}kt++}else if(jn.isRectAreaLight){const Yr=b.get(jn);Yr.color.copy(Cr).multiplyScalar(Ur),Yr.halfWidth.set(.5*jn.width,0,0),Yr.halfHeight.set(0,.5*jn.height,0),tt.rectArea[Kt]=Yr,Kt++}else if(jn.isPointLight){const Yr=b.get(jn);if(Yr.color.copy(jn.color).multiplyScalar(jn.intensity*Ln),Yr.distance=jn.distance,Yr.decay=jn.decay,jn.castShadow){const fr=jn.shadow,_r=et.get(jn);_r.shadowBias=fr.bias,_r.shadowNormalBias=fr.normalBias,_r.shadowRadius=fr.radius,_r.shadowMapSize=fr.mapSize,_r.shadowCameraNear=fr.camera.near,_r.shadowCameraFar=fr.camera.far,tt.pointShadow[Nt]=_r,tt.pointShadowMap[Nt]=qr,tt.pointShadowMatrix[Nt]=jn.shadow.matrix,ln++}tt.point[Nt]=Yr,Nt++}else if(jn.isHemisphereLight){const Yr=b.get(jn);Yr.skyColor.copy(jn.color).multiplyScalar(Ur*Ln),Yr.groundColor.copy(jn.groundColor).multiplyScalar(Ur*Ln),tt.hemi[$t]=Yr,$t++}}Kt>0&&(o.isWebGL2||dt.has("OES_texture_float_linear")===!0?(tt.rectAreaLTC1=es.LTC_FLOAT_1,tt.rectAreaLTC2=es.LTC_FLOAT_2):dt.has("OES_texture_half_float_linear")===!0?(tt.rectAreaLTC1=es.LTC_HALF_1,tt.rectAreaLTC2=es.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),tt.ambient[0]=Mt,tt.ambient[1]=Pt,tt.ambient[2]=Tt;const Nn=tt.hash;Nn.directionalLength===Rt&&Nn.pointLength===Nt&&Nn.spotLength===kt&&Nn.rectAreaLength===Kt&&Nn.hemiLength===$t&&Nn.numDirectionalShadows===en&&Nn.numPointShadows===ln&&Nn.numSpotShadows===gn&&Nn.numSpotMaps===_n||(tt.directional.length=Rt,tt.spot.length=kt,tt.rectArea.length=Kt,tt.point.length=Nt,tt.hemi.length=$t,tt.directionalShadow.length=en,tt.directionalShadowMap.length=en,tt.pointShadow.length=ln,tt.pointShadowMap.length=ln,tt.spotShadow.length=gn,tt.spotShadowMap.length=gn,tt.directionalShadowMatrix.length=en,tt.pointShadowMatrix.length=ln,tt.spotLightMatrix.length=gn+_n-An,tt.spotLightMap.length=_n,tt.numSpotLightShadowsWithMaps=An,Nn.directionalLength=Rt,Nn.pointLength=Nt,Nn.spotLength=kt,Nn.rectAreaLength=Kt,Nn.hemiLength=$t,Nn.numDirectionalShadows=en,Nn.numPointShadows=ln,Nn.numSpotShadows=gn,Nn.numSpotMaps=_n,tt.version=Jw++)},setupView:function(vt,_t){let Mt=0,Pt=0,Tt=0,Rt=0,Nt=0;const kt=_t.matrixWorldInverse;for(let Kt=0,$t=vt.length;Kt<$t;Kt++){const en=vt[Kt];if(en.isDirectionalLight){const ln=tt.directional[Mt];ln.direction.setFromMatrixPosition(en.matrixWorld),ot.setFromMatrixPosition(en.target.matrixWorld),ln.direction.sub(ot),ln.direction.transformDirection(kt),Mt++}else if(en.isSpotLight){const ln=tt.spot[Tt];ln.position.setFromMatrixPosition(en.matrixWorld),ln.position.applyMatrix4(kt),ln.direction.setFromMatrixPosition(en.matrixWorld),ot.setFromMatrixPosition(en.target.matrixWorld),ln.direction.sub(ot),ln.direction.transformDirection(kt),Tt++}else if(en.isRectAreaLight){const ln=tt.rectArea[Rt];ln.position.setFromMatrixPosition(en.matrixWorld),ln.position.applyMatrix4(kt),ht.identity(),lt.copy(en.matrixWorld),lt.premultiply(kt),ht.extractRotation(lt),ln.halfWidth.set(.5*en.width,0,0),ln.halfHeight.set(0,.5*en.height,0),ln.halfWidth.applyMatrix4(ht),ln.halfHeight.applyMatrix4(ht),Rt++}else if(en.isPointLight){const ln=tt.point[Pt];ln.position.setFromMatrixPosition(en.matrixWorld),ln.position.applyMatrix4(kt),Pt++}else if(en.isHemisphereLight){const ln=tt.hemi[Nt];ln.direction.setFromMatrixPosition(en.matrixWorld),ln.direction.transformDirection(kt),Nt++}}},state:tt}}function H1(dt,o){const b=new mT(dt,o),et=[],tt=[];return{init:function(){et.length=0,tt.length=0},state:{lightsArray:et,shadowsArray:tt,lights:b},setupLights:function(ot){b.setup(et,ot)},setupLightsView:function(ot){b.setupView(et,ot)},pushLight:function(ot){et.push(ot)},pushShadow:function(ot){tt.push(ot)}}}function gT(dt,o){let b=new WeakMap;return{get:function(et,tt=0){const ot=b.get(et);let lt;return ot===void 0?(lt=new H1(dt,o),b.set(et,[lt])):tt>=ot.length?(lt=new H1(dt,o),ot.push(lt)):lt=ot[tt],lt},dispose:function(){b=new WeakMap}}}class Zw extends Lu{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ip,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class GA extends Lu{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new xn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.referencePosition.copy(o.referencePosition),this.nearDistance=o.nearDistance,this.farDistance=o.farDistance,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}function vT(dt,o,b){let et=new Qw;const tt=new Lr,ot=new Lr,lt=new Uo,ht=new Zw({depthPacking:b0}),vt=new GA,_t={},Mt=b.maxTextureSize,Pt={0:jt,1:Jt,2:sn},Tt=new yv({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Lr},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),Rt=Tt.clone();Rt.defines.HORIZONTAL_PASS=1;const Nt=new ms;Nt.setAttribute("position",new ga(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const kt=new Nu(Nt,Tt),Kt=this;function $t(gn,_n){const An=o.update(kt);Tt.defines.VSM_SAMPLES!==gn.blurSamples&&(Tt.defines.VSM_SAMPLES=gn.blurSamples,Rt.defines.VSM_SAMPLES=gn.blurSamples,Tt.needsUpdate=!0,Rt.needsUpdate=!0),gn.mapPass===null&&(gn.mapPass=new wp(tt.x,tt.y)),Tt.uniforms.shadow_pass.value=gn.map.texture,Tt.uniforms.resolution.value=gn.mapSize,Tt.uniforms.radius.value=gn.radius,dt.setRenderTarget(gn.mapPass),dt.clear(),dt.renderBufferDirect(_n,null,An,Tt,kt,null),Rt.uniforms.shadow_pass.value=gn.mapPass.texture,Rt.uniforms.resolution.value=gn.mapSize,Rt.uniforms.radius.value=gn.radius,dt.setRenderTarget(gn.map),dt.clear(),dt.renderBufferDirect(_n,null,An,Rt,kt,null)}function en(gn,_n,An,Ln,Nn,Jn){let tr=null;const jn=An.isPointLight===!0?gn.customDistanceMaterial:gn.customDepthMaterial;if(tr=jn!==void 0?jn:An.isPointLight===!0?vt:ht,dt.localClippingEnabled&&_n.clipShadows===!0&&Array.isArray(_n.clippingPlanes)&&_n.clippingPlanes.length!==0||_n.displacementMap&&_n.displacementScale!==0||_n.alphaMap&&_n.alphaTest>0){const Cr=tr.uuid,Ur=_n.uuid;let Er=_t[Cr];Er===void 0&&(Er={},_t[Cr]=Er);let qr=Er[Ur];qr===void 0&&(qr=tr.clone(),Er[Ur]=qr),tr=qr}return tr.visible=_n.visible,tr.wireframe=_n.wireframe,tr.side=Jn===qt?_n.shadowSide!==null?_n.shadowSide:_n.side:_n.shadowSide!==null?_n.shadowSide:Pt[_n.side],tr.alphaMap=_n.alphaMap,tr.alphaTest=_n.alphaTest,tr.clipShadows=_n.clipShadows,tr.clippingPlanes=_n.clippingPlanes,tr.clipIntersection=_n.clipIntersection,tr.displacementMap=_n.displacementMap,tr.displacementScale=_n.displacementScale,tr.displacementBias=_n.displacementBias,tr.wireframeLinewidth=_n.wireframeLinewidth,tr.linewidth=_n.linewidth,An.isPointLight===!0&&tr.isMeshDistanceMaterial===!0&&(tr.referencePosition.setFromMatrixPosition(An.matrixWorld),tr.nearDistance=Ln,tr.farDistance=Nn),tr}function ln(gn,_n,An,Ln,Nn){if(gn.visible===!1)return;if(gn.layers.test(_n.layers)&&(gn.isMesh||gn.isLine||gn.isPoints)&&(gn.castShadow||gn.receiveShadow&&Nn===qt)&&(!gn.frustumCulled||et.intersectsObject(gn))){gn.modelViewMatrix.multiplyMatrices(An.matrixWorldInverse,gn.matrixWorld);const tr=o.update(gn),jn=gn.material;if(Array.isArray(jn)){const Cr=tr.groups;for(let Ur=0,Er=Cr.length;Ur<Er;Ur++){const qr=Cr[Ur],Yr=jn[qr.materialIndex];if(Yr&&Yr.visible){const fr=en(gn,Yr,Ln,An.near,An.far,Nn);dt.renderBufferDirect(An,null,tr,fr,gn,qr)}}}else if(jn.visible){const Cr=en(gn,jn,Ln,An.near,An.far,Nn);dt.renderBufferDirect(An,null,tr,Cr,gn,null)}}const Jn=gn.children;for(let tr=0,jn=Jn.length;tr<jn;tr++)ln(Jn[tr],_n,An,Ln,Nn)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Yt,this.render=function(gn,_n,An){if(Kt.enabled===!1||Kt.autoUpdate===!1&&Kt.needsUpdate===!1||gn.length===0)return;const Ln=dt.getRenderTarget(),Nn=dt.getActiveCubeFace(),Jn=dt.getActiveMipmapLevel(),tr=dt.state;tr.setBlending(Ft),tr.buffers.color.setClear(1,1,1,1),tr.buffers.depth.setTest(!0),tr.setScissorTest(!1);for(let jn=0,Cr=gn.length;jn<Cr;jn++){const Ur=gn[jn],Er=Ur.shadow;if(Er===void 0){console.warn("THREE.WebGLShadowMap:",Ur,"has no shadow.");continue}if(Er.autoUpdate===!1&&Er.needsUpdate===!1)continue;tt.copy(Er.mapSize);const qr=Er.getFrameExtents();if(tt.multiply(qr),ot.copy(Er.mapSize),(tt.x>Mt||tt.y>Mt)&&(tt.x>Mt&&(ot.x=Math.floor(Mt/qr.x),tt.x=ot.x*qr.x,Er.mapSize.x=ot.x),tt.y>Mt&&(ot.y=Math.floor(Mt/qr.y),tt.y=ot.y*qr.y,Er.mapSize.y=ot.y)),Er.map===null){const fr=this.type!==qt?{minFilter:qo,magFilter:qo}:{};Er.map=new wp(tt.x,tt.y,fr),Er.map.texture.name=Ur.name+".shadowMap",Er.camera.updateProjectionMatrix()}dt.setRenderTarget(Er.map),dt.clear();const Yr=Er.getViewportCount();for(let fr=0;fr<Yr;fr++){const _r=Er.getViewport(fr);lt.set(ot.x*_r.x,ot.y*_r.y,ot.x*_r.z,ot.y*_r.w),tr.viewport(lt),Er.updateMatrices(Ur,fr),et=Er.getFrustum(),ln(_n,An,Er.camera,Ur,this.type)}Er.isPointLightShadow!==!0&&this.type===qt&&$t(Er,An),Er.needsUpdate=!1}Kt.needsUpdate=!1,dt.setRenderTarget(Ln,Nn,Jn)}}function eC(dt,o,b){const et=b.isWebGL2,tt=new function(){let cn=!1;const vr=new Uo;let rr=null;const Sr=new Uo(0,0,0,0);return{setMask:function(Pr){rr===Pr||cn||(dt.colorMask(Pr,Pr,Pr,Pr),rr=Pr)},setLocked:function(Pr){cn=Pr},setClear:function(Pr,Zr,Ss,Ns,eo){eo===!0&&(Pr*=Ns,Zr*=Ns,Ss*=Ns),vr.set(Pr,Zr,Ss,Ns),Sr.equals(vr)===!1&&(dt.clearColor(Pr,Zr,Ss,Ns),Sr.copy(vr))},reset:function(){cn=!1,rr=null,Sr.set(-1,0,0,0)}}},ot=new function(){let cn=!1,vr=null,rr=null,Sr=null;return{setTest:function(Pr){Pr?Es(2929):so(2929)},setMask:function(Pr){vr===Pr||cn||(dt.depthMask(Pr),vr=Pr)},setFunc:function(Pr){if(rr!==Pr){if(Pr)switch(Pr){case xr:dt.depthFunc(512);break;case Wn:dt.depthFunc(519);break;case on:dt.depthFunc(513);break;case pn:dt.depthFunc(515);break;case On:dt.depthFunc(514);break;case Tr:dt.depthFunc(518);break;case kr:dt.depthFunc(516);break;case Br:dt.depthFunc(517);break;default:dt.depthFunc(515)}else dt.depthFunc(515);rr=Pr}},setLocked:function(Pr){cn=Pr},setClear:function(Pr){Sr!==Pr&&(dt.clearDepth(Pr),Sr=Pr)},reset:function(){cn=!1,vr=null,rr=null,Sr=null}}},lt=new function(){let cn=!1,vr=null,rr=null,Sr=null,Pr=null,Zr=null,Ss=null,Ns=null,eo=null;return{setTest:function(Bs){cn||(Bs?Es(2960):so(2960))},setMask:function(Bs){vr===Bs||cn||(dt.stencilMask(Bs),vr=Bs)},setFunc:function(Bs,Fs,$o){rr===Bs&&Sr===Fs&&Pr===$o||(dt.stencilFunc(Bs,Fs,$o),rr=Bs,Sr=Fs,Pr=$o)},setOp:function(Bs,Fs,$o){Zr===Bs&&Ss===Fs&&Ns===$o||(dt.stencilOp(Bs,Fs,$o),Zr=Bs,Ss=Fs,Ns=$o)},setLocked:function(Bs){cn=Bs},setClear:function(Bs){eo!==Bs&&(dt.clearStencil(Bs),eo=Bs)},reset:function(){cn=!1,vr=null,rr=null,Sr=null,Pr=null,Zr=null,Ss=null,Ns=null,eo=null}}},ht=new WeakMap,vt=new WeakMap;let _t={},Mt={},Pt=new WeakMap,Tt=[],Rt=null,Nt=!1,kt=null,Kt=null,$t=null,en=null,ln=null,gn=null,_n=null,An=!1,Ln=null,Nn=null,Jn=null,tr=null,jn=null;const Cr=dt.getParameter(35661);let Ur=!1,Er=0;const qr=dt.getParameter(7938);qr.indexOf("WebGL")!==-1?(Er=parseFloat(/^WebGL (\d)/.exec(qr)[1]),Ur=Er>=1):qr.indexOf("OpenGL ES")!==-1&&(Er=parseFloat(/^OpenGL ES (\d)/.exec(qr)[1]),Ur=Er>=2);let Yr=null,fr={};const _r=dt.getParameter(3088),Qr=dt.getParameter(2978),Mr=new Uo().fromArray(_r),Wr=new Uo().fromArray(Qr);function ws(cn,vr,rr){const Sr=new Uint8Array(4),Pr=dt.createTexture();dt.bindTexture(cn,Pr),dt.texParameteri(cn,10241,9728),dt.texParameteri(cn,10240,9728);for(let Zr=0;Zr<rr;Zr++)dt.texImage2D(vr+Zr,0,6408,1,1,0,6408,5121,Sr);return Pr}const fo={};function Es(cn){_t[cn]!==!0&&(dt.enable(cn),_t[cn]=!0)}function so(cn){_t[cn]!==!1&&(dt.disable(cn),_t[cn]=!1)}fo[3553]=ws(3553,3553,1),fo[34067]=ws(34067,34069,6),tt.setClear(0,0,0,1),ot.setClear(1),lt.setClear(0),Es(2929),ot.setFunc(pn),Xn(!1),kn(At),Es(2884),sr(Ft);const Rn={[zt]:32774,[Wt]:32778,[Zt]:32779};if(et)Rn[mn]=32775,Rn[hn]=32776;else{const cn=o.get("EXT_blend_minmax");cn!==null&&(Rn[mn]=cn.MIN_EXT,Rn[hn]=cn.MAX_EXT)}const Mn={[zn]:0,[lr]:1,[ar]:768,[Zn]:770,[$n]:776,[un]:774,[Vn]:772,[ur]:769,[wr]:771,[er]:775,[Kn]:773};function sr(cn,vr,rr,Sr,Pr,Zr,Ss,Ns){if(cn!==Ft){if(Nt===!1&&(Es(3042),Nt=!0),cn===dn)Pr=Pr||vr,Zr=Zr||rr,Ss=Ss||Sr,vr===Kt&&Pr===ln||(dt.blendEquationSeparate(Rn[vr],Rn[Pr]),Kt=vr,ln=Pr),rr===$t&&Sr===en&&Zr===gn&&Ss===_n||(dt.blendFuncSeparate(Mn[rr],Mn[Sr],Mn[Zr],Mn[Ss]),$t=rr,en=Sr,gn=Zr,_n=Ss),kt=cn,An=null;else if(cn!==kt||Ns!==An){if(Kt===zt&&ln===zt||(dt.blendEquation(32774),Kt=zt,ln=zt),Ns)switch(cn){case Ut:dt.blendFuncSeparate(1,771,1,771);break;case Ht:dt.blendFunc(1,1);break;case an:dt.blendFuncSeparate(0,769,0,1);break;case nn:dt.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",cn)}else switch(cn){case Ut:dt.blendFuncSeparate(770,771,1,771);break;case Ht:dt.blendFunc(770,1);break;case an:dt.blendFuncSeparate(0,769,0,1);break;case nn:dt.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",cn)}$t=null,en=null,gn=null,_n=null,kt=cn,An=Ns}}else Nt===!0&&(so(3042),Nt=!1)}function Xn(cn){Ln!==cn&&(cn?dt.frontFace(2304):dt.frontFace(2305),Ln=cn)}function kn(cn){cn!==pt?(Es(2884),cn!==Nn&&(cn===At?dt.cullFace(1029):cn===St?dt.cullFace(1028):dt.cullFace(1032))):so(2884),Nn=cn}function qn(cn,vr,rr){cn?(Es(32823),tr===vr&&jn===rr||(dt.polygonOffset(vr,rr),tr=vr,jn=rr)):so(32823)}function gr(cn){cn===void 0&&(cn=33984+Cr-1),Yr!==cn&&(dt.activeTexture(cn),Yr=cn)}return{buffers:{color:tt,depth:ot,stencil:lt},enable:Es,disable:so,bindFramebuffer:function(cn,vr){return Mt[cn]!==vr&&(dt.bindFramebuffer(cn,vr),Mt[cn]=vr,et&&(cn===36009&&(Mt[36160]=vr),cn===36160&&(Mt[36009]=vr)),!0)},drawBuffers:function(cn,vr){let rr=Tt,Sr=!1;if(cn)if(rr=Pt.get(vr),rr===void 0&&(rr=[],Pt.set(vr,rr)),cn.isWebGLMultipleRenderTargets){const Pr=cn.texture;if(rr.length!==Pr.length||rr[0]!==36064){for(let Zr=0,Ss=Pr.length;Zr<Ss;Zr++)rr[Zr]=36064+Zr;rr.length=Pr.length,Sr=!0}}else rr[0]!==36064&&(rr[0]=36064,Sr=!0);else rr[0]!==1029&&(rr[0]=1029,Sr=!0);Sr&&(b.isWebGL2?dt.drawBuffers(rr):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(rr))},useProgram:function(cn){return Rt!==cn&&(dt.useProgram(cn),Rt=cn,!0)},setBlending:sr,setMaterial:function(cn,vr){cn.side===sn?so(2884):Es(2884);let rr=cn.side===jt;vr&&(rr=!rr),Xn(rr),cn.blending===Ut&&cn.transparent===!1?sr(Ft):sr(cn.blending,cn.blendEquation,cn.blendSrc,cn.blendDst,cn.blendEquationAlpha,cn.blendSrcAlpha,cn.blendDstAlpha,cn.premultipliedAlpha),ot.setFunc(cn.depthFunc),ot.setTest(cn.depthTest),ot.setMask(cn.depthWrite),tt.setMask(cn.colorWrite);const Sr=cn.stencilWrite;lt.setTest(Sr),Sr&&(lt.setMask(cn.stencilWriteMask),lt.setFunc(cn.stencilFunc,cn.stencilRef,cn.stencilFuncMask),lt.setOp(cn.stencilFail,cn.stencilZFail,cn.stencilZPass)),qn(cn.polygonOffset,cn.polygonOffsetFactor,cn.polygonOffsetUnits),cn.alphaToCoverage===!0?Es(32926):so(32926)},setFlipSided:Xn,setCullFace:kn,setLineWidth:function(cn){cn!==Jn&&(Ur&&dt.lineWidth(cn),Jn=cn)},setPolygonOffset:qn,setScissorTest:function(cn){cn?Es(3089):so(3089)},activeTexture:gr,bindTexture:function(cn,vr){Yr===null&&gr();let rr=fr[Yr];rr===void 0&&(rr={type:void 0,texture:void 0},fr[Yr]=rr),rr.type===cn&&rr.texture===vr||(dt.bindTexture(cn,vr||fo[cn]),rr.type=cn,rr.texture=vr)},unbindTexture:function(){const cn=fr[Yr];cn!==void 0&&cn.type!==void 0&&(dt.bindTexture(cn.type,null),cn.type=void 0,cn.texture=void 0)},compressedTexImage2D:function(){try{dt.compressedTexImage2D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},texImage2D:function(){try{dt.texImage2D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},texImage3D:function(){try{dt.texImage3D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},updateUBOMapping:function(cn,vr){let rr=vt.get(vr);rr===void 0&&(rr=new WeakMap,vt.set(vr,rr));let Sr=rr.get(cn);Sr===void 0&&(Sr=dt.getUniformBlockIndex(vr,cn.name),rr.set(cn,Sr))},uniformBlockBinding:function(cn,vr){const rr=vt.get(vr).get(cn);ht.get(cn)!==rr&&(dt.uniformBlockBinding(vr,rr,cn.__bindingPointIndex),ht.set(cn,rr))},texStorage2D:function(){try{dt.texStorage2D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},texStorage3D:function(){try{dt.texStorage3D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},texSubImage2D:function(){try{dt.texSubImage2D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},texSubImage3D:function(){try{dt.texSubImage3D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},compressedTexSubImage2D:function(){try{dt.compressedTexSubImage2D.apply(dt,arguments)}catch(cn){console.error("THREE.WebGLState:",cn)}},scissor:function(cn){Mr.equals(cn)===!1&&(dt.scissor(cn.x,cn.y,cn.z,cn.w),Mr.copy(cn))},viewport:function(cn){Wr.equals(cn)===!1&&(dt.viewport(cn.x,cn.y,cn.z,cn.w),Wr.copy(cn))},reset:function(){dt.disable(3042),dt.disable(2884),dt.disable(2929),dt.disable(32823),dt.disable(3089),dt.disable(2960),dt.disable(32926),dt.blendEquation(32774),dt.blendFunc(1,0),dt.blendFuncSeparate(1,0,1,0),dt.colorMask(!0,!0,!0,!0),dt.clearColor(0,0,0,0),dt.depthMask(!0),dt.depthFunc(513),dt.clearDepth(1),dt.stencilMask(4294967295),dt.stencilFunc(519,0,4294967295),dt.stencilOp(7680,7680,7680),dt.clearStencil(0),dt.cullFace(1029),dt.frontFace(2305),dt.polygonOffset(0,0),dt.activeTexture(33984),dt.bindFramebuffer(36160,null),et===!0&&(dt.bindFramebuffer(36009,null),dt.bindFramebuffer(36008,null)),dt.useProgram(null),dt.lineWidth(1),dt.scissor(0,0,dt.canvas.width,dt.canvas.height),dt.viewport(0,0,dt.canvas.width,dt.canvas.height),_t={},Yr=null,fr={},Mt={},Pt=new WeakMap,Tt=[],Rt=null,Nt=!1,kt=null,Kt=null,$t=null,en=null,ln=null,gn=null,_n=null,An=!1,Ln=null,Nn=null,Jn=null,tr=null,jn=null,Mr.set(0,0,dt.canvas.width,dt.canvas.height),Wr.set(0,0,dt.canvas.width,dt.canvas.height),tt.reset(),ot.reset(),lt.reset()}}}function tC(dt,o,b,et,tt,ot,lt){const ht=tt.isWebGL2,vt=tt.maxTextures,_t=tt.maxCubemapSize,Mt=tt.maxTextureSize,Pt=tt.maxSamples,Tt=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,Rt=/OculusBrowser/g.test(navigator.userAgent),Nt=new WeakMap;let kt;const Kt=new WeakMap;let $t=!1;try{$t=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function en(Rn,Mn){return $t?new OffscreenCanvas(Rn,Mn):B_("canvas")}function ln(Rn,Mn,sr,Xn){let kn=1;if((Rn.width>Xn||Rn.height>Xn)&&(kn=Xn/Math.max(Rn.width,Rn.height)),kn<1||Mn===!0){if(typeof HTMLImageElement<"u"&&Rn instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Rn instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Rn instanceof ImageBitmap){const qn=Mn?sp:Math.floor,gr=qn(kn*Rn.width),cn=qn(kn*Rn.height);kt===void 0&&(kt=en(gr,cn));const vr=sr?en(gr,cn):kt;return vr.width=gr,vr.height=cn,vr.getContext("2d").drawImage(Rn,0,0,gr,cn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Rn.width+"x"+Rn.height+") to ("+gr+"x"+cn+")."),vr}return"data"in Rn&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Rn.width+"x"+Rn.height+")."),Rn}return Rn}function gn(Rn){return Ty(Rn.width)&&Ty(Rn.height)}function _n(Rn,Mn){return Rn.generateMipmaps&&Mn&&Rn.minFilter!==qo&&Rn.minFilter!==Vo}function An(Rn){dt.generateMipmap(Rn)}function Ln(Rn,Mn,sr,Xn,kn=!1){if(ht===!1)return Mn;if(Rn!==null){if(dt[Rn]!==void 0)return dt[Rn];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Rn+"'")}let qn=Mn;return Mn===6403&&(sr===5126&&(qn=33326),sr===5131&&(qn=33325),sr===5121&&(qn=33321)),Mn===33319&&(sr===5126&&(qn=33328),sr===5131&&(qn=33327),sr===5121&&(qn=33323)),Mn===6408&&(sr===5126&&(qn=34836),sr===5131&&(qn=34842),sr===5121&&(qn=Xn===po&&kn===!1?35907:32856),sr===32819&&(qn=32854),sr===32820&&(qn=32855)),qn!==33325&&qn!==33326&&qn!==33327&&qn!==33328&&qn!==34842&&qn!==34836||o.get("EXT_color_buffer_float"),qn}function Nn(Rn,Mn,sr){return _n(Rn,sr)===!0||Rn.isFramebufferTexture&&Rn.minFilter!==qo&&Rn.minFilter!==Vo?Math.log2(Math.max(Mn.width,Mn.height))+1:Rn.mipmaps!==void 0&&Rn.mipmaps.length>0?Rn.mipmaps.length:Rn.isCompressedTexture&&Array.isArray(Rn.image)?Mn.mipmaps.length:1}function Jn(Rn){return Rn===qo||Rn===Lo||Rn===Yo?9728:9729}function tr(Rn){const Mn=Rn.target;Mn.removeEventListener("dispose",tr),function(sr){const Xn=et.get(sr);if(Xn.__webglInit===void 0)return;const kn=sr.source,qn=Kt.get(kn);if(qn){const gr=qn[Xn.__cacheKey];gr.usedTimes--,gr.usedTimes===0&&Cr(sr),Object.keys(qn).length===0&&Kt.delete(kn)}et.remove(sr)}(Mn),Mn.isVideoTexture&&Nt.delete(Mn)}function jn(Rn){const Mn=Rn.target;Mn.removeEventListener("dispose",jn),function(sr){const Xn=sr.texture,kn=et.get(sr),qn=et.get(Xn);if(qn.__webglTexture!==void 0&&(dt.deleteTexture(qn.__webglTexture),lt.memory.textures--),sr.depthTexture&&sr.depthTexture.dispose(),sr.isWebGLCubeRenderTarget)for(let gr=0;gr<6;gr++)dt.deleteFramebuffer(kn.__webglFramebuffer[gr]),kn.__webglDepthbuffer&&dt.deleteRenderbuffer(kn.__webglDepthbuffer[gr]);else{if(dt.deleteFramebuffer(kn.__webglFramebuffer),kn.__webglDepthbuffer&&dt.deleteRenderbuffer(kn.__webglDepthbuffer),kn.__webglMultisampledFramebuffer&&dt.deleteFramebuffer(kn.__webglMultisampledFramebuffer),kn.__webglColorRenderbuffer)for(let gr=0;gr<kn.__webglColorRenderbuffer.length;gr++)kn.__webglColorRenderbuffer[gr]&&dt.deleteRenderbuffer(kn.__webglColorRenderbuffer[gr]);kn.__webglDepthRenderbuffer&&dt.deleteRenderbuffer(kn.__webglDepthRenderbuffer)}if(sr.isWebGLMultipleRenderTargets)for(let gr=0,cn=Xn.length;gr<cn;gr++){const vr=et.get(Xn[gr]);vr.__webglTexture&&(dt.deleteTexture(vr.__webglTexture),lt.memory.textures--),et.remove(Xn[gr])}et.remove(Xn),et.remove(sr)}(Mn)}function Cr(Rn){const Mn=et.get(Rn);dt.deleteTexture(Mn.__webglTexture);const sr=Rn.source;delete Kt.get(sr)[Mn.__cacheKey],lt.memory.textures--}let Ur=0;function Er(Rn,Mn){const sr=et.get(Rn);if(Rn.isVideoTexture&&function(Xn){const kn=lt.render.frame;Nt.get(Xn)!==kn&&(Nt.set(Xn,kn),Xn.update())}(Rn),Rn.isRenderTargetTexture===!1&&Rn.version>0&&sr.__version!==Rn.version){const Xn=Rn.image;if(Xn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Xn.complete!==!1)return void Qr(sr,Rn,Mn);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}b.activeTexture(33984+Mn),b.bindTexture(3553,sr.__webglTexture)}const qr={[vo]:10497,[no]:33071,[Al]:33648},Yr={[qo]:9728,[Lo]:9984,[Yo]:9986,[Vo]:9729,[Mu]:9985,[hs]:9987};function fr(Rn,Mn,sr){if(sr?(dt.texParameteri(Rn,10242,qr[Mn.wrapS]),dt.texParameteri(Rn,10243,qr[Mn.wrapT]),Rn!==32879&&Rn!==35866||dt.texParameteri(Rn,32882,qr[Mn.wrapR]),dt.texParameteri(Rn,10240,Yr[Mn.magFilter]),dt.texParameteri(Rn,10241,Yr[Mn.minFilter])):(dt.texParameteri(Rn,10242,33071),dt.texParameteri(Rn,10243,33071),Rn!==32879&&Rn!==35866||dt.texParameteri(Rn,32882,33071),Mn.wrapS===no&&Mn.wrapT===no||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),dt.texParameteri(Rn,10240,Jn(Mn.magFilter)),dt.texParameteri(Rn,10241,Jn(Mn.minFilter)),Mn.minFilter!==qo&&Mn.minFilter!==Vo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Xn=o.get("EXT_texture_filter_anisotropic");if(Mn.type===ba&&o.has("OES_texture_float_linear")===!1||ht===!1&&Mn.type===Wu&&o.has("OES_texture_half_float_linear")===!1)return;(Mn.anisotropy>1||et.get(Mn).__currentAnisotropy)&&(dt.texParameterf(Rn,Xn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Mn.anisotropy,tt.getMaxAnisotropy())),et.get(Mn).__currentAnisotropy=Mn.anisotropy)}}function _r(Rn,Mn){let sr=!1;Rn.__webglInit===void 0&&(Rn.__webglInit=!0,Mn.addEventListener("dispose",tr));const Xn=Mn.source;let kn=Kt.get(Xn);kn===void 0&&(kn={},Kt.set(Xn,kn));const qn=function(gr){const cn=[];return cn.push(gr.wrapS),cn.push(gr.wrapT),cn.push(gr.magFilter),cn.push(gr.minFilter),cn.push(gr.anisotropy),cn.push(gr.internalFormat),cn.push(gr.format),cn.push(gr.type),cn.push(gr.generateMipmaps),cn.push(gr.premultiplyAlpha),cn.push(gr.flipY),cn.push(gr.unpackAlignment),cn.push(gr.encoding),cn.join()}(Mn);if(qn!==Rn.__cacheKey){kn[qn]===void 0&&(kn[qn]={texture:dt.createTexture(),usedTimes:0},lt.memory.textures++,sr=!0),kn[qn].usedTimes++;const gr=kn[Rn.__cacheKey];gr!==void 0&&(kn[Rn.__cacheKey].usedTimes--,gr.usedTimes===0&&Cr(Mn)),Rn.__cacheKey=qn,Rn.__webglTexture=kn[qn].texture}return sr}function Qr(Rn,Mn,sr){let Xn=3553;Mn.isDataArrayTexture&&(Xn=35866),Mn.isData3DTexture&&(Xn=32879);const kn=_r(Rn,Mn),qn=Mn.source;if(b.activeTexture(33984+sr),b.bindTexture(Xn,Rn.__webglTexture),qn.version!==qn.__currentVersion||kn===!0){dt.pixelStorei(37440,Mn.flipY),dt.pixelStorei(37441,Mn.premultiplyAlpha),dt.pixelStorei(3317,Mn.unpackAlignment),dt.pixelStorei(37443,0);const gr=function(Fs){return!ht&&(Fs.wrapS!==no||Fs.wrapT!==no||Fs.minFilter!==qo&&Fs.minFilter!==Vo)}(Mn)&&gn(Mn.image)===!1;let cn=ln(Mn.image,gr,!1,Mt);cn=so(Mn,cn);const vr=gn(cn)||ht,rr=ot.convert(Mn.format,Mn.encoding);let Sr,Pr=ot.convert(Mn.type),Zr=Ln(Mn.internalFormat,rr,Pr,Mn.encoding,Mn.isVideoTexture);fr(Xn,Mn,vr);const Ss=Mn.mipmaps,Ns=ht&&Mn.isVideoTexture!==!0,eo=qn.__currentVersion===void 0||kn===!0,Bs=Nn(Mn,cn,vr);if(Mn.isDepthTexture)Zr=6402,ht?Zr=Mn.type===ba?36012:Mn.type===Qn?33190:Mn.type===br?35056:33189:Mn.type===ba&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Mn.format===Do&&Zr===6402&&Mn.type!==Hu&&Mn.type!==Qn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Mn.type=Qn,Pr=ot.convert(Mn.type)),Mn.format===Go&&Zr===6402&&(Zr=34041,Mn.type!==br&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Mn.type=br,Pr=ot.convert(Mn.type))),eo&&(Ns?b.texStorage2D(3553,1,Zr,cn.width,cn.height):b.texImage2D(3553,0,Zr,cn.width,cn.height,0,rr,Pr,null));else if(Mn.isDataTexture)if(Ss.length>0&&vr){Ns&&eo&&b.texStorage2D(3553,Bs,Zr,Ss[0].width,Ss[0].height);for(let Fs=0,$o=Ss.length;Fs<$o;Fs++)Sr=Ss[Fs],Ns?b.texSubImage2D(3553,Fs,0,0,Sr.width,Sr.height,rr,Pr,Sr.data):b.texImage2D(3553,Fs,Zr,Sr.width,Sr.height,0,rr,Pr,Sr.data);Mn.generateMipmaps=!1}else Ns?(eo&&b.texStorage2D(3553,Bs,Zr,cn.width,cn.height),b.texSubImage2D(3553,0,0,0,cn.width,cn.height,rr,Pr,cn.data)):b.texImage2D(3553,0,Zr,cn.width,cn.height,0,rr,Pr,cn.data);else if(Mn.isCompressedTexture){Ns&&eo&&b.texStorage2D(3553,Bs,Zr,Ss[0].width,Ss[0].height);for(let Fs=0,$o=Ss.length;Fs<$o;Fs++)Sr=Ss[Fs],Mn.format!==bs?rr!==null?Ns?b.compressedTexSubImage2D(3553,Fs,0,0,Sr.width,Sr.height,rr,Sr.data):b.compressedTexImage2D(3553,Fs,Zr,Sr.width,Sr.height,0,Sr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ns?b.texSubImage2D(3553,Fs,0,0,Sr.width,Sr.height,rr,Pr,Sr.data):b.texImage2D(3553,Fs,Zr,Sr.width,Sr.height,0,rr,Pr,Sr.data)}else if(Mn.isDataArrayTexture)Ns?(eo&&b.texStorage3D(35866,Bs,Zr,cn.width,cn.height,cn.depth),b.texSubImage3D(35866,0,0,0,0,cn.width,cn.height,cn.depth,rr,Pr,cn.data)):b.texImage3D(35866,0,Zr,cn.width,cn.height,cn.depth,0,rr,Pr,cn.data);else if(Mn.isData3DTexture)Ns?(eo&&b.texStorage3D(32879,Bs,Zr,cn.width,cn.height,cn.depth),b.texSubImage3D(32879,0,0,0,0,cn.width,cn.height,cn.depth,rr,Pr,cn.data)):b.texImage3D(32879,0,Zr,cn.width,cn.height,cn.depth,0,rr,Pr,cn.data);else if(Mn.isFramebufferTexture){if(eo)if(Ns)b.texStorage2D(3553,Bs,Zr,cn.width,cn.height);else{let Fs=cn.width,$o=cn.height;for(let Im=0;Im<Bs;Im++)b.texImage2D(3553,Im,Zr,Fs,$o,0,rr,Pr,null),Fs>>=1,$o>>=1}}else if(Ss.length>0&&vr){Ns&&eo&&b.texStorage2D(3553,Bs,Zr,Ss[0].width,Ss[0].height);for(let Fs=0,$o=Ss.length;Fs<$o;Fs++)Sr=Ss[Fs],Ns?b.texSubImage2D(3553,Fs,0,0,rr,Pr,Sr):b.texImage2D(3553,Fs,Zr,rr,Pr,Sr);Mn.generateMipmaps=!1}else Ns?(eo&&b.texStorage2D(3553,Bs,Zr,cn.width,cn.height),b.texSubImage2D(3553,0,0,0,rr,Pr,cn)):b.texImage2D(3553,0,Zr,rr,Pr,cn);_n(Mn,vr)&&An(Xn),qn.__currentVersion=qn.version,Mn.onUpdate&&Mn.onUpdate(Mn)}Rn.__version=Mn.version}function Mr(Rn,Mn,sr,Xn,kn){const qn=ot.convert(sr.format,sr.encoding),gr=ot.convert(sr.type),cn=Ln(sr.internalFormat,qn,gr,sr.encoding);et.get(Mn).__hasExternalTextures||(kn===32879||kn===35866?b.texImage3D(kn,0,cn,Mn.width,Mn.height,Mn.depth,0,qn,gr,null):b.texImage2D(kn,0,cn,Mn.width,Mn.height,0,qn,gr,null)),b.bindFramebuffer(36160,Rn),Es(Mn)?Tt.framebufferTexture2DMultisampleEXT(36160,Xn,kn,et.get(sr).__webglTexture,0,fo(Mn)):dt.framebufferTexture2D(36160,Xn,kn,et.get(sr).__webglTexture,0),b.bindFramebuffer(36160,null)}function Wr(Rn,Mn,sr){if(dt.bindRenderbuffer(36161,Rn),Mn.depthBuffer&&!Mn.stencilBuffer){let Xn=33189;if(sr||Es(Mn)){const kn=Mn.depthTexture;kn&&kn.isDepthTexture&&(kn.type===ba?Xn=36012:kn.type===Qn&&(Xn=33190));const qn=fo(Mn);Es(Mn)?Tt.renderbufferStorageMultisampleEXT(36161,qn,Xn,Mn.width,Mn.height):dt.renderbufferStorageMultisample(36161,qn,Xn,Mn.width,Mn.height)}else dt.renderbufferStorage(36161,Xn,Mn.width,Mn.height);dt.framebufferRenderbuffer(36160,36096,36161,Rn)}else if(Mn.depthBuffer&&Mn.stencilBuffer){const Xn=fo(Mn);sr&&Es(Mn)===!1?dt.renderbufferStorageMultisample(36161,Xn,35056,Mn.width,Mn.height):Es(Mn)?Tt.renderbufferStorageMultisampleEXT(36161,Xn,35056,Mn.width,Mn.height):dt.renderbufferStorage(36161,34041,Mn.width,Mn.height),dt.framebufferRenderbuffer(36160,33306,36161,Rn)}else{const Xn=Mn.isWebGLMultipleRenderTargets===!0?Mn.texture:[Mn.texture];for(let kn=0;kn<Xn.length;kn++){const qn=Xn[kn],gr=ot.convert(qn.format,qn.encoding),cn=ot.convert(qn.type),vr=Ln(qn.internalFormat,gr,cn,qn.encoding),rr=fo(Mn);sr&&Es(Mn)===!1?dt.renderbufferStorageMultisample(36161,rr,vr,Mn.width,Mn.height):Es(Mn)?Tt.renderbufferStorageMultisampleEXT(36161,rr,vr,Mn.width,Mn.height):dt.renderbufferStorage(36161,vr,Mn.width,Mn.height)}}dt.bindRenderbuffer(36161,null)}function ws(Rn){const Mn=et.get(Rn),sr=Rn.isWebGLCubeRenderTarget===!0;if(Rn.depthTexture&&!Mn.__autoAllocateDepthBuffer){if(sr)throw new Error("target.depthTexture not supported in Cube render targets");(function(Xn,kn){if(kn&&kn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(b.bindFramebuffer(36160,Xn),!kn.depthTexture||!kn.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");et.get(kn.depthTexture).__webglTexture&&kn.depthTexture.image.width===kn.width&&kn.depthTexture.image.height===kn.height||(kn.depthTexture.image.width=kn.width,kn.depthTexture.image.height=kn.height,kn.depthTexture.needsUpdate=!0),Er(kn.depthTexture,0);const qn=et.get(kn.depthTexture).__webglTexture,gr=fo(kn);if(kn.depthTexture.format===Do)Es(kn)?Tt.framebufferTexture2DMultisampleEXT(36160,36096,3553,qn,0,gr):dt.framebufferTexture2D(36160,36096,3553,qn,0);else{if(kn.depthTexture.format!==Go)throw new Error("Unknown depthTexture format");Es(kn)?Tt.framebufferTexture2DMultisampleEXT(36160,33306,3553,qn,0,gr):dt.framebufferTexture2D(36160,33306,3553,qn,0)}})(Mn.__webglFramebuffer,Rn)}else if(sr){Mn.__webglDepthbuffer=[];for(let Xn=0;Xn<6;Xn++)b.bindFramebuffer(36160,Mn.__webglFramebuffer[Xn]),Mn.__webglDepthbuffer[Xn]=dt.createRenderbuffer(),Wr(Mn.__webglDepthbuffer[Xn],Rn,!1)}else b.bindFramebuffer(36160,Mn.__webglFramebuffer),Mn.__webglDepthbuffer=dt.createRenderbuffer(),Wr(Mn.__webglDepthbuffer,Rn,!1);b.bindFramebuffer(36160,null)}function fo(Rn){return Math.min(Pt,Rn.samples)}function Es(Rn){const Mn=et.get(Rn);return ht&&Rn.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&Mn.__useRenderToTexture!==!1}function so(Rn,Mn){const sr=Rn.encoding,Xn=Rn.format,kn=Rn.type;return Rn.isCompressedTexture===!0||Rn.isVideoTexture===!0||Rn.format===bA||sr!==vm&&(sr===po?ht===!1?o.has("EXT_sRGB")===!0&&Xn===bs?(Rn.format=bA,Rn.minFilter=Vo,Rn.generateMipmaps=!1):Mn=Py.sRGBToLinear(Mn):Xn===bs&&kn===$l||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):sr===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",sr)),Mn}this.allocateTextureUnit=function(){const Rn=Ur;return Rn>=vt&&console.warn("THREE.WebGLTextures: Trying to use "+Rn+" texture units while this GPU supports only "+vt),Ur+=1,Rn},this.resetTextureUnits=function(){Ur=0},this.setTexture2D=Er,this.setTexture2DArray=function(Rn,Mn){const sr=et.get(Rn);Rn.version>0&&sr.__version!==Rn.version?Qr(sr,Rn,Mn):(b.activeTexture(33984+Mn),b.bindTexture(35866,sr.__webglTexture))},this.setTexture3D=function(Rn,Mn){const sr=et.get(Rn);Rn.version>0&&sr.__version!==Rn.version?Qr(sr,Rn,Mn):(b.activeTexture(33984+Mn),b.bindTexture(32879,sr.__webglTexture))},this.setTextureCube=function(Rn,Mn){const sr=et.get(Rn);Rn.version>0&&sr.__version!==Rn.version?function(Xn,kn,qn){if(kn.image.length!==6)return;const gr=_r(Xn,kn),cn=kn.source;if(b.activeTexture(33984+qn),b.bindTexture(34067,Xn.__webglTexture),cn.version!==cn.__currentVersion||gr===!0){dt.pixelStorei(37440,kn.flipY),dt.pixelStorei(37441,kn.premultiplyAlpha),dt.pixelStorei(3317,kn.unpackAlignment),dt.pixelStorei(37443,0);const vr=kn.isCompressedTexture||kn.image[0].isCompressedTexture,rr=kn.image[0]&&kn.image[0].isDataTexture,Sr=[];for(let $s=0;$s<6;$s++)Sr[$s]=vr||rr?rr?kn.image[$s].image:kn.image[$s]:ln(kn.image[$s],!1,!0,_t),Sr[$s]=so(kn,Sr[$s]);const Pr=Sr[0],Zr=gn(Pr)||ht,Ss=ot.convert(kn.format,kn.encoding),Ns=ot.convert(kn.type),eo=Ln(kn.internalFormat,Ss,Ns,kn.encoding),Bs=ht&&kn.isVideoTexture!==!0,Fs=cn.__currentVersion===void 0||gr===!0;let $o,Im=Nn(kn,Pr,Zr);if(fr(34067,kn,Zr),vr){Bs&&Fs&&b.texStorage2D(34067,Im,eo,Pr.width,Pr.height);for(let $s=0;$s<6;$s++){$o=Sr[$s].mipmaps;for(let _l=0;_l<$o.length;_l++){const yl=$o[_l];kn.format!==bs?Ss!==null?Bs?b.compressedTexSubImage2D(34069+$s,_l,0,0,yl.width,yl.height,Ss,yl.data):b.compressedTexImage2D(34069+$s,_l,eo,yl.width,yl.height,0,yl.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Bs?b.texSubImage2D(34069+$s,_l,0,0,yl.width,yl.height,Ss,Ns,yl.data):b.texImage2D(34069+$s,_l,eo,yl.width,yl.height,0,Ss,Ns,yl.data)}}}else{$o=kn.mipmaps,Bs&&Fs&&($o.length>0&&Im++,b.texStorage2D(34067,Im,eo,Sr[0].width,Sr[0].height));for(let $s=0;$s<6;$s++)if(rr){Bs?b.texSubImage2D(34069+$s,0,0,0,Sr[$s].width,Sr[$s].height,Ss,Ns,Sr[$s].data):b.texImage2D(34069+$s,0,eo,Sr[$s].width,Sr[$s].height,0,Ss,Ns,Sr[$s].data);for(let _l=0;_l<$o.length;_l++){const yl=$o[_l].image[$s].image;Bs?b.texSubImage2D(34069+$s,_l+1,0,0,yl.width,yl.height,Ss,Ns,yl.data):b.texImage2D(34069+$s,_l+1,eo,yl.width,yl.height,0,Ss,Ns,yl.data)}}else{Bs?b.texSubImage2D(34069+$s,0,0,0,Ss,Ns,Sr[$s]):b.texImage2D(34069+$s,0,eo,Ss,Ns,Sr[$s]);for(let _l=0;_l<$o.length;_l++){const yl=$o[_l];Bs?b.texSubImage2D(34069+$s,_l+1,0,0,Ss,Ns,yl.image[$s]):b.texImage2D(34069+$s,_l+1,eo,Ss,Ns,yl.image[$s])}}}_n(kn,Zr)&&An(34067),cn.__currentVersion=cn.version,kn.onUpdate&&kn.onUpdate(kn)}Xn.__version=kn.version}(sr,Rn,Mn):(b.activeTexture(33984+Mn),b.bindTexture(34067,sr.__webglTexture))},this.rebindTextures=function(Rn,Mn,sr){const Xn=et.get(Rn);Mn!==void 0&&Mr(Xn.__webglFramebuffer,Rn,Rn.texture,36064,3553),sr!==void 0&&ws(Rn)},this.setupRenderTarget=function(Rn){const Mn=Rn.texture,sr=et.get(Rn),Xn=et.get(Mn);Rn.addEventListener("dispose",jn),Rn.isWebGLMultipleRenderTargets!==!0&&(Xn.__webglTexture===void 0&&(Xn.__webglTexture=dt.createTexture()),Xn.__version=Mn.version,lt.memory.textures++);const kn=Rn.isWebGLCubeRenderTarget===!0,qn=Rn.isWebGLMultipleRenderTargets===!0,gr=gn(Rn)||ht;if(kn){sr.__webglFramebuffer=[];for(let cn=0;cn<6;cn++)sr.__webglFramebuffer[cn]=dt.createFramebuffer()}else{if(sr.__webglFramebuffer=dt.createFramebuffer(),qn)if(tt.drawBuffers){const cn=Rn.texture;for(let vr=0,rr=cn.length;vr<rr;vr++){const Sr=et.get(cn[vr]);Sr.__webglTexture===void 0&&(Sr.__webglTexture=dt.createTexture(),lt.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(ht&&Rn.samples>0&&Es(Rn)===!1){const cn=qn?Mn:[Mn];sr.__webglMultisampledFramebuffer=dt.createFramebuffer(),sr.__webglColorRenderbuffer=[],b.bindFramebuffer(36160,sr.__webglMultisampledFramebuffer);for(let vr=0;vr<cn.length;vr++){const rr=cn[vr];sr.__webglColorRenderbuffer[vr]=dt.createRenderbuffer(),dt.bindRenderbuffer(36161,sr.__webglColorRenderbuffer[vr]);const Sr=ot.convert(rr.format,rr.encoding),Pr=ot.convert(rr.type),Zr=Ln(rr.internalFormat,Sr,Pr,rr.encoding),Ss=fo(Rn);dt.renderbufferStorageMultisample(36161,Ss,Zr,Rn.width,Rn.height),dt.framebufferRenderbuffer(36160,36064+vr,36161,sr.__webglColorRenderbuffer[vr])}dt.bindRenderbuffer(36161,null),Rn.depthBuffer&&(sr.__webglDepthRenderbuffer=dt.createRenderbuffer(),Wr(sr.__webglDepthRenderbuffer,Rn,!0)),b.bindFramebuffer(36160,null)}}if(kn){b.bindTexture(34067,Xn.__webglTexture),fr(34067,Mn,gr);for(let cn=0;cn<6;cn++)Mr(sr.__webglFramebuffer[cn],Rn,Mn,36064,34069+cn);_n(Mn,gr)&&An(34067),b.unbindTexture()}else if(qn){const cn=Rn.texture;for(let vr=0,rr=cn.length;vr<rr;vr++){const Sr=cn[vr],Pr=et.get(Sr);b.bindTexture(3553,Pr.__webglTexture),fr(3553,Sr,gr),Mr(sr.__webglFramebuffer,Rn,Sr,36064+vr,3553),_n(Sr,gr)&&An(3553)}b.unbindTexture()}else{let cn=3553;(Rn.isWebGL3DRenderTarget||Rn.isWebGLArrayRenderTarget)&&(ht?cn=Rn.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),b.bindTexture(cn,Xn.__webglTexture),fr(cn,Mn,gr),Mr(sr.__webglFramebuffer,Rn,Mn,36064,cn),_n(Mn,gr)&&An(cn),b.unbindTexture()}Rn.depthBuffer&&ws(Rn)},this.updateRenderTargetMipmap=function(Rn){const Mn=gn(Rn)||ht,sr=Rn.isWebGLMultipleRenderTargets===!0?Rn.texture:[Rn.texture],Xn=Rn.isWebGLCubeRenderTarget?34067:3553;for(let kn=0,qn=sr.length;kn<qn;kn++){const gr=sr[kn],cn=et.get(gr),vr=cn.__webglTexture;cn.__version!==gr.version&&(b.bindTexture(Xn,vr),fr(Xn,gr,Mn),b.unbindTexture(),cn.__version=gr.version),_n(gr,Mn)&&(b.bindTexture(Xn,vr),An(Xn),b.unbindTexture())}},this.updateMultisampleRenderTarget=function(Rn){if(ht&&Rn.samples>0&&Es(Rn)===!1){const Mn=Rn.isWebGLMultipleRenderTargets?Rn.texture:[Rn.texture],sr=Rn.width,Xn=Rn.height;let kn=16384;const qn=[],gr=Rn.stencilBuffer?33306:36096,cn=et.get(Rn),vr=Rn.isWebGLMultipleRenderTargets===!0;if(vr)for(let rr=0;rr<Mn.length;rr++)b.bindFramebuffer(36160,cn.__webglMultisampledFramebuffer),dt.framebufferRenderbuffer(36160,36064+rr,36161,null),b.bindFramebuffer(36160,cn.__webglFramebuffer),dt.framebufferTexture2D(36009,36064+rr,3553,null,0);b.bindFramebuffer(36008,cn.__webglMultisampledFramebuffer),b.bindFramebuffer(36009,cn.__webglFramebuffer);for(let rr=0;rr<Mn.length;rr++){qn.push(36064+rr),Rn.depthBuffer&&qn.push(gr);const Sr=cn.__ignoreDepthValues!==void 0&&cn.__ignoreDepthValues;if(Sr===!1&&(Rn.depthBuffer&&(kn|=256),Rn.stencilBuffer&&(kn|=1024)),vr&&dt.framebufferRenderbuffer(36008,36064,36161,cn.__webglColorRenderbuffer[rr]),Sr===!0&&(dt.invalidateFramebuffer(36008,[gr]),dt.invalidateFramebuffer(36009,[gr])),vr){const Pr=et.get(Mn[rr]).__webglTexture;dt.framebufferTexture2D(36009,36064,3553,Pr,0)}dt.blitFramebuffer(0,0,sr,Xn,0,0,sr,Xn,kn,9728),Rt&&dt.invalidateFramebuffer(36008,qn)}if(b.bindFramebuffer(36008,null),b.bindFramebuffer(36009,null),vr)for(let rr=0;rr<Mn.length;rr++){b.bindFramebuffer(36160,cn.__webglMultisampledFramebuffer),dt.framebufferRenderbuffer(36160,36064+rr,36161,cn.__webglColorRenderbuffer[rr]);const Sr=et.get(Mn[rr]).__webglTexture;b.bindFramebuffer(36160,cn.__webglFramebuffer),dt.framebufferTexture2D(36009,36064+rr,3553,Sr,0)}b.bindFramebuffer(36009,cn.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ws,this.setupFrameBufferTexture=Mr,this.useMultisampledRTT=Es}function W1(dt,o,b){const et=b.isWebGL2;return{convert:function(tt,ot=null){let lt;if(tt===$l)return 5121;if(tt===Gs)return 32819;if(tt===Xr)return 32820;if(tt===Cl)return 5120;if(tt===rp)return 5122;if(tt===Hu)return 5123;if(tt===vp)return 5124;if(tt===Qn)return 5125;if(tt===ba)return 5126;if(tt===Wu)return et?5131:(lt=o.get("OES_texture_half_float"),lt!==null?lt.HALF_FLOAT_OES:null);if(tt===Is)return 6406;if(tt===bs)return 6408;if(tt===Qo)return 6409;if(tt===Js)return 6410;if(tt===Do)return 6402;if(tt===Go)return 34041;if(tt===qu)return 6403;if(tt===Ps)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(tt===bA)return lt=o.get("EXT_sRGB"),lt!==null?lt.SRGB_ALPHA_EXT:null;if(tt===ro)return 36244;if(tt===Wl)return 33319;if(tt===_p)return 33320;if(tt===Ho)return 36249;if(tt===yo||tt===Zo||tt===_o||tt===pu)if(ot===po){if(lt=o.get("WEBGL_compressed_texture_s3tc_srgb"),lt===null)return null;if(tt===yo)return lt.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(tt===Zo)return lt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(tt===_o)return lt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(tt===pu)return lt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(lt=o.get("WEBGL_compressed_texture_s3tc"),lt===null)return null;if(tt===yo)return lt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(tt===Zo)return lt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(tt===_o)return lt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(tt===pu)return lt.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(tt===Ao||tt===na||tt===xl||tt===rs){if(lt=o.get("WEBGL_compressed_texture_pvrtc"),lt===null)return null;if(tt===Ao)return lt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(tt===na)return lt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(tt===xl)return lt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(tt===rs)return lt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(tt===Fm)return lt=o.get("WEBGL_compressed_texture_etc1"),lt!==null?lt.COMPRESSED_RGB_ETC1_WEBGL:null;if(tt===ls||tt===Jl){if(lt=o.get("WEBGL_compressed_texture_etc"),lt===null)return null;if(tt===ls)return ot===po?lt.COMPRESSED_SRGB8_ETC2:lt.COMPRESSED_RGB8_ETC2;if(tt===Jl)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:lt.COMPRESSED_RGBA8_ETC2_EAC}if(tt===yp||tt===No||tt===uo||tt===cv||tt===Sy||tt===zv||tt===w_||tt===ho||tt===gA||tt===x_||tt===Vv||tt===Qv||tt===Xo||tt===Fo){if(lt=o.get("WEBGL_compressed_texture_astc"),lt===null)return null;if(tt===yp)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:lt.COMPRESSED_RGBA_ASTC_4x4_KHR;if(tt===No)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:lt.COMPRESSED_RGBA_ASTC_5x4_KHR;if(tt===uo)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:lt.COMPRESSED_RGBA_ASTC_5x5_KHR;if(tt===cv)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:lt.COMPRESSED_RGBA_ASTC_6x5_KHR;if(tt===Sy)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:lt.COMPRESSED_RGBA_ASTC_6x6_KHR;if(tt===zv)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:lt.COMPRESSED_RGBA_ASTC_8x5_KHR;if(tt===w_)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:lt.COMPRESSED_RGBA_ASTC_8x6_KHR;if(tt===ho)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:lt.COMPRESSED_RGBA_ASTC_8x8_KHR;if(tt===gA)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:lt.COMPRESSED_RGBA_ASTC_10x5_KHR;if(tt===x_)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:lt.COMPRESSED_RGBA_ASTC_10x6_KHR;if(tt===Vv)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:lt.COMPRESSED_RGBA_ASTC_10x8_KHR;if(tt===Qv)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:lt.COMPRESSED_RGBA_ASTC_10x10_KHR;if(tt===Xo)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:lt.COMPRESSED_RGBA_ASTC_12x10_KHR;if(tt===Fo)return ot===po?lt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:lt.COMPRESSED_RGBA_ASTC_12x12_KHR}if(tt===uv){if(lt=o.get("EXT_texture_compression_bptc"),lt===null)return null;if(tt===uv)return ot===po?lt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:lt.COMPRESSED_RGBA_BPTC_UNORM_EXT}return tt===br?et?34042:(lt=o.get("WEBGL_depth_texture"),lt!==null?lt.UNSIGNED_INT_24_8_WEBGL:null):dt[tt]!==void 0?dt[tt]:null}}}class nC extends Zu{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class W_ extends Zs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _T={type:"move"};class q1{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new W_,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new W_,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new xn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new xn),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new W_,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new xn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new xn),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,b,et){let tt=null,ot=null,lt=null;const ht=this._targetRay,vt=this._grip,_t=this._hand;if(o&&b.session.visibilityState!=="visible-blurred"){if(_t&&o.hand){lt=!0;for(const kt of o.hand.values()){const Kt=b.getJointPose(kt,et);if(_t.joints[kt.jointName]===void 0){const en=new W_;en.matrixAutoUpdate=!1,en.visible=!1,_t.joints[kt.jointName]=en,_t.add(en)}const $t=_t.joints[kt.jointName];Kt!==null&&($t.matrix.fromArray(Kt.transform.matrix),$t.matrix.decompose($t.position,$t.rotation,$t.scale),$t.jointRadius=Kt.radius),$t.visible=Kt!==null}const Mt=_t.joints["index-finger-tip"],Pt=_t.joints["thumb-tip"],Tt=Mt.position.distanceTo(Pt.position),Rt=.02,Nt=.005;_t.inputState.pinching&&Tt>Rt+Nt?(_t.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!_t.inputState.pinching&&Tt<=Rt-Nt&&(_t.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else vt!==null&&o.gripSpace&&(ot=b.getPose(o.gripSpace,et),ot!==null&&(vt.matrix.fromArray(ot.transform.matrix),vt.matrix.decompose(vt.position,vt.rotation,vt.scale),ot.linearVelocity?(vt.hasLinearVelocity=!0,vt.linearVelocity.copy(ot.linearVelocity)):vt.hasLinearVelocity=!1,ot.angularVelocity?(vt.hasAngularVelocity=!0,vt.angularVelocity.copy(ot.angularVelocity)):vt.hasAngularVelocity=!1));ht!==null&&(tt=b.getPose(o.targetRaySpace,et),tt===null&&ot!==null&&(tt=ot),tt!==null&&(ht.matrix.fromArray(tt.transform.matrix),ht.matrix.decompose(ht.position,ht.rotation,ht.scale),tt.linearVelocity?(ht.hasLinearVelocity=!0,ht.linearVelocity.copy(tt.linearVelocity)):ht.hasLinearVelocity=!1,tt.angularVelocity?(ht.hasAngularVelocity=!0,ht.angularVelocity.copy(tt.angularVelocity)):ht.hasAngularVelocity=!1,this.dispatchEvent(_T)))}return ht!==null&&(ht.visible=tt!==null),vt!==null&&(vt.visible=ot!==null),_t!==null&&(_t.visible=lt!==null),this}}class rC extends vu{constructor(o,b,et,tt,ot,lt,ht,vt,_t,Mt){if((Mt=Mt!==void 0?Mt:Do)!==Do&&Mt!==Go)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");et===void 0&&Mt===Do&&(et=Qn),et===void 0&&Mt===Go&&(et=br),super(null,tt,ot,lt,ht,vt,Mt,et,_t),this.isDepthTexture=!0,this.image={width:o,height:b},this.magFilter=ht!==void 0?ht:qo,this.minFilter=vt!==void 0?vt:qo,this.flipY=!1,this.generateMipmaps=!1}}class ex extends js{constructor(o,b){super();const et=this;let tt=null,ot=1,lt=null,ht="local-floor",vt=null,_t=null,Mt=null,Pt=null,Tt=null,Rt=null;const Nt=b.getContextAttributes();let kt=null,Kt=null;const $t=[],en=[],ln=new Zu;ln.layers.enable(1),ln.viewport=new Uo;const gn=new Zu;gn.layers.enable(2),gn.viewport=new Uo;const _n=[ln,gn],An=new nC;An.layers.enable(1),An.layers.enable(2);let Ln=null,Nn=null;function Jn(fr){const _r=en.indexOf(fr.inputSource);if(_r===-1)return;const Qr=$t[_r];Qr!==void 0&&Qr.dispatchEvent({type:fr.type,data:fr.inputSource})}function tr(){tt.removeEventListener("select",Jn),tt.removeEventListener("selectstart",Jn),tt.removeEventListener("selectend",Jn),tt.removeEventListener("squeeze",Jn),tt.removeEventListener("squeezestart",Jn),tt.removeEventListener("squeezeend",Jn),tt.removeEventListener("end",tr),tt.removeEventListener("inputsourceschange",jn);for(let fr=0;fr<$t.length;fr++){const _r=en[fr];_r!==null&&(en[fr]=null,$t[fr].disconnect(_r))}Ln=null,Nn=null,o.setRenderTarget(kt),Tt=null,Pt=null,Mt=null,tt=null,Kt=null,Yr.stop(),et.isPresenting=!1,et.dispatchEvent({type:"sessionend"})}function jn(fr){for(let _r=0;_r<fr.removed.length;_r++){const Qr=fr.removed[_r],Mr=en.indexOf(Qr);Mr>=0&&(en[Mr]=null,$t[Mr].dispatchEvent({type:"disconnected",data:Qr}))}for(let _r=0;_r<fr.added.length;_r++){const Qr=fr.added[_r];let Mr=en.indexOf(Qr);if(Mr===-1){for(let ws=0;ws<$t.length;ws++){if(ws>=en.length){en.push(Qr),Mr=ws;break}if(en[ws]===null){en[ws]=Qr,Mr=ws;break}}if(Mr===-1)break}const Wr=$t[Mr];Wr&&Wr.dispatchEvent({type:"connected",data:Qr})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(fr){let _r=$t[fr];return _r===void 0&&(_r=new q1,$t[fr]=_r),_r.getTargetRaySpace()},this.getControllerGrip=function(fr){let _r=$t[fr];return _r===void 0&&(_r=new q1,$t[fr]=_r),_r.getGripSpace()},this.getHand=function(fr){let _r=$t[fr];return _r===void 0&&(_r=new q1,$t[fr]=_r),_r.getHandSpace()},this.setFramebufferScaleFactor=function(fr){ot=fr,et.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(fr){ht=fr,et.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return vt||lt},this.setReferenceSpace=function(fr){vt=fr},this.getBaseLayer=function(){return Pt!==null?Pt:Tt},this.getBinding=function(){return Mt},this.getFrame=function(){return Rt},this.getSession=function(){return tt},this.setSession=async function(fr){if(tt=fr,tt!==null){if(kt=o.getRenderTarget(),tt.addEventListener("select",Jn),tt.addEventListener("selectstart",Jn),tt.addEventListener("selectend",Jn),tt.addEventListener("squeeze",Jn),tt.addEventListener("squeezestart",Jn),tt.addEventListener("squeezeend",Jn),tt.addEventListener("end",tr),tt.addEventListener("inputsourceschange",jn),Nt.xrCompatible!==!0&&await b.makeXRCompatible(),tt.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const _r={antialias:tt.renderState.layers!==void 0||Nt.antialias,alpha:Nt.alpha,depth:Nt.depth,stencil:Nt.stencil,framebufferScaleFactor:ot};Tt=new XRWebGLLayer(tt,b,_r),tt.updateRenderState({baseLayer:Tt}),Kt=new wp(Tt.framebufferWidth,Tt.framebufferHeight,{format:bs,type:$l,encoding:o.outputEncoding,stencilBuffer:Nt.stencil})}else{let _r=null,Qr=null,Mr=null;Nt.depth&&(Mr=Nt.stencil?35056:33190,_r=Nt.stencil?Go:Do,Qr=Nt.stencil?br:Qn);const Wr={colorFormat:32856,depthFormat:Mr,scaleFactor:ot};Mt=new XRWebGLBinding(tt,b),Pt=Mt.createProjectionLayer(Wr),tt.updateRenderState({layers:[Pt]}),Kt=new wp(Pt.textureWidth,Pt.textureHeight,{format:bs,type:$l,depthTexture:new rC(Pt.textureWidth,Pt.textureHeight,Qr,void 0,void 0,void 0,void 0,void 0,void 0,_r),stencilBuffer:Nt.stencil,encoding:o.outputEncoding,samples:Nt.antialias?4:0}),o.properties.get(Kt).__ignoreDepthValues=Pt.ignoreDepthValues}Kt.isXRRenderTarget=!0,this.setFoveation(1),vt=null,lt=await tt.requestReferenceSpace(ht),Yr.setContext(tt),Yr.start(),et.isPresenting=!0,et.dispatchEvent({type:"sessionstart"})}};const Cr=new xn,Ur=new xn;function Er(fr,_r){_r===null?fr.matrixWorld.copy(fr.matrix):fr.matrixWorld.multiplyMatrices(_r.matrixWorld,fr.matrix),fr.matrixWorldInverse.copy(fr.matrixWorld).invert()}this.updateCamera=function(fr){if(tt===null)return;An.near=gn.near=ln.near=fr.near,An.far=gn.far=ln.far=fr.far,Ln===An.near&&Nn===An.far||(tt.updateRenderState({depthNear:An.near,depthFar:An.far}),Ln=An.near,Nn=An.far);const _r=fr.parent,Qr=An.cameras;Er(An,_r);for(let Wr=0;Wr<Qr.length;Wr++)Er(Qr[Wr],_r);An.matrixWorld.decompose(An.position,An.quaternion,An.scale),fr.matrix.copy(An.matrix),fr.matrix.decompose(fr.position,fr.quaternion,fr.scale);const Mr=fr.children;for(let Wr=0,ws=Mr.length;Wr<ws;Wr++)Mr[Wr].updateMatrixWorld(!0);Qr.length===2?function(Wr,ws,fo){Cr.setFromMatrixPosition(ws.matrixWorld),Ur.setFromMatrixPosition(fo.matrixWorld);const Es=Cr.distanceTo(Ur),so=ws.projectionMatrix.elements,Rn=fo.projectionMatrix.elements,Mn=so[14]/(so[10]-1),sr=so[14]/(so[10]+1),Xn=(so[9]+1)/so[5],kn=(so[9]-1)/so[5],qn=(so[8]-1)/so[0],gr=(Rn[8]+1)/Rn[0],cn=Mn*qn,vr=Mn*gr,rr=Es/(-qn+gr),Sr=rr*-qn;ws.matrixWorld.decompose(Wr.position,Wr.quaternion,Wr.scale),Wr.translateX(Sr),Wr.translateZ(rr),Wr.matrixWorld.compose(Wr.position,Wr.quaternion,Wr.scale),Wr.matrixWorldInverse.copy(Wr.matrixWorld).invert();const Pr=Mn+rr,Zr=sr+rr,Ss=cn-Sr,Ns=vr+(Es-Sr),eo=Xn*sr/Zr*Pr,Bs=kn*sr/Zr*Pr;Wr.projectionMatrix.makePerspective(Ss,Ns,eo,Bs,Pr,Zr)}(An,ln,gn):An.projectionMatrix.copy(ln.projectionMatrix)},this.getCamera=function(){return An},this.getFoveation=function(){return Pt!==null?Pt.fixedFoveation:Tt!==null?Tt.fixedFoveation:void 0},this.setFoveation=function(fr){Pt!==null&&(Pt.fixedFoveation=fr),Tt!==null&&Tt.fixedFoveation!==void 0&&(Tt.fixedFoveation=fr)};let qr=null;this.onPreAnimationFrameCallback=null;const Yr=new G_;Yr.setAnimationLoop(function(fr,_r){if(et.onPreAnimationFrameCallback&&et.onPreAnimationFrameCallback(fr,_r),_t=_r.getViewerPose(vt||lt),Rt=_r,_t!==null){const Qr=_t.views;Tt!==null&&(o.setRenderTargetFramebuffer(Kt,Tt.framebuffer),o.setRenderTarget(Kt));let Mr=!1;Qr.length!==An.cameras.length&&(An.cameras.length=0,Mr=!0);for(let Wr=0;Wr<Qr.length;Wr++){const ws=Qr[Wr];let fo=null;if(Tt!==null)fo=Tt.getViewport(ws);else{const so=Mt.getViewSubImage(Pt,ws);fo=so.viewport,Wr===0&&(o.setRenderTargetTextures(Kt,so.colorTexture,Pt.ignoreDepthValues?void 0:so.depthStencilTexture),o.setRenderTarget(Kt))}let Es=_n[Wr];Es===void 0&&(Es=new Zu,Es.layers.enable(Wr),Es.viewport=new Uo,_n[Wr]=Es),Es.matrix.fromArray(ws.transform.matrix),Es.projectionMatrix.fromArray(ws.projectionMatrix),Es.viewport.set(fo.x,fo.y,fo.width,fo.height),Wr===0&&An.matrix.copy(Es.matrix),Mr===!0&&An.cameras.push(Es)}}for(let Qr=0;Qr<$t.length;Qr++){const Mr=en[Qr],Wr=$t[Qr];Mr!==null&&Wr!==void 0&&Wr.update(Mr,_r,vt||lt)}qr&&qr(fr,_r),Rt=null}),this.setAnimationLoop=function(fr){qr=fr},this.dispose=function(){}}}function yT(dt,o){function b(et,tt){et.opacity.value=tt.opacity,tt.color&&et.diffuse.value.copy(tt.color),tt.emissive&&et.emissive.value.copy(tt.emissive).multiplyScalar(tt.emissiveIntensity),tt.map&&(et.map.value=tt.map),tt.alphaMap&&(et.alphaMap.value=tt.alphaMap),tt.bumpMap&&(et.bumpMap.value=tt.bumpMap,et.bumpScale.value=tt.bumpScale,tt.side===jt&&(et.bumpScale.value*=-1)),tt.displacementMap&&(et.displacementMap.value=tt.displacementMap,et.displacementScale.value=tt.displacementScale,et.displacementBias.value=tt.displacementBias),tt.emissiveMap&&(et.emissiveMap.value=tt.emissiveMap),tt.normalMap&&(et.normalMap.value=tt.normalMap,et.normalScale.value.copy(tt.normalScale),tt.side===jt&&et.normalScale.value.negate()),tt.specularMap&&(et.specularMap.value=tt.specularMap),tt.alphaTest>0&&(et.alphaTest.value=tt.alphaTest);const ot=o.get(tt).envMap;if(ot){et.envMap.value=ot;const vt=o.get(tt).environment||ot;et.envMapRotation.value=vt?vt.rotation:0,et.flipEnvMap.value=ot.isCubeTexture&&ot.isRenderTargetTexture===!1?-1:1,et.reflectivity.value=tt.reflectivity,et.ior.value=tt.ior,et.refractionRatio.value=tt.refractionRatio}if(tt.lightMap){et.lightMap.value=tt.lightMap;const vt=dt.physicallyCorrectLights!==!0?Math.PI:1;et.lightMapIntensity.value=tt.lightMapIntensity*vt}let lt,ht;tt.aoMap&&(et.aoMap.value=tt.aoMap,et.aoMapIntensity.value=tt.aoMapIntensity),tt.map?lt=tt.map:tt.specularMap?lt=tt.specularMap:tt.displacementMap?lt=tt.displacementMap:tt.normalMap?lt=tt.normalMap:tt.bumpMap?lt=tt.bumpMap:tt.roughnessMap?lt=tt.roughnessMap:tt.metalnessMap?lt=tt.metalnessMap:tt.alphaMap?lt=tt.alphaMap:tt.emissiveMap?lt=tt.emissiveMap:tt.clearcoatMap?lt=tt.clearcoatMap:tt.clearcoatNormalMap?lt=tt.clearcoatNormalMap:tt.clearcoatRoughnessMap?lt=tt.clearcoatRoughnessMap:tt.iridescenceMap?lt=tt.iridescenceMap:tt.iridescenceThicknessMap?lt=tt.iridescenceThicknessMap:tt.specularIntensityMap?lt=tt.specularIntensityMap:tt.specularColorMap?lt=tt.specularColorMap:tt.transmissionMap?lt=tt.transmissionMap:tt.thicknessMap?lt=tt.thicknessMap:tt.sheenColorMap?lt=tt.sheenColorMap:tt.sheenRoughnessMap&&(lt=tt.sheenRoughnessMap),lt!==void 0&&(lt.isWebGLRenderTarget&&(lt=lt.texture),lt.matrixAutoUpdate===!0&&lt.updateMatrix(),et.uvTransform.value.copy(lt.matrix)),tt.aoMap?ht=tt.aoMap:tt.lightMap&&(ht=tt.lightMap),ht!==void 0&&(ht.isWebGLRenderTarget&&(ht=ht.texture),ht.matrixAutoUpdate===!0&&ht.updateMatrix(),et.uv2Transform.value.copy(ht.matrix))}return{refreshFogUniforms:function(et,tt){et.fogColor.value.copy(tt.color),tt.isFog?(et.fogNear.value=tt.near,et.fogFar.value=tt.far):tt.isFogExp2&&(et.fogDensity.value=tt.density)},refreshMaterialUniforms:function(et,tt,ot,lt,ht){tt.isMeshBasicMaterial||tt.isMeshLambertMaterial?b(et,tt):tt.isMeshToonMaterial?(b(et,tt),function(vt,_t){_t.gradientMap&&(vt.gradientMap.value=_t.gradientMap)}(et,tt)):tt.isMeshPhongMaterial?(b(et,tt),function(vt,_t){vt.specular.value.copy(_t.specular),vt.shininess.value=Math.max(_t.shininess,1e-4)}(et,tt)):tt.isMeshStandardMaterial?(b(et,tt),function(vt,_t){vt.roughness.value=_t.roughness,vt.metalness.value=_t.metalness,_t.roughnessMap&&(vt.roughnessMap.value=_t.roughnessMap),_t.metalnessMap&&(vt.metalnessMap.value=_t.metalnessMap),o.get(_t).envMap&&(vt.envMapIntensity.value=_t.envMapIntensity)}(et,tt),tt.isMeshPhysicalMaterial&&function(vt,_t,Mt){vt.ior.value=_t.ior,_t.sheen>0&&(vt.sheenColor.value.copy(_t.sheenColor).multiplyScalar(_t.sheen),vt.sheenRoughness.value=_t.sheenRoughness,_t.sheenColorMap&&(vt.sheenColorMap.value=_t.sheenColorMap),_t.sheenRoughnessMap&&(vt.sheenRoughnessMap.value=_t.sheenRoughnessMap)),_t.clearcoat>0&&(vt.clearcoat.value=_t.clearcoat,vt.clearcoatRoughness.value=_t.clearcoatRoughness,_t.clearcoatMap&&(vt.clearcoatMap.value=_t.clearcoatMap),_t.clearcoatRoughnessMap&&(vt.clearcoatRoughnessMap.value=_t.clearcoatRoughnessMap),_t.clearcoatNormalMap&&(vt.clearcoatNormalScale.value.copy(_t.clearcoatNormalScale),vt.clearcoatNormalMap.value=_t.clearcoatNormalMap,_t.side===jt&&vt.clearcoatNormalScale.value.negate())),_t.iridescence>0&&(vt.iridescence.value=_t.iridescence,vt.iridescenceIOR.value=_t.iridescenceIOR,vt.iridescenceThicknessMinimum.value=_t.iridescenceThicknessRange[0],vt.iridescenceThicknessMaximum.value=_t.iridescenceThicknessRange[1],_t.iridescenceMap&&(vt.iridescenceMap.value=_t.iridescenceMap),_t.iridescenceThicknessMap&&(vt.iridescenceThicknessMap.value=_t.iridescenceThicknessMap)),_t.transmission>0&&(vt.transmission.value=_t.transmission,vt.transmissionSamplerMap.value=Mt.texture,vt.transmissionSamplerSize.value.set(Mt.width,Mt.height),_t.transmissionMap&&(vt.transmissionMap.value=_t.transmissionMap),vt.thickness.value=_t.thickness,_t.thicknessMap&&(vt.thicknessMap.value=_t.thicknessMap),vt.attenuationDistance.value=_t.attenuationDistance,vt.attenuationColor.value.copy(_t.attenuationColor)),vt.specularIntensity.value=_t.specularIntensity,vt.specularColor.value.copy(_t.specularColor),_t.specularIntensityMap&&(vt.specularIntensityMap.value=_t.specularIntensityMap),_t.specularColorMap&&(vt.specularColorMap.value=_t.specularColorMap)}(et,tt,ht)):tt.isMeshMatcapMaterial?(b(et,tt),function(vt,_t){_t.matcap&&(vt.matcap.value=_t.matcap)}(et,tt)):tt.isMeshDepthMaterial?b(et,tt):tt.isMeshDistanceMaterial?(b(et,tt),function(vt,_t){vt.referencePosition.value.copy(_t.referencePosition),vt.nearDistance.value=_t.nearDistance,vt.farDistance.value=_t.farDistance}(et,tt)):tt.isMeshNormalMaterial?b(et,tt):tt.isLineBasicMaterial?(function(vt,_t){vt.diffuse.value.copy(_t.color),vt.opacity.value=_t.opacity}(et,tt),tt.isLineDashedMaterial&&function(vt,_t){vt.dashSize.value=_t.dashSize,vt.totalSize.value=_t.dashSize+_t.gapSize,vt.scale.value=_t.scale}(et,tt)):tt.isPointsMaterial?function(vt,_t,Mt,Pt){let Tt;vt.diffuse.value.copy(_t.color),vt.opacity.value=_t.opacity,vt.size.value=_t.size*Mt,vt.scale.value=.5*Pt,_t.map&&(vt.map.value=_t.map),_t.alphaMap&&(vt.alphaMap.value=_t.alphaMap),_t.alphaTest>0&&(vt.alphaTest.value=_t.alphaTest),_t.map?Tt=_t.map:_t.alphaMap&&(Tt=_t.alphaMap),Tt!==void 0&&(Tt.matrixAutoUpdate===!0&&Tt.updateMatrix(),vt.uvTransform.value.copy(Tt.matrix))}(et,tt,ot,lt):tt.isSpriteMaterial?function(vt,_t){let Mt;vt.diffuse.value.copy(_t.color),vt.opacity.value=_t.opacity,vt.rotation.value=_t.rotation,_t.map&&(vt.map.value=_t.map),_t.alphaMap&&(vt.alphaMap.value=_t.alphaMap),_t.alphaTest>0&&(vt.alphaTest.value=_t.alphaTest),_t.map?Mt=_t.map:_t.alphaMap&&(Mt=_t.alphaMap),Mt!==void 0&&(Mt.matrixAutoUpdate===!0&&Mt.updateMatrix(),vt.uvTransform.value.copy(Mt.matrix))}(et,tt):tt.isShadowMaterial?(et.color.value.copy(tt.color),et.opacity.value=tt.opacity):tt.isShaderMaterial&&(tt.transmission!==void 0&&(et.transmission&&(et.transmission.value=tt.transmission),et.transmissionSamplerMap&&ht&&(et.transmissionSamplerMap.value=ht?ht.texture:null),et.transmissionSamplerSize&&ht&&et.transmissionSamplerSize.value.set(ht.width,ht.height)),tt.uniformsNeedUpdate=!1)}}}function AT(dt,o,b,et){let tt={},ot={},lt=[];const ht=b.isWebGL2?dt.getParameter(35375):0;function vt(Pt,Tt,Rt){const Nt=Pt.value;if(Rt[Tt]===void 0)return Rt[Tt]=typeof Nt=="number"?Nt:Nt.clone(),!0;if(typeof Nt=="number"){if(Rt[Tt]!==Nt)return Rt[Tt]=Nt,!0}else{const kt=Rt[Tt];if(kt.equals(Nt)===!1)return kt.copy(Nt),!0}return!1}function _t(Pt){const Tt=Pt.value,Rt={boundary:0,storage:0};return typeof Tt=="number"?(Rt.boundary=4,Rt.storage=4):Tt.isVector2?(Rt.boundary=8,Rt.storage=8):Tt.isVector3||Tt.isColor?(Rt.boundary=16,Rt.storage=12):Tt.isVector4?(Rt.boundary=16,Rt.storage=16):Tt.isMatrix3?(Rt.boundary=48,Rt.storage=48):Tt.isMatrix4?(Rt.boundary=64,Rt.storage=64):Tt.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Tt),Rt}function Mt(Pt){const Tt=Pt.target;Tt.removeEventListener("dispose",Mt);const Rt=lt.indexOf(Tt.__bindingPointIndex);lt.splice(Rt,1),dt.deleteBuffer(tt[Tt.id]),delete tt[Tt.id],delete ot[Tt.id]}return{bind:function(Pt,Tt){const Rt=Tt.program;et.uniformBlockBinding(Pt,Rt)},update:function(Pt,Tt){let Rt=tt[Pt.id];Rt===void 0&&(function(Kt){const $t=Kt.uniforms;let en=0,ln=0;for(let gn=0,_n=$t.length;gn<_n;gn++){const An=$t[gn],Ln=_t(An);if(An.__data=new Float32Array(Ln.storage/Float32Array.BYTES_PER_ELEMENT),An.__offset=en,gn>0){ln=en%16;const Nn=16-ln;ln!==0&&Nn-Ln.boundary<0&&(en+=16-ln,An.__offset=en)}en+=Ln.storage}ln=en%16,ln>0&&(en+=16-ln),Kt.__size=en,Kt.__cache={}}(Pt),Rt=function(Kt){const $t=function(){for(let _n=0;_n<ht;_n++)if(lt.indexOf(_n)===-1)return lt.push(_n),_n;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Kt.__bindingPointIndex=$t;const en=dt.createBuffer(),ln=Kt.__size,gn=Kt.usage;return dt.bindBuffer(35345,en),dt.bufferData(35345,ln,gn),dt.bindBuffer(35345,null),dt.bindBufferBase(35345,$t,en),en}(Pt),tt[Pt.id]=Rt,Pt.addEventListener("dispose",Mt));const Nt=Tt.program;et.updateUBOMapping(Pt,Nt);const kt=o.render.frame;ot[Pt.id]!==kt&&(function(Kt){const $t=tt[Kt.id],en=Kt.uniforms,ln=Kt.__cache;dt.bindBuffer(35345,$t);for(let gn=0,_n=en.length;gn<_n;gn++){const An=en[gn];if(vt(An,gn,ln)===!0){const Ln=An.value,Nn=An.__offset;typeof Ln=="number"?(An.__data[0]=Ln,dt.bufferSubData(35345,Nn,An.__data)):(An.value.isMatrix3?(An.__data[0]=An.value.elements[0],An.__data[1]=An.value.elements[1],An.__data[2]=An.value.elements[2],An.__data[3]=An.value.elements[0],An.__data[4]=An.value.elements[3],An.__data[5]=An.value.elements[4],An.__data[6]=An.value.elements[5],An.__data[7]=An.value.elements[0],An.__data[8]=An.value.elements[6],An.__data[9]=An.value.elements[7],An.__data[10]=An.value.elements[8],An.__data[11]=An.value.elements[0]):Ln.toArray(An.__data),dt.bufferSubData(35345,Nn,An.__data))}}dt.bindBuffer(35345,null)}(Pt),ot[Pt.id]=kt)},dispose:function(){for(const Pt in tt)dt.deleteBuffer(tt[Pt]);lt=[],tt={},ot={}}}}function su(dt={}){this.isWebGLRenderer=!0;const o=dt.canvas!==void 0?dt.canvas:function(){const In=B_("canvas");return In.style.display="block",In}(),b=dt.context!==void 0?dt.context:null,et=dt.depth===void 0||dt.depth,tt=dt.stencil===void 0||dt.stencil,ot=dt.antialias!==void 0&&dt.antialias,lt=dt.premultipliedAlpha===void 0||dt.premultipliedAlpha,ht=dt.preserveDrawingBuffer!==void 0&&dt.preserveDrawingBuffer,vt=dt.powerPreference!==void 0?dt.powerPreference:"default",_t=dt.failIfMajorPerformanceCaveat!==void 0&&dt.failIfMajorPerformanceCaveat;let Mt;Mt=b!==null?b.getContextAttributes().alpha:dt.alpha!==void 0&&dt.alpha;let Pt=null,Tt=null;const Rt=[],Nt=[];this.domElement=o,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=vm,this.physicallyCorrectLights=!1,this.toneMapping=Os,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const kt=this;let Kt=!1,$t=0,en=0,ln=null,gn=-1,_n=null;const An=new Uo,Ln=new Uo;let Nn=null,Jn=o.width,tr=o.height,jn=1,Cr=null,Ur=null;const Er=new Uo(0,0,Jn,tr),qr=new Uo(0,0,Jn,tr);let Yr=!1;const fr=new Qw;let _r=!1,Qr=!1,Mr=null;const Wr=new zs,ws=new Lr,fo=new xn,Es={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function so(){return ln===null?jn:1}let Rn,Mn,sr,Xn,kn,qn,gr,cn,vr,rr,Sr,Pr,Zr,Ss,Ns,eo,Bs,Fs,$o,Im,$s,_l,yl,VE,ss=b;function dI(In,Ar){for(let Rr=0;Rr<In.length;Rr++){const Ir=In[Rr],Gr=o.getContext(Ir,Ar);if(Gr!==null)return Gr}return null}try{const In={alpha:!0,depth:et,stencil:tt,antialias:ot,premultipliedAlpha:lt,preserveDrawingBuffer:ht,powerPreference:vt,failIfMajorPerformanceCaveat:_t};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${d}`),o.addEventListener("webglcontextlost",qC,!1),o.addEventListener("webglcontextrestored",fI,!1),o.addEventListener("webglcontextcreationerror",YC,!1),ss===null){const Ar=["webgl2","webgl","experimental-webgl"];if(kt.isWebGL1Renderer===!0&&Ar.shift(),ss=dI(Ar,In),ss===null)throw dI(Ar)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ss.getShaderPrecisionFormat===void 0&&(ss.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(In){throw console.error("THREE.WebGLRenderer: "+In.message),In}function pI(){Rn=new Jr(ss),Mn=new FM(ss,Rn,dt),Rn.init(Mn),_l=new W1(ss,Rn,Mn),sr=new eC(ss,Rn,Mn),Xn=new Av,kn=new dT,qn=new tC(ss,Rn,sr,kn,Mn,_l,Xn),gr=new uP(kt),cn=new zM(kt),vr=new jA(ss,Mn),yl=new lP(ss,Rn,vr,Mn),rr=new Ks(ss,vr,Xn,yl),Sr=new El(ss,rr,vr,Xn),$o=new VM(ss,Mn,qn),eo=new cP(kn),Pr=new mP(kt,gr,cn,Rn,Mn,yl,eo),Zr=new yT(kt,kn),Ss=new JS,Ns=new gT(Rn,Mn),Fs=new aP(kt,gr,sr,Sr,Mt,lt),Bs=new vT(kt,Sr,Mn),VE=new AT(ss,Xn,Mn,sr),Im=new NM(ss,Rn,Xn,Mn),$s=new zA(ss,Rn,Xn,Mn),Xn.programs=Pr.programs,kt.capabilities=Mn,kt.extensions=Rn,kt.properties=kn,kt.renderLists=Ss,kt.shadowMap=Bs,kt.state=sr,kt.info=Xn,kt.background=Fs,kt.cubeuvmaps=cn}pI();const jp=new ex(kt,ss);function qC(In){In.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Kt=!0}function fI(){console.log("THREE.WebGLRenderer: Context Restored."),Kt=!1;const In=Xn.autoReset,Ar=Bs.enabled,Rr=Bs.autoUpdate,Ir=Bs.needsUpdate,Gr=Bs.type;pI(),Xn.autoReset=In,Bs.enabled=Ar,Bs.autoUpdate=Rr,Bs.needsUpdate=Ir,Bs.type=Gr}function YC(In){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",In.statusMessage)}function bo(In){const Ar=In.target;Ar.removeEventListener("dispose",bo),function(Rr){(function(Ir){const Gr=kn.get(Ir).programs;Gr!==void 0&&(Gr.forEach(function(gs){Pr.releaseProgram(gs)}),Ir.isShaderMaterial&&Pr.releaseShaderCache(Ir))})(Rr),kn.remove(Rr)}(Ar)}this.xr=jp,this.getContext=function(){return ss},this.getContextAttributes=function(){return ss.getContextAttributes()},this.forceContextLoss=function(){const In=Rn.get("WEBGL_lose_context");In&&In.loseContext()},this.forceContextRestore=function(){const In=Rn.get("WEBGL_lose_context");In&&In.restoreContext()},this.getPixelRatio=function(){return jn},this.setPixelRatio=function(In){In!==void 0&&(jn=In,this.setSize(Jn,tr,!1))},this.getSize=function(In){return In.set(Jn,tr)},this.setSize=function(In,Ar,Rr){jp.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Jn=In,tr=Ar,o.width=Math.floor(In*jn),o.height=Math.floor(Ar*jn),Rr!==!1&&(o.style.width=In+"px",o.style.height=Ar+"px"),this.setViewport(0,0,In,Ar))},this.getDrawingBufferSize=function(In){return In.set(Jn*jn,tr*jn).floor()},this.setDrawingBufferSize=function(In,Ar,Rr){Jn=In,tr=Ar,jn=Rr,o.width=Math.floor(In*Rr),o.height=Math.floor(Ar*Rr),this.setViewport(0,0,In,Ar)},this.getCurrentViewport=function(In){return In.copy(An)},this.getViewport=function(In){return In.copy(Er)},this.setViewport=function(In,Ar,Rr,Ir){In.isVector4?Er.set(In.x,In.y,In.z,In.w):Er.set(In,Ar,Rr,Ir),sr.viewport(An.copy(Er).multiplyScalar(jn).floor())},this.getScissor=function(In){return In.copy(qr)},this.setScissor=function(In,Ar,Rr,Ir){In.isVector4?qr.set(In.x,In.y,In.z,In.w):qr.set(In,Ar,Rr,Ir),sr.scissor(Ln.copy(qr).multiplyScalar(jn).floor())},this.getScissorTest=function(){return Yr},this.setScissorTest=function(In){sr.setScissorTest(Yr=In)},this.setOpaqueSort=function(In){Cr=In},this.setTransparentSort=function(In){Ur=In},this.getClearColor=function(In){return In.copy(Fs.getClearColor())},this.setClearColor=function(){Fs.setClearColor.apply(Fs,arguments)},this.getClearAlpha=function(){return Fs.getClearAlpha()},this.setClearAlpha=function(){Fs.setClearAlpha.apply(Fs,arguments)},this.clear=function(In=!0,Ar=!0,Rr=!0){let Ir=0;In&&(Ir|=16384),Ar&&(Ir|=256),Rr&&(Ir|=1024),ss.clear(Ir)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",qC,!1),o.removeEventListener("webglcontextrestored",fI,!1),o.removeEventListener("webglcontextcreationerror",YC,!1),Ss.dispose(),Ns.dispose(),kn.dispose(),gr.dispose(),cn.dispose(),Sr.dispose(),yl.dispose(),VE.dispose(),Pr.dispose(),jp.dispose(),jp.removeEventListener("sessionstart",zp),jp.removeEventListener("sessionend",mI),Mr&&(Mr.dispose(),Mr=null),nA.stop()},this.renderBufferDirect=function(In,Ar,Rr,Ir,Gr,gs){Ar===null&&(Ar=Es);const Ro=Gr.isMesh&&Gr.matrixWorld.determinant()<0,Ls=function(hp,qx,Rv,Hs,tp){qx.isScene!==!0&&(qx=Es),qn.resetTextureUnits();const WE=qx.fog,JC=Hs.isMeshStandardMaterial?qx.environment:null,_I=ln===null?kt.outputEncoding:ln.isXRRenderTarget===!0||ln.texture.encoding&&ln.texture.encoding!==po?ln.texture.encoding:vm,Yx=(Hs.isMeshStandardMaterial?cn:gr).get(Hs.envMap||JC),ev=Hs.vertexColors===!0&&!!Rv.attributes.color&&Rv.attributes.color.itemSize===4,EP=!!Hs.normalMap&&!!Rv.attributes.tangent,yI=!!Rv.morphAttributes.position,ZC=!!Rv.morphAttributes.normal,SP=!!Rv.morphAttributes.color,CP=Hs.toneMapped?kt.toneMapping:Os,qE=Rv.morphAttributes.position||Rv.morphAttributes.normal||Rv.morphAttributes.color,MP=qE!==void 0?qE.length:0,Sl=kn.get(Hs),AI=Tt.state.lights;if(_r===!0&&(Qr===!0||hp!==_n)){const Qp=hp===_n&&Hs.id===gn;eo.setState(Hs,hp,Qp)}let p_=!1;Hs.version===Sl.__version?Sl.needsLights&&Sl.lightsStateVersion!==AI.state.version||Sl.outputEncoding!==_I||tp.isInstancedMesh&&Sl.instancing===!1?p_=!0:tp.isInstancedMesh||Sl.instancing!==!0?tp.isSkinnedMesh&&Sl.skinning===!1?p_=!0:tp.isSkinnedMesh||Sl.skinning!==!0?Sl.envMap!==Yx||Hs.fog===!0&&Sl.fog!==WE?p_=!0:Sl.numClippingPlanes===void 0||Sl.numClippingPlanes===eo.numPlanes&&Sl.numIntersection===eo.numIntersection?(Sl.vertexAlphas!==ev||Sl.vertexTangents!==EP||Sl.morphTargets!==yI||Sl.morphNormals!==ZC||Sl.morphColors!==SP||Sl.toneMapping!==CP||Mn.isWebGL2===!0&&Sl.morphTargetsCount!==MP)&&(p_=!0):p_=!0:p_=!0:p_=!0:(p_=!0,Sl.__version=Hs.version);let f_=Sl.currentProgram;p_===!0&&(f_=Gx(Hs,qx,tp));let YE=!1,rA=!1,Vp=!1;const dp=f_.getUniforms(),kv=Sl.uniforms;if(sr.useProgram(f_.program)&&(YE=!0,rA=!0,Vp=!0),Hs.id!==gn&&(gn=Hs.id,rA=!0),YE||_n!==hp){if(dp.setValue(ss,"projectionMatrix",hp.projectionMatrix),Mn.logarithmicDepthBuffer&&dp.setValue(ss,"logDepthBufFC",2/(Math.log(hp.far+1)/Math.LN2)),_n!==hp&&(_n=hp,rA=!0,Vp=!0),Hs.isShaderMaterial||Hs.isMeshPhongMaterial||Hs.isMeshToonMaterial||Hs.isMeshStandardMaterial||Hs.envMap){const Qp=dp.map.cameraPosition;Qp!==void 0&&Qp.setValue(ss,fo.setFromMatrixPosition(hp.matrixWorld))}(Hs.isMeshPhongMaterial||Hs.isMeshToonMaterial||Hs.isMeshLambertMaterial||Hs.isMeshBasicMaterial||Hs.isMeshStandardMaterial||Hs.isShaderMaterial)&&dp.setValue(ss,"isOrthographic",hp.isOrthographicCamera===!0),(Hs.isMeshPhongMaterial||Hs.isMeshToonMaterial||Hs.isMeshLambertMaterial||Hs.isMeshBasicMaterial||Hs.isMeshStandardMaterial||Hs.isShaderMaterial||Hs.isShadowMaterial||tp.isSkinnedMesh)&&dp.setValue(ss,"viewMatrix",hp.matrixWorldInverse)}if(tp.isSkinnedMesh){dp.setOptional(ss,tp,"bindMatrix"),dp.setOptional(ss,tp,"bindMatrixInverse");const Qp=tp.skeleton;Qp&&(Mn.floatVertexTextures?(Qp.boneTexture===null&&Qp.computeBoneTexture(),dp.setValue(ss,"boneTexture",Qp.boneTexture,qn),dp.setValue(ss,"boneTextureSize",Qp.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const XE=Rv.morphAttributes;var tv,nv;(XE.position!==void 0||XE.normal!==void 0||XE.color!==void 0&&Mn.isWebGL2===!0)&&$o.update(tp,Rv,Hs,f_),(rA||Sl.receiveShadow!==tp.receiveShadow)&&(Sl.receiveShadow=tp.receiveShadow,dp.setValue(ss,"receiveShadow",tp.receiveShadow)),Hs.isMeshGouraudMaterial&&Hs.envMap!==null&&(kv.envMap.value=Yx,kv.flipEnvMap.value=Yx.isCubeTexture&&Yx.isRenderTargetTexture===!1?-1:1),rA&&(dp.setValue(ss,"toneMappingExposure",kt.toneMappingExposure),Sl.needsLights&&(nv=Vp,(tv=kv).ambientLightColor.needsUpdate=nv,tv.lightProbe.needsUpdate=nv,tv.directionalLights.needsUpdate=nv,tv.directionalLightShadows.needsUpdate=nv,tv.pointLights.needsUpdate=nv,tv.pointLightShadows.needsUpdate=nv,tv.spotLights.needsUpdate=nv,tv.spotLightShadows.needsUpdate=nv,tv.rectAreaLights.needsUpdate=nv,tv.hemisphereLights.needsUpdate=nv),WE&&Hs.fog===!0&&Zr.refreshFogUniforms(kv,WE),Zr.refreshMaterialUniforms(kv,Hs,jn,tr,kt.userData.transmissionRenderTarget||Mr),j1.upload(ss,Sl.uniformsList,kv,qn)),Hs.isShaderMaterial&&Hs.uniformsNeedUpdate===!0&&(j1.upload(ss,Sl.uniformsList,kv,qn),Hs.uniformsNeedUpdate=!1),Hs.isSpriteMaterial&&dp.setValue(ss,"center",tp.center),dp.setValue(ss,"modelViewMatrix",tp.modelViewMatrix),dp.setValue(ss,"normalMatrix",tp.normalMatrix),dp.setValue(ss,"modelMatrix",tp.matrixWorld);const eM=Hs.extraUniformsToUpload;if(eM&&Object.entries(eM).forEach(([Qp,Xx])=>dp.setValue(ss,Qp,Xx.value,qn)),Hs.isShaderMaterial||Hs.isRawShaderMaterial){const Qp=Hs.uniformsGroups;for(let Xx=0,TP=Qp.length;Xx<TP;Xx++)if(Mn.isWebGL2){const wI=Qp[Xx];VE.update(wI,f_),VE.bind(wI,f_)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return f_}(In,Ar,Rr,Ir,Gr);sr.setMaterial(Ir,Ro);let mo=Rr.index;const Xl=Rr.attributes.position;if(mo===null){if(Xl===void 0||Xl.count===0)return}else if(mo.count===0)return;let ko,ao=1;Ir.wireframe===!0&&(mo=rr.getWireframeAttribute(Rr),ao=2),yl.setup(Gr,Ir,Ls,Rr,mo);let Eu=Im;mo!==null&&(ko=vr.get(mo),Eu=$s,Eu.setIndex(ko));const Hx=mo!==null?mo.count:Xl.count,_g=Rr.drawRange.start*ao,GE=Rr.drawRange.count*ao,d_=gs!==null?gs.start*ao:0,KC=gs!==null?gs.count*ao:1/0,HE=Math.max(_g,d_),$C=Math.min(Hx,_g+GE,d_+KC)-1,Wx=Math.max(0,$C-HE+1);if(Wx!==0){if(Gr.isMesh)Ir.wireframe===!0?(sr.setLineWidth(Ir.wireframeLinewidth*so()),Eu.setMode(1)):Eu.setMode(4);else if(Gr.isLine){let hp=Ir.linewidth;hp===void 0&&(hp=1),sr.setLineWidth(hp*so()),Gr.isLineSegments?Eu.setMode(1):Gr.isLineLoop?Eu.setMode(2):Eu.setMode(3)}else Gr.isPoints?Eu.setMode(0):Gr.isSprite&&Eu.setMode(4);if(Gr.isInstancedMesh)Eu.renderInstances(HE,Wx,Gr.count);else if(Rr.isInstancedBufferGeometry){const hp=Math.min(Rr.instanceCount,Rr._maxInstanceCount);Eu.renderInstances(HE,Wx,hp)}else Eu.render(HE,Wx)}},this.compile=function(In,Ar){function Rr(Ir,Gr,gs){Ir.transparent===!0&&Ir.side===sn?(Ir.side=jt,Ir.needsUpdate=!0,Gx(Ir,Gr,gs),Ir.side=Jt,Ir.needsUpdate=!0,Gx(Ir,Gr,gs),Ir.side=sn):Gx(Ir,Gr,gs)}Tt=Ns.get(In),Tt.init(),Nt.push(Tt),In.traverseVisible(function(Ir){Ir.isLight&&Ir.layers.test(Ar.layers)&&(Tt.pushLight(Ir),Ir.castShadow&&Tt.pushShadow(Ir))}),Tt.setupLights(kt.physicallyCorrectLights),In.traverse(function(Ir){const Gr=Ir.material;if(Gr)if(Array.isArray(Gr))for(let gs=0;gs<Gr.length;gs++)Rr(Gr[gs],In,Ir);else Rr(Gr,In,Ir)}),Nt.pop(),Tt=null};let cu=null;function zp(){nA.stop()}function mI(){nA.start()}const nA=new G_;function gI(In,Ar,Rr,Ir){if(In.visible===!1)return;if(In.layers.test(Ar.layers)){if(In.isGroup)Rr=In.renderOrder;else if(In.isLOD)In.autoUpdate===!0&&In.update(Ar);else if(In.isLight)Tt.pushLight(In),In.castShadow&&Tt.pushShadow(In);else if(In.isSprite){if(!In.frustumCulled||fr.intersectsSprite(In)){Ir&&fo.setFromMatrixPosition(In.matrixWorld).applyMatrix4(Wr);const gs=Sr.update(In),Ro=In.material;Ro.visible&&Pt.push(In,gs,Ro,Rr,fo.z,null)}}else if((In.isMesh||In.isLine||In.isPoints)&&(In.isSkinnedMesh&&In.skeleton.frame!==Xn.render.frame&&(In.skeleton.update(),In.skeleton.frame=Xn.render.frame),!In.frustumCulled||fr.intersectsObject(In))){Ir&&fo.setFromMatrixPosition(In.matrixWorld).applyMatrix4(Wr);const gs=Sr.update(In),Ro=In.material;if(Array.isArray(Ro)){const Ls=gs.groups;for(let mo=0,Xl=Ls.length;mo<Xl;mo++){const ko=Ls[mo],ao=Ro[ko.materialIndex];ao&&ao.visible&&Pt.push(In,gs,ao,Rr,fo.z,ko)}}else Ro.visible&&Pt.push(In,gs,Ro,Rr,fo.z,null)}}const Gr=In.children;for(let gs=0,Ro=Gr.length;gs<Ro;gs++)gI(Gr[gs],Ar,Rr,Ir)}function vI(In,Ar,Rr,Ir){const Gr=In.opaque,gs=In.transmissive,Ro=In.transparent;if(Tt.setupLightsView(Rr),kt.userData.transmissionRender===void 0&&kt.userData.renderTransmissionPass!==!1&&gs.length>0&&function(Ls,mo,Xl){console.error("three.js internal render transmission pass should not be called");const ko=Mn.isWebGL2;Mr===null&&(Mr=new wp(1,1,{generateMipmaps:!0,type:Rn.has("EXT_color_buffer_half_float")?Wu:$l,minFilter:hs,samples:ko&&ot===!0?4:0})),kt.getDrawingBufferSize(ws),ko?Mr.setSize(ws.x,ws.y):Mr.setSize(sp(ws.x),sp(ws.y));const ao=kt.getRenderTarget();kt.setRenderTarget(Mr),kt.clear();const Eu=kt.toneMapping;kt.toneMapping=Os,QE(Ls,mo,Xl),kt.toneMapping=Eu,qn.updateMultisampleRenderTarget(Mr),qn.updateRenderTargetMipmap(Mr),kt.setRenderTarget(ao)}([...Gr,...Ro],Ar,Rr),Ir&&sr.viewport(An.copy(Ir)),kt.userData.opaqueRender!==!1&&Gr.length>0&&QE(Gr,Ar,Rr),kt.userData.transparentRender!==!1&&Ro.length>0&&QE(Ro,Ar,Rr),kt.userData.transmissionRender!==!1&&gs.length>0){Mr||(Mr=new wp(1,1));const Ls=kt.userData.transmissionRenderTarget.texture,mo=Mn.isWebGL2,Xl=Ls.generateMipmaps,ko=Ls.minFilter;mo&&kt.userData.blurTransmissionTarget&&(Ls.generateMipmaps=!0,Ls.minFilter=hs,Ls.needsUpdate=!0,qn.updateRenderTargetMipmap(kt.userData.transmissionRenderTarget)),QE(gs,Ar,Rr),mo&&kt.userData.blurTransmissionTarget&&(Ls.generateMipmaps=Xl,Ls.minFilter=ko,Ls.needsUpdate=!0,qn.updateRenderTargetMipmap(kt.userData.transmissionRenderTarget))}sr.buffers.depth.setTest(!0),sr.buffers.depth.setMask(!0),sr.buffers.color.setMask(!0),sr.setPolygonOffset(!1)}function QE(In,Ar,Rr){const Ir={...kt.userData};kt.userData.opaqueRender=void 0,kt.userData.transparentRender=void 0,kt.userData.transmissionRender=void 0,kt.userData.backgroundRender=void 0;const Gr=Ar.isScene===!0?Ar.overrideMaterial:null;for(let gs=0,Ro=In.length;gs<Ro;gs++){const Ls=In[gs],mo=Ls.object,Xl=Ls.geometry,ko=Gr===null?Ls.material:Gr,ao=Ls.group;mo.layers.test(Rr.layers)&&bP(mo,Ar,Rr,Xl,ko,ao)}Object.assign(kt.userData,Ir)}function bP(In,Ar,Rr,Ir,Gr,gs){In.onBeforeRender(kt,Ar,Rr,Ir,Gr,gs),In.modelViewMatrix.multiplyMatrices(Rr.matrixWorldInverse,In.matrixWorld),In.normalMatrix.getNormalMatrix(In.modelViewMatrix),Gr.onBeforeRender(kt,Ar,Rr,Ir,In,gs),Gr.transparent===!0&&Gr.side===sn?(Gr.side=jt,Gr.needsUpdate=!0,kt.renderBufferDirect(Rr,Ar,Ir,Gr,In,gs),Gr.side=Jt,Gr.needsUpdate=!0,kt.renderBufferDirect(Rr,Ar,Ir,Gr,In,gs),Gr.side=sn):kt.renderBufferDirect(Rr,Ar,Ir,Gr,In,gs),In.onAfterRender(kt,Ar,Rr,Ir,Gr,gs),Gr.onAfterRender(kt,Ar,Rr,Ir,In,gs)}function Gx(In,Ar,Rr){Ar.isScene!==!0&&(Ar=Es);const Ir=kn.get(In),Gr=Tt.state.lights,gs=Tt.state.shadowsArray,Ro=Gr.state.version,Ls=Pr.getParameters(In,Gr.state,gs,Ar,Rr),mo=Pr.getProgramCacheKey(Ls);let Xl=Ir.programs;Ir.environment=In.isMeshStandardMaterial?Ar.environment:null,Ir.fog=Ar.fog,Ir.envMap=(In.isMeshStandardMaterial?cn:gr).get(In.envMap||Ir.environment),Xl===void 0&&(In.addEventListener("dispose",bo),Xl=new Map,Ir.programs=Xl);let ko=Xl.get(mo);if(ko!==void 0){if(Ir.currentProgram===ko&&Ir.lightsStateVersion===Ro)return XC(In,Ls),ko}else Ls.uniforms=Pr.getUniforms(In),In.onBuild(Rr,Ls,kt),In.onBeforeCompile(Ls,kt),ko=Pr.acquireProgram(Ls,mo),Xl.set(mo,ko),Ir.uniforms=Ls.uniforms;const ao=Ir.uniforms;(In.isShaderMaterial||In.isRawShaderMaterial)&&In.clipping!==!0||(ao.clippingPlanes=eo.uniform),XC(In,Ls),Ir.needsLights=function(_g){return _g.isMeshLambertMaterial||_g.isMeshToonMaterial||_g.isMeshPhongMaterial||_g.isMeshStandardMaterial||_g.isShadowMaterial||_g.isShaderMaterial&&_g.lights===!0}(In),Ir.lightsStateVersion=Ro,Ir.needsLights&&(ao.ambientLightColor.value=Gr.state.ambient,ao.lightProbe.value=Gr.state.probe,ao.directionalLights.value=Gr.state.directional,ao.directionalLightShadows.value=Gr.state.directionalShadow,ao.spotLights.value=Gr.state.spot,ao.spotLightShadows.value=Gr.state.spotShadow,ao.rectAreaLights.value=Gr.state.rectArea,ao.ltc_1.value=Gr.state.rectAreaLTC1,ao.ltc_2.value=Gr.state.rectAreaLTC2,ao.pointLights.value=Gr.state.point,ao.pointLightShadows.value=Gr.state.pointShadow,ao.hemisphereLights.value=Gr.state.hemi,ao.directionalShadowMap.value=Gr.state.directionalShadowMap,ao.directionalShadowMatrix.value=Gr.state.directionalShadowMatrix,ao.spotShadowMap.value=Gr.state.spotShadowMap,ao.spotLightMatrix.value=Gr.state.spotLightMatrix,ao.spotLightMap.value=Gr.state.spotLightMap,ao.pointShadowMap.value=Gr.state.pointShadowMap,ao.pointShadowMatrix.value=Gr.state.pointShadowMatrix);const Eu=ko.getUniforms(),Hx=j1.seqWithValue(Eu.seq,ao);return Ir.currentProgram=ko,Ir.uniformsList=Hx,ko}function XC(In,Ar){const Rr=kn.get(In);Rr.outputEncoding=Ar.outputEncoding,Rr.instancing=Ar.instancing,Rr.skinning=Ar.skinning,Rr.morphTargets=Ar.morphTargets,Rr.morphNormals=Ar.morphNormals,Rr.morphColors=Ar.morphColors,Rr.morphTargetsCount=Ar.morphTargetsCount,Rr.numClippingPlanes=Ar.numClippingPlanes,Rr.numIntersection=Ar.numClipIntersection,Rr.vertexAlphas=Ar.vertexAlphas,Rr.vertexTangents=Ar.vertexTangents,Rr.toneMapping=Ar.toneMapping}nA.setAnimationLoop(function(In){cu&&cu(In)}),typeof self<"u"&&nA.setContext(self),this.setAnimationLoop=function(In){cu=In,jp.setAnimationLoop(In),In===null?nA.stop():nA.start()},jp.addEventListener("sessionstart",zp),jp.addEventListener("sessionend",mI),this.render=function(In,Ar){if(Ar===void 0||Ar.isCamera===!0){if(Kt!==!0){if(In.matrixWorldAutoUpdate===!0&&In.updateMatrixWorld(),Ar.parent===null&&Ar.matrixWorldAutoUpdate===!0&&Ar.updateMatrixWorld(),jp.enabled===!0&&jp.isPresenting===!0&&(jp.cameraAutoUpdate===!0&&jp.updateCamera(Ar),Ar=jp.getCamera()),In.isScene===!0&&In.onBeforeRender(kt,In,Ar,ln),Tt=Ns.get(In,Nt.length),Tt.init(),Nt.push(Tt),Wr.multiplyMatrices(Ar.projectionMatrix,Ar.matrixWorldInverse),fr.setFromProjectionMatrix(Wr),Qr=this.localClippingEnabled,_r=eo.init(this.clippingPlanes,Qr,Ar),Pt=Ss.get(In,Rt.length),Pt.init(),Rt.push(Pt),gI(In,Ar,0,kt.sortObjects),Pt.finish(),kt.sortObjects===!0&&Pt.sort(Cr,Ur),kt.userData.shadowMapRender){_r===!0&&eo.beginShadows();const Rr=Tt.state.shadowsArray;Rr.length>0&&Bs.render(Rr,In,Ar),_r===!0&&eo.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),kt.userData.backgroundRender!==!1&&Fs.render(Pt,In),kt.userData.sceneRender!==!1)if(Tt.setupLights(kt.physicallyCorrectLights),Ar.isArrayCamera){const Rr=Ar.cameras;for(let Ir=0,Gr=Rr.length;Ir<Gr;Ir++){const gs=Rr[Ir];vI(Pt,In,gs,gs.viewport)}}else vI(Pt,In,Ar);ln!==null&&(qn.updateMultisampleRenderTarget(ln),qn.updateRenderTargetMipmap(ln)),In.isScene===!0&&In.onAfterRender(kt,In,Ar),yl.resetDefaultState(),gn=-1,_n=null,Nt.pop(),Tt=Nt.length>0?Nt[Nt.length-1]:null,Rt.pop(),Pt=Rt.length>0?Rt[Rt.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return $t},this.getActiveMipmapLevel=function(){return en},this.getRenderTarget=function(){return ln},this.setRenderTargetTextures=function(In,Ar,Rr){kn.get(In.texture).__webglTexture=Ar,kn.get(In.depthTexture).__webglTexture=Rr;const Ir=kn.get(In);Ir.__hasExternalTextures=!0,Ir.__hasExternalTextures&&(Ir.__autoAllocateDepthBuffer=Rr===void 0,Ir.__autoAllocateDepthBuffer||Rn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ir.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(In,Ar){const Rr=kn.get(In);Rr.__webglFramebuffer=Ar,Rr.__useDefaultFramebuffer=Ar===void 0},this.setRenderTarget=function(In,Ar=0,Rr=0){ln=In,$t=Ar,en=Rr;let Ir=!0;if(In){const Ls=kn.get(In);Ls.__useDefaultFramebuffer!==void 0?(sr.bindFramebuffer(36160,null),Ir=!1):Ls.__webglFramebuffer===void 0?qn.setupRenderTarget(In):Ls.__hasExternalTextures&&qn.rebindTextures(In,kn.get(In.texture).__webglTexture,kn.get(In.depthTexture).__webglTexture)}let Gr=null,gs=!1,Ro=!1;if(In){const Ls=In.texture;(Ls.isData3DTexture||Ls.isDataArrayTexture)&&(Ro=!0);const mo=kn.get(In).__webglFramebuffer;In.isWebGLCubeRenderTarget?(Gr=mo[Ar],gs=!0):Gr=Mn.isWebGL2&&In.samples>0&&qn.useMultisampledRTT(In)===!1?kn.get(In).__webglMultisampledFramebuffer:mo,An.copy(In.viewport),Ln.copy(In.scissor),Nn=In.scissorTest}else An.copy(Er).multiplyScalar(jn).floor(),Ln.copy(qr).multiplyScalar(jn).floor(),Nn=Yr;if(sr.bindFramebuffer(36160,Gr)&&Mn.drawBuffers&&Ir&&sr.drawBuffers(In,Gr),sr.viewport(An),sr.scissor(Ln),sr.setScissorTest(Nn),gs){const Ls=kn.get(In.texture);ss.framebufferTexture2D(36160,36064,34069+Ar,Ls.__webglTexture,Rr)}else if(Ro){const Ls=kn.get(In.texture),mo=Ar||0;ss.framebufferTextureLayer(36160,36064,Ls.__webglTexture,Rr||0,mo)}gn=-1},this.readRenderTargetPixels=function(In,Ar,Rr,Ir,Gr,gs,Ro){if(!In||!In.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ls=kn.get(In).__webglFramebuffer;if(In.isWebGLCubeRenderTarget&&Ro!==void 0&&(Ls=Ls[Ro]),Ls){sr.bindFramebuffer(36160,Ls);try{const mo=In.texture,Xl=mo.format,ko=mo.type;if(Xl!==bs&&_l.convert(Xl)!==ss.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const ao=ko===Wu&&(Rn.has("EXT_color_buffer_half_float")||Mn.isWebGL2&&Rn.has("EXT_color_buffer_float"));if(!(ko===$l||_l.convert(ko)===ss.getParameter(35738)||ko===ba&&(Mn.isWebGL2||Rn.has("OES_texture_float")||Rn.has("WEBGL_color_buffer_float"))||ao))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ar>=0&&Ar<=In.width-Ir&&Rr>=0&&Rr<=In.height-Gr&&ss.readPixels(Ar,Rr,Ir,Gr,_l.convert(Xl),_l.convert(ko),gs)}finally{const mo=ln!==null?kn.get(ln).__webglFramebuffer:null;sr.bindFramebuffer(36160,mo)}}},this.copyFramebufferToTexture=function(In,Ar,Rr=0){const Ir=Math.pow(2,-Rr),Gr=Math.floor(Ar.image.width*Ir),gs=Math.floor(Ar.image.height*Ir);qn.setTexture2D(Ar,0),ss.copyTexSubImage2D(3553,Rr,0,0,In.x,In.y,Gr,gs),sr.unbindTexture()},this.copyTextureToTexture=function(In,Ar,Rr,Ir=0){const Gr=Ar.image.width,gs=Ar.image.height,Ro=_l.convert(Rr.format),Ls=_l.convert(Rr.type);qn.setTexture2D(Rr,0),ss.pixelStorei(37440,Rr.flipY),ss.pixelStorei(37441,Rr.premultiplyAlpha),ss.pixelStorei(3317,Rr.unpackAlignment),Ar.isDataTexture?ss.texSubImage2D(3553,Ir,In.x,In.y,Gr,gs,Ro,Ls,Ar.image.data):Ar.isCompressedTexture?ss.compressedTexSubImage2D(3553,Ir,In.x,In.y,Ar.mipmaps[0].width,Ar.mipmaps[0].height,Ro,Ar.mipmaps[0].data):ss.texSubImage2D(3553,Ir,In.x,In.y,Ro,Ls,Ar.image),Ir===0&&Rr.generateMipmaps&&ss.generateMipmap(3553),sr.unbindTexture()},this.copyTextureToTexture3D=function(In,Ar,Rr,Ir,Gr=0){if(kt.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const gs=In.max.x-In.min.x+1,Ro=In.max.y-In.min.y+1,Ls=In.max.z-In.min.z+1,mo=_l.convert(Ir.format),Xl=_l.convert(Ir.type);let ko;if(Ir.isData3DTexture)qn.setTexture3D(Ir,0),ko=32879;else{if(!Ir.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");qn.setTexture2DArray(Ir,0),ko=35866}ss.pixelStorei(37440,Ir.flipY),ss.pixelStorei(37441,Ir.premultiplyAlpha),ss.pixelStorei(3317,Ir.unpackAlignment);const ao=ss.getParameter(3314),Eu=ss.getParameter(32878),Hx=ss.getParameter(3316),_g=ss.getParameter(3315),GE=ss.getParameter(32877),d_=Rr.isCompressedTexture?Rr.mipmaps[0]:Rr.image;ss.pixelStorei(3314,d_.width),ss.pixelStorei(32878,d_.height),ss.pixelStorei(3316,In.min.x),ss.pixelStorei(3315,In.min.y),ss.pixelStorei(32877,In.min.z),Rr.isDataTexture||Rr.isData3DTexture?ss.texSubImage3D(ko,Gr,Ar.x,Ar.y,Ar.z,gs,Ro,Ls,mo,Xl,d_.data):Rr.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ss.compressedTexSubImage3D(ko,Gr,Ar.x,Ar.y,Ar.z,gs,Ro,Ls,mo,d_.data)):ss.texSubImage3D(ko,Gr,Ar.x,Ar.y,Ar.z,gs,Ro,Ls,mo,Xl,d_),ss.pixelStorei(3314,ao),ss.pixelStorei(32878,Eu),ss.pixelStorei(3316,Hx),ss.pixelStorei(3315,_g),ss.pixelStorei(32877,GE),Gr===0&&Ir.generateMipmaps&&ss.generateMipmap(ko),sr.unbindTexture()},this.initTexture=function(In){In.isCubeTexture?qn.setTextureCube(In,0):In.isData3DTexture?qn.setTexture3D(In,0):In.isDataArrayTexture?qn.setTexture2DArray(In,0):qn.setTexture2D(In,0),sr.unbindTexture()},this.resetState=function(){$t=0,en=0,ln=null,sr.reset(),yl.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class iC extends su{}iC.prototype.isWebGL1Renderer=!0;class G0{constructor(o,b=25e-5){this.isFogExp2=!0,this.name="",this.color=new as(o),this.density=b}clone(){return new G0(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class HA{constructor(o,b=1,et=1e3){this.isFog=!0,this.name="",this.color=new as(o),this.near=b,this.far=et}clone(){return new HA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class wT extends Zs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,b){return super.copy(o,b),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const b=super.toJSON(o);return this.fog!==null&&(b.object.fog=this.fog.toJSON()),b}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class Y1{constructor(o,b){this.isInterleavedBuffer=!0,this.array=o,this.stride=b,this.count=o!==void 0?o.length/b:0,this.usage=P_,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Xu()}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.array=new o.array.constructor(o.array),this.count=o.count,this.stride=o.stride,this.usage=o.usage,this}copyAt(o,b,et){o*=this.stride,et*=b.stride;for(let tt=0,ot=this.stride;tt<ot;tt++)this.array[o+tt]=b.array[et+tt];return this}set(o,b=0){return this.array.set(o,b),this}clone(o){o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Xu()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const b=new this.array.constructor(o.arrayBuffers[this.array.buffer._uuid]),et=new this.constructor(b,this.stride);return et.setUsage(this.usage),et}onUpload(o){return this.onUploadCallback=o,this}toJSON(o){return o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Xu()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Sp=new xn;class r_{constructor(o,b,et,tt=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=o,this.itemSize=b,this.offset=et,this.normalized=tt===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(o){this.data.needsUpdate=o}applyMatrix4(o){for(let b=0,et=this.data.count;b<et;b++)Sp.fromBufferAttribute(this,b),Sp.applyMatrix4(o),this.setXYZ(b,Sp.x,Sp.y,Sp.z);return this}applyNormalMatrix(o){for(let b=0,et=this.count;b<et;b++)Sp.fromBufferAttribute(this,b),Sp.applyNormalMatrix(o),this.setXYZ(b,Sp.x,Sp.y,Sp.z);return this}transformDirection(o){for(let b=0,et=this.count;b<et;b++)Sp.fromBufferAttribute(this,b),Sp.transformDirection(o),this.setXYZ(b,Sp.x,Sp.y,Sp.z);return this}setX(o,b){return this.normalized&&(b=$a(b,this.array)),this.data.array[o*this.data.stride+this.offset]=b,this}setY(o,b){return this.normalized&&(b=$a(b,this.array)),this.data.array[o*this.data.stride+this.offset+1]=b,this}setZ(o,b){return this.normalized&&(b=$a(b,this.array)),this.data.array[o*this.data.stride+this.offset+2]=b,this}setW(o,b){return this.normalized&&(b=$a(b,this.array)),this.data.array[o*this.data.stride+this.offset+3]=b,this}getX(o){let b=this.data.array[o*this.data.stride+this.offset];return this.normalized&&(b=pv(b,this.array)),b}getY(o){let b=this.data.array[o*this.data.stride+this.offset+1];return this.normalized&&(b=pv(b,this.array)),b}getZ(o){let b=this.data.array[o*this.data.stride+this.offset+2];return this.normalized&&(b=pv(b,this.array)),b}getW(o){let b=this.data.array[o*this.data.stride+this.offset+3];return this.normalized&&(b=pv(b,this.array)),b}setXY(o,b,et){return o=o*this.data.stride+this.offset,this.normalized&&(b=$a(b,this.array),et=$a(et,this.array)),this.data.array[o+0]=b,this.data.array[o+1]=et,this}setXYZ(o,b,et,tt){return o=o*this.data.stride+this.offset,this.normalized&&(b=$a(b,this.array),et=$a(et,this.array),tt=$a(tt,this.array)),this.data.array[o+0]=b,this.data.array[o+1]=et,this.data.array[o+2]=tt,this}setXYZW(o,b,et,tt,ot){return o=o*this.data.stride+this.offset,this.normalized&&(b=$a(b,this.array),et=$a(et,this.array),tt=$a(tt,this.array),ot=$a(ot,this.array)),this.data.array[o+0]=b,this.data.array[o+1]=et,this.data.array[o+2]=tt,this.data.array[o+3]=ot,this}clone(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const b=[];for(let et=0;et<this.count;et++){const tt=et*this.data.stride+this.offset;for(let ot=0;ot<this.itemSize;ot++)b.push(this.data.array[tt+ot])}return new ga(new this.array.constructor(b),this.itemSize,this.normalized)}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.clone(o)),new r_(o.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const b=[];for(let et=0;et<this.count;et++){const tt=et*this.data.stride+this.offset;for(let ot=0;ot<this.itemSize;ot++)b.push(this.data.array[tt+ot])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:b,normalized:this.normalized}}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.toJSON(o)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class X1 extends Lu{constructor(o){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new as(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.rotation=o.rotation,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}let H0;const q_=new xn,zy=new xn,i_=new xn,Y_=new Lr,Vy=new Lr,xT=new zs,W0=new xn,q0=new xn,tx=new xn,K1=new Lr,$1=new Lr,bT=new Lr;class J1 extends Zs{constructor(o){if(super(),this.isSprite=!0,this.type="Sprite",H0===void 0){H0=new ms;const b=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),et=new Y1(b,5);H0.setIndex([0,1,2,0,2,3]),H0.setAttribute("position",new r_(et,3,0,!1)),H0.setAttribute("uv",new r_(et,2,3,!1))}this.geometry=H0,this.material=o!==void 0?o:new X1,this.center=new Lr(.5,.5)}raycast(o,b){o.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),zy.setFromMatrixScale(this.matrixWorld),xT.copy(o.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(o.camera.matrixWorldInverse,this.matrixWorld),i_.setFromMatrixPosition(this.modelViewMatrix),o.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&zy.multiplyScalar(-i_.z);const et=this.material.rotation;let tt,ot;et!==0&&(ot=Math.cos(et),tt=Math.sin(et));const lt=this.center;X_(W0.set(-.5,-.5,0),i_,lt,zy,tt,ot),X_(q0.set(.5,-.5,0),i_,lt,zy,tt,ot),X_(tx.set(.5,.5,0),i_,lt,zy,tt,ot),K1.set(0,0),$1.set(1,0),bT.set(1,1);let ht=o.ray.intersectTriangle(W0,q0,tx,!1,q_);if(ht===null&&(X_(q0.set(-.5,.5,0),i_,lt,zy,tt,ot),$1.set(0,1),ht=o.ray.intersectTriangle(W0,tx,q0,!1,q_),ht===null))return;const vt=o.ray.origin.distanceTo(q_);vt<o.near||vt>o.far||b.push({distance:vt,point:q_.clone(),uv:Ou.getUV(q_,W0,q0,tx,K1,$1,bT,new Lr),face:null,object:this})}copy(o,b){return super.copy(o,b),o.center!==void 0&&this.center.copy(o.center),this.material=o.material,this}}function X_(dt,o,b,et,tt,ot){Y_.subVectors(dt,b).addScalar(.5).multiply(et),tt!==void 0?(Vy.x=ot*Y_.x-tt*Y_.y,Vy.y=tt*Y_.x+ot*Y_.y):Vy.copy(Y_),dt.copy(o),dt.x+=Vy.x,dt.y+=Vy.y,dt.applyMatrix4(xT)}const WA=new xn,ET=new xn;class qA extends Zs{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(o){super.copy(o,!1);const b=o.levels;for(let et=0,tt=b.length;et<tt;et++){const ot=b[et];this.addLevel(ot.object.clone(),ot.distance)}return this.autoUpdate=o.autoUpdate,this}addLevel(o,b=0){b=Math.abs(b);const et=this.levels;let tt;for(tt=0;tt<et.length&&!(b<et[tt].distance);tt++);return et.splice(tt,0,{distance:b,object:o}),this.add(o),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(o){const b=this.levels;if(b.length>0){let et,tt;for(et=1,tt=b.length;et<tt&&!(o<b[et].distance);et++);return b[et-1].object}return null}raycast(o,b){if(this.levels.length>0){WA.setFromMatrixPosition(this.matrixWorld);const et=o.ray.origin.distanceTo(WA);this.getObjectForDistance(et).raycast(o,b)}}update(o){const b=this.levels;if(b.length>1){WA.setFromMatrixPosition(o.matrixWorld),ET.setFromMatrixPosition(this.matrixWorld);const et=WA.distanceTo(ET)/o.zoom;let tt,ot;for(b[0].object.visible=!0,tt=1,ot=b.length;tt<ot&&et>=b[tt].distance;tt++)b[tt-1].object.visible=!1,b[tt].object.visible=!0;for(this._currentLevel=tt-1;tt<ot;tt++)b[tt].object.visible=!1}}toJSON(o){const b=super.toJSON(o);this.autoUpdate===!1&&(b.object.autoUpdate=!1),b.object.levels=[];const et=this.levels;for(let tt=0,ot=et.length;tt<ot;tt++){const lt=et[tt];b.object.levels.push({object:lt.object.uuid,distance:lt.distance})}return b}}const Qy=new xn,ST=new Uo,CT=new Uo,MT=new xn,Z1=new zs;class sC extends Nu{constructor(o,b){super(o,b),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new zs,this.bindMatrixInverse=new zs}copy(o,b){return super.copy(o,b),this.bindMode=o.bindMode,this.bindMatrix.copy(o.bindMatrix),this.bindMatrixInverse.copy(o.bindMatrixInverse),this.skeleton=o.skeleton,this}bind(o,b){this.skeleton=o,b===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld),this.bindMatrix.copy(b),this.bindMatrixInverse.copy(b).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const o=new Uo,b=this.geometry.attributes.skinWeight;for(let et=0,tt=b.count;et<tt;et++){o.fromBufferAttribute(b,et);const ot=1/o.manhattanLength();ot!==1/0?o.multiplyScalar(ot):o.set(1,0,0,0),b.setXYZW(et,o.x,o.y,o.z,o.w)}}updateMatrixWorld(o){super.updateMatrixWorld(o),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(o,b){const et=this.skeleton,tt=this.geometry;ST.fromBufferAttribute(tt.attributes.skinIndex,o),CT.fromBufferAttribute(tt.attributes.skinWeight,o),Qy.copy(b).applyMatrix4(this.bindMatrix),b.set(0,0,0);for(let ot=0;ot<4;ot++){const lt=CT.getComponent(ot);if(lt!==0){const ht=ST.getComponent(ot);Z1.multiplyMatrices(et.bones[ht].matrixWorld,et.boneInverses[ht]),b.addScaledVector(MT.copy(Qy).applyMatrix4(Z1),lt)}}return b.applyMatrix4(this.bindMatrixInverse)}}class oC extends Zs{constructor(){super(),this.isBone=!0,this.type="Bone"}}class YA extends vu{constructor(o=null,b=1,et=1,tt,ot,lt,ht,vt,_t=qo,Mt=qo,Pt,Tt){super(null,lt,ht,vt,_t,Mt,tt,ot,Pt,Tt),this.isDataTexture=!0,this.image={data:o,width:b,height:et},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const aC=new zs,TT=new zs;class nx{constructor(o=[],b=[]){this.uuid=Xu(),this.bones=o.slice(0),this.boneInverses=b,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const o=this.bones,b=this.boneInverses;if(this.boneMatrices=new Float32Array(16*o.length),b.length===0)this.calculateInverses();else if(o.length!==b.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let et=0,tt=this.bones.length;et<tt;et++)this.boneInverses.push(new zs)}}calculateInverses(){this.boneInverses.length=0;for(let o=0,b=this.bones.length;o<b;o++){const et=new zs;this.bones[o]&&et.copy(this.bones[o].matrixWorld).invert(),this.boneInverses.push(et)}}pose(){for(let o=0,b=this.bones.length;o<b;o++){const et=this.bones[o];et&&et.matrixWorld.copy(this.boneInverses[o]).invert()}for(let o=0,b=this.bones.length;o<b;o++){const et=this.bones[o];et&&(et.parent&&et.parent.isBone?(et.matrix.copy(et.parent.matrixWorld).invert(),et.matrix.multiply(et.matrixWorld)):et.matrix.copy(et.matrixWorld),et.matrix.decompose(et.position,et.quaternion,et.scale))}}update(){const o=this.bones,b=this.boneInverses,et=this.boneMatrices,tt=this.boneTexture;for(let ot=0,lt=o.length;ot<lt;ot++){const ht=o[ot]?o[ot].matrixWorld:TT;aC.multiplyMatrices(ht,b[ot]),aC.toArray(et,16*ot)}tt!==null&&(tt.needsUpdate=!0)}clone(){return new nx(this.bones,this.boneInverses)}computeBoneTexture(){let o=Math.sqrt(4*this.bones.length);o=qv(o),o=Math.max(o,4);const b=new Float32Array(o*o*4);b.set(this.boneMatrices);const et=new YA(b,o,o,bs,ba);return et.needsUpdate=!0,this.boneMatrices=b,this.boneTexture=et,this.boneTextureSize=o,this}getBoneByName(o){for(let b=0,et=this.bones.length;b<et;b++){const tt=this.bones[b];if(tt.name===o)return tt}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(o,b){this.uuid=o.uuid;for(let et=0,tt=o.bones.length;et<tt;et++){const ot=o.bones[et];let lt=b[ot];lt===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",ot),lt=new oC),this.bones.push(lt),this.boneInverses.push(new zs().fromArray(o.boneInverses[et]))}return this.init(),this}toJSON(){const o={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};o.uuid=this.uuid;const b=this.bones,et=this.boneInverses;for(let tt=0,ot=b.length;tt<ot;tt++){const lt=b[tt];o.bones.push(lt.uuid);const ht=et[tt];o.boneInverses.push(ht.toArray())}return o}}class Gy extends ga{constructor(o,b,et,tt=1){super(o,b,et),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=tt}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}toJSON(){const o=super.toJSON();return o.meshPerAttribute=this.meshPerAttribute,o.isInstancedBufferAttribute=!0,o}}const lC=new zs,IT=new zs,rx=[],ix=new Nu;class eE extends Nu{constructor(o,b,et){super(o,b),this.isInstancedMesh=!0,this.instanceMatrix=new Gy(new Float32Array(16*et),16),this.instanceColor=null,this.count=et,this.frustumCulled=!1}copy(o,b){return super.copy(o,b),this.instanceMatrix.copy(o.instanceMatrix),o.instanceColor!==null&&(this.instanceColor=o.instanceColor.clone()),this.count=o.count,this}getColorAt(o,b){b.fromArray(this.instanceColor.array,3*o)}getMatrixAt(o,b){b.fromArray(this.instanceMatrix.array,16*o)}raycast(o,b){const et=this.matrixWorld,tt=this.count;if(ix.geometry=this.geometry,ix.material=this.material,ix.material!==void 0)for(let ot=0;ot<tt;ot++){this.getMatrixAt(ot,lC),IT.multiplyMatrices(et,lC),ix.matrixWorld=IT,ix.raycast(o,rx);for(let lt=0,ht=rx.length;lt<ht;lt++){const vt=rx[lt];vt.instanceId=ot,vt.object=this,b.push(vt)}rx.length=0}}setColorAt(o,b){this.instanceColor===null&&(this.instanceColor=new Gy(new Float32Array(3*this.instanceMatrix.count),3)),b.toArray(this.instanceColor.array,3*o)}setMatrixAt(o,b){b.toArray(this.instanceMatrix.array,16*o)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Lp extends Lu{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new as(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const tE=new xn,cC=new xn,uC=new zs,hC=new $v,sx=new _f;class s_ extends Zs{constructor(o=new ms,b=new Lp){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=b,this.updateMorphTargets()}copy(o,b){return super.copy(o,b),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const b=o.attributes.position,et=[0];for(let tt=1,ot=b.count;tt<ot;tt++)tE.fromBufferAttribute(b,tt-1),cC.fromBufferAttribute(b,tt),et[tt]=et[tt-1],et[tt]+=tE.distanceTo(cC);o.setAttribute("lineDistance",new ft(et,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,b){const et=this.geometry,tt=this.matrixWorld,ot=o.params.Line.threshold,lt=et.drawRange;if(et.boundingSphere===null&&et.computeBoundingSphere(),sx.copy(et.boundingSphere),sx.applyMatrix4(tt),sx.radius+=ot,o.ray.intersectsSphere(sx)===!1)return;uC.copy(tt).invert(),hC.copy(o.ray).applyMatrix4(uC);const ht=ot/((this.scale.x+this.scale.y+this.scale.z)/3),vt=ht*ht,_t=new xn,Mt=new xn,Pt=new xn,Tt=new xn,Rt=this.isLineSegments?2:1,Nt=et.index,kt=et.attributes.position;if(Nt!==null)for(let Kt=Math.max(0,lt.start),$t=Math.min(Nt.count,lt.start+lt.count)-1;Kt<$t;Kt+=Rt){const en=Nt.getX(Kt),ln=Nt.getX(Kt+1);if(_t.fromBufferAttribute(kt,en),Mt.fromBufferAttribute(kt,ln),hC.distanceSqToSegment(_t,Mt,Tt,Pt)>vt)continue;Tt.applyMatrix4(this.matrixWorld);const gn=o.ray.origin.distanceTo(Tt);gn<o.near||gn>o.far||b.push({distance:gn,point:Pt.clone().applyMatrix4(this.matrixWorld),index:Kt,face:null,faceIndex:null,object:this})}else for(let Kt=Math.max(0,lt.start),$t=Math.min(kt.count,lt.start+lt.count)-1;Kt<$t;Kt+=Rt){if(_t.fromBufferAttribute(kt,Kt),Mt.fromBufferAttribute(kt,Kt+1),hC.distanceSqToSegment(_t,Mt,Tt,Pt)>vt)continue;Tt.applyMatrix4(this.matrixWorld);const en=o.ray.origin.distanceTo(Tt);en<o.near||en>o.far||b.push({distance:en,point:Pt.clone().applyMatrix4(this.matrixWorld),index:Kt,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const o=this.geometry.morphAttributes,b=Object.keys(o);if(b.length>0){const et=o[b[0]];if(et!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let tt=0,ot=et.length;tt<ot;tt++){const lt=et[tt].name||String(tt);this.morphTargetInfluences.push(0),this.morphTargetDictionary[lt]=tt}}}}}const PT=new xn,nE=new xn;class o_ extends s_{constructor(o,b){super(o,b),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const b=o.attributes.position,et=[];for(let tt=0,ot=b.count;tt<ot;tt+=2)PT.fromBufferAttribute(b,tt),nE.fromBufferAttribute(b,tt+1),et[tt]=tt===0?0:et[tt-1],et[tt+1]=et[tt]+PT.distanceTo(nE);o.setAttribute("lineDistance",new ft(et,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class XA extends s_{constructor(o,b){super(o,b),this.isLineLoop=!0,this.type="LineLoop"}}class rE extends Lu{constructor(o){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new as(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.size=o.size,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}const dC=new zs,iE=new $v,sE=new _f,ox=new xn;class oE extends Zs{constructor(o=new ms,b=new rE){super(),this.isPoints=!0,this.type="Points",this.geometry=o,this.material=b,this.updateMorphTargets()}copy(o,b){return super.copy(o,b),this.material=o.material,this.geometry=o.geometry,this}raycast(o,b){const et=this.geometry,tt=this.matrixWorld,ot=o.params.Points.threshold,lt=et.drawRange;if(et.boundingSphere===null&&et.computeBoundingSphere(),sE.copy(et.boundingSphere),sE.applyMatrix4(tt),sE.radius+=ot,o.ray.intersectsSphere(sE)===!1)return;dC.copy(tt).invert(),iE.copy(o.ray).applyMatrix4(dC);const ht=ot/((this.scale.x+this.scale.y+this.scale.z)/3),vt=ht*ht,_t=et.index,Mt=et.attributes.position;if(_t!==null)for(let Pt=Math.max(0,lt.start),Tt=Math.min(_t.count,lt.start+lt.count);Pt<Tt;Pt++){const Rt=_t.getX(Pt);ox.fromBufferAttribute(Mt,Rt),KA(ox,Rt,vt,tt,o,b,this)}else for(let Pt=Math.max(0,lt.start),Tt=Math.min(Mt.count,lt.start+lt.count);Pt<Tt;Pt++)ox.fromBufferAttribute(Mt,Pt),KA(ox,Pt,vt,tt,o,b,this)}updateMorphTargets(){const o=this.geometry.morphAttributes,b=Object.keys(o);if(b.length>0){const et=o[b[0]];if(et!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let tt=0,ot=et.length;tt<ot;tt++){const lt=et[tt].name||String(tt);this.morphTargetInfluences.push(0),this.morphTargetDictionary[lt]=tt}}}}}function KA(dt,o,b,et,tt,ot,lt){const ht=iE.distanceSqToPoint(dt);if(ht<b){const vt=new xn;iE.closestPointToPoint(dt,vt),vt.applyMatrix4(et);const _t=tt.ray.origin.distanceTo(vt);if(_t<tt.near||_t>tt.far)return;ot.push({distance:_t,distanceToRay:Math.sqrt(ht),point:vt,index:o,face:null,object:lt})}}class pC extends vu{constructor(o,b,et,tt,ot,lt,ht,vt,_t){super(o,b,et,tt,ot,lt,ht,vt,_t),this.isVideoTexture=!0,this.minFilter=lt!==void 0?lt:Vo,this.magFilter=ot!==void 0?ot:Vo,this.generateMipmaps=!1;const Mt=this;"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(function Pt(){Mt.needsUpdate=!0,o.requestVideoFrameCallback(Pt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;!("requestVideoFrameCallback"in o)&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ax extends vu{constructor(o,b,et){super({width:o,height:b}),this.isFramebufferTexture=!0,this.format=et,this.magFilter=qo,this.minFilter=qo,this.generateMipmaps=!1,this.needsUpdate=!0}}class lx extends vu{constructor(o,b,et,tt,ot,lt,ht,vt,_t,Mt,Pt,Tt){super(null,lt,ht,vt,_t,Mt,tt,ot,Pt,Tt),this.isCompressedTexture=!0,this.image={width:b,height:et},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}}class fC extends vu{constructor(o,b,et,tt,ot,lt,ht,vt,_t){super(o,b,et,tt,ot,lt,ht,vt,_t),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Cv{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(o,b){const et=this.getUtoTmapping(o);return this.getPoint(et,b)}getPoints(o=5){const b=[];for(let et=0;et<=o;et++)b.push(this.getPoint(et/o));return b}getSpacedPoints(o=5){const b=[];for(let et=0;et<=o;et++)b.push(this.getPointAt(et/o));return b}getLength(){const o=this.getLengths();return o[o.length-1]}getLengths(o=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===o+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const b=[];let et,tt=this.getPoint(0),ot=0;b.push(0);for(let lt=1;lt<=o;lt++)et=this.getPoint(lt/o),ot+=et.distanceTo(tt),b.push(ot),tt=et;return this.cacheArcLengths=b,b}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(o,b){const et=this.getLengths();let tt=0;const ot=et.length;let lt;lt=b||o*et[ot-1];let ht,vt=0,_t=ot-1;for(;vt<=_t;)if(tt=Math.floor(vt+(_t-vt)/2),ht=et[tt]-lt,ht<0)vt=tt+1;else{if(!(ht>0)){_t=tt;break}_t=tt-1}if(tt=_t,et[tt]===lt)return tt/(ot-1);const Mt=et[tt];return(tt+(lt-Mt)/(et[tt+1]-Mt))/(ot-1)}getTangent(o,b){let tt=o-1e-4,ot=o+1e-4;tt<0&&(tt=0),ot>1&&(ot=1);const lt=this.getPoint(tt),ht=this.getPoint(ot),vt=b||(lt.isVector2?new Lr:new xn);return vt.copy(ht).sub(lt).normalize(),vt}getTangentAt(o,b){const et=this.getUtoTmapping(o);return this.getTangent(et,b)}computeFrenetFrames(o,b){const et=new xn,tt=[],ot=[],lt=[],ht=new xn,vt=new zs;for(let Rt=0;Rt<=o;Rt++){const Nt=Rt/o;tt[Rt]=this.getTangentAt(Nt,new xn)}ot[0]=new xn,lt[0]=new xn;let _t=Number.MAX_VALUE;const Mt=Math.abs(tt[0].x),Pt=Math.abs(tt[0].y),Tt=Math.abs(tt[0].z);Mt<=_t&&(_t=Mt,et.set(1,0,0)),Pt<=_t&&(_t=Pt,et.set(0,1,0)),Tt<=_t&&et.set(0,0,1),ht.crossVectors(tt[0],et).normalize(),ot[0].crossVectors(tt[0],ht),lt[0].crossVectors(tt[0],ot[0]);for(let Rt=1;Rt<=o;Rt++){if(ot[Rt]=ot[Rt-1].clone(),lt[Rt]=lt[Rt-1].clone(),ht.crossVectors(tt[Rt-1],tt[Rt]),ht.length()>Number.EPSILON){ht.normalize();const Nt=Math.acos(Ts(tt[Rt-1].dot(tt[Rt]),-1,1));ot[Rt].applyMatrix4(vt.makeRotationAxis(ht,Nt))}lt[Rt].crossVectors(tt[Rt],ot[Rt])}if(b===!0){let Rt=Math.acos(Ts(ot[0].dot(ot[o]),-1,1));Rt/=o,tt[0].dot(ht.crossVectors(ot[0],ot[o]))>0&&(Rt=-Rt);for(let Nt=1;Nt<=o;Nt++)ot[Nt].applyMatrix4(vt.makeRotationAxis(tt[Nt],Rt*Nt)),lt[Nt].crossVectors(tt[Nt],ot[Nt])}return{tangents:tt,normals:ot,binormals:lt}}clone(){return new this.constructor().copy(this)}copy(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}toJSON(){const o={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return o.arcLengthDivisions=this.arcLengthDivisions,o.type=this.type,o}fromJSON(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}}class aE extends Cv{constructor(o=0,b=0,et=1,tt=1,ot=0,lt=2*Math.PI,ht=!1,vt=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=o,this.aY=b,this.xRadius=et,this.yRadius=tt,this.aStartAngle=ot,this.aEndAngle=lt,this.aClockwise=ht,this.aRotation=vt}getPoint(o,b){const et=b||new Lr,tt=2*Math.PI;let ot=this.aEndAngle-this.aStartAngle;const lt=Math.abs(ot)<Number.EPSILON;for(;ot<0;)ot+=tt;for(;ot>tt;)ot-=tt;ot<Number.EPSILON&&(ot=lt?0:tt),this.aClockwise!==!0||lt||(ot===tt?ot=-tt:ot-=tt);const ht=this.aStartAngle+o*ot;let vt=this.aX+this.xRadius*Math.cos(ht),_t=this.aY+this.yRadius*Math.sin(ht);if(this.aRotation!==0){const Mt=Math.cos(this.aRotation),Pt=Math.sin(this.aRotation),Tt=vt-this.aX,Rt=_t-this.aY;vt=Tt*Mt-Rt*Pt+this.aX,_t=Tt*Pt+Rt*Mt+this.aY}return et.set(vt,_t)}copy(o){return super.copy(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}toJSON(){const o=super.toJSON();return o.aX=this.aX,o.aY=this.aY,o.xRadius=this.xRadius,o.yRadius=this.yRadius,o.aStartAngle=this.aStartAngle,o.aEndAngle=this.aEndAngle,o.aClockwise=this.aClockwise,o.aRotation=this.aRotation,o}fromJSON(o){return super.fromJSON(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}}class DT extends aE{constructor(o,b,et,tt,ot,lt){super(o,b,et,et,tt,ot,lt),this.isArcCurve=!0,this.type="ArcCurve"}}function lE(){let dt=0,o=0,b=0,et=0;function tt(ot,lt,ht,vt){dt=ot,o=ht,b=-3*ot+3*lt-2*ht-vt,et=2*ot-2*lt+ht+vt}return{initCatmullRom:function(ot,lt,ht,vt,_t){tt(lt,ht,_t*(ht-ot),_t*(vt-lt))},initNonuniformCatmullRom:function(ot,lt,ht,vt,_t,Mt,Pt){let Tt=(lt-ot)/_t-(ht-ot)/(_t+Mt)+(ht-lt)/Mt,Rt=(ht-lt)/Mt-(vt-lt)/(Mt+Pt)+(vt-ht)/Pt;Tt*=Mt,Rt*=Mt,tt(lt,ht,Tt,Rt)},calc:function(ot){const lt=ot*ot;return dt+o*ot+b*lt+et*(lt*ot)}}}const cE=new xn,uE=new lE,mC=new lE,hE=new lE;class RT extends Cv{constructor(o=[],b=!1,et="centripetal",tt=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=o,this.closed=b,this.curveType=et,this.tension=tt}getPoint(o,b=new xn){const et=b,tt=this.points,ot=tt.length,lt=(ot-(this.closed?0:1))*o;let ht,vt,_t=Math.floor(lt),Mt=lt-_t;this.closed?_t+=_t>0?0:(Math.floor(Math.abs(_t)/ot)+1)*ot:Mt===0&&_t===ot-1&&(_t=ot-2,Mt=1),this.closed||_t>0?ht=tt[(_t-1)%ot]:(cE.subVectors(tt[0],tt[1]).add(tt[0]),ht=cE);const Pt=tt[_t%ot],Tt=tt[(_t+1)%ot];if(this.closed||_t+2<ot?vt=tt[(_t+2)%ot]:(cE.subVectors(tt[ot-1],tt[ot-2]).add(tt[ot-1]),vt=cE),this.curveType==="centripetal"||this.curveType==="chordal"){const Rt=this.curveType==="chordal"?.5:.25;let Nt=Math.pow(ht.distanceToSquared(Pt),Rt),kt=Math.pow(Pt.distanceToSquared(Tt),Rt),Kt=Math.pow(Tt.distanceToSquared(vt),Rt);kt<1e-4&&(kt=1),Nt<1e-4&&(Nt=kt),Kt<1e-4&&(Kt=kt),uE.initNonuniformCatmullRom(ht.x,Pt.x,Tt.x,vt.x,Nt,kt,Kt),mC.initNonuniformCatmullRom(ht.y,Pt.y,Tt.y,vt.y,Nt,kt,Kt),hE.initNonuniformCatmullRom(ht.z,Pt.z,Tt.z,vt.z,Nt,kt,Kt)}else this.curveType==="catmullrom"&&(uE.initCatmullRom(ht.x,Pt.x,Tt.x,vt.x,this.tension),mC.initCatmullRom(ht.y,Pt.y,Tt.y,vt.y,this.tension),hE.initCatmullRom(ht.z,Pt.z,Tt.z,vt.z,this.tension));return et.set(uE.calc(Mt),mC.calc(Mt),hE.calc(Mt)),et}copy(o){super.copy(o),this.points=[];for(let b=0,et=o.points.length;b<et;b++){const tt=o.points[b];this.points.push(tt.clone())}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}toJSON(){const o=super.toJSON();o.points=[];for(let b=0,et=this.points.length;b<et;b++){const tt=this.points[b];o.points.push(tt.toArray())}return o.closed=this.closed,o.curveType=this.curveType,o.tension=this.tension,o}fromJSON(o){super.fromJSON(o),this.points=[];for(let b=0,et=o.points.length;b<et;b++){const tt=o.points[b];this.points.push(new xn().fromArray(tt))}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}}function $A(dt,o,b,et,tt){const ot=.5*(et-o),lt=.5*(tt-b),ht=dt*dt;return(2*b-2*et+ot+lt)*(dt*ht)+(-3*b+3*et-2*ot-lt)*ht+ot*dt+b}function Hy(dt,o,b,et){return function(tt,ot){const lt=1-tt;return lt*lt*ot}(dt,o)+function(tt,ot){return 2*(1-tt)*tt*ot}(dt,b)+function(tt,ot){return tt*tt*ot}(dt,et)}function ou(dt,o,b,et,tt){return function(ot,lt){const ht=1-ot;return ht*ht*ht*lt}(dt,o)+function(ot,lt){const ht=1-ot;return 3*ht*ht*ot*lt}(dt,b)+function(ot,lt){return 3*(1-ot)*ot*ot*lt}(dt,et)+function(ot,lt){return ot*ot*ot*lt}(dt,tt)}class cx extends Cv{constructor(o=new Lr,b=new Lr,et=new Lr,tt=new Lr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=o,this.v1=b,this.v2=et,this.v3=tt}getPoint(o,b=new Lr){const et=b,tt=this.v0,ot=this.v1,lt=this.v2,ht=this.v3;return et.set(ou(o,tt.x,ot.x,lt.x,ht.x),ou(o,tt.y,ot.y,lt.y,ht.y)),et}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class gC extends Cv{constructor(o=new xn,b=new xn,et=new xn,tt=new xn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=o,this.v1=b,this.v2=et,this.v3=tt}getPoint(o,b=new xn){const et=b,tt=this.v0,ot=this.v1,lt=this.v2,ht=this.v3;return et.set(ou(o,tt.x,ot.x,lt.x,ht.x),ou(o,tt.y,ot.y,lt.y,ht.y),ou(o,tt.z,ot.z,lt.z,ht.z)),et}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class ux extends Cv{constructor(o=new Lr,b=new Lr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=o,this.v2=b}getPoint(o,b=new Lr){const et=b;return o===1?et.copy(this.v2):(et.copy(this.v2).sub(this.v1),et.multiplyScalar(o).add(this.v1)),et}getPointAt(o,b){return this.getPoint(o,b)}getTangent(o,b){const et=b||new Lr;return et.copy(this.v2).sub(this.v1).normalize(),et}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class vC extends Cv{constructor(o=new xn,b=new xn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=o,this.v2=b}getPoint(o,b=new xn){const et=b;return o===1?et.copy(this.v2):(et.copy(this.v2).sub(this.v1),et.multiplyScalar(o).add(this.v1)),et}getPointAt(o,b){return this.getPoint(o,b)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class K_ extends Cv{constructor(o=new Lr,b=new Lr,et=new Lr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=o,this.v1=b,this.v2=et}getPoint(o,b=new Lr){const et=b,tt=this.v0,ot=this.v1,lt=this.v2;return et.set(Hy(o,tt.x,ot.x,lt.x),Hy(o,tt.y,ot.y,lt.y)),et}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class dE extends Cv{constructor(o=new xn,b=new xn,et=new xn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=o,this.v1=b,this.v2=et}getPoint(o,b=new xn){const et=b,tt=this.v0,ot=this.v1,lt=this.v2;return et.set(Hy(o,tt.x,ot.x,lt.x),Hy(o,tt.y,ot.y,lt.y),Hy(o,tt.z,ot.z,lt.z)),et}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class _C extends Cv{constructor(o=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=o}getPoint(o,b=new Lr){const et=b,tt=this.points,ot=(tt.length-1)*o,lt=Math.floor(ot),ht=ot-lt,vt=tt[lt===0?lt:lt-1],_t=tt[lt],Mt=tt[lt>tt.length-2?tt.length-1:lt+1],Pt=tt[lt>tt.length-3?tt.length-1:lt+2];return et.set($A(ht,vt.x,_t.x,Mt.x,Pt.x),$A(ht,vt.y,_t.y,Mt.y,Pt.y)),et}copy(o){super.copy(o),this.points=[];for(let b=0,et=o.points.length;b<et;b++){const tt=o.points[b];this.points.push(tt.clone())}return this}toJSON(){const o=super.toJSON();o.points=[];for(let b=0,et=this.points.length;b<et;b++){const tt=this.points[b];o.points.push(tt.toArray())}return o}fromJSON(o){super.fromJSON(o),this.points=[];for(let b=0,et=o.points.length;b<et;b++){const tt=o.points[b];this.points.push(new Lr().fromArray(tt))}return this}}var jo=Object.freeze({__proto__:null,ArcCurve:DT,CatmullRomCurve3:RT,CubicBezierCurve:cx,CubicBezierCurve3:gC,EllipseCurve:aE,LineCurve:ux,LineCurve3:vC,QuadraticBezierCurve:K_,QuadraticBezierCurve3:dE,SplineCurve:_C});class yC extends Cv{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(o){this.curves.push(o)}closePath(){const o=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);o.equals(b)||this.curves.push(new ux(b,o))}getPoint(o,b){const et=o*this.getLength(),tt=this.getCurveLengths();let ot=0;for(;ot<tt.length;){if(tt[ot]>=et){const lt=tt[ot]-et,ht=this.curves[ot],vt=ht.getLength(),_t=vt===0?0:1-lt/vt;return ht.getPointAt(_t,b)}ot++}return null}getLength(){const o=this.getCurveLengths();return o[o.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const o=[];let b=0;for(let et=0,tt=this.curves.length;et<tt;et++)b+=this.curves[et].getLength(),o.push(b);return this.cacheLengths=o,o}getSpacedPoints(o=40){const b=[];for(let et=0;et<=o;et++)b.push(this.getPoint(et/o));return this.autoClose&&b.push(b[0]),b}getPoints(o=12){const b=[];let et;for(let tt=0,ot=this.curves;tt<ot.length;tt++){const lt=ot[tt],ht=lt.isEllipseCurve?2*o:lt.isLineCurve||lt.isLineCurve3?1:lt.isSplineCurve?o*lt.points.length:o,vt=lt.getPoints(ht);for(let _t=0;_t<vt.length;_t++){const Mt=vt[_t];et&&et.equals(Mt)||(b.push(Mt),et=Mt)}}return this.autoClose&&b.length>1&&!b[b.length-1].equals(b[0])&&b.push(b[0]),b}copy(o){super.copy(o),this.curves=[];for(let b=0,et=o.curves.length;b<et;b++){const tt=o.curves[b];this.curves.push(tt.clone())}return this.autoClose=o.autoClose,this}toJSON(){const o=super.toJSON();o.autoClose=this.autoClose,o.curves=[];for(let b=0,et=this.curves.length;b<et;b++){const tt=this.curves[b];o.curves.push(tt.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.autoClose=o.autoClose,this.curves=[];for(let b=0,et=o.curves.length;b<et;b++){const tt=o.curves[b];this.curves.push(new jo[tt.type]().fromJSON(tt))}return this}}class JA extends yC{constructor(o){super(),this.type="Path",this.currentPoint=new Lr,o&&this.setFromPoints(o)}setFromPoints(o){this.moveTo(o[0].x,o[0].y);for(let b=1,et=o.length;b<et;b++)this.lineTo(o[b].x,o[b].y);return this}moveTo(o,b){return this.currentPoint.set(o,b),this}lineTo(o,b){const et=new ux(this.currentPoint.clone(),new Lr(o,b));return this.curves.push(et),this.currentPoint.set(o,b),this}quadraticCurveTo(o,b,et,tt){const ot=new K_(this.currentPoint.clone(),new Lr(o,b),new Lr(et,tt));return this.curves.push(ot),this.currentPoint.set(et,tt),this}bezierCurveTo(o,b,et,tt,ot,lt){const ht=new cx(this.currentPoint.clone(),new Lr(o,b),new Lr(et,tt),new Lr(ot,lt));return this.curves.push(ht),this.currentPoint.set(ot,lt),this}splineThru(o){const b=[this.currentPoint.clone()].concat(o),et=new _C(b);return this.curves.push(et),this.currentPoint.copy(o[o.length-1]),this}arc(o,b,et,tt,ot,lt){const ht=this.currentPoint.x,vt=this.currentPoint.y;return this.absarc(o+ht,b+vt,et,tt,ot,lt),this}absarc(o,b,et,tt,ot,lt){return this.absellipse(o,b,et,et,tt,ot,lt),this}ellipse(o,b,et,tt,ot,lt,ht,vt){const _t=this.currentPoint.x,Mt=this.currentPoint.y;return this.absellipse(o+_t,b+Mt,et,tt,ot,lt,ht,vt),this}absellipse(o,b,et,tt,ot,lt,ht,vt){const _t=new aE(o,b,et,tt,ot,lt,ht,vt);if(this.curves.length>0){const Pt=_t.getPoint(0);Pt.equals(this.currentPoint)||this.lineTo(Pt.x,Pt.y)}this.curves.push(_t);const Mt=_t.getPoint(1);return this.currentPoint.copy(Mt),this}copy(o){return super.copy(o),this.currentPoint.copy(o.currentPoint),this}toJSON(){const o=super.toJSON();return o.currentPoint=this.currentPoint.toArray(),o}fromJSON(o){return super.fromJSON(o),this.currentPoint.fromArray(o.currentPoint),this}}class Yl extends ms{constructor(o=[new Lr(0,-.5),new Lr(.5,0),new Lr(0,.5)],b=12,et=0,tt=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:b,phiStart:et,phiLength:tt},b=Math.floor(b),tt=Ts(tt,0,2*Math.PI);const ot=[],lt=[],ht=[],vt=[],_t=[],Mt=1/b,Pt=new xn,Tt=new Lr,Rt=new xn,Nt=new xn,kt=new xn;let Kt=0,$t=0;for(let en=0;en<=o.length-1;en++)switch(en){case 0:Kt=o[en+1].x-o[en].x,$t=o[en+1].y-o[en].y,Rt.x=1*$t,Rt.y=-Kt,Rt.z=0*$t,kt.copy(Rt),Rt.normalize(),vt.push(Rt.x,Rt.y,Rt.z);break;case o.length-1:vt.push(kt.x,kt.y,kt.z);break;default:Kt=o[en+1].x-o[en].x,$t=o[en+1].y-o[en].y,Rt.x=1*$t,Rt.y=-Kt,Rt.z=0*$t,Nt.copy(Rt),Rt.x+=kt.x,Rt.y+=kt.y,Rt.z+=kt.z,Rt.normalize(),vt.push(Rt.x,Rt.y,Rt.z),kt.copy(Nt)}for(let en=0;en<=b;en++){const ln=et+en*Mt*tt,gn=Math.sin(ln),_n=Math.cos(ln);for(let An=0;An<=o.length-1;An++){Pt.x=o[An].x*gn,Pt.y=o[An].y,Pt.z=o[An].x*_n,lt.push(Pt.x,Pt.y,Pt.z),Tt.x=en/b,Tt.y=An/(o.length-1),ht.push(Tt.x,Tt.y);const Ln=vt[3*An+0]*gn,Nn=vt[3*An+1],Jn=vt[3*An+0]*_n;_t.push(Ln,Nn,Jn)}}for(let en=0;en<b;en++)for(let ln=0;ln<o.length-1;ln++){const gn=ln+en*o.length,_n=gn,An=gn+o.length,Ln=gn+o.length+1,Nn=gn+1;ot.push(_n,An,Nn),ot.push(Ln,Nn,An)}this.setIndex(ot),this.setAttribute("position",new ft(lt,3)),this.setAttribute("uv",new ft(ht,2)),this.setAttribute("normal",new ft(_t,3))}static fromJSON(o){return new Yl(o.points,o.segments,o.phiStart,o.phiLength)}}class hx extends Yl{constructor(o=1,b=1,et=4,tt=8){const ot=new JA;ot.absarc(0,-b/2,o,1.5*Math.PI,0),ot.absarc(0,b/2,o,0,.5*Math.PI),super(ot.getPoints(et),tt),this.type="CapsuleGeometry",this.parameters={radius:o,height:b,capSegments:et,radialSegments:tt}}static fromJSON(o){return new hx(o.radius,o.length,o.capSegments,o.radialSegments)}}class Sm extends ms{constructor(o=1,b=8,et=0,tt=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:o,segments:b,thetaStart:et,thetaLength:tt},b=Math.max(3,b);const ot=[],lt=[],ht=[],vt=[],_t=new xn,Mt=new Lr;lt.push(0,0,0),ht.push(0,0,1),vt.push(.5,.5);for(let Pt=0,Tt=3;Pt<=b;Pt++,Tt+=3){const Rt=et+Pt/b*tt;_t.x=o*Math.cos(Rt),_t.y=o*Math.sin(Rt),lt.push(_t.x,_t.y,_t.z),ht.push(0,0,1),Mt.x=(lt[Tt]/o+1)/2,Mt.y=(lt[Tt+1]/o+1)/2,vt.push(Mt.x,Mt.y)}for(let Pt=1;Pt<=b;Pt++)ot.push(Pt,Pt+1,0);this.setIndex(ot),this.setAttribute("position",new ft(lt,3)),this.setAttribute("normal",new ft(ht,3)),this.setAttribute("uv",new ft(vt,2))}static fromJSON(o){return new Sm(o.radius,o.segments,o.thetaStart,o.thetaLength)}}class Fu extends ms{constructor(o=1,b=1,et=1,tt=8,ot=1,lt=!1,ht=0,vt=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:o,radiusBottom:b,height:et,radialSegments:tt,heightSegments:ot,openEnded:lt,thetaStart:ht,thetaLength:vt};const _t=this;tt=Math.floor(tt),ot=Math.floor(ot);const Mt=[],Pt=[],Tt=[],Rt=[];let Nt=0;const kt=[],Kt=et/2;let $t=0;function en(ln){const gn=Nt,_n=new Lr,An=new xn;let Ln=0;const Nn=ln===!0?o:b,Jn=ln===!0?1:-1;for(let jn=1;jn<=tt;jn++)Pt.push(0,Kt*Jn,0),Tt.push(0,Jn,0),Rt.push(.5,.5),Nt++;const tr=Nt;for(let jn=0;jn<=tt;jn++){const Cr=jn/tt*vt+ht,Ur=Math.cos(Cr),Er=Math.sin(Cr);An.x=Nn*Er,An.y=Kt*Jn,An.z=Nn*Ur,Pt.push(An.x,An.y,An.z),Tt.push(0,Jn,0),_n.x=.5*Ur+.5,_n.y=.5*Er*Jn+.5,Rt.push(_n.x,_n.y),Nt++}for(let jn=0;jn<tt;jn++){const Cr=gn+jn,Ur=tr+jn;ln===!0?Mt.push(Ur,Ur+1,Cr):Mt.push(Ur+1,Ur,Cr),Ln+=3}_t.addGroup($t,Ln,ln===!0?1:2),$t+=Ln}(function(){const ln=new xn,gn=new xn;let _n=0;const An=(b-o)/et;for(let Ln=0;Ln<=ot;Ln++){const Nn=[],Jn=Ln/ot,tr=Jn*(b-o)+o;for(let jn=0;jn<=tt;jn++){const Cr=jn/tt,Ur=Cr*vt+ht,Er=Math.sin(Ur),qr=Math.cos(Ur);gn.x=tr*Er,gn.y=-Jn*et+Kt,gn.z=tr*qr,Pt.push(gn.x,gn.y,gn.z),ln.set(Er,An,qr).normalize(),Tt.push(ln.x,ln.y,ln.z),Rt.push(Cr,1-Jn),Nn.push(Nt++)}kt.push(Nn)}for(let Ln=0;Ln<tt;Ln++)for(let Nn=0;Nn<ot;Nn++){const Jn=kt[Nn][Ln],tr=kt[Nn+1][Ln],jn=kt[Nn+1][Ln+1],Cr=kt[Nn][Ln+1];Mt.push(Jn,tr,Cr),Mt.push(tr,jn,Cr),_n+=6}_t.addGroup($t,_n,0),$t+=_n})(),lt===!1&&(o>0&&en(!0),b>0&&en(!1)),this.setIndex(Mt),this.setAttribute("position",new ft(Pt,3)),this.setAttribute("normal",new ft(Tt,3)),this.setAttribute("uv",new ft(Rt,2))}static fromJSON(o){return new Fu(o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Ol extends Fu{constructor(o=1,b=1,et=8,tt=1,ot=!1,lt=0,ht=2*Math.PI){super(0,o,b,et,tt,ot,lt,ht),this.type="ConeGeometry",this.parameters={radius:o,height:b,radialSegments:et,heightSegments:tt,openEnded:ot,thetaStart:lt,thetaLength:ht}}static fromJSON(o){return new Ol(o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class $_ extends ms{constructor(o=[],b=[],et=1,tt=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:o,indices:b,radius:et,detail:tt};const ot=[],lt=[];function ht(Tt,Rt,Nt,kt){const Kt=kt+1,$t=[];for(let en=0;en<=Kt;en++){$t[en]=[];const ln=Tt.clone().lerp(Nt,en/Kt),gn=Rt.clone().lerp(Nt,en/Kt),_n=Kt-en;for(let An=0;An<=_n;An++)$t[en][An]=An===0&&en===Kt?ln:ln.clone().lerp(gn,An/_n)}for(let en=0;en<Kt;en++)for(let ln=0;ln<2*(Kt-en)-1;ln++){const gn=Math.floor(ln/2);ln%2==0?(vt($t[en][gn+1]),vt($t[en+1][gn]),vt($t[en][gn])):(vt($t[en][gn+1]),vt($t[en+1][gn+1]),vt($t[en+1][gn]))}}function vt(Tt){ot.push(Tt.x,Tt.y,Tt.z)}function _t(Tt,Rt){const Nt=3*Tt;Rt.x=o[Nt+0],Rt.y=o[Nt+1],Rt.z=o[Nt+2]}function Mt(Tt,Rt,Nt,kt){kt<0&&Tt.x===1&&(lt[Rt]=Tt.x-1),Nt.x===0&&Nt.z===0&&(lt[Rt]=kt/2/Math.PI+.5)}function Pt(Tt){return Math.atan2(Tt.z,-Tt.x)}(function(Tt){const Rt=new xn,Nt=new xn,kt=new xn;for(let Kt=0;Kt<b.length;Kt+=3)_t(b[Kt+0],Rt),_t(b[Kt+1],Nt),_t(b[Kt+2],kt),ht(Rt,Nt,kt,Tt)})(tt),function(Tt){const Rt=new xn;for(let Nt=0;Nt<ot.length;Nt+=3)Rt.x=ot[Nt+0],Rt.y=ot[Nt+1],Rt.z=ot[Nt+2],Rt.normalize().multiplyScalar(Tt),ot[Nt+0]=Rt.x,ot[Nt+1]=Rt.y,ot[Nt+2]=Rt.z}(et),function(){const Tt=new xn;for(let Nt=0;Nt<ot.length;Nt+=3){Tt.x=ot[Nt+0],Tt.y=ot[Nt+1],Tt.z=ot[Nt+2];const kt=Pt(Tt)/2/Math.PI+.5,Kt=(Rt=Tt,Math.atan2(-Rt.y,Math.sqrt(Rt.x*Rt.x+Rt.z*Rt.z))/Math.PI+.5);lt.push(kt,1-Kt)}var Rt;(function(){const Nt=new xn,kt=new xn,Kt=new xn,$t=new xn,en=new Lr,ln=new Lr,gn=new Lr;for(let _n=0,An=0;_n<ot.length;_n+=9,An+=6){Nt.set(ot[_n+0],ot[_n+1],ot[_n+2]),kt.set(ot[_n+3],ot[_n+4],ot[_n+5]),Kt.set(ot[_n+6],ot[_n+7],ot[_n+8]),en.set(lt[An+0],lt[An+1]),ln.set(lt[An+2],lt[An+3]),gn.set(lt[An+4],lt[An+5]),$t.copy(Nt).add(kt).add(Kt).divideScalar(3);const Ln=Pt($t);Mt(en,An+0,Nt,Ln),Mt(ln,An+2,kt,Ln),Mt(gn,An+4,Kt,Ln)}})(),function(){for(let Nt=0;Nt<lt.length;Nt+=6){const kt=lt[Nt+0],Kt=lt[Nt+2],$t=lt[Nt+4],en=Math.max(kt,Kt,$t),ln=Math.min(kt,Kt,$t);en>.9&&ln<.1&&(kt<.2&&(lt[Nt+0]+=1),Kt<.2&&(lt[Nt+2]+=1),$t<.2&&(lt[Nt+4]+=1))}}()}(),this.setAttribute("position",new ft(ot,3)),this.setAttribute("normal",new ft(ot.slice(),3)),this.setAttribute("uv",new ft(lt,2)),tt===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(o){return new $_(o.vertices,o.indices,o.radius,o.details)}}class dx extends $_{constructor(o=1,b=0){const et=(1+Math.sqrt(5))/2,tt=1/et;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-tt,-et,0,-tt,et,0,tt,-et,0,tt,et,-tt,-et,0,-tt,et,0,tt,-et,0,tt,et,0,-et,0,-tt,et,0,-tt,-et,0,tt,et,0,tt],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,b),this.type="DodecahedronGeometry",this.parameters={radius:o,detail:b}}static fromJSON(o){return new dx(o.radius,o.detail)}}const Mv=new xn,ZA=new xn,px=new xn,ew=new Ou;class pE extends ms{constructor(o=null,b=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:o,thresholdAngle:b},o!==null){const tt=Math.pow(10,4),ot=Math.cos(R_*b),lt=o.getIndex(),ht=o.getAttribute("position"),vt=lt?lt.count:ht.count,_t=[0,0,0],Mt=["a","b","c"],Pt=new Array(3),Tt={},Rt=[];for(let Nt=0;Nt<vt;Nt+=3){lt?(_t[0]=lt.getX(Nt),_t[1]=lt.getX(Nt+1),_t[2]=lt.getX(Nt+2)):(_t[0]=Nt,_t[1]=Nt+1,_t[2]=Nt+2);const{a:kt,b:Kt,c:$t}=ew;if(kt.fromBufferAttribute(ht,_t[0]),Kt.fromBufferAttribute(ht,_t[1]),$t.fromBufferAttribute(ht,_t[2]),ew.getNormal(px),Pt[0]=`${Math.round(kt.x*tt)},${Math.round(kt.y*tt)},${Math.round(kt.z*tt)}`,Pt[1]=`${Math.round(Kt.x*tt)},${Math.round(Kt.y*tt)},${Math.round(Kt.z*tt)}`,Pt[2]=`${Math.round($t.x*tt)},${Math.round($t.y*tt)},${Math.round($t.z*tt)}`,Pt[0]!==Pt[1]&&Pt[1]!==Pt[2]&&Pt[2]!==Pt[0])for(let en=0;en<3;en++){const ln=(en+1)%3,gn=Pt[en],_n=Pt[ln],An=ew[Mt[en]],Ln=ew[Mt[ln]],Nn=`${gn}_${_n}`,Jn=`${_n}_${gn}`;Jn in Tt&&Tt[Jn]?(px.dot(Tt[Jn].normal)<=ot&&(Rt.push(An.x,An.y,An.z),Rt.push(Ln.x,Ln.y,Ln.z)),Tt[Jn]=null):Nn in Tt||(Tt[Nn]={index0:_t[en],index1:_t[ln],normal:px.clone()})}}for(const Nt in Tt)if(Tt[Nt]){const{index0:kt,index1:Kt}=Tt[Nt];Mv.fromBufferAttribute(ht,kt),ZA.fromBufferAttribute(ht,Kt),Rt.push(Mv.x,Mv.y,Mv.z),Rt.push(ZA.x,ZA.y,ZA.z)}this.setAttribute("position",new ft(Rt,3))}}}class Wy extends JA{constructor(o){super(o),this.uuid=Xu(),this.type="Shape",this.holes=[]}getPointsHoles(o){const b=[];for(let et=0,tt=this.holes.length;et<tt;et++)b[et]=this.holes[et].getPoints(o);return b}extractPoints(o){return{shape:this.getPoints(o),holes:this.getPointsHoles(o)}}copy(o){super.copy(o),this.holes=[];for(let b=0,et=o.holes.length;b<et;b++){const tt=o.holes[b];this.holes.push(tt.clone())}return this}toJSON(){const o=super.toJSON();o.uuid=this.uuid,o.holes=[];for(let b=0,et=this.holes.length;b<et;b++){const tt=this.holes[b];o.holes.push(tt.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.uuid=o.uuid,this.holes=[];for(let b=0,et=o.holes.length;b<et;b++){const tt=o.holes[b];this.holes.push(new JA().fromJSON(tt))}return this}}function kT(dt,o,b,et,tt){let ot,lt;if(tt===function(ht,vt,_t,Mt){let Pt=0;for(let Tt=vt,Rt=_t-Mt;Tt<_t;Tt+=Mt)Pt+=(ht[Rt]-ht[Tt])*(ht[Tt+1]+ht[Rt+1]),Rt=Tt;return Pt}(dt,o,b,et)>0)for(ot=o;ot<b;ot+=et)lt=dm(ot,dt[ot],dt[ot+1],lt);else for(ot=b-et;ot>=o;ot-=et)lt=dm(ot,dt[ot],dt[ot+1],lt);return lt&&um(lt,lt.next)&&(vx(lt),lt=lt.next),lt}function Y0(dt,o){if(!dt)return dt;o||(o=dt);let b,et=dt;do if(b=!1,et.steiner||!um(et,et.next)&&Ql(et.prev,et,et.next)!==0)et=et.next;else{if(vx(et),et=o=et.prev,et===et.next)break;b=!0}while(b||et!==o);return o}function fx(dt,o,b,et,tt,ot,lt){if(!dt)return;!lt&&ot&&function(Mt,Pt,Tt,Rt){let Nt=Mt;do Nt.z===null&&(Nt.z=fE(Nt.x,Nt.y,Pt,Tt,Rt)),Nt.prevZ=Nt.prev,Nt.nextZ=Nt.next,Nt=Nt.next;while(Nt!==Mt);Nt.prevZ.nextZ=null,Nt.prevZ=null,function(kt){let Kt,$t,en,ln,gn,_n,An,Ln,Nn=1;do{for($t=kt,kt=null,gn=null,_n=0;$t;){for(_n++,en=$t,An=0,Kt=0;Kt<Nn&&(An++,en=en.nextZ,en);Kt++);for(Ln=Nn;An>0||Ln>0&&en;)An!==0&&(Ln===0||!en||$t.z<=en.z)?(ln=$t,$t=$t.nextZ,An--):(ln=en,en=en.nextZ,Ln--),gn?gn.nextZ=ln:kt=ln,ln.prevZ=gn,gn=ln;$t=en}gn.nextZ=null,Nn*=2}while(_n>1)}(Nt)}(dt,et,tt,ot);let ht,vt,_t=dt;for(;dt.prev!==dt.next;)if(ht=dt.prev,vt=dt.next,ot?mx(dt,et,tt,ot):BT(dt))o.push(ht.i/b),o.push(dt.i/b),o.push(vt.i/b),vx(dt),dt=vt.next,_t=vt.next;else if((dt=vt)===_t){lt?lt===1?fx(dt=OT(Y0(dt),o,b),o,b,et,tt,ot,2):lt===2&&AC(dt,o,b,et,tt,ot):fx(Y0(dt),o,b,et,tt,ot,1);break}}function BT(dt){const o=dt.prev,b=dt,et=dt.next;if(Ql(o,b,et)>=0)return!1;let tt=dt.next.next;for(;tt!==dt.prev;){if(qm(o.x,o.y,b.x,b.y,et.x,et.y,tt.x,tt.y)&&Ql(tt.prev,tt,tt.next)>=0)return!1;tt=tt.next}return!0}function mx(dt,o,b,et){const tt=dt.prev,ot=dt,lt=dt.next;if(Ql(tt,ot,lt)>=0)return!1;const ht=tt.x<ot.x?tt.x<lt.x?tt.x:lt.x:ot.x<lt.x?ot.x:lt.x,vt=tt.y<ot.y?tt.y<lt.y?tt.y:lt.y:ot.y<lt.y?ot.y:lt.y,_t=tt.x>ot.x?tt.x>lt.x?tt.x:lt.x:ot.x>lt.x?ot.x:lt.x,Mt=tt.y>ot.y?tt.y>lt.y?tt.y:lt.y:ot.y>lt.y?ot.y:lt.y,Pt=fE(ht,vt,o,b,et),Tt=fE(_t,Mt,o,b,et);let Rt=dt.prevZ,Nt=dt.nextZ;for(;Rt&&Rt.z>=Pt&&Nt&&Nt.z<=Tt;){if(Rt!==dt.prev&&Rt!==dt.next&&qm(tt.x,tt.y,ot.x,ot.y,lt.x,lt.y,Rt.x,Rt.y)&&Ql(Rt.prev,Rt,Rt.next)>=0||(Rt=Rt.prevZ,Nt!==dt.prev&&Nt!==dt.next&&qm(tt.x,tt.y,ot.x,ot.y,lt.x,lt.y,Nt.x,Nt.y)&&Ql(Nt.prev,Nt,Nt.next)>=0))return!1;Nt=Nt.nextZ}for(;Rt&&Rt.z>=Pt;){if(Rt!==dt.prev&&Rt!==dt.next&&qm(tt.x,tt.y,ot.x,ot.y,lt.x,lt.y,Rt.x,Rt.y)&&Ql(Rt.prev,Rt,Rt.next)>=0)return!1;Rt=Rt.prevZ}for(;Nt&&Nt.z<=Tt;){if(Nt!==dt.prev&&Nt!==dt.next&&qm(tt.x,tt.y,ot.x,ot.y,lt.x,lt.y,Nt.x,Nt.y)&&Ql(Nt.prev,Nt,Nt.next)>=0)return!1;Nt=Nt.nextZ}return!0}function OT(dt,o,b){let et=dt;do{const tt=et.prev,ot=et.next.next;!um(tt,ot)&&X0(tt,et,et.next,ot)&&K0(tt,ot)&&K0(ot,tt)&&(o.push(tt.i/b),o.push(et.i/b),o.push(ot.i/b),vx(et),vx(et.next),et=dt=ot),et=et.next}while(et!==dt);return Y0(et)}function AC(dt,o,b,et,tt,ot){let lt=dt;do{let ht=lt.next.next;for(;ht!==lt.prev;){if(lt.i!==ht.i&&Cp(lt,ht)){let vt=mE(lt,ht);return lt=Y0(lt,lt.next),vt=Y0(vt,vt.next),fx(lt,o,b,et,tt,ot),void fx(vt,o,b,et,tt,ot)}ht=ht.next}lt=lt.next}while(lt!==dt)}function gx(dt,o){return dt.x-o.x}function Tv(dt,o){if(o=function(b,et){let tt=et;const ot=b.x,lt=b.y;let ht,vt=-1/0;do{if(lt<=tt.y&&lt>=tt.next.y&&tt.next.y!==tt.y){const Nt=tt.x+(lt-tt.y)*(tt.next.x-tt.x)/(tt.next.y-tt.y);if(Nt<=ot&&Nt>vt){if(vt=Nt,Nt===ot){if(lt===tt.y)return tt;if(lt===tt.next.y)return tt.next}ht=tt.x<tt.next.x?tt:tt.next}}tt=tt.next}while(tt!==et);if(!ht)return null;if(ot===vt)return ht;const _t=ht,Mt=ht.x,Pt=ht.y;let Tt,Rt=1/0;tt=ht;do ot>=tt.x&&tt.x>=Mt&&ot!==tt.x&&qm(lt<Pt?ot:vt,lt,Mt,Pt,lt<Pt?vt:ot,lt,tt.x,tt.y)&&(Tt=Math.abs(lt-tt.y)/(ot-tt.x),K0(tt,b)&&(Tt<Rt||Tt===Rt&&(tt.x>ht.x||tt.x===ht.x&&LT(ht,tt)))&&(ht=tt,Rt=Tt)),tt=tt.next;while(tt!==_t);return ht}(dt,o),o){const b=mE(o,dt);Y0(o,o.next),Y0(b,b.next)}}function LT(dt,o){return Ql(dt.prev,dt,o.prev)<0&&Ql(o.next,dt,dt.next)<0}function fE(dt,o,b,et,tt){return(dt=1431655765&((dt=858993459&((dt=252645135&((dt=16711935&((dt=32767*(dt-b)*tt)|dt<<8))|dt<<4))|dt<<2))|dt<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-et)*tt)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function qy(dt){let o=dt,b=dt;do(o.x<b.x||o.x===b.x&&o.y<b.y)&&(b=o),o=o.next;while(o!==dt);return b}function qm(dt,o,b,et,tt,ot,lt,ht){return(tt-lt)*(o-ht)-(dt-lt)*(ot-ht)>=0&&(dt-lt)*(et-ht)-(b-lt)*(o-ht)>=0&&(b-lt)*(ot-ht)-(tt-lt)*(et-ht)>=0}function Cp(dt,o){return dt.next.i!==o.i&&dt.prev.i!==o.i&&!function(b,et){let tt=b;do{if(tt.i!==b.i&&tt.next.i!==b.i&&tt.i!==et.i&&tt.next.i!==et.i&&X0(tt,tt.next,b,et))return!0;tt=tt.next}while(tt!==b);return!1}(dt,o)&&(K0(dt,o)&&K0(o,dt)&&function(b,et){let tt=b,ot=!1;const lt=(b.x+et.x)/2,ht=(b.y+et.y)/2;do tt.y>ht!=tt.next.y>ht&&tt.next.y!==tt.y&&lt<(tt.next.x-tt.x)*(ht-tt.y)/(tt.next.y-tt.y)+tt.x&&(ot=!ot),tt=tt.next;while(tt!==b);return ot}(dt,o)&&(Ql(dt.prev,dt,o.prev)||Ql(dt,o.prev,o))||um(dt,o)&&Ql(dt.prev,dt,dt.next)>0&&Ql(o.prev,o,o.next)>0)}function Ql(dt,o,b){return(o.y-dt.y)*(b.x-o.x)-(o.x-dt.x)*(b.y-o.y)}function um(dt,o){return dt.x===o.x&&dt.y===o.y}function X0(dt,o,b,et){const tt=hm(Ql(dt,o,b)),ot=hm(Ql(dt,o,et)),lt=hm(Ql(b,et,dt)),ht=hm(Ql(b,et,o));return tt!==ot&&lt!==ht||!(tt!==0||!Ym(dt,b,o))||!(ot!==0||!Ym(dt,et,o))||!(lt!==0||!Ym(b,dt,et))||!(ht!==0||!Ym(b,o,et))}function Ym(dt,o,b){return o.x<=Math.max(dt.x,b.x)&&o.x>=Math.min(dt.x,b.x)&&o.y<=Math.max(dt.y,b.y)&&o.y>=Math.min(dt.y,b.y)}function hm(dt){return dt>0?1:dt<0?-1:0}function K0(dt,o){return Ql(dt.prev,dt,dt.next)<0?Ql(dt,o,dt.next)>=0&&Ql(dt,dt.prev,o)>=0:Ql(dt,o,dt.prev)<0||Ql(dt,dt.next,o)<0}function mE(dt,o){const b=new wC(dt.i,dt.x,dt.y),et=new wC(o.i,o.x,o.y),tt=dt.next,ot=o.prev;return dt.next=o,o.prev=dt,b.next=tt,tt.prev=b,et.next=b,b.prev=et,ot.next=et,et.prev=ot,et}function dm(dt,o,b,et){const tt=new wC(dt,o,b);return et?(tt.next=et.next,tt.prev=et,et.next.prev=tt,et.next=tt):(tt.prev=tt,tt.next=tt),tt}function vx(dt){dt.next.prev=dt.prev,dt.prev.next=dt.next,dt.prevZ&&(dt.prevZ.nextZ=dt.nextZ),dt.nextZ&&(dt.nextZ.prevZ=dt.prevZ)}function wC(dt,o,b){this.i=dt,this.x=o,this.y=b,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Iv{static area(o){const b=o.length;let et=0;for(let tt=b-1,ot=0;ot<b;tt=ot++)et+=o[tt].x*o[ot].y-o[ot].x*o[tt].y;return .5*et}static isClockWise(o){return Iv.area(o)<0}static triangulateShape(o,b){const et=[],tt=[],ot=[];Cm(o),gE(et,o);let lt=o.length;b.forEach(Cm);for(let vt=0;vt<b.length;vt++)tt.push(lt),lt+=b[vt].length,gE(et,b[vt]);const ht=function(vt,_t,Mt=2){const Pt=_t&&_t.length,Tt=Pt?_t[0]*Mt:vt.length;let Rt=kT(vt,0,Tt,Mt,!0);const Nt=[];if(!Rt||Rt.next===Rt.prev)return Nt;let kt,Kt,$t,en,ln,gn,_n;if(Pt&&(Rt=function(An,Ln,Nn,Jn){const tr=[];let jn,Cr,Ur,Er,qr;for(jn=0,Cr=Ln.length;jn<Cr;jn++)Ur=Ln[jn]*Jn,Er=jn<Cr-1?Ln[jn+1]*Jn:An.length,qr=kT(An,Ur,Er,Jn,!1),qr===qr.next&&(qr.steiner=!0),tr.push(qy(qr));for(tr.sort(gx),jn=0;jn<tr.length;jn++)Tv(tr[jn],Nn),Nn=Y0(Nn,Nn.next);return Nn}(vt,_t,Rt,Mt)),vt.length>80*Mt){kt=$t=vt[0],Kt=en=vt[1];for(let An=Mt;An<Tt;An+=Mt)ln=vt[An],gn=vt[An+1],ln<kt&&(kt=ln),gn<Kt&&(Kt=gn),ln>$t&&($t=ln),gn>en&&(en=gn);_n=Math.max($t-kt,en-Kt),_n=_n!==0?1/_n:0}return fx(Rt,Nt,Mt,kt,Kt,_n),Nt}(et,tt);for(let vt=0;vt<ht.length;vt+=3)ot.push(ht.slice(vt,vt+3));return ot}}function Cm(dt){const o=dt.length;o>2&&dt[o-1].equals(dt[0])&&dt.pop()}function gE(dt,o){for(let b=0;b<o.length;b++)dt.push(o[b].x),dt.push(o[b].y)}class _x extends ms{constructor(o=new Wy([new Lr(.5,.5),new Lr(-.5,.5),new Lr(-.5,-.5),new Lr(.5,-.5)]),b={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:o,options:b},o=Array.isArray(o)?o:[o];const et=this,tt=[],ot=[];for(let ht=0,vt=o.length;ht<vt;ht++)lt(o[ht]);function lt(ht){const vt=[],_t=b.curveSegments!==void 0?b.curveSegments:12,Mt=b.steps!==void 0?b.steps:1,Pt=b.depth!==void 0?b.depth:1;let Tt=b.bevelEnabled===void 0||b.bevelEnabled,Rt=b.bevelThickness!==void 0?b.bevelThickness:.2,Nt=b.bevelSize!==void 0?b.bevelSize:Rt-.1,kt=b.bevelOffset!==void 0?b.bevelOffset:0,Kt=b.bevelSegments!==void 0?b.bevelSegments:3;const $t=b.extrudePath,en=b.UVGenerator!==void 0?b.UVGenerator:gP;let ln,gn,_n,An,Ln,Nn=!1;$t&&(ln=$t.getSpacedPoints(Mt),Nn=!0,Tt=!1,gn=$t.computeFrenetFrames(Mt,!1),_n=new xn,An=new xn,Ln=new xn),Tt||(Kt=0,Rt=0,Nt=0,kt=0);const Jn=ht.extractPoints(_t);let tr=Jn.shape;const jn=Jn.holes;if(!Iv.isClockWise(tr)){tr=tr.reverse();for(let Xn=0,kn=jn.length;Xn<kn;Xn++){const qn=jn[Xn];Iv.isClockWise(qn)&&(jn[Xn]=qn.reverse())}}const Cr=Iv.triangulateShape(tr,jn),Ur=tr;for(let Xn=0,kn=jn.length;Xn<kn;Xn++){const qn=jn[Xn];tr=tr.concat(qn)}function Er(Xn,kn,qn){return kn||console.error("THREE.ExtrudeGeometry: vec does not exist"),kn.clone().multiplyScalar(qn).add(Xn)}const qr=tr.length,Yr=Cr.length;function fr(Xn,kn,qn){let gr,cn,vr;const rr=Xn.x-kn.x,Sr=Xn.y-kn.y,Pr=qn.x-Xn.x,Zr=qn.y-Xn.y,Ss=rr*rr+Sr*Sr,Ns=rr*Zr-Sr*Pr;if(Math.abs(Ns)>Number.EPSILON){const eo=Math.sqrt(Ss),Bs=Math.sqrt(Pr*Pr+Zr*Zr),Fs=kn.x-Sr/eo,$o=kn.y+rr/eo,Im=((qn.x-Zr/Bs-Fs)*Zr-(qn.y+Pr/Bs-$o)*Pr)/(rr*Zr-Sr*Pr);gr=Fs+rr*Im-Xn.x,cn=$o+Sr*Im-Xn.y;const $s=gr*gr+cn*cn;if($s<=2)return new Lr(gr,cn);vr=Math.sqrt($s/2)}else{let eo=!1;rr>Number.EPSILON?Pr>Number.EPSILON&&(eo=!0):rr<-Number.EPSILON?Pr<-Number.EPSILON&&(eo=!0):Math.sign(Sr)===Math.sign(Zr)&&(eo=!0),eo?(gr=-Sr,cn=rr,vr=Math.sqrt(Ss)):(gr=rr,cn=Sr,vr=Math.sqrt(Ss/2))}return new Lr(gr/vr,cn/vr)}const _r=[];for(let Xn=0,kn=Ur.length,qn=kn-1,gr=Xn+1;Xn<kn;Xn++,qn++,gr++)qn===kn&&(qn=0),gr===kn&&(gr=0),_r[Xn]=fr(Ur[Xn],Ur[qn],Ur[gr]);const Qr=[];let Mr,Wr=_r.concat();for(let Xn=0,kn=jn.length;Xn<kn;Xn++){const qn=jn[Xn];Mr=[];for(let gr=0,cn=qn.length,vr=cn-1,rr=gr+1;gr<cn;gr++,vr++,rr++)vr===cn&&(vr=0),rr===cn&&(rr=0),Mr[gr]=fr(qn[gr],qn[vr],qn[rr]);Qr.push(Mr),Wr=Wr.concat(Mr)}for(let Xn=0;Xn<Kt;Xn++){const kn=Xn/Kt,qn=Rt*Math.cos(kn*Math.PI/2),gr=Nt*Math.sin(kn*Math.PI/2)+kt;for(let cn=0,vr=Ur.length;cn<vr;cn++){const rr=Er(Ur[cn],_r[cn],gr);Es(rr.x,rr.y,-qn)}for(let cn=0,vr=jn.length;cn<vr;cn++){const rr=jn[cn];Mr=Qr[cn];for(let Sr=0,Pr=rr.length;Sr<Pr;Sr++){const Zr=Er(rr[Sr],Mr[Sr],gr);Es(Zr.x,Zr.y,-qn)}}}const ws=Nt+kt;for(let Xn=0;Xn<qr;Xn++){const kn=Tt?Er(tr[Xn],Wr[Xn],ws):tr[Xn];Nn?(An.copy(gn.normals[0]).multiplyScalar(kn.x),_n.copy(gn.binormals[0]).multiplyScalar(kn.y),Ln.copy(ln[0]).add(An).add(_n),Es(Ln.x,Ln.y,Ln.z)):Es(kn.x,kn.y,0)}for(let Xn=1;Xn<=Mt;Xn++)for(let kn=0;kn<qr;kn++){const qn=Tt?Er(tr[kn],Wr[kn],ws):tr[kn];Nn?(An.copy(gn.normals[Xn]).multiplyScalar(qn.x),_n.copy(gn.binormals[Xn]).multiplyScalar(qn.y),Ln.copy(ln[Xn]).add(An).add(_n),Es(Ln.x,Ln.y,Ln.z)):Es(qn.x,qn.y,Pt/Mt*Xn)}for(let Xn=Kt-1;Xn>=0;Xn--){const kn=Xn/Kt,qn=Rt*Math.cos(kn*Math.PI/2),gr=Nt*Math.sin(kn*Math.PI/2)+kt;for(let cn=0,vr=Ur.length;cn<vr;cn++){const rr=Er(Ur[cn],_r[cn],gr);Es(rr.x,rr.y,Pt+qn)}for(let cn=0,vr=jn.length;cn<vr;cn++){const rr=jn[cn];Mr=Qr[cn];for(let Sr=0,Pr=rr.length;Sr<Pr;Sr++){const Zr=Er(rr[Sr],Mr[Sr],gr);Nn?Es(Zr.x,Zr.y+ln[Mt-1].y,ln[Mt-1].x+qn):Es(Zr.x,Zr.y,Pt+qn)}}}function fo(Xn,kn){let qn=Xn.length;for(;--qn>=0;){const gr=qn;let cn=qn-1;cn<0&&(cn=Xn.length-1);for(let vr=0,rr=Mt+2*Kt;vr<rr;vr++){const Sr=qr*vr,Pr=qr*(vr+1);Rn(kn+gr+Sr,kn+cn+Sr,kn+cn+Pr,kn+gr+Pr)}}}function Es(Xn,kn,qn){vt.push(Xn),vt.push(kn),vt.push(qn)}function so(Xn,kn,qn){Mn(Xn),Mn(kn),Mn(qn);const gr=tt.length/3,cn=en.generateTopUV(et,tt,gr-3,gr-2,gr-1);sr(cn[0]),sr(cn[1]),sr(cn[2])}function Rn(Xn,kn,qn,gr){Mn(Xn),Mn(kn),Mn(gr),Mn(kn),Mn(qn),Mn(gr);const cn=tt.length/3,vr=en.generateSideWallUV(et,tt,cn-6,cn-3,cn-2,cn-1);sr(vr[0]),sr(vr[1]),sr(vr[3]),sr(vr[1]),sr(vr[2]),sr(vr[3])}function Mn(Xn){tt.push(vt[3*Xn+0]),tt.push(vt[3*Xn+1]),tt.push(vt[3*Xn+2])}function sr(Xn){ot.push(Xn.x),ot.push(Xn.y)}(function(){const Xn=tt.length/3;if(Tt){let kn=0,qn=qr*kn;for(let gr=0;gr<Yr;gr++){const cn=Cr[gr];so(cn[2]+qn,cn[1]+qn,cn[0]+qn)}kn=Mt+2*Kt,qn=qr*kn;for(let gr=0;gr<Yr;gr++){const cn=Cr[gr];so(cn[0]+qn,cn[1]+qn,cn[2]+qn)}}else{for(let kn=0;kn<Yr;kn++){const qn=Cr[kn];so(qn[2],qn[1],qn[0])}for(let kn=0;kn<Yr;kn++){const qn=Cr[kn];so(qn[0]+qr*Mt,qn[1]+qr*Mt,qn[2]+qr*Mt)}}et.addGroup(Xn,tt.length/3-Xn,0)})(),function(){const Xn=tt.length/3;let kn=0;fo(Ur,kn),kn+=Ur.length;for(let qn=0,gr=jn.length;qn<gr;qn++){const cn=jn[qn];fo(cn,kn),kn+=cn.length}et.addGroup(Xn,tt.length/3-Xn,1)}()}this.setAttribute("position",new ft(tt,3)),this.setAttribute("uv",new ft(ot,2)),this.computeVertexNormals()}toJSON(){const o=super.toJSON();return function(b,et,tt){if(tt.shapes=[],Array.isArray(b))for(let ot=0,lt=b.length;ot<lt;ot++){const ht=b[ot];tt.shapes.push(ht.uuid)}else tt.shapes.push(b.uuid);return tt.options=Object.assign({},et),et.extrudePath!==void 0&&(tt.options.extrudePath=et.extrudePath.toJSON()),tt}(this.parameters.shapes,this.parameters.options,o)}static fromJSON(o,b){const et=[];for(let ot=0,lt=o.shapes.length;ot<lt;ot++){const ht=b[o.shapes[ot]];et.push(ht)}const tt=o.options.extrudePath;return tt!==void 0&&(o.options.extrudePath=new jo[tt.type]().fromJSON(tt)),new _x(et,o.options)}}const gP={generateTopUV:function(dt,o,b,et,tt){const ot=o[3*b],lt=o[3*b+1],ht=o[3*et],vt=o[3*et+1],_t=o[3*tt],Mt=o[3*tt+1];return[new Lr(ot,lt),new Lr(ht,vt),new Lr(_t,Mt)]},generateSideWallUV:function(dt,o,b,et,tt,ot){const lt=o[3*b],ht=o[3*b+1],vt=o[3*b+2],_t=o[3*et],Mt=o[3*et+1],Pt=o[3*et+2],Tt=o[3*tt],Rt=o[3*tt+1],Nt=o[3*tt+2],kt=o[3*ot],Kt=o[3*ot+1],$t=o[3*ot+2];return Math.abs(ht-Mt)<Math.abs(lt-_t)?[new Lr(lt,1-vt),new Lr(_t,1-Pt),new Lr(Tt,1-Nt),new Lr(kt,1-$t)]:[new Lr(ht,1-vt),new Lr(Mt,1-Pt),new Lr(Rt,1-Nt),new Lr(Kt,1-$t)]}};class tw extends $_{constructor(o=1,b=0){const et=(1+Math.sqrt(5))/2;super([-1,et,0,1,et,0,-1,-et,0,1,-et,0,0,-1,et,0,1,et,0,-1,-et,0,1,-et,et,0,-1,et,0,1,-et,0,-1,-et,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,b),this.type="IcosahedronGeometry",this.parameters={radius:o,detail:b}}static fromJSON(o){return new tw(o.radius,o.detail)}}class up extends $_{constructor(o=1,b=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],o,b),this.type="OctahedronGeometry",this.parameters={radius:o,detail:b}}static fromJSON(o){return new up(o.radius,o.detail)}}class Yy extends ms{constructor(o=.5,b=1,et=8,tt=1,ot=0,lt=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:o,outerRadius:b,thetaSegments:et,phiSegments:tt,thetaStart:ot,thetaLength:lt},et=Math.max(3,et);const ht=[],vt=[],_t=[],Mt=[];let Pt=o;const Tt=(b-o)/(tt=Math.max(1,tt)),Rt=new xn,Nt=new Lr;for(let kt=0;kt<=tt;kt++){for(let Kt=0;Kt<=et;Kt++){const $t=ot+Kt/et*lt;Rt.x=Pt*Math.cos($t),Rt.y=Pt*Math.sin($t),vt.push(Rt.x,Rt.y,Rt.z),_t.push(0,0,1),Nt.x=(Rt.x/b+1)/2,Nt.y=(Rt.y/b+1)/2,Mt.push(Nt.x,Nt.y)}Pt+=Tt}for(let kt=0;kt<tt;kt++){const Kt=kt*(et+1);for(let $t=0;$t<et;$t++){const en=$t+Kt,ln=en,gn=en+et+1,_n=en+et+2,An=en+1;ht.push(ln,gn,An),ht.push(gn,_n,An)}}this.setIndex(ht),this.setAttribute("position",new ft(vt,3)),this.setAttribute("normal",new ft(_t,3)),this.setAttribute("uv",new ft(Mt,2))}static fromJSON(o){return new Yy(o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength)}}class yx extends ms{constructor(o=new Wy([new Lr(0,.5),new Lr(-.5,-.5),new Lr(.5,-.5)]),b=12){super(),this.type="ShapeGeometry",this.parameters={shapes:o,curveSegments:b};const et=[],tt=[],ot=[],lt=[];let ht=0,vt=0;if(Array.isArray(o)===!1)_t(o);else for(let Mt=0;Mt<o.length;Mt++)_t(o[Mt]),this.addGroup(ht,vt,Mt),ht+=vt,vt=0;function _t(Mt){const Pt=tt.length/3,Tt=Mt.extractPoints(b);let Rt=Tt.shape;const Nt=Tt.holes;Iv.isClockWise(Rt)===!1&&(Rt=Rt.reverse());for(let Kt=0,$t=Nt.length;Kt<$t;Kt++){const en=Nt[Kt];Iv.isClockWise(en)===!0&&(Nt[Kt]=en.reverse())}const kt=Iv.triangulateShape(Rt,Nt);for(let Kt=0,$t=Nt.length;Kt<$t;Kt++){const en=Nt[Kt];Rt=Rt.concat(en)}for(let Kt=0,$t=Rt.length;Kt<$t;Kt++){const en=Rt[Kt];tt.push(en.x,en.y,0),ot.push(0,0,1),lt.push(en.x,en.y)}for(let Kt=0,$t=kt.length;Kt<$t;Kt++){const en=kt[Kt],ln=en[0]+Pt,gn=en[1]+Pt,_n=en[2]+Pt;et.push(ln,gn,_n),vt+=3}}this.setIndex(et),this.setAttribute("position",new ft(tt,3)),this.setAttribute("normal",new ft(ot,3)),this.setAttribute("uv",new ft(lt,2))}toJSON(){const o=super.toJSON();return function(b,et){if(et.shapes=[],Array.isArray(b))for(let tt=0,ot=b.length;tt<ot;tt++){const lt=b[tt];et.shapes.push(lt.uuid)}else et.shapes.push(b.uuid);return et}(this.parameters.shapes,o)}static fromJSON(o,b){const et=[];for(let tt=0,ot=o.shapes.length;tt<ot;tt++){const lt=b[o.shapes[tt]];et.push(lt)}return new yx(et,o.curveSegments)}}class nw extends ms{constructor(o=1,b=32,et=16,tt=0,ot=2*Math.PI,lt=0,ht=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:b,heightSegments:et,phiStart:tt,phiLength:ot,thetaStart:lt,thetaLength:ht},b=Math.max(3,Math.floor(b)),et=Math.max(2,Math.floor(et));const vt=Math.min(lt+ht,Math.PI);let _t=0;const Mt=[],Pt=new xn,Tt=new xn,Rt=[],Nt=[],kt=[],Kt=[];for(let $t=0;$t<=et;$t++){const en=[],ln=$t/et;let gn=0;$t==0&&lt==0?gn=.5/b:$t==et&&vt==Math.PI&&(gn=-.5/b);for(let _n=0;_n<=b;_n++){const An=_n/b;Pt.x=-o*Math.cos(tt+An*ot)*Math.sin(lt+ln*ht),Pt.y=o*Math.cos(lt+ln*ht),Pt.z=o*Math.sin(tt+An*ot)*Math.sin(lt+ln*ht),Nt.push(Pt.x,Pt.y,Pt.z),Tt.copy(Pt).normalize(),kt.push(Tt.x,Tt.y,Tt.z),Kt.push(An+gn,1-ln),en.push(_t++)}Mt.push(en)}for(let $t=0;$t<et;$t++)for(let en=0;en<b;en++){const ln=Mt[$t][en+1],gn=Mt[$t][en],_n=Mt[$t+1][en],An=Mt[$t+1][en+1];($t!==0||lt>0)&&Rt.push(ln,gn,An),($t!==et-1||vt<Math.PI)&&Rt.push(gn,_n,An)}this.setIndex(Rt),this.setAttribute("position",new ft(Nt,3)),this.setAttribute("normal",new ft(kt,3)),this.setAttribute("uv",new ft(Kt,2))}static fromJSON(o){return new nw(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class Xy extends $_{constructor(o=1,b=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],o,b),this.type="TetrahedronGeometry",this.parameters={radius:o,detail:b}}static fromJSON(o){return new Xy(o.radius,o.detail)}}class $0 extends ms{constructor(o=1,b=.4,et=8,tt=6,ot=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:o,tube:b,radialSegments:et,tubularSegments:tt,arc:ot},et=Math.floor(et),tt=Math.floor(tt);const lt=[],ht=[],vt=[],_t=[],Mt=new xn,Pt=new xn,Tt=new xn;for(let Rt=0;Rt<=et;Rt++)for(let Nt=0;Nt<=tt;Nt++){const kt=Nt/tt*ot,Kt=Rt/et*Math.PI*2;Pt.x=(o+b*Math.cos(Kt))*Math.cos(kt),Pt.y=(o+b*Math.cos(Kt))*Math.sin(kt),Pt.z=b*Math.sin(Kt),ht.push(Pt.x,Pt.y,Pt.z),Mt.x=o*Math.cos(kt),Mt.y=o*Math.sin(kt),Tt.subVectors(Pt,Mt).normalize(),vt.push(Tt.x,Tt.y,Tt.z),_t.push(Nt/tt),_t.push(Rt/et)}for(let Rt=1;Rt<=et;Rt++)for(let Nt=1;Nt<=tt;Nt++){const kt=(tt+1)*Rt+Nt-1,Kt=(tt+1)*(Rt-1)+Nt-1,$t=(tt+1)*(Rt-1)+Nt,en=(tt+1)*Rt+Nt;lt.push(kt,Kt,en),lt.push(Kt,$t,en)}this.setIndex(lt),this.setAttribute("position",new ft(ht,3)),this.setAttribute("normal",new ft(vt,3)),this.setAttribute("uv",new ft(_t,2))}static fromJSON(o){return new $0(o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc)}}class _d extends ms{constructor(o=1,b=.4,et=64,tt=8,ot=2,lt=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:o,tube:b,tubularSegments:et,radialSegments:tt,p:ot,q:lt},et=Math.floor(et),tt=Math.floor(tt);const ht=[],vt=[],_t=[],Mt=[],Pt=new xn,Tt=new xn,Rt=new xn,Nt=new xn,kt=new xn,Kt=new xn,$t=new xn;for(let ln=0;ln<=et;++ln){const gn=ln/et*ot*Math.PI*2;en(gn,ot,lt,o,Rt),en(gn+.01,ot,lt,o,Nt),Kt.subVectors(Nt,Rt),$t.addVectors(Nt,Rt),kt.crossVectors(Kt,$t),$t.crossVectors(kt,Kt),kt.normalize(),$t.normalize();for(let _n=0;_n<=tt;++_n){const An=_n/tt*Math.PI*2,Ln=-b*Math.cos(An),Nn=b*Math.sin(An);Pt.x=Rt.x+(Ln*$t.x+Nn*kt.x),Pt.y=Rt.y+(Ln*$t.y+Nn*kt.y),Pt.z=Rt.z+(Ln*$t.z+Nn*kt.z),vt.push(Pt.x,Pt.y,Pt.z),Tt.subVectors(Pt,Rt).normalize(),_t.push(Tt.x,Tt.y,Tt.z),Mt.push(ln/et),Mt.push(_n/tt)}}for(let ln=1;ln<=et;ln++)for(let gn=1;gn<=tt;gn++){const _n=(tt+1)*(ln-1)+(gn-1),An=(tt+1)*ln+(gn-1),Ln=(tt+1)*ln+gn,Nn=(tt+1)*(ln-1)+gn;ht.push(_n,An,Nn),ht.push(An,Ln,Nn)}function en(ln,gn,_n,An,Ln){const Nn=Math.cos(ln),Jn=Math.sin(ln),tr=_n/gn*ln,jn=Math.cos(tr);Ln.x=An*(2+jn)*.5*Nn,Ln.y=An*(2+jn)*Jn*.5,Ln.z=An*Math.sin(tr)*.5}this.setIndex(ht),this.setAttribute("position",new ft(vt,3)),this.setAttribute("normal",new ft(_t,3)),this.setAttribute("uv",new ft(Mt,2))}static fromJSON(o){return new _d(o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q)}}class Ax extends ms{constructor(o=new dE(new xn(-1,-1,0),new xn(-1,1,0),new xn(1,1,0)),b=64,et=1,tt=8,ot=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:b,radius:et,radialSegments:tt,closed:ot};const lt=o.computeFrenetFrames(b,ot);this.tangents=lt.tangents,this.normals=lt.normals,this.binormals=lt.binormals;const ht=new xn,vt=new xn,_t=new Lr;let Mt=new xn;const Pt=[],Tt=[],Rt=[],Nt=[];function kt(Kt){Mt=o.getPointAt(Kt/b,Mt);const $t=lt.normals[Kt],en=lt.binormals[Kt];for(let ln=0;ln<=tt;ln++){const gn=ln/tt*Math.PI*2,_n=Math.sin(gn),An=-Math.cos(gn);vt.x=An*$t.x+_n*en.x,vt.y=An*$t.y+_n*en.y,vt.z=An*$t.z+_n*en.z,vt.normalize(),Tt.push(vt.x,vt.y,vt.z),ht.x=Mt.x+et*vt.x,ht.y=Mt.y+et*vt.y,ht.z=Mt.z+et*vt.z,Pt.push(ht.x,ht.y,ht.z)}}(function(){for(let Kt=0;Kt<b;Kt++)kt(Kt);kt(ot===!1?b:0),function(){for(let Kt=0;Kt<=b;Kt++)for(let $t=0;$t<=tt;$t++)_t.x=Kt/b,_t.y=$t/tt,Rt.push(_t.x,_t.y)}(),function(){for(let Kt=1;Kt<=b;Kt++)for(let $t=1;$t<=tt;$t++){const en=(tt+1)*(Kt-1)+($t-1),ln=(tt+1)*Kt+($t-1),gn=(tt+1)*Kt+$t,_n=(tt+1)*(Kt-1)+$t;Nt.push(en,ln,_n),Nt.push(ln,gn,_n)}}()})(),this.setIndex(Nt),this.setAttribute("position",new ft(Pt,3)),this.setAttribute("normal",new ft(Tt,3)),this.setAttribute("uv",new ft(Rt,2))}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o}static fromJSON(o){return new Ax(new jo[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed)}}class NT extends ms{constructor(o=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:o},o!==null){const b=[],et=new Set,tt=new xn,ot=new xn;if(o.index!==null){const lt=o.attributes.position,ht=o.index;let vt=o.groups;vt.length===0&&(vt=[{start:0,count:ht.count,materialIndex:0}]);for(let _t=0,Mt=vt.length;_t<Mt;++_t){const Pt=vt[_t],Tt=Pt.start;for(let Rt=Tt,Nt=Tt+Pt.count;Rt<Nt;Rt+=3)for(let kt=0;kt<3;kt++){const Kt=ht.getX(Rt+kt),$t=ht.getX(Rt+(kt+1)%3);tt.fromBufferAttribute(lt,Kt),ot.fromBufferAttribute(lt,$t),xC(tt,ot,et)===!0&&(b.push(tt.x,tt.y,tt.z),b.push(ot.x,ot.y,ot.z))}}}else{const lt=o.attributes.position;for(let ht=0,vt=lt.count/3;ht<vt;ht++)for(let _t=0;_t<3;_t++){const Mt=3*ht+_t,Pt=3*ht+(_t+1)%3;tt.fromBufferAttribute(lt,Mt),ot.fromBufferAttribute(lt,Pt),xC(tt,ot,et)===!0&&(b.push(tt.x,tt.y,tt.z),b.push(ot.x,ot.y,ot.z))}}this.setAttribute("position",new ft(b,3))}}}function xC(dt,o,b){const et=`${dt.x},${dt.y},${dt.z}-${o.x},${o.y},${o.z}`,tt=`${o.x},${o.y},${o.z}-${dt.x},${dt.y},${dt.z}`;return b.has(et)!==!0&&b.has(tt)!==!0&&(b.add(et),b.add(tt),!0)}var Xm=Object.freeze({__proto__:null,BoxGeometry:Hm,CapsuleGeometry:hx,CircleGeometry:Sm,ConeGeometry:Ol,CylinderGeometry:Fu,DodecahedronGeometry:dx,EdgesGeometry:pE,ExtrudeGeometry:_x,IcosahedronGeometry:tw,LatheGeometry:Yl,OctahedronGeometry:up,PlaneGeometry:z0,PolyhedronGeometry:$_,RingGeometry:Yy,ShapeGeometry:yx,SphereGeometry:nw,TetrahedronGeometry:Xy,TorusGeometry:$0,TorusKnotGeometry:_d,TubeGeometry:Ax,WireframeGeometry:NT});class vE extends Lu{constructor(o){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new as(0),this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.fog=o.fog,this}}class FT extends yv{constructor(o){super(o),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class bC extends Lu{constructor(o){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new as(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new as(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Iu,this.normalScale=new Lr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class EC extends bC{constructor(o){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Lr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ts(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(b){this.ior=(1+.4*b)/(1-.4*b)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new as(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new as(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new as(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(o)}get sheen(){return this._sheen}set sheen(o){this._sheen>0!=o>0&&this.version++,this._sheen=o}get clearcoat(){return this._clearcoat}set clearcoat(o){this._clearcoat>0!=o>0&&this.version++,this._clearcoat=o}get iridescence(){return this._iridescence}set iridescence(o){this._iridescence>0!=o>0&&this.version++,this._iridescence=o}get transmission(){return this._transmission}set transmission(o){this._transmission>0!=o>0&&this.version++,this._transmission=o}copy(o){return super.copy(o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.ior=o.ior,this.iridescence=o.iridescence,this.iridescenceMap=o.iridescenceMap,this.iridescenceIOR=o.iridescenceIOR,this.iridescenceThicknessRange=[...o.iridescenceThicknessRange],this.iridescenceThicknessMap=o.iridescenceThicknessMap,this.sheen=o.sheen,this.sheenColor.copy(o.sheenColor),this.sheenColorMap=o.sheenColorMap,this.sheenRoughness=o.sheenRoughness,this.sheenRoughnessMap=o.sheenRoughnessMap,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this.thickness=o.thickness,this.thicknessMap=o.thicknessMap,this.attenuationDistance=o.attenuationDistance,this.attenuationColor.copy(o.attenuationColor),this.specularIntensity=o.specularIntensity,this.specularIntensityMap=o.specularIntensityMap,this.specularColor.copy(o.specularColor),this.specularColorMap=o.specularColorMap,this}}class wx extends Lu{constructor(o){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new as(16777215),this.specular=new as(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new as(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Iu,this.normalScale=new Lr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ds,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.specular.copy(o.specular),this.shininess=o.shininess,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class UT extends Lu{constructor(o){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new as(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new as(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Iu,this.normalScale=new Lr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.gradientMap=o.gradientMap,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}class xx extends Lu{constructor(o){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Iu,this.normalScale=new Lr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(o)}copy(o){return super.copy(o),this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.flatShading=o.flatShading,this}}class SC extends Lu{constructor(o){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new as(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new as(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Iu,this.normalScale=new Lr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ds,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class bx extends Lu{constructor(o){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new as(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Iu,this.normalScale=new Lr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={MATCAP:""},this.color.copy(o.color),this.matcap=o.matcap,this.map=o.map,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.flatShading=o.flatShading,this.fog=o.fog,this}}class CC extends Lp{constructor(o){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(o)}copy(o){return super.copy(o),this.scale=o.scale,this.dashSize=o.dashSize,this.gapSize=o.gapSize,this}}function Mm(dt,o,b){return eu(dt)?new dt.constructor(dt.subarray(o,b!==void 0?b:dt.length)):dt.slice(o,b)}function pm(dt,o,b){return!dt||!b&&dt.constructor===o?dt:typeof o.BYTES_PER_ELEMENT=="number"?new o(dt):Array.prototype.slice.call(dt)}function eu(dt){return ArrayBuffer.isView(dt)&&!(dt instanceof DataView)}function jT(dt){const o=dt.length,b=new Array(o);for(let et=0;et!==o;++et)b[et]=et;return b.sort(function(et,tt){return dt[et]-dt[tt]}),b}function Np(dt,o,b){const et=dt.length,tt=new dt.constructor(et);for(let ot=0,lt=0;lt!==et;++ot){const ht=b[ot]*o;for(let vt=0;vt!==o;++vt)tt[lt++]=dt[ht+vt]}return tt}function au(dt,o,b,et){let tt=1,ot=dt[0];for(;ot!==void 0&&ot[et]===void 0;)ot=dt[tt++];if(ot===void 0)return;let lt=ot[et];if(lt!==void 0)if(Array.isArray(lt))do lt=ot[et],lt!==void 0&&(o.push(ot.time),b.push.apply(b,lt)),ot=dt[tt++];while(ot!==void 0);else if(lt.toArray!==void 0)do lt=ot[et],lt!==void 0&&(o.push(ot.time),lt.toArray(b,b.length)),ot=dt[tt++];while(ot!==void 0);else do lt=ot[et],lt!==void 0&&(o.push(ot.time),b.push(lt)),ot=dt[tt++];while(ot!==void 0)}var Ex=Object.freeze({__proto__:null,arraySlice:Mm,convertArray:pm,isTypedArray:eu,getKeyframeOrder:jT,sortedArray:Np,flattenJSON:au,subclip:function(dt,o,b,et,tt=30){const ot=dt.clone();ot.name=o;const lt=[];for(let vt=0;vt<ot.tracks.length;++vt){const _t=ot.tracks[vt],Mt=_t.getValueSize(),Pt=[],Tt=[];for(let Rt=0;Rt<_t.times.length;++Rt){const Nt=_t.times[Rt]*tt;if(!(Nt<b||Nt>=et)){Pt.push(_t.times[Rt]);for(let kt=0;kt<Mt;++kt)Tt.push(_t.values[Rt*Mt+kt])}}Pt.length!==0&&(_t.times=pm(Pt,_t.times.constructor),_t.values=pm(Tt,_t.values.constructor),lt.push(_t))}ot.tracks=lt;let ht=1/0;for(let vt=0;vt<ot.tracks.length;++vt)ht>ot.tracks[vt].times[0]&&(ht=ot.tracks[vt].times[0]);for(let vt=0;vt<ot.tracks.length;++vt)ot.tracks[vt].shift(-1*ht);return ot.resetDuration(),ot},makeClipAdditive:function(dt,o=0,b=dt,et=30){et<=0&&(et=30);const tt=b.tracks.length,ot=o/et;for(let lt=0;lt<tt;++lt){const ht=b.tracks[lt],vt=ht.ValueTypeName;if(vt==="bool"||vt==="string")continue;const _t=dt.tracks.find(function($t){return $t.name===ht.name&&$t.ValueTypeName===vt});if(_t===void 0)continue;let Mt=0;const Pt=ht.getValueSize();ht.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Mt=Pt/3);let Tt=0;const Rt=_t.getValueSize();_t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Tt=Rt/3);const Nt=ht.times.length-1;let kt;if(ot<=ht.times[0]){const $t=Mt,en=Pt-Mt;kt=Mm(ht.values,$t,en)}else if(ot>=ht.times[Nt]){const $t=Nt*Pt+Mt,en=$t+Pt-Mt;kt=Mm(ht.values,$t,en)}else{const $t=ht.createInterpolant(),en=Mt,ln=Pt-Mt;$t.evaluate(ot),kt=Mm($t.resultBuffer,en,ln)}vt==="quaternion"&&new ku().fromArray(kt).normalize().conjugate().toArray(kt);const Kt=_t.times.length;for(let $t=0;$t<Kt;++$t){const en=$t*Rt+Tt;if(vt==="quaternion")ku.multiplyQuaternionsFlat(_t.values,en,kt,0,_t.values,en);else{const ln=Rt-2*Tt;for(let gn=0;gn<ln;++gn)_t.values[en+gn]-=kt[gn]}}}return dt.blendMode=_A,dt}});class Ky{constructor(o,b,et,tt){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=tt!==void 0?tt:new b.constructor(et),this.sampleValues=b,this.valueSize=et,this.settings=null,this.DefaultSettings_={}}evaluate(o){const b=this.parameterPositions;let et=this._cachedIndex,tt=b[et],ot=b[et-1];e:{t:{let lt;n:{r:if(!(o<tt)){for(let ht=et+2;;){if(tt===void 0){if(o<ot)break r;return et=b.length,this._cachedIndex=et,this.copySampleValue_(et-1)}if(et===ht)break;if(ot=tt,tt=b[++et],o<tt)break t}lt=b.length;break n}if(o>=ot)break e;{const ht=b[1];o<ht&&(et=2,ot=ht);for(let vt=et-2;;){if(ot===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(et===vt)break;if(tt=ot,ot=b[--et-1],o>=ot)break t}lt=et,et=0}}for(;et<lt;){const ht=et+lt>>>1;o<b[ht]?lt=ht:et=ht+1}if(tt=b[et],ot=b[et-1],ot===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(tt===void 0)return et=b.length,this._cachedIndex=et,this.copySampleValue_(et-1)}this._cachedIndex=et,this.intervalChanged_(et,ot,tt)}return this.interpolate_(et,ot,o,tt)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(o){const b=this.resultBuffer,et=this.sampleValues,tt=this.valueSize,ot=o*tt;for(let lt=0;lt!==tt;++lt)b[lt]=et[ot+lt];return b}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class _E extends Ky{constructor(o,b,et,tt){super(o,b,et,tt),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:gu,endingEnd:gu}}intervalChanged_(o,b,et){const tt=this.parameterPositions;let ot=o-2,lt=o+1,ht=tt[ot],vt=tt[lt];if(ht===void 0)switch(this.getSettings_().endingStart){case Wp:ot=o,ht=2*b-et;break;case S_:ot=tt.length-2,ht=b+tt[ot]-tt[ot+1];break;default:ot=o,ht=et}if(vt===void 0)switch(this.getSettings_().endingEnd){case Wp:lt=o,vt=2*et-b;break;case S_:lt=1,vt=et+tt[1]-tt[0];break;default:lt=o-1,vt=b}const _t=.5*(et-b),Mt=this.valueSize;this._weightPrev=_t/(b-ht),this._weightNext=_t/(vt-et),this._offsetPrev=ot*Mt,this._offsetNext=lt*Mt}interpolate_(o,b,et,tt){const ot=this.resultBuffer,lt=this.sampleValues,ht=this.valueSize,vt=o*ht,_t=vt-ht,Mt=this._offsetPrev,Pt=this._offsetNext,Tt=this._weightPrev,Rt=this._weightNext,Nt=(et-b)/(tt-b),kt=Nt*Nt,Kt=kt*Nt,$t=-Tt*Kt+2*Tt*kt-Tt*Nt,en=(1+Tt)*Kt+(-1.5-2*Tt)*kt+(-.5+Tt)*Nt+1,ln=(-1-Rt)*Kt+(1.5+Rt)*kt+.5*Nt,gn=Rt*Kt-Rt*kt;for(let _n=0;_n!==ht;++_n)ot[_n]=$t*lt[Mt+_n]+en*lt[_t+_n]+ln*lt[vt+_n]+gn*lt[Pt+_n];return ot}}class MC extends Ky{constructor(o,b,et,tt){super(o,b,et,tt)}interpolate_(o,b,et,tt){const ot=this.resultBuffer,lt=this.sampleValues,ht=this.valueSize,vt=o*ht,_t=vt-ht,Mt=(et-b)/(tt-b),Pt=1-Mt;for(let Tt=0;Tt!==ht;++Tt)ot[Tt]=lt[_t+Tt]*Pt+lt[vt+Tt]*Mt;return ot}}class TC extends Ky{constructor(o,b,et,tt){super(o,b,et,tt)}interpolate_(o){return this.copySampleValue_(o-1)}}class Pv{constructor(o,b,et,tt){if(o===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(b===void 0||b.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+o);this.name=o,this.times=pm(b,this.TimeBufferType),this.values=pm(et,this.ValueBufferType),this.setInterpolation(tt||this.DefaultInterpolation)}static toJSON(o){const b=o.constructor;let et;if(b.toJSON!==this.toJSON)et=b.toJSON(o);else{et={name:o.name,times:pm(o.times,Array),values:pm(o.values,Array)};const tt=o.getInterpolation();tt!==o.DefaultInterpolation&&(et.interpolation=tt)}return et.type=o.ValueTypeName,et}InterpolantFactoryMethodDiscrete(o){return new TC(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodLinear(o){return new MC(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodSmooth(o){return new _E(this.times,this.values,this.getValueSize(),o)}setInterpolation(o){let b;switch(o){case E_:b=this.InterpolantFactoryMethodDiscrete;break;case x0:b=this.InterpolantFactoryMethodLinear;break;case Tu:b=this.InterpolantFactoryMethodSmooth}if(b===void 0){const et="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(o===this.DefaultInterpolation)throw new Error(et);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",et),this}return this.createInterpolant=b,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return E_;case this.InterpolantFactoryMethodLinear:return x0;case this.InterpolantFactoryMethodSmooth:return Tu}}getValueSize(){return this.values.length/this.times.length}shift(o){if(o!==0){const b=this.times;for(let et=0,tt=b.length;et!==tt;++et)b[et]+=o}return this}scale(o){if(o!==1){const b=this.times;for(let et=0,tt=b.length;et!==tt;++et)b[et]*=o}return this}trim(o,b){const et=this.times,tt=et.length;let ot=0,lt=tt-1;for(;ot!==tt&&et[ot]<o;)++ot;for(;lt!==-1&&et[lt]>b;)--lt;if(++lt,ot!==0||lt!==tt){ot>=lt&&(lt=Math.max(lt,1),ot=lt-1);const ht=this.getValueSize();this.times=Mm(et,ot,lt),this.values=Mm(this.values,ot*ht,lt*ht)}return this}validate(){let o=!0;const b=this.getValueSize();b-Math.floor(b)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),o=!1);const et=this.times,tt=this.values,ot=et.length;ot===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),o=!1);let lt=null;for(let ht=0;ht!==ot;ht++){const vt=et[ht];if(typeof vt=="number"&&isNaN(vt)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,ht,vt),o=!1;break}if(lt!==null&&lt>vt){console.error("THREE.KeyframeTrack: Out of order keys.",this,ht,vt,lt),o=!1;break}lt=vt}if(tt!==void 0&&eu(tt))for(let ht=0,vt=tt.length;ht!==vt;++ht){const _t=tt[ht];if(isNaN(_t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,ht,_t),o=!1;break}}return o}optimize(){const o=Mm(this.times),b=Mm(this.values),et=this.getValueSize(),tt=this.getInterpolation()===Tu,ot=o.length-1;let lt=1;for(let ht=1;ht<ot;++ht){let vt=!1;const _t=o[ht];if(_t!==o[ht+1]&&(ht!==1||_t!==o[0]))if(tt)vt=!0;else{const Mt=ht*et,Pt=Mt-et,Tt=Mt+et;for(let Rt=0;Rt!==et;++Rt){const Nt=b[Mt+Rt];if(Nt!==b[Pt+Rt]||Nt!==b[Tt+Rt]){vt=!0;break}}}if(vt){if(ht!==lt){o[lt]=o[ht];const Mt=ht*et,Pt=lt*et;for(let Tt=0;Tt!==et;++Tt)b[Pt+Tt]=b[Mt+Tt]}++lt}}if(ot>0){o[lt]=o[ot];for(let ht=ot*et,vt=lt*et,_t=0;_t!==et;++_t)b[vt+_t]=b[ht+_t];++lt}return lt!==o.length?(this.times=Mm(o,0,lt),this.values=Mm(b,0,lt*et)):(this.times=o,this.values=b),this}clone(){const o=Mm(this.times,0),b=Mm(this.values,0),et=new this.constructor(this.name,o,b);return et.createInterpolant=this.createInterpolant,et}}Pv.prototype.TimeBufferType=Float32Array,Pv.prototype.ValueBufferType=Float32Array,Pv.prototype.DefaultInterpolation=x0;class J_ extends Pv{}J_.prototype.ValueTypeName="bool",J_.prototype.ValueBufferType=Array,J_.prototype.DefaultInterpolation=E_,J_.prototype.InterpolantFactoryMethodLinear=void 0,J_.prototype.InterpolantFactoryMethodSmooth=void 0;class Z_ extends Pv{}Z_.prototype.ValueTypeName="color";class e0 extends Pv{}e0.prototype.ValueTypeName="number";class Sx extends Ky{constructor(o,b,et,tt){super(o,b,et,tt)}interpolate_(o,b,et,tt){const ot=this.resultBuffer,lt=this.sampleValues,ht=this.valueSize,vt=(et-b)/(tt-b);let _t=o*ht;for(let Mt=_t+ht;_t!==Mt;_t+=4)ku.slerpFlat(ot,0,lt,_t-ht,lt,_t,vt);return ot}}class fm extends Pv{InterpolantFactoryMethodLinear(o){return new Sx(this.times,this.values,this.getValueSize(),o)}}fm.prototype.ValueTypeName="quaternion",fm.prototype.DefaultInterpolation=x0,fm.prototype.InterpolantFactoryMethodSmooth=void 0;class Km extends Pv{}Km.prototype.ValueTypeName="string",Km.prototype.ValueBufferType=Array,Km.prototype.DefaultInterpolation=E_,Km.prototype.InterpolantFactoryMethodLinear=void 0,Km.prototype.InterpolantFactoryMethodSmooth=void 0;class rw extends Pv{}rw.prototype.ValueTypeName="vector";class Cx{constructor(o,b=-1,et,tt=Ml){this.name=o,this.tracks=et,this.duration=b,this.blendMode=tt,this.uuid=Xu(),this.duration<0&&this.resetDuration()}static parse(o){const b=[],et=o.tracks,tt=1/(o.fps||1);for(let lt=0,ht=et.length;lt!==ht;++lt)b.push(J0(et[lt]).scale(tt));const ot=new this(o.name,o.duration,b,o.blendMode);return ot.uuid=o.uuid,ot}static toJSON(o){const b=[],et=o.tracks,tt={name:o.name,duration:o.duration,tracks:b,uuid:o.uuid,blendMode:o.blendMode};for(let ot=0,lt=et.length;ot!==lt;++ot)b.push(Pv.toJSON(et[ot]));return tt}static CreateFromMorphTargetSequence(o,b,et,tt){const ot=b.length,lt=[];for(let ht=0;ht<ot;ht++){let vt=[],_t=[];vt.push((ht+ot-1)%ot,ht,(ht+1)%ot),_t.push(0,1,0);const Mt=jT(vt);vt=Np(vt,1,Mt),_t=Np(_t,1,Mt),tt||vt[0]!==0||(vt.push(ot),_t.push(_t[0])),lt.push(new e0(".morphTargetInfluences["+b[ht].name+"]",vt,_t).scale(1/et))}return new this(o,-1,lt)}static findByName(o,b){let et=o;if(!Array.isArray(o)){const tt=o;et=tt.geometry&&tt.geometry.animations||tt.animations}for(let tt=0;tt<et.length;tt++)if(et[tt].name===b)return et[tt];return null}static CreateClipsFromMorphTargetSequences(o,b,et){const tt={},ot=/^([\w-]*?)([\d]+)$/;for(let ht=0,vt=o.length;ht<vt;ht++){const _t=o[ht],Mt=_t.name.match(ot);if(Mt&&Mt.length>1){const Pt=Mt[1];let Tt=tt[Pt];Tt||(tt[Pt]=Tt=[]),Tt.push(_t)}}const lt=[];for(const ht in tt)lt.push(this.CreateFromMorphTargetSequence(ht,tt[ht],b,et));return lt}static parseAnimation(o,b){if(!o)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const et=function(Mt,Pt,Tt,Rt,Nt){if(Tt.length!==0){const kt=[],Kt=[];au(Tt,kt,Kt,Rt),kt.length!==0&&Nt.push(new Mt(Pt,kt,Kt))}},tt=[],ot=o.name||"default",lt=o.fps||30,ht=o.blendMode;let vt=o.length||-1;const _t=o.hierarchy||[];for(let Mt=0;Mt<_t.length;Mt++){const Pt=_t[Mt].keys;if(Pt&&Pt.length!==0)if(Pt[0].morphTargets){const Tt={};let Rt;for(Rt=0;Rt<Pt.length;Rt++)if(Pt[Rt].morphTargets)for(let Nt=0;Nt<Pt[Rt].morphTargets.length;Nt++)Tt[Pt[Rt].morphTargets[Nt]]=-1;for(const Nt in Tt){const kt=[],Kt=[];for(let $t=0;$t!==Pt[Rt].morphTargets.length;++$t){const en=Pt[Rt];kt.push(en.time),Kt.push(en.morphTarget===Nt?1:0)}tt.push(new e0(".morphTargetInfluence["+Nt+"]",kt,Kt))}vt=Tt.length*lt}else{const Tt=".bones["+b[Mt].name+"]";et(rw,Tt+".position",Pt,"pos",tt),et(fm,Tt+".quaternion",Pt,"rot",tt),et(rw,Tt+".scale",Pt,"scl",tt)}}return tt.length===0?null:new this(ot,vt,tt,ht)}resetDuration(){let o=0;for(let b=0,et=this.tracks.length;b!==et;++b){const tt=this.tracks[b];o=Math.max(o,tt.times[tt.times.length-1])}return this.duration=o,this}trim(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].trim(0,this.duration);return this}validate(){let o=!0;for(let b=0;b<this.tracks.length;b++)o=o&&this.tracks[b].validate();return o}optimize(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].optimize();return this}clone(){const o=[];for(let b=0;b<this.tracks.length;b++)o.push(this.tracks[b].clone());return new this.constructor(this.name,this.duration,o,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function J0(dt){if(dt.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const o=function(b){switch(b.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return e0;case"vector":case"vector2":case"vector3":case"vector4":return rw;case"color":return Z_;case"quaternion":return fm;case"bool":case"boolean":return J_;case"string":return Km}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+b)}(dt.type);if(dt.times===void 0){const b=[],et=[];au(dt.keys,b,et,"value"),dt.times=b,dt.values=et}return o.parse!==void 0?o.parse(dt):new o(dt.name,dt.times,dt.values,dt.interpolation)}const t0={enabled:!1,files:{},add:function(dt,o){this.enabled!==!1&&(this.files[dt]=o)},get:function(dt,o){return this.enabled===!1?o?Promise.resolve():void 0:o?Promise.resolve(this.files[dt]):this.files[dt]},remove:function(dt){delete this.files[dt]},clear:function(){this.files={}}};class n0{constructor(o,b,et){const tt=this;let ot,lt=!1,ht=0,vt=0;const _t=[];this.onStart=void 0,this.onLoad=o,this.onProgress=b,this.onError=et,this.itemStart=function(Mt){vt++,lt===!1&&tt.onStart!==void 0&&tt.onStart(Mt,ht,vt),lt=!0},this.itemEnd=function(Mt){ht++,tt.onProgress!==void 0&&tt.onProgress(Mt,ht,vt),ht===vt&&(lt=!1,tt.onLoad!==void 0&&tt.onLoad())},this.itemError=function(Mt){tt.onError!==void 0&&tt.onError(Mt)},this.resolveURL=function(Mt){return ot?ot(Mt):Mt},this.setURLModifier=function(Mt){return ot=Mt,this},this.addHandler=function(Mt,Pt){return _t.push(Mt,Pt),this},this.removeHandler=function(Mt){const Pt=_t.indexOf(Mt);return Pt!==-1&&_t.splice(Pt,2),this},this.getHandler=function(Mt){for(let Pt=0,Tt=_t.length;Pt<Tt;Pt+=2){const Rt=_t[Pt],Nt=_t[Pt+1];if(Rt.global&&(Rt.lastIndex=0),Rt.test(Mt))return Nt}return null}}}const $y=new n0;class Uu{constructor(o){this.manager=o!==void 0?o:$y,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(o,b){const et=this;return new Promise(function(tt,ot){et.load(o,tt,b,ot)})}parse(){}setCrossOrigin(o){return this.crossOrigin=o,this}setWithCredentials(o){return this.withCredentials=o,this}setPath(o){return this.path=o,this}setResourcePath(o){return this.resourcePath=o,this}setRequestHeader(o){return this.requestHeader=o,this}}const bu={};class vP extends Error{constructor(o,b){super(o),this.response=b}}class r0 extends Uu{constructor(o){super(o),this.responseType="text"}load(o,b,et,tt){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o),t0.get(o,this.responseType,this.mimeType).then(ot=>{if(ot!==void 0)return this.manager.itemStart(o),setTimeout(()=>{b&&b(ot),this.manager.itemEnd(o)},0),ot;if(bu[o]!==void 0)return void bu[o].push({onLoad:b,onProgress:et,onError:tt});bu[o]=[],bu[o].push({onLoad:b,onProgress:et,onError:tt});const lt=new Request(o,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),ht=this.mimeType,vt=this.responseType;fetch(lt).then(_t=>{if(_t.status===200||_t.status===0){if(_t.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||_t.body===void 0||_t.body.getReader===void 0)return _t;const Mt=bu[o],Pt=_t.body.getReader(),Tt=_t.headers.get("Content-Length"),Rt=Tt?parseInt(Tt):0,Nt=Rt!==0;let kt=0;const Kt=new ReadableStream({start($t){(function en(){Pt.read().then(({done:ln,value:gn})=>{if(ln)$t.close();else{kt+=gn.byteLength;const _n=new ProgressEvent("progress",{lengthComputable:Nt,loaded:kt,total:Rt});for(let An=0,Ln=Mt.length;An<Ln;An++){const Nn=Mt[An];Nn.onProgress&&Nn.onProgress(_n)}$t.enqueue(gn),en()}})})()}});return new Response(Kt)}throw new vP(`fetch for "${_t.url}" responded with ${_t.status}: ${_t.statusText}`,_t)}).then(_t=>{switch(vt){case"arraybuffer":return _t.arrayBuffer();case"blob":return _t.blob();case"document":return _t.text().then(Mt=>new DOMParser().parseFromString(Mt,ht));case"json":return _t.json();default:if(ht===void 0)return _t.text();{const Mt=/charset="?([^;"\s]*)"?/i.exec(ht),Pt=Mt&&Mt[1]?Mt[1].toLowerCase():void 0,Tt=new TextDecoder(Pt);return _t.arrayBuffer().then(Rt=>Tt.decode(Rt))}}}).then(_t=>{t0.add(o,_t,this.responseType);const Mt=bu[o];delete bu[o];for(let Pt=0,Tt=Mt.length;Pt<Tt;Pt++){const Rt=Mt[Pt];Rt.onLoad&&Rt.onLoad(_t)}}).catch(_t=>{const Mt=bu[o];if(Mt===void 0)throw this.manager.itemError(o),_t;delete bu[o];for(let Pt=0,Tt=Mt.length;Pt<Tt;Pt++){const Rt=Mt[Pt];Rt.onError&&Rt.onError(_t)}this.manager.itemError(o)}).finally(()=>{this.manager.itemEnd(o)}),this.manager.itemStart(o)})}setResponseType(o){return this.responseType=o,this}setMimeType(o){return this.mimeType=o,this}}class Mx extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=this,lt=new r0(this.manager);lt.setPath(this.path),lt.setRequestHeader(this.requestHeader),lt.setWithCredentials(this.withCredentials),lt.load(o,function(ht){try{b(ot.parse(JSON.parse(ht)))}catch(vt){tt?tt(vt):console.error(vt),ot.manager.itemError(o)}},et,tt)}parse(o){const b=[];for(let et=0;et<o.length;et++){const tt=Cx.parse(o[et]);b.push(tt)}return b}}class Fp extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=this,lt=[],ht=new lx,vt=new r0(this.manager);vt.setPath(this.path),vt.setResponseType("arraybuffer"),vt.setRequestHeader(this.requestHeader),vt.setWithCredentials(ot.withCredentials);let _t=0;function Mt(Pt){vt.load(o[Pt],function(Tt){const Rt=ot.parse(Tt,!0);lt[Pt]={width:Rt.width,height:Rt.height,format:Rt.format,mipmaps:Rt.mipmaps},_t+=1,_t===6&&(Rt.mipmapCount===1&&(ht.minFilter=Vo),ht.image=lt,ht.format=Rt.format,ht.needsUpdate=!0,b&&b(ht))},et,tt)}if(Array.isArray(o))for(let Pt=0,Tt=o.length;Pt<Tt;++Pt)Mt(Pt);else vt.load(o,function(Pt){const Tt=ot.parse(Pt,!0);if(Tt.isCubemap){const Rt=Tt.mipmaps.length/Tt.mipmapCount;for(let Nt=0;Nt<Rt;Nt++){lt[Nt]={mipmaps:[]};for(let kt=0;kt<Tt.mipmapCount;kt++)lt[Nt].mipmaps.push(Tt.mipmaps[Nt*Tt.mipmapCount+kt]),lt[Nt].format=Tt.format,lt[Nt].width=Tt.width,lt[Nt].height=Tt.height}ht.image=lt}else ht.image.width=Tt.width,ht.image.height=Tt.height,ht.mipmaps=Tt.mipmaps;Tt.mipmapCount===1&&(ht.minFilter=Vo),ht.format=Tt.format,ht.needsUpdate=!0,b&&b(ht)},et,tt);return ht}}class iw extends Uu{constructor(o){super(o)}load(o,b,et,tt){this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const ot=this,lt=t0.get(o);if(lt!==void 0)return ot.manager.itemStart(o),setTimeout(function(){b&&b(lt),ot.manager.itemEnd(o)},0),lt;const ht=B_("img");function vt(){Mt(),t0.add(o,this),b&&b(this),ot.manager.itemEnd(o)}function _t(Pt){Mt(),tt&&tt(Pt),ot.manager.itemError(o),ot.manager.itemEnd(o)}function Mt(){ht.removeEventListener("load",vt,!1),ht.removeEventListener("error",_t,!1)}return ht.addEventListener("load",vt,!1),ht.addEventListener("error",_t,!1),o.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(ht.crossOrigin=this.crossOrigin),ot.manager.itemStart(o),ht.src=o,ht}}class IC extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=new UA,lt=new iw(this.manager);lt.setCrossOrigin(this.crossOrigin),lt.setPath(this.path);let ht=0;function vt(_t){lt.load(o[_t],function(Mt){ot.images[_t]=Mt,ht++,ht===6&&(ot.needsUpdate=!0,b&&b(ot))},void 0,tt)}for(let _t=0;_t<o.length;++_t)vt(_t);return ot}}class i0 extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=this,lt=new YA,ht=new r0(this.manager);return ht.setResponseType("arraybuffer"),ht.setRequestHeader(this.requestHeader),ht.setPath(this.path),ht.setWithCredentials(ot.withCredentials),ht.load(o,function(vt){const _t=ot.parse(vt);_t&&(_t.image!==void 0?lt.image=_t.image:_t.data!==void 0&&(lt.image.width=_t.width,lt.image.height=_t.height,lt.image.data=_t.data,lt.image.complete=!0),lt.wrapS=_t.wrapS!==void 0?_t.wrapS:no,lt.wrapT=_t.wrapT!==void 0?_t.wrapT:no,lt.magFilter=_t.magFilter!==void 0?_t.magFilter:Vo,lt.minFilter=_t.minFilter!==void 0?_t.minFilter:Vo,lt.anisotropy=_t.anisotropy!==void 0?_t.anisotropy:1,_t.encoding!==void 0&&(lt.encoding=_t.encoding),_t.flipY!==void 0&&(lt.flipY=_t.flipY),_t.format!==void 0&&(lt.format=_t.format),_t.type!==void 0&&(lt.type=_t.type),_t.mipmaps!==void 0&&(lt.mipmaps=_t.mipmaps,lt.minFilter=hs),_t.mipmapCount===1&&(lt.minFilter=Vo),_t.generateMipmaps!==void 0&&(lt.generateMipmaps=_t.generateMipmaps),lt.needsUpdate=!0,b&&b(lt,_t))},et,tt),lt}}class PC extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=new vu,lt=new iw(this.manager);return lt.setCrossOrigin(this.crossOrigin),lt.setPath(this.path),lt.load(o,function(ht){ot.image=ht,ot.needsUpdate=!0,b!==void 0&&b(ot)},et,tt),ot}}class a_ extends Zs{constructor(o,b=1){super(),this.isLight=!0,this.type="Light",this.color=new as(o),this.intensity=b}dispose(){}copy(o,b){return super.copy(o,b),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const b=super.toJSON(o);return b.object.color=this.color.getHex(),b.object.intensity=this.intensity,this.groundColor!==void 0&&(b.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(b.object.distance=this.distance),this.angle!==void 0&&(b.object.angle=this.angle),this.decay!==void 0&&(b.object.decay=this.decay),this.penumbra!==void 0&&(b.object.penumbra=this.penumbra),this.shadow!==void 0&&(b.object.shadow=this.shadow.toJSON()),b}}class zT extends a_{constructor(o,b,et){super(o,et),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Zs.DefaultUp),this.updateMatrix(),this.groundColor=new as(b)}copy(o,b){return super.copy(o,b),this.groundColor.copy(o.groundColor),this}}const DC=new zs,yE=new xn,AE=new xn;class Tx{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Lr(512,512),this.map=null,this.mapPass=null,this.matrix=new zs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qw,this._frameExtents=new Lr(1,1),this._viewportCount=1,this._viewports=[new Uo(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const b=this.camera,et=this.matrix;yE.setFromMatrixPosition(o.matrixWorld),b.position.copy(yE),AE.setFromMatrixPosition(o.target.matrixWorld),b.lookAt(AE),b.updateMatrixWorld(),DC.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DC),et.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),et.multiply(b.projectionMatrix),et.multiply(b.matrixWorldInverse)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.normalBias=o.normalBias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}class l_ extends Tx{constructor(){super(new Zu(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(o){const b=this.camera,et=2*Cy*o.angle*this.focus,tt=this.mapSize.width/this.mapSize.height,ot=o.distance||b.far;et===b.fov&&tt===b.aspect&&ot===b.far||(b.fov=et,b.aspect=tt,b.far=ot,b.updateProjectionMatrix()),super.updateMatrices(o)}copy(o){return super.copy(o),this.focus=o.focus,this}}class RC extends a_{constructor(o,b,et=0,tt=Math.PI/3,ot=0,lt=1){super(o,b),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Zs.DefaultUp),this.updateMatrix(),this.target=new Zs,this.distance=et,this.angle=tt,this.penumbra=ot,this.decay=lt,this.map=null,this.shadow=new l_}get power(){return this.intensity*Math.PI}set power(o){this.intensity=o/Math.PI}dispose(){this.shadow.dispose()}copy(o,b){return super.copy(o,b),this.distance=o.distance,this.angle=o.angle,this.penumbra=o.penumbra,this.decay=o.decay,this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}const wE=new zs,Ix=new xn,Px=new xn;class kC extends Tx{constructor(){super(new Zu(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Lr(4,2),this._viewportCount=6,this._viewports=[new Uo(2,1,1,1),new Uo(0,1,1,1),new Uo(3,1,1,1),new Uo(1,1,1,1),new Uo(3,0,1,1),new Uo(1,0,1,1)],this._cubeDirections=[new xn(1,0,0),new xn(-1,0,0),new xn(0,0,1),new xn(0,0,-1),new xn(0,1,0),new xn(0,-1,0)],this._cubeUps=[new xn(0,1,0),new xn(0,1,0),new xn(0,1,0),new xn(0,1,0),new xn(0,0,1),new xn(0,0,-1)]}updateMatrices(o,b=0){const et=this.camera,tt=this.matrix,ot=o.distance||et.far;ot!==et.far&&(et.far=ot,et.updateProjectionMatrix()),Ix.setFromMatrixPosition(o.matrixWorld),et.position.copy(Ix),Px.copy(et.position),Px.add(this._cubeDirections[b]),et.up.copy(this._cubeUps[b]),et.lookAt(Px),et.updateMatrixWorld(),tt.makeTranslation(-Ix.x,-Ix.y,-Ix.z),wE.multiplyMatrices(et.projectionMatrix,et.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wE)}}class VT extends a_{constructor(o,b,et=0,tt=1){super(o,b),this.isPointLight=!0,this.type="PointLight",this.distance=et,this.decay=tt,this.shadow=new kC}get power(){return 4*this.intensity*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,b){return super.copy(o,b),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class xE extends Tx{constructor(){super(new M1(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class QT extends a_{constructor(o,b){super(o,b),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Zs.DefaultUp),this.updateMatrix(),this.target=new Zs,this.shadow=new xE}dispose(){this.shadow.dispose()}copy(o){return super.copy(o),this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}class GT extends a_{constructor(o,b){super(o,b),this.isAmbientLight=!0,this.type="AmbientLight"}}class HT extends a_{constructor(o,b,et=10,tt=10){super(o,b),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=et,this.height=tt}get power(){return this.intensity*this.width*this.height*Math.PI}set power(o){this.intensity=o/(this.width*this.height*Math.PI)}copy(o){return super.copy(o),this.width=o.width,this.height=o.height,this}toJSON(o){const b=super.toJSON(o);return b.object.width=this.width,b.object.height=this.height,b}}class Dx{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let o=0;o<9;o++)this.coefficients.push(new xn)}set(o){for(let b=0;b<9;b++)this.coefficients[b].copy(o[b]);return this}zero(){for(let o=0;o<9;o++)this.coefficients[o].set(0,0,0);return this}getAt(o,b){const et=o.x,tt=o.y,ot=o.z,lt=this.coefficients;return b.copy(lt[0]).multiplyScalar(.282095),b.addScaledVector(lt[1],.488603*tt),b.addScaledVector(lt[2],.488603*ot),b.addScaledVector(lt[3],.488603*et),b.addScaledVector(lt[4],et*tt*1.092548),b.addScaledVector(lt[5],tt*ot*1.092548),b.addScaledVector(lt[6],.315392*(3*ot*ot-1)),b.addScaledVector(lt[7],et*ot*1.092548),b.addScaledVector(lt[8],.546274*(et*et-tt*tt)),b}getIrradianceAt(o,b){const et=o.x,tt=o.y,ot=o.z,lt=this.coefficients;return b.copy(lt[0]).multiplyScalar(.886227),b.addScaledVector(lt[1],1.023328*tt),b.addScaledVector(lt[2],1.023328*ot),b.addScaledVector(lt[3],1.023328*et),b.addScaledVector(lt[4],.858086*et*tt),b.addScaledVector(lt[5],.858086*tt*ot),b.addScaledVector(lt[6],.743125*ot*ot-.247708),b.addScaledVector(lt[7],.858086*et*ot),b.addScaledVector(lt[8],.429043*(et*et-tt*tt)),b}add(o){for(let b=0;b<9;b++)this.coefficients[b].add(o.coefficients[b]);return this}addScaledSH(o,b){for(let et=0;et<9;et++)this.coefficients[et].addScaledVector(o.coefficients[et],b);return this}scale(o){for(let b=0;b<9;b++)this.coefficients[b].multiplyScalar(o);return this}lerp(o,b){for(let et=0;et<9;et++)this.coefficients[et].lerp(o.coefficients[et],b);return this}equals(o){for(let b=0;b<9;b++)if(!this.coefficients[b].equals(o.coefficients[b]))return!1;return!0}copy(o){return this.set(o.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(o,b=0){const et=this.coefficients;for(let tt=0;tt<9;tt++)et[tt].fromArray(o,b+3*tt);return this}toArray(o=[],b=0){const et=this.coefficients;for(let tt=0;tt<9;tt++)et[tt].toArray(o,b+3*tt);return o}static getBasisAt(o,b){const et=o.x,tt=o.y,ot=o.z;b[0]=.282095,b[1]=.488603*tt,b[2]=.488603*ot,b[3]=.488603*et,b[4]=1.092548*et*tt,b[5]=1.092548*tt*ot,b[6]=.315392*(3*ot*ot-1),b[7]=1.092548*et*ot,b[8]=.546274*(et*et-tt*tt)}}class bE extends a_{constructor(o=new Dx,b=1){super(void 0,b),this.isLightProbe=!0,this.sh=o}copy(o){return super.copy(o),this.sh.copy(o.sh),this}fromJSON(o){return this.intensity=o.intensity,this.sh.fromArray(o.sh),this}toJSON(o){const b=super.toJSON(o);return b.object.sh=this.sh.toArray(),b}}class s0 extends Uu{constructor(o){super(o),this.textures={}}load(o,b,et,tt){const ot=this,lt=new r0(ot.manager);lt.setPath(ot.path),lt.setRequestHeader(ot.requestHeader),lt.setWithCredentials(ot.withCredentials),lt.load(o,function(ht){try{b(ot.parse(JSON.parse(ht)))}catch(vt){tt?tt(vt):console.error(vt),ot.manager.itemError(o)}},et,tt)}parse(o){const b=this.textures;function et(ot){return b[ot]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",ot),b[ot]}const tt=s0.createMaterialFromType(o.type);if(o.uuid!==void 0&&(tt.uuid=o.uuid),o.name!==void 0&&(tt.name=o.name),o.color!==void 0&&tt.color!==void 0&&tt.color.setHex(o.color),o.roughness!==void 0&&(tt.roughness=o.roughness),o.metalness!==void 0&&(tt.metalness=o.metalness),o.sheen!==void 0&&(tt.sheen=o.sheen),o.sheenColor!==void 0&&(tt.sheenColor=new as().setHex(o.sheenColor)),o.sheenRoughness!==void 0&&(tt.sheenRoughness=o.sheenRoughness),o.emissive!==void 0&&tt.emissive!==void 0&&tt.emissive.setHex(o.emissive),o.specular!==void 0&&tt.specular!==void 0&&tt.specular.setHex(o.specular),o.specularIntensity!==void 0&&(tt.specularIntensity=o.specularIntensity),o.specularColor!==void 0&&tt.specularColor!==void 0&&tt.specularColor.setHex(o.specularColor),o.shininess!==void 0&&(tt.shininess=o.shininess),o.clearcoat!==void 0&&(tt.clearcoat=o.clearcoat),o.clearcoatRoughness!==void 0&&(tt.clearcoatRoughness=o.clearcoatRoughness),o.iridescence!==void 0&&(tt.iridescence=o.iridescence),o.iridescenceIOR!==void 0&&(tt.iridescenceIOR=o.iridescenceIOR),o.iridescenceThicknessRange!==void 0&&(tt.iridescenceThicknessRange=o.iridescenceThicknessRange),o.transmission!==void 0&&(tt.transmission=o.transmission),o.thickness!==void 0&&(tt.thickness=o.thickness),o.attenuationDistance!==void 0&&(tt.attenuationDistance=o.attenuationDistance),o.attenuationColor!==void 0&&tt.attenuationColor!==void 0&&tt.attenuationColor.setHex(o.attenuationColor),o.fog!==void 0&&(tt.fog=o.fog),o.flatShading!==void 0&&(tt.flatShading=o.flatShading),o.blending!==void 0&&(tt.blending=o.blending),o.combine!==void 0&&(tt.combine=o.combine),o.side!==void 0&&(tt.side=o.side),o.shadowSide!==void 0&&(tt.shadowSide=o.shadowSide),o.opacity!==void 0&&(tt.opacity=o.opacity),o.transparent!==void 0&&(tt.transparent=o.transparent),o.alphaTest!==void 0&&(tt.alphaTest=o.alphaTest),o.depthTest!==void 0&&(tt.depthTest=o.depthTest),o.depthWrite!==void 0&&(tt.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(tt.colorWrite=o.colorWrite),o.stencilWrite!==void 0&&(tt.stencilWrite=o.stencilWrite),o.stencilWriteMask!==void 0&&(tt.stencilWriteMask=o.stencilWriteMask),o.stencilFunc!==void 0&&(tt.stencilFunc=o.stencilFunc),o.stencilRef!==void 0&&(tt.stencilRef=o.stencilRef),o.stencilFuncMask!==void 0&&(tt.stencilFuncMask=o.stencilFuncMask),o.stencilFail!==void 0&&(tt.stencilFail=o.stencilFail),o.stencilZFail!==void 0&&(tt.stencilZFail=o.stencilZFail),o.stencilZPass!==void 0&&(tt.stencilZPass=o.stencilZPass),o.wireframe!==void 0&&(tt.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(tt.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(tt.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(tt.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(tt.rotation=o.rotation),o.linewidth!==1&&(tt.linewidth=o.linewidth),o.dashSize!==void 0&&(tt.dashSize=o.dashSize),o.gapSize!==void 0&&(tt.gapSize=o.gapSize),o.scale!==void 0&&(tt.scale=o.scale),o.polygonOffset!==void 0&&(tt.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(tt.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(tt.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(tt.dithering=o.dithering),o.alphaToCoverage!==void 0&&(tt.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(tt.premultipliedAlpha=o.premultipliedAlpha),o.visible!==void 0&&(tt.visible=o.visible),o.toneMapped!==void 0&&(tt.toneMapped=o.toneMapped),o.userData!==void 0&&(tt.userData=o.userData),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?tt.vertexColors=o.vertexColors>0:tt.vertexColors=o.vertexColors),o.uniforms!==void 0)for(const ot in o.uniforms){const lt=o.uniforms[ot];switch(tt.uniforms[ot]={},lt.type){case"t":tt.uniforms[ot].value=et(lt.value);break;case"c":tt.uniforms[ot].value=new as().setHex(lt.value);break;case"v2":tt.uniforms[ot].value=new Lr().fromArray(lt.value);break;case"v3":tt.uniforms[ot].value=new xn().fromArray(lt.value);break;case"v4":tt.uniforms[ot].value=new Uo().fromArray(lt.value);break;case"m3":tt.uniforms[ot].value=new Ru().fromArray(lt.value);break;case"m4":tt.uniforms[ot].value=new zs().fromArray(lt.value);break;default:tt.uniforms[ot].value=lt.value}}if(o.defines!==void 0&&(tt.defines=o.defines),o.vertexShader!==void 0&&(tt.vertexShader=o.vertexShader),o.fragmentShader!==void 0&&(tt.fragmentShader=o.fragmentShader),o.glslVersion!==void 0&&(tt.glslVersion=o.glslVersion),o.extensions!==void 0)for(const ot in o.extensions)tt.extensions[ot]=o.extensions[ot];if(o.size!==void 0&&(tt.size=o.size),o.sizeAttenuation!==void 0&&(tt.sizeAttenuation=o.sizeAttenuation),o.map!==void 0&&(tt.map=et(o.map)),o.matcap!==void 0&&(tt.matcap=et(o.matcap)),o.alphaMap!==void 0&&(tt.alphaMap=et(o.alphaMap)),o.bumpMap!==void 0&&(tt.bumpMap=et(o.bumpMap)),o.bumpScale!==void 0&&(tt.bumpScale=o.bumpScale),o.normalMap!==void 0&&(tt.normalMap=et(o.normalMap)),o.normalMapType!==void 0&&(tt.normalMapType=o.normalMapType),o.normalScale!==void 0){let ot=o.normalScale;Array.isArray(ot)===!1&&(ot=[ot,ot]),tt.normalScale=new Lr().fromArray(ot)}return o.displacementMap!==void 0&&(tt.displacementMap=et(o.displacementMap)),o.displacementScale!==void 0&&(tt.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(tt.displacementBias=o.displacementBias),o.roughnessMap!==void 0&&(tt.roughnessMap=et(o.roughnessMap)),o.metalnessMap!==void 0&&(tt.metalnessMap=et(o.metalnessMap)),o.emissiveMap!==void 0&&(tt.emissiveMap=et(o.emissiveMap)),o.emissiveIntensity!==void 0&&(tt.emissiveIntensity=o.emissiveIntensity),o.specularMap!==void 0&&(tt.specularMap=et(o.specularMap)),o.specularIntensityMap!==void 0&&(tt.specularIntensityMap=et(o.specularIntensityMap)),o.specularColorMap!==void 0&&(tt.specularColorMap=et(o.specularColorMap)),o.envMap!==void 0&&(tt.envMap=et(o.envMap)),o.envMapIntensity!==void 0&&(tt.envMapIntensity=o.envMapIntensity),o.reflectivity!==void 0&&(tt.reflectivity=o.reflectivity),o.refractionRatio!==void 0&&(tt.refractionRatio=o.refractionRatio),o.lightMap!==void 0&&(tt.lightMap=et(o.lightMap)),o.lightMapIntensity!==void 0&&(tt.lightMapIntensity=o.lightMapIntensity),o.aoMap!==void 0&&(tt.aoMap=et(o.aoMap)),o.aoMapIntensity!==void 0&&(tt.aoMapIntensity=o.aoMapIntensity),o.gradientMap!==void 0&&(tt.gradientMap=et(o.gradientMap)),o.clearcoatMap!==void 0&&(tt.clearcoatMap=et(o.clearcoatMap)),o.clearcoatRoughnessMap!==void 0&&(tt.clearcoatRoughnessMap=et(o.clearcoatRoughnessMap)),o.clearcoatNormalMap!==void 0&&(tt.clearcoatNormalMap=et(o.clearcoatNormalMap)),o.clearcoatNormalScale!==void 0&&(tt.clearcoatNormalScale=new Lr().fromArray(o.clearcoatNormalScale)),o.iridescenceMap!==void 0&&(tt.iridescenceMap=et(o.iridescenceMap)),o.iridescenceThicknessMap!==void 0&&(tt.iridescenceThicknessMap=et(o.iridescenceThicknessMap)),o.transmissionMap!==void 0&&(tt.transmissionMap=et(o.transmissionMap)),o.thicknessMap!==void 0&&(tt.thicknessMap=et(o.thicknessMap)),o.sheenColorMap!==void 0&&(tt.sheenColorMap=et(o.sheenColorMap)),o.sheenRoughnessMap!==void 0&&(tt.sheenRoughnessMap=et(o.sheenRoughnessMap)),tt}setTextures(o){return this.textures=o,this}static createMaterialFromType(o){return new{ShadowMaterial:vE,SpriteMaterial:X1,RawShaderMaterial:FT,ShaderMaterial:yv,PointsMaterial:rE,MeshPhysicalMaterial:EC,MeshStandardMaterial:bC,MeshPhongMaterial:wx,MeshToonMaterial:UT,MeshNormalMaterial:xx,MeshLambertMaterial:SC,MeshDepthMaterial:Zw,MeshDistanceMaterial:GA,MeshBasicMaterial:Gm,MeshMatcapMaterial:bx,LineDashedMaterial:CC,LineBasicMaterial:Lp,Material:Lu}[o]}}class c_{static decodeText(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let b="";for(let et=0,tt=o.length;et<tt;et++)b+=String.fromCharCode(o[et]);try{return decodeURIComponent(escape(b))}catch{return b}}static extractUrlBase(o){const b=o.lastIndexOf("/");return b===-1?"./":o.slice(0,b+1)}static resolveURL(o,b){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(b)&&/^\//.test(o)&&(b=b.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:b+o)}}class mm extends ms{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(o){return super.copy(o),this.instanceCount=o.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const o=super.toJSON(this);return o.instanceCount=this.instanceCount,o.isInstancedBufferGeometry=!0,o}}class WT extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=this,lt=new r0(ot.manager);lt.setPath(ot.path),lt.setRequestHeader(ot.requestHeader),lt.setWithCredentials(ot.withCredentials),lt.load(o,function(ht){try{b(ot.parse(JSON.parse(ht)))}catch(vt){tt?tt(vt):console.error(vt),ot.manager.itemError(o)}},et,tt)}parse(o){const b={},et={};function tt(Pt,Tt){if(b[Tt]!==void 0)return b[Tt];const Rt=Pt.interleavedBuffers[Tt],Nt=function($t,en){if(et[en]!==void 0)return et[en];const ln=$t.arrayBuffers[en],gn=new Uint32Array(ln).buffer;return et[en]=gn,gn}(Pt,Rt.buffer),kt=k_(Rt.type,Nt),Kt=new Y1(kt,Rt.stride);return Kt.uuid=Rt.uuid,b[Tt]=Kt,Kt}const ot=o.isInstancedBufferGeometry?new mm:new ms,lt=o.data.index;if(lt!==void 0){const Pt=k_(lt.type,lt.array);ot.setIndex(new ga(Pt,1))}const ht=o.data.attributes;for(const Pt in ht){const Tt=ht[Pt];let Rt;if(Tt.isInterleavedBufferAttribute){const Nt=tt(o.data,Tt.data);Rt=new r_(Nt,Tt.itemSize,Tt.offset,Tt.normalized)}else{const Nt=k_(Tt.type,Tt.array);Rt=new(Tt.isInstancedBufferAttribute?Gy:ga)(Nt,Tt.itemSize,Tt.normalized)}Tt.name!==void 0&&(Rt.name=Tt.name),Tt.usage!==void 0&&Rt.setUsage(Tt.usage),Tt.updateRange!==void 0&&(Rt.updateRange.offset=Tt.updateRange.offset,Rt.updateRange.count=Tt.updateRange.count),ot.setAttribute(Pt,Rt)}const vt=o.data.morphAttributes;if(vt)for(const Pt in vt){const Tt=vt[Pt],Rt=[];for(let Nt=0,kt=Tt.length;Nt<kt;Nt++){const Kt=Tt[Nt];let $t;if(Kt.isInterleavedBufferAttribute){const en=tt(o.data,Kt.data);$t=new r_(en,Kt.itemSize,Kt.offset,Kt.normalized)}else{const en=k_(Kt.type,Kt.array);$t=new ga(en,Kt.itemSize,Kt.normalized)}Kt.name!==void 0&&($t.name=Kt.name),Rt.push($t)}ot.morphAttributes[Pt]=Rt}o.data.morphTargetsRelative&&(ot.morphTargetsRelative=!0);const _t=o.data.groups||o.data.drawcalls||o.data.offsets;if(_t!==void 0)for(let Pt=0,Tt=_t.length;Pt!==Tt;++Pt){const Rt=_t[Pt];ot.addGroup(Rt.start,Rt.count,Rt.materialIndex)}const Mt=o.data.boundingSphere;if(Mt!==void 0){const Pt=new xn;Mt.center!==void 0&&Pt.fromArray(Mt.center),ot.boundingSphere=new _f(Pt,Mt.radius)}return o.name&&(ot.name=o.name),o.userData&&(ot.userData=o.userData),ot}}class BC extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=this,lt=this.path===""?c_.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||lt;const ht=new r0(this.manager);ht.setPath(this.path),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(this.withCredentials),ht.load(o,function(vt){let _t=null;try{_t=JSON.parse(vt)}catch(Pt){return tt!==void 0&&tt(Pt),void console.error("THREE:ObjectLoader: Can't parse "+o+".",Pt.message)}const Mt=_t.metadata;Mt!==void 0&&Mt.type!==void 0&&Mt.type.toLowerCase()!=="geometry"?ot.parse(_t,b):console.error("THREE.ObjectLoader: Can't load "+o)},et,tt)}async loadAsync(o,b){const et=this.path===""?c_.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||et;const tt=new r0(this.manager);tt.setPath(this.path),tt.setRequestHeader(this.requestHeader),tt.setWithCredentials(this.withCredentials);const ot=await tt.loadAsync(o,b),lt=JSON.parse(ot),ht=lt.metadata;if(ht===void 0||ht.type===void 0||ht.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+o);return await this.parseAsync(lt)}parse(o,b){const et=this.parseAnimations(o.animations),tt=this.parseShapes(o.shapes),ot=this.parseGeometries(o.geometries,tt),lt=this.parseImages(o.images,function(){b!==void 0&&b(_t)}),ht=this.parseTextures(o.textures,lt),vt=this.parseMaterials(o.materials,ht),_t=this.parseObject(o.object,ot,vt,ht,et),Mt=this.parseSkeletons(o.skeletons,_t);if(this.bindSkeletons(_t,Mt),b!==void 0){let Pt=!1;for(const Tt in lt)if(lt[Tt].data instanceof HTMLImageElement){Pt=!0;break}Pt===!1&&b(_t)}return _t}async parseAsync(o){const b=this.parseAnimations(o.animations),et=this.parseShapes(o.shapes),tt=this.parseGeometries(o.geometries,et),ot=await this.parseImagesAsync(o.images),lt=this.parseTextures(o.textures,ot),ht=this.parseMaterials(o.materials,lt),vt=this.parseObject(o.object,tt,ht,lt,b),_t=this.parseSkeletons(o.skeletons,vt);return this.bindSkeletons(vt,_t),vt}parseShapes(o){const b={};if(o!==void 0)for(let et=0,tt=o.length;et<tt;et++){const ot=new Wy().fromJSON(o[et]);b[ot.uuid]=ot}return b}parseSkeletons(o,b){const et={},tt={};if(b.traverse(function(ot){ot.isBone&&(tt[ot.uuid]=ot)}),o!==void 0)for(let ot=0,lt=o.length;ot<lt;ot++){const ht=new nx().fromJSON(o[ot],tt);et[ht.uuid]=ht}return et}parseGeometries(o,b){const et={};if(o!==void 0){const tt=new WT;for(let ot=0,lt=o.length;ot<lt;ot++){let ht;const vt=o[ot];switch(vt.type){case"BufferGeometry":case"InstancedBufferGeometry":ht=tt.parse(vt);break;default:vt.type in Xm?ht=Xm[vt.type].fromJSON(vt,b):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${vt.type}"`)}ht.uuid=vt.uuid,vt.name!==void 0&&(ht.name=vt.name),ht.isBufferGeometry===!0&&vt.userData!==void 0&&(ht.userData=vt.userData),et[vt.uuid]=ht}}return et}parseMaterials(o,b){const et={},tt={};if(o!==void 0){const ot=new s0;ot.setTextures(b);for(let lt=0,ht=o.length;lt<ht;lt++){const vt=o[lt];et[vt.uuid]===void 0&&(et[vt.uuid]=ot.parse(vt)),tt[vt.uuid]=et[vt.uuid]}}return tt}parseAnimations(o){const b={};if(o!==void 0)for(let et=0;et<o.length;et++){const tt=o[et],ot=Cx.parse(tt);b[ot.uuid]=ot}return b}parseImages(o,b){const et=this,tt={};let ot;function lt(ht){if(typeof ht=="string"){const vt=ht;return function(_t){return et.manager.itemStart(_t),ot.load(_t,function(){et.manager.itemEnd(_t)},void 0,function(){et.manager.itemError(_t),et.manager.itemEnd(_t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(vt)?vt:et.resourcePath+vt)}return ht.data?{data:k_(ht.type,ht.data),width:ht.width,height:ht.height,complete:!0}:null}if(o!==void 0&&o.length>0){const ht=new n0(b);ot=new iw(ht),ot.setCrossOrigin(this.crossOrigin);for(let vt=0,_t=o.length;vt<_t;vt++){const Mt=o[vt],Pt=Mt.url;if(Array.isArray(Pt)){const Tt=[];for(let Rt=0,Nt=Pt.length;Rt<Nt;Rt++){const kt=lt(Pt[Rt]);kt!==null&&(kt instanceof HTMLImageElement?Tt.push(kt):Tt.push(new YA(kt.data,kt.width,kt.height)))}tt[Mt.uuid]=new O_(Tt)}else{const Tt=lt(Mt.url);tt[Mt.uuid]=new O_(Tt)}}}return tt}async parseImagesAsync(o){const b=this,et={};let tt;async function ot(lt){if(typeof lt=="string"){const ht=lt,vt=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ht)?ht:b.resourcePath+ht;return await tt.loadAsync(vt)}return lt.data?{data:k_(lt.type,lt.data),width:lt.width,height:lt.height,complete:!0}:null}if(o!==void 0&&o.length>0){tt=new iw(this.manager),tt.setCrossOrigin(this.crossOrigin);for(let lt=0,ht=o.length;lt<ht;lt++){const vt=o[lt],_t=vt.url;if(Array.isArray(_t)){const Mt=[];for(let Pt=0,Tt=_t.length;Pt<Tt;Pt++){const Rt=_t[Pt],Nt=await ot(Rt);Nt!==null&&(Nt instanceof HTMLImageElement?Mt.push(Nt):Mt.push(new YA(Nt.data,Nt.width,Nt.height)))}et[vt.uuid]=new O_(Mt)}else{const Mt=await ot(vt.url);et[vt.uuid]=new O_(Mt)}}}return et}parseTextures(o,b){function et(ot,lt){return typeof ot=="number"?ot:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",ot),lt[ot])}const tt={};if(o!==void 0)for(let ot=0,lt=o.length;ot<lt;ot++){const ht=o[ot];ht.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',ht.uuid),b[ht.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",ht.image);const vt=b[ht.image],_t=vt?vt.data:void 0;let Mt;Array.isArray(_t)?(Mt=new UA,_t.length===6&&(Mt.needsUpdate=!0)):(Mt=_t&&_t.data?new YA:new vu,_t&&_t.complete&&(Mt.needsUpdate=!0)),Mt.source=vt,Mt.uuid=ht.uuid,ht.name!==void 0&&(Mt.name=ht.name),ht.mapping!==void 0&&(Mt.mapping=et(ht.mapping,_P)),ht.offset!==void 0&&Mt.offset.fromArray(ht.offset),ht.repeat!==void 0&&Mt.repeat.fromArray(ht.repeat),ht.center!==void 0&&Mt.center.fromArray(ht.center),ht.rotation!==void 0&&(Mt.rotation=ht.rotation),ht.wrap!==void 0&&(Mt.wrapS=et(ht.wrap[0],EE),Mt.wrapT=et(ht.wrap[1],EE)),ht.format!==void 0&&(Mt.format=ht.format),ht.type!==void 0&&(Mt.type=ht.type),ht.encoding!==void 0&&(Mt.encoding=ht.encoding),ht.minFilter!==void 0&&(Mt.minFilter=et(ht.minFilter,qT)),ht.magFilter!==void 0&&(Mt.magFilter=et(ht.magFilter,qT)),ht.anisotropy!==void 0&&(Mt.anisotropy=ht.anisotropy),ht.flipY!==void 0&&(Mt.flipY=ht.flipY),ht.premultiplyAlpha!==void 0&&(Mt.premultiplyAlpha=ht.premultiplyAlpha),ht.unpackAlignment!==void 0&&(Mt.unpackAlignment=ht.unpackAlignment),ht.userData!==void 0&&(Mt.userData=ht.userData),tt[ht.uuid]=Mt}return tt}parseObject(o,b,et,tt,ot){let lt,ht,vt;function _t(Tt){return b[Tt]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Tt),b[Tt]}function Mt(Tt){if(Tt!==void 0){if(Array.isArray(Tt)){const Rt=[];for(let Nt=0,kt=Tt.length;Nt<kt;Nt++){const Kt=Tt[Nt];et[Kt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Kt),Rt.push(et[Kt])}return Rt}return et[Tt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Tt),et[Tt]}}function Pt(Tt){return tt[Tt]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Tt),tt[Tt]}switch(o.type){case"Scene":lt=new wT,o.background!==void 0&&(Number.isInteger(o.background)?lt.background=new as(o.background):lt.background=Pt(o.background)),o.environment!==void 0&&(lt.environment=Pt(o.environment)),o.fog!==void 0&&(o.fog.type==="Fog"?lt.fog=new HA(o.fog.color,o.fog.near,o.fog.far):o.fog.type==="FogExp2"&&(lt.fog=new G0(o.fog.color,o.fog.density)));break;case"PerspectiveCamera":lt=new Zu(o.fov,o.aspect,o.near,o.far),o.focus!==void 0&&(lt.focus=o.focus),o.zoom!==void 0&&(lt.zoom=o.zoom),o.filmGauge!==void 0&&(lt.filmGauge=o.filmGauge),o.filmOffset!==void 0&&(lt.filmOffset=o.filmOffset),o.view!==void 0&&(lt.view=Object.assign({},o.view));break;case"OrthographicCamera":lt=new M1(o.left,o.right,o.top,o.bottom,o.near,o.far),o.zoom!==void 0&&(lt.zoom=o.zoom),o.view!==void 0&&(lt.view=Object.assign({},o.view));break;case"AmbientLight":lt=new GT(o.color,o.intensity);break;case"DirectionalLight":lt=new QT(o.color,o.intensity);break;case"PointLight":lt=new VT(o.color,o.intensity,o.distance,o.decay);break;case"RectAreaLight":lt=new HT(o.color,o.intensity,o.width,o.height);break;case"SpotLight":lt=new RC(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);break;case"HemisphereLight":lt=new zT(o.color,o.groundColor,o.intensity);break;case"LightProbe":lt=new bE().fromJSON(o);break;case"SkinnedMesh":ht=_t(o.geometry),vt=Mt(o.material),lt=new sC(ht,vt),o.bindMode!==void 0&&(lt.bindMode=o.bindMode),o.bindMatrix!==void 0&&lt.bindMatrix.fromArray(o.bindMatrix),o.skeleton!==void 0&&(lt.skeleton=o.skeleton);break;case"Mesh":ht=_t(o.geometry),vt=Mt(o.material),lt=new Nu(ht,vt);break;case"InstancedMesh":ht=_t(o.geometry),vt=Mt(o.material);const Tt=o.count,Rt=o.instanceMatrix,Nt=o.instanceColor;lt=new eE(ht,vt,Tt),lt.instanceMatrix=new Gy(new Float32Array(Rt.array),16),Nt!==void 0&&(lt.instanceColor=new Gy(new Float32Array(Nt.array),Nt.itemSize));break;case"LOD":lt=new qA;break;case"Line":lt=new s_(_t(o.geometry),Mt(o.material));break;case"LineLoop":lt=new XA(_t(o.geometry),Mt(o.material));break;case"LineSegments":lt=new o_(_t(o.geometry),Mt(o.material));break;case"PointCloud":case"Points":lt=new oE(_t(o.geometry),Mt(o.material));break;case"Sprite":lt=new J1(Mt(o.material));break;case"Group":lt=new W_;break;case"Bone":lt=new oC;break;default:lt=new Zs}if(lt.uuid=o.uuid,o.name!==void 0&&(lt.name=o.name),o.matrix!==void 0?(lt.matrix.fromArray(o.matrix),o.matrixAutoUpdate!==void 0&&(lt.matrixAutoUpdate=o.matrixAutoUpdate),lt.matrixAutoUpdate&&lt.matrix.decompose(lt.position,lt.quaternion,lt.scale)):(o.position!==void 0&&lt.position.fromArray(o.position),o.rotation!==void 0&&lt.rotation.fromArray(o.rotation),o.quaternion!==void 0&&lt.quaternion.fromArray(o.quaternion),o.scale!==void 0&&lt.scale.fromArray(o.scale)),o.castShadow!==void 0&&(lt.castShadow=o.castShadow),o.receiveShadow!==void 0&&(lt.receiveShadow=o.receiveShadow),o.shadow&&(o.shadow.bias!==void 0&&(lt.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(lt.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(lt.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&lt.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(lt.shadow.camera=this.parseObject(o.shadow.camera))),o.visible!==void 0&&(lt.visible=o.visible),o.frustumCulled!==void 0&&(lt.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(lt.renderOrder=o.renderOrder),o.userData!==void 0&&(lt.userData=o.userData),o.layers!==void 0&&(lt.layers.mask=o.layers),o.children!==void 0){const Tt=o.children;for(let Rt=0;Rt<Tt.length;Rt++)lt.add(this.parseObject(Tt[Rt],b,et,tt,ot))}if(o.animations!==void 0){const Tt=o.animations;for(let Rt=0;Rt<Tt.length;Rt++){const Nt=Tt[Rt];lt.animations.push(ot[Nt])}}if(o.type==="LOD"){o.autoUpdate!==void 0&&(lt.autoUpdate=o.autoUpdate);const Tt=o.levels;for(let Rt=0;Rt<Tt.length;Rt++){const Nt=Tt[Rt],kt=lt.getObjectByProperty("uuid",Nt.object);kt!==void 0&&lt.addLevel(kt,Nt.distance)}}return lt}bindSkeletons(o,b){Object.keys(b).length!==0&&o.traverse(function(et){if(et.isSkinnedMesh===!0&&et.skeleton!==void 0){const tt=b[et.skeleton];tt===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",et.skeleton):et.bind(tt,et.bindMatrix)}})}}const _P={UVMapping:Bl,CubeReflectionMapping:Oo,CubeRefractionMapping:Mo,EquirectangularReflectionMapping:To,EquirectangularRefractionMapping:Io,CubeUVReflectionMapping:Hl},EE={RepeatWrapping:vo,ClampToEdgeWrapping:no,MirroredRepeatWrapping:Al},qT={NearestFilter:qo,NearestMipmapNearestFilter:Lo,NearestMipmapLinearFilter:Yo,LinearFilter:Vo,LinearMipmapNearestFilter:Mu,LinearMipmapLinearFilter:hs};class OC extends Uu{constructor(o){super(o),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(o){return this.options=o,this}load(o,b,et,tt){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const ot=this,lt=t0.get(o);if(lt!==void 0)return ot.manager.itemStart(o),setTimeout(function(){b&&b(lt),ot.manager.itemEnd(o)},0),lt;const ht={};ht.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",ht.headers=this.requestHeader,fetch(o,ht).then(function(vt){return vt.blob()}).then(function(vt){return createImageBitmap(vt,Object.assign(ot.options,{colorSpaceConversion:"none"}))}).then(function(vt){t0.add(o,vt),b&&b(vt),ot.manager.itemEnd(o)}).catch(function(vt){tt&&tt(vt),ot.manager.itemError(o),ot.manager.itemEnd(o)}),ot.manager.itemStart(o)}}let SE;const Rx={getContext:function(){return SE===void 0&&(SE=new(window.AudioContext||window.webkitAudioContext)),SE},setContext:function(dt){SE=dt}};class yP extends Uu{constructor(o){super(o)}load(o,b,et,tt){const ot=this,lt=new r0(this.manager);lt.setResponseType("arraybuffer"),lt.setPath(this.path),lt.setRequestHeader(this.requestHeader),lt.setWithCredentials(this.withCredentials),lt.load(o,function(ht){try{const vt=ht.slice(0);Rx.getContext().decodeAudioData(vt,function(_t){b(_t)})}catch(vt){tt?tt(vt):console.error(vt),ot.manager.itemError(o)}},et,tt)}}class LC extends bE{constructor(o,b,et=1){super(void 0,et),this.isHemisphereLightProbe=!0;const tt=new as().set(o),ot=new as().set(b),lt=new xn(tt.r,tt.g,tt.b),ht=new xn(ot.r,ot.g,ot.b),vt=Math.sqrt(Math.PI),_t=vt*Math.sqrt(.75);this.sh.coefficients[0].copy(lt).add(ht).multiplyScalar(vt),this.sh.coefficients[1].copy(lt).sub(ht).multiplyScalar(_t)}}class CE extends bE{constructor(o,b=1){super(void 0,b),this.isAmbientLightProbe=!0;const et=new as().set(o);this.sh.coefficients[0].set(et.r,et.g,et.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const sw=new zs,ME=new zs,o0=new zs;class Jy{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zu,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zu,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(o){const b=this._cache;if(b.focus!==o.focus||b.fov!==o.fov||b.aspect!==o.aspect*this.aspect||b.near!==o.near||b.far!==o.far||b.zoom!==o.zoom||b.eyeSep!==this.eyeSep){b.focus=o.focus,b.fov=o.fov,b.aspect=o.aspect*this.aspect,b.near=o.near,b.far=o.far,b.zoom=o.zoom,b.eyeSep=this.eyeSep,o0.copy(o.projectionMatrix);const et=b.eyeSep/2,tt=et*b.near/b.focus,ot=b.near*Math.tan(R_*b.fov*.5)/b.zoom;let lt,ht;ME.elements[12]=-et,sw.elements[12]=et,lt=-ot*b.aspect+tt,ht=ot*b.aspect+tt,o0.elements[0]=2*b.near/(ht-lt),o0.elements[8]=(ht+lt)/(ht-lt),this.cameraL.projectionMatrix.copy(o0),lt=-ot*b.aspect-tt,ht=ot*b.aspect-tt,o0.elements[0]=2*b.near/(ht-lt),o0.elements[8]=(ht+lt)/(ht-lt),this.cameraR.projectionMatrix.copy(o0)}this.cameraL.matrixWorld.copy(o.matrixWorld).multiply(ME),this.cameraR.matrixWorld.copy(o.matrixWorld).multiply(sw)}}class TE{constructor(o=!0){this.autoStart=o,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=YT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let o=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const b=YT();o=(b-this.oldTime)/1e3,this.oldTime=b,this.elapsedTime+=o}return o}}function YT(){return(typeof performance>"u"?Date:performance).now()}const Z0=new xn,a0=new ku,AP=new xn,Mp=new xn;class XT extends Zs{constructor(){super(),this.type="AudioListener",this.context=Rx.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new TE}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(o){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=o,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}updateMatrixWorld(o){super.updateMatrixWorld(o);const b=this.context.listener,et=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Z0,a0,AP),Mp.set(0,0,-1).applyQuaternion(a0),b.positionX){const tt=this.context.currentTime+this.timeDelta;b.positionX.linearRampToValueAtTime(Z0.x,tt),b.positionY.linearRampToValueAtTime(Z0.y,tt),b.positionZ.linearRampToValueAtTime(Z0.z,tt),b.forwardX.linearRampToValueAtTime(Mp.x,tt),b.forwardY.linearRampToValueAtTime(Mp.y,tt),b.forwardZ.linearRampToValueAtTime(Mp.z,tt),b.upX.linearRampToValueAtTime(et.x,tt),b.upY.linearRampToValueAtTime(et.y,tt),b.upZ.linearRampToValueAtTime(et.z,tt)}else b.setPosition(Z0.x,Z0.y,Z0.z),b.setOrientation(Mp.x,Mp.y,Mp.z,et.x,et.y,et.z)}}class l0 extends Zs{constructor(o){super(),this.type="Audio",this.listener=o,this.context=o.context,this.gain=this.context.createGain(),this.gain.connect(o.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(o){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=o,this.connect(),this}setMediaElementSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(o),this.connect(),this}setMediaStreamSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(o),this.connect(),this}setBuffer(o){return this.buffer=o,this.sourceType="buffer",this.autoplay&&this.play(),this}play(o=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+o;const b=this.context.createBufferSource();return b.buffer=this.buffer,b.loop=this.loop,b.loopStart=this.loopStart,b.loopEnd=this.loopEnd,b.onended=this.onEnded.bind(this),b.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=b,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let o=1,b=this.filters.length;o<b;o++)this.filters[o-1].connect(this.filters[o]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let o=1,b=this.filters.length;o<b;o++)this.filters[o-1].disconnect(this.filters[o]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(o){return o||(o=[]),this._connected===!0?(this.disconnect(),this.filters=o.slice(),this.connect()):this.filters=o.slice(),this}setDetune(o){if(this.detune=o,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(o){return this.setFilters(o?[o]:[])}setPlaybackRate(o){if(this.hasPlaybackControl!==!1)return this.playbackRate=o,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(o){if(this.hasPlaybackControl!==!1)return this.loop=o,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(o){return this.loopStart=o,this}setLoopEnd(o){return this.loopEnd=o,this}getVolume(){return this.gain.gain.value}setVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}}const ey=new xn,IE=new ku,kx=new xn,Dv=new xn;class KT extends l0{constructor(o){super(o),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(o){return this.panner.refDistance=o,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(o){return this.panner.rolloffFactor=o,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(o){return this.panner.distanceModel=o,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(o){return this.panner.maxDistance=o,this}setDirectionalCone(o,b,et){return this.panner.coneInnerAngle=o,this.panner.coneOuterAngle=b,this.panner.coneOuterGain=et,this}updateMatrixWorld(o){if(super.updateMatrixWorld(o),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ey,IE,kx),Dv.set(0,0,1).applyQuaternion(IE);const b=this.panner;if(b.positionX){const et=this.context.currentTime+this.listener.timeDelta;b.positionX.linearRampToValueAtTime(ey.x,et),b.positionY.linearRampToValueAtTime(ey.y,et),b.positionZ.linearRampToValueAtTime(ey.z,et),b.orientationX.linearRampToValueAtTime(Dv.x,et),b.orientationY.linearRampToValueAtTime(Dv.y,et),b.orientationZ.linearRampToValueAtTime(Dv.z,et)}else b.setPosition(ey.x,ey.y,ey.z),b.setOrientation(Dv.x,Dv.y,Dv.z)}}class ty{constructor(o,b=2048){this.analyser=o.context.createAnalyser(),this.analyser.fftSize=b,this.data=new Uint8Array(this.analyser.frequencyBinCount),o.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let o=0;const b=this.getFrequencyData();for(let et=0;et<b.length;et++)o+=b[et];return o/b.length}}class Bx{constructor(o,b,et){let tt,ot,lt;switch(this.binding=o,this.valueSize=et,b){case"quaternion":tt=this._slerp,ot=this._slerpAdditive,lt=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*et),this._workIndex=5;break;case"string":case"bool":tt=this._select,ot=this._select,lt=this._setAdditiveIdentityOther,this.buffer=new Array(5*et);break;default:tt=this._lerp,ot=this._lerpAdditive,lt=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*et)}this._mixBufferRegion=tt,this._mixBufferRegionAdditive=ot,this._setIdentity=lt,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(o,b){const et=this.buffer,tt=this.valueSize,ot=o*tt+tt;let lt=this.cumulativeWeight;if(lt===0){for(let ht=0;ht!==tt;++ht)et[ot+ht]=et[ht];lt=b}else{lt+=b;const ht=b/lt;this._mixBufferRegion(et,ot,0,ht,tt)}this.cumulativeWeight=lt}accumulateAdditive(o){const b=this.buffer,et=this.valueSize,tt=et*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(b,tt,0,o,et),this.cumulativeWeightAdditive+=o}apply(o){const b=this.valueSize,et=this.buffer,tt=o*b+b,ot=this.cumulativeWeight,lt=this.cumulativeWeightAdditive,ht=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,ot<1){const vt=b*this._origIndex;this._mixBufferRegion(et,tt,vt,1-ot,b)}lt>0&&this._mixBufferRegionAdditive(et,tt,this._addIndex*b,1,b);for(let vt=b,_t=b+b;vt!==_t;++vt)if(et[vt]!==et[vt+b]){ht.setValue(et,tt);break}}saveOriginalState(){const o=this.binding,b=this.buffer,et=this.valueSize,tt=et*this._origIndex;o.getValue(b,tt);for(let ot=et,lt=tt;ot!==lt;++ot)b[ot]=b[tt+ot%et];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const o=3*this.valueSize;this.binding.setValue(this.buffer,o)}_setAdditiveIdentityNumeric(){const o=this._addIndex*this.valueSize,b=o+this.valueSize;for(let et=o;et<b;et++)this.buffer[et]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const o=this._origIndex*this.valueSize,b=this._addIndex*this.valueSize;for(let et=0;et<this.valueSize;et++)this.buffer[b+et]=this.buffer[o+et]}_select(o,b,et,tt,ot){if(tt>=.5)for(let lt=0;lt!==ot;++lt)o[b+lt]=o[et+lt]}_slerp(o,b,et,tt){ku.slerpFlat(o,b,o,b,o,et,tt)}_slerpAdditive(o,b,et,tt,ot){const lt=this._workIndex*ot;ku.multiplyQuaternionsFlat(o,lt,o,b,o,et),ku.slerpFlat(o,b,o,b,o,lt,tt)}_lerp(o,b,et,tt,ot){const lt=1-tt;for(let ht=0;ht!==ot;++ht){const vt=b+ht;o[vt]=o[vt]*lt+o[et+ht]*tt}}_lerpAdditive(o,b,et,tt,ot){for(let lt=0;lt!==ot;++lt){const ht=b+lt;o[ht]=o[ht]+o[et+lt]*tt}}}const Ox=new RegExp("[\\[\\]\\.:\\/]","g"),ow="[^\\[\\]\\.:\\/]",aw="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",PE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",ow)+/(WCOD+)?/.source.replace("WCOD",aw)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ow)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ow)+"$"),Lx=["material","materials","bones","map"];class Po{constructor(o,b,et){this.path=b,this.parsedPath=et||Po.parseTrackName(b),this.node=Po.findNode(o,this.parsedPath.nodeName)||o,this.rootNode=o,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(o,b,et){return o&&o.isAnimationObjectGroup?new Po.Composite(o,b,et):new Po(o,b,et)}static sanitizeNodeName(o){return o.replace(/\s/g,"_").replace(Ox,"")}static parseTrackName(o){const b=PE.exec(o);if(b===null)throw new Error("PropertyBinding: Cannot parse trackName: "+o);const et={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]},tt=et.nodeName&&et.nodeName.lastIndexOf(".");if(tt!==void 0&&tt!==-1){const ot=et.nodeName.substring(tt+1);Lx.indexOf(ot)!==-1&&(et.nodeName=et.nodeName.substring(0,tt),et.objectName=ot)}if(et.propertyName===null||et.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return et}static findNode(o,b){if(b===void 0||b===""||b==="."||b===-1||b===o.name||b===o.uuid)return o;if(o.skeleton){const et=o.skeleton.getBoneByName(b);if(et!==void 0)return et}if(o.children){const et=function(ot){for(let lt=0;lt<ot.length;lt++){const ht=ot[lt];if(ht.name===b||ht.uuid===b)return ht;const vt=et(ht.children);if(vt)return vt}return null},tt=et(o.children);if(tt)return tt}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(o,b){o[b]=this.targetObject[this.propertyName]}_getValue_array(o,b){const et=this.resolvedProperty;for(let tt=0,ot=et.length;tt!==ot;++tt)o[b++]=et[tt]}_getValue_arrayElement(o,b){o[b]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(o,b){this.resolvedProperty.toArray(o,b)}_setValue_direct(o,b){this.targetObject[this.propertyName]=o[b]}_setValue_direct_setNeedsUpdate(o,b){this.targetObject[this.propertyName]=o[b],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(o,b){this.targetObject[this.propertyName]=o[b],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(o,b){const et=this.resolvedProperty;for(let tt=0,ot=et.length;tt!==ot;++tt)et[tt]=o[b++]}_setValue_array_setNeedsUpdate(o,b){const et=this.resolvedProperty;for(let tt=0,ot=et.length;tt!==ot;++tt)et[tt]=o[b++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(o,b){const et=this.resolvedProperty;for(let tt=0,ot=et.length;tt!==ot;++tt)et[tt]=o[b++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(o,b){this.resolvedProperty[this.propertyIndex]=o[b]}_setValue_arrayElement_setNeedsUpdate(o,b){this.resolvedProperty[this.propertyIndex]=o[b],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(o,b){this.resolvedProperty[this.propertyIndex]=o[b],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(o,b){this.resolvedProperty.fromArray(o,b)}_setValue_fromArray_setNeedsUpdate(o,b){this.resolvedProperty.fromArray(o,b),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(o,b){this.resolvedProperty.fromArray(o,b),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(o,b){this.bind(),this.getValue(o,b)}_setValue_unbound(o,b){this.bind(),this.setValue(o,b)}bind(){let o=this.node;const b=this.parsedPath,et=b.objectName,tt=b.propertyName;let ot=b.propertyIndex;if(o||(o=Po.findNode(this.rootNode,b.nodeName)||this.rootNode,this.node=o),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!o)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(et){let _t=b.objectIndex;switch(et){case"materials":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);o=o.material.materials;break;case"bones":if(!o.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);o=o.skeleton.bones;for(let Mt=0;Mt<o.length;Mt++)if(o[Mt].name===_t){_t=Mt;break}break;case"map":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);o=o.material.map;break;default:if(o[et]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);o=o[et]}if(_t!==void 0){if(o[_t]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,o);o=o[_t]}}const lt=o[tt];if(lt===void 0){const _t=b.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+_t+"."+tt+" but it wasn't found.",o)}let ht=this.Versioning.None;this.targetObject=o,o.needsUpdate!==void 0?ht=this.Versioning.NeedsUpdate:o.matrixWorldNeedsUpdate!==void 0&&(ht=this.Versioning.MatrixWorldNeedsUpdate);let vt=this.BindingType.Direct;if(ot!==void 0){if(tt==="morphTargetInfluences"){if(!o.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!o.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);o.morphTargetDictionary[ot]!==void 0&&(ot=o.morphTargetDictionary[ot])}vt=this.BindingType.ArrayElement,this.resolvedProperty=lt,this.propertyIndex=ot}else lt.fromArray!==void 0&&lt.toArray!==void 0?(vt=this.BindingType.HasFromToArray,this.resolvedProperty=lt):Array.isArray(lt)?(vt=this.BindingType.EntireArray,this.resolvedProperty=lt):this.propertyName=tt;this.getValue=this.GetterByBindingType[vt],this.setValue=this.SetterByBindingTypeAndVersioning[vt][ht]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Po.Composite=class{constructor(dt,o,b){const et=b||Po.parseTrackName(o);this._targetGroup=dt,this._bindings=dt.subscribe_(o,et)}getValue(dt,o){this.bind();const b=this._targetGroup.nCachedObjects_,et=this._bindings[b];et!==void 0&&et.getValue(dt,o)}setValue(dt,o){const b=this._bindings;for(let et=this._targetGroup.nCachedObjects_,tt=b.length;et!==tt;++et)b[et].setValue(dt,o)}bind(){const dt=this._bindings;for(let o=this._targetGroup.nCachedObjects_,b=dt.length;o!==b;++o)dt[o].bind()}unbind(){const dt=this._bindings;for(let o=this._targetGroup.nCachedObjects_,b=dt.length;o!==b;++o)dt[o].unbind()}},Po.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Po.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Po.prototype.GetterByBindingType=[Po.prototype._getValue_direct,Po.prototype._getValue_array,Po.prototype._getValue_arrayElement,Po.prototype._getValue_toArray],Po.prototype.SetterByBindingTypeAndVersioning=[[Po.prototype._setValue_direct,Po.prototype._setValue_direct_setNeedsUpdate,Po.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Po.prototype._setValue_array,Po.prototype._setValue_array_setNeedsUpdate,Po.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Po.prototype._setValue_arrayElement,Po.prototype._setValue_arrayElement_setNeedsUpdate,Po.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Po.prototype._setValue_fromArray,Po.prototype._setValue_fromArray_setNeedsUpdate,Po.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Zy{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Xu(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const o={};this._indicesByUUID=o;for(let et=0,tt=arguments.length;et!==tt;++et)o[arguments[et].uuid]=et;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const b=this;this.stats={objects:{get total(){return b._objects.length},get inUse(){return this.total-b.nCachedObjects_}},get bindingsPerObject(){return b._bindings.length}}}add(){const o=this._objects,b=this._indicesByUUID,et=this._paths,tt=this._parsedPaths,ot=this._bindings,lt=ot.length;let ht,vt=o.length,_t=this.nCachedObjects_;for(let Mt=0,Pt=arguments.length;Mt!==Pt;++Mt){const Tt=arguments[Mt],Rt=Tt.uuid;let Nt=b[Rt];if(Nt===void 0){Nt=vt++,b[Rt]=Nt,o.push(Tt);for(let kt=0,Kt=lt;kt!==Kt;++kt)ot[kt].push(new Po(Tt,et[kt],tt[kt]))}else if(Nt<_t){ht=o[Nt];const kt=--_t,Kt=o[kt];b[Kt.uuid]=Nt,o[Nt]=Kt,b[Rt]=kt,o[kt]=Tt;for(let $t=0,en=lt;$t!==en;++$t){const ln=ot[$t],gn=ln[kt];let _n=ln[Nt];ln[Nt]=gn,_n===void 0&&(_n=new Po(Tt,et[$t],tt[$t])),ln[kt]=_n}}else o[Nt]!==ht&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=_t}remove(){const o=this._objects,b=this._indicesByUUID,et=this._bindings,tt=et.length;let ot=this.nCachedObjects_;for(let lt=0,ht=arguments.length;lt!==ht;++lt){const vt=arguments[lt],_t=vt.uuid,Mt=b[_t];if(Mt!==void 0&&Mt>=ot){const Pt=ot++,Tt=o[Pt];b[Tt.uuid]=Mt,o[Mt]=Tt,b[_t]=Pt,o[Pt]=vt;for(let Rt=0,Nt=tt;Rt!==Nt;++Rt){const kt=et[Rt],Kt=kt[Pt],$t=kt[Mt];kt[Mt]=Kt,kt[Pt]=$t}}}this.nCachedObjects_=ot}uncache(){const o=this._objects,b=this._indicesByUUID,et=this._bindings,tt=et.length;let ot=this.nCachedObjects_,lt=o.length;for(let ht=0,vt=arguments.length;ht!==vt;++ht){const _t=arguments[ht].uuid,Mt=b[_t];if(Mt!==void 0)if(delete b[_t],Mt<ot){const Pt=--ot,Tt=o[Pt],Rt=--lt,Nt=o[Rt];b[Tt.uuid]=Mt,o[Mt]=Tt,b[Nt.uuid]=Pt,o[Pt]=Nt,o.pop();for(let kt=0,Kt=tt;kt!==Kt;++kt){const $t=et[kt],en=$t[Pt],ln=$t[Rt];$t[Mt]=en,$t[Pt]=ln,$t.pop()}}else{const Pt=--lt,Tt=o[Pt];Pt>0&&(b[Tt.uuid]=Mt),o[Mt]=Tt,o.pop();for(let Rt=0,Nt=tt;Rt!==Nt;++Rt){const kt=et[Rt];kt[Mt]=kt[Pt],kt.pop()}}}this.nCachedObjects_=ot}subscribe_(o,b){const et=this._bindingsIndicesByPath;let tt=et[o];const ot=this._bindings;if(tt!==void 0)return ot[tt];const lt=this._paths,ht=this._parsedPaths,vt=this._objects,_t=vt.length,Mt=this.nCachedObjects_,Pt=new Array(_t);tt=ot.length,et[o]=tt,lt.push(o),ht.push(b),ot.push(Pt);for(let Tt=Mt,Rt=vt.length;Tt!==Rt;++Tt){const Nt=vt[Tt];Pt[Tt]=new Po(Nt,o,b)}return Pt}unsubscribe_(o){const b=this._bindingsIndicesByPath,et=b[o];if(et!==void 0){const tt=this._paths,ot=this._parsedPaths,lt=this._bindings,ht=lt.length-1,vt=lt[ht];b[o[ht]]=et,lt[et]=vt,lt.pop(),ot[et]=ot[ht],ot.pop(),tt[et]=tt[ht],tt.pop()}}}class DE{constructor(o,b,et=null,tt=b.blendMode){this._mixer=o,this._clip=b,this._localRoot=et,this.blendMode=tt;const ot=b.tracks,lt=ot.length,ht=new Array(lt),vt={endingStart:gu,endingEnd:gu};for(let _t=0;_t!==lt;++_t){const Mt=ot[_t].createInterpolant(null);ht[_t]=Mt,Mt.settings=vt}this._interpolantSettings=vt,this._interpolants=ht,this._propertyBindings=new Array(lt),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=vA,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(o){return this._startTime=o,this}setLoop(o,b){return this.loop=o,this.repetitions=b,this}setEffectiveWeight(o){return this.weight=o,this._effectiveWeight=this.enabled?o:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(o){return this._scheduleFading(o,0,1)}fadeOut(o){return this._scheduleFading(o,1,0)}crossFadeFrom(o,b,et){if(o.fadeOut(b),this.fadeIn(b),et){const tt=this._clip.duration,ot=o._clip.duration,lt=ot/tt,ht=tt/ot;o.warp(1,lt,b),this.warp(ht,1,b)}return this}crossFadeTo(o,b,et){return o.crossFadeFrom(this,b,et)}stopFading(){const o=this._weightInterpolant;return o!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}setEffectiveTimeScale(o){return this.timeScale=o,this._effectiveTimeScale=this.paused?0:o,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(o){return this.timeScale=this._clip.duration/o,this.stopWarping()}syncWith(o){return this.time=o.time,this.timeScale=o.timeScale,this.stopWarping()}halt(o){return this.warp(this._effectiveTimeScale,0,o)}warp(o,b,et){const tt=this._mixer,ot=tt.time,lt=this.timeScale;let ht=this._timeScaleInterpolant;ht===null&&(ht=tt._lendControlInterpolant(),this._timeScaleInterpolant=ht);const vt=ht.parameterPositions,_t=ht.sampleValues;return vt[0]=ot,vt[1]=ot+et,_t[0]=o/lt,_t[1]=b/lt,this}stopWarping(){const o=this._timeScaleInterpolant;return o!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(o,b,et,tt){if(!this.enabled)return void this._updateWeight(o);const ot=this._startTime;if(ot!==null){const vt=(o-ot)*et;vt<0||et===0?b=0:(this._startTime=null,b=et*vt)}b*=this._updateTimeScale(o);const lt=this._updateTime(b),ht=this._updateWeight(o);if(ht>0){const vt=this._interpolants,_t=this._propertyBindings;if(this.blendMode===_A)for(let Mt=0,Pt=vt.length;Mt!==Pt;++Mt)vt[Mt].evaluate(lt),_t[Mt].accumulateAdditive(ht);else for(let Mt=0,Pt=vt.length;Mt!==Pt;++Mt)vt[Mt].evaluate(lt),_t[Mt].accumulate(tt,ht)}}_updateWeight(o){let b=0;if(this.enabled){b=this.weight;const et=this._weightInterpolant;if(et!==null){const tt=et.evaluate(o)[0];b*=tt,o>et.parameterPositions[1]&&(this.stopFading(),tt===0&&(this.enabled=!1))}}return this._effectiveWeight=b,b}_updateTimeScale(o){let b=0;if(!this.paused){b=this.timeScale;const et=this._timeScaleInterpolant;et!==null&&(b*=et.evaluate(o)[0],o>et.parameterPositions[1]&&(this.stopWarping(),b===0?this.paused=!0:this.timeScale=b))}return this._effectiveTimeScale=b,b}_updateTime(o){const b=this._clip.duration,et=this.loop;let tt=this.time+o,ot=this._loopCount;const lt=et===b_;if(o===0)return ot===-1?tt:lt&&(1&ot)==1?b-tt:tt;if(et===Ap){ot===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(tt>=b)tt=b;else{if(!(tt<0)){this.time=tt;break e}tt=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=tt,this._mixer.dispatchEvent({type:"finished",action:this,direction:o<0?-1:1})}}else{if(ot===-1&&(o>=0?(ot=0,this._setEndings(!0,this.repetitions===0,lt)):this._setEndings(this.repetitions===0,!0,lt)),tt>=b||tt<0){const ht=Math.floor(tt/b);tt-=b*ht,ot+=Math.abs(ht);const vt=this.repetitions-ot;if(vt<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,tt=o>0?b:0,this.time=tt,this._mixer.dispatchEvent({type:"finished",action:this,direction:o>0?1:-1});else{if(vt===1){const _t=o<0;this._setEndings(_t,!_t,lt)}else this._setEndings(!1,!1,lt);this._loopCount=ot,this.time=tt,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:ht})}}else this.time=tt;if(lt&&(1&ot)==1)return b-tt}return tt}_setEndings(o,b,et){const tt=this._interpolantSettings;et?(tt.endingStart=Wp,tt.endingEnd=Wp):(tt.endingStart=o?this.zeroSlopeAtStart?Wp:gu:S_,tt.endingEnd=b?this.zeroSlopeAtEnd?Wp:gu:S_)}_scheduleFading(o,b,et){const tt=this._mixer,ot=tt.time;let lt=this._weightInterpolant;lt===null&&(lt=tt._lendControlInterpolant(),this._weightInterpolant=lt);const ht=lt.parameterPositions,vt=lt.sampleValues;return ht[0]=ot,vt[0]=b,ht[1]=ot+o,vt[1]=et,this}}const RE=new Float32Array(1);class NC extends js{constructor(o){super(),this._root=o,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(o,b){const et=o._localRoot||this._root,tt=o._clip.tracks,ot=tt.length,lt=o._propertyBindings,ht=o._interpolants,vt=et.uuid,_t=this._bindingsByRootAndName;let Mt=_t[vt];Mt===void 0&&(Mt={},_t[vt]=Mt);for(let Pt=0;Pt!==ot;++Pt){const Tt=tt[Pt],Rt=Tt.name;let Nt=Mt[Rt];if(Nt!==void 0)++Nt.referenceCount,lt[Pt]=Nt;else{if(Nt=lt[Pt],Nt!==void 0){Nt._cacheIndex===null&&(++Nt.referenceCount,this._addInactiveBinding(Nt,vt,Rt));continue}const kt=b&&b._propertyBindings[Pt].binding.parsedPath;Nt=new Bx(Po.create(et,Rt,kt),Tt.ValueTypeName,Tt.getValueSize()),++Nt.referenceCount,this._addInactiveBinding(Nt,vt,Rt),lt[Pt]=Nt}ht[Pt].resultBuffer=Nt.buffer}}_activateAction(o){if(!this._isActiveAction(o)){if(o._cacheIndex===null){const et=(o._localRoot||this._root).uuid,tt=o._clip.uuid,ot=this._actionsByClip[tt];this._bindAction(o,ot&&ot.knownActions[0]),this._addInactiveAction(o,tt,et)}const b=o._propertyBindings;for(let et=0,tt=b.length;et!==tt;++et){const ot=b[et];ot.useCount++==0&&(this._lendBinding(ot),ot.saveOriginalState())}this._lendAction(o)}}_deactivateAction(o){if(this._isActiveAction(o)){const b=o._propertyBindings;for(let et=0,tt=b.length;et!==tt;++et){const ot=b[et];--ot.useCount==0&&(ot.restoreOriginalState(),this._takeBackBinding(ot))}this._takeBackAction(o)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const o=this;this.stats={actions:{get total(){return o._actions.length},get inUse(){return o._nActiveActions}},bindings:{get total(){return o._bindings.length},get inUse(){return o._nActiveBindings}},controlInterpolants:{get total(){return o._controlInterpolants.length},get inUse(){return o._nActiveControlInterpolants}}}}_isActiveAction(o){const b=o._cacheIndex;return b!==null&&b<this._nActiveActions}_addInactiveAction(o,b,et){const tt=this._actions,ot=this._actionsByClip;let lt=ot[b];if(lt===void 0)lt={knownActions:[o],actionByRoot:{}},o._byClipCacheIndex=0,ot[b]=lt;else{const ht=lt.knownActions;o._byClipCacheIndex=ht.length,ht.push(o)}o._cacheIndex=tt.length,tt.push(o),lt.actionByRoot[et]=o}_removeInactiveAction(o){const b=this._actions,et=b[b.length-1],tt=o._cacheIndex;et._cacheIndex=tt,b[tt]=et,b.pop(),o._cacheIndex=null;const ot=o._clip.uuid,lt=this._actionsByClip,ht=lt[ot],vt=ht.knownActions,_t=vt[vt.length-1],Mt=o._byClipCacheIndex;_t._byClipCacheIndex=Mt,vt[Mt]=_t,vt.pop(),o._byClipCacheIndex=null,delete ht.actionByRoot[(o._localRoot||this._root).uuid],vt.length===0&&delete lt[ot],this._removeInactiveBindingsForAction(o)}_removeInactiveBindingsForAction(o){const b=o._propertyBindings;for(let et=0,tt=b.length;et!==tt;++et){const ot=b[et];--ot.referenceCount==0&&this._removeInactiveBinding(ot)}}_lendAction(o){const b=this._actions,et=o._cacheIndex,tt=this._nActiveActions++,ot=b[tt];o._cacheIndex=tt,b[tt]=o,ot._cacheIndex=et,b[et]=ot}_takeBackAction(o){const b=this._actions,et=o._cacheIndex,tt=--this._nActiveActions,ot=b[tt];o._cacheIndex=tt,b[tt]=o,ot._cacheIndex=et,b[et]=ot}_addInactiveBinding(o,b,et){const tt=this._bindingsByRootAndName,ot=this._bindings;let lt=tt[b];lt===void 0&&(lt={},tt[b]=lt),lt[et]=o,o._cacheIndex=ot.length,ot.push(o)}_removeInactiveBinding(o){const b=this._bindings,et=o.binding,tt=et.rootNode.uuid,ot=et.path,lt=this._bindingsByRootAndName,ht=lt[tt],vt=b[b.length-1],_t=o._cacheIndex;vt._cacheIndex=_t,b[_t]=vt,b.pop(),delete ht[ot],Object.keys(ht).length===0&&delete lt[tt]}_lendBinding(o){const b=this._bindings,et=o._cacheIndex,tt=this._nActiveBindings++,ot=b[tt];o._cacheIndex=tt,b[tt]=o,ot._cacheIndex=et,b[et]=ot}_takeBackBinding(o){const b=this._bindings,et=o._cacheIndex,tt=--this._nActiveBindings,ot=b[tt];o._cacheIndex=tt,b[tt]=o,ot._cacheIndex=et,b[et]=ot}_lendControlInterpolant(){const o=this._controlInterpolants,b=this._nActiveControlInterpolants++;let et=o[b];return et===void 0&&(et=new MC(new Float32Array(2),new Float32Array(2),1,RE),et.__cacheIndex=b,o[b]=et),et}_takeBackControlInterpolant(o){const b=this._controlInterpolants,et=o.__cacheIndex,tt=--this._nActiveControlInterpolants,ot=b[tt];o.__cacheIndex=tt,b[tt]=o,ot.__cacheIndex=et,b[et]=ot}clipAction(o,b,et){const tt=b||this._root,ot=tt.uuid;let lt=typeof o=="string"?Cx.findByName(tt,o):o;const ht=lt!==null?lt.uuid:o,vt=this._actionsByClip[ht];let _t=null;if(et===void 0&&(et=lt!==null?lt.blendMode:Ml),vt!==void 0){const Pt=vt.actionByRoot[ot];if(Pt!==void 0&&Pt.blendMode===et)return Pt;_t=vt.knownActions[0],lt===null&&(lt=_t._clip)}if(lt===null)return null;const Mt=new DE(this,lt,b,et);return this._bindAction(Mt,_t),this._addInactiveAction(Mt,ht,ot),Mt}existingAction(o,b){const et=b||this._root,tt=et.uuid,ot=typeof o=="string"?Cx.findByName(et,o):o,lt=ot?ot.uuid:o,ht=this._actionsByClip[lt];return ht!==void 0&&ht.actionByRoot[tt]||null}stopAllAction(){const o=this._actions;for(let b=this._nActiveActions-1;b>=0;--b)o[b].stop();return this}update(o){o*=this.timeScale;const b=this._actions,et=this._nActiveActions,tt=this.time+=o,ot=Math.sign(o),lt=this._accuIndex^=1;for(let _t=0;_t!==et;++_t)b[_t]._update(tt,o,ot,lt);const ht=this._bindings,vt=this._nActiveBindings;for(let _t=0;_t!==vt;++_t)ht[_t].apply(lt);return this}setTime(o){this.time=0;for(let b=0;b<this._actions.length;b++)this._actions[b].time=0;return this.update(o)}getRoot(){return this._root}uncacheClip(o){const b=this._actions,et=o.uuid,tt=this._actionsByClip,ot=tt[et];if(ot!==void 0){const lt=ot.knownActions;for(let ht=0,vt=lt.length;ht!==vt;++ht){const _t=lt[ht];this._deactivateAction(_t);const Mt=_t._cacheIndex,Pt=b[b.length-1];_t._cacheIndex=null,_t._byClipCacheIndex=null,Pt._cacheIndex=Mt,b[Mt]=Pt,b.pop(),this._removeInactiveBindingsForAction(_t)}delete tt[et]}}uncacheRoot(o){const b=o.uuid,et=this._actionsByClip;for(const ot in et){const lt=et[ot].actionByRoot[b];lt!==void 0&&(this._deactivateAction(lt),this._removeInactiveAction(lt))}const tt=this._bindingsByRootAndName[b];if(tt!==void 0)for(const ot in tt){const lt=tt[ot];lt.restoreOriginalState(),this._removeInactiveBinding(lt)}}uncacheAction(o,b){const et=this.existingAction(o,b);et!==null&&(this._deactivateAction(et),this._removeInactiveAction(et))}}class ny{constructor(o){this.value=o}clone(){return new ny(this.value.clone===void 0?this.value:this.value.clone())}}let kE=0;class Nx extends js{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:kE++}),this.name="",this.usage=P_,this.uniforms=[]}add(o){return this.uniforms.push(o),this}remove(o){const b=this.uniforms.indexOf(o);return b!==-1&&this.uniforms.splice(b,1),this}setName(o){return this.name=o,this}setUsage(o){return this.usage=o,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(o){this.name=o.name,this.usage=o.usage;const b=o.uniforms;this.uniforms.length=0;for(let et=0,tt=b.length;et<tt;et++)this.uniforms.push(b[et].clone());return this}clone(){return new this.constructor().copy(this)}}class BE extends Y1{constructor(o,b,et=1){super(o,b),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=et}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}clone(o){const b=super.clone(o);return b.meshPerAttribute=this.meshPerAttribute,b}toJSON(o){const b=super.toJSON(o);return b.isInstancedInterleavedBuffer=!0,b.meshPerAttribute=this.meshPerAttribute,b}}class lw{constructor(o,b,et,tt,ot){this.isGLBufferAttribute=!0,this.buffer=o,this.type=b,this.itemSize=et,this.elementSize=tt,this.count=ot,this.version=0}set needsUpdate(o){o===!0&&this.version++}setBuffer(o){return this.buffer=o,this}setType(o,b){return this.type=o,this.elementSize=b,this}setItemSize(o){return this.itemSize=o,this}setCount(o){return this.count=o,this}}class OE{constructor(o,b,et=0,tt=1/0){this.ray=new $v(o,b),this.near=et,this.far=tt,this.camera=null,this.layers=new op,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(o,b){this.ray.set(o,b)}setFromCamera(o,b){b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(o.x,o.y,.5).unproject(b).sub(this.ray.origin).normalize(),this.camera=b):b.isOrthographicCamera?(this.ray.origin.set(o.x,o.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld),this.camera=b):console.error("THREE.Raycaster: Unsupported camera type: "+b.type)}intersectObject(o,b=!0,et=[]){return NE(o,this,et,b),et.sort(LE),et}intersectObjects(o,b=!0,et=[]){for(let tt=0,ot=o.length;tt<ot;tt++)NE(o[tt],this,et,b);return et.sort(LE),et}}function LE(dt,o){return dt.distance-o.distance}function NE(dt,o,b,et){if(dt.layers.test(o.layers)&&dt.raycast(o,b),et===!0){const tt=dt.children;for(let ot=0,lt=tt.length;ot<lt;ot++)NE(tt[ot],o,b,!0)}}class wP{constructor(o=1,b=0,et=0){return this.radius=o,this.phi=b,this.theta=et,this}set(o,b,et){return this.radius=o,this.phi=b,this.theta=et,this}copy(o){return this.radius=o.radius,this.phi=o.phi,this.theta=o.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,b,et){return this.radius=Math.sqrt(o*o+b*b+et*et),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(o,et),this.phi=Math.acos(Ts(b/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $T{constructor(o=1,b=0,et=0){return this.radius=o,this.theta=b,this.y=et,this}set(o,b,et){return this.radius=o,this.theta=b,this.y=et,this}copy(o){return this.radius=o.radius,this.theta=o.theta,this.y=o.y,this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,b,et){return this.radius=Math.sqrt(o*o+et*et),this.theta=Math.atan2(o,et),this.y=b,this}clone(){return new this.constructor().copy(this)}}const JT=new Lr;class xP{constructor(o=new Lr(1/0,1/0),b=new Lr(-1/0,-1/0)){this.isBox2=!0,this.min=o,this.max=b}set(o,b){return this.min.copy(o),this.max.copy(b),this}setFromPoints(o){this.makeEmpty();for(let b=0,et=o.length;b<et;b++)this.expandByPoint(o[b]);return this}setFromCenterAndSize(o,b){const et=JT.copy(b).multiplyScalar(.5);return this.min.copy(o).sub(et),this.max.copy(o).add(et),this}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(o){return this.isEmpty()?o.set(0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y}getParameter(o,b){return b.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y)}clampPoint(o,b){return b.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return JT.copy(o).clamp(this.min,this.max).sub(o).length()}intersect(o){return this.min.max(o.min),this.max.min(o.max),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const FC=new xn,cw=new xn;class ZT{constructor(o=new xn,b=new xn){this.start=o,this.end=b}set(o,b){return this.start.copy(o),this.end.copy(b),this}copy(o){return this.start.copy(o.start),this.end.copy(o.end),this}getCenter(o){return o.addVectors(this.start,this.end).multiplyScalar(.5)}delta(o){return o.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(o,b){return this.delta(b).multiplyScalar(o).add(this.start)}closestPointToPointParameter(o,b){FC.subVectors(o,this.start),cw.subVectors(this.end,this.start);const et=cw.dot(cw);let tt=cw.dot(FC)/et;return b&&(tt=Ts(tt,0,1)),tt}closestPointToPoint(o,b,et){const tt=this.closestPointToPointParameter(o,b);return this.delta(et).multiplyScalar(tt).add(this.start)}applyMatrix4(o){return this.start.applyMatrix4(o),this.end.applyMatrix4(o),this}equals(o){return o.start.equals(this.start)&&o.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Co=new xn;class ep extends Zs{constructor(o,b){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=b;const et=new ms,tt=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let lt=0,ht=1,vt=32;lt<vt;lt++,ht++){const _t=lt/vt*Math.PI*2,Mt=ht/vt*Math.PI*2;tt.push(Math.cos(_t),Math.sin(_t),1,Math.cos(Mt),Math.sin(Mt),1)}et.setAttribute("position",new ft(tt,3));const ot=new Lp({fog:!1,toneMapped:!1});this.cone=new o_(et,ot),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const o=this.light.distance?this.light.distance:1e3,b=o*Math.tan(this.light.angle);this.cone.scale.set(b,b,o),Co.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Co),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Tp=new xn,c0=new zs,ry=new zs;class Fx extends o_{constructor(o){const b=UC(o),et=new ms,tt=[],ot=[],lt=new as(0,0,1),ht=new as(0,1,0);for(let vt=0;vt<b.length;vt++){const _t=b[vt];_t.parent&&_t.parent.isBone&&(tt.push(0,0,0),tt.push(0,0,0),ot.push(lt.r,lt.g,lt.b),ot.push(ht.r,ht.g,ht.b))}et.setAttribute("position",new ft(tt,3)),et.setAttribute("color",new ft(ot,3)),super(et,new Lp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=o,this.bones=b,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(o){const b=this.bones,et=this.geometry,tt=et.getAttribute("position");ry.copy(this.root.matrixWorld).invert();for(let ot=0,lt=0;ot<b.length;ot++){const ht=b[ot];ht.parent&&ht.parent.isBone&&(c0.multiplyMatrices(ry,ht.matrixWorld),Tp.setFromMatrixPosition(c0),tt.setXYZ(lt,Tp.x,Tp.y,Tp.z),c0.multiplyMatrices(ry,ht.parent.matrixWorld),Tp.setFromMatrixPosition(c0),tt.setXYZ(lt+1,Tp.x,Tp.y,Tp.z),lt+=2)}et.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(o)}}function UC(dt){const o=[];dt.isBone===!0&&o.push(dt);for(let b=0;b<dt.children.length;b++)o.push.apply(o,UC(dt.children[b]));return o}class eI extends Nu{constructor(o,b,et){super(new nw(b,4,2),new Gm({wireframe:!0,fog:!1,toneMapped:!1})),this.light=o,this.light.updateMatrixWorld(),this.color=et,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const jC=new xn,Ux=new as,zC=new as;class tI extends Zs{constructor(o,b,et){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=et;const tt=new up(b);tt.rotateY(.5*Math.PI),this.material=new Gm({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const ot=tt.getAttribute("position"),lt=new Float32Array(3*ot.count);tt.setAttribute("color",new ga(lt,3)),this.add(new Nu(tt,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const o=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const b=o.geometry.getAttribute("color");Ux.copy(this.light.color),zC.copy(this.light.groundColor);for(let et=0,tt=b.count;et<tt;et++){const ot=et<tt/2?Ux:zC;b.setXYZ(et,ot.r,ot.g,ot.b)}b.needsUpdate=!0}o.lookAt(jC.setFromMatrixPosition(this.light.matrixWorld).negate())}}class VC extends o_{constructor(o=10,b=10,et=4473924,tt=8947848){et=new as(et),tt=new as(tt);const ot=b/2,lt=o/b,ht=o/2,vt=[],_t=[];for(let Pt=0,Tt=0,Rt=-ht;Pt<=b;Pt++,Rt+=lt){vt.push(-ht,0,Rt,ht,0,Rt),vt.push(Rt,0,-ht,Rt,0,ht);const Nt=Pt===ot?et:tt;Nt.toArray(_t,Tt),Tt+=3,Nt.toArray(_t,Tt),Tt+=3,Nt.toArray(_t,Tt),Tt+=3,Nt.toArray(_t,Tt),Tt+=3}const Mt=new ms;Mt.setAttribute("position",new ft(vt,3)),Mt.setAttribute("color",new ft(_t,3)),super(Mt,new Lp({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class jx extends o_{constructor(o=10,b=16,et=8,tt=64,ot=4473924,lt=8947848){ot=new as(ot),lt=new as(lt);const ht=[],vt=[];if(b>1)for(let Mt=0;Mt<b;Mt++){const Pt=Mt/b*(2*Math.PI),Tt=Math.sin(Pt)*o,Rt=Math.cos(Pt)*o;ht.push(0,0,0),ht.push(Tt,0,Rt);const Nt=1&Mt?ot:lt;vt.push(Nt.r,Nt.g,Nt.b),vt.push(Nt.r,Nt.g,Nt.b)}for(let Mt=0;Mt<et;Mt++){const Pt=1&Mt?ot:lt,Tt=o-o/et*Mt;for(let Rt=0;Rt<tt;Rt++){let Nt=Rt/tt*(2*Math.PI),kt=Math.sin(Nt)*Tt,Kt=Math.cos(Nt)*Tt;ht.push(kt,0,Kt),vt.push(Pt.r,Pt.g,Pt.b),Nt=(Rt+1)/tt*(2*Math.PI),kt=Math.sin(Nt)*Tt,Kt=Math.cos(Nt)*Tt,ht.push(kt,0,Kt),vt.push(Pt.r,Pt.g,Pt.b)}}const _t=new ms;_t.setAttribute("position",new ft(ht,3)),_t.setAttribute("color",new ft(vt,3)),super(_t,new Lp({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Gl=new xn,u_=new xn,Tm=new xn;class u0 extends Zs{constructor(o,b,et){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=et,b===void 0&&(b=1);let tt=new ms;tt.setAttribute("position",new ft([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));const ot=new Lp({fog:!1,toneMapped:!1});this.lightPlane=new s_(tt,ot),this.add(this.lightPlane),tt=new ms,tt.setAttribute("position",new ft([0,0,0,0,0,1],3)),this.targetLine=new s_(tt,ot),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Gl.setFromMatrixPosition(this.light.matrixWorld),u_.setFromMatrixPosition(this.light.target.matrixWorld),Tm.subVectors(u_,Gl),this.lightPlane.lookAt(u_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(u_),this.targetLine.scale.z=Tm.length()}}const h0=new xn,lu=new FA;class nI extends o_{constructor(o){const b=new ms,et=new Lp({color:16777215,vertexColors:!0,toneMapped:!1}),tt=[],ot=[],lt={};function ht(Nt,kt){vt(Nt),vt(kt)}function vt(Nt){tt.push(0,0,0),ot.push(0,0,0),lt[Nt]===void 0&&(lt[Nt]=[]),lt[Nt].push(tt.length/3-1)}ht("n1","n2"),ht("n2","n4"),ht("n4","n3"),ht("n3","n1"),ht("f1","f2"),ht("f2","f4"),ht("f4","f3"),ht("f3","f1"),ht("n1","f1"),ht("n2","f2"),ht("n3","f3"),ht("n4","f4"),ht("p","n1"),ht("p","n2"),ht("p","n3"),ht("p","n4"),ht("u1","u2"),ht("u2","u3"),ht("u3","u1"),ht("c","t"),ht("p","c"),ht("cn1","cn2"),ht("cn3","cn4"),ht("cf1","cf2"),ht("cf3","cf4"),b.setAttribute("position",new ft(tt,3)),b.setAttribute("color",new ft(ot,3)),super(b,et),this.type="CameraHelper",this.camera=o,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=lt,this.update();const _t=new as(16755200),Mt=new as(16711680),Pt=new as(43775),Tt=new as(16777215),Rt=new as(3355443);this.setColors(_t,Mt,Pt,Tt,Rt)}setColors(o,b,et,tt,ot){const lt=this.geometry.getAttribute("color");lt.setXYZ(0,o.r,o.g,o.b),lt.setXYZ(1,o.r,o.g,o.b),lt.setXYZ(2,o.r,o.g,o.b),lt.setXYZ(3,o.r,o.g,o.b),lt.setXYZ(4,o.r,o.g,o.b),lt.setXYZ(5,o.r,o.g,o.b),lt.setXYZ(6,o.r,o.g,o.b),lt.setXYZ(7,o.r,o.g,o.b),lt.setXYZ(8,o.r,o.g,o.b),lt.setXYZ(9,o.r,o.g,o.b),lt.setXYZ(10,o.r,o.g,o.b),lt.setXYZ(11,o.r,o.g,o.b),lt.setXYZ(12,o.r,o.g,o.b),lt.setXYZ(13,o.r,o.g,o.b),lt.setXYZ(14,o.r,o.g,o.b),lt.setXYZ(15,o.r,o.g,o.b),lt.setXYZ(16,o.r,o.g,o.b),lt.setXYZ(17,o.r,o.g,o.b),lt.setXYZ(18,o.r,o.g,o.b),lt.setXYZ(19,o.r,o.g,o.b),lt.setXYZ(20,o.r,o.g,o.b),lt.setXYZ(21,o.r,o.g,o.b),lt.setXYZ(22,o.r,o.g,o.b),lt.setXYZ(23,o.r,o.g,o.b),lt.setXYZ(24,b.r,b.g,b.b),lt.setXYZ(25,b.r,b.g,b.b),lt.setXYZ(26,b.r,b.g,b.b),lt.setXYZ(27,b.r,b.g,b.b),lt.setXYZ(28,b.r,b.g,b.b),lt.setXYZ(29,b.r,b.g,b.b),lt.setXYZ(30,b.r,b.g,b.b),lt.setXYZ(31,b.r,b.g,b.b),lt.setXYZ(32,et.r,et.g,et.b),lt.setXYZ(33,et.r,et.g,et.b),lt.setXYZ(34,et.r,et.g,et.b),lt.setXYZ(35,et.r,et.g,et.b),lt.setXYZ(36,et.r,et.g,et.b),lt.setXYZ(37,et.r,et.g,et.b),lt.setXYZ(38,tt.r,tt.g,tt.b),lt.setXYZ(39,tt.r,tt.g,tt.b),lt.setXYZ(40,ot.r,ot.g,ot.b),lt.setXYZ(41,ot.r,ot.g,ot.b),lt.setXYZ(42,ot.r,ot.g,ot.b),lt.setXYZ(43,ot.r,ot.g,ot.b),lt.setXYZ(44,ot.r,ot.g,ot.b),lt.setXYZ(45,ot.r,ot.g,ot.b),lt.setXYZ(46,ot.r,ot.g,ot.b),lt.setXYZ(47,ot.r,ot.g,ot.b),lt.setXYZ(48,ot.r,ot.g,ot.b),lt.setXYZ(49,ot.r,ot.g,ot.b),lt.needsUpdate=!0}update(){const o=this.geometry,b=this.pointMap;lu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),mu("c",b,o,lu,0,0,-1),mu("t",b,o,lu,0,0,1),mu("n1",b,o,lu,-1,-1,-1),mu("n2",b,o,lu,1,-1,-1),mu("n3",b,o,lu,-1,1,-1),mu("n4",b,o,lu,1,1,-1),mu("f1",b,o,lu,-1,-1,1),mu("f2",b,o,lu,1,-1,1),mu("f3",b,o,lu,-1,1,1),mu("f4",b,o,lu,1,1,1),mu("u1",b,o,lu,.7,1.1,-1),mu("u2",b,o,lu,-.7,1.1,-1),mu("u3",b,o,lu,0,2,-1),mu("cf1",b,o,lu,-1,0,1),mu("cf2",b,o,lu,1,0,1),mu("cf3",b,o,lu,0,-1,1),mu("cf4",b,o,lu,0,1,1),mu("cn1",b,o,lu,-1,0,-1),mu("cn2",b,o,lu,1,0,-1),mu("cn3",b,o,lu,0,-1,-1),mu("cn4",b,o,lu,0,1,-1),o.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function mu(dt,o,b,et,tt,ot,lt){h0.set(tt,ot,lt).unproject(et);const ht=o[dt];if(ht!==void 0){const vt=b.getAttribute("position");for(let _t=0,Mt=ht.length;_t<Mt;_t++)vt.setXYZ(ht[_t],h0.x,h0.y,h0.z)}}const zx=new N_;class FE extends o_{constructor(o,b=16776960){const et=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),tt=new Float32Array(24),ot=new ms;ot.setIndex(new ga(et,1)),ot.setAttribute("position",new ga(tt,3)),super(ot,new Lp({color:b,toneMapped:!1})),this.object=o,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(o){if(o!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&zx.setFromObject(this.object),zx.isEmpty())return;const b=zx.min,et=zx.max,tt=this.geometry.attributes.position,ot=tt.array;ot[0]=et.x,ot[1]=et.y,ot[2]=et.z,ot[3]=b.x,ot[4]=et.y,ot[5]=et.z,ot[6]=b.x,ot[7]=b.y,ot[8]=et.z,ot[9]=et.x,ot[10]=b.y,ot[11]=et.z,ot[12]=et.x,ot[13]=et.y,ot[14]=b.z,ot[15]=b.x,ot[16]=et.y,ot[17]=b.z,ot[18]=b.x,ot[19]=b.y,ot[20]=b.z,ot[21]=et.x,ot[22]=b.y,ot[23]=b.z,tt.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(o){return this.object=o,this.update(),this}copy(o,b){return super.copy(o,b),this.object=o.object,this}}class $m extends o_{constructor(o,b=16776960){const et=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),tt=new ms;tt.setIndex(new ga(et,1)),tt.setAttribute("position",new ft([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(tt,new Lp({color:b,toneMapped:!1})),this.box=o,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(o){const b=this.box;b.isEmpty()||(b.getCenter(this.position),b.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(o))}}class UE extends s_{constructor(o,b=1,et=16776960){const tt=et,ot=new ms;ot.setAttribute("position",new ft([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),ot.computeBoundingSphere(),super(ot,new Lp({color:tt,toneMapped:!1})),this.type="PlaneHelper",this.plane=o,this.size=b;const lt=new ms;lt.setAttribute("position",new ft([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),lt.computeBoundingSphere(),this.add(new Nu(lt,new Gm({color:tt,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(o){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(o)}}const uw=new xn;let Up,eA;class h_ extends Zs{constructor(o=new xn(0,0,1),b=new xn(0,0,0),et=1,tt=16776960,ot=.2*et,lt=.2*ot){super(),this.type="ArrowHelper",Up===void 0&&(Up=new ms,Up.setAttribute("position",new ft([0,0,0,0,1,0],3)),eA=new Fu(0,.5,1,5,1),eA.translate(0,-.5,0)),this.position.copy(b),this.line=new s_(Up,new Lp({color:tt,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Nu(eA,new Gm({color:tt,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(o),this.setLength(et,ot,lt)}setDirection(o){if(o.y>.99999)this.quaternion.set(0,0,0,1);else if(o.y<-.99999)this.quaternion.set(1,0,0,0);else{uw.set(o.z,0,-o.x).normalize();const b=Math.acos(o.y);this.quaternion.setFromAxisAngle(uw,b)}}setLength(o,b=.2*o,et=.2*b){this.line.scale.set(1,Math.max(1e-4,o-b),1),this.line.updateMatrix(),this.cone.scale.set(et,b,et),this.cone.position.y=o,this.cone.updateMatrix()}setColor(o){this.line.material.color.set(o),this.cone.material.color.set(o)}copy(o){return super.copy(o,!1),this.line.copy(o.line),this.cone.copy(o.cone),this}}class hw extends o_{constructor(o=1){const b=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],et=new ms;et.setAttribute("position",new ft(b,3)),et.setAttribute("color",new ft([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(et,new Lp({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(o,b,et){const tt=new as,ot=this.geometry.attributes.color.array;return tt.set(o),tt.toArray(ot,0),tt.toArray(ot,3),tt.set(b),tt.toArray(ot,6),tt.toArray(ot,9),tt.set(et),tt.toArray(ot,12),tt.toArray(ot,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class jE{constructor(){this.type="ShapePath",this.color=new as,this.subPaths=[],this.currentPath=null}moveTo(o,b){return this.currentPath=new JA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(o,b),this}lineTo(o,b){return this.currentPath.lineTo(o,b),this}quadraticCurveTo(o,b,et,tt){return this.currentPath.quadraticCurveTo(o,b,et,tt),this}bezierCurveTo(o,b,et,tt,ot,lt){return this.currentPath.bezierCurveTo(o,b,et,tt,ot,lt),this}splineThru(o){return this.currentPath.splineThru(o),this}toShapes(o,b){function et(en){const ln=[];for(let gn=0,_n=en.length;gn<_n;gn++){const An=en[gn],Ln=new Wy;Ln.curves=An.curves,ln.push(Ln)}return ln}function tt(en,ln){const gn=ln.length;let _n=!1;for(let An=gn-1,Ln=0;Ln<gn;An=Ln++){let Nn=ln[An],Jn=ln[Ln],tr=Jn.x-Nn.x,jn=Jn.y-Nn.y;if(Math.abs(jn)>Number.EPSILON){if(jn<0&&(Nn=ln[Ln],tr=-tr,Jn=ln[An],jn=-jn),en.y<Nn.y||en.y>Jn.y)continue;if(en.y===Nn.y){if(en.x===Nn.x)return!0}else{const Cr=jn*(en.x-Nn.x)-tr*(en.y-Nn.y);if(Cr===0)return!0;if(Cr<0)continue;_n=!_n}}else{if(en.y!==Nn.y)continue;if(Jn.x<=en.x&&en.x<=Nn.x||Nn.x<=en.x&&en.x<=Jn.x)return!0}}return _n}const ot=Iv.isClockWise,lt=this.subPaths;if(lt.length===0)return[];if(b===!0)return et(lt);let ht,vt,_t;const Mt=[];if(lt.length===1)return vt=lt[0],_t=new Wy,_t.curves=vt.curves,Mt.push(_t),Mt;let Pt=!ot(lt[0].getPoints());Pt=o?!Pt:Pt;const Tt=[],Rt=[];let Nt,kt,Kt=[],$t=0;Rt[$t]=void 0,Kt[$t]=[];for(let en=0,ln=lt.length;en<ln;en++)vt=lt[en],Nt=vt.getPoints(),ht=ot(Nt),ht=o?!ht:ht,ht?(!Pt&&Rt[$t]&&$t++,Rt[$t]={s:new Wy,p:Nt},Rt[$t].s.curves=vt.curves,Pt&&$t++,Kt[$t]=[]):Kt[$t].push({h:vt,p:Nt[0]});if(!Rt[0])return et(lt);if(Rt.length>1){let en=!1,ln=0;for(let gn=0,_n=Rt.length;gn<_n;gn++)Tt[gn]=[];for(let gn=0,_n=Rt.length;gn<_n;gn++){const An=Kt[gn];for(let Ln=0;Ln<An.length;Ln++){const Nn=An[Ln];let Jn=!0;for(let tr=0;tr<Rt.length;tr++)tt(Nn.p,Rt[tr].p)&&(gn!==tr&&ln++,Jn?(Jn=!1,Tt[tr].push(Nn)):en=!0);Jn&&Tt[gn].push(Nn)}}ln>0&&en===!1&&(Kt=Tt)}for(let en=0,ln=Rt.length;en<ln;en++){_t=Rt[en].s,Mt.push(_t),kt=Kt[en];for(let gn=0,_n=kt.length;gn<_n;gn++)_t.holes.push(kt[gn].h)}return Mt}}const Jm=QC();function QC(){const dt=new ArrayBuffer(4),o=new Float32Array(dt),b=new Uint32Array(dt),et=new Uint32Array(512),tt=new Uint32Array(512);for(let vt=0;vt<256;++vt){const _t=vt-127;_t<-27?(et[vt]=0,et[256|vt]=32768,tt[vt]=24,tt[256|vt]=24):_t<-14?(et[vt]=1024>>-_t-14,et[256|vt]=1024>>-_t-14|32768,tt[vt]=-_t-1,tt[256|vt]=-_t-1):_t<=15?(et[vt]=_t+15<<10,et[256|vt]=_t+15<<10|32768,tt[vt]=13,tt[256|vt]=13):_t<128?(et[vt]=31744,et[256|vt]=64512,tt[vt]=24,tt[256|vt]=24):(et[vt]=31744,et[256|vt]=64512,tt[vt]=13,tt[256|vt]=13)}const ot=new Uint32Array(2048),lt=new Uint32Array(64),ht=new Uint32Array(64);for(let vt=1;vt<1024;++vt){let _t=vt<<13,Mt=0;for(;!(8388608&_t);)_t<<=1,Mt-=8388608;_t&=-8388609,Mt+=947912704,ot[vt]=_t|Mt}for(let vt=1024;vt<2048;++vt)ot[vt]=939524096+(vt-1024<<13);for(let vt=1;vt<31;++vt)lt[vt]=vt<<23;lt[31]=1199570944,lt[32]=2147483648;for(let vt=33;vt<63;++vt)lt[vt]=2147483648+(vt-32<<23);lt[63]=3347054592;for(let vt=1;vt<64;++vt)vt!==32&&(ht[vt]=1024);return{floatView:o,uint32View:b,baseTable:et,shiftTable:tt,mantissaTable:ot,exponentTable:lt,offsetTable:ht}}var dw=Object.freeze({__proto__:null,toHalfFloat:function(dt){Math.abs(dt)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),dt=Ts(dt,-65504,65504),Jm.floatView[0]=dt;const o=Jm.uint32View[0],b=o>>23&511;return Jm.baseTable[b]+((8388607&o)>>Jm.shiftTable[b])},fromHalfFloat:function(dt){const o=dt>>10;return Jm.uint32View[0]=Jm.mantissaTable[Jm.offsetTable[o]+(1023&dt)]+Jm.exponentTable[o],Jm.floatView[0]}});function Vx(){console.error("THREE.ImmediateRenderObject has been removed.")}class GC extends wp{constructor(o,b,et){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(o,b,et),this.samples=4}}class rI extends I0{constructor(o,b,et,tt){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(o,b,et,tt)}}class d0 extends L_{constructor(o,b,et,tt){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(o,b,et,tt)}}class iI extends Hm{constructor(o,b,et,tt,ot,lt){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(o,b,et,tt,ot,lt)}}class sI extends hx{constructor(o,b,et,tt){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(o,b,et,tt)}}class pw extends Sm{constructor(o,b,et,tt){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(o,b,et,tt)}}class HC extends Ol{constructor(o,b,et,tt,ot,lt,ht){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(o,b,et,tt,ot,lt,ht)}}class tA extends Fu{constructor(o,b,et,tt,ot,lt,ht,vt){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(o,b,et,tt,ot,lt,ht,vt)}}class Qx extends dx{constructor(o,b){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(o,b)}}class oI extends _x{constructor(o,b){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(o,b)}}class zE extends tw{constructor(o,b){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(o,b)}}class aI extends Yl{constructor(o,b,et,tt){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(o,b,et,tt)}}class fw extends up{constructor(o,b){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(o,b)}}class mw extends z0{constructor(o,b,et,tt){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(o,b,et,tt)}}class lI extends $_{constructor(o,b,et,tt){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(o,b,et,tt)}}class cI extends Yy{constructor(o,b,et,tt,ot,lt){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(o,b,et,tt,ot,lt)}}class uI extends yx{constructor(o,b){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(o,b)}}class hI extends nw{constructor(o,b,et,tt,ot,lt,ht){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(o,b,et,tt,ot,lt,ht)}}class iy extends Xy{constructor(o,b){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(o,b)}}class WC extends $0{constructor(o,b,et,tt,ot){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(o,b,et,tt,ot)}}class gw extends _d{constructor(o,b,et,tt,ot,lt){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(o,b,et,tt,ot,lt)}}class Zm extends Ax{constructor(o,b,et,tt,ot){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(o,b,et,tt,ot)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=d)},553:function(j,_,_e){_e.d(_,{_:function(){return ct}});var d=_e(988);const it=new WeakMap;class ct extends d.aNw{constructor(St){super(St),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(St){return this.decoderPath=St,this}setDecoderConfig(St){return this.decoderConfig=St,this}setWorkerLimit(St){return this.workerLimit=St,this}load(St,Ot,Qt,Yt){const Vt=new d.hH6(this.manager);Vt.setPath(this.path),Vt.setResponseType("arraybuffer"),Vt.setRequestHeader(this.requestHeader),Vt.setWithCredentials(this.withCredentials),Vt.load(St,qt=>{this.decodeDracoFile(qt,Ot).catch(Yt)},Qt,Yt)}decodeDracoFile(St,Ot,Qt,Yt){const Vt={attributeIDs:Qt||this.defaultAttributeIDs,attributeTypes:Yt||this.defaultAttributeTypes,useUniqueIDs:!!Qt};return this.decodeGeometry(St,Vt).then(Ot)}decodeGeometry(St,Ot){const Qt=JSON.stringify(Ot);if(it.has(St)){const jt=it.get(St);if(jt.key===Qt)return jt.promise;if(St.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let Yt;const Vt=this.workerNextTaskID++,qt=St.byteLength,Jt=this._getWorker(Vt,qt).then(jt=>(Yt=jt,new Promise((sn,Ft)=>{Yt._callbacks[Vt]={resolve:sn,reject:Ft},Yt.postMessage({type:"decode",id:Vt,taskConfig:Ot,buffer:St},[St])}))).then(jt=>this._createGeometry(jt.geometry));return Jt.catch(()=>!0).then(()=>{Yt&&Vt&&this._releaseTask(Yt,Vt)}),it.set(St,{key:Qt,promise:Jt}),Jt}_createGeometry(St){const Ot=new d.u9r;St.index&&Ot.setIndex(new d.TlE(St.index.array,1));for(let Qt=0;Qt<St.attributes.length;Qt++){const Yt=St.attributes[Qt],Vt=Yt.name,qt=Yt.array,Jt=Yt.itemSize;Ot.setAttribute(Vt,new d.TlE(qt,Jt))}return Ot}_loadLibrary(St,Ot){const Qt=new d.hH6(this.manager);return Qt.setPath(this.decoderPath),Qt.setResponseType(Ot),Qt.setWithCredentials(this.withCredentials),new Promise((Yt,Vt)=>{Qt.load(St,Yt,void 0,Vt)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const St=typeof WebAssembly!="object"||this.decoderConfig.type==="js",Ot=[];return St?Ot.push(this._loadLibrary("draco_decoder.js","text")):(Ot.push(this._loadLibrary("draco_wasm_wrapper.js","text")),Ot.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(Ot).then(Qt=>{const Yt=Qt[0];St||(this.decoderConfig.wasmBinary=Qt[1]);const Vt=pt.toString(),qt=["/* draco decoder */",Yt,"","/* worker */",Vt.substring(Vt.indexOf("{")+1,Vt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([qt]))}),this.decoderPending}_getWorker(St,Ot){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const Yt=new Worker(this.workerSourceURL);Yt._callbacks={},Yt._taskCosts={},Yt._taskLoad=0,Yt.postMessage({type:"init",decoderConfig:this.decoderConfig}),Yt.onmessage=function(Vt){const qt=Vt.data;switch(qt.type){case"decode":Yt._callbacks[qt.id].resolve(qt);break;case"error":Yt._callbacks[qt.id].reject(qt);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+qt.type+'"')}},this.workerPool.push(Yt)}else this.workerPool.sort(function(Yt,Vt){return Yt._taskLoad>Vt._taskLoad?-1:1});const Qt=this.workerPool[this.workerPool.length-1];return Qt._taskCosts[St]=Ot,Qt._taskLoad+=Ot,Qt})}_releaseTask(St,Ot){St._taskLoad-=St._taskCosts[Ot],delete St._callbacks[Ot],delete St._taskCosts[Ot]}debug(){console.log("Task load: ",this.workerPool.map(St=>St._taskLoad))}dispose(){for(let St=0;St<this.workerPool.length;++St)this.workerPool[St].terminate();return this.workerPool.length=0,this}}function pt(){let At,St;function Ot(Qt,Yt,Vt,qt,Jt,jt){const sn=jt.num_components(),Ft=Vt.num_points()*sn,Ut=Ft*Jt.BYTES_PER_ELEMENT,Ht=function(dn,zt){switch(zt){case Float32Array:return dn.DT_FLOAT32;case Int8Array:return dn.DT_INT8;case Int16Array:return dn.DT_INT16;case Int32Array:return dn.DT_INT32;case Uint8Array:return dn.DT_UINT8;case Uint16Array:return dn.DT_UINT16;case Uint32Array:return dn.DT_UINT32}}(Qt,Jt),an=Qt._malloc(Ut);Yt.GetAttributeDataArrayForAllPoints(Vt,jt,Ht,Ut,an);const nn=new Jt(Qt.HEAPF32.buffer,an,Ft).slice();return Qt._free(an),{name:qt,array:nn,itemSize:sn}}onmessage=function(Qt){const Yt=Qt.data;switch(Yt.type){case"init":At=Yt.decoderConfig,St=new Promise(function(Jt){At.onModuleLoaded=function(jt){Jt({draco:jt})},DracoDecoderModule(At)});break;case"decode":const Vt=Yt.buffer,qt=Yt.taskConfig;St.then(Jt=>{const jt=Jt.draco,sn=new jt.Decoder,Ft=new jt.DecoderBuffer;Ft.Init(new Int8Array(Vt),Vt.byteLength);try{const Ut=function(an,nn,dn,zt){const Wt=zt.attributeIDs,Zt=zt.attributeTypes;let mn,hn;const zn=nn.GetEncodedGeometryType(dn);if(zn===an.TRIANGULAR_MESH)mn=new an.Mesh,hn=nn.DecodeBufferToMesh(dn,mn);else{if(zn!==an.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");mn=new an.PointCloud,hn=nn.DecodeBufferToPointCloud(dn,mn)}if(!hn.ok()||mn.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+hn.error_msg());const lr={index:null,attributes:[]};for(const ar in Wt){const ur=self[Zt[ar]];let Zn,wr;if(zt.useUniqueIDs)wr=Wt[ar],Zn=nn.GetAttributeByUniqueId(mn,wr);else{if(wr=nn.GetAttributeId(mn,an[Wt[ar]]),wr===-1)continue;Zn=nn.GetAttribute(mn,wr)}lr.attributes.push(Ot(an,nn,mn,ar,ur,Zn))}return zn===an.TRIANGULAR_MESH&&(lr.index=function(ar,ur,Zn){const wr=3*Zn.num_faces(),Vn=4*wr,Kn=ar._malloc(Vn);ur.GetTrianglesUInt32Array(Zn,Vn,Kn);const un=new Uint32Array(ar.HEAPF32.buffer,Kn,wr).slice();return ar._free(Kn),{array:un,itemSize:1}}(an,nn,mn)),an.destroy(mn),lr}(jt,sn,Ft,qt),Ht=Ut.attributes.map(an=>an.array.buffer);Ut.index&&Ht.push(Ut.index.array.buffer),self.postMessage({type:"decode",id:Yt.id,geometry:Ut},Ht)}catch(Ut){console.error(Ut),self.postMessage({type:"error",id:Yt.id,error:Ut.message})}finally{jt.destroy(Ft),jt.destroy(sn)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(j){var _=__webpackgi_module_cache__[j];if(_!==void 0)return _.exports;var _e=__webpackgi_module_cache__[j]={id:j,exports:{}};return __webpackgi_modules__[j].call(_e.exports,_e,_e.exports,__webpackgi_require__),_e.exports}__webpackgi_require__.n=function(j){var _=j&&j.__esModule?function(){return j.default}:function(){return j};return __webpackgi_require__.d(_,{a:_}),_},__webpackgi_require__.d=function(j,_){for(var _e in _)__webpackgi_require__.o(_,_e)&&!__webpackgi_require__.o(j,_e)&&Object.defineProperty(j,_e,{enumerable:!0,get:_[_e]})},__webpackgi_require__.o=function(j,_){return Object.prototype.hasOwnProperty.call(j,_)},__webpackgi_require__.r=function(j){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(j,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(j,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{LY2:function(){return d.LY2},HRj:function(){return Um},li4:function(){return GB},FO5:function(){return HB},Nlh:function(){return VB},QvI:function(){return Ks},JHp:function(){return QS},bGH:function(){return d.bGH},NDo:function(){return d.NDo},gSk:function(){return d.gSk},WMw:function(){return d.WMw},OTo:function(){return d.OTo},Se2:function(){return d.Se2},cum:function(){return d.cum},Mig:function(){return d.Mig},B$7:function(){return D1},i_9:function(){return d.i_9},m7l:function(){return d.m7l},sYA:function(){return d.sYA},Xcj:function(){return d.Xcj},mzJ:function(){return d.mzJ},ZZA:function(){return d.ZZA},$Ph:function(){return dm},T__:function(){return d.T__},HkE:function(){return d.HkE},tGC:function(){return d.tGC},g1S:function(){return sy},I$C:function(){return tM},QIH:function(){return oo},_JE:function(){return a0},ksm:function(){return Jr},jl_:function(){return bm},b7R:function(){return Ep},BDV:function(){return As},Ea_:function(){return By},qff:function(){return bm},tmC:function(){return ru},BON:function(){return uP},P40:function(){return Nu},wLL:function(){return am},iHO:function(){return S1},BbS:function(){return d.BbS},kqm:function(){return d.kqm},Hmr:function(){return d.Hmr},SJI:function(){return d.SJI},mTL:function(){return d.mTL},y8_:function(){return d.y8_},_Li:function(){return d._Li},g56:function(){return Cp},bj3:function(){return Os},z81:function(){return d.z81},_MY:function(){return d._MY},yEv:function(){return MP},dFZ:function(){return K0},N$j:function(){return d.N$j},_YM:function(){return d._YM},TUj:function(){return d.TUj},ZzF:function(){return d.ZzF},qzb:function(){return ar},GQ:function(){return d.GQ},nvb:function(){return d.nvb},DvJ:function(){return d.DvJ},fQA:function(){return d.fQA},cPz:function(){return ZS},TlE:function(){return d.TlE},u9r:function(){return d.u9r},s4_:function(){return d.s4_},T95:function(){return d.T95},F5w:function(){return w2},NlP:function(){return j2},$8Z:function(){return lA},YYN:function(){return oA},CtF:function(){return d.CtF},V1s:function(){return d.V1s},jOv:function(){return Ap},Rki:function(){return d.Rki},pzV:function(){return X2},itZ:function(){return Np},qKx:function(){return au},vlJ:function(){return lM},nPO:function(){return uy},zcQ:function(){return CC},GH1:function(){return pm},ROQ:function(){return d.ROQ},YN5:function(){return d.YN5},BVQ:function(){return d.BVQ},YT8:function(){return d.YT8},_DE:function(){return kE},YGz:function(){return d.YGz},trn:function(){return d.trn},zf8:function(){return d.zf8},uWy:function(){return d.uWy},wYQ:function(){return Xm},SUY:function(){return d.SUY},Ilk:function(){return d.Ilk},R2R:function(){return d.R2R},epp:function(){return d.epp},xmJ:function(){return Mp},GD$:function(){return Op},EB7:function(){return d.EB7},DqL:function(){return d.DqL},_3:function(){return d._3},b_z:function(){return d.b_z},OCn:function(){return hy},_am:function(){return d._am},kB7:function(){return XM},fY$:function(){return d.fY$},vxC:function(){return d.vxC},BtG:function(){return d.BtG},cBK:function(){return d.cBK},g8_:function(){return d.g8_},AXT:function(){return d.AXT},yj7:function(){return d.yj7},dYG:function(){return d.dYG},tm_:function(){return d.tm_},S2y:function(){return d.S2y},B02:function(){return d.B02},PeU:function(){return d.PeU},Hyl:function(){return d.Hyl},Wqd:function(){return d.Wqd},Xaj:function(){return d.Xaj},DUb:function(){return _d},dZ3:function(){return d.dZ3},m_w:function(){return d.m_w},fHI:function(){return d.fHI},LBq:function(){return d.LBq},dHf:function(){return zB},Qww:function(){return U_.Q},CGV:function(){return tS},JUT:function(){return d.JUT},p3g:function(){return d.p3g},IEO:function(){return d.IEO},CN8:function(){return d.CN8},zob:function(){return d.zob},yxD:function(){return d.yxD},CUS:function(){return Sl},A5E:function(){return d.A5E},zqG:function(){return Mv},PfX:function(){return LM},Q1o:function(){return F0},jfJ:function(){return d.jfJ},T_J:function(){return d.T_J},tEQ:function(){return d.tEQ},gb4:function(){return Or},qkB:function(){return d.qkB},cvk:function(){return J0},HWo:function(){return n0},brP:function(){return d.brP},$YQ:function(){return d.$YQ},X8d:function(){return TM},Zdt:function(){return JD},yNB:function(){return Pl},h7x:function(){return Yl},Ox3:function(){return d.Ox3},qtn:function(){return n_},cBI:function(){return d.cBI},cU9:function(){return d.cU9},DT1:function(){return d.DT1},Kgo:function(){return d.Kgo},ehD:function(){return d.ehD},fhJ:function(){return Gw},y1s:function(){return Hw},fSK:function(){return d.fSK},Vdb:function(){return d.Vdb},l8J:function(){return d.l8J},dj0:function(){return d.dj0},QM0:function(){return d.QM0},OIS:function(){return jp},q8b:function(){return Hy},TOt:function(){return d.TOt},xaN:function(){return qt},Ny0:function(){return d.Ny0},NeD:function(){return ID},Zof:function(){return kS},eD:function(){return d.eD},jwo:function(){return d.jwo},dSO:function(){return d.dSO},Bf4:function(){return d.Bf4},USm:function(){return d.USm},pBf:function(){return d.pBf},$Vf:function(){return d.$Vf},O7d:function(){return d.O7d},ksq:function(){return ao},gXf:function(){return AC},hH6:function(){return d.hH6},kpi:function(){return OE},DwZ:function(){return mp},kN3:function(){return tR},e62:function(){return d.e62},a$l:function(){return d.a$l},OM3:function(){return d.OM3},VzW:function(){return d.VzW},ybr:function(){return d.ybr},yo9:function(){return d.yo9},$Bt:function(){return K_},Wzm:function(){return d.Wzm},Wl3:function(){return d.Wl3},iWj:function(){return d.iWj},DNz:function(){return iu},m1M:function(){return El},ylh:function(){return d.ylh},v9Y:function(){return d.v9Y},LSk:function(){return d.LSk},LHE:function(){return Ol},KE0:function(){return $P},KCF:function(){return OB},a4n:function(){return IP},zIH:function(){return b1},Hfk:function(){return gv},png:function(){return ym},tAj:function(){return Yv},Eb_:function(){return Am},BT2:function(){return KC},_8p:function(){return wR},V5Z:function(){return ey},s5b:function(){return IE},hkn:function(){return yA},GFY:function(){return Av},w$m:function(){return d.w$m},ksN:function(){return d.ksN},j4z:function(){return d.j4z},OAl:function(){return d.OAl},VLJ:function(){return d.VLJ},C73:function(){return um},ZAu:function(){return d.ZAu},ibP:function(){return N0},_fI:function(){return Op},hUN:function(){return fm},cLu:function(){return d.cLu},vmT:function(){return d.vmT},Qpg:function(){return d.Qpg},So8:function(){return d.So8},eOv:function(){return H2},Wjw:function(){return d.Wjw},cJO:function(){return d.cJO},QRU:function(){return d.QRU},S3k:function(){return d.S3k},PpQ:function(){return d.PpQ},AHu:function(){return d.AHu},q_9:function(){return Ul},ZRs:function(){return d.ZRs},oqc:function(){return d.oqc},T_x:function(){return Il},lb7:function(){return d.lb7},L5s:function(){return d.L5s},$TI:function(){return d.$TI},SPe:function(){return d.SPe},aVm:function(){return d.aVm},j87:function(){return d.j87},RNb:function(){return d.RNb},Kz5:function(){return d.Kz5},vpT:function(){return d.vpT},kB5:function(){return d.kB5},_C8:function(){return d._C8},Syv:function(){return d.Syv},NMF:function(){return d.NMF},pIN:function(){return d.pIN},eMJ:function(){return d.eMJ},rN7:function(){return Px},iUp:function(){return kC},GFd:function(){return qE},x5V:function(){return d.x5V},tUh:function(){return d.tUh},z8B:function(){return d.z8B},vcl:function(){return PE},GZb:function(){return d.GZb},p7y:function(){return d.p7y},S9g:function(){return d.S9g},Zr5:function(){return d.Zr5},vCF:function(){return d.vCF},yt0:function(){return d.yt0},uXU:function(){return d.uXU},_kC:function(){return d._kC},lk7:function(){return d.lk7},USc:function(){return W2},x12:function(){return d.x12},Zzh:function(){return d.Zzh},nls:function(){return d.nls},g_z:function(){return d.g_z},U7:function(){return d.U7},FT0:function(){return d.FT0},blk:function(){return d.blk},ejS:function(){return d.ejS},rnI:function(){return d.rnI},wem:function(){return d.wem},lfu:function(){return d.lfu},FDw:function(){return d.FDw},lRj:function(){return d.lRj},D1R:function(){return d.D1R},qyh:function(){return d.qyh},GUF:function(){return d.GUF},EoG:function(){return d.EoG},aNw:function(){return d.aNw},Zp0:function(){return d.Zp0},lLk:function(){return d.lLk},jAl:function(){return d.jAl},uEv:function(){return d.uEv},YKA:function(){return d.YKA},cRx:function(){return d.cRx},Y8D:function(){return d.Y8D},RsA:function(){return d.RsA},Y0m:function(){return Wx},F5T:function(){return d.F5T},EDU:function(){return a2},z$Q:function(){return c1},KA8:function(){return Pu},XUj:function(){return _2},Me$:function(){return ww},u7G:function(){return d.u7G},PEk:function(){return P_},BG4:function(){return iD},M8C:function(){return d.M8C},Vkp:function(){return d.Vkp},yGw:function(){return d.yGw},Sm8:function(){return d.Sm8},Kj0:function(){return d.Kj0},vBJ:function(){return d.vBJ},QfV:function(){return Yp},lRF:function(){return d.lRF},Lun:function(){return d.Lun},YBo:function(){return d.YBo},kaV:function(){return d.kaV},RSm:function(){return d.RSm},xoR:function(){return d.xoR},EJi:function(){return d.EJi},Wid:function(){return d.Wid},iuj:function(){return Yu},IKL:function(){return d.IKL},r_:function(){return d.r_},OoA:function(){return d.OoA},qhX:function(){return d.qhX},qPT:function(){return Ww},M5h:function(){return d.M5h},Ns1:function(){return d.Ns1},TyD:function(){return d.TyD},vZf:function(){return d.vZf},HTd:function(){return d.HTd},aH4:function(){return d.aH4},YLQ:function(){return d.YLQ},BVF:function(){return d.BVF},MyG:function(){return d.MyG},jFi:function(){return d.jFi},aCh:function(){return d.aCh},uL9:function(){return d.uL9},TNj:function(){return up},IFH:function(){return d.IFH},bdR:function(){return d.bdR},kM_:function(){return KM},M6v:function(){return d.M6v},RvT:function(){return d.RvT},dUE:function(){return d.dUE},oe_:function(){return yI},BuN:function(){return ZC},Tme:function(){return d.Tme},N9P:function(){return hv},Gql:function(){return d.Gql},$XY:function(){return MA},O9d:function(){return eT},zEO:function(){return S0},qfx:function(){return my},PA7:function(){return d.PA7},REq:function(){return d.REq},pQR:function(){return d.pQR},ghN:function(){return d.ghN},Hy8:function(){return d.Hy8},Wpd:function(){return d.Wpd},LgZ:function(){return d.LgZ},iWC:function(){return d.iWC},mqn:function(){return CF},SKe:function(){return Fo},iKG:function(){return d.iKG},_iA:function(){return d._iA},ntZ:function(){return d.ntZ},anP:function(){return d.anP},X2e:function(){return NB},FCo:function(){return v0},y$t:function(){return d.y$t},cPb:function(){return d.cPb},lmx:function(){return jo},JOQ:function(){return d.JOQ},BKK:function(){return d.BKK},_12:function(){return d._12},tJx:function(){return d.tJx},cek:function(){return d.cek},qD0:function(){return OS},xG9:function(){return d.xG9},wI8:function(){return hA},Sgv:function(){return nR},woe:function(){return d.woe},UY4:function(){return d.UY4},aq0:function(){return d.aq0},ujx:function(){return d.ujx},Uol:function(){return d.Uol},JiH:function(){return gM},VYz:function(){return d.VYz},_Pm:function(){return s0},EsW:function(){return cp},iUV:function(){return d.iUV},tf:function(){return d.tf},ZQ6:function(){return d.ZQ6},mXe:function(){return d.mXe},_fP:function(){return d._fP},iLg:function(){return d.iLg},zbs:function(){return d.zbs},UZH:function(){return d.UZH},mSO:function(){return d.mSO},wk1:function(){return d.wk1},E2K:function(){return d.E2K},FUD:function(){return d.FUD},pKu:function(){return d.pKu},GG6:function(){return d.GG6},Gih:function(){return d.Gih},iiP:function(){return d.iiP},SvJ:function(){return d.SvJ},ptH:function(){return d.ptH},jZA:function(){return d.jZA},y2t:function(){return d.y2t},gi4:function(){return d.gi4},Djp:function(){return d.Djp},BG$:function(){return d.BG$},NYV:function(){return d.NYV},xJs:function(){return d.xJs},bsb:function(){return d.bsb},ekQ:function(){return d.ekQ},CaW:function(){return d.CaW},eaV:function(){return d.eaV},BFQ:function(){return d.BFQ},v3W:function(){return d.v3W},ILR:function(){return d.ILR},UCm:function(){return d.UCm},Inb:function(){return d.Inb},U1$:function(){return Vn},LgE:function(){return d.LgE},fto:function(){return d.fto},l0P:function(){return d.l0P},vCx:function(){return d.vCx},_AM:function(){return d._AM},wuA:function(){return d.wuA},av9:function(){return d.av9},CtA:function(){return d.CtA},BvQ:function(){return mx},FZJ:function(){return Z_},FIo:function(){return d.FIo},zHn:function(){return d.zHn},iMs:function(){return d.iMs},T_f:function(){return d.T_f},hEm:function(){return d.hEm},D9w:function(){return d.D9w},sHH:function(){return qy},CdI:function(){return d.CdI},rkc:function(){return dA},rpg:function(){return d.rpg},ce8:function(){return d.ce8},rOj:function(){return d.rOj},P6m:function(){return d_},JA6:function(){return GE},V4E:function(){return d.V4E},o8S:function(){return d.o8S},flB:function(){return b_},DUH:function(){return aN},KI_:function(){return d.KI_},iLN:function(){return U1},jsw:function(){return bu},srG:function(){return y2},i6Z:function(){return N1},vfv:function(){return $C},xsS:function(){return d.xsS},or:function(){return q2},EQj:function(){return mm},ov0:function(){return JS},WdD:function(){return d.WdD},Vj0:function(){return d.Vj0},jyz:function(){return d.jyz},mTM:function(){return T_},Mn1:function(){return Du},Hlq:function(){return Au},Fi7:function(){return Tv},Tn7:function(){return d.Tn7},bnF:function(){return d.bnF},HW6:function(){return d.HW6},oa8:function(){return d.oa8},T_1:function(){return d.T_1},zHJ:function(){return Fv},iDF:function(){return d.iDF},iAb:function(){return d.iAb},d4E:function(){return JT},lBg:function(){return Q2},JeJ:function(){return xP},FKY:function(){return _e},zlZ:function(){return AI},vkg:function(){return xA},brh:function(){return p_},kZK:function(){return Uv},puG:function(){return G2},OdW:function(){return d.OdW},_YX:function(){return d._YX},TUv:function(){return d.TUv},Hw6:function(){return d.Hw6},aLr:function(){return d.aLr},Aip:function(){return d.Aip},xo$:function(){return d.xo$},bIn:function(){return MF},$V:function(){return d.$V},lDi:function(){return d.lDi},gti:function(){return d.gti},PMe:function(){return d.PMe},iwP:function(){return Uy},FvO:function(){return d.FvO},jyi:function(){return d.jyi},xeV:function(){return d.xeV},k74:function(){return d.k74},RlZ:function(){return d.RlZ},KhW:function(){return d.KhW},HgB:function(){return d.HgB},W2J:function(){return d.W2J},JWc:function(){return d.JWc},u37:function(){return d.u37},Z6B:function(){return d.Z6B},QZ1:function(){return d.QZ1},Ir4:function(){return d.Ir4},NwF:function(){return d.NwF},Wbm:function(){return d.Wbm},N4l:function(){return d.N4l},ej9:function(){return xw},QmN:function(){return d.QmN},IOt:function(){return d.IOt},NOD:function(){return bx},L5g:function(){return d.L5g},H$k:function(){return d.H$k},cuP:function(){return fp},xEZ:function(){return d.xEZ},dpR:function(){return d.dpR},wOD:function(){return Cm},KNb:function(){return zM},IiN:function(){return Bx},Cne:function(){return d.Cne},XvJ:function(){return d.XvJ},XZw:function(){return d.XZw},FE5:function(){return d.FE5},lVp:function(){return yC},CJI:function(){return d.CJI},z$h:function(){return d.z$h},UlW:function(){return d.UlW},WwZ:function(){return d.WwZ},Lcc:function(){return d.Lcc},WXh:function(){return d.WXh},Vjr:function(){return MD},LuM:function(){return lR},LP5:function(){return LO},xfE:function(){return d.xfE},qlB:function(){return d.qlB},lCJ:function(){return d.lCJ},WTc:function(){return d.WTc},rAo:function(){return d.rAo},LZj:function(){return KT},xWb:function(){return d.xWb},gH0:function(){return d.gH0},rBU:function(){return d.rBU},rDY:function(){return d.rDY},ywz:function(){return d.ywz},wJv:function(){return d.wJv},JQ4:function(){return d.JQ4},k0A:function(){return d.k0A},irR:function(){return d.irR},LsT:function(){return d.LsT},q5h:function(){return M1},TKh:function(){return cP},tyg:function(){return FM},Ro5:function(){return Ny},dwk:function(){return d.dwk},FM8:function(){return d.FM8},Pa4:function(){return d.Pa4},Ltg:function(){return d.Ltg},yC1:function(){return d.yC1},lHq:function(){return xx},fO1:function(){return d.fO1},oMA:function(){return Wm},JzW:function(){return j},QEt:function(){return DE},b5g:function(){return d.b5g},Ywn:function(){return d.Ywn},GVz:function(){return d.GVz},oAp:function(){return d.oAp},kFz:function(){return d.kFz},p7A:function(){return d.p7A},dd2:function(){return d.dd2},CP7:function(){return d.CP7},fQK:function(){return d.fQK},Wd$:function(){return $T},t1_:function(){return pR},Uk6:function(){return d.Uk6},_sL:function(){return d._sL},Pnf:function(){return d.Pnf},c8b:function(){return d.c8b},_lf:function(){return d._lf},ad5:function(){return d.ad5},sZV:function(){return aP},TfA:function(){return es},sKX:function(){return I1},UdM:function(){return io},P0y:function(){return NA},L_r:function(){return d.L_r},Bve:function(){return LE},UeO:function(){return Kv},$nx:function(){return PP},Bk6:function(){return ku},y4l:function(){return w1},pQ0:function(){return P1},wXW:function(){return s3},r5x:function(){return n3},MSI:function(){return l3},EUu:function(){return IF},jtH:function(){return $A},T0T:function(){return vC},gAb:function(){return eP},iwT:function(){return Ex},je_:function(){return UO},wBP:function(){return ux},LU2:function(){return rC},wQL:function(){return PF},Zs7:function(){return p2},x7s:function(){return x3},Mnd:function(){return RF},A0_:function(){return kF},d73:function(){return u2},HCD:function(){return ds},RG9:function(){return is},G2P:function(){return W_},XLf:function(){return q1},CGN:function(){return _T},mvg:function(){return oS},Hiy:function(){return kw},XMc:function(){return r3},N7M:function(){return e3},iv:function(){return o3},n55:function(){return gu},IaC:function(){return Ov},h9t:function(){return yT},yDW:function(){return AT},gJv:function(){return ex},l$g:function(){return Y3},vQi:function(){return DO},$MY:function(){return GM},wJl:function(){return jS},Z7Y:function(){return tC},X7D:function(){return nC},BnX:function(){return W1},uZ5:function(){return G0},zVI:function(){return JB},DpF:function(){return rw},nNb:function(){return V_},cqZ:function(){return t_},pKN:function(){return t2},d_$:function(){return JM},DdI:function(){return JP},rrX:function(){return n2},KlC:function(){return $M},KVn:function(){return wr},oau:function(){return vD},aw9:function(){return Cl},Aap:function(){return ro},Dxg:function(){return an},MjT:function(){return Hu},F7Q:function(){return gT},IFq:function(){return _R},IJl:function(){return H1},O5A:function(){return E_},wCn:function(){return Ml},gGT:function(){return mT},pEc:function(){return jB},Bi6:function(){return _A},fi_:function(){return C3},TT:function(){return pN},q2Z:function(){return wF},NyK:function(){return go},bgu:function(){return y1},kcS:function(){return Gv},rRN:function(){return kD},ivY:function(){return Wt},_s1:function(){return jF},_HO:function(){return Tr},tpL:function(){return kr},DMK:function(){return rE},LjN:function(){return OM},iFs:function(){return yv},qTg:function(){return Ft},Wtl:function(){return Ds},DmK:function(){return ms},Htt:function(){return QO},Hx7:function(){return br},imt:function(){return Gs},US6:function(){return uS},vZs:function(){return ZM},TE$:function(){return BF},lmu:function(){return Tu},SvO:function(){return Wp},YQY:function(){return GA},mZN:function(){return eC},VvG:function(){return vT},omp:function(){return W3},utz:function(){return aS},TFV:function(){return wv},hrz:function(){return nn},JKM:function(){return fD},jZf:function(){return gR},RjL:function(){return rR},RRI:function(){return A3},RUq:function(){return q3},_t4:function(){return zv},YHh:function(){return w_},R8g:function(){return Kn},Bbl:function(){return wA},V9r:function(){return Ut},PZ2:function(){return Ht},w7A:function(){return Jt},N6S:function(){return $n},Uxp:function(){return xr},tAz:function(){return er},R$F:function(){return on},N33:function(){return Wn},gw2:function(){return R1},KlU:function(){return un},wo6:function(){return M_},H4P:function(){return zt},swA:function(){return Oy},_Z3:function(){return Ly},ivc:function(){return V_},rZ1:function(){return t_},CpZ:function(){return S3},dyc:function(){return Zt},MxZ:function(){return EN},btp:function(){return SN},mXy:function(){return PD},Ej0:function(){return Go},ep4:function(){return $l},DQP:function(){return qu},VNr:function(){return rp},V7q:function(){return C_},zEk:function(){return Iu},qfq:function(){return vm},piB:function(){return zn},IIc:function(){return TF},rrF:function(){return om},naq:function(){return Ju},sXR:function(){return nE},p5I:function(){return gC},wps:function(){return tP},wuo:function(){return yR},GpE:function(){return jt},F4b:function(){return XA},t$v:function(){return Bm},tdn:function(){return _E},Y9t:function(){return MC},GEo:function(){return Zw},DH3:function(){return i3},uxM:function(){return qB},zH3:function(){return YB},MLs:function(){return zA},xXG:function(){return So},YM4:function(){return cx},B3r:function(){return vR},iAx:function(){return cM},lDn:function(){return On},oaQ:function(){return G1},CD7:function(){return q_},Rc0:function(){return Z1},iPG:function(){return s_},TIc:function(){return Pw},xsC:function(){return c3},zOc:function(){return po},r46:function(){return f3},z2C:function(){return hn},_X$:function(){return AA},_yn:function(){return wo},Dyg:function(){return x0},cUc:function(){return Rw},zGw:function(){return tE},Ctq:function(){return pD},$ch:function(){return OF},k5b:function(){return lS},kZl:function(){return h2},OCg:function(){return gD},YjH:function(){return w3},Ui8:function(){return xR},YD2:function(){return H0},vi9:function(){return VO},ij3:function(){return t3},YPW:function(){return ZB},Bg1:function(){return EF},kon:function(){return dn},M3g:function(){return Jw},F2z:function(){return Lv},pJF:function(){return H3},knz:function(){return d.knz},Ejo:function(){return sn},BgY:function(){return Ps},qCG:function(){return Qn},HD9:function(){return Xr},fEB:function(){return ba},Udc:function(){return Do},ZQg:function(){return Js},ofC:function(){return Br},yRy:function(){return ip},_NL:function(){return NE},LCA:function(){return Qo},j1w:function(){return D_},i8J:function(){return VF},p7C:function(){return Fl},ZAS:function(){return Pv},ipH:function(){return LF},$TF:function(){return HO},uZI:function(){return NF},VWG:function(){return rD},pQ7:function(){return Ky},STw:function(){return r_},jc8:function(){return Dw},BL_:function(){return a1},S6:function(){return zF},T8U:function(){return BS},TD6:function(){return j0},akS:function(){return sD},QKE:function(){return XB},dKx:function(){return mn},OvX:function(){return jO},VsW:function(){return ou},YMc:function(){return GO},aPg:function(){return Us},LFn:function(){return b0},wey:function(){return km},MaE:function(){return No},s4x:function(){return cv},FJA:function(){return xl},vIA:function(){return yp},Spv:function(){return ho},w8l:function(){return Sy},riG:function(){return uo},Kbh:function(){return Fm},t8K:function(){return ls},Q7n:function(){return rs},KGF:function(){return Jl},e5:function(){return pn},Rik:function(){return UM},GZo:function(){return T1},Bds:function(){return zw},HTu:function(){return Hm},cTq:function(){return S_},X_Y:function(){return zS},dA8:function(){return US},bwS:function(){return dD},Lks:function(){return FF},Rvq:function(){return zO},P4F:function(){return cN},Pd0:function(){return $p},Pjo:function(){return hD},Tum:function(){return xn},dRH:function(){return Jp},RX0:function(){return fv},reQ:function(){return UF},cWm:function(){return a3},NC9:function(){return WB},$Re:function(){return lP},Xo9:function(){return NM},LNO:function(){return C1},iZP:function(){return jw}});var j,_={};__webpackgi_require__.r(_),__webpackgi_require__.d(_,{AsyncCompress:function(){return _n},AsyncDecompress:function(){return Wr},AsyncDeflate:function(){return Rt},AsyncGunzip:function(){return Jn},AsyncGzip:function(){return _n},AsyncInflate:function(){return $t},AsyncUnzipInflate:function(){return yl},AsyncUnzlib:function(){return fr},AsyncZipDeflate:function(){return Bs},AsyncZlib:function(){return Ur},Compress:function(){return gn},DecodeUTF8:function(){return Xn},Decompress:function(){return Mr},Deflate:function(){return Tt},EncodeUTF8:function(){return kn},Gunzip:function(){return Nn},Gzip:function(){return gn},Inflate:function(){return Kt},Unzip:function(){return VE},UnzipInflate:function(){return _l},UnzipPassThrough:function(){return $s},Unzlib:function(){return Yr},Zip:function(){return Fs},ZipDeflate:function(){return eo},ZipPassThrough:function(){return Ns},Zlib:function(){return Cr},compress:function(){return An},compressSync:function(){return Ln},decompress:function(){return ws},decompressSync:function(){return fo},deflate:function(){return Nt},deflateSync:function(){return kt},gunzip:function(){return tr},gunzipSync:function(){return jn},gzip:function(){return An},gzipSync:function(){return Ln},inflate:function(){return en},inflateSync:function(){return ln},strFromU8:function(){return gr},strToU8:function(){return qn},unzip:function(){return ss},unzipSync:function(){return dI},unzlib:function(){return _r},unzlibSync:function(){return Qr},zip:function(){return $o},zipSync:function(){return Im},zlib:function(){return Er},zlibSync:function(){return qr}}),function(c){c[c.Error=-2]="Error",c[c.Destroyed=-1]="Destroyed",c[c.None=0]="None",c[c.Running=1]="Running",c[c.Paused=2]="Paused"}(j||(j={}));class _e{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,i){const s=this._eventListeners;s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i)}hasEventListener(e,i){const s=this._eventListeners;return s[e]!==void 0&&s[e].includes(i)}removeEventListener(e,i){const s=this._eventListeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){const i=this._eventListeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}}}var d=__webpackgi_require__(988);const it={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class ct{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const pt=new d.iKG(-1,1,1,-1,0,1),At=new d.u9r;At.setAttribute("position",new d.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),At.setAttribute("uv",new d.a$l([0,2,0,0,2,0],2));class St{constructor(e){this._mesh=new d.Kj0(At,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,pt)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Ot extends ct{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof d.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=d.rDY.clone(e.uniforms),this.material=new d.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new St(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Qt extends ct{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const a=e.getContext(),h=e.state;let g,$;h.buffers.color.setMask(!1),h.buffers.depth.setMask(!1),h.buffers.color.setLocked(!0),h.buffers.depth.setLocked(!0),this.inverse?(g=0,$=1):(g=1,$=0),h.buffers.stencil.setTest(!0),h.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),h.buffers.stencil.setFunc(a.ALWAYS,g,4294967295),h.buffers.stencil.setClear($),h.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),h.buffers.color.setLocked(!1),h.buffers.depth.setLocked(!1),h.buffers.stencil.setLocked(!1),h.buffers.stencil.setFunc(a.EQUAL,1,4294967295),h.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),h.buffers.stencil.setLocked(!0)}}class Yt extends ct{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new d.iKG(-1,1,1,-1,0,1);const Vt=new d.u9r;Vt.setAttribute("position",new d.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Vt.setAttribute("uv",new d.a$l([0,2,0,0,2,0],2));class qt extends class{constructor(e,i){if(this.renderer=e,i===void 0){const s=e.getSize(new d.FM8);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new d.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],it===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Ot===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Ot(it),this.clock=new d.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let a=0,h=this.passes.length;a<h;a++){const g=this.passes[a];if(g.enabled!==!1){if(g.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),g.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),g.needsSwap){if(s){const $=this.renderer.getContext(),nt=this.renderer.state.buffers.stencil;nt.setFunc($.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),nt.setFunc($.EQUAL,1,4294967295)}this.swapBuffers()}Qt!==void 0&&(g instanceof Qt?s=!0:g instanceof Yt&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new d.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(s,a),this.renderTarget2.setSize(s,a);for(let h=0;h<this.passes.length;h++)this.passes[h].setSize(s,a)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}function Jt(c,e){let i;do i=Object.getOwnPropertyDescriptor(c,e);while(!i&&(c=Object.getPrototypeOf(c)));return i}function jt(c,e,i=!1,s=!1){const a=Jt(c,e);return!!(a!=null&&a.set)||i&&(a==null?void 0:a.writable)!==!1&&(a==null?void 0:a.get)===void 0||s&&!a}function sn(c,e,i,s=!1,a=!1){return!(!c||!jt(c,e,s,a)||(c[e]=i,0))}function Ft(c,e){for(;c.length>0;){if(!e)return;const i=c.splice(0,1)[0];if(!(i.length<1)){if(!(i in e))return console.error("invalid access, check",i,e),e;e=e[i]}}return e}function Ut(c,e){return Object.keys(c).find(i=>c[i]===e)}function Ht(c,...e){return typeof c=="function"&&(c=c(...e)),c}function an(c,e,i){for(const s of i){const a=c[s];a!==void 0&&sn(e,s,a,!0)}}function nn(c){return c.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function dn(c,e,i){return c.replace(new RegExp(nn(e),"g"),i)}const zt=(c,...e)=>String.raw({raw:c},...e),Wt=(c,...e)=>String.raw({raw:c},...e),Zt=(c,...e)=>String.raw({raw:c},...e),mn=(c,...e)=>{let i=String.raw({raw:c},...e);return i=dn(i,"%","%25"),i=dn(i,"> <","><"),i=dn(i,"; }",";}"),i=dn(i,"<","%3c"),i=dn(i,">","%3e"),i=dn(i,'"',"'"),i=dn(i,"#","%23"),i=dn(i,"{","%7b"),i=dn(i,"}","%7d"),i=dn(i,"|","%7c"),i=dn(i,"^","%5e"),i=dn(i,"`","%60"),i=dn(i,"@","%40"),i=dn(i,"&","&amp;"),i=dn(i,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+i};function hn(c){if(!c)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,i)=>{let s=e[i];Object.defineProperty(e,i,{get:()=>s,set(a){var h;if(s===a)return;s=a;const g=[i,a];if(typeof c=="string")(h=this[c])===null||h===void 0||h.call(this,...g);else if(typeof c=="function"){let $=!1;if(c.name){let nt=this;for(;nt;){if(nt[c.name]===c){c.call(this,...g),$=!0;break}nt=Object.getPrototypeOf(nt)}}$||(c.name&&this[c.name].name===`bound ${c.name}`?this[c.name](...g):c(...g))}}})}}function zn(c,e){for(const i of e)if(!c.includes(i))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(c,e){return Object.prototype.toString.call(c).toLowerCase()==="[object regexp]"?this.replace(c,e):this.replace(new RegExp(c,"g"),e)});class lr{constructor(e=0,i=0){lr.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,a=e.elements;return this.x=a[0]*i+a[3]*s+a[6],this.y=a[1]*i+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),a=Math.sin(i),h=this.x-e.x,g=this.y-e.y;return this.x=h*s-g*a+e.x,this.y=h*a+g*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ar extends d.ZzF{expandByObject(e,i=!1,s=!1){var a;if(((a=e.userData)===null||a===void 0?void 0:a.bboxVisible)===!1)return this;if(!e.visible&&s)return this;e.updateWorldMatrix(!1,!1);const h=e.geometry;if(h!==void 0)if(i&&h.attributes!=null&&h.attributes.position!==void 0){const $=h.attributes.position;for(let nt=0,rt=$.count;nt<rt;nt++)Zn.fromBufferAttribute($,nt).applyMatrix4(e.matrixWorld),this.expandByPoint(Zn)}else h.boundingBox===null&&h.computeBoundingBox(),ur.copy(h.boundingBox),ur.applyMatrix4(e.matrixWorld),this.union(ur);const g=e.children;for(let $=0,nt=g.length;$<nt;$++)this.expandByObject(g[$],i,s);return this}expandByObjects(e,i=!1,s=!1){for(let a=0,h=e.length;a<h;a++)this.expandByObject(e[a],i,s);return this}getPoints(){return[new d.Pa4(this.min.x,this.min.y,this.min.z),new d.Pa4(this.min.x,this.min.y,this.max.z),new d.Pa4(this.min.x,this.max.y,this.min.z),new d.Pa4(this.min.x,this.max.y,this.max.z),new d.Pa4(this.max.x,this.min.y,this.min.z),new d.Pa4(this.max.x,this.min.y,this.max.z),new d.Pa4(this.max.x,this.max.y,this.min.z),new d.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new d.TUj;for(const a of i){const h=a.project(e);s.min.min(h),s.max.max(h)}return s}}const ur=new ar,Zn=new d.Pa4;function wr(c,e){let i,s;if(Array.isArray(c))for(const h of c){const g=wr(h,e);i===void 0||s===void 0?(i=g.min.clone(),s=g.max.clone()):(i.min(g.min),s.max(g.max))}const a=c;if(a.geometry!==void 0){const h=a.geometry.vertices;if(h===void 0&&a.geometry.attributes!==void 0&&"position"in a.geometry.attributes){const g=new d.Pa4,$=a.geometry.attributes.position;for(let nt=0;nt<$.count*$.itemSize;nt+=$.itemSize){g.set($.array[nt],$.array[nt+1],$.array[3]);const rt=g.applyMatrix4(c.matrixWorld).project(e),st=new lr(rt.x,rt.y);i===void 0||s===void 0?(i=st.clone(),s=st.clone()):(i.min(st),s.max(st))}}else for(const g of h){const $=g.clone().applyMatrix4(c.matrixWorld).project(e),nt=new lr($.x,$.y);i===void 0||s===void 0?(i=nt.clone(),s=nt.clone()):(i.min(nt),s.max(nt))}}if(c.children!==void 0)for(const h of c.children){const g=wr(h,e);i===void 0||s===void 0?(i=g.min.clone(),s=g.max.clone()):(i.min(g.min),s.max(g.max))}return new d.TUj(i,s)}const Vn=3005;function Kn(c){switch(c){case d.rnI:return["Linear","( value )"];case d.knz:return["sRGB","( value )"];case Vn:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",c),["Linear","( value )"]}}function un(c,e){let i;return c&&c.isTexture?i=c.encoding:c&&c.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=c.texture.encoding):i=d.rnI,e&&c&&c.isTexture&&c.format===d.wk1&&c.type===d.ywz&&c.encoding===d.knz&&(i=d.rnI),i}function er(c,e){const i=Kn(e);return"vec4 "+c+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function $n(c,e,i){return er(c+"TexelToLinear",un(e,i))+`
`}function xr(c,e){return er(c+"TexelToLinear",e)+`
`}function Wn(c,e){const i=Kn(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function on(c,e,i){return Wn(c,un(e,i))}function pn({uniforms:c,propKey:e,thisTarget:i=!1}={}){const s=!!c,a=!!e,h=i;return(g,$)=>{const nt=rt=>{const st=h?rt:s?c:rt.uniforms||rt._uniforms;let ut=a?e:$;h&&(ut="_"+ut);let mt=st[ut];return mt||(mt={value:null},st[ut]=mt),mt};Object.defineProperty(g,$,{get(){return nt(this).value},set(rt){nt(this).value=rt,sn(this,"uniformsNeedUpdate",!0,!0)}})}}function On(c,e,i=!1,s){const a=!!e,h=!!c;return(g,$)=>{const nt=rt=>({t:a?e:rt.defines||rt._defines,p:h?c:$});Object.defineProperty(g,$,{get(){const{t:rt,p:st}=nt(i?this:this.material);return rt[st]},set(rt){const{t:st,p:ut}=nt(i?this:this.material);if(sn(st,ut,rt,!0),typeof s=="function"){const mt=[ut,rt];if(s.name){const gt=this[s.name];gt===s?s.call(this,...mt):gt.name===`bound ${s.name}`?gt(...mt):s(...mt)}else s(...mt)}else sn(i?this:this.material,"needsUpdate",!0,!0)}})}}function Tr(c){const e=new d.IEO(new Uint8Array([Math.floor(255*c.r),Math.floor(255*c.g),Math.floor(255*c.b),255]),1,1,d.wk1,d.ywz);return e.needsUpdate=!0,e.encoding=d.rnI,e}function kr(c){const e=new d.IEO(new Uint8Array([Math.floor(255*c.x),Math.floor(255*c.y),Math.floor(255*c.z),Math.floor(255*c.w)]),1,1,d.wk1,d.ywz);return e.needsUpdate=!0,e}function Br(c,e,i){const s=c.userData,{backgroundRender:a,transparentRender:h,shadowMapRender:g,mainRenderPass:$,opaqueRender:nt,transmissionRender:rt,sceneRender:st,screenSpaceRendering:ut}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=a,s.transparentRender=h,s.shadowMapRender=g,s.mainRenderPass=$,s.opaqueRender=nt,s.sceneRender=st,s.transmissionRender=rt,s.screenSpaceRendering=ut}function ds(c){const e=new ar().expandByObject(c,!0,!0).getCenter(new d.Pa4);c.position.sub(e),c.updateMatrix(),c.userData.autoCentered=!0}function is(c,e){const i=.5*new ar().expandByObject(c,!0,!0).getSize(new d.Pa4).length();e===void 0&&(e=c.userData.autoScaleRadius||1);const s=e/i;return isFinite(s)&&(c.userData.pseudoCentered?c.children.forEach(a=>{a.scale.multiplyScalar(s)}):c.scale.multiplyScalar(s)),c.traverse(a=>{var h,g;a.isLight&&(!((g=(h=a.shadow)===null||h===void 0?void 0:h.camera)===null||g===void 0)&&g.right)&&(a.shadow.camera.right*=s,a.shadow.camera.left*=s,a.shadow.camera.top*=s,a.shadow.camera.bottom*=s),a.isCamera&&a.right&&(a.right*=s,a.left*=s,a.top*=s,a.bottom*=s)}),c.userData.autoScaled=!0,c.userData.autoScaleRadius=e,c.dispatchEvent({type:"objectUpdate"}),c}function Us(c,e=-1){return function(i,s=1e-4){const a=s>0;s=Math.max(s,Number.EPSILON);const h={},g=i.getIndex(),$=i.getAttribute("position"),nt=g?g.count:$.count;let rt=0;const st=Object.keys(i.attributes),ut={},mt={},gt=[],yt=["getX","getY","getZ","getW"];for(let Ct=0,xt=st.length;Ct<xt;Ct++){const Bt=st[Ct];ut[Bt]=[];const Lt=i.morphAttributes[Bt];Lt&&(mt[Bt]=new Array(Lt.length).fill().map(()=>[]))}const wt=Math.log10(1/s),It=Math.pow(10,wt);for(let Ct=0;Ct<nt;Ct++){const xt=g?g.getX(Ct):Ct;let Bt="";for(let Lt=0,Gt=st.length;Lt<Gt&&a;Lt++){const Xt=st[Lt],rn=i.getAttribute(Xt),fn=rn.itemSize;for(let wn=0;wn<fn;wn++)Bt+=~~(rn[yt[wn]](xt)*It)+","}if(a&&Bt in h)gt.push(h[Bt]);else{for(let Lt=0,Gt=st.length;Lt<Gt;Lt++){const Xt=st[Lt],rn=i.getAttribute(Xt),fn=i.morphAttributes[Xt],wn=rn.itemSize,Cn=ut[Xt],bn=mt[Xt];for(let Dn=0;Dn<wn;Dn++){const En=yt[Dn];if(Cn.push(rn[En](xt)),fn)for(let Tn=0,Un=fn.length;Tn<Un;Tn++)bn[Tn].push(fn[Tn][En](xt))}}a&&(h[Bt]=rt),gt.push(rt),rt++}}const Et=i.clone();for(let Ct=0,xt=st.length;Ct<xt;Ct++){const Bt=st[Ct],Lt=i.getAttribute(Bt),Gt=new Lt.array.constructor(ut[Bt]),Xt=new d.TlE(Gt,Lt.itemSize,Lt.normalized);if(Et.setAttribute(Bt,Xt),Bt in mt)for(let rn=0;rn<mt[Bt].length;rn++){const fn=i.morphAttributes[Bt][rn],wn=new fn.array.constructor(mt[Bt][rn]),Cn=new d.TlE(wn,fn.itemSize,fn.normalized);Et.morphAttributes[Bt][rn]=Cn}}return Et.setIndex(gt),Et}(c,e)}class Os extends _e{constructor({animationLoop:e,canvas:i,alpha:s=!0,targetOptions:a}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new d.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new d.CP7({canvas:i,antialias:!0,alpha:s,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new d.FM8(i.clientWidth,i.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=d.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=d.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=d._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(a,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new qt(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,i,s;const a=this._passes,h=[],g={};for(const $ of a){if($.enabled===!1)continue;const nt={after:(e=$.after)!==null&&e!==void 0?e:[],before:(i=$.before)!==null&&i!==void 0?i:[],dependencies:new Set((s=$.required)!==null&&s!==void 0?s:[])};g[$.passId]=nt}for(const[$,nt]of Object.entries(g)){const rt=new Set([...nt.after,...nt.before]);nt.dependencies.forEach(st=>rt.has(st)&&rt.delete(st)),rt.forEach(st=>{const ut=g[st];if(ut){if(ut.dependencies.has($))throw console.error("cyclic",$,st),"Cyclic dependency";nt.dependencies.add(st)}})}for(;;){let $=!1;const nt=[...Object.entries(g)];for(const[rt,st]of nt)if(!h.includes(rt)&&zn(h,st.dependencies.values())){const ut=Math.max(-1,...st.after.map(gt=>h.indexOf(gt))),mt=Math.min(h.length,...st.before.map(gt=>{const yt=h.indexOf(gt);return yt<0?h.length:yt}));if(ut>=mt)throw console.error(st,a,h,ut,mt),"Not possible";h.splice(st.after.length>0?ut+1:mt,0,rt),$=!0,delete g[rt]}if(Object.keys(g).length<1)break;if(!$)throw console.log(nt,g,h),"Not possible 2"}return this.pipeline=h,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,i){const s=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=s,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:s,time:e,renderer:this,xrFrame:i}))}get clock(){return this._composer.clock}registerPass(e,i=!0){var s;if(i)for(const a of[...this._passes])e.passId===a.passId&&this.unregisterPass(a);this._passes.push(e),(s=e.onRegister)===null||s===void 0||s.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var i;const s=this._passes.indexOf(e);s>=0&&((i=e.onUnregister)===null||i===void 0||i.call(e,this),this._passes.splice(s,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,i,s=!1){!s&&(e?Math.abs(e-this._renderSize.width):0)+(i?Math.abs(i-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),i&&(this._renderSize.height=i),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(a=>{const h=a,g=h.sizeMultiplier;if(g){const $=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*g);h.setSize($.width,$.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,i,{viewport:s,material:a,shader:h,pass:g,clear:$=!0}={}){const nt=this._composer.copyPass,{renderToScreen:rt,material:st,uniforms:ut,clear:mt}=nt;a&&(nt.material=a);const gt=this._renderer.getViewport(new d.Ltg),yt=this._renderer.autoClear,wt=this._renderer.getRenderTarget();s&&this._renderer.setViewport(new d.Ltg().fromArray(s)),this._renderer.autoClear=!1,nt.uniforms=nt.material.uniforms,nt.renderToScreen=!1,nt.clear=$,Br(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{nt.render(this._renderer,i??null,{texture:e},0,!1)}),nt.renderToScreen=rt,nt.clear=mt,nt.material=st,nt.uniforms=ut,this._renderer.autoClear=yt,s&&this._renderer.setViewport(gt),this._renderer.setRenderTarget(wt)}clearColor({r:e,g:i,b:s,a,target:h,depth:g=!0,stencil:$=!0}){var nt;const rt=this._renderer.getClearColor(new d.Ilk),st=this._renderer.getClearAlpha();this._renderer.setClearAlpha(a??st),this._renderer.setClearColor(new d.Ilk(e??rt.r,i??rt.g,s??rt.b));const ut=this._renderer.getRenderTarget(),mt=this._renderer.getActiveCubeFace(),gt=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((nt=h)!==null&&nt!==void 0?nt:null),this._renderer.clear(!0,g,$),this._renderer.setRenderTarget(ut,mt,gt),this._renderer.setClearColor(rt),this._renderer.setClearAlpha(st)}renderModel(e,i){this._renderer.render(e.modelObject,i.cameraObject)}renderScene(e){const i=e.activeCamera;i&&this.renderModel(e,i)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)===null||e===void 0||e.call(i));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const i of this._pipeline){const s=this._passes.find(a=>a.passId===i);s?e.push(s.passObject):console.warn("Unable to find pass: ",i)}[...this._composer.passes].forEach(i=>this._composer.removePass(i)),e.forEach(i=>this._composer.addPass(i)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const i=this._trackedTargets.indexOf(e);i>=0&&this._trackedTargets.splice(i,1)}createTarget({sizeMultiplier:e,samples:i=0,encoding:s=d.rnI,type:a=d.ywz,format:h=d.wk1,depthBuffer:g=!0,depthTexture:$=!1,size:nt,textureCount:rt=1,...st}={},ut=!0){this.isWebGL2||(i=0),e!==void 0&&nt!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),nt=nt||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const mt=$?new d.$YQ(nt.width,nt.height,d.ywz):void 0,gt=this.createTargetCustom(rt>1?{width:nt.width,height:nt.height,count:rt}:nt,{samples:i,encoding:s,type:a,format:h,depthBuffer:g,depthTexture:mt},rt>1?d.kFz:d.dd2);return this._processNewTarget(gt,e,ut),this._setTargetOptions(gt,st),gt}_processNewTarget(e,i,s){return i!==void 0&&(e.sizeMultiplier=i),s&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:i,count:s},a={},h){var g;const $=this._processNewTarget;let nt=[e,i];if(s&&s>1&&nt.push(s),(h==null?void 0:h.prototype)===d.oAp.prototype){if(e!==i)throw"Width and height of cube render target must be equal";nt=[e]}a={format:d.wk1,minFilter:d.wem,magFilter:d.wem,generateMipmaps:!1,type:d.ywz,encoding:d.rnI,...a};const rt=[...nt,a];return new class extends((g=h)!==null&&g!==void 0?g:d.dd2){constructor(...st){super(...st),Array.isArray(this.texture)?this.texture.forEach(ut=>{ut.encoding=a.encoding,ut.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(st=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const ut=super.clone();return ut.texture.isRenderTargetTexture=!0,$(ut,this.sizeMultiplier||1,st)}}(...rt)}getTempTarget(e={}){var i;const s=go(e);let a;return!((i=this._tempTargets[s])===null||i===void 0)&&i.length&&(a=this._tempTargets[s].pop()),a?this._setTargetOptions(a,e):(a=this.createTarget(e),this._processNewTempTarget(a,s)),a}_processNewTempTarget(e,i){return e.isTemporary=!0,e.targetKey=i,this._tempTargets[i]===void 0&&(this._tempTargets[i]=[]),e}releaseTempTarget(e){const i=e.targetKey;if(!i||!e.isTemporary)throw"Not a temp target";this._tempTargets[i].length>this.maxTempPerKey?e.dispose():this._tempTargets[i].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,i){var s,a,h;e.texture.minFilter=(s=i.minFilter)!==null&&s!==void 0?s:d.wem,e.texture.magFilter=(a=i.magFilter)!==null&&a!==void 0?a:d.wem,e.texture.generateMipmaps=(h=i.generateMipmaps)!==null&&h!==void 0&&h,e.texture.generateMipmaps&&e.texture.minFilter===d.wem&&(e.texture.minFilter=d.FDw),e.texture.generateMipmaps||e.texture.minFilter!==d.FDw||(e.texture.minFilter=d.wem)}}function go(c={}){var e,i;return[c.sizeMultiplier,c.samples,c.encoding,c.type,c.format,c.depthBuffer,c.depthTexture,(e=c.size)===null||e===void 0?void 0:e.width,(i=c.size)===null||i===void 0?void 0:i.height].join(";")}const ks=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function or(){const c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(ks[255&c]+ks[c>>8&255]+ks[c>>16&255]+ks[c>>24&255]+"-"+ks[255&e]+ks[e>>8&255]+"-"+ks[e>>16&15|64]+ks[e>>24&255]+"-"+ks[63&i|128]+ks[i>>8&255]+"-"+ks[i>>16&255]+ks[i>>24&255]+ks[255&s]+ks[s>>8&255]+ks[s>>16&255]+ks[s>>24&255]).toLowerCase()}function to(c,e,i){return Math.max(e,Math.min(i,c))}function co(c,e,i){return(1-i)*c+i*e}const Bl=0,Oo=1,Mo=3,To=4,Io=1006,Hl="srgb",vo="srgb-linear";function no(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function Al(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}const qo={[Hl]:{[vo]:no},[vo]:{[Hl]:Al}},Lo={legacyMode:!0,get workingColorSpace(){return vo},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,e,i){if(this.legacyMode||e===i||!e||!i)return c;if(qo[e]&&qo[e][i]!==void 0){const s=qo[e][i];return c.r=s(c.r),c.g=s(c.g),c.b=s(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,e){return this.convert(c,this.workingColorSpace,e)},toWorkingColorSpace:function(c,e){return this.convert(c,e,this.workingColorSpace)}},Pp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yo={r:0,g:0,b:0},du={h:0,s:0,l:0},Vo={h:0,s:0,l:0};function Mu(c,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?c+6*(e-c)*i:i<.5?e:i<2/3?c+6*(e-c)*(2/3-i):c}function Dp(c,e){return e.r=c.r,e.g=c.g,e.b=c.b,e}class hs{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Lo.toWorkingColorSpace(this,i),this}setRGB(e,i,s,a="srgb-linear"){return this.r=e,this.g=i,this.b=s,Lo.toWorkingColorSpace(this,a),this}setHSL(e,i,s,a="srgb-linear"){if(e=function(h,g){return(h%g+g)%g}(e,1),i=to(i,0,1),s=to(s,0,1),i===0)this.r=this.g=this.b=s;else{const h=s<=.5?s*(1+i):s+i-s*i,g=2*s-h;this.r=Mu(g,h,e+1/3),this.g=Mu(g,h,e),this.b=Mu(g,h,e-1/3)}return Lo.toWorkingColorSpace(this,a),this}setStyle(e,i="srgb"){function s(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let h;const g=a[1],$=a[2];switch(g){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec($))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,Lo.toWorkingColorSpace(this,i),s(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec($))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,Lo.toWorkingColorSpace(this,i),s(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec($)){const nt=parseFloat(h[1])/360,rt=parseFloat(h[2])/100,st=parseFloat(h[3])/100;return s(h[4]),this.setHSL(nt,rt,st,i)}}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const h=a[1],g=h.length;if(g===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,Lo.toWorkingColorSpace(this,i),this;if(g===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,Lo.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i="srgb"){const s=Pp[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=no(e.r),this.g=no(e.g),this.b=no(e.b),this}copyLinearToSRGB(e){return this.r=Al(e.r),this.g=Al(e.g),this.b=Al(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Lo.fromWorkingColorSpace(Dp(this,Yo),e),to(255*Yo.r,0,255)<<16^to(255*Yo.g,0,255)<<8^to(255*Yo.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i="srgb-linear"){Lo.fromWorkingColorSpace(Dp(this,Yo),i);const s=Yo.r,a=Yo.g,h=Yo.b,g=Math.max(s,a,h),$=Math.min(s,a,h);let nt,rt;const st=($+g)/2;if($===g)nt=0,rt=0;else{const ut=g-$;switch(rt=st<=.5?ut/(g+$):ut/(2-g-$),g){case s:nt=(a-h)/ut+(a<h?6:0);break;case a:nt=(h-s)/ut+2;break;case h:nt=(s-a)/ut+4}nt/=6}return e.h=nt,e.s=rt,e.l=st,e}getRGB(e,i="srgb-linear"){return Lo.fromWorkingColorSpace(Dp(this,Yo),i),e.r=Yo.r,e.g=Yo.g,e.b=Yo.b,e}getStyle(e="srgb"){return Lo.fromWorkingColorSpace(Dp(this,Yo),e),e!==Hl?`color(${e} ${Yo.r} ${Yo.g} ${Yo.b})`:`rgb(${255*Yo.r|0},${255*Yo.g|0},${255*Yo.b|0})`}offsetHSL(e,i,s){return this.getHSL(du),du.h+=e,du.s+=i,du.l+=s,this.setHSL(du.h,du.s,du.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(du),e.getHSL(Vo);const s=co(du.h,Vo.h,i),a=co(du.s,Vo.s,i),h=co(du.l,Vo.l,i);return this.setHSL(s,a,h),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function So(c,e){const i=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!c[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!i&&c.map,bounds:[-100,100],stepSize:.001,property:[c[e],"repeat"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"offset"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"center"],onChange:c==null?void 0:c.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!i&&c.map,bounds:[-Math.PI,Math.PI],property:[c[e],"rotation"],onChange:c==null?void 0:c.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[c[e],"encoding"],children:[["Linear",d.rnI],["sRGB",d.knz]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{const s=c[e];s&&(s.needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var s,a;return(a=(s=c[e])===null||s===void 0?void 0:s.flipY)!==null&&a!==void 0&&a},setValue:s=>{var a;const h=c[e];if(h&&h.flipY!==s)if(h.image&&ImageBitmap&&h.image instanceof ImageBitmap){const g=h,$=h.source.data;createImageBitmap($,{imageOrientation:"flipY"}).then(nt=>{var rt;$.close&&$.close(),g.flipY=s,g.source.data=nt,g.source.needsUpdate=!0,g.needsUpdate=!0,(rt=c==null?void 0:c.setDirty)===null||rt===void 0||rt.call(c)})}else h.flipY=s,h.needsUpdate=!0,(a=c==null?void 0:c.setDirty)===null||a===void 0||a.call(c)}}),()=>({type:"dropdown",label:"Wrap S",property:[c[e],"wrapS"],children:[["ClampToEdge",d.uWy],["MirroredRepeat",d.OoA],["Repeat",d.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[c[e],"wrapT"],children:[["ClampToEdge",d.uWy],["MirroredRepeat",d.OoA],["Repeat",d.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[c[e],"anisotropy"],onChange:[()=>{c[e]&&(c[e].needsUpdate=!0),c.needsUpdate=!0},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[c[e],"minFilter"],children:[["Linear",Io],["Nearest",d.TyD],["NearestMipmapNearest",d.YLQ],["NearestMipmapLinear",d.vZf],["LinearMipmapNearest",d.qyh],["LinearMipmapLinear",d.D1R]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[c[e],"magFilter"],children:[["Linear",Io],["Nearest",d.TyD]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]})]}}hs.NAMES=Pp;const $l=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Cl(c,e){if(e)for(const i of Object.keys(e))$l.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const rp=["appliedMaterials","uuid"];function Hu(c,e){if(e)for(const i of Object.keys(e))rp.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const vp=new Map;function Qn(c){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");vp.has(s)||vp.set(s,[]),vp.get(s).push([c||i,i])}}const ba={obj:(c,e)=>Object.fromEntries(Object.entries(c).map(([i,s])=>[i,Xr(s,!1,e)])),vec4:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isVector4:!0}),vec3:c=>({x:c.x,y:c.y,z:c.z,isVector3:!0}),vec2:c=>({x:c.x,y:c.y,isVector2:!0}),color:c=>({r:c.r,g:c.g,b:c.b,isColor:!0}),quat:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isQuaternion:!0}),texture:(c,e)=>{if(!(c!=null&&c.isTexture))throw new Error("Expected a texture");if(c.isRenderTargetTexture)return;if(e!=null&&e.textures[c.uuid])return{uuid:c.uuid,resource:"textures"};const i=c.source.data;c.userData.rootPath&&(c.source.data=null);const s=c.userData;c.userData={};let a=c.toJSON(e);return c.userData=s,a.userData=Xr(Hu({},s),!1,e),c.userData.rootPath&&(delete e.images[c.source.uuid],c.source.data=i),e!=null&&e.textures&&(e.textures[a.uuid]||(e.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(c,e)=>{var i;if(!(c!=null&&c.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[c.uuid])return{uuid:c.uuid,resource:"materials"};c.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const s=e??{textures:{},images:{}},a={},h={};for(const[$,nt]of Object.entries(c))if(!((i=nt)===null||i===void 0)&&i.isTexture&&!$.startsWith("__")){const rt=ba.texture(nt,s);a[$]=rt,h[$]=nt,c[$]=rt?{isTexture:!0,toJSON:()=>rt}:null}let g=c.toJSON(e);for(const[$,nt]of Object.entries(h))c[$]=nt,delete h[$];if(e){for(const[$,nt]of Object.entries(a))nt&&(g[$]=nt);e!=null&&e.materials&&(e.materials[g.uuid]||(e.materials[g.uuid]=g),g={uuid:g.uuid,resource:"materials"})}else{for(const[$,nt]of Object.entries(a))g[$]=nt.uuid;g.textures=Object.values(s.textures),g.images=Object.values(s.images)}return g}},Wu=c=>(e,i)=>{var s,a;return(a=(s=i==null?void 0:i.copy)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:new c().copy(e)},Gs={obj:(c,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(c).map(([s,a])=>[s,br(a,e==null?void 0:e[s],!1,i)]))),vec4:Wu(d.Ltg),vec3:Wu(d.Pa4),vec2:Wu(lr),color:Wu(hs),quat:Wu(d._fP)};function Xr(c,e,i){var s,a;if(typeof c=="function")return;if(Array.isArray(c))return c.map($=>Xr($,!1,i));if(typeof c!="object"){if(typeof c=="number"){if(c===1/0)return"Infinity";if(c===-1/0)return"-Infinity";if(isNaN(c))return"NaN"}return c}if(!c)return c;let h=(s=c.constructor)!==null&&s!==void 0?s:Object;if(h===Object)return ba.obj(c,i);if(c.isVector2)return ba.vec2(c);if(c.isVector3)return ba.vec3(c);if(c.isVector4)return ba.vec4(c);if(c.isColor)return ba.color(c);if(c.isQuaternion)return ba.quat(c);if(c.isTexture)return ba.texture(c,i);if(c.isMaterial)return ba.material(c,i);if(!e&&typeof c.toJSON=="function")return c.toJSON(i);const g={};for(;h&&h!==Object;)(a=vp.get(h))===null||a===void 0||a.forEach(([$,nt])=>{const rt=c[nt];g[$]=Xr(rt,!1,i)}),h=Object.getPrototypeOf(h);return c.serializableClassId&&(g.serializableClassId=c.serializableClassId),g}function br(c,e,i,s){var a,h,g;let $=e;if(c===void 0)return $;if(typeof e=="number"){if(c==="Infinity")return 1/0;if(c==="-Infinity")return-1/0;if(c==="NaN")return NaN;if(typeof c=="number"||!c)return c}if(Array.isArray(c)){const st=c.length;Array.isArray($)||($=[]);for(let ut=0;ut<st;ut++){const mt=c[ut],gt=$.length>ut?br(mt,$[ut],!1,s):br(mt,void 0,!1,s);$.length<=ut?$.push(gt):$[ut]=gt}return $}let nt=!1;if(c&&c.resource&&typeof c.resource=="string"&&(c=(a=s[c.resource])===null||a===void 0?void 0:a[c.uuid],nt=!0),!$&&c&&!nt)if(c.serializableClassId){const st=Is.get(c.serializableClassId);st&&($=new st)}else typeof c!="object"||c.constructor&&c.constructor!==Object||($={});if(typeof $=="function")return console.error("cannot deserialize over function",$,c),$;if(c&&typeof c=="object"&&!nt){if(c.isVector2)return Gs.vec2(c,$);if(c.isVector3)return Gs.vec3(c,$);if(c.isVector4)return Gs.vec4(c,$);if(c.isColor)return Gs.color(c,$);if(c.isQuaternion)return Gs.quat(c,$)}if(c==null||$==null||typeof $!="object"||$.isTexture)return nt&&(c?c.__useCount=c.__useCount?c.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),c;let rt=(h=$.constructor)!==null&&h!==void 0?h:Object;if(rt===Object)return Gs.obj(c,$,s);if(!i&&typeof $.fromJSON=="function")return $.isMaterial&&(Object.entries(c).forEach(([st,ut])=>{var mt;if(!ut||!ut.resource||typeof ut.resource!="string")return;const gt=(mt=s[ut.resource])===null||mt===void 0?void 0:mt[ut.uuid];c[st]=gt||null}),c.userData&&(c.userData=br(c.userData,void 0,!1,s))),$.fromJSON(c,s),$;for(;rt&&rt!==Object;)(g=vp.get(rt))===null||g===void 0||g.forEach(([st,ut])=>{const mt=$[ut],gt=br(c[st],mt,!1,s);gt!==mt&&sn($,ut,gt,!0)}),rt=Object.getPrototypeOf(rt);return $}const Is=new Map;function Ps(c){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=c}},Is.set(c,e),e)}function bs(c,e){if(c.uiConfig)return c.uiConfig;const i={type:"folder",label:c.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[c,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{c.dispatchEvent({type:"select",ui:!0,value:c,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!c.parent,value:()=>{const a=c.parent;a&&a.dispatchEvent({type:"select",ui:!0,value:a})}},{type:"input",label:"Name",property:[c,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!c.isMesh,property:[c,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!c.isMesh,property:[c,"receiveShadow"]},{type:"vec3",label:"Position",property:[c,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[c,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[c,"scale"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",c.userData.autoScaleRadius||"2",!0],value:a=>{if(!a)return;const h=parseFloat(a);Math.abs(h)>0&&is(c,h)}},c.userData.license!==void 0?{type:"input",label:"License/Credits",property:[c.userData,"license"],limitedUi:!0}:{}]},s=c;if(s!=null&&s.isMesh&&e!==!1){const a=[()=>{var h;return(h=s.geometry)===null||h===void 0?void 0:h.uiConfig},()=>{var h;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(g=>g==null?void 0:g.uiConfig).filter(g=>g)}:(h=s.material)===null||h===void 0?void 0:h.uiConfig}];i.children.push(...a)}if(c!=null&&c.isCamera){const a=[{type:"button",label:"Set View",value:()=>{c.dispatchEvent({type:"setView",ui:!0,camera:c})}},{type:"button",label:"Activate main",hidden:()=>{var h;return(h=c.userData.iCamera)===null||h===void 0?void 0:h.isActiveCamera},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:c})}},{type:"button",label:"Deactivate main",hidden:()=>{var h;return!(!((h=c.userData.iCamera)===null||h===void 0)&&h.isActiveCamera)},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];i.children.push(...a)}return c.uiConfig=i,i}function Qo(c,e,i){var s;if(!c)return void console.warn("setupIModel: object is undefined");if(c.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",c),delete c.__disposed),c.userData||(c.userData={}),c.userData.__iModelSetup&&c.modelObject)return c;c.userData.__iModelSetup=!0;let a=[];a.push(()=>{[...c.children].forEach(yt=>{var wt;(wt=yt==null?void 0:yt.dispose)===null||wt===void 0||wt.call(yt)}),c.children=[],c.parent&&c.removeFromParent()}),c.isLight&&!c.assetType?(c.assetType="light",c.lightObject=c):c.isCamera?(c.assetType="camera",c.cameraObject=c):c.assetType||(c.assetType="model"),c.modelObject||(c.modelObject=c),c.setDirty||(c.setDirty=(yt={})=>{c.dispatchEvent({...yt,type:"objectUpdate",object:c})},c.userData.setDirty&&console.warn("userData.setDirty already defined",c.userData.setDirty,c),c.userData.setDirty=yt=>{var wt;console.warn("userData.setDirty is deprecated, use setDirty directly"),(wt=c.setDirty)===null||wt===void 0||wt.call(c,yt)});const h=yt=>{var wt,It,Et;const Ct=(It=(wt=c.parent)===null||wt===void 0?void 0:wt.userData.parentRoot)!==null&&It!==void 0?It:c.parent;Ct!==c.userData.parentRoot&&c.traverse(xt=>{xt.userData.parentRoot=Ct}),(Et=c.setDirty)===null||Et===void 0||Et.call(c,{change:"addedToParent"})},g=()=>{var yt;(yt=c.setDirty)===null||yt===void 0||yt.call(c,{change:"removedFromParent"}),c.userData.parentRoot!==void 0&&c.traverse(wt=>{wt.userData.parentRoot=void 0})};c.addEventListener("added",h),c.addEventListener("removed",g),a.push(()=>{c.removeEventListener("added",h),c.removeEventListener("removed",g)});const $=c.dispose;c.dispose=()=>{c.dispatchEvent({type:"dispose"}),$==null||$.call(c)},c.userData.dispose&&console.warn("userData.dispose already defined"),c.userData.dispose=()=>{var yt;console.warn("userData.dispose is deprecated, use dispose directly"),(yt=c.dispose)===null||yt===void 0||yt.call(c)};const nt=c;!nt.isMesh&&!nt.isLine||nt.userData.__meshSetup||(nt.userData.__meshSetup=!0,nt.setMaterial||(nt.setMaterial=yt=>Js(nt,yt)),nt.setGeometry||(nt.setGeometry=(yt,wt=!1)=>Do(nt,yt,wt),nt.setGeometry(nt.geometry,!0)),c.userData.setMaterial&&console.warn("userData.setMaterial already defined"),c.userData.setMaterial=yt=>{var wt;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(wt=c.setMaterial)===null||wt===void 0||wt.call(c,yt)},c.userData.setGeometry&&console.warn("userData.setGeometry already defined"),c.userData.setGeometry=(yt,...wt)=>{var It;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(It=c.setGeometry)===null||It===void 0||It.call(c,yt,...wt)},c.userData.__keepShadowDef||(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0),a.push(()=>{var yt,wt;const It=((yt=nt.setMaterial)===null||yt===void 0?void 0:yt.call(nt,void 0))||[],Et=(wt=nt.setGeometry)===null||wt===void 0?void 0:wt.call(nt,void 0);for(const Ct of It)Ct&&Ct.userData.__appliedMeshes.size===0&&Ct.userData.disposeOnIdle!==!1&&Ct.dispose();Et&&Et.userData.__appliedMeshes.size===0&&Et.userData.disposeOnIdle!==!1&&Et.dispose()})),c.uiConfig||c.assetType!=="model"&&c.assetType!=="camera"||(bs(c),a.push(()=>{c.uiConfig=void 0}));const rt=()=>{var yt,wt;return(wt=(yt=c.uiConfig)===null||yt===void 0?void 0:yt.uiRefresh)===null||wt===void 0?void 0:wt.call(yt,"postFrame",!0,1)};c.addEventListener("objectUpdate",rt),a.push(()=>c.removeEventListener("objectUpdate",rt)),c.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(c.userData.__autoParentDispatchEvents=c.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],c.isCamera&&c.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(c.userData.parentRoot=e),a.push(()=>{delete c.userData.parentRoot});const st=c.dispatchEvent;c.dispatchEvent=yt=>{var wt;!((wt=c.userData.__autoParentDispatchEvents)===null||wt===void 0)&&wt.includes(yt.type)&&(yt.parentDispatch=!0),yt.parentDispatch&&(It=>{var Et;const Ct=(Et=c.userData.parentRoot)!==null&&Et!==void 0?Et:c.parent;Ct!=null&&Ct.modelObject&&Ct.dispatchEvent(It)})(yt),st.call(c,yt)},a.push(()=>{c.dispatchEvent=st});const ut=c.clone;c.clone=(...yt)=>{const wt=c.userData;c.userData={};let It=ut.call(c,...yt);c.userData=wt,ro(It.userData,wt);const Et=c.userData.parentRoot;return Et&&Et.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),It=Qo(It,Et,i),It.userData.cloneParent=c.uuid,It},a.push(()=>{c.clone=ut});const mt=c.copy;c.copy=(yt,...wt)=>{const It=yt.userData;yt.userData={};const Et=mt.call(c,yt,...wt);return yt.userData=It,ro(c.userData,yt),Et},a.push(()=>{c.copy=mt});const gt=c.add;return c.add=(...yt)=>(yt.forEach(wt=>Qo(wt,c.userData.parentRoot||c,i)),gt.call(c,...yt)),a.push(()=>{c.add=gt}),c=(s=i==null?void 0:i(c))!==null&&s!==void 0?s:c,a.push(()=>{sn(c,"modelObject",void 0,!0),c.userData={}}),c.addEventListener("dispose",()=>{c.__disposed?console.warn("Object already disposed",c):(c.__disposed=!0,a.forEach(yt=>yt()),a=[])}),[...c.children].forEach(yt=>Qo(yt,c,i)),c}function Js(c,e){var i,s,a,h,g;const $=(Array.isArray(e)?e:[e]).map(st=>st==null?void 0:st.materialObject).filter(st=>st);if(c.material==$||$.length===1&&c.material===$[0])return[];c.userData.__materialUpdater||(c.userData.__materialUpdater=()=>{c.dispatchEvent({type:"materialUpdate"})});const nt=Array.isArray(c.material)?[...c.material]:[c.material];for(const st of nt)st&&(st.removeEventListener("materialUpdate",c.userData.__materialUpdater),(s=(i=st.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0||s.delete(c));const rt=[];for(const st of $)st.userData.__appliedMeshes||(st.userData.__appliedMeshes=new Set),rt.push(st),st&&(st.addEventListener("materialUpdate",c.userData.__materialUpdater),st.userData.__appliedMeshes.add(c));return c.material=rt.length!==1?rt:(a=rt[0])!==null&&a!==void 0?a:void 0,c.traverseAncestors(st=>{st.isRootScene&&st.refreshEnvMapIntensity(c)}),c.dispatchEvent({type:"materialChanged",material:e}),(g=(h=c.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||g===void 0||g.call(h,"postFrame",!0),nt}function Do(c,e,i=!1){var s,a,h,g,$,nt,rt;c.userData.__objectUpdater||(c.userData.__objectUpdater=mt=>{c.dispatchEvent({...mt,type:"objectUpdate"})});let st=c.geometry;const ut=st;return(st!==e||i)&&(st&&(st.removeEventListener("geometryUpdate",c.userData.__objectUpdater),(a=(s=st.userData)===null||s===void 0?void 0:s.__appliedMeshes)===null||a===void 0||a.delete(c)),st=e,st&&!st.userData.__appliedMeshes&&(st.userData.__appliedMeshes=new Set),c.geometry=(h=st)!==null&&h!==void 0?h:void 0,st&&(st.addEventListener("geometryUpdate",c.userData.__objectUpdater),($=(g=st.userData)===null||g===void 0?void 0:g.__appliedMeshes)===null||$===void 0||$.add(c))),e&&!e.uiConfig&&(e.uiConfig=function(mt){return{label:"Geometry",type:"folder",children:[{type:"input",property:[mt,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{mt.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||mt.setAttribute("uv2",mt.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var gt,yt,wt;return(wt=(yt=(gt=mt.userData)===null||gt===void 0?void 0:gt.__appliedMeshes)===null||yt===void 0?void 0:yt.size)!==null&&wt!==void 0?wt:0},set value(gt){},disabled:!0}]}}(c.geometry)),c.dispatchEvent({type:"geometryChanged",geometry:e}),(rt=(nt=c.uiConfig)===null||nt===void 0?void 0:nt.uiRefresh)===null||rt===void 0||rt.call(nt,"postFrame",!0),ut===st?void 0:ut||void 0}const Go=["appliedMeshes"],qu=["parentRoot","iCamera","iModel"];function ro(c,e){if(e)for(const i of Object.keys(e))qu.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}var Wl,_p=new Uint8Array(16);function Ho(){if(!Wl&&!(Wl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Wl(_p)}for(var yo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Zo=function(c){return typeof c=="string"&&yo.test(c)},_o=[],pu=0;pu<256;++pu)_o.push((pu+256).toString(16).substr(1));var Ao=function(c,e,i){var s=(c=c||{}).random||(c.rng||Ho)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var a=0;a<16;++a)e[i+a]=s[a];return e}return function(h){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,$=(_o[h[g+0]]+_o[h[g+1]]+_o[h[g+2]]+_o[h[g+3]]+"-"+_o[h[g+4]]+_o[h[g+5]]+"-"+_o[h[g+6]]+_o[h[g+7]]+"-"+_o[h[g+8]]+_o[h[g+9]]+"-"+_o[h[g+10]]+_o[h[g+11]]+_o[h[g+12]]+_o[h[g+13]]+_o[h[g+14]]+_o[h[g+15]]).toLowerCase();if(!Zo($))throw TypeError("Stringified UUID is invalid");return $}(s)};const na=new Map;function xl(c,e){return(i,s)=>{const a=i.constructor;if(a===Object)throw new Error("All properties in an object are serialized by default");na.has(a)||na.set(a,[]);const h=na.get(a);if(!(h.findIndex(g=>g.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);h.push({params:e||{},propKey:s,uiType:c})}}function rs(c,e){return xl("checkbox",{label:c,params:e})}function Fm(c,e){return xl("monitor",{label:c,params:e})}function ls(c,e,i,s){return xl("slider",{label:c,bounds:e,stepSize:i,params:s})}function Jl(c,e,i,s){return xl("vec",{label:c,bounds:e,stepSize:i,params:s})}function yp(c,e,i){return xl("dropdown",{label:c,children:e,params:i})}function No(c,e){return xl("button",{label:c,params:e})}function uo(c,e){return xl("input",{label:c,params:e})}function cv(c,e){return xl("color",{label:c,params:e})}function Sy(c,e){return xl("image",{label:c,params:e})}function zv(c){let e=c==null?void 0:c.constructor;if(!c||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);return s.reverse().forEach(a=>{var h;(h=na.get(a))===null||h===void 0||h.forEach(({params:g,propKey:$,uiType:nt})=>{var rt;let st;if(nt||(st=(rt=c[$])===null||rt===void 0?void 0:rt.uiConfig),st||(st={property:[c,$],type:nt||"input"}),g){const ut=typeof g.params=="function"?g.params(c):g.params||{};delete g.params,Object.assign(st,{...g,...ut})}i.push(st)})}),i}function w_(c,e,i={}){return{type:"folder",label:c,children:zv(e),uuid:Ao(),...i}}function ho(c,e){return i=>class extends i{constructor(){super(...arguments),this.uiConfig=w_(c,this,e||{})}}}const gA={type:"change"},x_={type:"start"},Vv={type:"end"};class Qv extends d.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new d.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:d.RsA.ROTATE,MIDDLE:d.RsA.DOLLY,RIGHT:d.RsA.PAN},this.touches={ONE:d.QmN.ROTATE,TWO:d.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return $.phi},this.getAzimuthalAngle=function(){return $.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(dr){dr.addEventListener("keydown",Ws),this._domElementKeyEvents=dr},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(gA),s.update(),h=a.NONE},this.update=function(){const dr=new d.Pa4,jr=new d._fP().setFromUnitVectors(e.up,new d.Pa4(0,1,0)),zr=jr.clone().invert(),Ys=new d.Pa4,Jo=new d._fP,vn=2*Math.PI;return function(){const Fn=s.object.position;dr.copy(Fn).sub(s.target),dr.applyQuaternion(jr),$.setFromVector3(dr),s.autoRotate&&h===a.NONE&&rn(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?($.theta+=nt.theta*s.dampingFactor,$.phi+=nt.phi*s.dampingFactor):($.theta+=nt.theta,$.phi+=nt.phi);let yn=s.minAzimuthAngle,Hn=s.maxAzimuthAngle;isFinite(yn)&&isFinite(Hn)&&(yn<-Math.PI?yn+=vn:yn>Math.PI&&(yn-=vn),Hn<-Math.PI?Hn+=vn:Hn>Math.PI&&(Hn-=vn),$.theta=yn<=Hn?Math.max(yn,Math.min(Hn,$.theta)):$.theta>(yn+Hn)/2?Math.max(yn,$.theta):Math.min(Hn,$.theta)),$.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,$.phi)),$.makeSafe(),Math.abs(nt.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+nt.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(nt.radius=0)),$.radius*=1+nt.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs(rt-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*rt)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(rt=1)),$.radius*=rt);let nr=0;s.autoPushTarget&&$.radius<s.minDistance&&(nr=s.minDistance-$.radius),$.radius=Math.max(s.minDistance,Math.min(s.maxDistance,$.radius)),s.enableDamping===!0?s.target.addScaledVector(st,s.dampingFactor):s.target.add(st),dr.setFromSpherical($),dr.applyQuaternion(zr),Fn.copy(s.target).add(dr),s.target.add(dr.normalize().multiplyScalar(-nr)),s.object.lookAt(s.target);let Gn=!1;return s.enableDamping===!0&&Math.abs(nt.theta)+Math.abs(nt.phi)+Math.abs(nt.radius)+st.length()>.001?(nt.theta*=1-s.dampingFactor,nt.phi*=1-s.dampingFactor,nt.radius*=1-s.dampingFactor,st.multiplyScalar(1-s.dampingFactor),Gn=!0):(nt.set(0,0,0),st.set(0,0,0)),rt=1,!!(ut||Gn||Ys.distanceToSquared(s.object.position)>g||8*(1-Jo.dot(s.object.quaternion))>g)&&(s.dispatchEvent(gA),Ys.copy(s.object.position),Jo.copy(s.object.quaternion),ut=!1,!0)}}(),this.stopDamping=function(){nt.set(0,0,0),st.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",lo),s.domElement.removeEventListener("pointerdown",Nr),s.domElement.removeEventListener("pointercancel",ps),s.domElement.removeEventListener("wheel",yr),s.domElement.removeEventListener("pointermove",Fr),s.domElement.removeEventListener("pointerup",Vr),s._domElementKeyEvents!==null&&s._domElementKeyEvents.removeEventListener("keydown",Ws)};const s=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=a.NONE;const g=1e-6,$=new d.$V,nt=new d.$V(0,0,0);let rt=1;const st=new d.Pa4;let ut=!1;const mt=new d.FM8,gt=new d.FM8,yt=new d.FM8,wt=new d.FM8,It=new d.FM8,Et=new d.FM8,Ct=new d.FM8,xt=new d.FM8,Bt=new d.FM8,Lt=[],Gt={};function Xt(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function rn(dr){nt.theta-=dr}function fn(dr){nt.phi-=dr}this.rotateUp=fn,this.rotateLeft=rn;const wn=function(){const dr=new d.Pa4;return function(jr,zr){dr.setFromMatrixColumn(zr,0),dr.multiplyScalar(-jr),st.add(dr)}}(),Cn=function(){const dr=new d.Pa4;return function(jr,zr){s.screenSpacePanning===!0?dr.setFromMatrixColumn(zr,1):(dr.setFromMatrixColumn(zr,0),dr.crossVectors(s.object.up,dr)),dr.multiplyScalar(jr),st.add(dr)}}(),bn=function(){const dr=new d.Pa4;return function(jr,zr){const Ys=s.domElement;if(s.object.isPerspectiveCamera){const Jo=s.object.position;dr.copy(Jo).sub(s.target);let vn=dr.length();vn*=Math.tan(s.object.fov/2*Math.PI/180),wn(2*jr*vn/Ys.clientHeight,s.object.matrix),Cn(2*zr*vn/Ys.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(wn(jr*(s.object.right-s.object.left)/s.object.zoom/Ys.clientWidth,s.object.matrix),Cn(zr*(s.object.top-s.object.bottom)/s.object.zoom/Ys.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function Dn(dr,jr=0){s.object.isPerspectiveCamera?(rt/=dr,nt.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,nt.radius-jr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*dr)),s.object.updateProjectionMatrix(),ut=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function En(dr,jr=0){s.object.isPerspectiveCamera?(rt*=dr,nt.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,nt.radius+jr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/dr)),s.object.updateProjectionMatrix(),ut=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function Tn(dr){mt.set(dr.clientX,dr.clientY)}function Un(dr){wt.set(dr.clientX,dr.clientY)}function Pn(){if(Lt.length===1)mt.set(Lt[0].pageX,Lt[0].pageY);else{const dr=.5*(Lt[0].pageX+Lt[1].pageX),jr=.5*(Lt[0].pageY+Lt[1].pageY);mt.set(dr,jr)}}function Yn(){if(Lt.length===1)wt.set(Lt[0].pageX,Lt[0].pageY);else{const dr=.5*(Lt[0].pageX+Lt[1].pageX),jr=.5*(Lt[0].pageY+Lt[1].pageY);wt.set(dr,jr)}}function cr(){const dr=Lt[0].pageX-Lt[1].pageX,jr=Lt[0].pageY-Lt[1].pageY,zr=Math.sqrt(dr*dr+jr*jr);Ct.set(0,zr)}function mr(dr){if(Lt.length==1)gt.set(dr.pageX,dr.pageY);else{const zr=xa(dr),Ys=.5*(dr.pageX+zr.x),Jo=.5*(dr.pageY+zr.y);gt.set(Ys,Jo)}yt.subVectors(gt,mt).multiplyScalar(s.rotateSpeed);const jr=s.domElement;rn(2*Math.PI*yt.x/jr.clientHeight),fn(2*Math.PI*yt.y/jr.clientHeight),mt.copy(gt)}function ir(dr){if(Lt.length===1)It.set(dr.pageX,dr.pageY);else{const jr=xa(dr),zr=.5*(dr.pageX+jr.x),Ys=.5*(dr.pageY+jr.y);It.set(zr,Ys)}Et.subVectors(It,wt).multiplyScalar(s.panSpeed),bn(Et.x,Et.y),wt.copy(It)}function Dr(dr){const jr=xa(dr),zr=dr.pageX-jr.x,Ys=dr.pageY-jr.y,Jo=Math.sqrt(zr*zr+Ys*Ys);xt.set(0,Jo),Bt.set(0,Math.pow(xt.y/Ct.y,s.zoomSpeed)),Dn(Bt.y),Ct.copy(xt)}function Nr(dr){s.enabled!==!1&&(Lt.length===0&&(s.domElement.setPointerCapture(dr.pointerId),s.domElement.addEventListener("pointermove",Fr),s.domElement.addEventListener("pointerup",Vr)),function(jr){Lt.push(jr)}(dr),dr.pointerType==="touch"?function(jr){switch(Bo(jr),Lt.length){case 1:switch(s.touches.ONE){case d.QmN.ROTATE:if(s.enableRotate===!1)return;Pn(),h=a.TOUCH_ROTATE;break;case d.QmN.PAN:if(s.enablePan===!1)return;Yn(),h=a.TOUCH_PAN;break;default:h=a.NONE}break;case 2:switch(s.touches.TWO){case d.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&cr(),s.enablePan&&Yn(),h=a.TOUCH_DOLLY_PAN;break;case d.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&cr(),s.enableRotate&&Pn(),h=a.TOUCH_DOLLY_ROTATE;break;default:h=a.NONE}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(x_)}(dr):function(jr){let zr;switch(jr.button){case 0:zr=s.mouseButtons.LEFT;break;case 1:zr=s.mouseButtons.MIDDLE;break;case 2:zr=s.mouseButtons.RIGHT;break;default:zr=-1}switch(zr){case d.RsA.DOLLY:if(s.enableZoom===!1)return;(function(Ys){Ct.set(Ys.clientX,Ys.clientY)})(jr),h=a.DOLLY;break;case d.RsA.ROTATE:if(jr.ctrlKey||jr.metaKey||jr.shiftKey){if(s.enablePan===!1)return;Un(jr),h=a.PAN}else{if(s.enableRotate===!1)return;Tn(jr),h=a.ROTATE}break;case d.RsA.PAN:if(jr.ctrlKey||jr.metaKey||jr.shiftKey){if(s.enableRotate===!1)return;Tn(jr),h=a.ROTATE}else{if(s.enablePan===!1)return;Un(jr),h=a.PAN}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(x_)}(dr))}function Fr(dr){s.enabled!==!1&&(dr.pointerType==="touch"?function(jr){switch(Bo(jr),h){case a.TOUCH_ROTATE:if(s.enableRotate===!1)return;mr(jr),s.update();break;case a.TOUCH_PAN:if(s.enablePan===!1)return;ir(jr),s.update();break;case a.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function(zr){s.enableZoom&&Dr(zr),s.enablePan&&ir(zr)})(jr),s.update();break;case a.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function(zr){s.enableZoom&&Dr(zr),s.enableRotate&&mr(zr)})(jr),s.update();break;default:h=a.NONE}}(dr):function(jr){switch(h){case a.ROTATE:if(s.enableRotate===!1)return;(function(zr){gt.set(zr.clientX,zr.clientY),yt.subVectors(gt,mt).multiplyScalar(s.rotateSpeed);const Ys=s.domElement;rn(2*Math.PI*yt.x/Ys.clientHeight),fn(2*Math.PI*yt.y/Ys.clientHeight),mt.copy(gt),s.update()})(jr);break;case a.DOLLY:if(s.enableZoom===!1)return;(function(zr){xt.set(zr.clientX,zr.clientY),Bt.subVectors(xt,Ct),Bt.y>0?Dn(Xt()):Bt.y<0&&En(Xt()),Ct.copy(xt),s.update()})(jr);break;case a.PAN:if(s.enablePan===!1)return;(function(zr){It.set(zr.clientX,zr.clientY),Et.subVectors(It,wt).multiplyScalar(s.panSpeed),bn(Et.x,Et.y),wt.copy(It),s.update()})(jr)}}(dr))}function Vr(dr){qs(dr),Lt.length===0&&(s.domElement.releasePointerCapture(dr.pointerId),s.domElement.removeEventListener("pointermove",Fr),s.domElement.removeEventListener("pointerup",Vr)),s.dispatchEvent(Vv),h=a.NONE}function ps(dr){qs(dr)}function yr(dr){s.enabled!==!1&&s.enableZoom!==!1&&h===a.NONE&&(dr.preventDefault(),s.dispatchEvent(x_),function(jr){let zr=0;switch(jr.deltaMode){case 2:zr+=1*jr.deltaY;break;case 1:zr+=.4*jr.deltaY;break;default:zr+=.01*jr.deltaY}jr.deltaY<0?En(1,zr*s.zoomSpeed):jr.deltaY>0&&Dn(1,-zr*s.zoomSpeed),s.update()}(dr),s.dispatchEvent(Vv))}function Ws(dr){s.enabled!==!1&&s.enablePan!==!1&&function(jr){let zr=!1;switch(jr.code){case s.keys.UP:bn(0,s.keyPanSpeed),zr=!0;break;case s.keys.BOTTOM:bn(0,-s.keyPanSpeed),zr=!0;break;case s.keys.LEFT:bn(s.keyPanSpeed,0),zr=!0;break;case s.keys.RIGHT:bn(-s.keyPanSpeed,0),zr=!0}zr&&(jr.preventDefault(),s.update())}(dr)}function lo(dr){s.enabled!==!1&&dr.preventDefault()}function qs(dr){delete Gt[dr.pointerId];for(let jr=0;jr<Lt.length;jr++)if(Lt[jr].pointerId==dr.pointerId)return void Lt.splice(jr,1)}function Bo(dr){let jr=Gt[dr.pointerId];jr===void 0&&(jr=new d.FM8,Gt[dr.pointerId]=jr),jr.set(dr.pageX,dr.pageY)}function xa(dr){const jr=dr.pointerId===Lt[0].pointerId?Lt[1]:Lt[0];return Gt[jr.pointerId]}this.zoomIn=function(dr){Dn(1,dr*s.zoomSpeed)},this.zoomOut=function(dr){En(1,dr*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",lo),s.domElement.addEventListener("pointerdown",Nr),s.domElement.addEventListener("pointercancel",ps),s.domElement.addEventListener("wheel",yr,{passive:!1}),this.update()}}var Xo=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Fo=class extends Qv{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(c){super.zoomIn(c)}zoomOut(c){super.zoomOut(c)}dispatchEvent(c){super.dispatchEvent(c)}};Xo([Qn()],Fo.prototype,"type",void 0),Xo([rs()],Fo.prototype,"enabled",void 0),Xo([rs(),Qn()],Fo.prototype,"dollyZoom",void 0),Xo([rs(),Qn()],Fo.prototype,"enableDamping",void 0),Xo([uo(),Qn()],Fo.prototype,"dampingFactor",void 0),Xo([rs(),Qn()],Fo.prototype,"autoRotate",void 0),Xo([uo(),Qn()],Fo.prototype,"autoRotateSpeed",void 0),Xo([rs(),Qn()],Fo.prototype,"enableZoom",void 0),Xo([uo(),Qn()],Fo.prototype,"zoomSpeed",void 0),Xo([uo(),Qn()],Fo.prototype,"maxZoomSpeed",void 0),Xo([rs(),Qn()],Fo.prototype,"enableRotate",void 0),Xo([uo(),Qn()],Fo.prototype,"rotateSpeed",void 0),Xo([rs(),Qn()],Fo.prototype,"enablePan",void 0),Xo([uo(),Qn()],Fo.prototype,"panSpeed",void 0),Xo([uo(),Qn()],Fo.prototype,"autoPushTarget",void 0),Xo([uo(),Qn()],Fo.prototype,"minDistance",void 0),Xo([uo(),Qn()],Fo.prototype,"maxDistance",void 0),Xo([uo(),Qn()],Fo.prototype,"minZoom",void 0),Xo([uo(),Qn()],Fo.prototype,"maxZoom",void 0),Xo([uo(),Qn()],Fo.prototype,"minPolarAngle",void 0),Xo([uo(),Qn()],Fo.prototype,"maxPolarAngle",void 0),Xo([uo(),Qn()],Fo.prototype,"minAzimuthAngle",void 0),Xo([uo(),Qn()],Fo.prototype,"maxAzimuthAngle",void 0),Xo([Qn()],Fo.prototype,"screenSpacePanning",void 0),Xo([Qn()],Fo.prototype,"keyPanSpeed",void 0),Fo=Xo([ho("Orbit Controls")],Fo);var uv=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Ap extends _e{constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=g=>{this.setDirty(g)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new d.Pa4(0,0,10),this._target=new d.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(g,$)=>{const nt=new Fo(g,$.ownerDocument?$:$.documentElement);return nt.screenSpacePanning=!0,nt}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit","firstPerson","pointerLock",...this._controlsCtors.keys()].map(g=>({label:g===""?"none":g,value:g})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var g;return(g=this._controls)===null||g===void 0?void 0:g.uiConfig},()=>{var g;return!((g=this._controls)===null||g===void 0)&&g.zoomIn?{type:"button",label:"Zoom in",value:()=>{var $;($=this._controls)===null||$===void 0||$.zoomIn(1)}}:{}},()=>{var g;return!((g=this._controls)===null||g===void 0)&&g.zoomOut?{type:"button",label:"Zoom out",value:()=>{var $;($=this._controls)===null||$===void 0||$.zoomOut(1)}}:{}}]},this.assetType="model",this.uuid=or(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const a=i??this._options;this._camera=this._setCameraObject(e??(a.type==="OrthographicCamera"?new d.iKG(-1,1,1,-1):new d.cPb)),this._camera.modelObject.userData.iCamera=this;const h=e;e&&(h.isPerspectiveCamera?(a.fov=h.fov,a.focus=h.focus,a.aspect=h.aspect<=0||h.userData.autoAspect?"auto":h.aspect,a.zoom=h.zoom):h.isOrthographicCamera&&(a.left=h.left,a.right=h.right,a.top=h.top,a.bottom=h.bottom,a.zoom=h.zoom),a.near=h.near,a.far=h.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(a)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>1e-5;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>1e-5;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var s,a;const h={...e};!((s=h.position)===null||s===void 0)&&s.isVector3&&(h.position=[h.position.x,h.position.y,h.position.z]),!((a=h.target)===null||a===void 0)&&a.isVector3&&(h.target=[h.target.x,h.target.y,h.target.z]),Object.keys(h).forEach(g=>g!=="frustumSize"&&h[g]===void 0&&delete h[g]),Object.assign(this._options,h),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const a=this._options.type==="PerspectiveCamera"?new d.cPb:new d.iKG;a.name=this._camera.name,a.near=this._camera.modelObject.near,a.far=this._camera.modelObject.far,a.zoom=this._camera.modelObject.zoom,a.scale.copy(this._camera.modelObject.scale);const h=this._isActiveCamera;h&&this.deactivateMain(),this._camera=this._setCameraObject(a),i=this._camera.modelObject,h&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const a=this._options.frustumSize;a!==void 0?(i.top=a/2,i.bottom=-a/2,i.left=s*a/2,i.right=-s*a/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Qo(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new d._fP))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,i,s;const a=this._options.controlsMode;this._controls=(i=(e=this._controlsCtors.get(a))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&i!==void 0?i:void 0,this._controls||console.error("Unable to create controls with mode "+a+". Are you missing a plugin?"),(s=this._controls)===null||s===void 0||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?a:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(i=this._controls)===null||i===void 0||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const a=this._options.controlsMode;this._controls?this._controlsMode===a&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=a}if(this._controls){const a=this.interactionsEnabled;this._controls.enabled=a,a&&this._camera.modelObject.up.copy(d.Tme.DefaultUp)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new d.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(s=(i=this._camera).setDirty)===null||s===void 0||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var i,s;const a=this.target;(s=(i=this._controls)===null||i===void 0?void 0:i.target)===null||s===void 0||s.set(a.x,a.y,a.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(a),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i;return!((i=e.uniforms.cameraPositionWorld)===null||i===void 0)&&i.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},Xr(this,!0,e))}fromJSON(e,i){return br(e,this,!0,i),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}uv([Qn("camControls")],Ap.prototype,"_controls",void 0),uv([Qn()],Ap.prototype,"userData",void 0),uv([hn(Ap.prototype._nearFarChanged)],Ap.prototype,"near",void 0),uv([hn(Ap.prototype._nearFarChanged)],Ap.prototype,"far",void 0),uv([Qn("camOptions")],Ap.prototype,"_options",void 0),uv([Qn("position")],Ap.prototype,"_position",void 0),uv([Qn("target")],Ap.prototype,"_target",void 0);var vA=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class b_ extends d.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new ar,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new Ap(new d.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Qo(new d.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new d.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(i=>{(Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{s&&s.envMapIntensity!==void 0&&!s.userData.separateEnvMapIntensity&&(s.envMapIntensity=this.envMapIntensity,s.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let a=!1;switch(s){case"model":a=e.modelObject.isCamera,a&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:a=!1}={}){const h=e;h?(i&&!h.userData.autoScaled&&is(h,h.userData.autoScaleRadius||s),h.traverse(g=>{g.isMesh&&!g.userData.__keepShadowDef&&(g.castShadow=!0,g.receiveShadow=!0,g.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(h),a?this.modelObject.add(h):this.modelRoot.add(h),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var i,s;((i=e.dispose)!==null&&i!==void 0?i:(s=e.modelObject)===null||s===void 0?void 0:s.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(i=>Qo(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===d.xfE&&(e.mapping=d.dSO,e.needsUpdate=!0);const i=e.textureObject||e;this.environment=i,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var i;let s;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)s=((i=e)===null||i===void 0?void 0:i.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);s=new d.Ilk(e)}this.background=s,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,a;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(a=(s=(i=this.boxHelper)===null||i===void 0?void 0:i.box)===null||s===void 0?void 0:s.copy)===null||a===void 0||a.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new d.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(a=>{a.name===e&&s.push(a)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var s;const a=e.lightObject;a&&((s=a.children)===null||s===void 0||s.length,i?this.add(a):this.modelRoot.add(a))}getBounds(e=!1,i=!0){return new ar().expandByObject(this.modelObject,e,i)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new d.Pa4).sub(i.getCenter(new d.Pa4)),a=1.5*i.getSize(new d.Pa4).length()/2,h=s.length(),g=Math.max(this.minNearDistance,h-a),$=Math.max(g+1,h+a);e.near=g,e.far=$}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return Xr(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(br(s,this.getEnvironment(),!1,i)),delete e.environment),br(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}}function E_(){const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return c.style.display="block",c}function x0(c,e){const i=e||"/";return c.join(i)}function Tu(c,e){const i=window.URL.createObjectURL(c),s=document.createElement("a");s.style.display="none",s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(i)},1e3)}async function gu(c){return new Promise((e,i)=>{const s=new FileReader;s.onload=a=>e(s.result),s.onerror=a=>i(s.error),s.onabort=a=>i(new Error("Read aborted")),s.readAsDataURL(c)})}function Wp(c,e){return Tu(c,e??c.name)}async function S_(c=!1,e=!1,i){const s=document.createElement("input");s.type="file",s.multiple=c,s.accept=i||"*",s.webkitdirectory=e,s.style.display="none",document.body.appendChild(s),s.click();const a=await new Promise(h=>{s.onchange=g=>{h(Array.from(s.files||[]))}});return document.body.removeChild(s),a}function Ml({innerHTML:c="",id:e,classList:i,addToBody:s=!0,elementTag:a="div"}){const h=document.createElement(a);return e&&(h.id=e),h.innerHTML=c,i&&h.classList.add(...i),s&&document.body.appendChild(h),h}async function _A(c){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=i,s.crossOrigin="anonymous",s.decoding="sync",s.src=c})}function Gv(c){const e=document.createElement("style");return e.type="text/css",e.innerText=c,document.head.appendChild(e),e}async function y1(c){return new Promise((e,i)=>{const s=document.createElement("script");s.setAttribute("src",c),s.addEventListener("load",e),s.addEventListener("error",i),document.body.appendChild(s)})}function C_(c,e=8192,i=!1){var s;if(!c.width||!c.height)return"";const a=document.createElement("canvas");a.width=Math.min(e,c.width),a.height=Math.floor(1+a.width*c.height/c.width);const h=c instanceof ImageBitmap,g=h&&i&&Math.abs(a.width-c.width)<.5?a.getContext("bitmaprenderer"):void 0;g?g.transferFromImageBitmap(c):(s=a.getContext("2d"))===null||s===void 0||s.drawImage(c,0,0,a.width,a.height);const $=a.toDataURL("image/png");return a.remove(),h&&i&&c.close(),$}async function vm(c){return new Promise((e,i)=>{const s=new Image;s.addEventListener("load",()=>{const a=document.createElement("canvas");a.width=s.width,a.height=s.height;const h=a.getContext("2d");if(!h)return void i(new Error("Could not get 2d context"));h.drawImage(s,0,0,a.width,a.height);const g=h.getImageData(0,0,a.width,a.height);e(g),a.remove(),s.remove()},!1),s.addEventListener("error",a=>{s.remove(),i(a)},!1),s.src=c})}function po(){return(typeof performance>"u"?Date:performance).now()}function Pw(){let c=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(c=!0),c;var e}function M_(c,e=null){var i;return(i=new URL(window.location.href).searchParams.get(c))!==null&&i!==void 0?i:e}function ip(c,e,i=!1){const s=new URLSearchParams(location.search);e==null?s.has(c)&&s.delete(c):s.set(c,e),i?window.location.search=s.toString():window.history.replaceState({},"","?"+s.toString())}function b0(c){return c.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function Iu(c,{backgroundColor:e="",displayPixelRatio:i=1,width:s=512,height:a=512}){const h=document.createElement("canvas"),g=h.getContext("2d"),$=i,nt=s,rt=a;return h.width=nt*$,h.height=rt*$,h.style.width=`${nt}`,h.style.height=`${rt}`,(e==null?void 0:e.length)>0&&(g.fillStyle=e,g.fillRect(0,0,h.width,h.height)),g.drawImage(c,0,0,h.width,h.height),h}vA([Qn()],b_.prototype,"defaultCamera",void 0),vA([hn(b_.prototype.refreshEnvMapIntensity),Qn()],b_.prototype,"envMapIntensity",void 0),vA([Qn()],b_.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(c,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-c),a=new Uint8Array(s);for(let h=0;h<a.length;h++)a[h]=i[h+c];return s});class Pu{static ApplyMaterialExtensions(e,i,s,a){for(const h of s)this.ApplyMaterialExtension(e,i,h,a)}static ApplyMaterialExtension(e,i,s,a){var h,g;let $=(h=Ht(s.parsFragmentSnippet,a,e))!==null&&h!==void 0?h:"";$.length&&(i.fragmentShader=i.fragmentShader.replace(this.FragVoidMain,`
${$}
${this.FragVoidMain}`)),$=(g=Ht(s.parsVertexSnippet,a,e))!==null&&g!==void 0?g:"",$.length&&(i.vertexShader=i.vertexShader.replace(this.VertVoidMain,`
${$}
${this.VertVoidMain}`)),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.shaderExtender&&s.shaderExtender(i,e,a),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const a of i)s+=this.CacheKeyForExtension(e,a);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),s}static RegisterExtensions(e,i){const s=[];if(i)for(const a of i)a.isCompatible&&a.isCompatible(e)&&(s.push(a),a.uuid||(a.uuid=Ao()),a.setDirty||(a.setDirty=()=>{a.updateVersion||(a.updateVersion=0),a.updateVersion++}));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",a=>function(h,{object:g,renderer:$}){var nt;(nt=h.materialExtensions)===null||nt===void 0||nt.forEach(rt=>{var st,ut;(st=rt.onObjectRender)===null||st===void 0||st.call(rt,g,h,$),h.lastShader&&((ut=Ht(rt.updaters))===null||ut===void 0||ut.forEach(mt=>mt==null?void 0:mt.updateShaderProperties(h.lastShader))),rt.updateVersion!==h.materialObject.userData["_"+rt.uuid+"_version"]&&(h.materialObject.userData["_"+rt.uuid+"_version"]=rt.updateVersion,h.materialObject.needsUpdate=!0)})}(e,a))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",a=>function(h,{object:g,renderer:$}){var nt;(nt=h.materialExtensions)===null||nt===void 0||nt.forEach(rt=>{var st;(st=rt.onAfterRender)===null||st===void 0||st.call(rt,g,h,$)})}(e,a))),s}}Pu.FragVoidMain="void main() {",Pu.VertVoidMain="void main() {";class T_ extends d.jyz{constructor(e){var i;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=Pu.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Pu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){Pu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Pu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}onAfterRender(e,i,s,a,h){super.onAfterRender(e,i,s,a,h),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class Du extends T_{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,encoding:d.rnI})),this.setDirty())}_setUniformTexSize(e,i){var s,a,h,g;if(!i||!e)return;const $=(a=(s=i.image)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:512,nt=(g=(h=i.image)===null||h===void 0?void 0:h.height)!==null&&g!==void 0?g:512,rt=e.value;rt.isVector2||console.warn("uniform is not a Vector2"),rt&&Math.abs(rt.x-$)+Math.abs(rt.y-nt)>.1&&(rt.x=$,rt.y=nt,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,a,h){var g,$;this._setUniformTexSize(this.uniforms.screenSize,(g=e.getRenderTarget())===null||g===void 0?void 0:g.texture);for(const nt of this.textures){const rt=nt.id,st=($=this.uniforms[rt])===null||$===void 0?void 0:$.value;st&&(this._setUniformTexSize(this.uniforms[rt+"Size"],st),st.encoding!==nt.encoding&&(nt.encoding=st.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,a,h)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>{var a,h;return`uniform sampler2D ${s.id}; 
`+xr((a=s.id)!==null&&a!==void 0?a:"input",(h=s.encoding)!==null&&h!==void 0?h:d.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function wo(c,...e){const i=c.fragmentShader;return new Du({defines:Object.assign({},c.defines),uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:i},e)}class Au extends Ot{constructor(e,...i){super(e.isMaterial?e:wo(e,...i),i.length<1?Au.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,a;(i=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||i===void 0||i.call(e),(a=(s=this.fsQuad)===null||s===void 0?void 0:s.dispose)===null||a===void 0||a.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,a,h){this.enabled&&super.render(e,i,s,a,h)}}Au.DEFAULT_TEX_ID="tDiffuse",function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)}([rs("Enabled"),Qn()],Au.prototype,"enabled",void 0);class Wo extends ct{constructor(e,i,s,a,h){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=a,this.clearAlpha=h!==void 0?h:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new d.Ilk}render(e,i,s,a,h,g){const $=e.autoClear;let nt,rt;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(rt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),nt=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),g){const st=e.getContext();st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_ATTACHMENT,st.RENDERBUFFER,g)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),g){const st=e.getContext();st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_ATTACHMENT,st.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,nt),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=rt),e.autoClear=$}}class yA extends Au{constructor(e,i="c = a + b;",s="",a){super({vertexShader:it.vertexShader,fragmentShader:zt`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:a},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class qp extends d.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new d.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new d.Ltg(1,1,1,1)}},glslVersion:e?d.LSk:d.v9Y})}onBeforeRender(e,i,s,a,h){var g,$,nt;let rt=h.material;Array.isArray(rt)&&(rt=rt[0]),this.uniforms.alphaMap.value=(g=rt==null?void 0:rt.alphaMap)!==null&&g!==void 0?g:null,this.uniforms.alphaTest.value=!rt||!rt.alphaTest||rt.alphaTest<1e-7?.001:rt.alphaTest,this.uniforms.flags.value.x=(rt==null?void 0:rt.userData.postTonemap)===!1?0:1,this.uniforms.flags.value.y=rt!=null&&rt.userData._ssBevel?(rt==null?void 0:rt.userData._ssBevel.radius)/255:0,this.uniforms.flags.value.z=(rt!=null&&rt.userData.matId?rt==null?void 0:rt.userData.matId:0)/255,this.uniforms.flags.value.w=rt!=null&&rt.userData.enableLUT?rt==null?void 0:rt.userData.enableLUT:0,this.uniformsNeedUpdate=!0;let st=this.uniforms.alphaMap.value?1:void 0;st!==this.defines.USE_ALPHAMAP&&(st===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=st,this.needsUpdate=!0),st=rt.userData.ALPHA_I_RGBA_PACKING?1:void 0,st!==this.defines.ALPHA_I_RGBA_PACKING&&(st===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=st,this.needsUpdate=!0),st=($=rt.userData.forcedLinearDepth)!==null&&$!==void 0?$:void 0,st!==this.defines.FORCED_LINEAR_DEPTH&&(st===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=st,this.needsUpdate=!0),this.side=(nt=rt.side)!==null&&nt!==void 0?nt:d.ehD}}var Hv=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const I_={name:"",fog:!0,blending:d.bdR,side:d.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:d.k74,blendDst:d.LgZ,blendEquation:d.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:d.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:d.cum,stencilRef:0,stencilFuncMask:255,stencilFail:d.x5V,stencilZFail:d.x5V,stencilZPass:d.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function Fl(c,e,i,{replaceAll:s=!1,prepend:a=!1,append:h=!1}={}){if(!c.includes(e))return console.error(`${e} not found in shader`),c;let g=i;return a?g=i+e:h&&(g=e+i),s?c.replaceAll(e,g):c.replace(e,g)}const Dw={...I_,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:d.IOt,normalScale:new d.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new hs(0),specularColorMap:null},Rw={...Dw,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new d.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new hs(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new hs(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new hs(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class Yu extends d.EJi{constructor(e){var i;super(e),this.typeSlug=Yu.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.fog=!1,this.userData.enableLUT=!0,this.materialExtensions=Pu.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Pu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},So(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},So(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},So(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},So(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",d.IOt],["ObjectSpace",d.PA7]].map(e=>({label:e[0],value:e[1]}))},So(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},So(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},So(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},So(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},So(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},So(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},So(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},So(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},So(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},So(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",d.BVF],["Always",d.Se2],["Less",d.Zr5],["LessEqual",d.vCF],["Equal",d.eD],["GreaterEqual",d.ksN],["Greater",d.w$m],["NotEqual",d.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Bl],["Normal",Oo],["Additive",d.WMw],["Subtractive",Mo],["Multiply",To]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},So(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},So(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},So(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",d.Wl3],["Back",d._Li],["Double",d.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:e=>{this.userData.enableLUT=e||void 0,this.setDirty()}},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Tu(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Fl(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Fl(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);Pu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Pu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h});const g=this.userData.inverseAlphaMap?1:0;g!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=g,this.needsUpdate=!0)}copyProps(e,i=!1){if(!i&&!["MeshStandardMaterial",Yu.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};an(e,s,Array.from(Object.keys(Rw)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&Cl(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},Cl(h.userData,a),h.userData.uuid=this.userData.uuid;const g=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map($=>[$.uuid,$]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map($=>[$.uuid,$]))||[])};h.userData=Xr(h.userData,!1,g),e||(Object.keys(g.textures).length>0&&(h.textures=Object.values(g.textures)),Object.keys(g.images).length>0&&(h.images=Object.values(g.images))),h.type=Yu.TYPE;for(const $ of Object.keys(h))h[$]===void 0&&delete h[$];return h}fromJSON(e,i,s=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new d.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new d.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,s)}clone(){return super.clone()}}Yu.TypeSlug="pmat",Yu.TYPE="MeshStandardMaterial2";const kw={...I_,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:d.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class Yp extends d.vBJ{constructor(e){var i;super(e),this.typeSlug=Yp.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.materialExtensions=Pu.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Pu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},So(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Bl],["Normal",Oo],["Additive",d.WMw],["Subtractive",Mo],["Multiply",To]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},So(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},So(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},So(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",d.Wl3],["Back",d._Li],["Double",d.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Tu(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Fl(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Fl(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);Pu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Pu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",Yp.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};an(e,s,Array.from(Object.keys(kw)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&Cl(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},Cl(h.userData,a),h.userData.uuid=this.userData.uuid;const g=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map($=>[$.uuid,$]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map($=>[$.uuid,$]))||[])};h.userData=Xr(h.userData,!1,g),e||(Object.keys(g.textures).length>0&&(h.textures=Object.values(g.textures)),Object.keys(g.images).length>0&&(h.images=Object.values(g.images))),h.type=Yp.TYPE;for(const $ of Object.keys(h))h[$]===void 0&&delete h[$];return h}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}Yp.TypeSlug="bmat",Yp.TYPE="MeshBasicMaterial2";const Wv={materialType:Yu.TYPE,name:"standard",color:"#ffffff"},E0={materialType:Yp.TYPE,name:"basic",color:"#ffffff"},A1={[Yu.TYPE]:Wv.name,MeshStandardMaterial:Wv.name,MeshPhysicalMaterial:Wv.name,[Yp.TYPE]:E0.name,MeshBasicMaterial:E0.name};class Um extends _e{constructor(){super(),this._templates=[Wv,E0],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),a=[];s.forEach(h=>{const g=h.userData.__appliedMaterials;g==null||g.delete(i),g&&h.userData.disposeOnIdle!==!1&&g.size===0&&a.push(h)}),a.forEach(h=>{h.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(a=>a.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(i=>{let s=i.userData.__appliedMaterials;s||(i.userData.__appliedMaterials=s=new Set),s.add(e)})})}_getMapsForMaterial(e){var i;const s=new Set;for(const a of Object.values(e))a&&a.isTexture&&s.add(a);for(const a of Object.values((i=e.userData)!==null&&i!==void 0?i:{}))a&&a.isTexture&&s.add(a);return s}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Ao());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(i=>i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){return sn(e,"modelObject",this._processModel(e,i)),e}_processMaterial(e,i){var s,a,h;if(!e)return;if(!((s=e.materialObject)===null||s===void 0)&&s.isMaterial)return e;let g=e.mmMaterial;if(!g){const $=((a=e.userData)===null||a===void 0?void 0:a.uuid)||e.uuid;if(g=this.findMaterial($),g)g.copyProps(e);else{const nt=i.useSourceMaterial===!1||!e.isMaterial,rt=(h=i.materialTemplate)!==null&&h!==void 0?h:nt?"standard":A1[e.type]||"standard";g=this.generateFromTemplate(rt,nt?{}:e)}e.mmMaterial=g}return g}processMaterial(e,i){return i.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,a=!1){const h=Xr(e,!1),g=JSON.stringify(h,null,s?0:2),$=(i||e.name||"physical_material")+"."+e.typeSlug,nt=new File([g],$,{type:"application/json"});return a&&Wp(nt),nt}}class P_ extends Um{_generateFromTemplate(e,i){var s,a,h,g,$,nt;let rt;const st={...e};st.customMaterialExtensions=[...(s=st.customMaterialExtensions)!==null&&s!==void 0?s:[],...this._materialExtensions];let ut={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&an(i,st,Array.from(Object.keys(Rw))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(st.roughness=.9,st.metalness=0,!((a=st.userData)===null||a===void 0)&&a.uuid&&delete st.userData.uuid),ut=(h=st.userData)===null||h===void 0?void 0:h.uuid,ut&&delete st.userData.uuid,rt=new Yu({customMaterialExtensions:st.customMaterialExtensions}).fromJSON(st,void 0,!0),ut&&(rt.uuid=ut),rt.userData.uuid=rt.uuid,rt.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=rt);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&an(i,st,Array.from(Object.keys(kw))),ut=(g=st.userData)===null||g===void 0?void 0:g.uuid,ut&&delete st.userData.uuid,rt=new Yp({customMaterialExtensions:st.customMaterialExtensions}).fromJSON(st,void 0,!0),ut&&(rt.uuid=ut),rt.userData.uuid=rt.uuid,rt.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:ut=null,i&&i.userData&&(ut=i.userData,delete i.userData),rt=(($=e.generator)===null||$===void 0?void 0:$.call(e,st,i))||void 0,i&&ut&&(i.userData=ut),ut&&rt&&(Cl(rt.userData,ut),ut!=null&&ut.uuid&&(rt.uuid=ut.uuid),ut=null),rt&&(rt.userData.uuid=rt.uuid)}if(rt){i.runtimeMaterial&&(rt.userData.__runtimeMaterial=!0);const mt=rt;if(rt.clone=()=>{mt.userData.cloneId||(mt.userData.cloneId="0",mt.userData.cloneCount=0),mt.userData.cloneCount+=1;const gt=this.generateFromTemplate(e.name);return gt&&(gt.copyProps(mt),gt.userData.cloneId=gt.userData.cloneId+"_"+mt.userData.cloneCount,gt.userData.cloneCount=0,gt.name=gt.name+"_"+gt.userData.cloneId),gt==null?void 0:gt.materialObject},i){let gt=this.findMaterial(i==null?void 0:i.uuid);gt&&this.unregisterMaterial(gt),gt=this.findMaterial((nt=i==null?void 0:i.materialObject)===null||nt===void 0?void 0:nt.uuid),gt&&this.unregisterMaterial(gt)}return this.registerMaterialObject(mt)}}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let a=!0;Array.isArray(s)||(s=[s],a=!1);const h=[];for(const g of s){const $=this._processMaterial(g,i);h.push($==null?void 0:$.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(a?h:h[0]))}if(i.recursive!==!1)for(let a=0;a<e.modelObject.children.length;a++)e.modelObject.children[a]=this._processModel(e.modelObject.children[a],i);return e}}class Ul{constructor(e,i,s,a){this.cls=e,this.ext=i,this.root=s,this.onCtor=a}ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}}function AA(c){var e;if(!c||c===""||c.match(/__MACOSX\/.*\._/))return"";const i=(e=(c=c.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",s=i.lastIndexOf(".");return i===""||s<1?"":i.slice(s+1)}function wA(c){return c.substring(c.lastIndexOf("/")+1)}class hv{constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:a=!1,autoScaleRadius:h=2,license:g=""}={}){if(this.assetType="model",this._modelObject=Qo(new d.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):ds(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const $=new ar().expandByObject(e,!0,!0).getCenter(new d.Pa4);this._modelObject.position.copy($).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,e.userData.iModel=this}a&&!this._modelObject.userData.autoScaled?is(this._modelObject,e.userData.autoScaleRadius||h):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=g}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,a,h;(s=(i=this._modelObject)===null||i===void 0?void 0:i.setDirty)===null||s===void 0||s.call(i,e),(h=(a=this._uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)===null||s===void 0?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,a;if(this._modelObject.isMesh)return(a=(s=this._modelObject).setGeometry)===null||a===void 0?void 0:a.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=bs(this._modelObject,!1)),this._uiConfig}clone(){return new hv(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function D_(c,e){return[c.modelObject,...c.modelObject.children].forEach(i=>{Qo(i,i!==c.modelObject?c:void 0,e)}),c}class S0{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))===null||s===void 0||s.push(i)}remove(e,i){const s=this._processors.get(e),a=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(h=>h.process&&h.process===i.process||h.processAsync&&h.processAsync===i.processAsync));!s||!a||a<0||s.splice(a,1)}get(e){var i;return(i=this._processors.get(e))!==null&&i!==void 0?i:[]}async process(e,i,s){var a,h,g,$;const nt=this.get(e),rt=i.assetType;for(const st of nt)st.forAssetType===rt&&(i=(h=(a=st.process)===null||a===void 0?void 0:a.call(st,i,s))!==null&&h!==void 0?h:i,i=($=await((g=st.processAsync)===null||g===void 0?void 0:g.call(st,i,s)))!==null&&$!==void 0?$:i);return i}dispose(){this._processors.clear()}}class xA extends d.hH6{load(e,i,s,a){return super.load(e,h=>{try{if(typeof h!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(h))}catch(g){a==null||a(g)}},s,a)}}class DS extends d.yxD{constructor(e){super(e),this.type=d.cLu}parse(e){const i=function(nt,rt){switch(nt){case 1:console.error("THREE.RGBELoader Read Error: "+(rt||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(rt||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(rt||""));break;default:console.error("THREE.RGBELoader: Error: "+(rt||""))}return-1},s=function(nt,rt,st){rt=rt||1024;let ut=nt.pos,mt=-1,gt=0,yt="",wt=String.fromCharCode.apply(null,new Uint16Array(nt.subarray(ut,ut+128)));for(;0>(mt=wt.indexOf(`
`))&&gt<rt&&ut<nt.byteLength;)yt+=wt,gt+=wt.length,ut+=128,wt+=String.fromCharCode.apply(null,new Uint16Array(nt.subarray(ut,ut+128)));return-1<mt&&(st!==!1&&(nt.pos+=gt+mt+1),yt+wt.slice(0,mt))},a=function(nt,rt,st,ut){const mt=nt[rt+3],gt=Math.pow(2,mt-128)/255;st[ut+0]=nt[rt+0]*gt,st[ut+1]=nt[rt+1]*gt,st[ut+2]=nt[rt+2]*gt,st[ut+3]=1},h=function(nt,rt,st,ut){const mt=nt[rt+3],gt=Math.pow(2,mt-128)/255;st[ut+0]=d.A5E.toHalfFloat(Math.min(nt[rt+0]*gt,65504)),st[ut+1]=d.A5E.toHalfFloat(Math.min(nt[rt+1]*gt,65504)),st[ut+2]=d.A5E.toHalfFloat(Math.min(nt[rt+2]*gt,65504)),st[ut+3]=d.A5E.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const $=function(nt){const rt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,st=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,ut=/^\s*FORMAT=(\S+)\s*$/,mt=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,gt={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let yt,wt;if(nt.pos>=nt.byteLength||!(yt=s(nt)))return i(1,"no header found");if(!(wt=yt.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(gt.valid|=1,gt.programtype=wt[1],gt.string+=yt+`
`;yt=s(nt),yt!==!1;)if(gt.string+=yt+`
`,yt.charAt(0)!=="#"){if((wt=yt.match(rt))&&(gt.gamma=parseFloat(wt[1])),(wt=yt.match(st))&&(gt.exposure=parseFloat(wt[1])),(wt=yt.match(ut))&&(gt.valid|=2,gt.format=wt[1]),(wt=yt.match(mt))&&(gt.valid|=4,gt.height=parseInt(wt[1],10),gt.width=parseInt(wt[2],10)),2&gt.valid&&4&gt.valid)break}else gt.comments+=yt+`
`;return 2&gt.valid?4&gt.valid?gt:i(3,"missing image size specifier"):i(3,"missing format specifier")}(g);if($!==-1){const nt=$.width,rt=$.height,st=function(ut,mt,gt){const yt=mt;if(yt<8||yt>32767||ut[0]!==2||ut[1]!==2||128&ut[2])return new Uint8Array(ut);if(yt!==(ut[2]<<8|ut[3]))return i(3,"wrong scanline width");const wt=new Uint8Array(4*mt*gt);if(!wt.length)return i(4,"unable to allocate buffer space");let It=0,Et=0;const Ct=4*yt,xt=new Uint8Array(4),Bt=new Uint8Array(Ct);let Lt=gt;for(;Lt>0&&Et<ut.byteLength;){if(Et+4>ut.byteLength)return i(1);if(xt[0]=ut[Et++],xt[1]=ut[Et++],xt[2]=ut[Et++],xt[3]=ut[Et++],xt[0]!=2||xt[1]!=2||(xt[2]<<8|xt[3])!=yt)return i(3,"bad rgbe scanline format");let Gt,Xt=0;for(;Xt<Ct&&Et<ut.byteLength;){Gt=ut[Et++];const fn=Gt>128;if(fn&&(Gt-=128),Gt===0||Xt+Gt>Ct)return i(3,"bad scanline data");if(fn){const wn=ut[Et++];for(let Cn=0;Cn<Gt;Cn++)Bt[Xt++]=wn}else Bt.set(ut.subarray(Et,Et+Gt),Xt),Xt+=Gt,Et+=Gt}const rn=yt;for(let fn=0;fn<rn;fn++){let wn=0;wt[It]=Bt[fn+wn],wn+=yt,wt[It+1]=Bt[fn+wn],wn+=yt,wt[It+2]=Bt[fn+wn],wn+=yt,wt[It+3]=Bt[fn+wn],It+=4}Lt--}return wt}(g.subarray(g.pos),nt,rt);if(st!==-1){let ut,mt,gt;switch(this.type){case d.VzW:gt=st.length/4;const yt=new Float32Array(4*gt);for(let It=0;It<gt;It++)a(st,4*It,yt,4*It);ut=yt,mt=d.VzW;break;case d.cLu:gt=st.length/4;const wt=new Uint16Array(4*gt);for(let It=0;It<gt;It++)h(st,4*It,wt,4*It);ut=wt,mt=d.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:nt,height:rt,data:ut,header:$.string,gamma:$.gamma,exposure:$.exposure,type:mt}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,g){switch(h.type){case d.VzW:case d.cLu:h.encoding=d.rnI,h.minFilter=d.wem,h.magFilter=d.wem,h.generateMipmaps=!1,h.flipY=!0}i&&i(h,g)},s,a)}}function w1(c){oo.Importers.push(new Ul(class extends DS{constructor(e){super(e),this.setDataType(R1(c))}},["hdr"],!1))}class dv extends d.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Cy(i)}),this.register(function(i){return new sp(i)}),this.register(function(i){return new pv(i)}),this.register(function(i){return new Ts(i)}),this.register(function(i){return new jm(i)}),this.register(function(i){return new My(i)}),this.register(function(i){return new Ty(i)}),this.register(function(i){return new R_(i)}),this.register(function(i){return new qv(i)}),this.register(function(i){return new Xu(i)}),this.register(function(i){return new nu(i)}),this.register(function(i){return new $a(i)})}load(e,i,s,a){const h=this;let g;g=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:d.Zp0.extractUrlBase(e),this.manager.itemStart(e);const $=function(rt){a?a(rt):console.error(rt),h.manager.itemError(e),h.manager.itemEnd(e)},nt=new d.hH6(this.manager);nt.setPath(this.path),nt.setResponseType("arraybuffer"),nt.setRequestHeader(this.requestHeader),nt.setWithCredentials(this.withCredentials),nt.load(e,function(rt){try{h.parse(rt,g,function(st){i(st),h.manager.itemEnd(e)},$)}catch(st){$(st)}},s,$)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a){let h;const g={},$={};if(typeof e=="string")h=e;else if(d.Zp0.decodeText(new Uint8Array(e,0,4))===EA){try{g[js.KHR_BINARY_GLTF]=new Lr(e)}catch(st){return void(a&&a(st))}h=g[js.KHR_BINARY_GLTF].content}else h=d.Zp0.decodeText(new Uint8Array(e));const nt=JSON.parse(h);if(nt.asset===void 0||nt.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const rt=new vu(nt,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});rt.fileLoader.setRequestHeader(this.requestHeader);for(let st=0;st<this.pluginCallbacks.length;st++){const ut=this.pluginCallbacks[st](rt);$[ut.name]=ut,g[ut.name]=!0}if(nt.extensionsUsed)for(let st=0;st<nt.extensionsUsed.length;++st){const ut=nt.extensionsUsed[st],mt=nt.extensionsRequired||[];switch(ut){case js.KHR_MATERIALS_UNLIT:g[ut]=new Bw;break;case js.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:g[ut]=new k_;break;case js.KHR_DRACO_MESH_COMPRESSION:g[ut]=new Ru(nt,this.dracoLoader);break;case js.KHR_TEXTURE_TRANSFORM:g[ut]=new x1;break;case js.KHR_MESH_QUANTIZATION:g[ut]=new B_;break;default:mt.indexOf(ut)>=0&&$[ut]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ut+'".')}}rt.setExtensions(g),rt.setPlugins($),rt.parse(s,a)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,i,a,h)})}}function bA(){let c={};return{get:function(e){return c[e]},add:function(e,i){c[e]=i},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const js={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class nu{constructor(e){this.parser=e,this.name=js.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,a=i.length;s<a;s++){const h=i[s];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let a=i.cache.get(s);if(a)return a;const h=i.json,g=((h.extensions&&h.extensions[this.name]||{}).lights||[])[e];let $;const nt=new d.Ilk(16777215);g.color!==void 0&&nt.fromArray(g.color);const rt=g.range!==void 0?g.range:0;switch(g.type){case"directional":$=new d.Ox3(nt),$.target.position.set(0,0,-1),$.add($.target);break;case"point":$=new d.cek(nt),$.distance=rt;break;case"spot":$=new d.PMe(nt),$.distance=rt,g.spot=g.spot||{},g.spot.innerConeAngle=g.spot.innerConeAngle!==void 0?g.spot.innerConeAngle:0,g.spot.outerConeAngle=g.spot.outerConeAngle!==void 0?g.spot.outerConeAngle:Math.PI/4,$.angle=g.spot.outerConeAngle,$.penumbra=1-g.spot.innerConeAngle/g.spot.outerConeAngle,$.target.position.set(0,0,-1),$.add($.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+g.type)}return $.position.set(0,0,0),$.decay=2,g.intensity!==void 0&&($.intensity=g.intensity),$.name=i.createUniqueName(g.name||"light_"+e),a=Promise.resolve($),i.cache.add(s,a),a}createNodeAttachment(e){const i=this,s=this.parser,a=s.json.nodes[e],h=(a.extensions&&a.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(g){return s._getNodeRef(i.cache,h,g)})}}class Bw{constructor(){this.name=js.KHR_MATERIALS_UNLIT}getMaterialType(){return d.vBJ}extendParams(e,i,s){const a=[];e.color=new d.Ilk(1,1,1),e.opacity=1;const h=i.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const g=h.baseColorFactor;e.color.fromArray(g),e.opacity=g[3]}h.baseColorTexture!==void 0&&a.push(s.assignTexture(e,"map",h.baseColorTexture,d.knz))}return Promise.all(a)}}class R_{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(i.emissiveIntensity=a),Promise.resolve()}}class Cy{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];if(g.clearcoatFactor!==void 0&&(i.clearcoat=g.clearcoatFactor),g.clearcoatTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatMap",g.clearcoatTexture)),g.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=g.clearcoatRoughnessFactor),g.clearcoatRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatRoughnessMap",g.clearcoatRoughnessTexture)),g.clearcoatNormalTexture!==void 0&&(h.push(s.assignTexture(i,"clearcoatNormalMap",g.clearcoatNormalTexture)),g.clearcoatNormalTexture.scale!==void 0)){const $=g.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new d.FM8($,$)}return Promise.all(h)}}class Xu{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];return g.iridescenceFactor!==void 0&&(i.iridescence=g.iridescenceFactor),g.iridescenceTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceMap",g.iridescenceTexture)),g.iridescenceIor!==void 0&&(i.iridescenceIOR=g.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),g.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=g.iridescenceThicknessMinimum),g.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=g.iridescenceThicknessMaximum),g.iridescenceThicknessTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceThicknessMap",g.iridescenceThicknessTexture)),Promise.all(h)}}class Ts{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[];i.sheenColor=new d.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const g=a.extensions[this.name];return g.sheenColorFactor!==void 0&&i.sheenColor.fromArray(g.sheenColorFactor),g.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=g.sheenRoughnessFactor),g.sheenColorTexture!==void 0&&h.push(s.assignTexture(i,"sheenColorMap",g.sheenColorTexture,d.knz)),g.sheenRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"sheenRoughnessMap",g.sheenRoughnessTexture)),a.extras&&a.extras.sheenFactor!==void 0&&(i.sheen=a.extras.sheenFactor,delete a.extras.sheenFactor),Promise.all(h)}}class jm{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];return g.transmissionFactor!==void 0&&(i.transmission=g.transmissionFactor),g.transmissionTexture!==void 0&&h.push(s.assignTexture(i,"transmissionMap",g.transmissionTexture)),Promise.all(h)}}class My{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];i.thickness=g.thicknessFactor!==void 0?g.thicknessFactor:0,g.thicknessTexture!==void 0&&h.push(s.assignTexture(i,"thicknessMap",g.thicknessTexture)),i.attenuationDistance=g.attenuationDistance||0;const $=g.attenuationColor||[1,1,1];return i.attenuationColor=new d.Ilk($[0],$[1],$[2]),Promise.all(h)}}class Ty{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class qv{constructor(e){this.parser=e,this.name=js.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];i.specularIntensity=g.specularFactor!==void 0?g.specularFactor:1,g.specularTexture!==void 0&&h.push(s.assignTexture(i,"specularIntensityMap",g.specularTexture));const $=g.specularColorFactor||[1,1,1];return i.specularColor=new d.Ilk($[0],$[1],$[2]),g.specularColorTexture!==void 0&&h.push(s.assignTexture(i,"specularColorMap",g.specularColorTexture,d.knz)),Promise.all(h)}}class sp{constructor(e){this.parser=e,this.name=js.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const h=a.extensions[this.name],g=i.options.ktx2Loader;if(!g){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,h.source,g)}}class pv{constructor(e){this.parser=e,this.name=js.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,a=s.json,h=a.textures[e];if(!h.extensions||!h.extensions[i])return null;const g=h.extensions[i],$=a.images[g.source];let nt=s.textureLoader;if($.uri){const rt=s.options.manager.getHandler($.uri);rt!==null&&(nt=rt)}return this.detectSupport().then(function(rt){if(rt)return s.loadTextureImage(e,g.source,nt);if(a.extensionsRequired&&a.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class $a{constructor(e){this.name=js.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const a=s.extensions[this.name],h=this.parser.getDependency("buffer",a.buffer),g=this.parser.options.meshoptDecoder;if(!g||!g.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function($){const nt=a.byteOffset||0,rt=a.byteLength||0,st=a.count,ut=a.byteStride,mt=new Uint8Array($,nt,rt);return g.decodeGltfBufferAsync?g.decodeGltfBufferAsync(st,ut,mt,a.mode,a.filter).then(function(gt){return gt.buffer}):g.ready.then(function(){const gt=new ArrayBuffer(st*ut);return g.decodeGltfBuffer(new Uint8Array(gt),st,ut,mt,a.mode,a.filter),gt})})}return null}}const EA="glTF";class Lr{constructor(e){this.name=js.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12);if(this.header={magic:d.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==EA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let h=0;for(;h<s;){const g=a.getUint32(h,!0);h+=4;const $=a.getUint32(h,!0);if(h+=4,$===1313821514){const nt=new Uint8Array(e,12+h,g);this.content=d.Zp0.decodeText(nt)}else if($===5130562){const nt=12+h;this.body=e.slice(nt,nt+g)}h+=g}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ru{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=js.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,a=this.dracoLoader,h=e.extensions[this.name].bufferView,g=e.extensions[this.name].attributes,$={},nt={},rt={};for(const st in g){const ut=M0[st]||st.toLowerCase();$[ut]=g[st]}for(const st in e.attributes){const ut=M0[st]||st.toLowerCase();if(g[st]!==void 0){const mt=s.accessors[e.attributes[st]],gt=Ku[mt.componentType];rt[ut]=gt.name,nt[ut]=mt.normalized===!0}}return i.getDependency("bufferView",h).then(function(st){return new Promise(function(ut){a.decodeDracoFile(st,function(mt){for(const gt in mt.attributes){const yt=mt.attributes[gt],wt=nt[gt];wt!==void 0&&(yt.normalized=wt)}ut(mt)},$,rt)})})}}class x1{constructor(){this.name=js.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return i.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class Ow extends d.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const i=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),g=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),$={specular:{value:new d.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=$,this.onBeforeCompile=function(nt){for(const rt in $)nt.uniforms[rt]=$[rt];nt.fragmentShader=nt.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",g)},Object.defineProperties(this,{specular:{get:function(){return $.specular.value},set:function(nt){$.specular.value=nt}},specularMap:{get:function(){return $.specularMap.value},set:function(nt){$.specularMap.value=nt,nt?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return $.glossiness.value},set:function(nt){$.glossiness.value=nt}},glossinessMap:{get:function(){return $.glossinessMap.value},set:function(nt){$.glossinessMap.value=nt,nt?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class k_{constructor(){this.name=js.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Ow}extendParams(e,i,s){const a=i.extensions[this.name];e.color=new d.Ilk(1,1,1),e.opacity=1;const h=[];if(Array.isArray(a.diffuseFactor)){const g=a.diffuseFactor;e.color.fromArray(g),e.opacity=g[3]}if(a.diffuseTexture!==void 0&&h.push(s.assignTexture(e,"map",a.diffuseTexture,d.knz)),e.emissive=new d.Ilk(0,0,0),e.glossiness=a.glossinessFactor!==void 0?a.glossinessFactor:1,e.specular=new d.Ilk(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),a.specularGlossinessTexture!==void 0){const g=a.specularGlossinessTexture;h.push(s.assignTexture(e,"glossinessMap",g)),h.push(s.assignTexture(e,"specularMap",g,d.knz))}return Promise.all(h)}createMaterial(e){const i=new Ow(e);return i.fog=!0,i.color=e.color,i.map=e.map===void 0?null:e.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=e.aoMap===void 0?null:e.aoMap,i.aoMapIntensity=1,i.emissive=e.emissive,i.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,i.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,i.bumpMap=e.bumpMap===void 0?null:e.bumpMap,i.bumpScale=1,i.normalMap=e.normalMap===void 0?null:e.normalMap,i.normalMapType=d.IOt,e.normalScale&&(i.normalScale=e.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=e.specularMap===void 0?null:e.specularMap,i.specular=e.specular,i.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,i.glossiness=e.glossiness,i.alphaMap=null,i.envMap=e.envMap===void 0?null:e.envMap,i.envMapIntensity=1,i}}class B_{constructor(){this.name=js.KHR_MESH_QUANTIZATION}}class _m extends d._C8{constructor(e,i,s,a){super(e,i,s,a)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,h=e*a*3+a;for(let g=0;g!==a;g++)i[g]=s[h+g];return i}interpolate_(e,i,s,a){const h=this.resultBuffer,g=this.sampleValues,$=this.valueSize,nt=2*$,rt=3*$,st=a-i,ut=(s-i)/st,mt=ut*ut,gt=mt*ut,yt=e*rt,wt=yt-rt,It=-2*gt+3*mt,Et=gt-mt,Ct=1-It,xt=Et-mt+ut;for(let Bt=0;Bt!==$;Bt++){const Lt=g[wt+Bt+$],Gt=g[wt+Bt+nt]*st,Xt=g[yt+Bt+$],rn=g[yt+Bt]*st;h[Bt]=Ct*Lt+xt*Gt+It*Xt+Et*rn}return h}}const Iy=new d._fP;class C0 extends _m{interpolate_(e,i,s,a){const h=super.interpolate_(e,i,s,a);return Iy.fromArray(h).normalize().toArray(h),h}}const Ku={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},SA={9728:d.TyD,9729:d.wem,9984:d.YLQ,9985:d.qyh,9986:d.aH4,9987:d.D1R},zl={33071:d.uWy,33648:d.OoA,10497:d.rpg},Xp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Rp={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},CA={CUBICSPLINE:void 0,LINEAR:d.NMF,STEP:d.Syv};function as(c,e,i){for(const s in i.extensions)c[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function Kp(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Py(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)c.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(c.morphTargetInfluences.length===i.length){c.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++)c.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function O_(c){const e=c.extensions&&c.extensions[js.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+T0(e.attributes):c.indices+":"+T0(c.attributes)+":"+c.mode,i}function T0(c){let e="";const i=Object.keys(c).sort();for(let s=0,a=i.length;s<a;s++)e+=i[s]+":"+c[i[s]]+";";return e}function Lw(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class vu{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new bA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,h=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||a&&h<98?this.textureLoader=new d.dpR(this.options.manager):this.textureLoader=new d.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new d.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,a=this.json,h=this.extensions;this.cache.removeAll(),this._invokeAll(function(g){return g._markDefs&&g._markDefs()}),Promise.all(this._invokeAll(function(g){return g.beforeRoot&&g.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(g){const $={scene:g[0][a.scene||0],scenes:g[0],animations:g[1],cameras:g[2],asset:a.asset,parser:s,userData:{}};as(h,$,a),Kp($,a),Promise.all(s._invokeAll(function(nt){return nt.afterRoot&&nt.afterRoot($)})).then(function(){e($)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let a=0,h=i.length;a<h;a++){const g=i[a].joints;for(let $=0,nt=g.length;$<nt;$++)e[g[$]].isBone=!0}for(let a=0,h=e.length;a<h;a++){const g=e[a];g.mesh!==void 0&&(this._addNodeRef(this.meshCache,g.mesh),g.skin!==void 0&&(s[g.mesh].isSkinnedMesh=!0)),g.camera!==void 0&&this._addNodeRef(this.cameraCache,g.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const a=s.clone(),h=(g,$)=>{const nt=this.associations.get(g);nt!=null&&this.associations.set($,nt);for(const[rt,st]of g.children.entries())h(st,$.children[rt])};return h(s,a),a.name+="_instance_"+e.uses[i]++,a}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const a=e(i[s]);if(a)return a}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let a=0;a<i.length;a++){const h=e(i[a]);h&&s.push(h)}return s}getDependency(e,i){const s=e+":"+i;let a=this.cache.get(s);if(!a){switch(e){case"scene":a=this.loadScene(i);break;case"node":a=this.loadNode(i);break;case"mesh":a=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(i)});break;case"accessor":a=this.loadAccessor(i);break;case"bufferView":a=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(i)});break;case"buffer":a=this.loadBuffer(i);break;case"material":a=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(i)});break;case"texture":a=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(i)});break;case"skin":a=this.loadSkin(i);break;case"animation":a=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(i)});break;case"camera":a=this.loadCamera(i);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,a)}return a}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(a.map(function(h,g){return s.getDependency(e,g)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[js.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(h,g){s.load(d.Zp0.resolveURL(i.uri,a.path),h,void 0,function(){g(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const a=i.byteLength||0,h=i.byteOffset||0;return s.slice(h,h+a)})}loadAccessor(e){const i=this,s=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0)return Promise.resolve(null);const h=[];return a.bufferView!==void 0?h.push(this.getDependency("bufferView",a.bufferView)):h.push(null),a.sparse!==void 0&&(h.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(h).then(function(g){const $=g[0],nt=Xp[a.type],rt=Ku[a.componentType],st=rt.BYTES_PER_ELEMENT,ut=st*nt,mt=a.byteOffset||0,gt=a.bufferView!==void 0?s.bufferViews[a.bufferView].byteStride:void 0,yt=a.normalized===!0;let wt,It;if(gt&&gt!==ut){const Et=Math.floor(mt/gt),Ct="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+Et+":"+a.count;let xt=i.cache.get(Ct);xt||(wt=new rt($,Et*gt,a.count*gt/st),xt=new d.vpT(wt,gt/st),i.cache.add(Ct,xt)),It=new d.kB5(xt,nt,mt%gt/st,yt)}else wt=$===null?new rt(a.count*nt):new rt($,mt,a.count*nt),It=new d.TlE(wt,nt,yt);if(a.sparse!==void 0){const Et=Xp.SCALAR,Ct=Ku[a.sparse.indices.componentType],xt=a.sparse.indices.byteOffset||0,Bt=a.sparse.values.byteOffset||0,Lt=new Ct(g[1],xt,a.sparse.count*Et),Gt=new rt(g[2],Bt,a.sparse.count*nt);$!==null&&(It=new d.TlE(It.array.slice(),It.itemSize,It.normalized));for(let Xt=0,rn=Lt.length;Xt<rn;Xt++){const fn=Lt[Xt];if(It.setX(fn,Gt[Xt*nt]),nt>=2&&It.setY(fn,Gt[Xt*nt+1]),nt>=3&&It.setZ(fn,Gt[Xt*nt+2]),nt>=4&&It.setW(fn,Gt[Xt*nt+3]),nt>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return It})}loadTexture(e){const i=this.json,s=this.options,a=i.textures[e].source,h=i.images[a];let g=this.textureLoader;if(h.uri){const $=s.manager.getHandler(h.uri);$!==null&&(g=$)}return this.loadTextureImage(e,a,g)}loadTextureImage(e,i,s){const a=this,h=this.json,g=h.textures[e],$=h.images[i],nt=($.uri||$.bufferView)+":"+g.sampler;if(this.textureCache[nt])return this.textureCache[nt];const rt=this.loadImageSource(i,s).then(function(st){g.name&&(st.name=g.name);const ut=(h.samplers||{})[g.sampler]||{};return st.magFilter=SA[ut.magFilter]||d.wem,st.minFilter=SA[ut.minFilter]||d.D1R,st.wrapS=zl[ut.wrapS]||d.rpg,st.wrapT=zl[ut.wrapT]||d.rpg,ut.extras&&ut.extras.uuid!==void 0&&(st.uuid=ut.extras.uuid),a.associations.set(st,{textures:e}),st}).catch(function(){return null});return this.textureCache[nt]=rt,rt}loadImageSource(e,i){const s=this,a=this.json,h=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(ut=>ut.clone());const g=a.images[e],$=self.URL||self.webkitURL;let nt=g.uri||"",rt=!1;if(g.bufferView!==void 0)nt=s.getDependency("bufferView",g.bufferView).then(function(ut){rt=!0;const mt=new Blob([ut],{type:g.mimeType});return nt=$.createObjectURL(mt),nt});else if(g.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const st=Promise.resolve(nt).then(function(ut){return new Promise(function(mt,gt){let yt=mt;i.isImageBitmapLoader===!0&&(yt=function(wt){const It=new d.xEZ(wt);It.needsUpdate=!0,mt(It)}),i.load(d.Zp0.resolveURL(ut,h.path),yt,void 0,function(wt){i.isImageBitmapLoader===!0?(i=new d.dpR(s.options.manager),yt=mt,i.setCrossOrigin(s.options.crossOrigin),i.setRequestHeader(s.options.requestHeader),i.load(d.Zp0.resolveURL(ut,h.path),yt,void 0,gt)):gt(wt)})})}).then(function(ut){var mt;if(rt===!0&&$.revokeObjectURL(nt),ut.userData.mimeType=g.mimeType||((mt=g.uri).search(/\.jpe?g($|\?)/i)>0||mt.search(/^data\:image\/jpeg/)===0?"image/jpeg":mt.search(/\.webp($|\?)/i)>0||mt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),ut.flipY=!1,g.extras){if(g.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const gt=ut,yt=g.extras.flipY&&!gt.flipY;createImageBitmap(gt.source.data,{imageOrientation:yt?"flipY":"none"}).then(function(wt){gt.source.data.close&&gt.source.data.close(),gt.source.data=wt,gt.source.needsUpdate=!0,gt.needsUpdate=!0})}ut.flipY=g.extras.flipY,ut.needsUpdate=!0,delete g.extras.flipY}g.extras.uuid!==void 0&&(ut.source.uuid=g.extras.uuid),g.extras.t_uuid!==void 0&&(ut.uuid=g.extras.t_uuid)}return g.uri&&typeof g.uri=="string"&&(ut.userData.rootPath=g.uri),ut}).catch(function(ut){throw console.error("THREE.GLTFLoader: Couldn't load texture",nt),ut});return this.sourceCache[e]=st,st}assignTexture(e,i,s,a){const h=this;return this.getDependency("texture",s.index).then(function(g){if(s.texCoord===void 0||s.texCoord==0||i==="aoMap"&&s.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+i+" not yet supported."),h.extensions[js.KHR_TEXTURE_TRANSFORM]){const $=s.extensions!==void 0?s.extensions[js.KHR_TEXTURE_TRANSFORM]:void 0;if($){const nt=h.associations.get(g);g=h.extensions[js.KHR_TEXTURE_TRANSFORM].extendTexture(g,$),h.associations.set(g,nt)}}return a!==void 0&&(g.encoding=a),e[i]=g,g})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const a=i.attributes.tangent===void 0,h=i.attributes.color!==void 0,g=i.attributes.normal===void 0;if(e.isPoints){const $="PointsMaterial:"+s.uuid;let nt=this.cache.get($);nt||(nt=new d.UY4,d.F5T.prototype.copy.call(nt,s),nt.color.copy(s.color),nt.map=s.map,nt.sizeAttenuation=!1,this.cache.add($,nt)),s=nt}else if(e.isLine){const $="LineBasicMaterial:"+s.uuid;let nt=this.cache.get($);nt||(nt=new d.nls,d.F5T.prototype.copy.call(nt,s),nt.color.copy(s.color),this.cache.add($,nt)),s=nt}if(a||h||g){let $="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&($+="specular-glossiness:"),a&&($+="derivative-tangents:"),h&&($+="vertex-colors:"),g&&($+="flat-shading:");let nt=this.cache.get($);nt||(nt=s.clone(),h&&(nt.vertexColors=!0),g&&(nt.flatShading=!0),a&&(nt.normalScale&&(nt.normalScale.y*=-1),nt.clearcoatNormalScale&&(nt.clearcoatNormalScale.y*=-1)),this.cache.add($,nt),this.associations.set(nt,this.associations.get(s))),s=nt}s.aoMap&&i.attributes.uv2===void 0&&i.attributes.uv!==void 0&&i.setAttribute("uv2",i.attributes.uv),e.material=s}getMaterialType(){return d.Wid}loadMaterial(e){const i=this,s=this.json,a=this.extensions,h=s.materials[e];let g;const $={},nt=h.extensions||{},rt=[];if(nt[js.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const ut=a[js.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];g=ut.getMaterialType(),rt.push(ut.extendParams($,h,i))}else if(nt[js.KHR_MATERIALS_UNLIT]){const ut=a[js.KHR_MATERIALS_UNLIT];g=ut.getMaterialType(),rt.push(ut.extendParams($,h,i))}else{const ut=h.pbrMetallicRoughness||{};if($.color=new d.Ilk(1,1,1),$.opacity=1,Array.isArray(ut.baseColorFactor)){const mt=ut.baseColorFactor;$.color.fromArray(mt),$.opacity=mt[3]}ut.baseColorTexture!==void 0&&rt.push(i.assignTexture($,"map",ut.baseColorTexture,d.knz)),$.metalness=ut.metallicFactor!==void 0?ut.metallicFactor:1,$.roughness=ut.roughnessFactor!==void 0?ut.roughnessFactor:1,ut.metallicRoughnessTexture!==void 0&&(rt.push(i.assignTexture($,"metalnessMap",ut.metallicRoughnessTexture)),rt.push(i.assignTexture($,"roughnessMap",ut.metallicRoughnessTexture))),g=this._invokeOne(function(mt){return mt.getMaterialType&&mt.getMaterialType(e)}),rt.push(Promise.all(this._invokeAll(function(mt){return mt.extendMaterialParams&&mt.extendMaterialParams(e,$)})))}h.doubleSided===!0&&($.side=d.ehD);const st=h.alphaMode||"OPAQUE";if(st==="BLEND"?($.transparent=!0,$.depthWrite=!1):($.transparent=!1,st==="MASK"&&($.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&g!==d.vBJ&&(rt.push(i.assignTexture($,"normalMap",h.normalTexture)),$.normalScale=new d.FM8(1,1),h.normalTexture.scale!==void 0)){const ut=h.normalTexture.scale;$.normalScale.set(ut,ut)}return h.occlusionTexture!==void 0&&g!==d.vBJ&&(rt.push(i.assignTexture($,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&($.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&g!==d.vBJ&&($.emissive=new d.Ilk().fromArray(h.emissiveFactor)),h.emissiveTexture!==void 0&&g!==d.vBJ&&rt.push(i.assignTexture($,"emissiveMap",h.emissiveTexture,d.knz)),Promise.all(rt).then(function(){let ut;return ut=g===Ow?a[js.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial($):new g($),h.name&&(ut.name=h.name),Kp(ut,h),i.associations.set(ut,{materials:e}),h.extensions&&as(a,ut,h),ut})}createUniqueName(e){const i=d.iUV.sanitizeNodeName(e||"");let s=i;for(let a=1;this.nodeNamesUsed[s];++a)s=i+"_"+a;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,a=this.primitiveCache;function h($){return s[js.KHR_DRACO_MESH_COMPRESSION].decodePrimitive($,i).then(function(nt){return wp(nt,$,i)})}const g=[];for(let $=0,nt=e.length;$<nt;$++){const rt=e[$],st=O_(rt),ut=a[st];if(ut)g.push(ut.promise);else{let mt;mt=rt.extensions&&rt.extensions[js.KHR_DRACO_MESH_COMPRESSION]?h(rt):wp(new d.u9r,rt,i),a[st]={primitive:rt,promise:mt},g.push(mt)}}return Promise.all(g)}loadMesh(e){const i=this,s=this.json,a=this.extensions,h=s.meshes[e],g=h.primitives,$=[];for(let rt=0,st=g.length;rt<st;rt++){const ut=g[rt].material===void 0?((nt=this.cache).DefaultMaterial===void 0&&(nt.DefaultMaterial=new d.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:d.Wl3})),nt.DefaultMaterial):this.getDependency("material",g[rt].material);$.push(ut)}var nt;return $.push(i.loadGeometries(g)),Promise.all($).then(function(rt){const st=rt.slice(0,rt.length-1),ut=rt[rt.length-1],mt=[];for(let yt=0,wt=ut.length;yt<wt;yt++){const It=ut[yt],Et=g[yt];let Ct;const xt=st[yt];if(Et.mode===4||Et.mode===5||Et.mode===6||Et.mode===void 0)Ct=h.isSkinnedMesh===!0?new d.TUv(It,xt):new d.Kj0(It,xt),Ct.isSkinnedMesh!==!0||Ct.geometry.attributes.skinWeight.normalized||Ct.normalizeSkinWeights(),Et.mode===5?Ct.geometry=I0(Ct.geometry,d.UlW):Et.mode===6&&(Ct.geometry=I0(Ct.geometry,d.z$h));else if(Et.mode===1)Ct=new d.ejS(It,xt);else if(Et.mode===3)Ct=new d.x12(It,xt);else if(Et.mode===2)Ct=new d.blk(It,xt);else{if(Et.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Et.mode);Ct=new d.woe(It,xt)}Object.keys(Ct.geometry.morphAttributes).length>0&&Py(Ct,h),Ct.name=i.createUniqueName(h.name||"mesh_"+e),Kp(Ct,h),Et.extensions&&as(a,Ct,Et),i.assignFinalMaterial(Ct),mt.push(Ct)}h.extensions&&mt.forEach(yt=>as(a,yt,h));for(let yt=0,wt=mt.length;yt<wt;yt++)i.associations.set(mt[yt],{meshes:e,primitives:yt});if(mt.length===1)return mt[0];const gt=new d.ZAu;i.associations.set(gt,{meshes:e});for(let yt=0,wt=mt.length;yt<wt;yt++)gt.add(mt[yt]);return gt})}loadCamera(e){let i;const s=this.json.cameras[e],a=s[s.type];if(a)return s.type==="perspective"?i=new d.cPb(d.M8C.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):s.type==="orthographic"&&(i=new d.iKG(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),Kp(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s={joints:i.joints};return i.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",i.inverseBindMatrices).then(function(a){return s.inverseBindMatrices=a,s})}loadAnimation(e){const i=this.json.animations[e],s=[],a=[],h=[],g=[],$=[];for(let nt=0,rt=i.channels.length;nt<rt;nt++){const st=i.channels[nt],ut=i.samplers[st.sampler],mt=st.target,gt=mt.node,yt=i.parameters!==void 0?i.parameters[ut.input]:ut.input,wt=i.parameters!==void 0?i.parameters[ut.output]:ut.output;s.push(this.getDependency("node",gt)),a.push(this.getDependency("accessor",yt)),h.push(this.getDependency("accessor",wt)),g.push(ut),$.push(mt)}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(h),Promise.all(g),Promise.all($)]).then(function(nt){const rt=nt[0],st=nt[1],ut=nt[2],mt=nt[3],gt=nt[4],yt=[];for(let It=0,Et=rt.length;It<Et;It++){const Ct=rt[It],xt=st[It],Bt=ut[It],Lt=mt[It],Gt=gt[It];if(Ct===void 0)continue;let Xt;switch(Ct.updateMatrix(),Rp[Gt.path]){case Rp.weights:Xt=d.dUE;break;case Rp.rotation:Xt=d.iLg;break;default:Xt=d.yC1}const rn=Ct.name?Ct.name:Ct.uuid,fn=Lt.interpolation!==void 0?CA[Lt.interpolation]:d.NMF,wn=[];Rp[Gt.path]===Rp.weights?Ct.traverse(function(bn){bn.morphTargetInfluences&&wn.push(bn.name?bn.name:bn.uuid)}):wn.push(rn);let Cn=Bt.array;if(Bt.normalized){const bn=Lw(Cn.constructor),Dn=new Float32Array(Cn.length);for(let En=0,Tn=Cn.length;En<Tn;En++)Dn[En]=Cn[En]*bn;Cn=Dn}for(let bn=0,Dn=wn.length;bn<Dn;bn++){const En=new Xt(wn[bn]+"."+Rp[Gt.path],xt.array,Cn,fn);Lt.interpolation==="CUBICSPLINE"&&(En.createInterpolant=function(Tn){return new(this instanceof d.iLg?C0:_m)(this.times,this.values,this.getValueSize()/3,Tn)},En.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),yt.push(En)}}const wt=i.name?i.name:"animation_"+e;return new d.m7l(wt,void 0,yt)})}createNodeMesh(e){const i=this.json,s=this,a=i.nodes[e];return a.mesh===void 0?null:s.getDependency("mesh",a.mesh).then(function(h){const g=s._getNodeRef(s.meshCache,a.mesh,h);return a.weights!==void 0&&g.traverse(function($){if($.isMesh)for(let nt=0,rt=a.weights.length;nt<rt;nt++)$.morphTargetInfluences[nt]=a.weights[nt]}),g})}loadNode(e){const i=this.json,s=this.extensions,a=this,h=i.nodes[e],g=h.name?a.createUniqueName(h.name):"";return function(){const $=[],nt=a._invokeOne(function(rt){return rt.createNodeMesh&&rt.createNodeMesh(e)});return nt&&$.push(nt),h.camera!==void 0&&$.push(a.getDependency("camera",h.camera).then(function(rt){return a._getNodeRef(a.cameraCache,h.camera,rt)})),a._invokeAll(function(rt){return rt.createNodeAttachment&&rt.createNodeAttachment(e)}).forEach(function(rt){$.push(rt)}),Promise.all($)}().then(function($){let nt;if(nt=h.isBone===!0?new d.N$j:$.length>1?new d.ZAu:$.length===1?$[0]:new d.Tme,nt!==$[0])for(let rt=0,st=$.length;rt<st;rt++)nt.add($[rt]);if(h.name&&(nt.userData.name=h.name,nt.name=g),Kp(nt,h),h.extensions&&as(s,nt,h),h.matrix!==void 0){const rt=new d.yGw;rt.fromArray(h.matrix),nt.applyMatrix4(rt)}else h.translation!==void 0&&nt.position.fromArray(h.translation),h.rotation!==void 0&&nt.quaternion.fromArray(h.rotation),h.scale!==void 0&&nt.scale.fromArray(h.scale);return a.associations.has(nt)||a.associations.set(nt,{}),a.associations.get(nt).nodes=e,nt})}loadScene(e){const i=this.json,s=this.extensions,a=this.json.scenes[e],h=this,g=new d.ZAu;a.name&&(g.name=h.createUniqueName(a.name)),Kp(g,a),a.extensions&&as(s,g,a);const $=a.nodes||[],nt=[];for(let rt=0,st=$.length;rt<st;rt++)nt.push(Uo($[rt],g,i,h));return Promise.all(nt).then(function(){return h.associations=(rt=>{const st=new Map;for(const[ut,mt]of h.associations)(ut instanceof d.F5T||ut instanceof d.xEZ)&&st.set(ut,mt);return rt.traverse(ut=>{const mt=h.associations.get(ut);mt!=null&&st.set(ut,mt)}),st})(g),g})}}function Uo(c,e,i,s){const a=i.nodes[c];return s.getDependency("node",c).then(function(h){if(a.skin===void 0)return h;let g;return s.getDependency("skin",a.skin).then(function($){g=$;const nt=[];for(let rt=0,st=g.joints.length;rt<st;rt++)nt.push(s.getDependency("node",g.joints[rt]));return Promise.all(nt)}).then(function($){return h.traverse(function(nt){if(!nt.isMesh)return;const rt=[],st=[];for(let ut=0,mt=$.length;ut<mt;ut++){const gt=$[ut];if(gt){rt.push(gt);const yt=new d.yGw;g.inverseBindMatrices!==void 0&&yt.fromArray(g.inverseBindMatrices.array,16*ut),st.push(yt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',g.joints[ut])}nt.bind(new d.OdW(rt,st),nt.matrixWorld)}),h})}).then(function(h){e.add(h);const g=[];if(a.children){const $=a.children;for(let nt=0,rt=$.length;nt<rt;nt++){const st=$[nt];g.push(Uo(st,h,i,s))}}return Promise.all(g)})}function wp(c,e,i){const s=e.attributes,a=[];function h(g,$){return i.getDependency("accessor",g).then(function(nt){c.setAttribute($,nt)})}for(const g in s){const $=M0[g]||g.toLowerCase();$ in c.attributes||a.push(h(s[g],$))}if(e.indices!==void 0&&!c.index){const g=i.getDependency("accessor",e.indices).then(function($){c.setIndex($)});a.push(g)}return Kp(c,e),function(g,$,nt){const rt=$.attributes,st=new d.ZzF;if(rt.POSITION===void 0)return;{const gt=nt.json.accessors[rt.POSITION],yt=gt.min,wt=gt.max;if(yt===void 0||wt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(st.set(new d.Pa4(yt[0],yt[1],yt[2]),new d.Pa4(wt[0],wt[1],wt[2])),gt.normalized){const It=Lw(Ku[gt.componentType]);st.min.multiplyScalar(It),st.max.multiplyScalar(It)}}const ut=$.targets;if(ut!==void 0){const gt=new d.Pa4,yt=new d.Pa4;for(let wt=0,It=ut.length;wt<It;wt++){const Et=ut[wt];if(Et.POSITION!==void 0){const Ct=nt.json.accessors[Et.POSITION],xt=Ct.min,Bt=Ct.max;if(xt!==void 0&&Bt!==void 0){if(yt.setX(Math.max(Math.abs(xt[0]),Math.abs(Bt[0]))),yt.setY(Math.max(Math.abs(xt[1]),Math.abs(Bt[1]))),yt.setZ(Math.max(Math.abs(xt[2]),Math.abs(Bt[2]))),Ct.normalized){const Lt=Lw(Ku[Ct.componentType]);yt.multiplyScalar(Lt)}gt.max(yt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}st.expandByVector(gt)}g.boundingBox=st;const mt=new d.aLr;st.getCenter(mt.center),mt.radius=st.min.distanceTo(st.max)/2,g.boundingSphere=mt}(c,e,i),Promise.all(a).then(function(){return e.targets!==void 0?function(g,$,nt){let rt=!1,st=!1,ut=!1;for(let wt=0,It=$.length;wt<It;wt++){const Et=$[wt];if(Et.POSITION!==void 0&&(rt=!0),Et.NORMAL!==void 0&&(st=!0),Et.COLOR_0!==void 0&&(ut=!0),rt&&st&&ut)break}if(!rt&&!st&&!ut)return Promise.resolve(g);const mt=[],gt=[],yt=[];for(let wt=0,It=$.length;wt<It;wt++){const Et=$[wt];if(rt){const Ct=Et.POSITION!==void 0?nt.getDependency("accessor",Et.POSITION):g.attributes.position;mt.push(Ct)}if(st){const Ct=Et.NORMAL!==void 0?nt.getDependency("accessor",Et.NORMAL):g.attributes.normal;gt.push(Ct)}if(ut){const Ct=Et.COLOR_0!==void 0?nt.getDependency("accessor",Et.COLOR_0):g.attributes.color;yt.push(Ct)}}return Promise.all([Promise.all(mt),Promise.all(gt),Promise.all(yt)]).then(function(wt){const It=wt[0],Et=wt[1],Ct=wt[2];return rt&&(g.morphAttributes.position=It),st&&(g.morphAttributes.normal=Et),ut&&(g.morphAttributes.color=Ct),g.morphTargetsRelative=!0,g})}(c,e.targets,i):c})}function I0(c,e){let i=c.getIndex();if(i===null){const g=[],$=c.getAttribute("position");if($===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c;for(let nt=0;nt<$.count;nt++)g.push(nt);c.setIndex(g),i=c.getIndex()}const s=i.count-2,a=[];if(e===d.z$h)for(let g=1;g<=s;g++)a.push(i.getX(0)),a.push(i.getX(g)),a.push(i.getX(g+1));else for(let g=0;g<s;g++)g%2==0?(a.push(i.getX(g)),a.push(i.getX(g+1)),a.push(i.getX(g+2))):(a.push(i.getX(g+2)),a.push(i.getX(g+1)),a.push(i.getX(g)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=c.clone();return h.setIndex(a),h}class b1 extends dv{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,i){const s=await super.loadAsync(e,i),a=s?s.scene||s.scenes&&s.scenes.length>0&&s.scenes[0]:void 0;return a&&s.animations.length>0&&(a.animations=s.animations),a.traverse(h=>{h.userData.gltfUUID&&(h.uuid=h.userData.gltfUUID,delete h.userData.gltfUUID)}),a}register(e){return super.register(e)}}class L_ extends d.hH6{constructor(e){super(e),this.type=d.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),a=new d.IEO(s.data,s.width,s.height,d.wk1,this.type);return a.needsUpdate=!0,a.flipY=!0,a.encoding=d.rnI,a.minFilter=d.wem,a.magFilter=d.wem,a.source.data.complete=!0,a}async parseAsync(e,i,s=!1){if(!e.startsWith("data:")){this.responseType="blob";const $=await super.loadAsync(e,i);e=(e=await gu($)).replace("application/octet-stream","image/png")}const a=await vm(e);let h=Uint8Array;return this.type===d.cLu?h=Uint16Array:this.type===d.VzW&&(h=Uint32Array),{data:function($,nt=3,rt=Uint16Array,st=!1){let ut;const mt=$.byteLength>>2,gt=new rt(mt*nt);for(let yt=0;yt<mt;yt++)ut=Math.pow(2,$[4*yt+3]-136),st?(gt[yt*nt]=Math.min($[4*yt]*ut,65504),gt[yt*nt+1]=Math.min($[4*yt+1]*ut,65504),gt[yt*nt+2]=Math.min($[4*yt+2]*ut,65504)):(gt[yt*nt]=d.A5E.toHalfFloat(Math.min($[4*yt]*ut,65504)),gt[yt*nt+1]=d.A5E.toHalfFloat(Math.min($[4*yt+1]*ut,65504)),gt[yt*nt+2]=d.A5E.toHalfFloat(Math.min($[4*yt+2]*ut,65504))),nt===4&&(gt[yt*nt+3]=d.A5E.toHalfFloat(1));return gt}(a.data,4,h,s),width:a.width,height:a.height}}setDataType(e){return this.type=e,this}}class MA extends d.Gql{constructor(e){super(e),this._imageLoader=new d.S3k(e)}parseTextures2(e,i,s){var a;for(const h of e){const g=(a=h==null?void 0:h.userData)===null||a===void 0?void 0:a.rootPath;if(g&&(!h.image||!i[h.image])){const $=new d.Hw6(this._imageLoader.load(g,s));if(!$)continue;h.image&&($.uuid=h.image),i[$.uuid]=$,h.image=$.uuid}h.userData=br(h.userData,void 0,!1,{images:i})}return super.parseTextures(e,i)}parseMaterials2(e,i,s){const a={};return e.forEach(h=>{if(!h)return;const g={...h},$=Object.keys(g);for(const rt of $)if(rt==="map"||rt.endsWith("Map")){const st=g[rt];typeof st=="string"&&(i[st]?g[rt]=i[st]:(console.warn(`Texture ${st} not found`),delete g[rt]))}g.userData&&(g.userData=br(g.userData,void 0,!1,{textures:i}));const nt=s.generateFromTemplateType(g.type,g);nt&&(a[h.uuid]=nt)}),a}}const $p="WEBGI_viewer";function ku(c){oo.Importers.push(new Ul(b1,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,a=new MA(i.loadingManager);return s.register(mv(a,c)),s.register(N_()),s.register(F_(a)),s.register(h=>new Xv(h)),s.register(h=>new xp(h)),s.register(h=>new P0(h)),s.register(h=>new IA(h)),s.register(h=>{var g,$,nt,rt,st,ut,mt,gt,yt;const wt=Ao()+".drc",It=Ao()+".ktx2",Et=(nt=($=(g=h.json)===null||g===void 0?void 0:g.extensionsRequired)===null||$===void 0?void 0:$.includes)===null||nt===void 0?void 0:nt.call($,"KHR_draco_mesh_compression");if(Et){const xt=i.registerFile(wt);xt&&s.setDRACOLoader(xt)}!((ut=(st=(rt=h.json)===null||rt===void 0?void 0:rt.extensionsUsed)===null||st===void 0?void 0:st.includes)===null||ut===void 0)&&ut.call(st,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),h.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const Ct=(yt=(gt=(mt=h.json)===null||mt===void 0?void 0:mt.extensionsUsed)===null||gt===void 0?void 0:gt.includes)===null||yt===void 0?void 0:yt.call(gt,"KHR_texture_basisu");if(Ct){const xt=i.registerFile(It);xt&&(s.setKTX2Loader(xt),h.options.ktx2Loader=xt)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async xt=>{Et&&i.unregisterFile(wt),Ct&&i.unregisterFile(It);const Bt=await TA(h,c,a);xt.scene.__importedViewerConfig=Bt}}}),s}))}const xn="WEBGI_light_extras",fv="WEBGI_object3d_extras",Jp="WEBGI_material_extras",N_=c=>e=>({name:"__"+fv,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,g;if(!a.isObject3D)return;const $=(g=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||g===void 0?void 0:g[fv];if(!$)return void(a.isLight&&!a.isAmbientLight&&(a.castShadow=!0));const nt=$.castShadow!==void 0||$.receiveShadow!==void 0;$.castShadow!==void 0&&(a.castShadow=$.castShadow),$.receiveShadow!==void 0&&(a.receiveShadow=$.receiveShadow),$.visible!==void 0&&(a.visible=$.visible),$.frustumCulled!==void 0&&(a.frustumCulled=$.frustumCulled),$.renderOrder!==void 0&&(a.renderOrder=$.renderOrder),$.layers!==void 0&&(a.layers.mask=$.layers),nt&&(a.userData.__keepShadowDef=!0),delete a.userData.gltfExtensions[fv]})})}}),mv=(c,e)=>i=>({name:"__"+Jp,afterRoot:async s=>{var a,h,g;const $=s.scenes||(s.scene?[s.scene]:[]);for(const nt of $){const rt=(h=(a=nt.userData)===null||a===void 0?void 0:a.gltfExtensions)===null||h===void 0?void 0:h[Jp],st=rt&&await((g=e.getPlugin(Jr))===null||g===void 0?void 0:g.importConfigResources(rt.resources||{}))||{};nt.traverse(ut=>{var mt,gt;const yt=ut==null?void 0:ut.material;if(!(yt!=null&&yt.isMaterial))return;const wt=(gt=(mt=yt.userData)===null||mt===void 0?void 0:mt.gltfExtensions)===null||gt===void 0?void 0:gt[Jp];wt&&(wt.emissiveIntensity!==void 0&&(yt.emissiveIntensity=wt.emissiveIntensity),wt.fog!==void 0&&(yt.fog=wt.fog),wt.flatShading!==void 0&&(yt.flatShading=wt.flatShading),wt.blending!==void 0&&(yt.blending=wt.blending),wt.side!==void 0&&(yt.side=wt.side),wt.shadowSide!==void 0&&(yt.shadowSide=wt.shadowSide),wt.depthFunc!==void 0&&(yt.depthFunc=wt.depthFunc),wt.depthTest!==void 0&&(yt.depthTest=wt.depthTest),wt.depthWrite!==void 0&&(yt.depthWrite=wt.depthWrite),wt.colorWrite!==void 0&&(yt.colorWrite=wt.colorWrite),wt.wireframe!==void 0&&(yt.wireframe=wt.wireframe),wt.wireframeLinewidth!==void 0&&(yt.wireframeLinewidth=wt.wireframeLinewidth),wt.wireframeLinecap!==void 0&&(yt.wireframeLinecap=wt.wireframeLinecap),wt.wireframeLinejoin!==void 0&&(yt.wireframeLinejoin=wt.wireframeLinejoin),wt.rotation!==void 0&&(yt.rotation=wt.rotation),wt.polygonOffset!==void 0&&(yt.polygonOffset=wt.polygonOffset),wt.polygonOffsetFactor!==void 0&&(yt.polygonOffsetFactor=wt.polygonOffsetFactor),wt.polygonOffsetUnits!==void 0&&(yt.polygonOffsetUnits=wt.polygonOffsetUnits),wt.dithering!==void 0&&(yt.dithering=wt.dithering),wt.alphaToCoverage!==void 0&&(yt.alphaToCoverage=wt.alphaToCoverage),wt.premultipliedAlpha!==void 0&&(yt.premultipliedAlpha=wt.premultipliedAlpha),wt.toneMapped!==void 0&&(yt.toneMapped=wt.toneMapped),wt.reflectivity!==void 0&&(yt.reflectivity=wt.reflectivity),Object.entries(wt).forEach(([It,Et])=>{It.startsWith("_")||Et&&Et.resource&&typeof Et.resource=="string"&&(yt[It]=br(Et,yt[It],!1,st))}),delete yt.userData.gltfExtensions[Jp])}),rt&&delete nt.userData.gltfExtensions[Jp]}}}),F_=c=>e=>({name:"__"+xn,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,g;if(!a.isLight)return;const $=(g=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||g===void 0?void 0:g[xn];$&&(!a.shadow&&$.shadow&&console.error("Light has no shadow, cannot import",a,$),$.shadow&&a.shadow&&($.shadow.bias!==void 0&&(a.shadow.bias=$.shadow.bias),$.shadow.normalBias!==void 0&&(a.shadow.normalBias=$.shadow.normalBias),$.shadow.radius!==void 0&&(a.shadow.radius=$.shadow.radius),$.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray($.shadow.mapSize),$.shadow.camera!==void 0&&(a.shadow.camera=c.parseObject($.shadow.camera))),delete a.userData.gltfExtensions[xn])})})}});async function TA(c,e,i,s){var a;if(!s){const nt=c.json.scenes||[];if(nt.length!==1){for(const rt of nt)await TA(c,e,rt);return}s=nt[0]}const h=(a=s.extensions)===null||a===void 0?void 0:a[$p];if(!h)return;const g=[];Object.values(h.resources).forEach(nt=>{Object.values(nt).forEach(rt=>{rt.url&&(rt.url.type==="Uint16Array"&&rt.url.data&&g.push(rt.url),rt.url.type==="Uint8Array"&&rt.url.data&&g.push(rt.url))})});for(const nt of g){const rt=nt.data.image,st=c.json.images[rt],ut=await c.getDependency("bufferView",st.bufferView);if(st.mimeType.startsWith("image/")&&nt.type==="Uint16Array"&&nt.encoding==="rgbe"){const mt=new Blob([ut],{type:st.mimeType}),gt="data:image/png;base64,"+btoa(await mt.text());nt.data=(await new L_().parseAsync(gt,void 0,!0)).data,delete nt.encoding}else nt.data=ut}const $={textures:{}};if(h.resources.textures&&c.json.textures)for(const[nt,rt]of Object.entries(h.resources.textures)){if(rt.uuid||!nt)continue;delete h.resources.textures[nt];const st=c.json.textures.findIndex(ut=>{var mt,gt,yt,wt,It,Et,Ct;return((mt=ut.extras)===null||mt===void 0?void 0:mt.uuid)===nt||((wt=(yt=(gt=c.json.samplers)===null||gt===void 0?void 0:gt[ut.sampler])===null||yt===void 0?void 0:yt.extras)===null||wt===void 0?void 0:wt.uuid)===nt||((Ct=(Et=(It=c.json.images)===null||It===void 0?void 0:It[ut.source])===null||Et===void 0?void 0:Et.extras)===null||Ct===void 0?void 0:Ct.t_uuid)===nt});st>=0&&($.textures[nt]=await c.getDependency("texture",st))}if(h.resources.materials&&c.json.materials)for(const[nt,rt]of Object.entries(h.resources.materials)){if(rt.uuid||!nt)continue;delete h.resources.materials[nt];const st=c.json.materials.findIndex(ut=>{var mt;return((mt=ut.extras)===null||mt===void 0?void 0:mt.uuid)===nt});st>=0&&($.materials[nt]=await c.getDependency("material",st))}return h.resources=await e.getPlugin(Jr).importConfigResources(h.resources||{},i,$),h}const ym="WEBGI_materials_bumpmap",Yv="WEBGI_materials_displacementmap",gv="WEBGI_materials_alphamap",Am="WEBGI_materials_lightmap";class Xv{constructor(e){this.parser=e,this.name=ym}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];return g.bumpScale!==void 0&&(i.bumpScale=g.bumpScale),g.bumpTexture!==void 0&&h.push(s.assignTexture(i,"bumpMap",g.bumpTexture)),Promise.all(h)}}class xp{constructor(e){this.parser=e,this.name=Yv}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];return g.displacementScale!==void 0&&(i.displacementScale=g.displacementScale),g.displacementBias!==void 0&&(i.displacementBias=g.displacementBias),g.displacementTexture!==void 0&&h.push(s.assignTexture(i,"displacementMap",g.displacementTexture)),Promise.all(h)}}class P0{constructor(e){this.parser=e,this.name=Am}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];return g.lightMapIntensity!==void 0&&(i.lightMapIntensity=g.lightMapIntensity),g.lightMapTexture!==void 0&&h.push(s.assignTexture(i,"lightMap",g.lightMapTexture)),Promise.all(h)}}class IA{constructor(e){this.parser=e,this.name=gv}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],g=a.extensions[this.name];return g.alphaTexture!==void 0&&h.push(s.assignTexture(i,"alphaMap",g.alphaTexture)),Promise.all(h)}}var U_=__webpackgi_require__(23);function Kv(){oo.Importers.push(new Ul(U_.Q,["drc"],!0))}var PA={},xo=Uint8Array,Tl=Uint16Array,Zp=Uint32Array,kp=new xo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_f=new xo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fu=new xo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DA=function(c,e){for(var i=new Tl(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Zp(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},D0=DA(kp,2),zm=D0[0],R0=D0[1];zm[28]=258,R0[258]=28;for(var Dy=DA(_f,0),RA=Dy[0],$v=Dy[1],zs=new Tl(32768),Ko=0;Ko<32768;++Ko){var wu=(43690&Ko)>>>1|(21845&Ko)<<1;wu=(61680&(wu=(52428&wu)>>>2|(13107&wu)<<2))>>>4|(3855&wu)<<4,zs[Ko]=((65280&wu)>>>8|(255&wu)<<8)>>>1}var em=function(c,e,i){for(var s=c.length,a=0,h=new Tl(e);a<s;++a)++h[c[a]-1];var g,$=new Tl(e);for(a=0;a<e;++a)$[a]=$[a-1]+h[a-1]<<1;if(i){g=new Tl(1<<e);var nt=15-e;for(a=0;a<s;++a)if(c[a])for(var rt=a<<4|c[a],st=e-c[a],ut=$[c[a]-1]++<<st,mt=ut|(1<<st)-1;ut<=mt;++ut)g[zs[ut]>>>nt]=rt}else for(g=new Tl(s),a=0;a<s;++a)c[a]&&(g[a]=zs[$[c[a]-1]++]>>>15-c[a]);return g},vv=new xo(288);for(Ko=0;Ko<144;++Ko)vv[Ko]=8;for(Ko=144;Ko<256;++Ko)vv[Ko]=9;for(Ko=256;Ko<280;++Ko)vv[Ko]=7;for(Ko=280;Ko<288;++Ko)vv[Ko]=8;var xu=new xo(32);for(Ko=0;Ko<32;++Ko)xu[Ko]=5;var k0=em(vv,9,0),bp=em(vv,9,1),Nw=em(xu,5,0),Ry=em(xu,5,1),wm=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},op=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},_v=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},j_=function(c){return(c/8|0)+(7&c&&1)},Bu=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof Tl?Tl:c instanceof Zp?Zp:xo)(i-e);return s.set(c.subarray(e,i)),s},Bp=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new xo(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new xo(3*s));var g=function(ps){var yr=e.length;if(ps>yr){var Ws=new xo(Math.max(2*yr,ps));Ws.set(e),e=Ws}},$=i.f||0,nt=i.p||0,rt=i.b||0,st=i.l,ut=i.d,mt=i.m,gt=i.n,yt=8*s;do{if(!st){i.f=$=op(c,nt,1);var wt=op(c,nt+1,3);if(nt+=3,!wt){var It=c[(Cn=j_(nt)+4)-4]|c[Cn-3]<<8,Et=Cn+It;if(Et>s){if(h)throw"unexpected EOF";break}a&&g(rt+It),e.set(c.subarray(Cn,Et),rt),i.b=rt+=It,i.p=nt=8*Et;continue}if(wt==1)st=bp,ut=Ry,mt=9,gt=5;else{if(wt!=2)throw"invalid block type";var Ct=op(c,nt,31)+257,xt=op(c,nt+10,15)+4,Bt=Ct+op(c,nt+5,31)+1;nt+=14;for(var Lt=new xo(Bt),Gt=new xo(19),Xt=0;Xt<xt;++Xt)Gt[fu[Xt]]=op(c,nt+3*Xt,7);nt+=3*xt;var rn=wm(Gt),fn=(1<<rn)-1,wn=em(Gt,rn,1);for(Xt=0;Xt<Bt;){var Cn,bn=wn[op(c,nt,fn)];if(nt+=15&bn,(Cn=bn>>>4)<16)Lt[Xt++]=Cn;else{var Dn=0,En=0;for(Cn==16?(En=3+op(c,nt,3),nt+=2,Dn=Lt[Xt-1]):Cn==17?(En=3+op(c,nt,7),nt+=3):Cn==18&&(En=11+op(c,nt,127),nt+=7);En--;)Lt[Xt++]=Dn}}var Tn=Lt.subarray(0,Ct),Un=Lt.subarray(Ct);mt=wm(Tn),gt=wm(Un),st=em(Tn,mt,1),ut=em(Un,gt,1)}if(nt>yt){if(h)throw"unexpected EOF";break}}a&&g(rt+131072);for(var Pn=(1<<mt)-1,Yn=(1<<gt)-1,cr=nt;;cr=nt){var mr=(Dn=st[_v(c,nt)&Pn])>>>4;if((nt+=15&Dn)>yt){if(h)throw"unexpected EOF";break}if(!Dn)throw"invalid length/literal";if(mr<256)e[rt++]=mr;else{if(mr==256){cr=nt,st=null;break}var ir=mr-254;if(mr>264){var Dr=kp[Xt=mr-257];ir=op(c,nt,(1<<Dr)-1)+zm[Xt],nt+=Dr}var Nr=ut[_v(c,nt)&Yn],Fr=Nr>>>4;if(!Nr)throw"invalid distance";if(nt+=15&Nr,Un=RA[Fr],Fr>3&&(Dr=_f[Fr],Un+=_v(c,nt)&(1<<Dr)-1,nt+=Dr),nt>yt){if(h)throw"unexpected EOF";break}a&&g(rt+131072);for(var Vr=rt+ir;rt<Vr;rt+=4)e[rt]=e[rt-Un],e[rt+1]=e[rt+1-Un],e[rt+2]=e[rt+2-Un],e[rt+3]=e[rt+3-Un];rt=Vr}}i.l=st,i.p=cr,i.b=rt,st&&($=1,i.m=mt,i.d=ut,i.n=gt)}while(!$);return rt==e.length?e:Bu(e,0,rt)},$u=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},Vm=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},kA=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[Zs,0];if(a==1){var g=new xo(i[0].s+1);return g[i[0].s]=1,[g,1]}i.sort(function(Lt,Gt){return Lt.f-Gt.f}),i.push({s:-1,f:25001});var $=i[0],nt=i[1],rt=0,st=1,ut=2;for(i[0]={s:-1,f:$.f+nt.f,l:$,r:nt};st!=a-1;)$=i[i[rt].f<i[ut].f?rt++:ut++],nt=i[rt!=st&&i[rt].f<i[ut].f?rt++:ut++],i[st++]={s:-1,f:$.f+nt.f,l:$,r:nt};var mt=h[0].s;for(s=1;s<a;++s)h[s].s>mt&&(mt=h[s].s);var gt=new Tl(mt+1),yt=Jv(i[st-1],gt,0);if(yt>e){s=0;var wt=0,It=yt-e,Et=1<<It;for(h.sort(function(Lt,Gt){return gt[Gt.s]-gt[Lt.s]||Lt.f-Gt.f});s<a;++s){var Ct=h[s].s;if(!(gt[Ct]>e))break;wt+=Et-(1<<yt-gt[Ct]),gt[Ct]=e}for(wt>>>=It;wt>0;){var xt=h[s].s;gt[xt]<e?wt-=1<<e-gt[xt]++-1:++s}for(;s>=0&&wt;--s){var Bt=h[s].s;gt[Bt]==e&&(--gt[Bt],++wt)}yt=e}return[new xo(gt),yt]},Jv=function(c,e,i){return c.s==-1?Math.max(Jv(c.l,e,i+1),Jv(c.r,e,i+1)):e[c.s]=i},ky=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new Tl(++e),s=0,a=c[0],h=1,g=function(nt){i[s++]=nt},$=1;$<=e;++$)if(c[$]==a&&$!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)g(32754);h>2&&(g(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(g(a),--h;h>6;h-=6)g(8304);h>2&&(g(h-3<<5|8208),h=0)}for(;h--;)g(a);h=1,a=c[$]}return[i.subarray(0,s),e]},z_=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Zv=function(c,e,i){var s=i.length,a=j_(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},BA=function(c,e,i,s,a,h,g,$,nt,rt,st){$u(e,st++,i),++a[256];for(var ut=kA(a,15),mt=ut[0],gt=ut[1],yt=kA(h,15),wt=yt[0],It=yt[1],Et=ky(mt),Ct=Et[0],xt=Et[1],Bt=ky(wt),Lt=Bt[0],Gt=Bt[1],Xt=new Tl(19),rn=0;rn<Ct.length;++rn)Xt[31&Ct[rn]]++;for(rn=0;rn<Lt.length;++rn)Xt[31&Lt[rn]]++;for(var fn=kA(Xt,7),wn=fn[0],Cn=fn[1],bn=19;bn>4&&!wn[fu[bn-1]];--bn);var Dn,En,Tn,Un,Pn=rt+5<<3,Yn=z_(a,vv)+z_(h,xu)+g,cr=z_(a,mt)+z_(h,wt)+g+14+3*bn+z_(Xt,wn)+(2*Xt[16]+3*Xt[17]+7*Xt[18]);if(Pn<=Yn&&Pn<=cr)return Zv(e,st,c.subarray(nt,nt+rt));if($u(e,st,1+(cr<Yn)),st+=2,cr<Yn){Dn=em(mt,gt,0),En=mt,Tn=em(wt,It,0),Un=wt;var mr=em(wn,Cn,0);for($u(e,st,xt-257),$u(e,st+5,Gt-1),$u(e,st+10,bn-4),st+=14,rn=0;rn<bn;++rn)$u(e,st+3*rn,wn[fu[rn]]);st+=3*bn;for(var ir=[Ct,Lt],Dr=0;Dr<2;++Dr){var Nr=ir[Dr];for(rn=0;rn<Nr.length;++rn){var Fr=31&Nr[rn];$u(e,st,mr[Fr]),st+=wn[Fr],Fr>15&&($u(e,st,Nr[rn]>>>5&127),st+=Nr[rn]>>>12)}}}else Dn=k0,En=vv,Tn=Nw,Un=xu;for(rn=0;rn<$;++rn)if(s[rn]>255){Fr=s[rn]>>>18&31,Vm(e,st,Dn[Fr+257]),st+=En[Fr+257],Fr>7&&($u(e,st,s[rn]>>>23&31),st+=kp[Fr]);var Vr=31&s[rn];Vm(e,st,Tn[Vr]),st+=Un[Vr],Vr>3&&(Vm(e,st,s[rn]>>>5&8191),st+=_f[Vr])}else Vm(e,st,Dn[s[rn]]),st+=En[s[rn]];return Vm(e,st,Dn[256]),st+En[256]},Fw=new Zp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Zs=new xo(0),tm=function(c,e,i,s,a,h){var g=c.length,$=new xo(s+g+5*(1+Math.ceil(g/7e3))+a),nt=$.subarray(s,$.length-a),rt=0;if(!e||g<8)for(var st=0;st<=g;st+=65535){var ut=st+65535;ut<g?rt=Zv(nt,rt,c.subarray(st,ut)):(nt[st]=h,rt=Zv(nt,rt,c.subarray(st,g)))}else{for(var mt=Fw[e-1],gt=mt>>>13,yt=8191&mt,wt=(1<<i)-1,It=new Tl(32768),Et=new Tl(wt+1),Ct=Math.ceil(i/3),xt=2*Ct,Bt=function(xa){return(c[xa]^c[xa+1]<<Ct^c[xa+2]<<xt)&wt},Lt=new Zp(25e3),Gt=new Tl(288),Xt=new Tl(32),rn=0,fn=0,wn=(st=0,0),Cn=0,bn=0;st<g;++st){var Dn=Bt(st),En=32767&st,Tn=Et[Dn];if(It[En]=Tn,Et[Dn]=En,Cn<=st){var Un=g-st;if((rn>7e3||wn>24576)&&Un>423){rt=BA(c,nt,0,Lt,Gt,Xt,fn,wn,bn,st-bn,rt),wn=rn=fn=0,bn=st;for(var Pn=0;Pn<286;++Pn)Gt[Pn]=0;for(Pn=0;Pn<30;++Pn)Xt[Pn]=0}var Yn=2,cr=0,mr=yt,ir=En-Tn&32767;if(Un>2&&Dn==Bt(st-ir))for(var Dr=Math.min(gt,Un)-1,Nr=Math.min(32767,st),Fr=Math.min(258,Un);ir<=Nr&&--mr&&En!=Tn;){if(c[st+Yn]==c[st+Yn-ir]){for(var Vr=0;Vr<Fr&&c[st+Vr]==c[st+Vr-ir];++Vr);if(Vr>Yn){if(Yn=Vr,cr=ir,Vr>Dr)break;var ps=Math.min(ir,Vr-2),yr=0;for(Pn=0;Pn<ps;++Pn){var Ws=st-ir+Pn+32768&32767,lo=Ws-It[Ws]+32768&32767;lo>yr&&(yr=lo,Tn=Ws)}}}ir+=(En=Tn)-(Tn=It[En])+32768&32767}if(cr){Lt[wn++]=268435456|R0[Yn]<<18|$v[cr];var qs=31&R0[Yn],Bo=31&$v[cr];fn+=kp[qs]+_f[Bo],++Gt[257+qs],++Xt[Bo],Cn=st+Yn,++rn}else Lt[wn++]=c[st],++Gt[c[st]]}}rt=BA(c,nt,h,Lt,Gt,Xt,fn,wn,bn,st-bn,rt),!h&&7&rt&&(rt=Zv(nt,rt+1,Zs))}return Bu($,0,s+j_(rt)+a)},Qm=function(){for(var c=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;c[e]=i}return c}(),ap=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=Qm[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},xm=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,g=0;g!=h;){for(var $=Math.min(g+2655,h);g<$;++g)a+=s+=i[g];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},nm=function(c,e,i,s,a){return tm(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},rm=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},OA=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<s.length;++g){var $=s[g],nt=h[g];if(typeof $=="function"){e+=";"+nt+"=";var rt=$.toString();if($.prototype)if(rt.indexOf("[native code]")!=-1){var st=rt.indexOf(" ",8)+1;e+=rt.slice(st,rt.indexOf("(",st))}else for(var ut in e+=rt,$.prototype)e+=";"+nt+".prototype."+ut+"="+$.prototype[ut].toString();else e+=rt}else i[nt]=$}return[e,i]},B0=[],LA=function(c,e,i,s){var a;if(!B0[i]){for(var h="",g={},$=c.length-1,nt=0;nt<$;++nt)h=(a=OA(c[nt],h,g))[0],g=a[1];B0[i]=OA(c[$],h,g)}var rt=rm({},B0[i][1]);return function(st,ut,mt,gt,yt){var wt=new Worker(PA[ut]||(PA[ut]=URL.createObjectURL(new Blob([st],{type:"text/javascript"}))));return wt.onerror=function(It){return yt(It.error,null)},wt.onmessage=function(It){return yt(null,It.data)},wt.postMessage(mt,gt),wt}(B0[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,rt,function(st){var ut=[];for(var mt in st)(st[mt]instanceof xo||st[mt]instanceof Tl||st[mt]instanceof Zp)&&ut.push((st[mt]=new st[mt].constructor(st[mt])).buffer);return ut}(rt),s)},e_=function(){return[xo,Tl,Zp,kp,_f,fu,zm,RA,bp,Ry,zs,em,wm,op,_v,j_,Bu,Bp,Ju,im,ga]},Ou=function(){return[xo,Tl,Zp,kp,_f,fu,R0,$v,k0,vv,Nw,xu,zs,Fw,Zs,em,$u,Vm,kA,Jv,ky,z_,Zv,BA,j_,Bu,tm,nm,ms,im]},E1=function(){return[at,tn,bt,ap,Qm]},Lu=function(){return[ft,Dt]},Gm=function(){return[Sn,bt,xm]},Zl=function(){return[Bn]},im=function(c){return postMessage(c,[c.buffer])},ga=function(c){return c&&c.size&&new xo(c.size)},O0=function(c,e,i,s,a,h){var g=LA(i,s,a,function($,nt){g.terminate(),h($,nt)});return g.postMessage([c,e],e.consume?[c.buffer]:[]),function(){g.terminate()}},sm=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},L0=function(c,e,i,s,a){var h,g=LA(c,s,a,function($,nt){$?(g.terminate(),e.ondata.call(e,$)):(nt[1]&&g.terminate(),e.ondata.call(e,$,nt[0],nt[1]))});g.postMessage(i),e.push=function($,nt){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";g.postMessage([$,h=nt],[$.buffer])},e.terminate=function(){g.terminate()}},lp=function(c,e){return c[e]|c[e+1]<<8},Vl=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},Uw=function(c,e){return Vl(c,e)+4294967296*Vl(c,e+4)},bt=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},at=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&bt(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},ft=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},Dt=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},tn=function(c){return 10+(c.filename&&c.filename.length+1||0)},Sn=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},Bn=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function pr(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Or=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(nm(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),As=function(){return function(c,e){L0([Ou,function(){return[sm,Or]}],this,pr.call(this,c,e),function(i){var s=new Or(i.data);onmessage=sm(s)},6)}}();function Ds(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return O0(c,e,[Ou],function(s){return im(ms(s.data[0],s.data[1]))},0,i)}function ms(c,e){return nm(c,e||{},0,0)}var Il=function(){function c(e){this.s={},this.p=new xo(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new xo(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=Bp(this.p,this.o,this.s);this.ondata(Bu(s,i,this.s.b),this.d),this.o=Bu(s,this.s.b-32768),this.s.b=this.o.length,this.p=Bu(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),ru=function(){return function(c){this.ondata=c,L0([e_,function(){return[sm,Il]}],this,0,function(){var e=new Il;onmessage=sm(e)},7)}}();function om(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return O0(c,e,[e_],function(s){return im(Ju(s.data[0],ga(s.data[1])))},1,i)}function Ju(c,e){return Bp(c,e)}var Op=function(){function c(e,i){this.c=ap(),this.l=0,this.v=1,Or.call(this,e,i)}return c.prototype.push=function(e,i){Or.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=nm(e,this.o,this.v&&tn(this.o),i&&8,!i);this.v&&(at(s,this.o),this.v=0),i&&(bt(s,s.length-8,this.c.d()),bt(s,s.length-4,this.l)),this.ondata(s,i)},c}(),bm=function(){return function(c,e){L0([Ou,E1,function(){return[sm,Or,Op]}],this,pr.call(this,c,e),function(i){var s=new Op(i.data);onmessage=sm(s)},8)}}();function V_(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return O0(c,e,[Ou,E1,function(){return[t_]}],function(s){return im(t_(s.data[0],s.data[1]))},2,i)}function t_(c,e){e||(e={});var i=ap(),s=c.length;i.p(c);var a=nm(c,e,tn(e),8),h=a.length;return at(a,e),bt(a,h-8,i.d()),bt(a,h-4,s),a}var N0=function(){function c(e){this.v=1,Il.call(this,e)}return c.prototype.push=function(e,i){if(Il.prototype.e.call(this,e),this.v){var s=this.p.length>3?ft(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Il.prototype.c.call(this,i)},c}(),By=function(){return function(c){this.ondata=c,L0([e_,Lu,function(){return[sm,Il,N0]}],this,0,function(){var e=new N0;onmessage=sm(e)},9)}}();function Oy(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return O0(c,e,[e_,Lu,function(){return[Ly]}],function(s){return im(Ly(s.data[0]))},3,i)}function Ly(c,e){return Bp(c.subarray(ft(c),-8),e||new xo(Dt(c)))}var NA=function(){function c(e,i){this.c=xm(),this.v=1,Or.call(this,e,i)}return c.prototype.push=function(e,i){Or.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=nm(e,this.o,this.v&&2,i&&4,!i);this.v&&(Sn(s,this.o),this.v=0),i&&bt(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),S1=function(){return function(c,e){L0([Ou,Gm,function(){return[sm,Or,NA]}],this,pr.call(this,c,e),function(i){var s=new NA(i.data);onmessage=sm(s)},10)}}();function C1(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return O0(c,e,[Ou,Gm,function(){return[jw]}],function(s){return im(jw(s.data[0],s.data[1]))},4,i)}function jw(c,e){e||(e={});var i=xm();i.p(c);var s=nm(c,e,2,4);return Sn(s,e),bt(s,s.length-4,i.d()),s}var Ny=function(){function c(e){this.v=1,Il.call(this,e)}return c.prototype.push=function(e,i){if(Il.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Il.prototype.c.call(this,i)},c}(),Nu=function(){return function(c){this.ondata=c,L0([e_,Zl,function(){return[sm,Il,Ny]}],this,0,function(){var e=new Ny;onmessage=sm(e)},11)}}();function zw(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return O0(c,e,[e_,Zl,function(){return[Hm]}],function(s){return im(Hm(s.data[0],ga(s.data[1])))},5,i)}function Hm(c,e){return Bp((Bn(c),c.subarray(2,-4)),e)}var F0=function(){function c(e){this.G=N0,this.I=Il,this.Z=Ny,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new xo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Ep=function(){function c(e){this.G=By,this.I=ru,this.Z=Nu,this.ondata=e}return c.prototype.push=function(e,i){F0.prototype.push.call(this,e,i)},c}();function OM(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?Oy(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?om(c,e,i):zw(c,e,i)}function yv(c,e){return c[0]==31&&c[1]==139&&c[2]==8?Ly(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?Ju(c,e):Hm(c,e)}var FA=function(c,e,i,s){for(var a in c){var h=c[a],g=e+a;h instanceof xo?i[g]=[h,s]:Array.isArray(h)?i[g]=[h[0],rm(s,h[1])]:FA(h,g+"/",i,s)}},Zu=typeof TextEncoder<"u"&&new TextEncoder,U0=typeof TextDecoder<"u"&&new TextDecoder,RS=0;try{U0.decode(Zs,{stream:!0}),RS=1}catch{}var UA=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,Bu(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},LM=function(){function c(e){this.ondata=e,RS?this.t=new TextDecoder:this.p=Zs}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new xo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=UA(s),h=a[0],g=a[1];if(i){if(g.length)throw"invalid utf-8 data";this.p=null}else this.p=g;this.ondata(h,i)}},c}(),kS=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(j0(e),this.d=i||!1)},c}();function j0(c,e){if(e){for(var i=new xo(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(Zu)return Zu.encode(c);var a=c.length,h=new xo(c.length+(c.length>>1)),g=0,$=function(st){h[g++]=st};for(s=0;s<a;++s){if(g+5>h.length){var nt=new xo(g+8+(a-s<<1));nt.set(h),h=nt}var rt=c.charCodeAt(s);rt<128||e?$(rt):rt<2048?($(192|rt>>6),$(128|63&rt)):rt>55295&&rt<57344?($(240|(rt=65536+(1047552&rt)|1023&c.charCodeAt(++s))>>18),$(128|rt>>12&63),$(128|rt>>6&63),$(128|63&rt)):($(224|rt>>12),$(128|rt>>6&63),$(128|63&rt))}return Bu(h,0,g)}function BS(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(U0)return U0.decode(c);var a=UA(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var Q_=function(c){return c==1?3:c<6?2:c==9?1:0},Fy=function(c,e){return e+30+lp(c,e+26)+lp(c,e+28)},Vw=function(c,e,i){var s=lp(c,e+28),a=BS(c.subarray(e+46,e+46+s),!(2048&lp(c,e+8))),h=e+46+s,g=Vl(c,e+20),$=i&&g==4294967295?Qw(c,h):[g,Vl(c,e+24),Vl(c,e+42)],nt=$[0],rt=$[1],st=$[2];return[lp(c,e+10),nt,rt,a,h+lp(c,e+30)+lp(c,e+32),st]},Qw=function(c,e){for(;lp(c,e)!=1;e+=4+lp(c,e+2));return[Uw(c,e+12),Uw(c,e+4),Uw(c,e+20)]},G_=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},jA=function(c,e,i,s,a,h,g,$){var nt=s.length,rt=i.extra,st=$&&$.length,ut=G_(rt);bt(c,e,g!=null?33639248:67324752),e+=4,g!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var mt=new Date(i.mtime==null?Date.now():i.mtime),gt=mt.getFullYear()-1980;if(gt<0||gt>119)throw"date not in range 1980-2099";if(bt(c,e,gt<<25|mt.getMonth()+1<<21|mt.getDate()<<16|mt.getHours()<<11|mt.getMinutes()<<5|mt.getSeconds()>>>1),e+=4,h!=null&&(bt(c,e,i.crc),bt(c,e+4,h),bt(c,e+8,i.size)),bt(c,e+12,nt),bt(c,e+14,ut),e+=16,g!=null&&(bt(c,e,st),bt(c,e+6,i.attrs),bt(c,e+10,g),e+=14),c.set(s,e),e+=nt,ut)for(var yt in rt){var wt=rt[yt],It=wt.length;bt(c,e,+yt),bt(c,e+2,It),c.set(wt,e+4),e+=4+It}return st&&(c.set($,e),e+=st),e},z0=function(c,e,i,s,a){bt(c,e,101010256),bt(c,e+8,i),bt(c,e+10,i),bt(c,e+12,s),bt(c,e+16,a)},io=function(){function c(e){this.filename=e,this.c=ap(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),es=function(){function c(e,i){var s=this;i||(i={}),io.call(this,e),this.d=new Or(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=Q_(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){io.prototype.push.call(this,e,i)},c}(),am=function(){function c(e,i){var s=this;i||(i={}),io.call(this,e),this.d=new As(i,function(a,h,g){s.ondata(a,h,g)}),this.compression=8,this.flag=Q_(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){io.prototype.push.call(this,e,i)},c}(),aP=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=j0(e.filename),a=s.length,h=e.comment,g=h&&j0(h),$=a!=e.filename.length||g&&h.length!=g.length,nt=a+G_(e.extra)+30;if(a>65535)throw"filename too long";var rt=new xo(nt);jA(rt,0,e,s,$);var st=[rt],ut=function(){for(var It=0,Et=st;It<Et.length;It++){var Ct=Et[It];i.ondata(null,Ct,!1)}st=[]},mt=this.d;this.d=0;var gt=this.u.length,yt=rm(e,{f:s,u:$,o:g,t:function(){e.terminate&&e.terminate()},r:function(){if(ut(),mt){var It=i.u[gt+1];It?It.r():i.d=1}mt=1}}),wt=0;e.ondata=function(It,Et,Ct){if(It)i.ondata(It,Et,Ct),i.terminate();else if(wt+=Et.length,st.push(Et),Ct){var xt=new xo(16);bt(xt,0,134695760),bt(xt,4,e.crc),bt(xt,8,wt),bt(xt,12,e.size),st.push(xt),yt.c=wt,yt.b=nt+wt+16,yt.crc=e.crc,yt.size=e.size,mt&&yt.r(),mt=1}else mt&&ut()},this.u.push(yt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(rt=h[a]).f.length+G_(rt.extra)+(rt.o?rt.o.length:0);for(var g=new xo(s+22),$=0,nt=this.u;$<nt.length;$++){var rt=nt[$];jA(g,e,rt,rt.f,rt.u,rt.c,i,rt.o),e+=46+rt.f.length+G_(rt.extra)+(rt.o?rt.o.length:0),i+=rt.b}z0(g,e,this.u.length,s,i),this.ondata(null,g,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function lP(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};FA(c,"",s,e);var a=Object.keys(s),h=a.length,g=0,$=0,nt=h,rt=new Array(h),st=[],ut=function(){for(var wt=0;wt<st.length;++wt)st[wt]()},mt=function(){var wt=new xo($+22),It=g,Et=$-g;$=0;for(var Ct=0;Ct<nt;++Ct){var xt=rt[Ct];try{var Bt=xt.c.length;jA(wt,$,xt,xt.f,xt.u,Bt);var Lt=30+xt.f.length+G_(xt.extra),Gt=$+Lt;wt.set(xt.c,Gt),jA(wt,g,xt,xt.f,xt.u,Bt,$,xt.m),g+=16+Lt+(xt.m?xt.m.length:0),$=Gt+Bt}catch(Xt){return i(Xt,null)}}z0(wt,g,rt.length,Et,It),i(null,wt)};h||mt();for(var gt=function(wt){var It=a[wt],Et=s[It],Ct=Et[0],xt=Et[1],Bt=ap(),Lt=Ct.length;Bt.p(Ct);var Gt=j0(It),Xt=Gt.length,rn=xt.comment,fn=rn&&j0(rn),wn=fn&&fn.length,Cn=G_(xt.extra),bn=xt.level==0?0:8,Dn=function(En,Tn){if(En)ut(),i(En,null);else{var Un=Tn.length;rt[wt]=rm(xt,{size:Lt,crc:Bt.d(),c:Tn,f:Gt,m:fn,u:Xt!=It.length||fn&&rn.length!=wn,compression:bn}),g+=30+Xt+Cn+Un,$+=76+2*(Xt+Cn)+(wn||0)+Un,--h||mt()}};if(Xt>65535&&Dn("filename too long",null),bn)if(Lt<16e4)try{Dn(null,ms(Ct,xt))}catch(En){Dn(En,null)}else st.push(Ds(Ct,xt,Dn));else Dn(null,Ct)},yt=0;yt<nt;++yt)gt(yt);return ut}function NM(c,e){e||(e={});var i={},s=[];FA(c,"",i,e);var a=0,h=0;for(var g in i){var $=i[g],nt=$[0],rt=$[1],st=rt.level==0?0:8,ut=(Xt=j0(g)).length,mt=rt.comment,gt=mt&&j0(mt),yt=gt&&gt.length,wt=G_(rt.extra);if(ut>65535)throw"filename too long";var It=st?ms(nt,rt):nt,Et=It.length,Ct=ap();Ct.p(nt),s.push(rm(rt,{size:nt.length,crc:Ct.d(),c:It,f:Xt,m:gt,u:ut!=g.length||gt&&mt.length!=yt,o:a,compression:st})),a+=30+ut+wt+Et,h+=76+2*(ut+wt)+(yt||0)+Et}for(var xt=new xo(h+22),Bt=a,Lt=h-a,Gt=0;Gt<s.length;++Gt){var Xt=s[Gt];jA(xt,Xt.o,Xt,Xt.f,Xt.u,Xt.c.length);var rn=30+Xt.f.length+G_(Xt.extra);xt.set(Xt.c,Xt.o+rn),jA(xt,a,Xt,Xt.f,Xt.u,Xt.c.length,Xt.o,Xt.m),a+=16+rn+(Xt.m?Xt.m.length:0)}return z0(xt,a,s.length,Lt,Bt),xt}var FM=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),cP=function(){function c(){var e=this;this.i=new Il(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),uP=function(){function c(e,i){var s=this;i<32e4?this.i=new Il(function(a,h){s.ondata(null,a,h)}):(this.i=new ru(function(a,h,g){s.ondata(a,h,g)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=Bu(e,0)),this.i.push(e,i)},c.compression=8,c}(),M1=function(){function c(e){this.onfile=e,this.k=[],this.o={0:FM},this.p=Zs}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var g=0,$=0,nt=void 0,rt=void 0;this.p.length?e.length?((rt=new xo(this.p.length+e.length)).set(this.p),rt.set(e,this.p.length)):rt=this.p:rt=e;for(var st=rt.length,ut=this.c,mt=ut&&this.d,gt=function(){var It,Et=Vl(rt,$);if(Et==67324752){g=1,nt=$,yt.d=null,yt.c=0;var Ct=lp(rt,$+6),xt=lp(rt,$+8),Bt=2048&Ct,Lt=8&Ct,Gt=lp(rt,$+26),Xt=lp(rt,$+28);if(st>$+30+Gt+Xt){var rn=[];yt.k.unshift(rn),g=2;var fn,wn=Vl(rt,$+18),Cn=Vl(rt,$+22),bn=BS(rt.subarray($+30,$+=30+Gt),!Bt);wn==4294967295?(It=Lt?[-2]:Qw(rt,$),wn=It[0],Cn=It[1]):Lt&&(wn=-1),$+=Xt,yt.c=wn;var Dn={name:bn,compression:xt,start:function(){if(!Dn.ondata)throw"no callback";if(wn){var En=s.o[xt];if(!En)throw"unknown compression type "+xt;(fn=wn<0?new En(bn):new En(bn,wn,Cn)).ondata=function(Yn,cr,mr){Dn.ondata(Yn,cr,mr)};for(var Tn=0,Un=rn;Tn<Un.length;Tn++){var Pn=Un[Tn];fn.push(Pn,!1)}s.k[0]==rn&&s.c?s.d=fn:fn.push(Zs,!0)}else Dn.ondata(null,Zs,!0)},terminate:function(){fn&&fn.terminate&&fn.terminate()}};wn>=0&&(Dn.size=wn,Dn.originalSize=Cn),yt.onfile(Dn)}return"break"}if(ut){if(Et==134695760)return nt=$+=12+(ut==-2&&8),g=3,yt.c=0,"break";if(Et==33639248)return nt=$-=4,g=3,yt.c=0,"break"}},yt=this;$<st-4&&gt()!=="break";++$);if(this.p=Zs,ut<0){var wt=g?rt.subarray(0,nt-12-(ut==-2&&8)-(Vl(rt,nt-16)==134695760&&4)):rt.subarray(0,$);mt?mt.push(wt,!!g):this.k[+(g==2)].push(wt)}if(2&g)return this.push(rt.subarray($),i);this.p=rt.subarray($)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function UM(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var mt=0;mt<i.length;++mt)i[mt]()},a={},h=c.length-22;Vl(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var g=lp(c,h+8);g||e(null,{});var $=g,nt=Vl(c,h+16),rt=nt==4294967295;if(rt){if(h=Vl(c,h-12),Vl(c,h)!=101075792)return void e("invalid zip file",null);$=g=Vl(c,h+32),nt=Vl(c,h+48)}for(var st=function(mt){var gt=Vw(c,nt,rt),yt=gt[0],wt=gt[1],It=gt[2],Et=gt[3],Ct=gt[4],xt=gt[5],Bt=Fy(c,xt);nt=Ct;var Lt=function(Xt,rn){Xt?(s(),e(Xt,null)):(a[Et]=rn,--g||e(null,a))};if(yt)if(yt==8){var Gt=c.subarray(Bt,Bt+wt);if(wt<32e4)try{Lt(null,Ju(Gt,new xo(It)))}catch(Xt){Lt(Xt,null)}else i.push(om(Gt,{size:It},Lt))}else Lt("unknown compression type "+yt,null);else Lt(null,Bu(c,Bt,Bt+wt))},ut=0;ut<$;++ut)st();return s}function T1(c){for(var e={},i=c.length-22;Vl(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=lp(c,i+8);if(!s)return{};var a=Vl(c,i+16),h=a==4294967295;if(h){if(i=Vl(c,i-12),Vl(c,i)!=101075792)throw"invalid zip file";s=Vl(c,i+32),a=Vl(c,i+48)}for(var g=0;g<s;++g){var $=Vw(c,a,h),nt=$[0],rt=$[1],st=$[2],ut=$[3],mt=$[4],gt=$[5],yt=Fy(c,gt);if(a=mt,nt){if(nt!=8)throw"unknown compression type "+nt;e[ut]=Ju(c.subarray(yt,yt+rt),new xo(st))}else e[ut]=Bu(c,yt,yt+rt)}return e}class I1 extends d.hH6{load(e,i,s,a){return this.setResponseType("arraybuffer"),super.load(e,h=>{const g=T1(new Uint8Array(h)),$=new Map(Object.entries(g).map(([nt,rt])=>[nt,new File([rt],nt)]));i==null||i($)},s,a)}}function P1(){oo.Importers.push(new Ul(I1,["zip"],!0))}class n_ extends d.Ox3{constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new d.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),ro(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=Xr(ro({},i),!1),this.userData={},this.children=s,a.type="DirectionalLight2",a.target=this.target.position.toArray(),Object.assign(a,Xr(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,a=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,br(e,this,!0,i),s&&(e.target=s),a&&(a.color!==void 0&&this.color.set(a.color),a.intensity!==void 0&&(this.intensity=a.intensity),e.object=a),this}}class Uy extends d.PMe{constructor(e,i,s,a,h,g){super(e,i,s,a,h,g),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),ro(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=Xr(ro({},i),!1),this.userData={},this.children=s,a.type="SpotLight2",a.target=this.target.position.toArray(),Object.assign(a,Xr(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),br(e,this,!0,i),this):this)}}class OS extends d.cek{constructor(e,i,s,a){super(e,i,s,a),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),ro(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=Xr(ro({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,Xr(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),br(e,this,!0,i),this):this}}class D1 extends d.Mig{constructor(e,i){super(e,i),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),ro(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=Xr(ro({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,Xr(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),br(e,this,!0,i),this):this}}class jM extends d.aNw{load(e,i,s,a){const h=new d.hH6(this.manager);h.setPath(this.path),h.setResponseType("text"),h.load(e,g=>{try{i(this.parse(g))}catch($){a?a($):console.error($),this.manager.itemError(e)}},s,a)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const a=new d.Pa4(0,0,0),h=new d.Pa4(1,1,1),g=e.split(/[\n\r]+/g);let $=null,nt=0;for(let ut=0,mt=g.length;ut<mt;ut++){const gt=g[ut].trim(),yt=gt.split(/\s/g);switch(yt[0]){case"TITLE":i=gt.substring(7,gt.length-1);break;case"LUT_3D_SIZE":const wt=yt[1];s=parseFloat(wt),$=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":a.x=parseFloat(yt[1]),a.y=parseFloat(yt[2]),a.z=parseFloat(yt[3]);break;case"DOMAIN_MAX":h.x=parseFloat(yt[1]),h.y=parseFloat(yt[2]),h.z=parseFloat(yt[3]);break;default:const It=parseFloat(yt[0]),Et=parseFloat(yt[1]),Ct=parseFloat(yt[2]);if(It>1||It<0||Et>1||Et<0||Ct>1||Ct<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");$[nt+0]=255*It,$[nt+1]=255*Et,$[nt+2]=255*Ct,$[nt+3]=255,nt+=4}}const rt=new d.IEO;rt.image.data=$,rt.image.width=s,rt.image.height=s*s,rt.type=d.ywz,rt.magFilter=d.wem,rt.minFilter=d.wem,rt.wrapS=d.uWy,rt.wrapT=d.uWy,rt.generateMipmaps=!1,rt.needsUpdate=!0;const st=new d.JUT;return st.image.data=$,st.image.width=s,st.image.height=s,st.image.depth=s,st.type=d.ywz,st.magFilter=d.wem,st.minFilter=d.wem,st.wrapS=d.uWy,st.wrapT=d.uWy,st.wrapR=d.uWy,st.generateMipmaps=!1,st.needsUpdate=!0,{title:i,size:s,domainMin:a,domainMax:h,texture:rt,texture3D:st}}}class oo extends _e{constructor(e,i=!1){super(),this._processors=new S0,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new d.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),P1(),w1(e.renderer.rendererObject),ku(e),Kv()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var i;let s=decodeURI(e);const a=(i=this._rootContext)===null||i===void 0?void 0:i.rootUrl;s.includes("://")||!a||s.startsWith(a)||(s=a+s),s=s.replace("./",""),s=s.replace(/^(\/\/)/,"/"),s=s.replace(/\?.*$/,"");const h=this._fileDatabase.get(s);return h?h.ext?(h.objectUrl||(h.objectUrl=URL.createObjectURL(h)+"#"+s),h.objectUrl):(console.error("Unable to determine file extension",h),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(a=>{const h=new RegExp(a.startsWith("data:")?"^"+a+"\\/":"\\."+a+"$","i");this._loadingManager.addHandler(h,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:a}=i;if(a&&a.length<1&&(a=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const h=[],g=[];if(e.forEach(($,nt)=>{var rt;this.registerFile(nt,$);const st=$.ext;st&&((rt=a==null?void 0:a.includes(st.toLowerCase()))===null||rt===void 0||rt)&&(this._isRootFileExtension(st)?h.push(nt):g.push(nt))}),h.length>0)for(const $ of h){let nt=await this._importFile($,void 0,i);nt&&(nt=await this.processImported(nt,i)),s.set($,nt)}else for(const $ of g){let nt=await this._importFile($,void 0,i);nt&&(nt=await this.processImported(nt,i)),s.set($,nt)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach(($,nt)=>{this.unregisterFile(nt)}),s}registerFile(e,i){var s,a,h;e=e.replace(/\?.*$/,"");const g=(s=i==null?void 0:i.ext)!==null&&s!==void 0?s:(h=AA((a=i==null?void 0:i.name)!==null&&a!==void 0?a:e))===null||h===void 0?void 0:h.toLowerCase();i&&(i.ext||(i.ext=g),this._fileDatabase.set(e,i));let $=this._getLoader(e);if($||($=this._createLoader(i??{name:e,ext:g})),$){for(const nt of this._loaderCache)if(nt.loader===$){nt.files.push(e);break}}return $}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return oo.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},a){var h,g;if(!((h=i)===null||h===void 0)&&h.__imported)return i.__imported;let $;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i),s.rootPath=e;const nt=this.resolveURL(e),rt=e.replace(/\?.*$/,""),st=(g=s.fileHandler)!==null&&g!==void 0?g:await this._loadingManager.getHandler(rt)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0);if(!st)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:nt,rootUrl:d.Zp0.extractUrlBase(e),baseUrl:d.Zp0.extractUrlBase(nt)},$=await st.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),ut=>{a&&a(ut),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:ut.loaded/ut.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(nt){return console.error("AssetImporter: Unable to import file",e,i),console.error(nt),console.error(nt==null?void 0:nt.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:nt}),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),i&&(i.__imported=$),$}_getImporter(e,i=!1){return oo.Importers.find(s=>{if(i&&!s.root)return!1;const a=s.ext.find(h=>{var g,$,nt;return e.ext&&h===e.ext.toLowerCase()||(($=(g=e.name)===null||g===void 0?void 0:g.toLowerCase())===null||$===void 0?void 0:$.endsWith("."+h.toLowerCase()))||(h==null?void 0:h.startsWith("data:"))&&((nt=e.name)===null||nt===void 0?void 0:nt.startsWith(h))});return!!a&&(e.ext=a,!0)})}_getLoader(e){var i;return(i=this._loadingManager.getHandler(e))!==null&&i!==void 0?i:void 0}async importAsset(e,i={},s){var a;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const $=this._cachedAssets.find(nt=>nt.path===e.path);$&&Object.assign(e,$)}const g=this._cachedAssets.findIndex($=>$.path===e.path);g>=0&&this._cachedAssets.splice(g,1),this._cachedAssets.push(e)}let h;if(e!=null&&e.preImported&&(h=await e.preImported),!i.forceImport&&h){const g=await this.processImported(h,i);let $=!1;for(const nt of g)if(nt.__disposed){$=!0;break}if(!$||i.reimportDisposed===!1)return g}return e.preImported=this._importFile(i.pathOverride||e.path,typeof((a=e.file)===null||a===void 0?void 0:a.arrayBuffer)=="function"?e.file:void 0,i,s),h=await e.preImported,h&&(h=await this.processImported(h,i)),h}async importSingle(e,i={}){var s;return(s=await this.importAsset(e,i))===null||s===void 0?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))===null||s===void 0?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed;const a=JSON.stringify(s);let h;return h=this._cachedAssets.find(g=>g.path===e&&g._options===a)||{path:e},h._options=a,await this.importAsset(h,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var s,a,h,g,$,nt,rt,st;let ut=e;if(!ut)return[];if(i.processImported===!1)return[ut];if(Array.isArray(ut)){const mt=[];for(const gt of ut)mt.push(...await this.processImported(gt,i));return mt}if(!((s=ut.userData)===null||s===void 0)&&s.rootSceneModelRoot){if(i._rootSceneImported=!0,ut.__processedChildren&&!i.forceImporterReprocess)return ut.__processedChildren;if(!(ut.children.length<1))return ut.animations&&(ut.children[0].animations||(ut.children[0].animations=[]),ut.children[0].animations.push(...ut.animations)),ut.__importedViewerConfig&&(ut.children[0].__importedViewerConfig=ut.__importedViewerConfig),ut.__processedChildren=await this.processImported([...ut.children],i),ut.__processedChildren;if(((a=ut.animations)===null||a===void 0?void 0:a.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",ut.animations),!ut.__importedViewerConfig)return[];ut=ut.__importedViewerConfig}if(!((h=ut.userData)===null||h===void 0)&&h.iModel&&(ut=ut.userData.iModel),!((g=ut.userData)===null||g===void 0)&&g.iMaterial&&(ut=ut.userData.iMaterial),ut.assetImporterProcessed&&!i.forceImporterReprocess)return[ut];if(!ut.assetType){if(ut.isBufferGeometry&&(ut=new d.Kj0(ut,new d.Wid)),ut.isObject3D){if(ut.isLight)ut=LS(ut);else{const mt=[];ut.traverse(gt=>{gt!==ut&&gt.isLight&&mt.push(gt)});for(const gt of mt)LS(gt);ut=new hv(ut,i)}!i.rootPath||ut.modelObject.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(ut.modelObject.userData.rootPath=i.rootPath)}ut.isTexture&&(ut.assetType="texture",i._testDataTextureComplete&&(ut.isDataTexture&&(!(($=ut.image)===null||$===void 0)&&$.data)&&(ut.image.complete=!0),!((nt=ut.image)===null||nt===void 0)&&nt.complete&&(ut.needsUpdate=!0)),i.generateMipmaps!==void 0&&(ut.generateMipmaps=i.generateMipmaps),ut.generateMipmaps||ut.isRenderTargetTexture||(ut.minFilter=ut.minFilter===d.D1R?d.wem:ut.minFilter,ut.magFilter=ut.magFilter===d.D1R?d.wem:ut.magFilter),!i.rootPath||ut.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(ut.userData.rootPath=i.rootPath)),ut.isMaterial&&(ut.assetType="material",!i.rootPath||ut.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(ut.userData.rootPath=i.rootPath))}if(ut.assetType!=null)return ut=await this._processors.process(ut.assetType,ut,{}),ut.assetImporterProcessed=!0,[ut];if(ut instanceof Map)return[...(await this.importFiles(ut,i)).values()].flat();if(ut.type){const mt=this._viewer.getPluginByType(ut.type);if(mt){let gt=ut._importedResources||{};return ut.resources&&(gt=await((rt=this._viewer.getManager())===null||rt===void 0?void 0:rt.importConfigResources(ut.resources)),delete ut.resources,ut._importedResources=gt),typeof mt.fromJSON=="function"&&(await Promise.resolve(mt.fromJSON(ut,gt)),ut.assetImporterProcessed=!1),[]}}else if(ut.plugins)return ut.resources=await((st=this._viewer.getManager())===null||st===void 0?void 0:st.importConfigResources(ut.resources)),await this._viewer.getManager().importViewerConfig(ut),ut.assetImporterProcessed=!1,[];return console.warn("unknown asset type: ",ut),[ut]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function R1(c){if(!c)return d.ywz;const e=c.extensions.has("EXT_color_buffer_half_float")||c.capabilities.isWebGL2&&c.extensions.has("EXT_color_buffer_float"),i=c.capabilities.isWebGL2||c.extensions.has("OES_texture_float")||c.extensions.has("WEBGL_color_buffer_float");return e?d.cLu:i?d.VzW:d.ywz}function LS(c){var e,i,s;if(!c.isLight||c.assetType==="light")return c;if(c.uiConfig)return console.warn("ui config already exists, not supported",c),c;let a;if(c.children.length,c.isDirectionalLight&&(a=new n_),c.isAmbientLight&&(a=new D1),c.isSpotLight&&(a=new Uy),c.isPointLight&&(a=new OS),a){(i=(e=a.lightObject).copy)===null||i===void 0||i.call(e,c);const h=c.parent;!((s=h)===null||s===void 0)&&s.isObject3D&&(h.remove(c),c.dispose(),c.userData.iModel=a,h.add(a.lightObject),a.uuid=c.uuid),Qo(a.lightObject,h)}else console.warn("unknown light type: ",c);return a}oo.Importers=[new Ul(xA,["json"],!1),new Ul(d.hH6,["txt"],!1),new Ul(L_,["rgbe.png","hdr.png","hdrpng"],!1),new Ul(d.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Ul(jM,["CUBE"],!1)];class zM extends d.u7G{constructor(e){super(e)}async loadAsync(e,i){var s;const a=new d.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const h=await a.loadAsync(e,i);try{const g=JSON.parse(h);if(g.images&&this.importer){const $={};let nt=g.images;Array.isArray(nt)||(nt=Object.values(nt));for(const rt of g.images){if(!rt.url||!rt.uuid)continue;const st=(s=await this.importer.importPath(rt.url,{processImported:!1}))===null||s===void 0?void 0:s[0],ut=st==null?void 0:st.source;if(!st||!ut)continue;const mt=new d.Hw6(ut.data);mt.uuid=rt.uuid,$[mt.uuid]=mt,st.dispose()}return this.parse(g,$)}return this.parse(g)}catch(g){throw console.error(g),this.manager.itemError(e),g}}parse(e,i){var s,a;let h;const g={p:new Promise(st=>{h=st})};if(e.images||e.textures){const st=new MA(this.manager);let ut={};const mt=It=>{h(),g.p=void 0,Object.values(ut).forEach(Et=>{var Ct;Et.isTexture&&(!((Ct=Et.image)===null||Ct===void 0)&&Ct.complete)&&(Et.needsUpdate=!0)})};let gt=e.images||[];Array.isArray(gt)||(gt=Object.values(gt));const yt=i||st.parseImages(gt,mt);let wt=e.textures;Array.isArray(wt)||(wt=Object.values(wt)),ut=st.parseTextures2(wt,yt,mt),this.setTextures(ut)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const $={...e};if(Object.entries($).forEach(([st,ut])=>{ut&&typeof ut=="string"&&this.textures[ut]&&($[st]=this.textures[ut])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?$.vertexColors=e.vertexColors>0:$.vertexColors=e.vertexColors),e.normalScale!==void 0){let st=e.normalScale;Array.isArray(st)===!1&&(st=[st,st]),$.normalScale=new d.FM8().fromArray(st)}let nt=e.type;nt!=="MeshPhysicalMaterial"&&nt!=="MeshStandardMaterial"||(nt=Yu.TYPE),$.userData=br($.userData,void 0,!1,this);const rt=(a=(s=this.materials)===null||s===void 0?void 0:s.generateFromTemplateType(nt,$))!==null&&a!==void 0?a:super.parse(e);return this.setTextures({}),rt.userData.imageLoadAwaiter=g,rt}}class Jr extends _e{constructor(e,i,{simpleCache:s=!1,storage:a}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||a)&&(s&&(d.CtF.enabled=!0),a&&window.Cache&&typeof window.Cache=="function"&&a instanceof window.Cache)){const h={...d.CtF};d.CtF.get=(g,$,nt)=>$?g.startsWith("data:")||g.startsWith("blob")||g.startsWith("chrome-extension")?Promise.resolve(void 0):a.match(g).then(rt=>{if(rt)switch($){case"arraybuffer":return rt.arrayBuffer();case"blob":return rt.blob();case"document":return rt.text().then(st=>new DOMParser().parseFromString(st,nt??"text/html"));case"json":return rt.json();default:if(nt===void 0)return rt.text();{const st=/charset="?([^;"\s]*)"?/i.exec(nt),ut=st&&st[1]?st[1].toLowerCase():void 0,mt=new TextDecoder(ut);return rt.arrayBuffer().then(gt=>mt.decode(gt))}}}):h.get(g),d.CtF.add=(g,$,nt)=>{nt||h.add(g,$),g.startsWith("data:")||g.startsWith("blob")||g.startsWith("chrome-extension")||a.put(g,new Response($,{status:200}))},d.CtF.remove=(g,$)=>{$||h.remove(g),a.delete(g)}}this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var a;return(a=this._viewer)===null||a===void 0?void 0:a.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,i))===null||s===void 0?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)===null||s===void 0?void 0:s.processImported(e,i).then(a=>(this.addProcessedAssets(a,i),a))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)===null||i===void 0||i.processMaterial(s,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new P_,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new oo(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,a)=>(D_(s,h=>{var g;return(g=this._materials)===null||g===void 0?void 0:g.processModel(h,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,a)=>{var h;return!((h=this.materials)===null||h===void 0)&&h.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=or(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,a)}})),oo.Importers.push(new Ul(zM,[Yu.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);oo.Importers.push(new Ul(class extends xA{async loadAsync(s,a){return i(await super.loadAsync(s,a))}},[Jr.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var i,s;e===this._viewer&&((i=this._importer)===null||i===void 0||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)===null||s===void 0||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e){if(!this._viewer)return{};const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},...e},s=this._viewer.toJSON(i);return s.resources=i,s}exportPluginPresets(e){var i;const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};return{plugins:(i=this._viewer)===null||i===void 0?void 0:i.serializePlugins(s,e),resources:s}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var s;const a=e.type;if(!(i=i||((s=this._viewer)===null||s===void 0?void 0:s.getPluginByType(a))))return void console.warn(`No plugin found for type ${a} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${a} does not support importing presets`);const h=e.resources||{};return e.resources&&delete e.resources,await i.fromJSON(e,h),h&&(e.resources=h),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const a of Object.values(i.materials))a.__useCount?delete a.__useCount:(s=this._materials)===null||s===void 0||s.unregisterMaterial(a);for(const a of Object.values(i.textures))a.__useCount&&delete a.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var a,h,g;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const $={};i=i??new MA(this._importer.loadingManager),$.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&($.animations={...$.animations,...s.animations}),$.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&($.shapes={...$.shapes,...s.shapes}),$.geometries=e.geometries?i.parseGeometries(e.geometries,$.shapes):{},s&&s.geometries&&($.geometries={...$.geometries,...s.geometries}),$.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&($.images={...$.images,...s.images});for(const rt of Object.values(e.textures)){const st=(a=rt==null?void 0:rt.userData)===null||a===void 0?void 0:a.rootPath;if(st&&(!rt.image||!$.images[rt.image])){const ut=(h=await this._importer.importPath(st,{processImported:!1}))===null||h===void 0?void 0:h[0],mt=ut==null?void 0:ut.source;if(!ut||!mt)continue;const gt=new d.Hw6(mt.data);rt.image&&(gt.uuid=rt.image),$.images[gt.uuid]=gt,rt.image=gt.uuid,ut.dispose()}}$.textures=e.textures?i.parseTextures2(Object.values(e.textures),$.images,()=>{Object.values($.textures).forEach(rt=>{var st;rt.isTexture&&(!((st=rt.image)===null||st===void 0)&&st.complete)&&(rt.needsUpdate=!0)})}):{};for(const rt of Object.entries($.textures))rt[1]=(g=await this._importer.processImported(rt[1],{}))===null||g===void 0?void 0:g[0],rt[1]?$.textures[rt[0]]=rt[1]:delete $.textures[rt[0]];s&&s.textures&&($.textures={...$.textures,...s.textures});const nt=e.materials?Object.values(e.materials):[];for(const rt of nt)Object.entries(rt).forEach(([st,ut])=>{ut&&ut.resource&&ut.uuid&&ut.resource==="textures"&&(rt[st]=ut.uuid)});return $.materials=i.parseMaterials2(nt,$.textures,this._materials),s&&s.materials&&($.materials={...$.materials,...s.materials}),e.object&&($.object=i.parseObject(e.object,$.geometries,$.materials,$.textures,$.animations),e.skeletons&&($.skeletons=i.parseSkeletons(e.skeletons,$.object),i.bindSkeletons($.object,$.skeletons))),$.__isLoadedResources=!0,$}}Jr.PluginType="AssetManager",Jr.ViewerTypeSlug="vjson";class Ks extends _e{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=Xr(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(br(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e}),this)}}function zA(c,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){sn(e,"dirty",s,!0)},update(){var s,a,h;this.passObject.enabled&&((a=(s=this.passObject).updateShaderProperties)===null||a===void 0||a.call(s,Ht(i)),(h=e.update)===null||h===void 0||h.call(this))},onRegister(s){var a,h,g;this.passObject.materialExtension&&((h=(a=c.getPlugin(Jr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.registerMaterialExtension(this.passObject.materialExtension)),(g=e.onRegister)===null||g===void 0||g.call(this,s)},onUnregister(s){var a,h,g;this.passObject.materialExtension&&((h=(a=c.getPlugin(Jr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.unregisterMaterialExtension(this.passObject.materialExtension)),(g=e.onUnregister)===null||g===void 0||g.call(this,s)},dispose(){var s,a,h;(a=(s=this.passObject).dispose)===null||a===void 0||a.call(s),(h=e.dispose)===null||h===void 0||h.call(this)}}}class Av extends Ks{constructor(){super(),this._enabledTemp=!0}_update(e){var i;return((i=this._pass)===null||i===void 0?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||this._enabledTemp}set enabled(e){var i;!((i=this._pass)===null||i===void 0)&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=zA(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=this.pass;return h&&(a.pass=Xr((s=(i=h)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:h,!1,e)),a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.pass){const h=this.pass;h&&br(e.pass,(a=(s=h)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:h,!1,i)}return this}}(function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)})([Qn()],Av.prototype,"enabled",null);const NS=new Set,FS=new Set;class VM extends Wo{constructor(e,i,s,a){super(void 0,void 0,i,new hs(1,1,1),1),this.target=e}render(e,i,s,a,h){const g=e.getRenderTarget(),$=e.getActiveCubeFace(),nt=e.getActiveMipmapLevel();this.scene.traverse(({material:rt})=>{rt&&((rt.transparent&&rt.userData.renderToDepth||!rt.transparent&&rt.transmission===0&&rt.userData.renderToDepth===!1)&&(NS.add(rt),rt.transparent=!rt.transparent),Math.abs(rt.transmission||0)>0&&rt.userData.renderToDepth&&(FS.add([rt,rt.transmission]),rt.transmission=0))}),Br(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,a,h)),NS.forEach(rt=>rt.transparent=!rt.transparent),NS.clear(),FS.forEach(([rt,st])=>rt.transmission=st),FS.clear(),e.setRenderTarget(g,$,nt)}}class El extends Av{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var i,s;const a=((i=this._viewer)===null||i===void 0?void 0:i.renderer.isWebGL2)&&this.renderFlagsBuffer,h=e.renderer.createTarget({depthBuffer:!0,type:d.ywz,textureCount:a?2:1});Array.isArray(h.texture)?(h.texture[0].name="gbufferDepthNormal",h.texture[1].name="gbufferFlags",this._gbufferTextures=h.texture):(h.texture.name="gbufferDepthNormal",this._gbufferTextures.push(h.texture)),this._gbufferTarget=h;const g=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("debug");return g&&(g.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&g.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),new VM(h,new qp(a))}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Hv}updateShaderProperties(e){var i,s;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(i=this.getDepthNormal())!==null&&i!==void 0?i:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(s=this.getFlagsTexture())!==null&&s!==void 0?s:void 0;const a=e.uniforms.tGBufferFlags.value?1:0;a!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=a,e.needsUpdate=!0)}return this}}El.PluginType="GBuffer";class QM extends Wo{constructor(e,i=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new hs(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new yA({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:d.rnI,type:d.cLu,format:d.wk1,minFilter:d.wem,magFilter:d.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,i,s,a,h){var g;let $=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,a,h),this.needsSwap=$,void(e.userData.mainRenderPass=void 0);const nt=e.userData;nt||console.error("threejs is not patched?");const rt=this._viewer.useGBufferDepth;let st;if(rt){const mt=(g=this._viewer.getPlugin(El))===null||g===void 0?void 0:g.getTarget();if(mt){const gt=e.properties.get(mt);st=gt.__webglDepthRenderbuffer||gt.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let ut=()=>{super.render(e,void 0,s,a,h,st)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if($=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const mt=e.autoClearDepth;e.autoClearDepth=!rt,Br(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},ut),e.autoClearDepth=mt}if(!rt){const mt=e.properties.get(s);st=mt.__webglDepthRenderbuffer||mt.__webglDepthbuffer}ut=()=>{super.render(e,void 0,this.transparentTarget,a,h,st)};{const mt=this.clear,gt=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,Br(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},ut),this.clear=mt,e.autoClearDepth=gt}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),$=!0);{const mt=this.clear;this.clear=!1,nt.transmissionRenderTarget=$?i:s,nt.blurTransmissionTarget=this.blurTransmissionTarget,Br(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},ut),nt.blurTransmissionTarget=void 0,nt.transmissionRenderTarget=void 0,this.clear=mt}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),$=!0)}}else{{const mt=this.clear,gt=e.autoClearDepth;e.autoClearDepth=!rt,this.clear=!0,Br(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},ut),this.clear=mt,e.autoClearDepth=gt}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const mt=this.clear;this.clear=!1,nt.transmissionRenderTarget=i,nt.blurTransmissionTarget=this.blurTransmissionTarget,Br(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},ut),nt.blurTransmissionTarget=void 0,nt.transmissionRenderTarget=void 0,this.clear=mt}$=!1}this._releaseTransparentTarget(),this.needsSwap=$,e.userData.mainRenderPass=void 0}}function US(c,e){return c.multiplyScalar(c.w*e),c.w=1,c}function jS(c,e){return US(c,e),new hs(c.x,c.y,c.z)}function zS(c,e){const i=Math.max(c.x,Math.max(c.y,c.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,c.divideScalar(s*e),c.w=s,c}function GM(c,e){return zS(new d.Ltg(c.r,c.g,c.b,1),e)}var k1=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};function VS(c){return Object.getPrototypeOf(c).constructor.PluginType}d.Vj0.background.fragmentShader=d.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),d.Vj0.background.fragmentShader=d.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Wm extends _e{constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!1,screenShader:a="",...h}){var g;super(),this.console=console,this._state=j.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(mt=>this.resize()):void 0,this._lastSize=new d.FM8,this._onContextRestore=mt=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=mt=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===wv&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=mt=>{var gt;if(!mt||!mt.object)return;const yt=mt.object.__importedViewerConfig||((gt=mt.object.modelObject)===null||gt===void 0?void 0:gt.__importedViewerConfig);if(!yt)return;const wt=this.getManager();wt?wt.applyViewerConfig(yt,yt.resources):this.fromJSON(yt,yt.resources)},this.alert=async mt=>alert(mt),this.confirm=async mt=>confirm(mt),this.prompt=async(mt,gt,yt=!0)=>prompt(mt,gt),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=a,this._canvas=h.canvas||E_();let $=h.container;if($&&!h.canvas&&$.appendChild(this._canvas),$||($=(g=this._canvas.parentElement)!==null&&g!==void 0?g:void 0),!$)throw new Error("No container.");this._container=$,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){try{const mt=window.location.href;if(mt.startsWith("http://localhost:8062")||mt.startsWith("https://localhost:8062"))return!0;await fetch("https://europe-west1-pixotronics-320918.cloudfunctions.net/viewer-hit-test"+"/?u="+encodeURIComponent(mt),{mode:"no-cors",method:"POST",credentials:"omit",cache:"no-store",keepalive:!1,referrer:"about:client",referrerPolicy:"unsafe-url"})}catch{return!1}}(),async function(){var mt;const gt=window.location.href,yt="https://dev-sandbox.pixotronics.com/webgi/";if(!gt.startsWith(yt)||M_("noUpdate")!==null)return!0;const wt=(mt=gt.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||mt===void 0?void 0:mt[1],It=(await(await fetch(yt+"version.txt")).text()).split(`
`)[0];if(wt&&wt!==It){if(confirm(`New version ${It} is available, do you want to open?`)){const Et=window.location.href.replace(wt,It);return window.location.href=Et,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const nt=new Ap(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var mt,gt;const yt=st.scene.activeCamera;if(yt&&yt.interactionsEnabled){if(((mt=this.getPluginByType("Progressive"))===null||mt===void 0?void 0:mt.postFrameConvergedRecordingDelta())===0)return;(gt=yt.controls)===null||gt===void 0||gt.update()}}),this.scene=new b_(nt),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Os({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:i?Vn:d.rnI,type:i?d.ywz:d.cLu,depthBuffer:!s}}),this._isAntialiased=e&&this._renderer.isWebGL2;let rt=!0;this._renderer.rendererObject.userData||(rt=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!rt;const st=this;this.renderFilter={passId:"render",passObject:new QM(this,rt),update(){const mt=this.passObject;mt.scene=st.scene.modelObject,mt.camera=st.scene.activeCamera.cameraObject}};const ut={passId:"screen",after:["render"],required:["render"],passObject:VA(a)};[this.renderFilter,ut].forEach(mt=>this._renderer.registerPass(mt)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",mt=>this.setDirty(this.scene,mt)),this.scene.addEventListener("sceneUpdate",mt=>{this.setDirty(this.scene,mt),mt.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",mt=>this.setDirty(this.scene,mt)),this._renderer.addEventListener("update",mt=>this.setDirty(this._renderer,mt)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Wm.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var a,h;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let g=0;g<this.maxFramePerLoop;g++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const rt=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const st=(h=(a=this._renderer.rendererObject.xr.getCamera())===null||a===void 0?void 0:a.cameras[0])===null||h===void 0?void 0:h.viewport;st?(st.x===0&&st.y===0||this.console.warn("x and y must be 0?"),rt[0]=st.width,rt[1]=st.height,this.console.log("resize for xr",rt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...rt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const $=Object.values(this.plugins).filter(rt=>rt.dirty);$.length>0&&this.setDirty($),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const nt=this._renderer.dirty;if(nt){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(rt){this.console.error(rt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!nt)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...i){var s;let a;a=e.prototype?new e(...i):e;const h=VS(a);return h?((s=a.dependencies)===null||s===void 0||s.forEach(g=>{this.getPlugin(g)||(this.console.log("Adding plugin dependency",g.name,"for",h),this.addPlugin(g))}),this.plugins[h]&&this.console.error(`Plugin of type ${h} already exists`,this.plugins[h],a),this.plugins[h]=a,await a.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:a}),this.setDirty(a),a):(this.console.error("PluginType is not defined for",a),a)}async removePlugin(e,i=!0){const s=VS(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var i;const s=(i=e.userData.iCamera)!==null&&i!==void 0?i:new Ap(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return s.autoLookAtTarget=!1,s}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,i,s,a;const h=(a=(s=(i=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||i===void 0?void 0:i.background.getPlaneMesh())===null||s===void 0?void 0:s.material.uniforms)!==null&&a!==void 0?a:d.Vj0.background.uniforms;h.intensity||(h.intensity={value:1}),h.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const i=new hs().set(e).convertSRGBToLinear();return this.setBackground(i)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===wv)return this._sceneEnvironmentChanged();const i=e.isVector4?kr(e):Tr(e.isColor?e:new hs(e));return i.assetType="texture",this.scene.setBackground(i)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var i,s,a;if(e)return this._rawBackground;let h=(i=this._rawBackground)!==null&&i!==void 0?i:this.scene.getBackground();return h?(!((s=h)===null||s===void 0)&&s.isVector4&&(h=jS(h,7).getHexString()),!((a=h)===null||a===void 0)&&a.isColor?h.getHexString():this._rawBackground===wv?this.scene.getEnvironment():h):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:i=new d.Pa4(1,1,1),targetOffset:s=new d.Pa4(0,0,0),...a}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const h=e?new ar().expandByObject(e,!0,!0):this.scene.getBounds(!0),g=h.getCenter(new d.Pa4),$=.5*h.getSize(new d.Pa4).length();g.add(s.clone().multiplyScalar($)),this.scene.activeCamera.position=new d.Pa4(g.x+i.x*$,g.y+i.y*$,g.z+i.z*$),this.scene.activeCamera.target=g,this.setDirty()}}async createObject3D(e){var i;return(i=this.getManager())===null||i===void 0?void 0:i.addImportedSingle(e||new d.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,a,h,g,$;if(!((s=i)===null||s===void 0)&&s.isMaterial){const nt=(h=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i.uuid);if(nt)return nt}return($=(g=this.getManager())===null||g===void 0?void 0:g.materials)===null||$===void 0?void 0:$.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var a,h;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(h=(a=s[1]).toJSON)===null||h===void 0?void 0:h.call(a,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var a;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const h=this.getPluginByType(s.type);h&&((a=h.fromJSON)===null||a===void 0||a.call(h,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){return Object.assign({version:Wm.VERSION,plugins:this.serializePlugins(e,i)},Xr(this,!0,e))}fromJSON(e,i){return br(e,this,!0,i),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,i),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Wm.VERSION="0.5.5",k1([Qn()],Wm.prototype,"scene",void 0),k1([Qn("background")],Wm.prototype,"_rawBackground",void 0),k1([Qn(),hn(Wm.prototype._backgroundIntensityChanged)],Wm.prototype,"backgroundIntensity",void 0);const wv="envMapBackground";function VA(c){var e,i,s;return!((e=c)===null||e===void 0)&&e.isShaderPass2?c:new Au({...it,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(c)?c[0]:((i=c)===null||i===void 0?void 0:i.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(c)?c[1]:typeof c=="string"?c:((s=c)===null||s===void 0?void 0:s.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var _h=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let iu=class extends Ks{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=c=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(c){var e;if(this.isFullScreen())return;const i=c||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return i?(this._lastFsElement=i,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[i.style.width,i.style.height],i.style.width="100%",i.style.height="100%",i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(c){return this.isFullScreen()?this.exit():this.enter(c)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};iu.PluginType="FullScreenPlugin",_h([No("Enter FullScreen")],iu.prototype,"enter",null),_h([No("Exit FullScreen")],iu.prototype,"exit",null),_h([No("Toggle FullScreen")],iu.prototype,"toggle",null),iu=_h([ho("Full Screen")],iu);class Gw{constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([a,h])=>h&&this.on(a,h))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var i,s;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const a=Array.from(((i=e.dataTransfer)===null||i===void 0?void 0:i.files)||[]),h=Array.from(((s=e.dataTransfer)===null||s===void 0?void 0:s.items)||[]);if(a.length!==0||h.length!==0)if(h.length>0){const g=h.map($=>$.webkitGetAsEntry());this._loadNextEntry(new Map,g)}else this._emit("drop",{files:new Map(a.map(g=>(g.filePath=g.name,[g.filePath,g])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var i;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const s=[].slice.call((i=this._inputEl.files)!==null&&i!==void 0?i:new FileList),a=new Map;s.forEach(h=>{h.filePath=h.webkitRelativePath||h.name,a.set(h.filePath,h)}),this._emit("drop",{files:a})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(a=>{a.filePath=s.fullPath,e.set(s.fullPath,a),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const a=s.createReader(),h=g=>{g.length?(i=i.concat(g),a.readEntries(h)):this._loadNextEntry(e,i)};a.readEntries(h)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Hw extends _e{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!0,autoCenter:!1,autoImport:!0,autoAdd:!0,centerOffset:new d.Pa4(.5,.5,3)},this.dependencies=[Jr],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"pseudoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Gw(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var i,s,a,h,g,$;if(!e)return;const nt=this._viewer;if(!nt)return;if(this._allowedExtensions!==void 0)for(const ut of e.keys())this._allowedExtensions.includes((s=(i=ut.split(".").pop())===null||i===void 0?void 0:i.toLowerCase())!==null&&s!==void 0?s:"")||e.delete(ut);if(e.size<1)return;const rt=nt.getPlugin(Jr),st={type:"drop",files:e};if(this.importerParams.autoImport){const ut={allowedExtensions:this.allowedExtensions,...this.importerParams};if(st.imported=await((a=rt.importer)===null||a===void 0?void 0:a.importFiles(e,ut)),this.importerParams.autoAdd){const mt=($=[...(g=(h=st.imported)===null||h===void 0?void 0:h.values())!==null&&g!==void 0?g:[]].flat(2).filter(gt=>!!gt))!==null&&$!==void 0?$:[];if(st.assets=rt.addProcessedAssets(mt,{...this.importerParams}),!ut._rootSceneImported)for(const gt of st.assets)gt.modelObject&&gt.modelObject.dispatchEvent({type:"select",value:gt.modelObject})}}this.dispatchEvent(st)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var i;(i=this._dropzone)===null||i===void 0||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}Hw.PluginType="Dropzone";class QS extends Au{constructor(e){super({vertexShader:it.vertexShader,fragmentShader:zt`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new d.Ltg(1,1,1,1)},weight2:{value:new d.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Ww extends Ks{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=Ao()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const a=s;e.renderer.unregisterPass(a),(i=a==null?void 0:a.dispose)===null||i===void 0||i.call(a)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=Object.entries(this.passes);a.passes={};for(const[g,$]of h)a.passes[g]=Xr((s=(i=$)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:$,!1,e);return a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.passes){const h=Object.entries(this.passes);for(const[g,$]of h)br(e.passes[g],(a=(s=$)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:$,!1,i)}return this}}var HM=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const GS=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class cp extends Ww{constructor(e=2*GS.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(a=>{var h;!((h=a==null?void 0:a.shadow)===null||h===void 0)&&h.camera&&a.shadow.mapSize&&this.trackedJitterCameras.add([a.shadow.camera,a.shadow.mapSize])})},this._jitterCamera=i=>{var s;const a=i.target;if(this.jitter&&a.renderer.frameCount>2){const h=($,nt)=>{const rt={...GS[a.renderer.frameCount%GS.length]};$.setViewOffset(nt.width,nt.height,rt.x,rt.y,nt.width,nt.height)},g=a.scene.activeCamera.cameraObject;h(g,{width:a.canvas.clientWidth*a.renderer.displayCanvasScaling,height:a.canvas.clientHeight*a.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach($=>h(...$)),this._hasSetOffset=!0,(s=this._viewer)===null||s===void 0||s.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=w_("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[zA(e,{passId:"progressive",get dirty(){var a;return i.jitter&&(((a=i._viewer)===null||a===void 0?void 0:a.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends QS{render(a,h,g,$,nt){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((g==null?void 0:g.texture)&&e.renderer.blit(g.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(a,h,g,$,nt),e.renderer.blit(h.texture,i.lastFrame,{})}},update(){if(!i.lastFrame)return void console.error("lastFrame render target undefined");let a=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(a,a,a,a),a=1-a,this.passObject.weights2.set(a,a,a,a),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i,s;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(s=(i=this.lastFrame)===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}cp.PluginType="Progressive",HM([Qn(),uo("Frame count")],cp.prototype,"maxFrameCount",void 0),HM([Qn(),rs("Jitter")],cp.prototype,"jitter",void 0);var xv="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",qw=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,B1=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,bv=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,HS=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,O1=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,WM=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,L1=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,Ev=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Em=class extends Au{constructor(c,e,i,s=!0){super({vertexShader:xv,fragmentShader:`

varying vec2 vUv;

${B1}
${qw}
${bv}
${HS}
${i}

${O1}

${WM}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new d.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new d.yGw},cameraPositionWorld:{value:new d.Pa4},cameraNearFar:{value:new d.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,g)=>{if(!a.defines.SSR_ENABLED)return;const $="#glMarker beforeModulation";a.fragmentShader=a.fragmentShader.replace($,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${$}`)},onObjectRender:(a,h,g)=>{var $,nt,rt,st;let ut=this.enabled&&g.userData.screenSpaceRendering!==!1&&!(!(($=h.materialObject.userData)===null||$===void 0)&&$.ssreflDisabled)?1:0;h.materialObject.defines.SSR_ENABLED!==ut&&(h.materialObject.defines.SSR_ENABLED=ut,h.materialObject.needsUpdate=!0),ut=this.material.defines.SSR_STEP_COUNT,h.materialObject.defines.SSR_STEP_COUNT!==ut&&(h.materialObject.defines.SSR_STEP_COUNT=ut,h.materialObject.needsUpdate=!0),ut=this.material.defines.SSR_LOW_QUALITY_FRAMES,h.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==ut&&(h.materialObject.defines.SSR_LOW_QUALITY_FRAMES=ut,h.materialObject.needsUpdate=!0),ut=this.material.defines.PERSPECTIVE_CAMERA,h.materialObject.defines.PERSPECTIVE_CAMERA!==ut&&(h.materialObject.defines.PERSPECTIVE_CAMERA=ut,h.materialObject.needsUpdate=!0),ut=this.material.defines.SSR_INLINE,h.materialObject.defines.SSR_INLINE!==ut&&(h.materialObject.defines.SSR_INLINE=ut,h.materialObject.needsUpdate=!0),ut=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,h.materialObject.defines.SSR_MASK_FRONT_RAYS!==ut&&(h.materialObject.defines.SSR_MASK_FRONT_RAYS=ut,h.materialObject.needsUpdate=!0),ut=!((nt=h.materialObject.userData)===null||nt===void 0)&&nt.ssreflNonPhysical?"1":"0",h.materialObject.defines.SSR_NON_PHYSICAL!==ut&&(h.materialObject.defines.SSR_NON_PHYSICAL=ut,h.materialObject.needsUpdate=!0),ut=(st=(rt=this._target)===null||rt===void 0?void 0:rt.texture)!==null&&st!==void 0?st:null,this.materialExtension.extraUniforms.tSSRMap.value!==ut&&(this.materialExtension.extraUniforms.tSSRMap.value=ut,h.materialObject.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+$n("tSSRMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)+$n("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,a.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${B1}
    
    #define THREE_PACKING_INCLUDED
    ${qw}
    
    ${bv}
    ${HS}
    ${Hv}
    
    ${O1}
    
    ${WM}
// #endif // SSR_INLINE
#endif
`:"")+`

${L1}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:a=>{var h,g;return this.enabled?"1":"0"+((g=(h=this._target)===null||h===void 0?void 0:h.texture)===null||g===void 0?void 0:g.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssreflDisabled)&&a.isMeshStandardMaterial2}},this.intensity=1,this.boost=new d.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=c,this._target=e,this.needsSwap=!1,this._inline=s}render(c,e,i,s,a){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(c,this._target,i,s,a),this.needsSwap=!1}}};Ev([ls("Intensity",[0,4]),Qn(),pn()],Em.prototype,"intensity",void 0),Ev([Jl("Boost"),Qn(),pn()],Em.prototype,"boost",void 0),Ev([ls("Object Radius",[.01,2]),Qn(),pn()],Em.prototype,"objectRadius",void 0),Ev([rs("Auto radius"),Qn(),pn()],Em.prototype,"autoRadius",void 0),Ev([ls("Power",[0,3]),Qn(),pn()],Em.prototype,"power",void 0),Ev([ls("Tolerance",[.1,5]),Qn(),pn()],Em.prototype,"tolerance",void 0),Ev([ls("Step count",[1,32],1),Qn(),On("SSR_STEP_COUNT")],Em.prototype,"stepCount",void 0),Ev([ls("Low Quality Frames",[0,4],1),Qn(),On("SSR_LOW_QUALITY_FRAMES")],Em.prototype,"lowQualityFrames",void 0),Ev([rs("Ignore front rays"),Qn(),On("SSR_MASK_FRONT_RAYS")],Em.prototype,"maskFrontRays",void 0),Ev([ls("Mask front rays factor",[-1,1],.01,c=>({hidden:()=>!c.maskFrontRays})),Qn(),pn()],Em.prototype,"maskFrontFactor",void 0),Em=Ev([ho("Screen Space Reflections")],Em);class N1 extends Ww{constructor(){super(),this.dependencies=[Jr,El,cp],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,i;return((i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssr)===null||i===void 0)&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}createPasses(e){var i,s;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[zA(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Em(e.renderer,this._ssrTarget,(s=(i=e.getPlugin(El))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",this.inlineSSR)},()=>[e.getPlugin(El),e.getPlugin(cp),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const g=(s=(i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=g.children)===null||a===void 0?void 0:a.map($=>Ht($)))===null||h===void 0||h.flat(2).forEach($=>$&&($.onChange=this.setDirty)),g}}N1.PluginType="SSReflection";var qM=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class F1 extends Au{constructor(e,i,s="rgba"){super({vertexShader:it.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new d.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new d.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,a,h){var g,$,nt,rt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((g=this.uniforms.tDiffuse.value)===null||g===void 0?void 0:g.image.width)||0,(($=this.uniforms.tDiffuse.value)===null||$===void 0?void 0:$.image.height)||0),super.render(e,i,this._target,a,h),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((nt=this.uniforms.tDiffuse.value)===null||nt===void 0?void 0:nt.image.width)||0,((rt=this.uniforms.tDiffuse.value)===null||rt===void 0?void 0:rt.image.height)||0),super.render(e,this._target,i,a,h))}}qM([Qn(),pn()],F1.prototype,"smoothEnabled",void 0),qM([Qn(),pn()],F1.prototype,"edgeSharpness",void 0);var YM=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class WS extends Au{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new d.FM8(512,512)},saoData:{value:new d.Ltg},frameCount:{value:0},cameraNearFar:{value:new d.FM8(.1,1e3)},projection:{value:new d.yGw},saoBiasEpsilon:{value:new d.Pa4(1,1,1)}},vertexShader:xv,fragmentShader:`

${bv}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(a,h,g)=>{a.defines.SSAO_ENABLED&&(a.fragmentShader=a.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(a,h,g)=>{var $,nt;this.materialExtension.extraUniforms.tSSAOMap.value=($=this._target)===null||$===void 0?void 0:$.texture;const rt=h.materialObject,st=!rt.transparent&&rt.transmission<.001;let ut=this.enabled&&st&&g.userData.screenSpaceRendering!==!1&&!(!((nt=h.materialObject.userData)===null||nt===void 0)&&nt.ssaoDisabled)?1:0;rt.defines.SSAO_ENABLED!==ut&&(rt.defines.SSAO_ENABLED=ut,rt.needsUpdate=!0),ut=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==ut&&(this.materialExtension.extraUniforms.tSSAOMap.value=ut,rt.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return zt`
             uniform sampler2D tSSAOMap;
             ${$n("tSSAOMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)}
            ${L1}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:a=>{var h,g;return this.enabled?"1":"0"+((g=(h=this._target)===null||h===void 0?void 0:h.texture)===null||g===void 0?void 0:g.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssaoDisabled)&&a.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new F1(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,a,h){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this._smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}YM([Qn()],WS.prototype,"bilateralPass",void 0),YM([Qn()],WS.prototype,"parameters",void 0);class U1 extends Ww{constructor(){super(),this.dependencies=[Jr,El],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i,s;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[zA(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new WS(e.renderer,this._aoTarget,(s=(i=e.getPlugin(El))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(El)])}},()=>[e.getPlugin(El),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssao)===null||i===void 0)&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const i=this,s=i.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[s,"enabled"],onChange:i.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[s.parameters,"intensity"],onChange:i.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[s.parameters,"occlusionWorldRadius"],onChange:i.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[s.parameters,"bias"],onChange:i.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[s.parameters,"falloff"],onChange:i.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=s.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>s.material.needsUpdate=!0,i.setDirty]},{type:"checkbox",property:[s.bilateralPass,"smoothEnabled"],onChange:i.setDirty},{type:"vec4",property:[s.bilateralPass,"edgeSharpness"],onChange:i.setDirty}]}}}U1.PluginType="SSAO";class XM{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new d.xsS,this._mesh=new d.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new KM}dispose(){this._mesh.material.dispose()}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const a=i==null?void 0:i.split(";").find(nt=>this._normalsCache[nt]);if(a){const nt=this._normalsCache[a];return i==null||i.split(";").forEach(rt=>rt!==a&&(this._normalsCache[rt]=nt)),nt.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=nt,!1}const h=this._renderer.createTargetCustom({width:s,height:s},{minFilter:d.TyD,magFilter:d.TyD,generateMipmaps:!1,type:d.cLu},d.oAp);if(!h)throw"Unable to create render target";i==null||i.split(";").forEach(nt=>this._normalsCache[nt]=h),h.addEventListener("dispose",()=>delete this._normalsCache[i]);const g=new d._am(1e-4,100,h);this._scene.add(g);const $=e.userData._normalsCaptureOffsets;return $.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy($.center),$.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy($.offsetMatrixInv),$.radius!==void 0&&(this._mesh.material.uniforms.radius.value=$.radius),this._mesh.geometry=e,g.update(this._renderer.rendererObject,this._scene),this._scene.remove(g),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=h,!0}}class KM extends d.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:d.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new d.yGw().identity()},offsetCenter:{value:new d.Pa4}}})}}var hP=__webpackgi_require__(654);function $M(c){const e=new d.Pa4(0,0,0),i=new d.Pa4(0,0,0),s=new d.Pa4(0,0,0),a=new d.Pa4(0,0,0),h=c.getAttribute("position"),g=c.index;if(g)for(let mt=Math.max(0,c.drawRange.start),gt=Math.min(g.count,c.drawRange.start+c.drawRange.count)-1;mt<gt/3;mt+=3){const yt=g.getX(mt),wt=g.getX(mt+1),It=g.getX(mt+2);i.set(h.getX(yt),h.getY(yt),h.getZ(yt)),s.set(h.getX(wt),h.getY(wt),h.getZ(wt)),a.set(h.getX(It),h.getY(It),h.getZ(It)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a)}else for(let mt=0;mt<h.count;mt+=3)i.set(h.getX(mt),h.getY(mt),h.getZ(mt)),s.set(h.getX(mt+1),h.getY(mt+1),h.getZ(mt+1)),a.set(h.getX(mt+2),h.getY(mt+2),h.getZ(mt+2)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a);e.normalize();let $=!1,nt=0;for(;!$;){const mt=nt/3,gt=g?g.getX(mt):mt,yt=g?g.getX(mt+1):mt+1;i.set(h.getX(gt),h.getY(gt),h.getZ(gt)),s.set(h.getX(yt),h.getY(yt),h.getZ(yt)),i.sub(s),i.normalize();const wt=e.dot(i);Math.abs(wt-1)>.001&&i.length()>.5&&($=!0),nt+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const rt=new d.yGw;rt.elements[0]=i.x,rt.elements[1]=i.y,rt.elements[2]=i.z,rt.elements[3]=0,rt.elements[4]=e.x,rt.elements[5]=e.y,rt.elements[6]=e.z,rt.elements[7]=0,rt.elements[8]=s.x,rt.elements[9]=s.y,rt.elements[10]=s.z,rt.elements[11]=0,rt.elements[12]=0,rt.elements[13]=0,rt.elements[14]=0,rt.elements[15]=1,c.computeBoundingSphere();const st=c.boundingSphere.radius,ut=new d.yGw().makeScale(st,st,st);return rt.multiply(ut),rt}function JM(c){const e=c.getAttribute("position");if(e.count>0)return $M(c);const i=new d.Pa4(0,0,0),s=new d.Pa4(0,0,0),a=new d.Pa4(0,0,0),h=c.index,g=[];if(h)for(let ut=Math.max(0,c.drawRange.start),mt=Math.min(h.count,c.drawRange.start+c.drawRange.count)-1;ut<mt/3;ut+=3){const gt=h.getX(ut),yt=h.getX(ut+1),wt=h.getX(ut+2);i.set(e.getX(gt),e.getY(gt),e.getZ(gt)),s.set(e.getX(yt),e.getY(yt),e.getZ(yt)),a.set(e.getX(wt),e.getY(wt),e.getZ(wt)),g.push(i.toArray(),s.toArray(),a.toArray())}else for(let ut=0;ut<e.count;ut++)i.set(e.getX(ut),e.getY(ut),e.getZ(ut)),g.push(i.toArray());const $=(0,hP.getEigenVectors)(g),nt=new d.yGw;nt.elements[0]=$[0].vector[0],nt.elements[1]=$[0].vector[1],nt.elements[2]=$[0].vector[2],nt.elements[3]=0,nt.elements[4]=$[1].vector[0],nt.elements[5]=$[1].vector[1],nt.elements[6]=$[1].vector[2],nt.elements[7]=0,nt.elements[8]=$[2].vector[0],nt.elements[9]=$[2].vector[1],nt.elements[10]=$[2].vector[2],nt.elements[11]=0,nt.elements[12]=0,nt.elements[13]=0,nt.elements[14]=0,nt.elements[15]=1,console.log(nt.determinant()),c.computeBoundingSphere();const rt=c.boundingSphere.radius,st=new d.yGw().makeScale(rt,rt,rt);return nt.multiply(st),nt}const ZM={...I_,color:new hs(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new d.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var lm=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Pl extends d.jyz{constructor(e){super({side:d.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new d.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new d.Pa4(1,1,1)}}}),this.typeSlug=Pl.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new hs(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new d.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new d.yGw().identity()},radius:{value:1},centerOffset:{value:new d.Pa4(0,0,0)},offsetMatrix:{value:new d.yGw().identity()},offsetMatrixInv:{value:new d.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.userData.enableLUT=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,a,h){var g,$;super.onBeforeRender(e,i,s,a,h),this.uniforms.envMapRotation.value=((g=this.envMap)===null||g===void 0?void 0:g.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(h.matrixWorld).invert();const nt=a.userData._normalsCaptureOffsets;nt&&(this.extraUniformsToUpload.centerOffset.value.copy(nt.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(nt.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(nt.offsetMatrixInv),this.extraUniformsToUpload.radius.value=nt.radius);const rt=($=a.userData._normalsCaptureMap)===null||$===void 0?void 0:$.texture;this.normalsCaptureMap!==rt&&(this.normalsCaptureMap=rt)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}set envMap(e){var i;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((i=this.__envMap)===null||i===void 0)&&i.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const i={};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=Pl.TYPE,i.userData={},Cl(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...zv(this),{type:"input",label:"Mesh count",get value(){var i,s,a;return(a=(s=(i=e.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0?void 0:s.size)!==null&&a!==void 0?a:0},set value(i){},disabled:!0},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:i=>{this.userData.enableLUT=i||void 0,this.setDirty()}},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{Tu(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Pl.TYPE)return console.warn("Material type is not supported",e),this;const i={};an(e,i,Array.from(Object.keys(ZM)));const s=i.userData;return delete i.userData,this.setValues(i),Cl(this.userData,s),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}Pl.TypeSlug="dmat",Pl.TYPE="DiamondMaterial",lm([cv("Color",{limitedUi:!0}),pn()],Pl.prototype,"color",void 0),lm([ls("Env Intensity",[0,5],.01,{limitedUi:!0}),pn()],Pl.prototype,"envMapIntensity",void 0),lm([ls("Dispersion",[0,.1],1e-4,{limitedUi:!0}),pn({propKey:"rIndexDelta"})],Pl.prototype,"dispersion",void 0),lm([ls("Absorption",[0,15],.01,{limitedUi:!0}),pn()],Pl.prototype,"absorptionFactor",void 0),lm([ls("Refractive Index",[0,4],.01,{limitedUi:!0}),pn()],Pl.prototype,"refractiveIndex",void 0),lm([pn()],Pl.prototype,"squashFactor",void 0),lm([pn()],Pl.prototype,"geometryFactor",void 0),lm([pn()],Pl.prototype,"gammaFactor",void 0),lm([Jl("RGB Boost",void 0,void 0,{limitedUi:!0}),pn()],Pl.prototype,"boostFactors",void 0),lm([ls("Transmission",[0,1],.01,{limitedUi:!0}),pn()],Pl.prototype,"transmission",void 0),lm([ls("Reflectivity",[0,2],.01,{limitedUi:!0}),pn()],Pl.prototype,"reflectivity",void 0),lm([On("RAY_BOUNCES",void 0,!0),ls("Ray Bounces",[1,16],1)],Pl.prototype,"rayBounces",void 0),lm([On("DIA_ORIENT_ENVMAP",void 0,!0),ls("Diamond Oriented Lighting",[0,1],1)],Pl.prototype,"diamondOrientedEnvMap",void 0),lm([pn({propKey:"tCubeMapNormals"})],Pl.prototype,"normalsCaptureMap",void 0);class eT extends _e{constructor(e,i,s,a){super(),this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=a??(h=>h.userData.userSelectable!==!1&&h.userData.bboxVisible!==!1&&h.material!=null&&h.material.type!=="ShadowMaterial"),this.raycaster=new d.iMs,this.mouse=new d.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",h=>this.onPointerMove(h)),this.domElement.addEventListener("pointerleave",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointerout",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointercancel",h=>this.onPointerCancel(h)),this.domElement.addEventListener("pointerenter",h=>this.onPointerEnter(h)),this.domElement.addEventListener("pointerdown",h=>this.onPointerDown(h)),this.domElement.addEventListener("pointerup",h=>this.onPointerUp(h))}get scene(){return this._scene}set scene(e){var i;(i=this._scene)===null||i===void 0||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=po(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var e;const i=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!i)return null;this.raycaster.setFromCamera(this.mouse,i);const s=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0),a=this.selectedObject;if(a){const h=s.length-1-[...s].reverse().findIndex(g=>{let $=g.object;for(;$;){if(g.object===a)return!0;$=$.parent}return!1});h>=0&&s.splice(0,h+1)}if(s.length>0){for(const h of s){let g=h.object;for(;!(g==null||g.visible&&this.selectionCondition(g));)g=g.parent;if(g)return{selectedObject:g,intersect:h,intersects:s,mouse:this.mouse.toArray()}}return null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const jy=new d.iMs,cm=new d.Pa4,V0=new d.Pa4,_c=new d._fP,tT={X:new d.Pa4(1,0,0),Y:new d.Pa4(0,1,0),Z:new d.Pa4(0,0,1)},qS={type:"change"},nT={type:"mouseDown"},rT={type:"mouseUp",mode:null},iT={type:"objectChange"};class dP extends d.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new cT;this._gizmo=s,this.add(s);const a=new fP;this._plane=a,this.add(a);const h=this;function g(Et,Ct){let xt=Ct;Object.defineProperty(h,Et,{get:function(){return xt!==void 0?xt:Ct},set:function(Bt){xt!==Bt&&(xt=Bt,a[Et]=Bt,s[Et]=Bt,h.dispatchEvent({type:Et+"-changed",value:Bt}),h.dispatchEvent(qS))}}),h[Et]=Ct,a[Et]=Ct,s[Et]=Ct}g("camera",e),g("object",void 0),g("enabled",!0),g("axis",null),g("mode","translate"),g("translationSnap",null),g("rotationSnap",null),g("scaleSnap",null),g("space","world"),g("size",1),g("dragging",!1),g("showX",!0),g("showY",!0),g("showZ",!0);const $=new d.Pa4,nt=new d.Pa4,rt=new d._fP,st=new d._fP,ut=new d.Pa4,mt=new d._fP,gt=new d.Pa4,yt=new d.Pa4,wt=new d.Pa4,It=new d.Pa4;g("worldPosition",$),g("worldPositionStart",nt),g("worldQuaternion",rt),g("worldQuaternionStart",st),g("cameraPosition",ut),g("cameraQuaternion",mt),g("pointStart",gt),g("pointEnd",yt),g("rotationAxis",wt),g("rotationAngle",0),g("eye",It),this._offset=new d.Pa4,this._startNorm=new d.Pa4,this._endNorm=new d.Pa4,this._cameraScale=new d.Pa4,this._parentPosition=new d.Pa4,this._parentQuaternion=new d._fP,this._parentQuaternionInv=new d._fP,this._parentScale=new d.Pa4,this._worldScaleStart=new d.Pa4,this._worldQuaternionInv=new d._fP,this._worldScale=new d.Pa4,this._positionStart=new d.Pa4,this._quaternionStart=new d._fP,this._scaleStart=new d.Pa4,this._getPointer=YS.bind(this),this._onPointerDown=pP.bind(this),this._onPointerHover=sT.bind(this),this._onPointerMove=j1.bind(this),this._onPointerUp=oT.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;jy.setFromCamera(e,this.camera);const i=XS(this._gizmo.picker[this.mode],jy);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){jy.setFromCamera(e,this.camera);const i=XS(this._plane,jy,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,nT.mode=this.mode,this.dispatchEvent(nT)}}pointerMove(e){const i=this.axis,s=this.mode,a=this.object;let h=this.space;if(s==="scale"?h="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(h="world"),a===void 0||i===null||this.dragging===!1||e.button!==-1)return;jy.setFromCamera(e,this.camera);const g=XS(this._plane,jy,!0);if(g){if(this.pointEnd.copy(g.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),h==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),h==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),a.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(h==="local"&&(a.position.applyQuaternion(_c.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this._quaternionStart)),h==="world"&&(a.parent&&a.position.add(cm.setFromMatrixPosition(a.parent.matrixWorld)),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(cm.setFromMatrixPosition(a.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let $=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&($*=-1),V0.set($,$,$)}else cm.copy(this.pointStart),V0.copy(this.pointEnd),cm.applyQuaternion(this._worldQuaternionInv),V0.applyQuaternion(this._worldQuaternionInv),V0.divide(cm),i.search("X")===-1&&(V0.x=1),i.search("Y")===-1&&(V0.y=1),i.search("Z")===-1&&(V0.z=1);a.scale.copy(this._scaleStart).multiply(V0),this.scaleSnap&&(i.search("X")!==-1&&(a.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const $=20/this.worldPosition.distanceTo(cm.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(cm.copy(this.rotationAxis).cross(this.eye))*$):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(tT[i]),cm.copy(tT[i]),h==="local"&&cm.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(cm.cross(this.eye).normalize())*$),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),h==="local"&&i!=="E"&&i!=="XYZE"?(a.quaternion.copy(this._quaternionStart),a.quaternion.multiply(_c.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),a.quaternion.copy(_c.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(qS),this.dispatchEvent(iT)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(rT.mode=this.mode,this.dispatchEvent(rT)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(qS),this.dispatchEvent(iT),this.pointStart.copy(this.pointEnd))}getRaycaster(){return jy}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function YS(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function sT(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c))}}function pP(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function j1(c){this.enabled&&this.pointerMove(this._getPointer(c))}function oT(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function XS(c,e,i){const s=e.intersectObject(c,!0);for(let a=0;a<s.length;a++)if(s[a].object.visible||i)return s[a];return!1}const Yw=new d.USm,Dl=new d.Pa4(0,1,0),aT=new d.Pa4(0,0,0),lT=new d.yGw,z1=new d._fP,Q0=new d._fP,Sv=new d.Pa4,KS=new d.yGw,Xw=new d.Pa4(1,0,0),H_=new d.Pa4(0,1,0),Kw=new d.Pa4(0,0,1),V1=new d.Pa4,QA=new d.Pa4,$w=new d.Pa4;class cT extends d.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new d.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new d.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const a=i.clone();a.opacity=.5;const h=e.clone();h.color.setHex(16711680);const g=e.clone();g.color.setHex(65280);const $=e.clone();$.color.setHex(255);const nt=e.clone();nt.color.setHex(16711680),nt.opacity=.5;const rt=e.clone();rt.color.setHex(65280),rt.opacity=.5;const st=e.clone();st.color.setHex(255),st.opacity=.5;const ut=e.clone();ut.opacity=.25;const mt=e.clone();mt.color.setHex(16776960),mt.opacity=.25,e.clone().color.setHex(16776960);const gt=e.clone();gt.color.setHex(7895160);const yt=new d.fHI(0,.04,.1,12);yt.translate(0,.05,0);const wt=new d.DvJ(.08,.08,.08);wt.translate(0,.04,0);const It=new d.u9r;It.setAttribute("position",new d.a$l([0,0,0,1,0,0],3));const Et=new d.fHI(.0075,.0075,.5,3);function Ct(Dn,En){const Tn=new d.XvJ(Dn,.0075,3,64,En*Math.PI*2);return Tn.rotateY(Math.PI/2),Tn.rotateX(Math.PI/2),Tn}Et.translate(0,.25,0);const xt={X:[[new d.Kj0(yt,h),[.5,0,0],[0,0,-Math.PI/2]],[new d.Kj0(yt,h),[-.5,0,0],[0,0,Math.PI/2]],[new d.Kj0(Et,h),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new d.Kj0(yt,g),[0,.5,0]],[new d.Kj0(yt,g),[0,-.5,0],[Math.PI,0,0]],[new d.Kj0(Et,g)]],Z:[[new d.Kj0(yt,$),[0,0,.5],[Math.PI/2,0,0]],[new d.Kj0(yt,$),[0,0,-.5],[-Math.PI/2,0,0]],[new d.Kj0(Et,$),null,[Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.pQR(.1,0),ut.clone()),[0,0,0]]],XY:[[new d.Kj0(new d.DvJ(.15,.15,.01),st.clone()),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),nt.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),rt.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Bt={X:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,.3,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.pQR(.2,0),s)]],XY:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},Lt={START:[[new d.Kj0(new d.pQR(.01,2),a),null,null,null,"helper"]],END:[[new d.Kj0(new d.pQR(.01,2),a),null,null,null,"helper"]],DELTA:[[new d.x12(function(){const Dn=new d.u9r;return Dn.setAttribute("position",new d.a$l([0,0,0,1,1,1],3)),Dn}(),a),null,null,null,"helper"]],X:[[new d.x12(It,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new d.x12(It,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new d.x12(It,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Gt={XYZE:[[new d.Kj0(Ct(.5,1),gt),null,[0,Math.PI/2,0]]],X:[[new d.Kj0(Ct(.5,.5),h)]],Y:[[new d.Kj0(Ct(.5,.5),g),null,[0,0,-Math.PI/2]]],Z:[[new d.Kj0(Ct(.5,.5),$),null,[0,Math.PI/2,0]]],E:[[new d.Kj0(Ct(.75,1),mt),null,[0,Math.PI/2,0]]]},Xt={AXIS:[[new d.x12(It,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},rn={XYZE:[[new d.Kj0(new d.xo$(.25,10,8),s)]],X:[[new d.Kj0(new d.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new d.Kj0(new d.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new d.Kj0(new d.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new d.Kj0(new d.XvJ(.75,.1,2,24),s)]]},fn={X:[[new d.Kj0(wt,h),[.5,0,0],[0,0,-Math.PI/2]],[new d.Kj0(Et,h),[0,0,0],[0,0,-Math.PI/2]],[new d.Kj0(wt,h),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new d.Kj0(wt,g),[0,.5,0]],[new d.Kj0(Et,g)],[new d.Kj0(wt,g),[0,-.5,0],[0,0,Math.PI]]],Z:[[new d.Kj0(wt,$),[0,0,.5],[Math.PI/2,0,0]],[new d.Kj0(Et,$),[0,0,0],[Math.PI/2,0,0]],[new d.Kj0(wt,$),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new d.Kj0(new d.DvJ(.15,.15,.01),st),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),nt),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),rt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.DvJ(.1,.1,.1),ut.clone())]]},wn={X:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,.3,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.DvJ(.2,.2,.2),s),[0,0,0]]]},Cn={X:[[new d.x12(It,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new d.x12(It,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new d.x12(It,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function bn(Dn){const En=new d.Tme;for(const Tn in Dn)for(let Un=Dn[Tn].length;Un--;){const Pn=Dn[Tn][Un][0].clone(),Yn=Dn[Tn][Un][1],cr=Dn[Tn][Un][2],mr=Dn[Tn][Un][3],ir=Dn[Tn][Un][4];Pn.name=Tn,Pn.tag=ir,Yn&&Pn.position.set(Yn[0],Yn[1],Yn[2]),cr&&Pn.rotation.set(cr[0],cr[1],cr[2]),mr&&Pn.scale.set(mr[0],mr[1],mr[2]),Pn.updateMatrix();const Dr=Pn.geometry.clone();Dr.applyMatrix4(Pn.matrix),Pn.geometry=Dr,Pn.renderOrder=1/0,Pn.position.set(0,0,0),Pn.rotation.set(0,0,0),Pn.scale.set(1,1,1),En.add(Pn)}return En}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=bn(xt)),this.add(this.gizmo.rotate=bn(Gt)),this.add(this.gizmo.scale=bn(fn)),this.add(this.picker.translate=bn(Bt)),this.add(this.picker.rotate=bn(rn)),this.add(this.picker.scale=bn(wn)),this.add(this.helper.translate=bn(Lt)),this.add(this.helper.rotate=bn(Xt)),this.add(this.helper.scale=bn(Cn)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Q0;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const h=s[a];let g;h.visible=!0,h.rotation.set(0,0,0),h.position.copy(this.worldPosition),g=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),h.scale.set(1,1,1).multiplyScalar(g*this.size/4),h.tag!=="helper"?(h.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(h.name==="X"&&Math.abs(Dl.copy(Xw).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Y"&&Math.abs(Dl.copy(H_).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Z"&&Math.abs(Dl.copy(Kw).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XY"&&Math.abs(Dl.copy(Kw).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="YZ"&&Math.abs(Dl.copy(Xw).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XZ"&&Math.abs(Dl.copy(H_).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1)):this.mode==="rotate"&&(z1.copy(i),Dl.copy(this.eye).applyQuaternion(_c.copy(i).invert()),h.name.search("E")!==-1&&h.quaternion.setFromRotationMatrix(lT.lookAt(this.eye,aT,H_)),h.name==="X"&&(_c.setFromAxisAngle(Xw,Math.atan2(-Dl.y,Dl.z)),_c.multiplyQuaternions(z1,_c),h.quaternion.copy(_c)),h.name==="Y"&&(_c.setFromAxisAngle(H_,Math.atan2(Dl.x,Dl.z)),_c.multiplyQuaternions(z1,_c),h.quaternion.copy(_c)),h.name==="Z"&&(_c.setFromAxisAngle(Kw,Math.atan2(Dl.y,Dl.x)),_c.multiplyQuaternions(z1,_c),h.quaternion.copy(_c))),h.visible=h.visible&&(h.name.indexOf("X")===-1||this.showX),h.visible=h.visible&&(h.name.indexOf("Y")===-1||this.showY),h.visible=h.visible&&(h.name.indexOf("Z")===-1||this.showZ),h.visible=h.visible&&(h.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),h.material._color=h.material._color||h.material.color.clone(),h.material._opacity=h.material._opacity||h.material.opacity,h.material.color.copy(h.material._color),h.material.opacity=h.material._opacity,this.enabled&&this.axis&&(h.name===this.axis||this.axis.split("").some(function($){return h.name===$}))&&(h.material.color.setHex(16776960),h.material.opacity=1)):(h.visible=!1,h.name==="AXIS"?(h.position.copy(this.worldPositionStart),h.visible=!!this.axis,this.axis==="X"&&(_c.setFromEuler(Yw.set(0,0,0)),h.quaternion.copy(i).multiply(_c),Math.abs(Dl.copy(Xw).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Y"&&(_c.setFromEuler(Yw.set(0,0,Math.PI/2)),h.quaternion.copy(i).multiply(_c),Math.abs(Dl.copy(H_).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Z"&&(_c.setFromEuler(Yw.set(0,Math.PI/2,0)),h.quaternion.copy(i).multiply(_c),Math.abs(Dl.copy(Kw).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="XYZE"&&(_c.setFromEuler(Yw.set(0,Math.PI/2,0)),Dl.copy(this.rotationAxis),h.quaternion.setFromRotationMatrix(lT.lookAt(aT,Dl,H_)),h.quaternion.multiply(_c),h.visible=this.dragging),this.axis==="E"&&(h.visible=!1)):h.name==="START"?(h.position.copy(this.worldPositionStart),h.visible=this.dragging):h.name==="END"?(h.position.copy(this.worldPosition),h.visible=this.dragging):h.name==="DELTA"?(h.position.copy(this.worldPositionStart),h.quaternion.copy(this.worldQuaternionStart),cm.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),cm.applyQuaternion(this.worldQuaternionStart.clone().invert()),h.scale.copy(cm),h.visible=this.dragging):(h.quaternion.copy(i),this.dragging?h.position.copy(this.worldPositionStart):h.position.copy(this.worldPosition),this.axis&&(h.visible=this.axis.search(h.name)!==-1)))}super.updateMatrixWorld(e)}}class fP extends d.Kj0{constructor(){super(new d._12(1e5,1e5,2,2),new d.vBJ({visible:!1,wireframe:!0,side:d.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),V1.copy(Xw).applyQuaternion(i==="local"?this.worldQuaternion:Q0),QA.copy(H_).applyQuaternion(i==="local"?this.worldQuaternion:Q0),$w.copy(Kw).applyQuaternion(i==="local"?this.worldQuaternion:Q0),Dl.copy(QA),this.mode){case"translate":case"scale":switch(this.axis){case"X":Dl.copy(this.eye).cross(V1),Sv.copy(V1).cross(Dl);break;case"Y":Dl.copy(this.eye).cross(QA),Sv.copy(QA).cross(Dl);break;case"Z":Dl.copy(this.eye).cross($w),Sv.copy($w).cross(Dl);break;case"XY":Sv.copy($w);break;case"YZ":Sv.copy(V1);break;case"XZ":Dl.copy($w),Sv.copy(QA);break;case"XYZ":case"E":Sv.set(0,0,0)}break;default:Sv.set(0,0,0)}Sv.length()===0?this.quaternion.copy(this.cameraQuaternion):(KS.lookAt(cm.set(0,0,0),Sv,Dl),this.quaternion.setFromRotationMatrix(KS)),super.updateMatrixWorld(e)}}const uT=new d.ZzF,Q1=new d.Pa4;class hT extends d.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new d.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new d.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new d.$TI(i,6,1);return this.setAttribute("instanceStart",new d.kB5(s,3,0)),this.setAttribute("instanceEnd",new d.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new d.$TI(i,6,1);return this.setAttribute("instanceColorStart",new d.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new d.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new d.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new d.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),uT.setFromBufferAttribute(i),this.boundingBox.union(uT))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new d.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let a=0;for(let h=0,g=e.count;h<g;h++)Q1.fromBufferAttribute(e,h),a=Math.max(a,s.distanceToSquared(Q1)),Q1.fromBufferAttribute(i,h),a=Math.max(a,s.distanceToSquared(Q1));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class mP extends hT{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new d.Uk6(e))}}d.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new d.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},d.Vj0.line={uniforms:d.rDY.merge([d.rBU.common,d.rBU.fog,d.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class dT extends d.jyz{constructor(e){super({type:"LineMaterial",uniforms:d.rDY.clone(d.Vj0.line.uniforms),vertexShader:d.Vj0.line.vertexShader,fragmentShader:d.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(i){Boolean(i)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(i){Boolean(i)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const pT=new d.Pa4,$S=new d.Pa4;class fT extends d.Kj0{constructor(e=new hT,i=new dT({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,a=new Float32Array(2*i.count);for(let g=0,$=0,nt=i.count;g<nt;g++,$+=2)pT.fromBufferAttribute(i,g),$S.fromBufferAttribute(s,g),a[$]=$===0?0:a[$-1],a[$+1]=a[$]+pT.distanceTo($S);const h=new d.$TI(a,2,1);return e.setAttribute("instanceDistanceStart",new d.kB5(h,1,0)),e.setAttribute("instanceDistanceEnd",new d.kB5(h,1,1)),this}}class JS extends d.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const i=new ar().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new d.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const i=new mP(e);this._geometry=i;const s=new dT({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new d.FM8(1024,1024),dashed:!1,toneMapped:!1}),a=new fT(i,s);a.computeLineDistances(),a.scale.set(1,1,1),a.visible=!0,this.add(a)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)===null||i===void 0||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class ZS extends JS{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new d.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new ar().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var Jw=function(c){return function(e){return 1-c(1-e)}},G1=function(c){return function(e){return e<=.5?c(2*e)/2:(2-c(2*(1-e)))/2}},mT=function(c){return function(e){return Math.pow(e,c)}},H1=function(c){return function(e){return e*e*((c+1)*e-c)}},gT=function(c){var e=H1(c);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},Zw=function(c){return c},GA=mT(2),vT=Jw(GA),eC=G1(GA),tC=function(c){return 1-Math.sin(Math.acos(c))},W1=Jw(tC),nC=G1(W1),W_=H1(1.525),_T=Jw(W_),q1=G1(W_),rC=gT(1.525),ex=function(c){if(c===1||c===0)return c;var e=c*c;return c<.36363636363636365?7.5625*e:c<.7272727272727273?9.075*e-9.9*c+3.4:c<.9?12.066481994459833*e-19.63545706371191*c+8.898060941828255:10.8*c*c-20.52*c+10.72},yT=Jw(ex),AT=function(c){return c<.5?.5*(1-ex(1-2*c)):.5*ex(2*c-1)+.5},su=function(){return su=Object.assign||function(c){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(c[a]=e[a]);return c},su.apply(this,arguments)};function iC(c,e){var i={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&e.indexOf(s)<0&&(i[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(s=Object.getOwnPropertySymbols(c);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(c,s[a])&&(i[s[a]]=c[s[a]])}return i}var G0=function(c,e,i){return Math.min(Math.max(i,c),e)};function HA(c,e){return c*Math.sqrt(1-e*e)}var wT=["duration","bounce"],Y1=["stiffness","damping","mass"];function Sp(c,e){return e.some(function(i){return c[i]!==void 0})}function r_(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.restSpeed,g=h===void 0?2:h,$=c.restDelta,nt=iC(c,["from","to","restSpeed","restDelta"]),rt={done:!1,value:i},st=function(Bt){var Lt=su({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Bt);if(!Sp(Bt,Y1)&&Sp(Bt,wT)){var Gt=function(Xt){var rn,fn,wn=Xt.duration,Cn=wn===void 0?800:wn,bn=Xt.bounce,Dn=bn===void 0?.25:bn,En=Xt.velocity,Tn=En===void 0?0:En,Un=Xt.mass,Pn=Un===void 0?1:Un,Yn=1-Dn;Yn=G0(.05,1,Yn),Cn=G0(.01,10,Cn/1e3),Yn<1?(rn=function(ir){var Dr=ir*Yn,Nr=Dr*Cn;return .001-(Dr-Tn)/HA(ir,Yn)*Math.exp(-Nr)},fn=function(ir){var Dr=ir*Yn*Cn,Nr=Dr*Tn+Tn,Fr=Math.pow(Yn,2)*Math.pow(ir,2)*Cn,Vr=Math.exp(-Dr),ps=HA(Math.pow(ir,2),Yn);return(.001-rn(ir)>0?-1:1)*((Nr-Fr)*Vr)/ps}):(rn=function(ir){return Math.exp(-ir*Cn)*((ir-Tn)*Cn+1)-.001},fn=function(ir){return Math.exp(-ir*Cn)*(Cn*Cn*(Tn-ir))});var cr=function(ir,Dr,Nr){for(var Fr=Nr,Vr=1;Vr<12;Vr++)Fr-=ir(Fr)/Dr(Fr);return Fr}(rn,fn,5/Cn);if(Cn*=1e3,isNaN(cr))return{stiffness:100,damping:10,duration:Cn};var mr=Math.pow(cr,2)*Pn;return{stiffness:mr,damping:2*Yn*Math.sqrt(Pn*mr),duration:Cn}}(Bt);(Lt=su(su(su({},Lt),Gt),{velocity:0,mass:1})).isResolvedFromDuration=!0}return Lt}(nt),ut=st.stiffness,mt=st.damping,gt=st.mass,yt=st.velocity,wt=st.duration,It=st.isResolvedFromDuration,Et=X1,Ct=X1;function xt(){var Bt=yt?-yt/1e3:0,Lt=a-i,Gt=mt/(2*Math.sqrt(ut*gt)),Xt=Math.sqrt(ut/gt)/1e3;if($!=null||($=Math.abs(a-i)<=1?.01:.4),Gt<1){var rn=HA(Xt,Gt);Et=function(wn){var Cn=Math.exp(-Gt*Xt*wn);return a-Cn*((Bt+Gt*Xt*Lt)/rn*Math.sin(rn*wn)+Lt*Math.cos(rn*wn))},Ct=function(wn){var Cn=Math.exp(-Gt*Xt*wn);return Gt*Xt*Cn*(Math.sin(rn*wn)*(Bt+Gt*Xt*Lt)/rn+Lt*Math.cos(rn*wn))-Cn*(Math.cos(rn*wn)*(Bt+Gt*Xt*Lt)-rn*Lt*Math.sin(rn*wn))}}else if(Gt===1)Et=function(wn){return a-Math.exp(-Xt*wn)*(Lt+(Bt+Xt*Lt)*wn)};else{var fn=Xt*Math.sqrt(Gt*Gt-1);Et=function(wn){var Cn=Math.exp(-Gt*Xt*wn),bn=Math.min(fn*wn,300);return a-Cn*((Bt+Gt*Xt*Lt)*Math.sinh(bn)+fn*Lt*Math.cosh(bn))/fn}}}return xt(),{next:function(Bt){var Lt=Et(Bt);if(It)rt.done=Bt>=wt;else{var Gt=1e3*Ct(Bt),Xt=Math.abs(Gt)<=g,rn=Math.abs(a-Lt)<=$;rt.done=Xt&&rn}return rt.value=rt.done?a:Lt,rt},flipTarget:function(){var Bt;yt=-yt,i=(Bt=[a,i])[0],a=Bt[1],xt()}}}r_.needsInterpolation=function(c,e){return typeof c=="string"||typeof e=="string"};var X1=function(c){return 0},H0=function(c,e,i){var s=e-c;return s===0?1:(i-c)/s},q_=function(c,e,i){return-i*c+i*e+c},zy=function(c,e){return function(i){return Math.max(Math.min(i,e),c)}},i_=function(c){return c%1?Number(c.toFixed(5)):c},Y_=/(-)?([\d]*\.?[\d])+/g,Vy=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,xT=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function W0(c){return typeof c=="string"}var q0={test:function(c){return typeof c=="number"},parse:parseFloat,transform:function(c){return c}},tx=su(su({},q0),{transform:zy(0,1)}),K1=(su(su({},q0),{default:1}),function(c,e){return function(i){return Boolean(W0(i)&&xT.test(i)&&i.startsWith(c)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),$1=function(c,e,i){return function(s){var a;if(!W0(s))return s;var h=s.match(Y_),g=h[0],$=h[1],nt=h[2],rt=h[3];return(a={})[c]=parseFloat(g),a[e]=parseFloat($),a[i]=parseFloat(nt),a.alpha=rt!==void 0?parseFloat(rt):1,a}},bT=zy(0,255),J1=su(su({},q0),{transform:function(c){return Math.round(bT(c))}}),X_={test:K1("rgb","red"),parse:$1("red","green","blue"),transform:function(c){var e=c.red,i=c.green,s=c.blue,a=c.alpha,h=a===void 0?1:a;return"rgba("+J1.transform(e)+", "+J1.transform(i)+", "+J1.transform(s)+", "+i_(tx.transform(h))+")"}},WA={test:K1("#"),parse:function(c){var e="",i="",s="",a="";return c.length>5?(e=c.substr(1,2),i=c.substr(3,2),s=c.substr(5,2),a=c.substr(7,2)):(e=c.substr(1,1),i=c.substr(2,1),s=c.substr(3,1),a=c.substr(4,1),e+=e,i+=i,s+=s,a+=a),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:a?parseInt(a,16)/255:1}},transform:X_.transform},ET=function(c){return{test:function(e){return W0(e)&&e.endsWith(c)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+c}}},qA=ET("%"),Qy=(su(su({},qA),{parse:function(c){return qA.parse(c)/100},transform:function(c){return qA.transform(100*c)}}),{test:K1("hsl","hue"),parse:$1("hue","saturation","lightness"),transform:function(c){var e=c.hue,i=c.saturation,s=c.lightness,a=c.alpha,h=a===void 0?1:a;return"hsla("+Math.round(e)+", "+qA.transform(i_(i))+", "+qA.transform(i_(s))+", "+i_(tx.transform(h))+")"}}),ST=function(c,e,i){var s=c*c,a=e*e;return Math.sqrt(Math.max(0,i*(a-s)+s))},CT=[WA,X_,Qy],MT=function(c){return CT.find(function(e){return e.test(c)})},Z1=function(c,e){var i=MT(c),s=MT(e);i.transform,s.transform;var a=i.parse(c),h=s.parse(e),g=su({},a),$=i===Qy?q_:ST;return function(nt){for(var rt in g)rt!=="alpha"&&(g[rt]=$(a[rt],h[rt],nt));return g.alpha=q_(a.alpha,h.alpha,nt),i.transform(g)}},sC=function(c){return X_.test(c)||WA.test(c)||Qy.test(c)},oC=function(c){return X_.test(c)?X_.parse(c):Qy.test(c)?Qy.parse(c):WA.parse(c)},YA=function(c){return W0(c)?c:c.hasOwnProperty("red")?X_.transform(c):Qy.transform(c)},aC="${c}",TT="${n}";function nx(c){var e=[],i=0,s=c.match(Vy);s&&(i=s.length,c=c.replace(Vy,aC),e.push.apply(e,s.map(oC)));var a=c.match(Y_);return a&&(c=c.replace(Y_,TT),e.push.apply(e,a.map(q0.parse))),{values:e,numColors:i,tokenised:c}}function Gy(c){return nx(c).values}function lC(c){var e=nx(c),i=e.values,s=e.numColors,a=e.tokenised,h=i.length;return function(g){for(var $=a,nt=0;nt<h;nt++)$=$.replace(nt<s?aC:TT,nt<s?YA(g[nt]):i_(g[nt]));return $}}var IT=function(c){return typeof c=="number"?0:c},rx={test:function(c){var e,i,s,a;return isNaN(c)&&W0(c)&&((i=(e=c.match(Y_))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((a=(s=c.match(Vy))===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0)>0},parse:Gy,createTransformer:lC,getAnimatableNone:function(c){var e=Gy(c);return lC(c)(e.map(IT))}},ix={x:0,y:0,z:0},eE=function(c){return typeof c=="number"},Lp=function(c,e){return function(i){return e(c(i))}},tE=function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return c.reduce(Lp)};function cC(c,e){return eE(c)?function(i){return q_(c,e,i)}:sC(c)?Z1(c,e):s_(c,e)}var uC=function(c,e){var i=function(h,g){for(var $=0,nt=g.length,rt=h.length;$<nt;$++,rt++)h[rt]=g[$];return h}([],c),s=i.length,a=c.map(function(h,g){return cC(h,e[g])});return function(h){for(var g=0;g<s;g++)i[g]=a[g](h);return i}},hC=function(c,e){var i=su(su({},c),e),s={};for(var a in i)c[a]!==void 0&&e[a]!==void 0&&(s[a]=cC(c[a],e[a]));return function(h){for(var g in s)i[g]=s[g](h);return i}};function sx(c){for(var e=rx.parse(c),i=e.length,s=0,a=0,h=0,g=0;g<i;g++)s||typeof e[g]=="number"?s++:e[g].hue!==void 0?h++:a++;return{parsed:e,numNumbers:s,numRGB:a,numHSL:h}}var s_=function(c,e){var i=rx.createTransformer(e),s=sx(c),a=sx(e);return tE(uC(s.parsed,a.parsed),i)},PT=function(c,e){return function(i){return q_(c,e,i)}};function nE(c,e,i){var s=i===void 0?{}:i,a=s.clamp,h=a===void 0||a,g=s.ease,$=s.mixer,nt=c.length;e.length,!g||!Array.isArray(g)||g.length,c[0]>c[nt-1]&&(c=[].concat(c),e=[].concat(e),c.reverse(),e.reverse());var rt=function(ut,mt,gt){for(var yt=[],wt=gt||(typeof(Bt=ut[0])=="number"?PT:typeof Bt=="string"?sC(Bt)?Z1:s_:Array.isArray(Bt)?uC:typeof Bt=="object"?hC:void 0),It=ut.length-1,Et=0;Et<It;Et++){var Ct=wt(ut[Et],ut[Et+1]);if(mt){var xt=Array.isArray(mt)?mt[Et]:mt;Ct=tE(xt,Ct)}yt.push(Ct)}var Bt;return yt}(e,g,$),st=nt===2?function(ut,mt){var gt=ut[0],yt=ut[1],wt=mt[0];return function(It){return wt(H0(gt,yt,It))}}(c,rt):function(ut,mt){var gt=ut.length,yt=gt-1;return function(wt){var It=0,Et=!1;if(wt<=ut[0]?Et=!0:wt>=ut[yt]&&(It=yt-1,Et=!0),!Et){for(var Ct=1;Ct<gt&&!(ut[Ct]>wt||Ct===yt);Ct++);It=Ct-1}var xt=H0(ut[It],ut[It+1],wt);return mt[It](xt)}}(c,rt);return h?function(ut){return st(G0(c[0],c[nt-1],ut))}:st}function o_(c,e){return c.map(function(){return e||eC}).splice(0,c.length-1)}function XA(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.ease,g=c.offset,$=c.duration,nt=$===void 0?300:$,rt={done:!1,value:i},st=Array.isArray(a)?a:[i,a],ut=function(yt,wt){return yt.map(function(It){return It*wt})}(g&&g.length===st.length?g:function(yt){var wt=yt.length;return yt.map(function(It,Et){return Et!==0?Et/(wt-1):0})}(st),nt);function mt(){return nE(ut,st,{ease:Array.isArray(h)?h:o_(st,h)})}var gt=mt();return{next:function(yt){return rt.value=gt(yt),rt.done=yt>=nt,rt},flipTarget:function(){st.reverse(),gt=mt()}}}function rE(c){var e=c.velocity,i=e===void 0?0:e,s=c.from,a=s===void 0?0:s,h=c.power,g=h===void 0?.8:h,$=c.timeConstant,nt=$===void 0?350:$,rt=c.restDelta,st=rt===void 0?.5:rt,ut=c.modifyTarget,mt={done:!1,value:a},gt=g*i,yt=a+gt,wt=ut===void 0?yt:ut(yt);return wt!==yt&&(gt=wt-a),{next:function(It){var Et=-gt*Math.exp(-It/nt);return mt.done=!(Et>st||Et<-st),mt.value=mt.done?wt:wt+Et,mt},flipTarget:function(){}}}var dC={keyframes:XA,spring:r_,decay:rE},iE=1/60*1e3,sE=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},ox=typeof window<"u"?function(c){return window.requestAnimationFrame(c)}:function(c){return setTimeout(function(){return c(sE())},iE)},oE=!0,KA=!1,pC=!1,ax={delta:0,timestamp:0},lx=["read","update","preRender","render","postRender"],fC=lx.reduce(function(c,e){return c[e]=function(i){var s=[],a=[],h=0,g=!1,$=new WeakSet,nt={schedule:function(rt,st,ut){st===void 0&&(st=!1),ut===void 0&&(ut=!1);var mt=ut&&g,gt=mt?s:a;return st&&$.add(rt),gt.indexOf(rt)===-1&&(gt.push(rt),mt&&g&&(h=s.length)),rt},cancel:function(rt){var st=a.indexOf(rt);st!==-1&&a.splice(st,1),$.delete(rt)},process:function(rt){var st;if(g=!0,s=(st=[a,s])[0],(a=st[1]).length=0,h=s.length)for(var ut=0;ut<h;ut++){var mt=s[ut];mt(rt),$.has(mt)&&(nt.schedule(mt),i())}g=!1}};return nt}(function(){return KA=!0}),c},{}),Cv=lx.reduce(function(c,e){var i=fC[e];return c[e]=function(s,a,h){return a===void 0&&(a=!1),h===void 0&&(h=!1),KA||cE(),i.schedule(s,a,h)},c},{}),aE=lx.reduce(function(c,e){return c[e]=fC[e].cancel,c},{}),DT=function(c){return fC[c].process(ax)},lE=function(c){KA=!1,ax.delta=oE?iE:Math.max(Math.min(c-ax.timestamp,40),1),ax.timestamp=c,pC=!0,lx.forEach(DT),pC=!1,KA&&(oE=!1,ox(lE))},cE=function(){KA=!0,oE=!0,pC||ox(lE)},uE=function(){return ax},mC=Cv;function hE(c,e,i){return i===void 0&&(i=0),c-e-i}var RT=function(c){var e=function(i){var s=i.delta;return c(s)};return{start:function(){return mC.update(e,!0)},stop:function(){return aE.update(e)}}};function $A(c){var e,i,s,a,h,g=c.from,$=c.autoplay,nt=$===void 0||$,rt=c.driver,st=rt===void 0?RT:rt,ut=c.elapsed,mt=ut===void 0?0:ut,gt=c.repeat,yt=gt===void 0?0:gt,wt=c.repeatType,It=wt===void 0?"loop":wt,Et=c.repeatDelay,Ct=Et===void 0?0:Et,xt=c.onPlay,Bt=c.onStop,Lt=c.onComplete,Gt=c.onRepeat,Xt=c.onUpdate,rn=iC(c,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),fn=rn.to,wn=0,Cn=rn.duration,bn=!1,Dn=!0,En=function(Un){if(Array.isArray(Un.to))return XA;if(dC[Un.type])return dC[Un.type];var Pn=new Set(Object.keys(Un));return Pn.has("ease")||Pn.has("duration")&&!Pn.has("dampingRatio")?XA:Pn.has("dampingRatio")||Pn.has("stiffness")||Pn.has("mass")||Pn.has("damping")||Pn.has("restSpeed")||Pn.has("restDelta")?r_:XA}(rn);!((i=(e=En).needsInterpolation)===null||i===void 0)&&i.call(e,g,fn)&&(h=nE([0,100],[g,fn],{clamp:!1}),g=0,fn=100);var Tn=En(su(su({},rn),{from:g,to:fn}));return nt&&(xt==null||xt(),(s=st(function(Un){if(Dn||(Un=-Un),mt+=Un,!bn){var Pn=Tn.next(Math.max(0,mt));a=Pn.value,h&&(a=h(a)),bn=Dn?Pn.done:mt<=0}Xt==null||Xt(a),bn&&(wn===0&&(Cn!=null||(Cn=mt)),wn<yt?function(Yn,cr,mr,ir){return ir?Yn>=cr+mr:Yn<=-mr}(mt,Cn,Ct,Dn)&&(wn++,It==="reverse"?mt=function(Yn,cr,mr,ir){return mr===void 0&&(mr=0),ir===void 0&&(ir=!0),ir?hE(cr+-Yn,cr,mr):cr-(Yn-cr)+mr}(mt,Cn,Ct,Dn=wn%2==0):(mt=hE(mt,Cn,Ct),It==="mirror"&&Tn.flipTarget()),bn=!1,Gt&&Gt()):(s.stop(),Lt&&Lt()))})).start()),{stop:function(){Bt==null||Bt(),s.stop()}}}const Hy={linear:Zw,easeIn:GA,easeOut:vT,easeInOut:eC,circIn:tC,circOut:W1,circInOut:nC,backIn:W_,backOut:_T,backInOut:q1,anticipate:rC,bounceOut:ex,bounceIn:yT,bounceInOut:AT,easeInOutSine:function(c){return-(Math.cos(Math.PI*c)-1)/2}};async function ou(c){return new Promise(e=>setTimeout(e,Math.max(0,c)))}function cx(c,e,i){const s=c[e],a=()=>{typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?h=>{s.copy(h),a()}:h=>{c[e]=h,a()}}function gC(c){return typeof c!="boolean"}async function ux(c,e,i){e in c||console.error("invalid key",e,c);const s=cx(c,e),a=c[e],h=g=>{var $;s(g),($=i.onUpdate)===null||$===void 0||$.call(i,g)};if(gC(a))return typeof i.to=="function"&&(i={...i,to:i.to(a,c)}),vC({...i,from:a,onUpdate:h});{const{duration:g}=i;return ou(g??0).then(()=>h(i.to))}}async function vC(c){return new Promise((e,i)=>{$A({onComplete:()=>{var s;(s=c.onComplete)===null||s===void 0||s.call(c),e()},onStop:()=>{var s;(s=c.onStop)===null||s===void 0||s.call(c),e()},...c})})}class K_ extends Av{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[cp],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(!s)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==s)return void(this.pointerEnabled=!0);const a=s.getBoundingClientRect(),h=(e.clientX-a.left)/a.width,g=(e.clientY-a.top)/a.height;this.pointerEnabled=h<0||h>1||g<0||g>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:d.wem,magFilter:d.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await ou(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(cp),a=new class extends QS{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=w_("Frame Fade",this)}render(h,g,$,nt,rt){this.needsSwap=!1;const st=i._target;if(!st||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,st),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=st==null?void 0:st.texture;const ut=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(ut),this.weights2.w=1,this.weights1.setScalar(1-ut),this.weights1.w=1,super.render(h,g,$,nt,rt),this.needsSwap=!0;const mt=po();this._lastTime<10&&(this._lastTime=mt-10);const gt=mt-this._lastTime;this._lastTime=mt,i._fadeTimeState-=gt}};return a.enabled=!0,a}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}K_.PluginType="FrameFade";var dE=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g},_C=d.M8C.degToRad;class jo extends Ks{constructor(e=ZS,i=!1,s=!0,a=!1){super(),this.enabled=!0,this.autoFocus=!1,this._onObjectHit=h=>{this._viewer&&(this.enabled?this.dispatchEvent(h):h.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const h=this.getSelectedObject();this.autoFocus&&h&&this.setSelectedObject(h,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=a}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new eT(e.scene,e.canvas,void 0,i=>{var s,a;if(!i.material)return!1;let h=i,g=!1;for(;h;){if(!h.visible||(((s=h.userData.iModel)!==null&&s!==void 0?s:h).assetType==="model"&&(g=!0),((a=h.userData.iModel)!==null&&a!==void 0?a:h).assetType==="widget")||h.userData.userSelectable===!1||h.userData.bboxVisible===!1)return!1;h=h.parent}return g}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new yC(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var s,a,h,g;this.dispatchEvent(i);const $=((s=this._picker)===null||s===void 0?void 0:s.selectedObject)||void 0;if(this._pickUi){const st=(a=$)===null||a===void 0?void 0:a.uiConfig,ut=this.uiConfig;ut.children=[...this._uiConfigChildren],st&&ut.children.push(st),(h=ut.uiRefresh)===null||h===void 0||h.call(ut)}const nt=this._widget;nt&&($?nt.attach($):nt.detach());const rt=this._transformControls;rt&&(!((g=this._viewer)===null||g===void 0)&&g.scene.activeCamera.controls)&&($&&rt.enabled?rt.attach($):rt.detach()),e.setDirty(),this.autoFocus&&this.focusObject($)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value?this.setSelectedObject(i.value,this.autoFocus||i.focusCamera):console.warn("e.value must be set for picking")}),e.scene.addEventListener("addSceneObject",async i=>{var s,a,h;const g=i.object,$=this.getSelectedObject();if($&&(g==null?void 0:g.assetType)==="material"&&typeof($==null?void 0:$.setMaterial)=="function"&&(!((s=$==null?void 0:$.modelObject)===null||s===void 0)&&s.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const nt=$.material;if(Array.isArray(nt))console.warn("Dropping on material array not yet fully supported."),$.setMaterial(g);else{let rt=Array.from((a=nt==null?void 0:nt.userData.__appliedMeshes)!==null&&a!==void 0?a:[]);(rt.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):rt.length<1)&&(rt=[$]);for(const st of rt)st&&((h=st.setMaterial)===null||h===void 0||h.call(st,g))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let a=!1;s==null||s.traverseAncestors(h=>{h===e.scene.modelObject&&(a=!0)}),a||this.setSelectedObject(void 0)})}async focusObject(e){var i,s,a,h;const g=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews");await(g==null?void 0:g.animateToObject(e,4,1e3,"easeOut",{min:((h=(a=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera.getControls())===null||a===void 0?void 0:a.minDistance)!==null&&h!==void 0?h:.5)+.5,max:5}))}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}jo.PluginType="Picking",dE([Qn(),rs()],jo.prototype,"enabled",void 0),dE([Qn()],jo.prototype,"autoFocus",void 0);class yC extends dP{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)===null||i===void 0||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(K_);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(_C(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var JA=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Yl extends Ks{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(a=>{var h,g,$,nt;const rt=(g=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||g===void 0?void 0:g[Yl.DIAMOND_GLTF_EXTENSION];rt&&a.geometry&&(this.prepareDiamondMesh(a,rt),delete a.userData.gltfExtensions[Yl.DIAMOND_GLTF_EXTENSION]),a.material&&!s.includes(a.material)&&(!((nt=($=a.material.userData)===null||$===void 0?void 0:$.gltfExtensions)===null||nt===void 0)&&nt[Yl.DIAMOND_GLTF_EXTENSION])&&(a.material.materialObject||console.warn("material not processed",a.material),s.push(a.material))}),s.forEach(a=>{const h=a.userData.gltfExtensions[Yl.DIAMOND_GLTF_EXTENSION];h&&this._convertToDiamondMaterial(a,h)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==Yu.TypeSlug},value:async()=>{var e,i,s,a,h,g;const $=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();if(!($!=null&&$.material))return;const nt=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let rt=parseInt(await((a=this._viewer)===null||a===void 0?void 0:a.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(rt)||(rt=512),rt<64&&(rt=64),((h=$.material.userData)===null||h===void 0?void 0:h.__appliedMeshes.size)>1&&await((g=this._viewer)===null||g===void 0?void 0:g.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond($.material,{cacheKey:nt||void 0,normalMapRes:rt},{}):this.makeDiamondMesh($,{cacheKey:nt||void 0,normalMapRes:rt},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==Pl.TypeSlug},value:async()=>{var e,i,s,a,h,g,$,nt;const rt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject(),st=rt==null?void 0:rt.material;if(!st)return;const ut=st.userData._baseMaterial;let mt=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(ut);if(mt&&!mt.isDiamondMaterial||(mt=(g=this._viewer)===null||g===void 0?void 0:g.createPhysicalMaterial({color:st.color})),mt){const gt=st.userData.__appliedMeshes.size>1&&await(($=this._viewer)===null||$===void 0?void 0:$.confirm("Convert all with this material?"))?Array.from(st.userData.__appliedMeshes):[rt];for(const yt of gt)(nt=yt==null?void 0:yt.setMaterial)===null||nt===void 0||nt.call(yt,mt)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,i;return(i=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&i!==void 0?i:0}set envMapRotation(e){var i;const s=this.envMap;s&&(s.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())}refreshEnvMaps(){var e,i,s;if(!this._viewer)return;const a=this.getEnvMap(),h=((i=(e=this._viewer.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.getMaterialsOfType(Pl.TypeSlug))||[];for(const g of h)g&&g.envMap!==a&&(g.envMap=a,g.needsUpdate=!0);(s=this._viewer)===null||s===void 0||s.scene.setDirty()}refreshUi(){var e,i,s;(e=this._viewer)===null||e===void 0||e.setDirty(),(s=(i=this.uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async onAdded(e){var i,s,a,h,g,$;this._normalCapture=new XM(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const nt=e.getPlugin(Jr);(i=nt==null?void 0:nt.importer)===null||i===void 0||i.processors.add("model",this._modelProcessor),(s=e.getPlugin(jo))===null||s===void 0||s.addEventListener("selectedObjectChanged",this.refreshUi);const rt=this.getEnvMap,st=new Ul(class extends xA{async loadAsync(ut,mt){var gt;const yt=await super.loadAsync(ut,mt);return yt.type===Pl.TYPE||yt.isDiamondMaterialParameters?(yt.envMap=rt(),(gt=nt==null?void 0:nt.materials)===null||gt===void 0?void 0:gt.generateFromTemplate("diamond",yt)):(console.error("Invalid material type for Diamond Material.",yt),null)}},[Pl.TypeSlug],!1);return oo.Importers.push(st),(g=(h=(a=nt==null?void 0:nt.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||g===void 0||g.push(hx),($=nt==null?void 0:nt.materials)===null||$===void 0||$.registerMaterialTemplate({name:"diamond",materialType:Pl.TYPE,isDiamondMaterialParameters:!0,generator:(ut,mt)=>{const gt=new Pl(ut);return gt.envMap=rt(),mt&&mt!=={}&&gt.copyProps(mt),gt}}),super.onAdded(e)}async onRemove(e){var i,s,a,h;return(i=this._normalCapture)===null||i===void 0||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(a=(s=e.getPlugin(Jr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.processors.remove("model",this._modelProcessor),(h=e.getPlugin(jo))===null||h===void 0||h.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var a,h,g;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const $=(h=(a=this._normalCapture)===null||a===void 0?void 0:a.captureNormalMap(e.geometry,i,s))!==null&&h!==void 0?h:[void 0,!1],nt=(g=this._viewer)===null||g===void 0?void 0:g.getPluginByType("debug");nt&&$&&(nt.counters.normalsCapture||(nt.counters.normalsCapture=0),nt.counters.normalsCapture++,console.log("DEBUG: new normal map captured",nt.counters.normalsCapture,i),nt.addTexture("normal"+nt.counters.normalsCapture,()=>{var rt;return(rt=e.geometry.userData._normalsCaptureMap)===null||rt===void 0?void 0:rt.texture},[40,110*nt.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var a,h;Array.from((a=e==null?void 0:e.userData.__appliedMeshes)!==null&&a!==void 0?a:[]).forEach(g=>{g!=null&&g.isMesh&&g.geometry&&this.prepareDiamondMesh(g,i)}),this._convertToDiamondMaterial(e,s),(h=this._viewer)===null||h===void 0||h.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const a=Array.isArray(e.material)?e.material[0]:e.material,h=this._convertToDiamondMaterial(a,s,!1);e.setMaterial(h)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var a,h,g,$,nt,rt,st;let ut={...i??{}};ut.isDiamond||ut.isDiamondMaterialParameters?Array.isArray(ut.boostFactors)&&(ut.boostFactors=new d.Pa4().fromArray(ut.boostFactors)):ut={isDiamondMaterialParameters:!0},ut.color=(g=(a=ut.color)!==null&&a!==void 0?a:(h=e==null?void 0:e.materialObject)===null||h===void 0?void 0:h.color)!==null&&g!==void 0?g:new hs(1,1,1);const mt=(rt=(nt=($=this._viewer)===null||$===void 0?void 0:$.getManager())===null||nt===void 0?void 0:nt.materials)===null||rt===void 0?void 0:rt.generateFromTemplate("diamond",ut);if(mt&&e&&!e.isDiamondMaterial&&(mt.userData._baseMaterial=e.uuid),s){const gt=yt=>{var wt;return(wt=yt.setMaterial)!==null&&wt!==void 0?wt:It=>{yt.material=It.materialObject}};Array.from((st=e==null?void 0:e.userData.__appliedMeshes)!==null&&st!==void 0?st:[]).forEach(yt=>{gt(yt)(mt),this.prepareDiamondMesh(yt,i)})}return mt}_computeOffsets(e,i,s=!1){const a=i.split(";").find(rt=>this.offsetCache[rt]);if(a&&!s){const rt=this.offsetCache[a];return i.split(";").forEach(st=>st!==a&&(this.offsetCache[st]=rt)),e.userData._normalsCaptureOffsets=rt,rt}e.computeBoundingBox();const h=e.boundingBox.getCenter(new d.Pa4),g=JM(e),$=g.clone().invert(),nt={center:h,offsetMatrix:g,offsetMatrixInv:$,radius:1,centerOffset:new d.Pa4().copy(h).applyMatrix4($)};return i.split(";").forEach(rt=>this.offsetCache[rt]=nt),e.userData._normalsCaptureOffsets=nt,nt}}Yl.PluginType="Diamond",Yl.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",JA([hn(Yl.prototype.refreshEnvMaps),Qn()],Yl.prototype,"envMap",void 0),JA([hn(Yl.prototype.refreshEnvMaps),Qn()],Yl.prototype,"forceSceneEnvMap",void 0);const hx=c=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[Yl.DIAMOND_GLTF_EXTENSION]=e.toJSON(),c.extensionsUsed[Yl.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var s,a;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const h={};(a=(s=e.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||a===void 0||delete a[Yl.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(h.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(h.cacheKey=e.userData._diamondCacheKey),i.extensions[Yl.DIAMOND_GLTF_EXTENSION]=h,c.extensionsUsed[Yl.DIAMOND_GLTF_EXTENSION]=!0}});var Sm,Fu=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Ol=Sm=class extends Ks{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[Jr],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=c=>{const e=c.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(i=>{const s=i.animations;if(s.length<1)return;const a=Math.max(...s.map($=>$.duration));s.forEach($=>$.duration=a);const h=new d.Xcj(this._viewer.scene.modelRoot.modelObject),g=s.map($=>h.clipAction($).setLoop(this.loopAnimations?d.YKA:d.jAl,this.loopRepetitions));this.animations.push({mixer:h,clips:s,actions:g,duration:a}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:c}){this.enabled&&Math.abs(c)>.001&&(this._scrollAnimationState=-1*Math.sign(c))}_postFrame(){var c,e;if(!this._viewer)return;const i=this._viewer,s=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!s)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(Sm.PluginType),this._fadeDisabled=!1));const a=po()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/30);let h=a-this._lastFrameTime;if(h*=this.animationSpeed,this._lastFrameTime=a,s&&(h*=this._scrollAnimationState),Math.abs(h)<1e-4)return;const g=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(g&&g>0&&(h=g),g!==0&&(this.animations.map($=>$.mixer.update(h)),this._animationTime+=h,this._animationTime>this._animationDuration&&(this._animationTime-=this._animationDuration),this._animationTime<0&&(this._animationTime+=this._animationDuration),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,i.scene.activeCamera.cameraObject.userData.__animatingCamera&&i.scene.activeCamera.setDirty(),i.renderer.resetShadows(),i.setDirty(),!this._fadeDisabled)){const $=this._viewer.getPluginByType("FrameFade");$&&($.disable(Sm.PluginType),this._fadeDisabled=!0)}}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new $_(e,this))}async onAdded(c){var e,i,s,a,h,g;(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.scene.addEventListener("addSceneObject",this._objectAdded),(g=(h=(a=(s=c.getPlugin(Jr))===null||s===void 0?void 0:s.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||g===void 0||g.push(dx),c.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let $=-1;return Object.defineProperty(c.scene.modelRoot,"currentTimelineMarker",{get:()=>$,set:nt=>c.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[$=nt]})}),c.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:nt})=>{var rt;if(!this._viewer)return;if(!nt)return this._viewer.scene.activeCamera=(rt=this._viewer)===null||rt===void 0?void 0:rt.scene.defaultCamera,void this._viewer.setDirty();const st=nt.camera;st&&(st.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(st))}),super.onAdded(c)}async onRemove(c){var e,i;return c.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(c)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:c})=>c))}onStateChange(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.children)===null||e===void 0||e.map(i=>i&&Ht(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(c,e=!1){return this.playClips([c],e)}async playClips(c,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(a=>{c.includes(a.getClip().name)&&i.push(a)})}),this.playAnimation(e,i)}async playAnimation(c=!1,e){var i,s,a;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1),sn((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"))===null||s===void 0?void 0:s.transformControls,"enabled",!1);let h=0;e||(e=[],this.animations.forEach(({mixer:nt,actions:rt,clips:st})=>{e.push(...rt)}));const g=Ao();this._lastAnimId=g,this._animationState!=="paused"&&this.resetAnimation();for(const nt of e)this.timeScale>0&&(nt.timeScale=this.timeScale),nt.setLoop(this.loopAnimations?d.YKA:d.jAl,this.loopRepetitions),nt.play(),h=Math.max(h,nt.getClip().duration/nt.timeScale);if(this._animationState="playing",(a=this._viewer)===null||a===void 0||a.setDirty(),h*=this.loopAnimations?this.loopRepetitions:1,h/=this.animationSpeed,!isFinite(h))return;const $=1e3*h-this._animationTime/this.animationSpeed+.01;$>0&&await ou($),g===this._lastAnimId&&this.stopAnimation(c)}pauseAnimation(){var c,e,i;this._animationState="paused",sn((e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.transformControls,"enabled",!0),(i=this._viewer)===null||i===void 0||i.setDirty(),this._lastAnimId=""}stopAnimation(c=!1){var e,i,s;this._animationState="stopped",sn((e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"),"enabled",!0),c?this.resetAnimation():(i=this._viewer)===null||i===void 0||i.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((s=this._viewer.getPluginByType("FrameFade"))===null||s===void 0||s.enable(Sm.PluginType),this._fadeDisabled=!1)}resetAnimation(){var c;this._animationState==="stopped"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(c=this._viewer)===null||c===void 0||c.setDirty()):this.stopAnimation(!0)}};Ol.PluginType="GLTFAnimation",Ol.AnimationMarkersExtension="WEBGI_animation_markers",Fu([Fm()],Ol.prototype,"animationState",null),Fu([Fm()],Ol.prototype,"animationTime",null),Fu([Fm()],Ol.prototype,"animationDuration",null),Fu([hn(Sm.prototype.onPropertyChange),rs("Loop",{limitedUi:!0})],Ol.prototype,"loopAnimations",void 0),Fu([hn(Sm.prototype.onPropertyChange)],Ol.prototype,"loopRepetitions",void 0),Fu([hn(Sm.prototype.onPropertyChange)],Ol.prototype,"timeScale",void 0),Fu([rs(),Qn()],Ol.prototype,"animateOnScroll",void 0),Fu([ls("Speed",[.1,4],.1,{limitedUi:!0}),Qn()],Ol.prototype,"animationSpeed",void 0),Fu([hn(Sm.prototype.onStateChange)],Ol.prototype,"_animationState",void 0),Fu([No("Play/Pause",c=>({label:()=>c.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Ol.prototype,"playPauseAnimation",null),Fu([No("Stop",{limitedUi:!0})],Ol.prototype,"stopAnimation",null),Fu([No("Reset",{limitedUi:!0})],Ol.prototype,"resetAnimation",null),Ol=Sm=Fu([ho("GLTF Animations")],Ol);class $_{constructor(e,i){this.parser=e,this.name=Ol.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){var i;let s=[];for(const mt of this.parser.json.scenes){if(!mt.extensions)continue;const gt=mt.extensions[this.name];for(const yt of(gt==null?void 0:gt.markers)||[]){const wt=yt.camera!==void 0?await this.parser.getDependency("camera",yt.camera):void 0;yt.time===void 0&&(yt.time=yt.frame/30,console.error("Update timeline markers plugin for correct times.")),s.push({name:yt.name,frame:yt.frame,time:yt.time,camera:wt})}}if(s.length<1)return;s=s.sort((mt,gt)=>mt.frame-gt.frame);const a=(i=e.scene)!==null&&i!==void 0?i:e.scenes[0];if(!a)return;a.userData.__markers=s;const h=this.plugin.timelineMarkers,g=s.map(mt=>mt.time);let $=h.length;const nt=s.map(mt=>$++),rt=Math.max(...g)+.01;h.push(...s);const st=new d.dUE(".currentTimelineMarker",g,nt,2300),ut=new d.m7l("animationTimelineMarker",rt,[st]);ut.__gltfExport=!1,e.animations.push(ut)}}const dx=c=>({afterParse(e){const i=c.json.scenes[c.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},a=[];if((Array.isArray(e)?e:[e]).forEach(h=>h.traverse(g=>{g.userData.__markers&&a.push(...g.userData.__markers)})),a.sort((h,g)=>h.frame-g.frame),!(a.length<1)){for(const h of a){const g=h.camera;if(g){const $=c.nodeMap.get(g);if($===void 0){console.warn("Camera not found in gltf export",g,c.nodeMap);continue}const nt=c.json.nodes[$].camera;h.camera=nt,s.markers.push(h)}}i.extensions[Ol.AnimationMarkersExtension]=s,c.extensionsUsed[Ol.AnimationMarkersExtension]=!0}}});class Mv extends _e{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,i,s,a,h,g="postRender",$=!1){var nt;this._generators.has(g)||this._generators.set(g,[]),(nt=this._generators.get(g))===null||nt===void 0||nt.push({key:e,fn:i,rect:s?[...s]:void 0,frag:h||a||$?new d.jyz({vertexShader:it.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:h??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${$?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${$?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${a??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s,a;this._generators.set(i,(a=(s=this._generators.get(i))===null||s===void 0?void 0:s.filter(h=>h.key!==e))!==null&&a!==void 0?a:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const s=this._viewer,a=s==null?void 0:s.renderer;a&&s&&((i=this._generators.get(e))===null||i===void 0||i.forEach(({key:h,fn:g,rect:$,frag:nt})=>{const rt=g(s);if(rt){if(rt.image&&$){const st=rt.image.width/rt.image.height;$[2]<1&&$[3]<1&&($[2]=200),$[2]<1&&($[2]=$[3]*st),$[3]<1&&($[3]=$[2]/st)}a.blit(rt,void 0,{viewport:$,clear:!1,material:nt})}}))}}Mv.PluginType="debug";var ZA=function(c,e){return ZA=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])},ZA(c,e)};function px(c,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=c}ZA(c,e),c.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var ew,pE=function(){function c(){}return c._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},c}(),Wy=function(c){function e(i){var s=c.call(this)||this;return s.a=e._xfnv1a(i)(),s}return px(e,c),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(pE),kT=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return px(e,c),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(pE),Y0=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return px(e,c),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(pE);(function(c){c.sfc32="sfc32",c.mulberry32="mulberry32",c.xoshiro128ss="xoshiro128ss"})(ew||(ew={}));var fx=function(){function c(e,i){i===void 0&&(i=ew.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return c.prototype.next=function(){return this.generator.next()},c.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new kT(this.str);case"mulberry32":return new Wy(this.str);case"xoshiro128ss":return new Y0(this.str);default:return this.wrap()}},c.prototype.wrap=function(){return{next:function(){return Math.random()}}},c}(),BT=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class mx extends n_{constructor(e,i,s,a){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new d.Pa4(10,10,10),normalDirection:new d.Pa4(.01,.98,.01).normalize(),direction:new d.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=a??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const a=new fx(e.toString()),h=new d.FM8(a.next()*Math.PI*2,Math.asin(2*a.next()-1));let g=new d.Pa4(Math.cos(h.x)*Math.cos(h.y),Math.sin(h.y),Math.sin(h.x)*Math.cos(h.y));const $=new d.FM8;for(let nt=0;nt<5;nt++){$.set(a.next(),a.next()),g=OT($,this._randomParams.normalDirection,.4),a.next()<Math.sqrt(i??this._randomParams.focus)&&($.set(a.next(),a.next()),g=OT($,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const rt=g.dot(this._randomParams.normalDirection);if(rt>0&&rt<.4)break}g.normalize(),g.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(g.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new d.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function OT(c,e,i){e=e.clone().normalize();const s=new d.Pa4(0,-e.z,e.y).normalize(),a=new d.Pa4().crossVectors(e,s).normalize(),h=c;h.x=2*h.x*Math.PI,h.y=1-h.y*i;const g=Math.sqrt(1-h.y*h.y);return s.multiplyScalar(Math.cos(h.x)*g).add(a.multiplyScalar(Math.sin(h.x)*g)).add(e.multiplyScalar(h.y))}BT([Qn("shadowParams")],mx.prototype,"_shadowParams",void 0),BT([Qn("randomParams")],mx.prototype,"_randomParams",void 0);class AC extends d.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",zt`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)})([pn({propKey:"tLastThis"})],AC.prototype,"lastFrameTexture",void 0);var gx=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Tv{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(s,a,h)=>{this.groundMapMode==="aoMap"?s.fragmentShader=Fl(s.fragmentShader,"#include <aomap_fragment>",Fl(d.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=Fl(s.fragmentShader,"#include <map_fragment>",Fl(d.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=Fl(s.fragmentShader,"#include <alphamap_fragment>",Fl(d.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&h.capabilities.isWebGL2&&(s.fragmentShader=Fl(s.fragmentShader,"#include <output_fragment>",zt`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,a)=>{a.materialObject.userData.gMapMode!==this.groundMapMode&&(a.materialObject.userData.gMapMode=this.groundMapMode,a.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new mx(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new d.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new d.Pa4(10,10,10),normalDirection:new d.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new AC({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:d.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e),(s=this._viewer)===null||s===void 0||s.setDirty()}fromJSON(e,i){return br(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:d.ywz,depthBuffer:!1,size:new d.FM8(i,i),sizeMultiplier:void 0,encoding:d.rnI,format:d.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,a=s.shadowMap,h=a.type,g=a.needsUpdate,$=a.autoUpdate;a.type=d._MY,a.needsUpdate=!0,a.autoUpdate=!1;const nt=this._viewer.scene,rt=new d.S9g;rt.disableAll(),nt.modelObject.traverse(yt=>{yt.isLight&&yt!==this._light.lightObject&&(yt.userData.__gp_layers=yt.layers,yt.layers=rt)});const st=nt.activeCamera.cameraObject;if(st.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";st.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),Br(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(nt)),st.layers.disable(this._lightLayer);const ut=st.layers.mask;st.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const mt=this._viewer.renderer.getTempTarget({type:d.ywz,depthBuffer:!1,size:new d.FM8(i,i),encoding:d.rnI,format:d.wk1}),gt=mt.texture.encoding;mt.texture.encoding=d.rnI,this._viewer.renderer.blit(this._target.texture,mt,{clear:!0});{const yt=nt.modelObject.environment,wt=nt.modelObject.background,It=e.material,Et=e.frustumCulled,Ct=s.getRenderTarget(),xt=s.getActiveCubeFace(),Bt=s.getActiveMipmapLevel();nt.modelObject.background=null,nt.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=mt.texture,this._shadowMat.needsUpdate=!0,Br(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(nt)),s.setRenderTarget(Ct,xt,Bt),e.frustumCulled=Et,e.material=It,nt.modelObject.environment=yt,nt.modelObject.background=wt}return mt.texture.encoding=gt,this._viewer.renderer.releaseTempTarget(mt),e.layers.disable(this._lightLayer),st.layers.mask=ut,nt.modelObject.traverse(yt=>{yt.isLight&&yt!==this._light.lightObject&&(yt.layers=yt.userData.__gp_layers,delete yt.userData.__gp_layers)}),a.type=h,a.needsUpdate=g,a.autoUpdate=$,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,a;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)===null||i===void 0?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)===null||s===void 0?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((a=this._target)===null||a===void 0?void 0:a.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}gx([Qn("randomizedLight")],Tv.prototype,"_light",void 0),gx([hn(Tv.prototype.reset),Qn()],Tv.prototype,"maxFrameNumber",void 0),gx([hn(Tv.prototype._groundMapModeChanged),Qn()],Tv.prototype,"groundMapMode",void 0),gx([Qn(),hn(Tv.prototype._alphaVignetteChanged)],Tv.prototype,"alphaVignette",void 0),gx([Qn(),hn(Tv.prototype._alphaVignetteChanged)],Tv.prototype,"alphaVignetteAxis",void 0);var LT="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",fE=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class qy extends d.Kj0{constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new d.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(It,Et,Ct)=>{if(this.enabled){It.vertexShader=It.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const xt="#glMarker beforeModulation";It.fragmentShader=It.fragmentShader.replace(xt,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+xt),It.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?LT+`
`+bv+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:It=>this.enabled+" "+It.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(It,{materialObject:Et})=>{Et.userData.__lastTransparent!==Et.transparent&&(Et.needsUpdate=!0,Et.userData.__lastTransparent=Et.transparent)},isCompatible:It=>It.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const a=new d.JOQ,h=new d.Pa4,g=new d.Pa4,$=new d.Pa4,nt=new d.yGw,rt=new d.Pa4(0,0,-1),st=new d.Ltg,ut=new d.Pa4,mt=new d.Pa4,gt=new d.Ltg,yt=new d.yGw,wt=new d.cPb;d.M8C.isPowerOfTwo(i.texture.image.width)&&d.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(It,Et,Ct)=>{if(!this.enabled||!It.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const xt=Ct.view?Object.assign({},Ct.view):null;if(xt&&Ct.clearViewOffset&&Ct.clearViewOffset(),g.setFromMatrixPosition(this.matrixWorld),$.setFromMatrixPosition(Ct.matrixWorld),nt.extractRotation(this.matrixWorld),h.set(0,0,1),h.applyMatrix4(nt),ut.subVectors(g,$),ut.dot(h)>0)return;ut.reflect(h).negate(),ut.add(g),nt.extractRotation(Ct.matrixWorld),rt.set(0,0,-1),rt.applyMatrix4(nt),rt.add($),mt.subVectors(g,rt),mt.reflect(h).negate(),mt.add(g),wt.position.copy(ut),wt.up.set(0,1,0),wt.up.applyMatrix4(nt),wt.up.reflect(h),wt.lookAt(mt),wt.far=2,wt.near=0,wt.updateMatrixWorld(),wt.projectionMatrix.copy(Ct.projectionMatrix),yt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),yt.multiply(wt.projectionMatrix),yt.multiply(wt.matrixWorldInverse),yt.multiply(this.matrixWorld),a.setFromNormalAndCoplanarPoint(h,g),a.applyMatrix4(wt.matrixWorldInverse),st.set(a.normal.x,a.normal.y,a.normal.z,a.constant);const Bt=wt.projectionMatrix;gt.x=(Math.sign(st.x)+Bt.elements[8])/Bt.elements[0],gt.y=(Math.sign(st.y)+Bt.elements[9])/Bt.elements[5],gt.z=-1,gt.w=(1+Bt.elements[10])/Bt.elements[14],st.multiplyScalar(2/st.dot(gt)),Bt.elements[2]=st.x,Bt.elements[6]=st.y,Bt.elements[10]=st.z+1-s,Bt.elements[14]=st.w,this.visible=!1;const Lt=It.getRenderTarget(),Gt=It.xr.enabled,Xt=It.shadowMap.autoUpdate;It.xr.enabled=!1,It.shadowMap.autoUpdate=!1,It.setRenderTarget(this._renderTarget),It.state.buffers.depth.setMask(!0),It.autoClear===!1&&It.clear();const rn=Et.background;this.transparentReflectionBackground&&(Et.background=null);const fn=!this.transparentReflectionBackground;rn&&fn&&(rn.userData.flipX=!rn.userData.flipX),Br(It,{shadowMapRender:!1,backgroundRender:fn,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>It.render(Et,wt)),rn&&fn&&(rn.userData.flipX=!rn.userData.flipX||void 0),this.transparentReflectionBackground&&(Et.background=rn),It.xr.enabled=Gt,It.shadowMap.autoUpdate=Xt,It.setRenderTarget(Lt),xt!=null&&xt.enabled&&Ct.setViewOffset&&Ct.setViewOffset(xt.fullWidth,xt.fullHeight,xt.offsetX,xt.offsetY,xt.width,xt.height);const wn=Ct.viewport;wn!==void 0&&It.state.viewport(wn),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=yt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new d.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=yt}_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e)}getRenderTarget(){return this._renderTarget}}fE([hn(qy.prototype._updateExtension)],qy.prototype,"enabled",void 0),fE([hn(qy.prototype._updateExtension)],qy.prototype,"reflectorModePhysical",void 0),qy.prototype.isReflector=!0;var qm=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Cp extends Ks{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Jr],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new d._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new d.Kj0(this._geometry)}async onAdded(e){var i,s;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Jr);const a=this._createMesh();a.userData.physicsMass=0,this._iMesh=await((i=this._manager)===null||i===void 0?void 0:i.addImportedSingle(a,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(s=this._iMesh)===null||s===void 0?void 0:s.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s;return this._geometry.dispose(),(s=(i=this._iMesh)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,i;this._material&&((i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;i&&(i.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=i.maxPolarAngle),i.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(i.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,i,s;if(!this._mesh||!this._viewer)return;let a=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,a=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const h=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const g=h.getCenter(new d.Pa4).sub(new d.Pa4(0,h.getSize(new d.Pa4).y/2+this.yOffset,0));a=a||g.clone().sub(this._mesh.position).length()>1e-4,a&&this._mesh.position.copy(g)}a=a||Math.abs(this._mesh.scale.x-this.size)>1e-4,a&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new d.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)===null||s===void 0||s.call(i)),this._transformNeedRefresh=!1}else a&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,i,s,a,h,g,$,nt;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const rt=(i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.findOrCreate((a=(s=this._material)===null||s===void 0?void 0:s.uuid)!==null&&a!==void 0?a:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let st=!1;return(rt==null?void 0:rt.uuid)!==((h=this._material)===null||h===void 0?void 0:h.uuid)&&(this._removeMaterial(),rt&&(this._material=rt),!((g=this._material)===null||g===void 0)&&g.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((nt=($=this._mesh)===null||$===void 0?void 0:$.setMaterial)!==null&&nt!==void 0?nt:ut=>{this._mesh&&(this._mesh.material=ut.materialObject)})(this._material)),st=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),st}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}qm([Qn("material")],Cp.prototype,"_material",void 0),qm([hn(Cp.prototype.refreshTransform),Qn()],Cp.prototype,"visible",void 0),qm([hn(Cp.prototype._onSceneUpdate),Qn()],Cp.prototype,"size",void 0),qm([hn(Cp.prototype._onSceneUpdate),Qn()],Cp.prototype,"yOffset",void 0),qm([hn(Cp.prototype._refreshOptions2),Qn()],Cp.prototype,"renderToDepth",void 0),qm([hn(Cp.prototype._refreshOptions2),Qn()],Cp.prototype,"tonemapGround",void 0),qm([hn(Cp.prototype._refreshCameraLimits),Qn()],Cp.prototype,"limitCameraAboveGround",void 0);var Ql=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class um extends Cp{constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=i,i&&this.dependencies.push(Mv),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new qy(this._geometry,this._viewer.renderer.createTarget({type:d.ywz,format:d.wk1,encoding:d.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:d.D1R,magFilter:d.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var a,h,g,$,nt;let rt=(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSReflection"))===null||h===void 0?void 0:h.passes.ssr.passObject;rt&&!rt.enabled&&(rt=void 0),rt&&(rt.enabled=!1);let st=(nt=($=(g=this._viewer)===null||g===void 0?void 0:g.getPluginByType("SSBevelPlugin"))===null||$===void 0?void 0:$.pass)===null||nt===void 0?void 0:nt.passObject;st&&!st.enabled&&(st=void 0),st&&(st.enabled=!1),i(...s),rt&&(rt.enabled=!0),st&&(st.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin(Mv))===null||i===void 0||i.addTexture("bake_ground_1",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.light.shadow.map)===null||h===void 0?void 0:h.texture},[100,100,200,200]),(s=e.getPlugin(Mv))===null||s===void 0||s.addTexture("bake_ground_2",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.target)===null||h===void 0?void 0:h.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,a;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)===null||i===void 0||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const h=this._mesh.materialExtension;h||console.warn("unable to find the extension to unregister"),(a=(s=this._material).unregisterMaterialExtensions)===null||a===void 0||a.call(s,[h]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&((i=this._shadowBaker)===null||i===void 0||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Tv(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,i,s,a;if(!this._viewer)return!1;const h=super._refreshMaterial();if(!this._material)return h;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const g=this._mesh.materialExtension;g.updaters=[this._viewer.scene,this._viewer.renderer],(i=(e=this._material).registerMaterialExtensions)===null||i===void 0||i.call(e,[g]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((a=(s=this._material).registerMaterialExtensions)===null||a===void 0||a.call(s,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),h}_extraUiConfig(){var e,i,s,a,h,g,$,nt,rt,st,ut,mt,gt,yt,wt,It,Et,Ct,xt,Bt,Lt,Gt,Xt,rn,fn,wn,Cn,bn,Dn,En;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var Tn,Un;return(Un=(Tn=this._uiConfig)===null||Tn===void 0?void 0:Tn.uiRefresh)===null||Un===void 0?void 0:Un.call(Tn,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var Tn;return!(!((Tn=this._shadowBaker)===null||Tn===void 0)&&Tn.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(Tn=>({label:Tn,value:Tn})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)===null||i===void 0?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(a=(s=this._shadowBaker)===null||s===void 0?void 0:s.light)===null||a===void 0?void 0:a.shadowParams,"enabled"],onChange:[(g=(h=this._shadowBaker)===null||h===void 0?void 0:h.light)===null||g===void 0?void 0:g.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(nt=($=this._shadowBaker)===null||$===void 0?void 0:$.light)===null||nt===void 0?void 0:nt.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(st=(rt=this._shadowBaker)===null||rt===void 0?void 0:rt.light)===null||st===void 0?void 0:st.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(mt=(ut=this._shadowBaker)===null||ut===void 0?void 0:ut.light)===null||mt===void 0?void 0:mt.randomParams,"distanceScale"],onChange:[(yt=(gt=this._shadowBaker)===null||gt===void 0?void 0:gt.light)===null||yt===void 0?void 0:yt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(It=(wt=this._shadowBaker)===null||wt===void 0?void 0:wt.light)===null||It===void 0?void 0:It.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(Ct=(Et=this._shadowBaker)===null||Et===void 0?void 0:Et.light)===null||Ct===void 0?void 0:Ct.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Bt=(xt=this._shadowBaker)===null||xt===void 0?void 0:xt.light)===null||Bt===void 0?void 0:Bt.shadowParams,"radius"],onChange:[(Gt=(Lt=this._shadowBaker)===null||Lt===void 0?void 0:Lt.light)===null||Gt===void 0?void 0:Gt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(rn=(Xt=this._shadowBaker)===null||Xt===void 0?void 0:Xt.light)===null||rn===void 0?void 0:rn.shadowParams,"frustumSize"],onChange:[(wn=(fn=this._shadowBaker)===null||fn===void 0?void 0:fn.light)===null||wn===void 0?void 0:wn.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(bn=(Cn=this._shadowBaker)===null||Cn===void 0?void 0:Cn.light)===null||bn===void 0?void 0:bn.shadowParams,"bias"],onChange:[(En=(Dn=this._shadowBaker)===null||Dn===void 0?void 0:Dn.light)===null||En===void 0?void 0:En.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}um.PluginType="Ground",Ql([hn(um.prototype.refreshOptions),Qn()],um.prototype,"bakedShadows",void 0),Ql([hn(um.prototype.refreshOptions),Qn()],um.prototype,"groundReflection",void 0),Ql([hn(um.prototype.refreshOptions),Qn()],um.prototype,"physicalReflections",void 0),Ql([Qn("shadowBaker")],um.prototype,"_shadowBaker",void 0);var X0,Ym=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let hm=X0=class extends Au{constructor(){super({vertexShader:it.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new d.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Hv+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new d.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(c,e,i,s,a){const h=c.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const g=i;let $=.5,nt=g.width*$,rt=g.height*$;const st=[];let ut=h.getTempTarget({sizeMultiplier:.5,type:d.cLu});st.push(ut);let mt=g;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(c,ut,mt,s,a),mt=ut;let gt=1;for(;gt<this.bloomIterations&&(nt/=2,rt/=2,$/=2,!(rt<2||nt<2));gt++){ut=h.getTempTarget({sizeMultiplier:$,type:d.cLu}),st.push(ut),this.material.defines.PASS_STEP=1;let wt=this._weights[gt];wt=this._weights[gt-1]!==0?this._weights[gt]/this._weights[gt-1]:this._weights[gt],this.material.uniforms.weight.value=wt,this.material.needsUpdate=!0,super.render(c,ut,mt,s,a),mt=ut}this.clear=!1;const yt=c.autoClear;for(c.autoClear=!1,gt-=2;gt>=0;gt--)ut=st[gt],st[gt]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=d.WMw,this.material.needsUpdate=!0,c.autoClear=!1,super.render(c,ut,mt,s,a),this.material.blending=d.jFi,h.releaseTempTarget(mt),mt=ut;this.clear=!0,c.autoClear=yt,c.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(c,e,mt,s,a)):(this.uniforms.tSource.value=g.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(c,e,mt,s,a),this.uniforms.tSource.value=null),h.releaseTempTarget(mt)}_updateWeights(){if(!this._weights)return;const c=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,a=1.2-s;s=Math.pow(s,this.power),a=Math.pow(a,this.power),this._weights[i]=a*(1-c)+s*c}this.setDirty()}};Ym([pn()],hm.prototype,"prefilter",void 0),Ym([ls("Threshold",[0,2]),hn(X0.prototype._thresholdsUpdated),Qn()],hm.prototype,"threshold",void 0),Ym([ls("Soft Threshold",[0,1]),hn(X0.prototype._thresholdsUpdated),Qn()],hm.prototype,"softThreshold",void 0),Ym([ls("Intensity",[0,3]),Qn(),pn()],hm.prototype,"intensity",void 0),Ym([ls("Iterations",[0,7],1),hn(X0.prototype._updateWeights),Qn()],hm.prototype,"bloomIterations",void 0),Ym([ls("Radius",[0,1],.01),hn(X0.prototype._updateWeights),Qn()],hm.prototype,"radius",void 0),Ym([ls("Power",[.2,10],.01),hn(X0.prototype._updateWeights),Qn()],hm.prototype,"power",void 0),Ym([rs("Debug")],hm.prototype,"bloomDebug",void 0),hm=X0=Ym([ho("Bloom")],hm);class K0 extends Av{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new hm}_update(e){var i,s;return(i=e.getPlugin(El))===null||i===void 0||i.updateShaderProperties((s=this.pass)===null||s===void 0?void 0:s.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}K0.PluginType="Bloom";var mE=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let dm=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const a=(s=e.materialObject.userData)===null||s===void 0?void 0:s._anisotropyDirectionMap,h=zt`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${bv}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(a?$n("anisotropyDirectionMap",a,i.capabilities.isWebGL2):"");c.fragmentShader=c.fragmentShader.replace("#include <bsdfs>",h),c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_begin>",d.WdD.lights_fragment_begin),c.fragmentShader=c.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const g=d.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");c.fragmentShader=c.fragmentShader.replace("#include <lights_physical_pars_fragment>",g);const $=zt`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+d.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_maps>",$),c.vertexUvs=!0,c.vertexTangents=!0},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._isAnisotropic))return;const a=c;if(!a.isMesh||!a.geometry)return;if(!a.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=s._anisotropyFactor,this._uniforms.anisotropyNoise.value=s._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((i=s._anisotropyDirectionMap)===null||i===void 0)&&i.isTexture?s._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=s._anisotropyDirection;let h=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==h&&(e.materialObject.defines.ANISOTROPY_ENABLED=h,e.materialObject.needsUpdate=!0),h=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==h&&(e.materialObject.defines.ANISOTROPY_DEBUG=h,e.materialObject.needsUpdate=!0),h=s._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(h="CONSTANT"),h=h==="DIRECTION"?2:h==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==h&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=h,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._anisotropyDirectionMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>{var c;return[(c=this._viewer)===null||c===void 0?void 0:c.renderer]},getUiConfig:c=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._isAnisotropic||!1},set value(a){var h;a!==c.materialObject.userData._isAnisotropic&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._isAnisotropic=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(a=>({label:a})),onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(jo))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.makeAnisotropic(s)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(c){var e;const i=(e=c.materialObject)===null||e===void 0?void 0:e.userData;if(!i)return!1;if(i._isAnisotropic===void 0){const s=i.__appliedMeshes;let a=!0;if(s)for(const{geometry:h}of s)!h||h.index&&h.attributes.position&&h.attributes.normal&&h.attributes.uv||(a=!1),a&&!h.attributes.tangent&&h.computeTangents();if(!a)return!1}return i._isAnisotropic=!0,i._anisotropyFactor===void 0&&(i._anisotropyFactor=1),i._anisotropyNoise===void 0&&(i._anisotropyNoise=0),i._anisotropyDirectionMode===void 0&&(i._anisotropyDirectionMode="DIRECTION"),c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new vx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const g=c.getPlugin(Jr);(e=g==null?void 0:g.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=g==null?void 0:g.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=g==null?void 0:g.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(wC)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Jr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};dm.PluginType="AnisotropyPlugin",dm.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",mE([rs("Enabled",c=>({onChange:c.setDirty})),Qn()],dm.prototype,"enabled",void 0),mE([No("Make Anisotropy",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(jo))}}))],dm.prototype,"makeSelectedAnisotropic",void 0),dm=mE([ho("Anisotropy Materials")],dm);class vx{constructor(e){this.parser=e,this.name=dm.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){var s,a,h;const g=this.parser,$=g.json.materials[e];if(!$.extensions||!$.extensions[this.name])return Promise.resolve();const nt=[],rt=$.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=(s=rt.anisotropyFactor)!==null&&s!==void 0?s:0,i.userData._anisotropyNoise=(h=(a=rt.anisotropyNoiseFactor)!==null&&a!==void 0?a:rt.anisotropyNoise)!==null&&h!==void 0?h:0;let{anisotropyDirectionMode:st,anisotropyDirection:ut}=rt;return st||(st=rt.anisotropyTextureMode),ut||(ut=rt.anisotropyRotation),i.userData._anisotropyDirectionMode=st&&typeof(ut==null?void 0:ut.index)=="number"?st:"CONSTANT",st==="ROTATION"||st==="DIRECTION"?nt.push(g.assignTexture(i.userData,"_anisotropyDirectionMap",ut).then(mt=>{mt.encoding=d.knz})):i.userData._anisotropyDirection=ut??0,Promise.all(nt)}afterRoot(e){return e.scene.traverse(i=>{var s,a;if(!(!((a=(s=i.material)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a._isAnisotropic))return;const h=i.geometry;h.attributes.tangent||(h.computeTangents(),h.attributes.tangent.needsUpdate=!0)}),null}}const wC=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const a={index:c.processTexture(e.userData._anisotropyDirectionMap)};c.applyTextureTransform(a,e.userData._anisotropyDirectionMap),s.anisotropyDirection=a}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[dm.ANISOTROPY_GLTF_EXTENSION]=s,c.extensionsUsed[dm.ANISOTROPY_GLTF_EXTENSION]=!0}});var Iv=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Cm=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new d.Ltg},thinNoiseLayerFactors:{value:new d.Ltg},thinColorNoiseParams:{value:new d.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)?bv+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._thinFilmLayer;if(!(s!=null&&s.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(s.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(s.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(s.colorNoiseParams),this._uniforms.thinFilmFactor.value=s.filmFactor;const a=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==a&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0?void 0:s.hasThinFilm)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._thinFilmLayer)===null||a===void 0?void 0:a.hasThinFilm)&&(s?gE(c.materialObject)||e.alert("Cannot add thin film."):(c.materialObject.userData._thinFilmLayer.hasThinFilm=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(c){return gE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new _x(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const g=c.getPlugin(Jr);(e=g==null?void 0:g.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=g==null?void 0:g.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=g==null?void 0:g.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(gP)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Jr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function gE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),c.isMaterial&&(c.needsUpdate=!0),!0}Cm.PluginType="ThinFilmLayerPlugin",Cm.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",Iv([rs("Enabled",c=>({onChange:c.setDirty})),Qn()],Cm.prototype,"enabled",void 0),Cm=Iv([ho("ThinFilmLayer Materials")],Cm);class _x{constructor(e){this.parser=e,this.name=Cm.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),gE(i),i.userData._thinFilmLayer=br(a,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const gP=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=Xr(e.userData._thinFilmLayer,!1);i.extensions[Cm.THIN_FILM_LAYER_GLTF_EXTENSION]=s,c.extensionsUsed[Cm.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var tw=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let up=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this._defines={},this._uniforms={noiseBumpParams:{value:new d.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)?bv+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+a),c.vertexUvs=!0,c.extensionDerivatives=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._noiseBumpMat;if(!(s!=null&&s.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(s.bumpNoiseParams),this._uniforms.noiseBumpScale.value=s.bumpScale,this._uniforms.noiseBumpFlakeScale.value=s.flakeScale,this._uniforms.noiseFlakeClamp.value=s.flakeClamp,this._uniforms.noiseFlakeRadius.value=s.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=s.flakeRoughnessMod;const a=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==a&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||i===void 0)&&i.hasBump?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0?void 0:s.hasBump)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._noiseBumpMat)===null||a===void 0?void 0:a.hasBump)&&(s?Yy(c.materialObject)||e.alert("Cannot add noise bump."):(c.materialObject.userData._noiseBumpMat.hasBump=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(c){return Yy(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new yx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const g=c.getPlugin(Jr);(e=g==null?void 0:g.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=g==null?void 0:g.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=g==null?void 0:g.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(nw)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Jr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function Yy(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.flakeRoughnessMod===void 0&&(i.flakeRoughnessMod=1),c.isMaterial&&(c.needsUpdate=!0),!0}up.PluginType="NoiseBumpMaterialPlugin",up.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",tw([rs("Enabled",c=>({onChange:c.setDirty})),Qn()],up.prototype,"enabled",void 0),up=tw([ho("NoiseBumpMaterial Materials")],up);class yx{constructor(e){this.parser=e,this.name=up.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),Yy(i),i.userData._noiseBumpMat=br(a,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const nw=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=Xr(e.userData._noiseBumpMat,!1);i.extensions[up.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,c.extensionsUsed[up.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var Xy,$0=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let _d=Xy=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new d.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(c,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(c,e,i)=>{var s;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((s=e.materialObject.userData)===null||s===void 0)&&s._customBumpMap)&&(c.fragmentShader=Fl(c.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),c.vertexShader=Fl(c.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),c.vertexShader=Fl(c.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),c.vertexUvs=!0)},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._hasCustomBump))return;const a=c;if(!a.isMesh||!a.geometry)return;const h=!((i=s._customBumpMap)===null||i===void 0)&&i.isTexture?s._customBumpMap:null;this._uniforms.customBumpMap.value=h,this._uniforms.customBumpScale.value=h?s._customBumpScale:0,h&&(h.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(h.matrix));let g=this.enabled&&h?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==g&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=g,e.materialObject.needsUpdate=!0),g=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==g&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=g,e.materialObject.needsUpdate=!0),g=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==g&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=g,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._customBumpMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._hasCustomBump||!1},set value(a){var h;a!==c.materialObject.userData._hasCustomBump&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._hasCustomBump=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},So(c.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var c,e,i;(e=(c=this.materialExtension).setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()},this.enableCustomBumpSelected=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(jo))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.enableCustomBump(s)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(c,e,i){var s,a;const h=(s=c.materialObject)===null||s===void 0?void 0:s.userData;if(!h)return!1;if(h._hasCustomBump===void 0){const g=h.__appliedMeshes;let $=!0;if(g)for(const{geometry:nt}of g)!nt||nt.attributes.position&&nt.attributes.normal&&nt.attributes.uv||($=!1);if(!$)return!1}return h._hasCustomBump=!0,h._customBumpScale=(a=i??h._customBumpScale)!==null&&a!==void 0?a:.001,h._customBumpMap=e??h._customBumpMap,c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new Ax(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const g=c.getPlugin(Jr);(e=g==null?void 0:g.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=g==null?void 0:g.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=g==null?void 0:g.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(NT)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Jr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};_d.PluginType="CustomBumpMapPlugin",_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",$0([rs("Enabled",c=>({onChange:c.setDirty})),Qn()],_d.prototype,"enabled",void 0),$0([rs("Bicubic",c=>({onChange:c.setDirty})),On("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,Xy.prototype.setDirty),Qn()],_d.prototype,"bicubicFiltering",void 0),$0([No("Enable CustomBumpMap",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(jo))}}))],_d.prototype,"enableCustomBumpSelected",void 0),_d=Xy=$0([ho("CustomBumpMap Materials")],_d);class Ax{constructor(e){this.parser=e,this.name=_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){var s;const a=this.parser,h=a.json.materials[e];if(!h.extensions||!h.extensions[this.name])return Promise.resolve();const g=[],$=h.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=(s=$.customBumpScale)!==null&&s!==void 0?s:0;const nt=$.customBumpMap;return nt&&g.push(a.assignTexture(i.userData,"_customBumpMap",nt).then(rt=>{rt.encoding=d.knz})),Promise.all(g)}}const NT=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const a={index:c.processTexture(e.userData._customBumpMap)};c.applyTextureTransform(a,e.userData._customBumpMap),s.customBumpMap=a}i.extensions[_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,c.extensionsUsed[_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var xC=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Xm=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this._defines={},this._uniforms={ccTintColor:{value:new hs},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(c,e,i)=>{var s;if(!(this.enabled&&(!((s=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)&&e.materialObject.clearcoat>0))return;const a="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",h="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";c.fragmentShader.includes(h)&&c.fragmentShader.includes(a)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),c.fragmentShader=c.fragmentShader.replace(h,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),c.fragmentShader=c.fragmentShader.replace(a,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._clearcoatTint;if(!(s!=null&&s.enableTint))return;this._uniforms.ccTintColor.value.set(s.tintColor),this._uniforms.ccThickness.value=s.thickness,this._uniforms.ccIor.value=s.ior;const a=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==a&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||i===void 0)&&i.enableTint?"1":"0")+(c.materialObject.clearcoat>0?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._clearcoatTint)===null||s===void 0?void 0:s.enableTint)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._clearcoatTint)===null||a===void 0?void 0:a.enableTint)&&(s?vE(c.materialObject)||e.alert("Cannot add clearcoat tint."):(c.materialObject.userData._clearcoatTint.enableTint=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(c){return vE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new FT(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const g=c.getPlugin(Jr);(e=g==null?void 0:g.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=g==null?void 0:g.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=g==null?void 0:g.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(bC)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Jr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function vE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),c.isMaterial&&(c.needsUpdate=!0),!0}Xm.PluginType="ClearcoatTintPlugin",Xm.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",xC([rs("Enabled",c=>({onChange:c.setDirty})),Qn()],Xm.prototype,"enabled",void 0),Xm=xC([ho("ClearcoatTint Materials")],Xm);class FT{constructor(e){this.parser=e,this.name=Xm.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),vE(i),i.userData._clearcoatTint=br(a,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const bC=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=Xr(e.userData._clearcoatTint,!1);i.extensions[Xm.CLEARCOAT_TINT_GLTF_EXTENSION]=s,c.extensionsUsed[Xm.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var EC=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let wx=class extends Wo{constructor(c,e,i){super(c,e,i??new UT,new hs(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){if(!this.enabled)return;const h=this.overrideMaterial;h.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(c,e,i,s,a),h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value)}};EC([rs("Enabled")],wx.prototype,"enabled",void 0),wx=EC([ho("Velocity Buffer (TAA)")],wx);class UT extends d.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new d.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new d.yGw},lastProjectionViewMatrix:{value:new d.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new d.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,a,h){var g,$;const nt=this._previousWorldMatrices[h.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(nt??h.matrixWorld),nt?nt.copy(h.matrixWorld):this._previousWorldMatrices[h.uuid]=h.matrixWorld.clone();let rt=h.material;Array.isArray(rt)&&(rt=rt[0]),this.uniforms.alphaMap.value=(g=rt==null?void 0:rt.alphaMap)!==null&&g!==void 0?g:null,this.uniforms.alphaTest.value=!rt||!rt.alphaTest||rt.alphaTest<1e-7?.001:rt.alphaTest;let st=this.uniforms.alphaMap.value?1:void 0;st!==this.defines.USE_ALPHAMAP&&(st===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=st,this.needsUpdate=!0),st=rt.userData.ALPHA_I_RGBA_PACKING?1:void 0,st!==this.defines.ALPHA_I_RGBA_PACKING&&(st===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=st,this.needsUpdate=!0),this.side=($=rt.side)!==null&&$!==void 0?$:d.ehD}}class xx extends Av{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:d.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,a=new Set;return new class extends wx{render(h,g,$,nt,rt){if(e.renderer.frameCount>0)return;const st=h.getRenderTarget(),ut=h.getActiveCubeFace(),mt=h.getActiveMipmapLevel();this.scene.traverse(({material:gt})=>{gt&&((gt.transparent&&gt.userData.renderToDepth||!gt.transparent&&gt.transmission===0&&gt.userData.renderToDepth===!1)&&(s.add(gt),gt.transparent=!gt.transparent),Math.abs(gt.transmission||0)>0&&gt.userData.renderToDepth&&(a.add([gt,gt.transmission]),gt.transmission=0))}),Br(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,g,i,nt,rt)),s.forEach(gt=>gt.transparent=!gt.transparent),s.clear(),a.forEach(([gt,yt])=>gt.transmission=yt),a.clear(),h.setRenderTarget(st,ut,mt)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)===null||s===void 0?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(s=(i=this.getVelocityBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}xx.PluginType="VelocityBuffer";class SC extends Au{constructor(e,i){super({vertexShader:it.vertexShader,fragmentShader:i+`
`+qw+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new d.FM8},cameraNearFar:{value:new d.FM8},lastProjectionViewMatrix:{value:new d.yGw},currentProjectionViewMatrix:{value:new d.yGw},projection:{value:new d.yGw},inverseViewMatrix:{value:new d.yGw},jitterSample:{value:new d.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new d.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,a,h){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const g=this.uniforms.tVelocity.value?1:0;g!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=g,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,a,h),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)})([Qn(),pn()],SC.prototype,"feedBack",void 0);class bx extends Av{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[El]}passCtor(e){if(!e.getPlugin(cp))throw"Add ProgressivePlugin before TAA";const i=new SC(e.getPlugin(cp).lastFrame,e.getPlugin(El).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<1,!s.taaEnabled)return!1;const a=e.scene.activeCamera;return s.updateShaderProperties([e.getPlugin(El),a,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(cp).lastFrame,s.updateCameraProperties(a==null?void 0:a.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}bx.PluginType="TAA";class CC{static async GetDataUrl(e,{mimeType:i="image/png",rect:s={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:a=1,scale:h=1}){var g,$,nt;const rt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");rt.width=s.width*h*a,rt.height=s.height*h*a,s.assumeClientRect&&(s.x*=e.width/(a*e.clientWidth),s.y*=e.height/(a*e.clientHeight),s.width*=e.width/(a*e.clientWidth),s.height*=e.height/(a*e.clientHeight));const st=rt.getContext("2d");if(!st)return console.error("snapshot: cannot create context"),"";const ut=e.style.background||((g=e.parentElement)===null||g===void 0?void 0:g.style.background)||"";if(ut.includes("url")){const gt=($=/url\("(.*)"\)/gi.exec(ut))===null||$===void 0?void 0:$[1];if(gt){const yt=new Image;yt.src=gt,await new Promise((wt,It)=>{yt.onload=()=>wt(),yt.onerror=()=>It(),yt.complete&&wt()}),st.drawImage(yt,yt.width*s.x*a/e.width,yt.height*s.y*a/e.height,yt.width*s.width*a/e.width,yt.height*s.height*a/e.height,0,0,rt.width,rt.height)}}else st.fillStyle=e.style.background||((nt=e.parentElement)===null||nt===void 0?void 0:nt.style.backgroundColor)||"#00000000",st.fillRect(0,0,rt.width,rt.height);st==null||st.drawImage(e,s.x*a,s.y*a,s.width*a,s.height*a,0,0,rt.width,rt.height);const mt=st.canvas.toDataURL(i);return rt.remove(),mt}static async GetImage(e,i={}){const s=await this.GetDataUrl(e,i);return new Promise((a,h)=>{const g=new Image;g.onload=()=>{a(g)},g.src=s})}static async GetBlob(e,i={}){return await(await fetch(await this.GetDataUrl(e,i))).blob()}static async GetFile(e,i="image.png",s={}){var a;return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:(a=s.mimeType)!==null&&a!==void 0?a:"image/png",lastModified:po()})}}var Mm=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let pm=class extends Ks{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(c,e={}){return e.getDataUrl=!1,await this._getFile(c,e)}async getDataUrl(c={}){var e;return c.getDataUrl=!0,(e=await this._getFile("",c))!==null&&e!==void 0?e:""}async _getFile(c,e={}){var i,s,a;const h=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(h){const g=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==g&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const $=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(cp);if(e.waitForProgressive&&$&&e.timeout===void 0)for(;!$.isConverged(!0);)await ou(64);else await ou((a=e.timeout)!==null&&a!==void 0?a:200);e.displayPixelRatio=1;const nt=await CC.GetFile(h,c,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=g,nt}}async downloadSnapshot(c="snapshot.png",e={}){const i=await this.getFile(c,e);i&&Wp(i)}};pm.PluginType="CanvasSnipper",Mm([No("Download .png",{limitedUi:!0})],pm.prototype,"downloadSnapshot",null),pm=Mm([ho("Image Export")],pm);var eu=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let jT=1,Np=class{constructor(c,e,i,s,a){this.position=new d.Pa4,this.target=new d.Pa4,this.quaternion=new d._fP,this.up=new d.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=w_(this.name,this),c&&(this.position=c),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),a&&(this.snap=a),this.name="Camera View"+jT++}_nameChanged(){var c,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c))}};eu([Qn(),Jl()],Np.prototype,"position",void 0),eu([Qn(),Jl()],Np.prototype,"target",void 0),eu([Qn(),Jl()],Np.prototype,"quaternion",void 0),eu([Qn(),Jl()],Np.prototype,"up",void 0),eu([Qn(),uo()],Np.prototype,"name",void 0),eu([Sy()],Np.prototype,"snap",void 0),eu([No()],Np.prototype,"focusView",void 0),eu([No()],Np.prototype,"deleteView",void 0),Np=eu([Ps("CameraView")],Np);class au extends Ks{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...zv(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera;if(!s)return;const a=new d.$V,h=s.position,g=s.target,$=new d._fP().setFromUnitVectors(s.cameraObject.up,new d.Pa4(0,1,0)),nt=$.clone().invert(),rt=h.clone().sub(g);rt.applyQuaternion($),a.setFromVector3(rt),a.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,a.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,a.makeSafe(),rt.setFromSpherical(a),rt.applyQuaternion(nt),h.copy(g).add(rt),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,i;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(au.PluginType),this._fadeDisabled=!1));const s=po()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=s-1/60);let a=s-this._lastFrameTime;this._lastFrameTime=s,a*=this.animateOnScroll?this._scrollAnimationState:1;const h=(i=this._viewer.getPluginByType("Progressive"))===null||i===void 0?void 0:i.postFrameConvergedRecordingDelta();if(h&&h>0&&(a=h),h!==0&&(a*=1e3,!(a<=0||(this._updaters.forEach(g=>{let $=a;g.time+$<0&&($=-g.time),g.time+=$,Math.abs($)>.001&&g.u($)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const g=this._viewer.getPluginByType("FrameFade");g&&(g.disable(au.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await ou(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await ou(2))}async recordAllViews(e){var i;if(!this.enabled)return;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CanvasRecorder");return s&&s.enabled&&(await this.resetToFirstView(),s.startRecording())?new Promise((a,h)=>{const g=()=>{s.removeEventListener("start",$),s.removeEventListener("stop",g),s.removeEventListener("error",nt)},$=async()=>{g(),e==null||e(),await this.animateAllViews();const rt=await s.stopRecording();rt&&Tu(rt,"recording.mp4"),a()},nt=async()=>{g(),h()};s.addEventListener("start",$),s.addEventListener("stop",g),s.addEventListener("error",nt)}):void 0}async addCurrentView(){var e,i,s,a,h;if(!this.enabled)return;const g=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!g)return;const $=this.getCurrentCameraView(g);$.snap=await((s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(pm))===null||s===void 0?void 0:s.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push($),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}getCurrentCameraView(e){var i;if(e||(e=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera),!e)return new Np;const s=new d.Pa4,a=e.cameraObject.matrixWorld;s.x=a.elements[4],s.y=a.elements[5],s.z=a.elements[6];const h=new Np(e.position.clone(),e.target.clone(),s.normalize(),e.cameraObject.quaternion.clone(),"");return h.focusView=async()=>this.focusView(h),h.deleteView=()=>this.deleteView(h),h}async focusView(e){return this.animateToView(e)}deleteView(e){var i,s;const a=this._cameraViews.indexOf(e);a>=0&&this._cameraViews.splice(a,1),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)===null||i===void 0?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await ou(100)}async animateToView(e,i,s){var a;const h=(a=this._viewer)===null||a===void 0?void 0:a.scene.activeCamera;if(!h)return;if(this._animating&&(this._popAnimations.forEach(st=>{var ut;return(ut=st==null?void 0:st.stop)===null||ut===void 0?void 0:ut.call(st)}),await ou(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration);const g=typeof s=="function"?s:Hy[s||this.animEase],$=this._driver,nt=[];this._popAnimations=[];const rt=this._popAnimations;if(this.interpolateMode==="spherical")nt.push(async function(st,ut,mt,gt,yt,wt){const It=st.target.clone(),Et=new d.Pa4,Ct=new d.Pa4,xt=Ky(st.cameraObject,It),Bt=Ky(ut,ut.target),Lt=new d.$V;return Ex({from:0,to:1,duration:mt,ease:gt,driver:yt,onUpdate:Gt=>{Lt.phi=_E(xt.phi,Bt.phi,Gt),Lt.theta=_E(xt.theta,Bt.theta,Gt),Lt.radius=co(xt.radius,Bt.radius,Gt),Et.copy(It).lerp(ut.target,Gt),Ct.setFromSpherical(Lt),Ct.add(Et),st.position=Ct,st.target=Et,st.positionUpdated(!1),st.targetUpdated()},onComplete:()=>{st.position=ut.position,st.target=ut.target,st.positionUpdated(!1),st.targetUpdated()}},wt)}(h,e,i,g,$,rt));else if(this.interpolateMode==="linear"){nt.push(Ex({from:h.position.clone(),to:e.position.clone(),duration:i,ease:g,driver:$,onUpdate:mt=>h.position=mt,onComplete:()=>h.position=e.position},rt)),nt.push(Ex({from:h.target.clone(),to:e.target.clone(),duration:i,ease:g,driver:$,onUpdate:mt=>{h.target=mt,h.targetUpdated()},onComplete:()=>{h.target=e.target,h.targetUpdated()}},rt));const st=h.cameraObject.quaternion.clone(),ut=new d._fP;nt.push(Ex({from:0,to:1,duration:i,ease:g,driver:$,onUpdate:mt=>{ut.copy(st).slerp(e.quaternion,mt),h.cameraObject.quaternion.copy(ut),h.cameraObject.updateProjectionMatrix()},onComplete:()=>{h.cameraObject.quaternion.copy(e.quaternion),h.cameraObject.updateProjectionMatrix()}},rt))}await Promise.all(nt),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await ou(10)}fromJSON(e,i){var s,a;return this._cameraViews.forEach(h=>this.deleteView(h)),super.fromJSON(e,i)?(this._cameraViews.forEach(h=>h.focusView=async()=>this.focusView(h)),this._cameraViews.forEach(h=>h.deleteView=()=>this.deleteView(h)),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s),this):null}async animateToObject(e,i=4,s,a,h={min:.5,max:5}){if(!this._viewer)return;const g=new ar().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),$=g.getCenter(new d.Pa4),nt=g.getSize(new d.Pa4).length()/2;await this.animateToTarget(Math.min(h.max,Math.max(h.min,nt*i)),$,s,a)}async animateToTarget(e,i,s,a){const h=this.getCurrentCameraView();h.target.copy(i);const g=new d.Pa4().subVectors(h.target,h.position).normalize();h.position.copy(g.multiplyScalar(-e).add(h.target)),await this.animateToView(h,s,a)}}async function Ex(c,e){const i=c.onComplete,s=c.onStop;return c={...c},new Promise((a,h)=>{c.onComplete=()=>{i==null||i(),a()},c.onStop=()=>{s==null||s(),a()};const g=$A(c);e.push(g)})}function Ky(c,e){const i=c.position.clone();i.sub(e);const s=new d.$V().setFromVector3(i);return s.makeSafe(),s}function _E(c,e,i){const s=e-c;return s>=Math.PI?c+(s-2*Math.PI)*i:s<=-Math.PI?c+(s+2*Math.PI)*i:c+s*i}function MC(c,e,i){const s=(1-i)*Math.cos(c)+i*Math.cos(e),a=(1-i)*Math.sin(c)+i*Math.sin(e);return Math.atan2(a,s)}au.PluginType="CameraViews",eu([Qn("cameraViews")],au.prototype,"_cameraViews",void 0),eu([hn(au.prototype._animationLoop),Qn(),rs("Loop All Views",{limitedUi:!0})],au.prototype,"viewLooping",void 0),eu([Qn(),uo("View Pause Time")],au.prototype,"viewPauseTime",void 0),eu([Qn(),yp("Ease",Object.keys(Hy).map(c=>({label:c})))],au.prototype,"animEase",void 0),eu([Qn(),ls("Duration",[10,1e4],10,{limitedUi:!0})],au.prototype,"animDuration",void 0),eu([Qn(),ls("RotationOffset",[.2,.75],.01)],au.prototype,"rotationOffset",void 0),eu([Qn(),yp("Interpolation",["spherical","linear"].map(c=>({label:c})))],au.prototype,"interpolateMode",void 0),eu([rs(),Qn()],au.prototype,"seekOnScroll",void 0),eu([No("Animate All Views",{limitedUi:!0})],au.prototype,"animateAllViews",null),eu([No("Record All Views")],au.prototype,"recordAllViews",null),eu([No("Add Current View")],au.prototype,"addCurrentView",null),eu([No("Focus Next")],au.prototype,"focusNext",void 0),eu([No("Focus Previous")],au.prototype,"focusPrevious",void 0);const TC=new d.Pa4;function Pv(c,e,i){let s=c.dot(e);s=Math.min(Math.max(s,-1),1);const a=Math.acos(s)*i;return TC.copy(c).multiplyScalar(s).sub(e).negate().normalize(),c.multiplyScalar(Math.cos(a)).add(TC.multiplyScalar(Math.sin(a)))}var J_=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Z_ extends Ks{constructor(e=!0){super(),this.enabled=!0,this.light=new mx("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var i,s,a;if(!this.enabled)return void(this.light.layers.mask=0);const h=(s=(i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)!==null&&s!==void 0?s:0;(h<1||h>5)&&this.light.randomizePosition(h<5?0:h),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(a=this._cameraHelper)===null||a===void 0||a.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new d.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)===null||i===void 0||i.scene.setDirty():(s=this._viewer)===null||s===void 0||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}Z_.PluginType="RandomizedDirectionalLight",J_([Qn()],Z_.prototype,"enabled",void 0),J_([Qn("rdLight")],Z_.prototype,"light",void 0),J_([Qn()],Z_.prototype,"lightLayers",void 0);var e0,Sx=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let fm=e0=class extends Ks{constructor(c=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=c}_paramsChanged(){var c,e,i,s,a,h,g,$,nt,rt,st;const ut=(c=this._viewer)===null||c===void 0?void 0:c.getBackground(!0);if(this.enabled&&ut&&ut!==wv)if(ut.isDataTexture)ut.mapping=d.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const yt=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");yt?(yt.envmapBg=!0,(s=(i=yt.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)):(a=this._viewer)===null||a===void 0||a.setBackground(wv)}else this.enabled=!1;const mt=(nt=($=(g=(h=this._viewer)===null||h===void 0?void 0:h.renderer)===null||g===void 0?void 0:g.rendererObject)===null||$===void 0?void 0:$.background.getBoxMesh2())===null||nt===void 0?void 0:nt.material,gt=(rt=mt==null?void 0:mt.uniforms)!==null&&rt!==void 0?rt:d.Vj0.cube.uniforms;gt.tripodHeight||(gt.tripodHeight={value:1}),gt.worldRadius||(gt.worldRadius={value:1}),gt.tripodHeight.value=this.tripodHeight,gt.worldRadius.value=this.worldRadius,mt&&(!this.enabled&&mt.defines.HDRi_GROUND_PROJ?delete mt.defines.HDRi_GROUND_PROJ:this.enabled&&(mt.defines.HDRi_GROUND_PROJ="1"),mt.needsUpdate=!0),(st=this._viewer)===null||st===void 0||st.setDirty()}async onAdded(c){var e,i,s;await super.onAdded(c),!((s=(i=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||i===void 0?void 0:i.rendererObject)===null||s===void 0)&&s.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),d.Vj0.cube.fragmentShader=d.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),d.Vj0.cube.fragmentShader=d.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),c.scene.addEventListener("environmentChanged",this._paramsChanged)}};fm.PluginType="HDRiGroundPlugin",Sx([Qn(),hn(e0.prototype._paramsChanged),rs("Enabled")],fm.prototype,"enabled",void 0),Sx([Qn(),hn(e0.prototype._paramsChanged),ls("World Radius",[1,1e3])],fm.prototype,"worldRadius",void 0),Sx([Qn(),hn(e0.prototype._paramsChanged),ls("Tripod height",[0,50])],fm.prototype,"tripodHeight",void 0),fm=e0=Sx([ho("HDRi Ground")],fm);var Km=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const rw={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new d.FM8},cameraNearFar:{value:new d.FM8}},vertexShader:xv,fragmentShader:Hv+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},Cx=(wo({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new d.FM8},direction:{value:new d.FM8}},vertexShader:xv,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),wo({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new d.FM8},direction:{value:new d.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:xv,fragmentShader:bv+`
`+LT+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class J0 extends Au{constructor(){super(rw,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=Cx,this.nearFarBlurScale=new d.FM8(.25,.25),this.focalDepthRange=new d.FM8(.5,1.5),this.crossCenter=new d.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new hs(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=wo({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:xv,fragmentShader:Hv+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=wo({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new d.FM8},direction:{value:new d.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:xv,fragmentShader:Hv+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,a,h){if(!this.enabled)return;const g=e.baseRenderer,$={minFilter:d.TyD,magFilter:d.TyD,type:d.cLu,encoding:d.rnI,sizeMultiplier:.5,isAntialiased:!1,format:d.wk1,depthBuffer:!1,generateMipmaps:!1},nt=g.getTempTarget($),rt=g.getTempTarget($);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,g.blit(void 0,nt,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=nt.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),g.blit(void 0,rt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=rt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),g.blit(void 0,nt,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=nt.texture,g.blit(void 0,rt,{material:this.dofBlurMaterial});else{const st=g.getTempTarget($);this.dofBlurMaterial.uniforms.cocTexture.value=nt.texture,this.dofBlurMaterial.uniforms.colorTexture.value=nt.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),g.blit(void 0,st,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=st.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),g.blit(void 0,rt,{material:this.dofBlurMaterial}),g.releaseTempTarget(st)}this.material.uniforms.blurTexture.value=rt.texture,this.material.uniforms.cocTexture.value=nt.texture,super.render(e,i,s,a,h),g.releaseTempTarget(nt),g.releaseTempTarget(rt)}}Km([Qn(),pn()],J0.prototype,"nearFarBlurScale",void 0),Km([Qn(),pn()],J0.prototype,"focalDepthRange",void 0),Km([pn()],J0.prototype,"crossCenter",void 0),Km([pn()],J0.prototype,"crossRadius",void 0),Km([pn()],J0.prototype,"crossAlpha",void 0),Km([pn()],J0.prototype,"crossColor",void 0);var t0=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class n0 extends Av{constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[El],this.enableEdit=!1,this._focalPointHit=new d.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new d.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new J0}setFocalPoint(e,i=!0,s=!1){var a,h;this._focalPointHit.copy(e),i&&((h=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(K_))===null||h===void 0||h.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=po()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&i!==void 0?i:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&i!==void 0?i:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&i!==void 0?i:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(K_))===null||s===void 0||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))===null||i===void 0||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))===null||i===void 0||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var i,s;if(!super._update(e))return!1;const a=(i=this.pass)===null||i===void 0?void 0:i.passObject;if(!a)return!1;const h=e.getPlugin(El);h==null||h.updateShaderProperties(a.material),a.dofBlurMaterial.uniforms.frameCount&&((s=e.renderer)===null||s===void 0||s.updateShaderProperties(a.dofBlurMaterial));const g=e.scene.activeCamera;if(!g)return!1;g.cameraObject.updateMatrixWorld(!0),g.updateShaderProperties(a.material),this._tempVec.subVectors(this._focalPointHit,g.cameraObject.position),a.focalDepthRange.x=this._tempVec.length(),a.focalDepthRange.x*=g.cameraObject.getWorldDirection(new d.Pa4).dot(this._tempVec.normalize());let $=(po()-this._focalPointHitTime)/this.crossFadeTime;if($=1-Math.min(1,Math.max(0,$)),Math.abs($-a.crossAlpha)>.01&&(a.crossAlpha=$,this.setDirty()),$>0){const nt=this._tempVec.copy(this._focalPointHit).project(g.cameraObject).addScalar(1).divideScalar(2);a.crossCenter.set(nt.x,nt.y),a.computeCocMaterial.uniformsNeedUpdate=!0,a.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,i,s,a,h;if(this._uiConfig)return this._uiConfig;const g=(i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig;return g?((a=(s=g.children)===null||s===void 0?void 0:s.map($=>Ht($)))===null||a===void 0||a.flat(2).forEach($=>$&&($.onChange=this.setDirty)),(h=g.children)===null||h===void 0||h.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=g,g):{}}}n0.PluginType="DepthOfField",t0([Qn()],n0.prototype,"enableEdit",void 0),t0([Qn("focalPoint")],n0.prototype,"_focalPointHit",void 0),t0([Qn()],n0.prototype,"crossFadeTime",void 0);var $y,Uu=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let bu=$y=class extends Ks{constructor(c=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[El,Jr],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const a=zt`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,h=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${B1}
    
    #define THREE_PACKING_INCLUDED
    ${qw}
    
    ${Hv}
    ${bv}
    
    ${O1}

#endif
            
            `+d.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${a}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",h),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",d.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var a;const h=i.materialObject;let g=this.enabled&&s.userData.screenSpaceRendering!==!1&&!(!((a=h.userData)===null||a===void 0)&&a.sscsDisabled)?1:0;h.defines.SSCS_ENABLED!==g&&(h.defines.SSCS_ENABLED=g,h.needsUpdate=!0),g=this._defines.SSCS_STEP_COUNT,h.defines.SSCS_STEP_COUNT!==g&&(h.defines.SSCS_STEP_COUNT=g,h.needsUpdate=!0),g=+this._defines.SSCS_DEBUG,h.defines.SSCS_DEBUG!==g&&(h.defines.SSCS_DEBUG=g,h.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...$y._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,a,h;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(El),(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(cp),(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera,(a=this._viewer)===null||a===void 0?void 0:a.renderer,(h=this._viewer)===null||h===void 0?void 0:h.scene]}},this.enabled=c,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(c){var e,i;await super.onAdded(c),(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(c)}};bu.PluginType="SSContactShadows",bu._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new d.yGw},cameraPositionWorld:{value:new d.Pa4},cameraNearFar:{value:new d.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Uu([rs("Enabled"),Qn()],bu.prototype,"enabled",void 0),Uu([pn({uniforms:$y._uniforms,propKey:"sscsRadius"}),ls("Radius",[1e-4,.1],1e-4),Qn()],bu.prototype,"radius",void 0),Uu([pn({uniforms:$y._uniforms,propKey:"sscsIntensity"}),ls("Intensity",[1e-4,1],1e-4),Qn()],bu.prototype,"intensity",void 0),Uu([pn({uniforms:$y._uniforms,propKey:"sscsTolerance"}),ls("Tolerance",[.1,5]),Qn()],bu.prototype,"tolerance",void 0),Uu([On("SSCS_DEBUG",void 0,!0),rs("Debug only SSCS"),Qn()],bu.prototype,"onlySSCSDebug",void 0),Uu([On("SSCS_STEP_COUNT",void 0,!0),ls("Step count",[1,8],1),Qn()],bu.prototype,"stepCount",void 0),bu=$y=Uu([ho("Screen Space Contact Shadows")],bu);class vP{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:a,msg:h,transfer:g}=this.queue.shift();this.workersResolve[e]=a,this.workers[e].postMessage(h,g)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const a=this._getIdleWorker();a!==-1?(this._initWorker(a),this.workerStatus|=1<<a,this.workersResolve[a]=s,this.workers[a].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class r0{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Mx{constructor(e,i,s,a){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const Fp=[171,75,84,88,32,50,48,187,13,10,26,10];function iw(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}let IC,i0,PC;const a_={env:{emscripten_notify_memory_growth:function(c){PC=new Uint8Array(i0.exports.memory.buffer)}}};class zT{init(){return IC||(IC=typeof fetch<"u"?fetch("data:application/wasm;base64,"+DC).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,a_)).then(this._init):WebAssembly.instantiate(Buffer.from(DC,"base64"),a_).then(this._init),IC)}_init(e){i0=e.instance,a_.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!i0)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,a=i0.exports.malloc(s);PC.set(e,a),i=i||Number(i0.exports.ZSTD_findDecompressedSize(a,s));const h=i0.exports.malloc(i),g=i0.exports.ZSTD_decompress(h,i,a,s),$=PC.slice(h,h+g);return i0.exports.free(a),i0.exports.free(h),$}}const DC="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",yE=new WeakMap;let AE,Tx=0;class l_ extends d.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new vP,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new d.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new d.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const a=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,a]).then(([h,g])=>{const $=l_.BasisWorker.toString(),nt=["/* constants */","let _EngineFormat = "+JSON.stringify(l_.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(l_.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(l_.BasisFormat),"/* basis_transcoder.js */",h,"/* worker */",$.substring($.indexOf("{")+1,$.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([nt])),this.transcoderBinary=g,this.workerPool.setWorkerCreator(()=>{const rt=new Worker(this.workerSourceURL),st=this.transcoderBinary.slice(0);return rt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:st},[st]),rt})}),Tx>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Tx++}return this.transcoderPending}load(e,i,s,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const h=new d.hH6(this.manager);h.setResponseType("arraybuffer"),h.setWithCredentials(this.withCredentials),h.load(e,g=>{if(yE.has(g))return yE.get(g).promise.then(i).catch(a);this.createTexture(g).then($=>i?i($):null).catch(a)},s,a)}_createTextureFrom(e){const{mipmaps:i,width:s,height:a,format:h,type:g,error:$,dfdTransferFn:nt,dfdFlags:rt}=e;if(g==="error")return Promise.reject($);const st=new d.EB7(i,s,a,h,d.ywz);return st.minFilter=i.length===1?d.wem:d.D1R,st.magFilter=d.wem,st.generateMipmaps=!1,st.needsUpdate=!0,st.encoding=nt===2?d.knz:d.rnI,st.premultiplyAlpha=!!(1&rt),st}createTexture(e,i={}){const s=function(g){const $=new Uint8Array(g.buffer,g.byteOffset,Fp.length);if($[0]!==Fp[0]||$[1]!==Fp[1]||$[2]!==Fp[2]||$[3]!==Fp[3]||$[4]!==Fp[4]||$[5]!==Fp[5]||$[6]!==Fp[6]||$[7]!==Fp[7]||$[8]!==Fp[8]||$[9]!==Fp[9]||$[10]!==Fp[10]||$[11]!==Fp[11])throw new Error("Missing KTX 2.0 identifier.");const nt=new r0,rt=17*Uint32Array.BYTES_PER_ELEMENT,st=new Mx(g,Fp.length,rt,!0);nt.vkFormat=st._nextUint32(),nt.typeSize=st._nextUint32(),nt.pixelWidth=st._nextUint32(),nt.pixelHeight=st._nextUint32(),nt.pixelDepth=st._nextUint32(),nt.layerCount=st._nextUint32(),nt.faceCount=st._nextUint32();const ut=st._nextUint32();nt.supercompressionScheme=st._nextUint32();const mt=st._nextUint32(),gt=st._nextUint32(),yt=st._nextUint32(),wt=st._nextUint32(),It=st._nextUint64(),Et=st._nextUint64(),Ct=new Mx(g,Fp.length+rt,3*ut*8,!0);for(let Nr=0;Nr<ut;Nr++)nt.levels.push({levelData:new Uint8Array(g.buffer,g.byteOffset+Ct._nextUint64(),Ct._nextUint64()),uncompressedByteLength:Ct._nextUint64()});const xt=new Mx(g,mt,gt,!0),Bt={vendorId:xt._skip(4)._nextUint16(),descriptorType:xt._nextUint16(),versionNumber:xt._nextUint16(),descriptorBlockSize:xt._nextUint16(),colorModel:xt._nextUint8(),colorPrimaries:xt._nextUint8(),transferFunction:xt._nextUint8(),flags:xt._nextUint8(),texelBlockDimension:[xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8()],bytesPlane:[xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8()],samples:[]},Lt=(Bt.descriptorBlockSize/4-6)/4;for(let Nr=0;Nr<Lt;Nr++){const Fr={bitOffset:xt._nextUint16(),bitLength:xt._nextUint8(),channelType:xt._nextUint8(),samplePosition:[xt._nextUint8(),xt._nextUint8(),xt._nextUint8(),xt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Fr.channelType?(Fr.sampleLower=xt._nextInt32(),Fr.sampleUpper=xt._nextInt32()):(Fr.sampleLower=xt._nextUint32(),Fr.sampleUpper=xt._nextUint32()),Bt.samples[Nr]=Fr}nt.dataFormatDescriptor.length=0,nt.dataFormatDescriptor.push(Bt);const Gt=new Mx(g,yt,wt,!0);for(;Gt._offset<wt;){const Nr=Gt._nextUint32(),Fr=Gt._scan(Nr),Vr=iw(Fr),ps=Gt._scan(Nr-Fr.byteLength);nt.keyValue[Vr]=Vr.match(/^ktx/i)?iw(ps):ps,Gt._offset%4&&Gt._skip(4-Gt._offset%4)}if(Et<=0)return nt;const Xt=new Mx(g,It,Et,!0),rn=Xt._nextUint16(),fn=Xt._nextUint16(),wn=Xt._nextUint32(),Cn=Xt._nextUint32(),bn=Xt._nextUint32(),Dn=Xt._nextUint32(),En=[];for(let Nr=0;Nr<ut;Nr++)En.push({imageFlags:Xt._nextUint32(),rgbSliceByteOffset:Xt._nextUint32(),rgbSliceByteLength:Xt._nextUint32(),alphaSliceByteOffset:Xt._nextUint32(),alphaSliceByteLength:Xt._nextUint32()});const Tn=It+Xt._offset,Un=Tn+wn,Pn=Un+Cn,Yn=Pn+bn,cr=new Uint8Array(g.buffer,g.byteOffset+Tn,wn),mr=new Uint8Array(g.buffer,g.byteOffset+Un,Cn),ir=new Uint8Array(g.buffer,g.byteOffset+Pn,bn),Dr=new Uint8Array(g.buffer,g.byteOffset+Yn,Dn);return nt.globalData={endpointCount:rn,selectorCount:fn,imageDescs:En,endpointsData:cr,selectorsData:mr,tablesData:ir,extendedData:Dr},nt}(new Uint8Array(e));if(s.vkFormat!==0)return async function(g){const{vkFormat:$,pixelWidth:nt,pixelHeight:rt,pixelDepth:st}=g;if(RC[$]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const ut=g.levels[0];let mt,gt;if(g.supercompressionScheme===0)mt=ut.levelData;else{if(g.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");AE||(AE=new Promise(async wt=>{const It=new zT;await It.init(),wt(It)})),mt=(await AE).decode(ut.levelData,ut.uncompressedByteLength)}gt=wE[$]===d.VzW?new Float32Array(mt.buffer,mt.byteOffset,mt.byteLength/Float32Array.BYTES_PER_ELEMENT):wE[$]===d.cLu?new Uint16Array(mt.buffer,mt.byteOffset,mt.byteLength/Uint16Array.BYTES_PER_ELEMENT):mt;const yt=st===0?new d.IEO(gt,nt,rt):new d.JUT(gt,nt,rt,st);return yt.type=wE[$],yt.format=RC[$],yt.encoding=Ix[$]||d.rnI,yt.needsUpdate=!0,Promise.resolve(yt)}(s);const a=i,h=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(g=>this._createTextureFrom(g.data));return yE.set(e,{promise:h}),h}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Tx--,this}}l_.BasisFormat={ETC1S:0,UASTC_4x4:1},l_.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},l_.EngineFormat={RGBAFormat:d.wk1,RGBA_ASTC_4x4_Format:d.ptH,RGBA_BPTC_Format:d.bsb,RGBA_ETC2_EAC_Format:d.ekQ,RGBA_PVRTC_4BPPV1_Format:d.eaV,RGBA_S3TC_DXT5_Format:d.ILR,RGB_ETC1_Format:d.fto,RGB_ETC2_Format:d.l0P,RGB_PVRTC_4BPPV1_Format:d._AM,RGB_S3TC_DXT1_Format:d.wuA},l_.BasisWorker=function(){let c,e,i;const s=_EngineFormat,a=_TranscoderFormat,h=_BasisFormat;self.addEventListener("message",function(st){const ut=st.data;switch(ut.type){case"init":c=ut.config,mt=ut.transcoderBinary,e=new Promise(gt=>{i={wasmBinary:mt,onRuntimeInitialized:gt},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:gt,height:yt,hasAlpha:wt,mipmaps:It,format:Et,dfdTransferFn:Ct,dfdFlags:xt}=function(Lt){const Gt=new i.KTX2File(new Uint8Array(Lt));function Xt(){Gt.close(),Gt.delete()}if(!Gt.isValid())throw Xt(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const rn=Gt.isUASTC()?h.UASTC_4x4:h.ETC1S,fn=Gt.getWidth(),wn=Gt.getHeight(),Cn=Gt.getLevels(),bn=Gt.getHasAlpha(),Dn=Gt.getDFDTransferFunc(),En=Gt.getDFDFlags(),{transcoderFormat:Tn,engineFormat:Un}=function(Yn,cr,mr,ir){let Dr,Nr;const Fr=Yn===h.ETC1S?$:nt;for(let Vr=0;Vr<Fr.length;Vr++){const ps=Fr[Vr];if(c[ps.if]&&ps.basisFormat.includes(Yn)&&!(ir&&ps.transcoderFormat.length<2)&&(!ps.needsPowerOfTwo||rt(cr)&&rt(mr)))return Dr=ps.transcoderFormat[ir?1:0],Nr=ps.engineFormat[ir?1:0],{transcoderFormat:Dr,engineFormat:Nr}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),Dr=a.RGBA32,Nr=s.RGBAFormat,{transcoderFormat:Dr,engineFormat:Nr}}(rn,fn,wn,bn);if(!fn||!wn||!Cn)throw Xt(),new Error("THREE.KTX2Loader:	Invalid texture");if(!Gt.startTranscoding())throw Xt(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Pn=[];for(let Yn=0;Yn<Cn;Yn++){const cr=Gt.getImageLevelInfo(Yn,0,0),mr=cr.origWidth,ir=cr.origHeight,Dr=new Uint8Array(Gt.getImageTranscodedSizeInBytes(Yn,0,0,Tn));if(!Gt.transcodeImage(Dr,Yn,0,0,Tn,0,-1,-1))throw Xt(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Pn.push({data:Dr,width:mr,height:ir})}return Xt(),{width:fn,height:wn,hasAlpha:bn,mipmaps:Pn,format:Un,dfdTransferFn:Dn,dfdFlags:En}}(ut.buffer),Bt=[];for(let Lt=0;Lt<It.length;++Lt)Bt.push(It[Lt].data.buffer);self.postMessage({type:"transcode",id:ut.id,width:gt,height:yt,hasAlpha:wt,mipmaps:It,format:Et,dfdTransferFn:Ct,dfdFlags:xt},Bt)}catch(gt){console.error(gt),self.postMessage({type:"error",id:ut.id,error:gt.message})}})}var mt});const g=[{if:"astcSupported",basisFormat:[h.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],$=g.sort(function(st,ut){return st.priorityETC1S-ut.priorityETC1S}),nt=g.sort(function(st,ut){return st.priorityUASTC-ut.priorityUASTC});function rt(st){return st<=2||(st&st-1)==0&&st!==0}};const RC={109:d.wk1,97:d.wk1,37:d.wk1,43:d.wk1,103:d.av9,83:d.av9,16:d.av9,22:d.av9,100:d.hEm,76:d.hEm,15:d.hEm,9:d.hEm},wE={109:d.VzW,97:d.cLu,37:d.ywz,43:d.ywz,103:d.VzW,83:d.cLu,16:d.ywz,22:d.ywz,100:d.VzW,76:d.cLu,15:d.ywz,9:d.ywz},Ix={43:d.knz,22:d.knz,15:d.knz},Px="KHR_texture_basisu";class kC extends _e{constructor(){super(...arguments),this.dependencies=[Jr]}async onAdded(e){var i,s,a,h;this._importer||(this._importer=new Ul(class extends l_{constructor(g){super(g),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(g,$){const nt=g.map(st=>new Uint8Array(st.slice(0))),rt=await super.createTexture(g,$);return rt.source._sourceImgBuffer=nt,rt.userData.mimeType="image/ktx2",rt}},["ktx2"],!1)),oo.Importers.push(this._importer),(h=(a=(s=(i=e.getManager())===null||i===void 0?void 0:i.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(VT)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&oo.Importers.splice(oo.Importers.indexOf(this._importer),1),this._importer=void 0}}kC.PluginType="KTX2LoadPlugin";const VT=c=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer;if(!s||!s.length)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const a={},h=new Blob(Array.isArray(s)?s:[s],{type:"image/ktx2"});a.source=c.processImageBlob(h,e),i.extensions[Px]=a,c.extensionsUsed[Px]=!0}});class xE{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,i,s){var a,h;if(!i)return void(this.selected=void 0);let g=this.presets.find($=>$.path===i.path);return g||(this.presets.push(i),g=i),this.selected=g,(h=(a=e.getManager())===null||a===void 0?void 0:a.importer)===null||h===void 0?void 0:h.importAsset(g,s)}}class QT extends xE{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&(a.encoding=d.knz,await e.setBackground(a)),a}}class GT extends xE{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&await e.scene.setEnvironment(a),a}}class HT extends xE{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return sn(e.getPluginByType("Diamond"),"envMap",a),a}}class Dx extends xE{async apply(e,i){var s,a;const h=await super.apply(e,i,{processImported:!1});return h?(a=(s=e.getManager())===null||s===void 0?void 0:s.importer)===null||a===void 0?void 0:a.processImported(h):void 0}}class bE extends Dx{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class s0 extends Ks{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>({label:i.path.split("/").pop(),value:i.path}))],getValue:()=>{var i;return((i=e.selected)===null||i===void 0?void 0:i.path)||""},setValue:i=>{e.apply(this._viewer,e.presets.find(s=>s.path===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();Wp(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();Wp(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new QT),this.presetGroups.push(new GT),this.presetGroups.push(new HT),this.presetGroups.push(new Dx("Ground")),this.presetGroups.push(new Dx("CameraViews")),this.presetGroups.push(new Dx("MaterialConfiguration")),this.presetGroups.push(new bE),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>{var s;return[i.name,((s=i.selected)===null||s===void 0?void 0:s.path)||void 0]}).filter(([,i])=>i));return e.type=s0.PluginType,e}async fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;const h={...e};delete h.type;const g=[];for(const[$,nt]of Object.entries(h)){const rt=this.presetGroups.find(mt=>mt.name===$),st=rt==null?void 0:rt.presets;if(!rt||!st)continue;const ut=typeof nt=="string"?{path:nt}:nt;g.push(rt.apply(this._viewer,ut))}return await Promise.all(g),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0),this}loadPresetGroups(e){var i;for(const[s,a]of Object.entries(e)){const h=(i=this.presetGroups.find(g=>g.name===s))===null||i===void 0?void 0:i.presets;h==null||h.push(...a)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(i=>i.path)]).filter(([,e])=>e.length>0))}}s0.PluginType="PresetLibraryPlugin";var c_=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let mm=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const c=await S_(!0,!1,"model/gltf");await this.loadScenes(c)}async loadScenes(c){var e,i;const s=await Promise.all(c.map(async a=>await a.arrayBuffer()));for(let a=0;a<c.length;a++){const h=c[a];this.scenes.push({[h.name]:new Uint8Array(s[a])}),this.assets[h.name]={path:h.name,file:h}}(i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e)}async play(){var c;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const i=this._viewer.getPluginByType("FrameFade"),s=this._viewer.getPluginByType("GLTFAnimation"),a=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const h of this.scenes){if(!this._isPlaying)break;const g=Object.keys(h);s==null||s.stopAnimation(!1),await(a==null?void 0:a.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const nt of g){let rt=this.assets[nt];rt||(rt={path:nt,file:new File([h[nt]],nt)},this.assets[nt]=rt),await((c=this._viewer.getManager())===null||c===void 0?void 0:c.addAssetSingle(rt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),i&&(i.enabled=!0,await i.startTransition(1e3));const $=[ou(this.minSceneTime)];s&&$.push(s.playAnimation()),a&&$.push(a.animateAllViews()),await Promise.all($)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const c={};for(const i of this.scenes)for(const s of Object.keys(i)){const a=c[s]?s+"_":s;c[a]=i[a]}const e=NM(c);Tu(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(c){await super.onAdded(c);const e=this;oo.Importers.push(new Ul(class extends I1{load(i,s,a,h){super.load(i,g=>{e.loadScenes([...g.values()]),s==null||s(null),ou(100).then(e.play)},a,h)}},["glbloop"],!0))}};mm.PluginType="SceneLoopPlugin",c_([Fm("Loaded scenes")],mm.prototype,"loadedScenes",null),c_([No("Load Scenes")],mm.prototype,"promptLoadScenes",null),c_([Fm("Playing")],mm.prototype,"_isPlaying",void 0),c_([uo("Min Scene Time")],mm.prototype,"minSceneTime",void 0),c_([No("Play")],mm.prototype,"play",null),c_([No("Stop")],mm.prototype,"stop",null),c_([No("Download Scenes")],mm.prototype,"downloadScenes",null),mm=c_([ho("Scene Loop")],mm);var WT=__webpackgi_require__(701),BC=__webpackgi_require__.n(WT),_P=__webpackgi_require__(236),EE=__webpackgi_require__.n(_P),qT=__webpackgi_require__(850),OC=__webpackgi_require__.n(qT),SE=__webpackgi_require__(182),Rx=__webpackgi_require__.n(SE),yP=__webpackgi_require__(213),LC=__webpackgi_require__.n(yP),CE=__webpackgi_require__(798),sw={};CE.Z&&CE.Z.locals&&(sw.locals=CE.Z.locals);var ME,o0=0,Jy={};Jy.styleTagTransform=LC(),Jy.setAttributes=OC(),Jy.insert=function(c,e){(e.target||document.head).appendChild(c)},Jy.domAPI=EE(),Jy.insertStyleElement=Rx(),sw.use=function(c){return Jy.options=c||{},o0++||(ME=BC()(CE.Z,Jy)),sw},sw.unuse=function(){o0>0&&!--o0&&(ME(),ME=null)};var TE,YT=sw,Z0=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let a0=TE=class extends Ks{constructor(){super(),this.enabled=!0,this.dependencies=[Jr],this._popupDiv=Ml({id:"assetManagerPopup",addToBody:!1,innerHTML:""});const c=Ml({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});c.addEventListener("click",()=>{this._popupDiv.style.display="none"}),this._popupContent=Ml({id:"assetManagerPopupContent",addToBody:!1,innerHTML:""}),this.enabled||(this._popupDiv.style.display="none"),this._popupDiv.appendChild(c),this._popupDiv.appendChild(this._popupContent)}_onEnabledChange(){this.enabled||(this._popupDiv.style.display="none")}_updatePopupDiv(c){if(!this._popupContent)return;if(!this.enabled)return void(this._popupDiv.style.display="none");let e="";c.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${s.split("/").pop()} ${i.progress?" - "+i.progress:""}<br>`}),this._popupContent.innerHTML=e,c.size===0?this._popupDiv.style.display="none":this._popupDiv.style.display="block"}async onAdded(c){var e,i,s,a;await super.onAdded(c),YT.use({target:c.container}),c.container.appendChild(this._popupDiv);const h=new Map;(i=(e=c.getManager())===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("importFile",g=>{g.state!=="done"?h.set(g.path,{state:g.state,progress:g.progress?(100*g.progress).toFixed(0)+"%":void 0}):h.delete(g.path),this._updatePopupDiv(h)}),(a=(s=c.getManager())===null||s===void 0?void 0:s.exporter)===null||a===void 0||a.addEventListener("exportFile",g=>{g.state!=="done"?h.set(g.obj.name,{state:g.state,progress:g.progress?(100*g.progress).toFixed(0)+"%":void 0}):h.delete(g.obj.name),this._updatePopupDiv(h)})}};a0.PluginType="AssetManagerBasicPopupPlugin",Z0([rs("Enabled"),hn(TE.prototype._onEnabledChange),Qn()],a0.prototype,"enabled",void 0),a0=TE=Z0([ho("Asset manager popup")],a0);class AP extends Au{constructor(e){super({vertexShader:it.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new T_}render(e,i,s,a,h){super.render(e,i,s,a,h),this.needsSwap=!0}}class Mp extends Av{constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[El],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}get renderToScreen(){return this._renderToScreen}async onAdded(e){var i,s;return!((s=(i=this._viewer)===null||i===void 0?void 0:i.screenShader)===null||s===void 0)&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&sn(e.renderer.passes.find(a=>a.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var i,s,a,h;const g=e.screenShader,$=["",""];this._renderToScreen&&!g.isShaderPass2&&($[0]=Array.isArray(g)?g[0]:((i=g)===null||i===void 0?void 0:i.pars)||"",$[1]=Array.isArray(g)?g[1]:typeof g=="string"?g:((s=g)===null||s===void 0?void 0:s.main)||"");const nt=new AP($);return sn((h=(a=nt.uiConfig)===null||a===void 0?void 0:a.children)===null||h===void 0?void 0:h.find(rt=>{var st;return((st=rt)===null||st===void 0?void 0:st.label)==="Enabled"}),"hidden",!0,!0),nt}_update(e){var i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)===null||i===void 0?void 0:i.getPlugin(El)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i,s;return(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}Mp.PluginType="CombinedPostPlugin";var XT=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class l0 extends Ks{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Mp]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(Mp))===null||i===void 0||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}XT([Qn("extension")],l0.prototype,"_extension",void 0),XT([Qn()],l0.prototype,"enabled",void 0);class ey{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=Fl(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class IE extends l0{generateExtension(e){return new ey}}IE.PluginType="GammaCorrection";var kx,Dv=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const KT=d.dZ3;let ty=kx=class{constructor(c,e=!0,i=!0){this.depthTonemap=e,this.toneMapping=d.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(s,a)=>this.enabled?zt`
            ${this.depthTonemap?Hv:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getGBufferFlags(vUv).x>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=c.getPlugin(Mp),this._setDirty=this._setDirty.bind(this),this._renderToScreen=i,this.depthTonemap=e}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Fl(c.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:a,outputEncoding:h}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=a,this._rendererState.outputEncoding=h;let g=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==g&&(e.materialObject.defines.TONEMAP_BACKGROUND=g,e.materialObject.needsUpdate=!0),g=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==g&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=g,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputEncoding=d.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(c,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};ty.PluginType="Tonemap",Dv([yp("Mode",[["Linear",d.EoG],["Reinhard",d.CdI],["Cineon",d.YGz],["ACESFilmic",d.LY2],["Uncharted2",KT]].map(c=>({label:c[0],value:c[1]})),{limitedUi:!0}),hn(kx.prototype._setDirty),Qn()],ty.prototype,"toneMapping",void 0),Dv([rs("Tonemap Background",{limitedUi:!0}),Qn()],ty.prototype,"tonemapBackground",void 0),Dv([hn(kx.prototype._setDirty),rs("Clip Background"),Qn()],ty.prototype,"clipBackground",void 0),Dv([hn(kx.prototype._setDirty),ls("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Qn()],ty.prototype,"exposure",void 0),ty=kx=Dv([ho("Tonemapping")],ty);class Bx extends l0{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}generateExtension(e){return new ty(e,this.depthTonemap)}get exposure(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&i!==void 0?i:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&i!==void 0?i:d.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}}Bx.PluginType="Tonemap",d.WdD.tonemapping_pars_fragment=d.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Ox,ow=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let aw=Ox=class{constructor(c){this.enabled=!1,this.intensity=1,this.lutMap=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
vec4 colorLookUp(in vec4 color){vec4 outColor;float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);float lutFac=step(0.0001,getGBufferFlags(vUv).a);
#if USE_3DTEXTURE == 1
outColor=vec4(texture(lut3d,uvw).rgb,color.a);
#else
outColor=vec4(lutLookup(lut,lutSize,uvw),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=c.getPlugin(Mp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Fl(c.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                gl_FragColor = colorLookUp(gl_FragColor);
            #endif
            #glMarker
        `))}onObjectRender(c,e,i){if(this.enabled)if(this.lutMap){const s=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==s&&(e.materialObject.defines.USE_3DTEXTURE=s,e.materialObject.needsUpdate=!0);let a=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,a=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,a=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=a,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}};ow([Qn(),hn(Ox.prototype._setDirty),rs("Enable")],aw.prototype,"enabled",void 0),ow([Qn(),hn(Ox.prototype._setDirty),ls("Intensity")],aw.prototype,"intensity",void 0),ow([hn(Ox.prototype._setDirty),Sy("LUT"),Qn()],aw.prototype,"lutMap",void 0),aw=Ox=ow([ho("LUT")],aw);class PE extends l0{generateExtension(e){return new aw(e)}}PE.PluginType="LUT";var Lx,Po=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Zy=Lx=class{constructor(c){this.enabled=!1,this.power=.5,this.bgcolor=new d.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new d.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?zt`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(Mp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Fl(c.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};Zy.PluginType="Vignette",Po([hn(Lx.prototype._setDirty),rs("Enable"),Qn()],Zy.prototype,"enabled",void 0),Po([hn(Lx.prototype._setDirty),ls("Power",[.1,4],.01,{limitedUi:!0}),Qn()],Zy.prototype,"power",void 0),Po([hn(Lx.prototype._setDirty),cv("Color"),Qn()],Zy.prototype,"bgcolor",void 0),Zy=Lx=Po([ho("Vignette")],Zy);class DE extends l0{constructor(){super()}generateExtension(e){return new Zy(e)}get power(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&i!==void 0?i:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&i!==void 0?i:new d.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}DE.PluginType="Vignette";var RE,NC=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let ny=RE=class{constructor(c){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?zt`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(Mp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Fl(c.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};ny.PluginType="ChromaticAberration",NC([hn(RE.prototype._setDirty),rs("Enable"),Qn()],ny.prototype,"enabled",void 0),NC([hn(RE.prototype._setDirty),ls("Intensity",[0,.1],.001,{limitedUi:!0}),Qn()],ny.prototype,"aberrationIntensity",void 0),ny=RE=NC([ho("ChromaticAberration")],ny);class kE extends l0{constructor(){super()}generateExtension(e){return new ny(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}kE.PluginType="ChromaticAberration";var Nx,BE=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let lw=Nx=class{constructor(c){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?zt`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(Mp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Fl(c.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};BE([hn(Nx.prototype._setDirty),rs("Enable"),Qn()],lw.prototype,"enabled",void 0),BE([hn(Nx.prototype._setDirty),rs("Multiply"),Qn()],lw.prototype,"grainMultiply",void 0),BE([hn(Nx.prototype._setDirty),ls("Intensity",[0,20],.01,{limitedUi:!0}),Qn()],lw.prototype,"grainIntensity",void 0),lw=Nx=BE([ho("FilmicGrain")],lw);class OE extends l0{constructor(){super()}generateExtension(e){return new lw(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&i!==void 0&&i}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}async function LE(c,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:a=!1}={}){await c.addPlugin(El),await c.addPlugin(iu),a&&await c.addPlugin(Hw),await c.addPlugin(new cp(32)),await c.addPlugin(new Mp),await c.addPlugin(new kE),await c.addPlugin(new Bx(s||!c.useRgbm)),await c.addPlugin(new PE),await c.addPlugin(new DE),await c.addPlugin(new OE),await c.addPlugin(new IE),await c.addPlugin(N1),await c.addPlugin(U1),await c.addPlugin(Yl),await c.addPlugin(K_),await c.addPlugin(Ol),e&&await c.addPlugin(um),i&&await c.addPlugin(K0),await c.addPlugin(dm),await c.addPlugin(Cm),await c.addPlugin(up),await c.addPlugin(_d),await c.addPlugin(Xm),await c.addPlugin(xx,!1),await c.addPlugin(bx),await c.addPlugin(au),await c.addPlugin(Z_,!1),await c.addPlugin(fm,!1),await c.addPlugin(n0,!1),await c.addPlugin(bu,!1),await c.addPlugin(kC),await c.addPlugin(s0),await c.addPlugin(mm)}async function NE(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,enableDrop:g=!1}={}){var $;const nt=new Wm(c);e&&await nt.addPlugin(Mv);const rt=await nt.addPlugin(Jr,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return h&&await nt.addPlugin(a0),await LE(nt,{ground:i,bloom:s,depthTonemap:a,enableDrop:g}),nt.renderer.refreshPipeline(),($=rt.importer)===null||$===void 0||$.processors.add("model",{forAssetType:"model",process:(st,ut)=>st}),nt}OE.PluginType="FilmicGrain";let wP=0;class $T extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=wP++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=E_(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=Wt`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await NE({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,i,s){console.log("WebGiViewerElement attributes changed.",e,i,s),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],a=[];for(const h of i)!this._models[h]&&h&&(this._models[h]=this.viewer.getManager().importer.importPath(h,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[h,g]of Object.entries(this._models))i.includes(h)?s.push(g):a.push(g);await Promise.all([Promise.all(s).then(async h=>Promise.all(h.map(async g=>this.viewer.getManager().importer.processImported(g)))).then(h=>{for(const g of h)for(const $ of g)$&&$.assetType==="model"&&this.viewer.scene.addSceneObject($)}),Promise.all(a).then(h=>{for(const g of h)for(const $ of g)$&&$.assetType==="model"&&$.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",$T);class JT{constructor(e){var i,s,a;this._basePath=(i=e==null?void 0:e.basePath)!==null&&i!==void 0?i:"",this._assets=(a=(s=e==null?void 0:e.assets)===null||s===void 0?void 0:s.map(h=>this._resolveAsset(h)))!==null&&a!==void 0?a:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const i=this._assets.find(e);return i??void 0}_resolveAsset(e){return{...e,path:x0([this._basePath,e.path])}}}class xP extends _e{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(a=>{var h,g;return a&&(e.test(a.path)||e.test((g=(h=a.file)===null||h===void 0?void 0:h.name)!==null&&g!==void 0?g:""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}var FC={},cw=function(c){return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))},ZT=function(c){return new Worker(c)};try{URL.revokeObjectURL(cw(""))}catch{cw=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ZT=function(e){return new Worker(e,{type:"module"})}}var Co=Uint8Array,ep=Uint16Array,Tp=Uint32Array,c0=new Co([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ry=new Co([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fx=new Co([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UC=function(c,e){for(var i=new ep(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Tp(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},eI=UC(c0,2),jC=eI[0],Ux=eI[1];jC[28]=258,Ux[258]=28;for(var zC=UC(ry,0),tI=zC[0],VC=zC[1],jx=new ep(32768),Gl=0;Gl<32768;++Gl){var u_=(43690&Gl)>>>1|(21845&Gl)<<1;u_=(61680&(u_=(52428&u_)>>>2|(13107&u_)<<2))>>>4|(3855&u_)<<4,jx[Gl]=((65280&u_)>>>8|(255&u_)<<8)>>>1}var Tm=function(c,e,i){for(var s=c.length,a=0,h=new ep(e);a<s;++a)++h[c[a]-1];var g,$=new ep(e);for(a=0;a<e;++a)$[a]=$[a-1]+h[a-1]<<1;if(i){g=new ep(1<<e);var nt=15-e;for(a=0;a<s;++a)if(c[a])for(var rt=a<<4|c[a],st=e-c[a],ut=$[c[a]-1]++<<st,mt=ut|(1<<st)-1;ut<=mt;++ut)g[jx[ut]>>>nt]=rt}else for(g=new ep(s),a=0;a<s;++a)c[a]&&(g[a]=jx[$[c[a]-1]++]>>>15-c[a]);return g},u0=new Co(288);for(Gl=0;Gl<144;++Gl)u0[Gl]=8;for(Gl=144;Gl<256;++Gl)u0[Gl]=9;for(Gl=256;Gl<280;++Gl)u0[Gl]=7;for(Gl=280;Gl<288;++Gl)u0[Gl]=8;var h0=new Co(32);for(Gl=0;Gl<32;++Gl)h0[Gl]=5;var lu=Tm(u0,9,0),nI=Tm(u0,9,1),mu=Tm(h0,5,0),zx=Tm(h0,5,1),FE=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},$m=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},UE=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},uw=function(c){return(c/8|0)+(7&c&&1)},Up=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof ep?ep:c instanceof Tp?Tp:Co)(i-e);return s.set(c.subarray(e,i)),s},eA=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new Co(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new Co(3*s));var g=function(ps){var yr=e.length;if(ps>yr){var Ws=new Co(Math.max(2*yr,ps));Ws.set(e),e=Ws}},$=i.f||0,nt=i.p||0,rt=i.b||0,st=i.l,ut=i.d,mt=i.m,gt=i.n,yt=8*s;do{if(!st){i.f=$=$m(c,nt,1);var wt=$m(c,nt+1,3);if(nt+=3,!wt){var It=c[(Cn=uw(nt)+4)-4]|c[Cn-3]<<8,Et=Cn+It;if(Et>s){if(h)throw"unexpected EOF";break}a&&g(rt+It),e.set(c.subarray(Cn,Et),rt),i.b=rt+=It,i.p=nt=8*Et;continue}if(wt==1)st=nI,ut=zx,mt=9,gt=5;else{if(wt!=2)throw"invalid block type";var Ct=$m(c,nt,31)+257,xt=$m(c,nt+10,15)+4,Bt=Ct+$m(c,nt+5,31)+1;nt+=14;for(var Lt=new Co(Bt),Gt=new Co(19),Xt=0;Xt<xt;++Xt)Gt[Fx[Xt]]=$m(c,nt+3*Xt,7);nt+=3*xt;var rn=FE(Gt),fn=(1<<rn)-1,wn=Tm(Gt,rn,1);for(Xt=0;Xt<Bt;){var Cn,bn=wn[$m(c,nt,fn)];if(nt+=15&bn,(Cn=bn>>>4)<16)Lt[Xt++]=Cn;else{var Dn=0,En=0;for(Cn==16?(En=3+$m(c,nt,3),nt+=2,Dn=Lt[Xt-1]):Cn==17?(En=3+$m(c,nt,7),nt+=3):Cn==18&&(En=11+$m(c,nt,127),nt+=7);En--;)Lt[Xt++]=Dn}}var Tn=Lt.subarray(0,Ct),Un=Lt.subarray(Ct);mt=FE(Tn),gt=FE(Un),st=Tm(Tn,mt,1),ut=Tm(Un,gt,1)}if(nt>yt){if(h)throw"unexpected EOF";break}}a&&g(rt+131072);for(var Pn=(1<<mt)-1,Yn=(1<<gt)-1,cr=nt;;cr=nt){var mr=(Dn=st[UE(c,nt)&Pn])>>>4;if((nt+=15&Dn)>yt){if(h)throw"unexpected EOF";break}if(!Dn)throw"invalid length/literal";if(mr<256)e[rt++]=mr;else{if(mr==256){cr=nt,st=null;break}var ir=mr-254;if(mr>264){var Dr=c0[Xt=mr-257];ir=$m(c,nt,(1<<Dr)-1)+jC[Xt],nt+=Dr}var Nr=ut[UE(c,nt)&Yn],Fr=Nr>>>4;if(!Nr)throw"invalid distance";if(nt+=15&Nr,Un=tI[Fr],Fr>3&&(Dr=ry[Fr],Un+=UE(c,nt)&(1<<Dr)-1,nt+=Dr),nt>yt){if(h)throw"unexpected EOF";break}a&&g(rt+131072);for(var Vr=rt+ir;rt<Vr;rt+=4)e[rt]=e[rt-Un],e[rt+1]=e[rt+1-Un],e[rt+2]=e[rt+2-Un],e[rt+3]=e[rt+3-Un];rt=Vr}}i.l=st,i.p=cr,i.b=rt,st&&($=1,i.m=mt,i.d=ut,i.n=gt)}while(!$);return rt==e.length?e:Up(e,0,rt)},h_=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},hw=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},jE=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[d0,0];if(a==1){var g=new Co(i[0].s+1);return g[i[0].s]=1,[g,1]}i.sort(function(Lt,Gt){return Lt.f-Gt.f}),i.push({s:-1,f:25001});var $=i[0],nt=i[1],rt=0,st=1,ut=2;for(i[0]={s:-1,f:$.f+nt.f,l:$,r:nt};st!=a-1;)$=i[i[rt].f<i[ut].f?rt++:ut++],nt=i[rt!=st&&i[rt].f<i[ut].f?rt++:ut++],i[st++]={s:-1,f:$.f+nt.f,l:$,r:nt};var mt=h[0].s;for(s=1;s<a;++s)h[s].s>mt&&(mt=h[s].s);var gt=new ep(mt+1),yt=Jm(i[st-1],gt,0);if(yt>e){s=0;var wt=0,It=yt-e,Et=1<<It;for(h.sort(function(Lt,Gt){return gt[Gt.s]-gt[Lt.s]||Lt.f-Gt.f});s<a;++s){var Ct=h[s].s;if(!(gt[Ct]>e))break;wt+=Et-(1<<yt-gt[Ct]),gt[Ct]=e}for(wt>>>=It;wt>0;){var xt=h[s].s;gt[xt]<e?wt-=1<<e-gt[xt]++-1:++s}for(;s>=0&&wt;--s){var Bt=h[s].s;gt[Bt]==e&&(--gt[Bt],++wt)}yt=e}return[new Co(gt),yt]},Jm=function(c,e,i){return c.s==-1?Math.max(Jm(c.l,e,i+1),Jm(c.r,e,i+1)):e[c.s]=i},QC=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new ep(++e),s=0,a=c[0],h=1,g=function(nt){i[s++]=nt},$=1;$<=e;++$)if(c[$]==a&&$!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)g(32754);h>2&&(g(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(g(a),--h;h>6;h-=6)g(8304);h>2&&(g(h-3<<5|8208),h=0)}for(;h--;)g(a);h=1,a=c[$]}return[i.subarray(0,s),e]},dw=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Vx=function(c,e,i){var s=i.length,a=uw(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},GC=function(c,e,i,s,a,h,g,$,nt,rt,st){h_(e,st++,i),++a[256];for(var ut=jE(a,15),mt=ut[0],gt=ut[1],yt=jE(h,15),wt=yt[0],It=yt[1],Et=QC(mt),Ct=Et[0],xt=Et[1],Bt=QC(wt),Lt=Bt[0],Gt=Bt[1],Xt=new ep(19),rn=0;rn<Ct.length;++rn)Xt[31&Ct[rn]]++;for(rn=0;rn<Lt.length;++rn)Xt[31&Lt[rn]]++;for(var fn=jE(Xt,7),wn=fn[0],Cn=fn[1],bn=19;bn>4&&!wn[Fx[bn-1]];--bn);var Dn,En,Tn,Un,Pn=rt+5<<3,Yn=dw(a,u0)+dw(h,h0)+g,cr=dw(a,mt)+dw(h,wt)+g+14+3*bn+dw(Xt,wn)+(2*Xt[16]+3*Xt[17]+7*Xt[18]);if(Pn<=Yn&&Pn<=cr)return Vx(e,st,c.subarray(nt,nt+rt));if(h_(e,st,1+(cr<Yn)),st+=2,cr<Yn){Dn=Tm(mt,gt,0),En=mt,Tn=Tm(wt,It,0),Un=wt;var mr=Tm(wn,Cn,0);for(h_(e,st,xt-257),h_(e,st+5,Gt-1),h_(e,st+10,bn-4),st+=14,rn=0;rn<bn;++rn)h_(e,st+3*rn,wn[Fx[rn]]);st+=3*bn;for(var ir=[Ct,Lt],Dr=0;Dr<2;++Dr){var Nr=ir[Dr];for(rn=0;rn<Nr.length;++rn){var Fr=31&Nr[rn];h_(e,st,mr[Fr]),st+=wn[Fr],Fr>15&&(h_(e,st,Nr[rn]>>>5&127),st+=Nr[rn]>>>12)}}}else Dn=lu,En=u0,Tn=mu,Un=h0;for(rn=0;rn<$;++rn)if(s[rn]>255){Fr=s[rn]>>>18&31,hw(e,st,Dn[Fr+257]),st+=En[Fr+257],Fr>7&&(h_(e,st,s[rn]>>>23&31),st+=c0[Fr]);var Vr=31&s[rn];hw(e,st,Tn[Vr]),st+=Un[Vr],Vr>3&&(hw(e,st,s[rn]>>>5&8191),st+=ry[Vr])}else hw(e,st,Dn[s[rn]]),st+=En[s[rn]];return hw(e,st,Dn[256]),st+En[256]},rI=new Tp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),d0=new Co(0),iI=function(c,e,i,s,a,h){var g=c.length,$=new Co(s+g+5*(1+Math.ceil(g/7e3))+a),nt=$.subarray(s,$.length-a),rt=0;if(!e||g<8)for(var st=0;st<=g;st+=65535){var ut=st+65535;ut<g?rt=Vx(nt,rt,c.subarray(st,ut)):(nt[st]=h,rt=Vx(nt,rt,c.subarray(st,g)))}else{for(var mt=rI[e-1],gt=mt>>>13,yt=8191&mt,wt=(1<<i)-1,It=new ep(32768),Et=new ep(wt+1),Ct=Math.ceil(i/3),xt=2*Ct,Bt=function(xa){return(c[xa]^c[xa+1]<<Ct^c[xa+2]<<xt)&wt},Lt=new Tp(25e3),Gt=new ep(288),Xt=new ep(32),rn=0,fn=0,wn=(st=0,0),Cn=0,bn=0;st<g;++st){var Dn=Bt(st),En=32767&st,Tn=Et[Dn];if(It[En]=Tn,Et[Dn]=En,Cn<=st){var Un=g-st;if((rn>7e3||wn>24576)&&Un>423){rt=GC(c,nt,0,Lt,Gt,Xt,fn,wn,bn,st-bn,rt),wn=rn=fn=0,bn=st;for(var Pn=0;Pn<286;++Pn)Gt[Pn]=0;for(Pn=0;Pn<30;++Pn)Xt[Pn]=0}var Yn=2,cr=0,mr=yt,ir=En-Tn&32767;if(Un>2&&Dn==Bt(st-ir))for(var Dr=Math.min(gt,Un)-1,Nr=Math.min(32767,st),Fr=Math.min(258,Un);ir<=Nr&&--mr&&En!=Tn;){if(c[st+Yn]==c[st+Yn-ir]){for(var Vr=0;Vr<Fr&&c[st+Vr]==c[st+Vr-ir];++Vr);if(Vr>Yn){if(Yn=Vr,cr=ir,Vr>Dr)break;var ps=Math.min(ir,Vr-2),yr=0;for(Pn=0;Pn<ps;++Pn){var Ws=st-ir+Pn+32768&32767,lo=Ws-It[Ws]+32768&32767;lo>yr&&(yr=lo,Tn=Ws)}}}ir+=(En=Tn)-(Tn=It[En])+32768&32767}if(cr){Lt[wn++]=268435456|Ux[Yn]<<18|VC[cr];var qs=31&Ux[Yn],Bo=31&VC[cr];fn+=c0[qs]+ry[Bo],++Gt[257+qs],++Xt[Bo],Cn=st+Yn,++rn}else Lt[wn++]=c[st],++Gt[c[st]]}}rt=GC(c,nt,h,Lt,Gt,Xt,fn,wn,bn,st-bn,rt),!h&&7&rt&&(rt=Vx(nt,rt+1,d0))}return Up($,0,s+uw(rt)+a)},sI=function(){for(var c=new Tp(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&3988292384)^i>>>1;c[e]=i}return c}(),pw=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=sI[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},HC=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,g=0;g!=h;){for(var $=Math.min(g+2655,h);g<$;++g)a+=s+=i[g];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},tA=function(c,e,i,s,a){return iI(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},Qx=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},oI=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<s.length;++g){var $=s[g],nt=h[g];if(typeof $=="function"){e+=";"+nt+"=";var rt=$.toString();if($.prototype)if(rt.indexOf("[native code]")!=-1){var st=rt.indexOf(" ",8)+1;e+=rt.slice(st,rt.indexOf("(",st))}else for(var ut in e+=rt,$.prototype)e+=";"+nt+".prototype."+ut+"="+$.prototype[ut].toString();else e+=rt}else i[nt]=$}return[e,i]},zE=[],aI=function(c,e,i,s){var a;if(!zE[i]){for(var h="",g={},$=c.length-1,nt=0;nt<$;++nt)h=(a=oI(c[nt],h,g))[0],g=a[1];zE[i]=oI(c[$],h,g)}var rt=Qx({},zE[i][1]);return function(st,ut,mt,gt,yt){var wt=ZT(FC[ut]||(FC[ut]=cw(st)));return wt.onerror=function(It){return yt(It.error,null)},wt.onmessage=function(It){return yt(null,It.data)},wt.postMessage(mt,gt),wt}(zE[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,rt,function(st){var ut=[];for(var mt in st)(st[mt]instanceof Co||st[mt]instanceof ep||st[mt]instanceof Tp)&&ut.push((st[mt]=new st[mt].constructor(st[mt])).buffer);return ut}(rt),s)},fw=function(){return[Co,ep,Tp,c0,ry,Fx,jC,tI,nI,zx,jx,Tm,FE,$m,UE,uw,Up,eA,ln,iy,WC]},mw=function(){return[Co,ep,Tp,c0,ry,Fx,Ux,VC,lu,u0,mu,h0,jx,rI,d0,Tm,h_,hw,jE,Jm,QC,dw,Vx,GC,uw,Up,iI,tA,kt,iy]},lI=function(){return[ot,vt,tt,pw,sI]},cI=function(){return[lt,ht]},uI=function(){return[_t,tt,HC]},hI=function(){return[Mt]},iy=function(c){return postMessage(c,[c.buffer])},WC=function(c){return c&&c.size&&new Co(c.size)},gw=function(c,e,i,s,a,h){var g=aI(i,s,a,function($,nt){g.terminate(),h($,nt)});return g.postMessage([c,e],e.consume?[c.buffer]:[]),function(){g.terminate()}},Zm=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},dt=function(c,e,i,s,a){var h,g=aI(c,s,a,function($,nt){$?(g.terminate(),e.ondata.call(e,$)):(nt[1]&&g.terminate(),e.ondata.call(e,$,nt[0],nt[1]))});g.postMessage(i),e.push=function($,nt){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";g.postMessage([$,h=nt],[$.buffer])},e.terminate=function(){g.terminate()}},o=function(c,e){return c[e]|c[e+1]<<8},b=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},et=function(c,e){return b(c,e)+4294967296*b(c,e+4)},tt=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},ot=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&tt(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},lt=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},ht=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},vt=function(c){return 10+(c.filename&&c.filename.length+1||0)},_t=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},Mt=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function Pt(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Tt=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(tA(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),Rt=function(){return function(c,e){dt([mw,function(){return[Zm,Tt]}],this,Pt.call(this,c,e),function(i){var s=new Tt(i.data);onmessage=Zm(s)},6)}}();function Nt(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return gw(c,e,[mw],function(s){return iy(kt(s.data[0],s.data[1]))},0,i)}function kt(c,e){return tA(c,e||{},0,0)}var Kt=function(){function c(e){this.s={},this.p=new Co(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new Co(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=eA(this.p,this.o,this.s);this.ondata(Up(s,i,this.s.b),this.d),this.o=Up(s,this.s.b-32768),this.s.b=this.o.length,this.p=Up(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),$t=function(){return function(c){this.ondata=c,dt([fw,function(){return[Zm,Kt]}],this,0,function(){var e=new Kt;onmessage=Zm(e)},7)}}();function en(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return gw(c,e,[fw],function(s){return iy(ln(s.data[0],WC(s.data[1])))},1,i)}function ln(c,e){return eA(c,e)}var gn=function(){function c(e,i){this.c=pw(),this.l=0,this.v=1,Tt.call(this,e,i)}return c.prototype.push=function(e,i){Tt.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=tA(e,this.o,this.v&&vt(this.o),i&&8,!i);this.v&&(ot(s,this.o),this.v=0),i&&(tt(s,s.length-8,this.c.d()),tt(s,s.length-4,this.l)),this.ondata(s,i)},c}(),_n=function(){return function(c,e){dt([mw,lI,function(){return[Zm,Tt,gn]}],this,Pt.call(this,c,e),function(i){var s=new gn(i.data);onmessage=Zm(s)},8)}}();function An(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return gw(c,e,[mw,lI,function(){return[Ln]}],function(s){return iy(Ln(s.data[0],s.data[1]))},2,i)}function Ln(c,e){e||(e={});var i=pw(),s=c.length;i.p(c);var a=tA(c,e,vt(e),8),h=a.length;return ot(a,e),tt(a,h-8,i.d()),tt(a,h-4,s),a}var Nn=function(){function c(e){this.v=1,Kt.call(this,e)}return c.prototype.push=function(e,i){if(Kt.prototype.e.call(this,e),this.v){var s=this.p.length>3?lt(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Kt.prototype.c.call(this,i)},c}(),Jn=function(){return function(c){this.ondata=c,dt([fw,cI,function(){return[Zm,Kt,Nn]}],this,0,function(){var e=new Nn;onmessage=Zm(e)},9)}}();function tr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return gw(c,e,[fw,cI,function(){return[jn]}],function(s){return iy(jn(s.data[0]))},3,i)}function jn(c,e){return eA(c.subarray(lt(c),-8),e||new Co(ht(c)))}var Cr=function(){function c(e,i){this.c=HC(),this.v=1,Tt.call(this,e,i)}return c.prototype.push=function(e,i){Tt.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=tA(e,this.o,this.v&&2,i&&4,!i);this.v&&(_t(s,this.o),this.v=0),i&&tt(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),Ur=function(){return function(c,e){dt([mw,uI,function(){return[Zm,Tt,Cr]}],this,Pt.call(this,c,e),function(i){var s=new Cr(i.data);onmessage=Zm(s)},10)}}();function Er(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return gw(c,e,[mw,uI,function(){return[qr]}],function(s){return iy(qr(s.data[0],s.data[1]))},4,i)}function qr(c,e){e||(e={});var i=HC();i.p(c);var s=tA(c,e,2,4);return _t(s,e),tt(s,s.length-4,i.d()),s}var Yr=function(){function c(e){this.v=1,Kt.call(this,e)}return c.prototype.push=function(e,i){if(Kt.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Kt.prototype.c.call(this,i)},c}(),fr=function(){return function(c){this.ondata=c,dt([fw,hI,function(){return[Zm,Kt,Yr]}],this,0,function(){var e=new Yr;onmessage=Zm(e)},11)}}();function _r(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return gw(c,e,[fw,hI,function(){return[Qr]}],function(s){return iy(Qr(s.data[0],WC(s.data[1])))},5,i)}function Qr(c,e){return eA((Mt(c),c.subarray(2,-4)),e)}var Mr=function(){function c(e){this.G=Nn,this.I=Kt,this.Z=Yr,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new Co(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Wr=function(){function c(e){this.G=Jn,this.I=$t,this.Z=fr,this.ondata=e}return c.prototype.push=function(e,i){Mr.prototype.push.call(this,e,i)},c}();function ws(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?tr(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?en(c,e,i):_r(c,e,i)}function fo(c,e){return c[0]==31&&c[1]==139&&c[2]==8?jn(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?ln(c,e):Qr(c,e)}var Es=function(c,e,i,s){for(var a in c){var h=c[a],g=e+a;h instanceof Co?i[g]=[h,s]:Array.isArray(h)?i[g]=[h[0],Qx(s,h[1])]:Es(h,g+"/",i,s)}},so=typeof TextEncoder<"u"&&new TextEncoder,Rn=typeof TextDecoder<"u"&&new TextDecoder,Mn=0;try{Rn.decode(d0,{stream:!0}),Mn=1}catch{}var sr=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,Up(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},Xn=function(){function c(e){this.ondata=e,Mn?this.t=new TextDecoder:this.p=d0}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new Co(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=sr(s),h=a[0],g=a[1];if(i){if(g.length)throw"invalid utf-8 data";this.p=null}else this.p=g;this.ondata(h,i)}},c}(),kn=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(qn(e),this.d=i||!1)},c}();function qn(c,e){if(e){for(var i=new Co(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(so)return so.encode(c);var a=c.length,h=new Co(c.length+(c.length>>1)),g=0,$=function(st){h[g++]=st};for(s=0;s<a;++s){if(g+5>h.length){var nt=new Co(g+8+(a-s<<1));nt.set(h),h=nt}var rt=c.charCodeAt(s);rt<128||e?$(rt):rt<2048?($(192|rt>>6),$(128|63&rt)):rt>55295&&rt<57344?($(240|(rt=65536+(1047552&rt)|1023&c.charCodeAt(++s))>>18),$(128|rt>>12&63),$(128|rt>>6&63),$(128|63&rt)):($(224|rt>>12),$(128|rt>>6&63),$(128|63&rt))}return Up(h,0,g)}function gr(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(Rn)return Rn.decode(c);var a=sr(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var cn=function(c){return c==1?3:c<6?2:c==9?1:0},vr=function(c,e){return e+30+o(c,e+26)+o(c,e+28)},rr=function(c,e,i){var s=o(c,e+28),a=gr(c.subarray(e+46,e+46+s),!(2048&o(c,e+8))),h=e+46+s,g=b(c,e+20),$=i&&g==4294967295?Sr(c,h):[g,b(c,e+24),b(c,e+42)],nt=$[0],rt=$[1],st=$[2];return[o(c,e+10),nt,rt,a,h+o(c,e+30)+o(c,e+32),st]},Sr=function(c,e){for(;o(c,e)!=1;e+=4+o(c,e+2));return[et(c,e+12),et(c,e+4),et(c,e+20)]},Pr=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},Zr=function(c,e,i,s,a,h,g,$){var nt=s.length,rt=i.extra,st=$&&$.length,ut=Pr(rt);tt(c,e,g!=null?33639248:67324752),e+=4,g!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var mt=new Date(i.mtime==null?Date.now():i.mtime),gt=mt.getFullYear()-1980;if(gt<0||gt>119)throw"date not in range 1980-2099";if(tt(c,e,gt<<25|mt.getMonth()+1<<21|mt.getDate()<<16|mt.getHours()<<11|mt.getMinutes()<<5|mt.getSeconds()>>>1),e+=4,h!=null&&(tt(c,e,i.crc),tt(c,e+4,h),tt(c,e+8,i.size)),tt(c,e+12,nt),tt(c,e+14,ut),e+=16,g!=null&&(tt(c,e,st),tt(c,e+6,i.attrs),tt(c,e+10,g),e+=14),c.set(s,e),e+=nt,ut)for(var yt in rt){var wt=rt[yt],It=wt.length;tt(c,e,+yt),tt(c,e+2,It),c.set(wt,e+4),e+=4+It}return st&&(c.set($,e),e+=st),e},Ss=function(c,e,i,s,a){tt(c,e,101010256),tt(c,e+8,i),tt(c,e+10,i),tt(c,e+12,s),tt(c,e+16,a)},Ns=function(){function c(e){this.filename=e,this.c=pw(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),eo=function(){function c(e,i){var s=this;i||(i={}),Ns.call(this,e),this.d=new Tt(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=cn(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){Ns.prototype.push.call(this,e,i)},c}(),Bs=function(){function c(e,i){var s=this;i||(i={}),Ns.call(this,e),this.d=new Rt(i,function(a,h,g){s.ondata(a,h,g)}),this.compression=8,this.flag=cn(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){Ns.prototype.push.call(this,e,i)},c}(),Fs=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=qn(e.filename),a=s.length,h=e.comment,g=h&&qn(h),$=a!=e.filename.length||g&&h.length!=g.length,nt=a+Pr(e.extra)+30;if(a>65535)throw"filename too long";var rt=new Co(nt);Zr(rt,0,e,s,$);var st=[rt],ut=function(){for(var It=0,Et=st;It<Et.length;It++){var Ct=Et[It];i.ondata(null,Ct,!1)}st=[]},mt=this.d;this.d=0;var gt=this.u.length,yt=Qx(e,{f:s,u:$,o:g,t:function(){e.terminate&&e.terminate()},r:function(){if(ut(),mt){var It=i.u[gt+1];It?It.r():i.d=1}mt=1}}),wt=0;e.ondata=function(It,Et,Ct){if(It)i.ondata(It,Et,Ct),i.terminate();else if(wt+=Et.length,st.push(Et),Ct){var xt=new Co(16);tt(xt,0,134695760),tt(xt,4,e.crc),tt(xt,8,wt),tt(xt,12,e.size),st.push(xt),yt.c=wt,yt.b=nt+wt+16,yt.crc=e.crc,yt.size=e.size,mt&&yt.r(),mt=1}else mt&&ut()},this.u.push(yt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(rt=h[a]).f.length+Pr(rt.extra)+(rt.o?rt.o.length:0);for(var g=new Co(s+22),$=0,nt=this.u;$<nt.length;$++){var rt=nt[$];Zr(g,e,rt,rt.f,rt.u,rt.c,i,rt.o),e+=46+rt.f.length+Pr(rt.extra)+(rt.o?rt.o.length:0),i+=rt.b}Ss(g,e,this.u.length,s,i),this.ondata(null,g,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function $o(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};Es(c,"",s,e);var a=Object.keys(s),h=a.length,g=0,$=0,nt=h,rt=new Array(h),st=[],ut=function(){for(var wt=0;wt<st.length;++wt)st[wt]()},mt=function(){var wt=new Co($+22),It=g,Et=$-g;$=0;for(var Ct=0;Ct<nt;++Ct){var xt=rt[Ct];try{var Bt=xt.c.length;Zr(wt,$,xt,xt.f,xt.u,Bt);var Lt=30+xt.f.length+Pr(xt.extra),Gt=$+Lt;wt.set(xt.c,Gt),Zr(wt,g,xt,xt.f,xt.u,Bt,$,xt.m),g+=16+Lt+(xt.m?xt.m.length:0),$=Gt+Bt}catch(Xt){return i(Xt,null)}}Ss(wt,g,rt.length,Et,It),i(null,wt)};h||mt();for(var gt=function(wt){var It=a[wt],Et=s[It],Ct=Et[0],xt=Et[1],Bt=pw(),Lt=Ct.length;Bt.p(Ct);var Gt=qn(It),Xt=Gt.length,rn=xt.comment,fn=rn&&qn(rn),wn=fn&&fn.length,Cn=Pr(xt.extra),bn=xt.level==0?0:8,Dn=function(En,Tn){if(En)ut(),i(En,null);else{var Un=Tn.length;rt[wt]=Qx(xt,{size:Lt,crc:Bt.d(),c:Tn,f:Gt,m:fn,u:Xt!=It.length||fn&&rn.length!=wn,compression:bn}),g+=30+Xt+Cn+Un,$+=76+2*(Xt+Cn)+(wn||0)+Un,--h||mt()}};if(Xt>65535&&Dn("filename too long",null),bn)if(Lt<16e4)try{Dn(null,kt(Ct,xt))}catch(En){Dn(En,null)}else st.push(Nt(Ct,xt,Dn));else Dn(null,Ct)},yt=0;yt<nt;++yt)gt(yt);return ut}function Im(c,e){e||(e={});var i={},s=[];Es(c,"",i,e);var a=0,h=0;for(var g in i){var $=i[g],nt=$[0],rt=$[1],st=rt.level==0?0:8,ut=(Xt=qn(g)).length,mt=rt.comment,gt=mt&&qn(mt),yt=gt&&gt.length,wt=Pr(rt.extra);if(ut>65535)throw"filename too long";var It=st?kt(nt,rt):nt,Et=It.length,Ct=pw();Ct.p(nt),s.push(Qx(rt,{size:nt.length,crc:Ct.d(),c:It,f:Xt,m:gt,u:ut!=g.length||gt&&mt.length!=yt,o:a,compression:st})),a+=30+ut+wt+Et,h+=76+2*(ut+wt)+(yt||0)+Et}for(var xt=new Co(h+22),Bt=a,Lt=h-a,Gt=0;Gt<s.length;++Gt){var Xt=s[Gt];Zr(xt,Xt.o,Xt,Xt.f,Xt.u,Xt.c.length);var rn=30+Xt.f.length+Pr(Xt.extra);xt.set(Xt.c,Xt.o+rn),Zr(xt,a,Xt,Xt.f,Xt.u,Xt.c.length,Xt.o,Xt.m),a+=16+rn+(Xt.m?Xt.m.length:0)}return Ss(xt,a,s.length,Lt,Bt),xt}var $s=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),_l=function(){function c(){var e=this;this.i=new Kt(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),yl=function(){function c(e,i){var s=this;i<32e4?this.i=new Kt(function(a,h){s.ondata(null,a,h)}):(this.i=new $t(function(a,h,g){s.ondata(a,h,g)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=Up(e,0)),this.i.push(e,i)},c.compression=8,c}(),VE=function(){function c(e){this.onfile=e,this.k=[],this.o={0:$s},this.p=d0}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var g=0,$=0,nt=void 0,rt=void 0;this.p.length?e.length?((rt=new Co(this.p.length+e.length)).set(this.p),rt.set(e,this.p.length)):rt=this.p:rt=e;for(var st=rt.length,ut=this.c,mt=ut&&this.d,gt=function(){var It,Et=b(rt,$);if(Et==67324752){g=1,nt=$,yt.d=null,yt.c=0;var Ct=o(rt,$+6),xt=o(rt,$+8),Bt=2048&Ct,Lt=8&Ct,Gt=o(rt,$+26),Xt=o(rt,$+28);if(st>$+30+Gt+Xt){var rn=[];yt.k.unshift(rn),g=2;var fn,wn=b(rt,$+18),Cn=b(rt,$+22),bn=gr(rt.subarray($+30,$+=30+Gt),!Bt);wn==4294967295?(It=Lt?[-2]:Sr(rt,$),wn=It[0],Cn=It[1]):Lt&&(wn=-1),$+=Xt,yt.c=wn;var Dn={name:bn,compression:xt,start:function(){if(!Dn.ondata)throw"no callback";if(wn){var En=s.o[xt];if(!En)throw"unknown compression type "+xt;(fn=wn<0?new En(bn):new En(bn,wn,Cn)).ondata=function(Yn,cr,mr){Dn.ondata(Yn,cr,mr)};for(var Tn=0,Un=rn;Tn<Un.length;Tn++){var Pn=Un[Tn];fn.push(Pn,!1)}s.k[0]==rn&&s.c?s.d=fn:fn.push(d0,!0)}else Dn.ondata(null,d0,!0)},terminate:function(){fn&&fn.terminate&&fn.terminate()}};wn>=0&&(Dn.size=wn,Dn.originalSize=Cn),yt.onfile(Dn)}return"break"}if(ut){if(Et==134695760)return nt=$+=12+(ut==-2&&8),g=3,yt.c=0,"break";if(Et==33639248)return nt=$-=4,g=3,yt.c=0,"break"}},yt=this;$<st-4&&gt()!=="break";++$);if(this.p=d0,ut<0){var wt=g?rt.subarray(0,nt-12-(ut==-2&&8)-(b(rt,nt-16)==134695760&&4)):rt.subarray(0,$);mt?mt.push(wt,!!g):this.k[+(g==2)].push(wt)}if(2&g)return this.push(rt.subarray($),i);this.p=rt.subarray($)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function ss(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var mt=0;mt<i.length;++mt)i[mt]()},a={},h=c.length-22;b(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var g=o(c,h+8);g||e(null,{});var $=g,nt=b(c,h+16),rt=nt==4294967295;if(rt){if(h=b(c,h-12),b(c,h)!=101075792)return void e("invalid zip file",null);$=g=b(c,h+32),nt=b(c,h+48)}for(var st=function(mt){var gt=rr(c,nt,rt),yt=gt[0],wt=gt[1],It=gt[2],Et=gt[3],Ct=gt[4],xt=gt[5],Bt=vr(c,xt);nt=Ct;var Lt=function(Xt,rn){Xt?(s(),e(Xt,null)):(a[Et]=rn,--g||e(null,a))};if(yt)if(yt==8){var Gt=c.subarray(Bt,Bt+wt);if(wt<32e4)try{Lt(null,ln(Gt,new Co(It)))}catch(Xt){Lt(Xt,null)}else i.push(en(Gt,{size:It},Lt))}else Lt("unknown compression type "+yt,null);else Lt(null,Up(c,Bt,Bt+wt))},ut=0;ut<$;++ut)st();return s}function dI(c){for(var e={},i=c.length-22;b(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=o(c,i+8);if(!s)return{};var a=b(c,i+16),h=a==4294967295;if(h){if(i=b(c,i-12),b(c,i)!=101075792)throw"invalid zip file";s=b(c,i+32),a=b(c,i+48)}for(var g=0;g<s;++g){var $=rr(c,a,h),nt=$[0],rt=$[1],st=$[2],ut=$[3],mt=$[4],gt=$[5],yt=vr(c,gt);if(a=mt,nt){if(nt!=8)throw"unknown compression type "+nt;e[ut]=ln(c.subarray(yt,yt+rt),new Co(st))}else e[ut]=Up(c,yt,yt+rt)}return e}class pI extends d.yxD{constructor(e){super(e),this.type=d.cLu}parse(e){const h=Math.pow(2.7182818,2.2),g={l:0,c:0,lc:0};function $(vn,Fn,yn,Hn,nr){for(;yn<vn;)Fn=Fn<<8|Dr(Hn,nr),yn+=8;yn-=vn,g.l=Fn>>yn&(1<<vn)-1,g.c=Fn,g.lc=yn}const nt=new Array(59);function rt(vn){return 63&vn}function st(vn){return vn>>6}const ut={c:0,lc:0};function mt(vn,Fn,yn,Hn){vn=vn<<8|Dr(yn,Hn),Fn+=8,ut.c=vn,ut.lc=Fn}const gt={c:0,lc:0};function yt(vn,Fn,yn,Hn,nr,Gn,hr,Hr,ts){if(vn==Fn){Hn<8&&(mt(yn,Hn,nr,Gn),yn=ut.c,Hn=ut.lc);let us=yn>>(Hn-=8);if(us=new Uint8Array([us])[0],Hr.value+us>ts)return!1;const cs=hr[Hr.value-1];for(;us-- >0;)hr[Hr.value++]=cs}else{if(!(Hr.value<ts))return!1;hr[Hr.value++]=vn}gt.c=yn,gt.lc=Hn}function wt(vn){return 65535&vn}function It(vn){const Fn=wt(vn);return Fn>32767?Fn-65536:Fn}const Et={a:0,b:0};function Ct(vn,Fn){const yn=It(vn),Hn=It(Fn),nr=yn+(1&Hn)+(Hn>>1),Gn=nr,hr=nr-Hn;Et.a=Gn,Et.b=hr}function xt(vn,Fn){const yn=wt(vn),Hn=wt(Fn),nr=yn-(Hn>>1)&65535,Gn=Hn+nr-32768&65535;Et.a=Gn,Et.b=nr}function Bt(vn,Fn,yn,Hn,nr,Gn,hr){const Hr=hr<16384,ts=yn>nr?nr:yn;let us,cs,fs=1;for(;fs<=ts;)fs<<=1;for(fs>>=1,us=fs,fs>>=1;fs>=1;){cs=0;const os=cs+Gn*(nr-us),ns=Gn*fs,xs=Gn*us,Kr=Hn*fs,Cs=Hn*us;let Rs,Qs,Kl,Rl;for(;cs<=os;cs+=xs){let Ms=cs;const Xs=cs+Hn*(yn-us);for(;Ms<=Xs;Ms+=Cs){const Eo=Ms+Kr,gp=Ms+ns,lv=gp+Kr;Hr?(Ct(vn[Ms+Fn],vn[gp+Fn]),Rs=Et.a,Kl=Et.b,Ct(vn[Eo+Fn],vn[lv+Fn]),Qs=Et.a,Rl=Et.b,Ct(Rs,Qs),vn[Ms+Fn]=Et.a,vn[Eo+Fn]=Et.b,Ct(Kl,Rl),vn[gp+Fn]=Et.a,vn[lv+Fn]=Et.b):(xt(vn[Ms+Fn],vn[gp+Fn]),Rs=Et.a,Kl=Et.b,xt(vn[Eo+Fn],vn[lv+Fn]),Qs=Et.a,Rl=Et.b,xt(Rs,Qs),vn[Ms+Fn]=Et.a,vn[Eo+Fn]=Et.b,xt(Kl,Rl),vn[gp+Fn]=Et.a,vn[lv+Fn]=Et.b)}if(yn&fs){const Eo=Ms+ns;Hr?Ct(vn[Ms+Fn],vn[Eo+Fn]):xt(vn[Ms+Fn],vn[Eo+Fn]),Rs=Et.a,vn[Eo+Fn]=Et.b,vn[Ms+Fn]=Rs}}if(nr&fs){let Ms=cs;const Xs=cs+Hn*(yn-us);for(;Ms<=Xs;Ms+=Cs){const Eo=Ms+Kr;Hr?Ct(vn[Ms+Fn],vn[Eo+Fn]):xt(vn[Ms+Fn],vn[Eo+Fn]),Rs=Et.a,vn[Eo+Fn]=Et.b,vn[Ms+Fn]=Rs}}us=fs,fs>>=1}return cs}function Lt(vn,Fn,yn,Hn,nr,Gn){const hr=yn.value,Hr=ir(Fn,yn),ts=ir(Fn,yn);yn.value+=4;const us=ir(Fn,yn);if(yn.value+=4,Hr<0||Hr>=65537||ts<0||ts>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const cs=new Array(65537),fs=new Array(16384);if(function(os){for(let ns=0;ns<16384;ns++)os[ns]={},os[ns].len=0,os[ns].lit=0,os[ns].p=null}(fs),function(os,ns,xs,Kr,Cs,Rs){const Qs=ns;let Kl=0,Rl=0;for(;Kr<=Cs;Kr++){if(Qs.value-ns.value>xs)return!1;$(6,Kl,Rl,os,Qs);const Ms=g.l;if(Kl=g.c,Rl=g.lc,Rs[Kr]=Ms,Ms==63){if(Qs.value-ns.value>xs)throw new Error("Something wrong with hufUnpackEncTable");$(8,Kl,Rl,os,Qs);let Xs=g.l+6;if(Kl=g.c,Rl=g.lc,Kr+Xs>Cs+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Xs--;)Rs[Kr++]=0;Kr--}else if(Ms>=59){let Xs=Ms-59+2;if(Kr+Xs>Cs+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Xs--;)Rs[Kr++]=0;Kr--}}(function(Ms){for(let Eo=0;Eo<=58;++Eo)nt[Eo]=0;for(let Eo=0;Eo<65537;++Eo)nt[Ms[Eo]]+=1;let Xs=0;for(let Eo=58;Eo>0;--Eo){const gp=Xs+nt[Eo]>>1;nt[Eo]=Xs,Xs=gp}for(let Eo=0;Eo<65537;++Eo){const gp=Ms[Eo];gp>0&&(Ms[Eo]=gp|nt[gp]++<<6)}})(Rs)}(vn,yn,Hn-(yn.value-hr),Hr,ts,cs),us>8*(Hn-(yn.value-hr)))throw new Error("Something wrong with hufUncompress");(function(os,ns,xs,Kr){for(;ns<=xs;ns++){const Cs=st(os[ns]),Rs=rt(os[ns]);if(Cs>>Rs)throw new Error("Invalid table entry");if(Rs>14){const Qs=Kr[Cs>>Rs-14];if(Qs.len)throw new Error("Invalid table entry");if(Qs.lit++,Qs.p){const Kl=Qs.p;Qs.p=new Array(Qs.lit);for(let Rl=0;Rl<Qs.lit-1;++Rl)Qs.p[Rl]=Kl[Rl]}else Qs.p=new Array(1);Qs.p[Qs.lit-1]=ns}else if(Rs){let Qs=0;for(let Kl=1<<14-Rs;Kl>0;Kl--){const Rl=Kr[(Cs<<14-Rs)+Qs];if(Rl.len||Rl.p)throw new Error("Invalid table entry");Rl.len=Rs,Rl.lit=ns,Qs++}}}})(cs,Hr,ts,fs),function(os,ns,xs,Kr,Cs,Rs,Qs,Kl,Rl){let Ms=0,Xs=0;const Eo=Qs,gp=Math.trunc(Kr.value+(Cs+7)/8);for(;Kr.value<gp;)for(mt(Ms,Xs,xs,Kr),Ms=ut.c,Xs=ut.lc;Xs>=14;){const Ip=ns[Ms>>Xs-14&16383];if(Ip.len)Xs-=Ip.len,yt(Ip.lit,Rs,Ms,Xs,xs,Kr,Kl,Rl,Eo),Ms=gt.c,Xs=gt.lc;else{if(!Ip.p)throw new Error("hufDecode issues");let fA;for(fA=0;fA<Ip.lit;fA++){const _1=rt(os[Ip.p[fA]]);for(;Xs<_1&&Kr.value<gp;)mt(Ms,Xs,xs,Kr),Ms=ut.c,Xs=ut.lc;if(Xs>=_1&&st(os[Ip.p[fA]])==(Ms>>Xs-_1&(1<<_1)-1)){Xs-=_1,yt(Ip.p[fA],Rs,Ms,Xs,xs,Kr,Kl,Rl,Eo),Ms=gt.c,Xs=gt.lc;break}}if(fA==Ip.lit)throw new Error("hufDecode issues")}}const lv=8-Cs&7;for(Ms>>=lv,Xs-=lv;Xs>0;){const Ip=ns[Ms<<14-Xs&16383];if(!Ip.len)throw new Error("hufDecode issues");Xs-=Ip.len,yt(Ip.lit,Rs,Ms,Xs,xs,Kr,Kl,Rl,Eo),Ms=gt.c,Xs=gt.lc}}(cs,fs,vn,yn,us,ts,Gn,nr,{value:0})}function Gt(vn){for(let Fn=1;Fn<vn.length;Fn++){const yn=vn[Fn-1]+vn[Fn]-128;vn[Fn]=yn}}function Xt(vn,Fn){let yn=0,Hn=Math.floor((vn.length+1)/2),nr=0;const Gn=vn.length-1;for(;!(nr>Gn||(Fn[nr++]=vn[yn++],nr>Gn));)Fn[nr++]=vn[Hn++]}function rn(vn){let Fn=vn.byteLength;const yn=new Array;let Hn=0;const nr=new DataView(vn);for(;Fn>0;){const Gn=nr.getInt8(Hn++);if(Gn<0){const hr=-Gn;Fn-=hr+1;for(let Hr=0;Hr<hr;Hr++)yn.push(nr.getUint8(Hn++))}else{const hr=Gn;Fn-=2;const Hr=nr.getUint8(Hn++);for(let ts=0;ts<hr+1;ts++)yn.push(Hr)}}return yn}function fn(vn,Fn,yn){let Hn,nr=1;for(;nr<64;)Hn=Fn[vn.value],Hn==65280?nr=64:Hn>>8==255?nr+=255&Hn:(yn[nr]=Hn,nr++),vn.value++}function wn(vn){const Fn=.5*Math.cos(.7853975),yn=.5*Math.cos(3.14159/16),Hn=.5*Math.cos(3.14159/8),nr=.5*Math.cos(3*3.14159/16),Gn=.5*Math.cos(.981746875),hr=.5*Math.cos(3*3.14159/8),Hr=.5*Math.cos(1.374445625),ts=new Array(4),us=new Array(4),cs=new Array(4),fs=new Array(4);for(let os=0;os<8;++os){const ns=8*os;ts[0]=Hn*vn[ns+2],ts[1]=hr*vn[ns+2],ts[2]=Hn*vn[ns+6],ts[3]=hr*vn[ns+6],us[0]=yn*vn[ns+1]+nr*vn[ns+3]+Gn*vn[ns+5]+Hr*vn[ns+7],us[1]=nr*vn[ns+1]-Hr*vn[ns+3]-yn*vn[ns+5]-Gn*vn[ns+7],us[2]=Gn*vn[ns+1]-yn*vn[ns+3]+Hr*vn[ns+5]+nr*vn[ns+7],us[3]=Hr*vn[ns+1]-Gn*vn[ns+3]+nr*vn[ns+5]-yn*vn[ns+7],cs[0]=Fn*(vn[ns+0]+vn[ns+4]),cs[3]=Fn*(vn[ns+0]-vn[ns+4]),cs[1]=ts[0]+ts[3],cs[2]=ts[1]-ts[2],fs[0]=cs[0]+cs[1],fs[1]=cs[3]+cs[2],fs[2]=cs[3]-cs[2],fs[3]=cs[0]-cs[1],vn[ns+0]=fs[0]+us[0],vn[ns+1]=fs[1]+us[1],vn[ns+2]=fs[2]+us[2],vn[ns+3]=fs[3]+us[3],vn[ns+4]=fs[3]-us[3],vn[ns+5]=fs[2]-us[2],vn[ns+6]=fs[1]-us[1],vn[ns+7]=fs[0]-us[0]}for(let os=0;os<8;++os)ts[0]=Hn*vn[16+os],ts[1]=hr*vn[16+os],ts[2]=Hn*vn[48+os],ts[3]=hr*vn[48+os],us[0]=yn*vn[8+os]+nr*vn[24+os]+Gn*vn[40+os]+Hr*vn[56+os],us[1]=nr*vn[8+os]-Hr*vn[24+os]-yn*vn[40+os]-Gn*vn[56+os],us[2]=Gn*vn[8+os]-yn*vn[24+os]+Hr*vn[40+os]+nr*vn[56+os],us[3]=Hr*vn[8+os]-Gn*vn[24+os]+nr*vn[40+os]-yn*vn[56+os],cs[0]=Fn*(vn[os]+vn[32+os]),cs[3]=Fn*(vn[os]-vn[32+os]),cs[1]=ts[0]+ts[3],cs[2]=ts[1]-ts[2],fs[0]=cs[0]+cs[1],fs[1]=cs[3]+cs[2],fs[2]=cs[3]-cs[2],fs[3]=cs[0]-cs[1],vn[0+os]=fs[0]+us[0],vn[8+os]=fs[1]+us[1],vn[16+os]=fs[2]+us[2],vn[24+os]=fs[3]+us[3],vn[32+os]=fs[3]-us[3],vn[40+os]=fs[2]-us[2],vn[48+os]=fs[1]-us[1],vn[56+os]=fs[0]-us[0]}function Cn(vn){for(let Fn=0;Fn<64;++Fn){const yn=vn[0][Fn],Hn=vn[1][Fn],nr=vn[2][Fn];vn[0][Fn]=yn+1.5747*nr,vn[1][Fn]=yn-.1873*Hn-.4682*nr,vn[2][Fn]=yn+1.8556*Hn}}function bn(vn,Fn,yn){for(let nr=0;nr<64;++nr)Fn[yn+nr]=d.A5E.toHalfFloat((Hn=vn[nr])<=1?Math.sign(Hn)*Math.pow(Math.abs(Hn),2.2):Math.sign(Hn)*Math.pow(h,Math.abs(Hn)-1));var Hn}function Dn(vn){return new DataView(vn.array.buffer,vn.offset.value,vn.size)}function En(vn){const Fn=vn.viewer.buffer.slice(vn.offset.value,vn.offset.value+vn.size),yn=new Uint8Array(rn(Fn)),Hn=new Uint8Array(yn.length);return Gt(yn),Xt(yn,Hn),new DataView(Hn.buffer)}function Tn(vn){const Fn=vn.array.slice(vn.offset.value,vn.offset.value+vn.size);_===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const yn=Qr(Fn),Hn=new Uint8Array(yn.length);return Gt(yn),Xt(yn,Hn),new DataView(Hn.buffer)}function Un(vn){const Fn=vn.viewer,yn={value:vn.offset.value},Hn=new Uint16Array(vn.width*vn.scanlineBlockSize*(vn.channels*vn.type)),nr=new Uint8Array(8192);let Gn=0;const hr=new Array(vn.channels);for(let xs=0;xs<vn.channels;xs++)hr[xs]={},hr[xs].start=Gn,hr[xs].end=hr[xs].start,hr[xs].nx=vn.width,hr[xs].ny=vn.lines,hr[xs].size=vn.type,Gn+=hr[xs].nx*hr[xs].ny*hr[xs].size;const Hr=Ws(Fn,yn),ts=Ws(Fn,yn);if(ts>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Hr<=ts)for(let xs=0;xs<ts-Hr+1;xs++)nr[xs+Hr]=Nr(Fn,yn);const us=new Uint16Array(65536),cs=function(xs,Kr){let Cs=0;for(let Qs=0;Qs<65536;++Qs)(Qs==0||xs[Qs>>3]&1<<(7&Qs))&&(Kr[Cs++]=Qs);const Rs=Cs-1;for(;Cs<65536;)Kr[Cs++]=0;return Rs}(nr,us),fs=ir(Fn,yn);Lt(vn.array,Fn,yn,fs,Hn,Gn);for(let xs=0;xs<vn.channels;++xs){const Kr=hr[xs];for(let Cs=0;Cs<hr[xs].size;++Cs)Bt(Hn,Kr.start+Cs,Kr.nx,Kr.size,Kr.ny,Kr.nx*Kr.size,cs)}(function(xs,Kr,Cs){for(let Rs=0;Rs<Cs;++Rs)Kr[Rs]=xs[Kr[Rs]]})(us,Hn,Gn);let os=0;const ns=new Uint8Array(Hn.buffer.byteLength);for(let xs=0;xs<vn.lines;xs++)for(let Kr=0;Kr<vn.channels;Kr++){const Cs=hr[Kr],Rs=Cs.nx*Cs.size,Qs=new Uint8Array(Hn.buffer,2*Cs.end,2*Rs);ns.set(Qs,os),os+=2*Rs,Cs.end+=Rs}return new DataView(ns.buffer)}function Pn(vn){const Fn=vn.array.slice(vn.offset.value,vn.offset.value+vn.size);_===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const yn=Qr(Fn),Hn=vn.lines*vn.channels*vn.width,nr=vn.type==1?new Uint16Array(Hn):new Uint32Array(Hn);let Gn=0,hr=0;const Hr=new Array(4);for(let ts=0;ts<vn.lines;ts++)for(let us=0;us<vn.channels;us++){let cs=0;switch(vn.type){case 1:Hr[0]=Gn,Hr[1]=Hr[0]+vn.width,Gn=Hr[1]+vn.width;for(let fs=0;fs<vn.width;++fs)cs+=yn[Hr[0]++]<<8|yn[Hr[1]++],nr[hr]=cs,hr++;break;case 2:Hr[0]=Gn,Hr[1]=Hr[0]+vn.width,Hr[2]=Hr[1]+vn.width,Gn=Hr[2]+vn.width;for(let fs=0;fs<vn.width;++fs)cs+=yn[Hr[0]++]<<24|yn[Hr[1]++]<<16|yn[Hr[2]++]<<8,nr[hr]=cs,hr++}}return new DataView(nr.buffer)}function Yn(vn){const Fn=vn.viewer,yn={value:vn.offset.value},Hn=new Uint8Array(vn.width*vn.lines*(vn.channels*vn.type*2)),nr={version:Fr(Fn,yn),unknownUncompressedSize:Fr(Fn,yn),unknownCompressedSize:Fr(Fn,yn),acCompressedSize:Fr(Fn,yn),dcCompressedSize:Fr(Fn,yn),rleCompressedSize:Fr(Fn,yn),rleUncompressedSize:Fr(Fn,yn),rleRawSize:Fr(Fn,yn),totalAcUncompressedCount:Fr(Fn,yn),totalDcUncompressedCount:Fr(Fn,yn),acCompression:Fr(Fn,yn)};if(nr.version<2)throw new Error("EXRLoader.parse: "+jr.compression+" version "+nr.version+" is unsupported");const Gn=new Array;let hr=Ws(Fn,yn)-2;for(;hr>0;){const Kr=cr(Fn.buffer,yn),Cs=Nr(Fn,yn),Rs=Cs>>2&3,Qs=new Int8Array([(Cs>>4)-1])[0],Kl=Nr(Fn,yn);Gn.push({name:Kr,index:Qs,type:Kl,compression:Rs}),hr-=Kr.length+3}const Hr=jr.channels,ts=new Array(vn.channels);for(let Kr=0;Kr<vn.channels;++Kr){const Cs=ts[Kr]={},Rs=Hr[Kr];Cs.name=Rs.name,Cs.compression=0,Cs.decoded=!1,Cs.type=Rs.pixelType,Cs.pLinear=Rs.pLinear,Cs.width=vn.width,Cs.height=vn.lines}const us={idx:new Array(3)};for(let Kr=0;Kr<vn.channels;++Kr){const Cs=ts[Kr];for(let Rs=0;Rs<Gn.length;++Rs){const Qs=Gn[Rs];Cs.name==Qs.name&&(Cs.compression=Qs.compression,Qs.index>=0&&(us.idx[Qs.index]=Kr),Cs.offset=Kr)}}let cs,fs,os;if(nr.acCompressedSize>0)switch(nr.acCompression){case 0:cs=new Uint16Array(nr.totalAcUncompressedCount),Lt(vn.array,Fn,yn,nr.acCompressedSize,cs,nr.totalAcUncompressedCount);break;case 1:const Kr=Qr(vn.array.slice(yn.value,yn.value+nr.totalAcUncompressedCount));cs=new Uint16Array(Kr.buffer),yn.value+=nr.totalAcUncompressedCount}if(nr.dcCompressedSize>0){const Kr={array:vn.array,offset:yn,size:nr.dcCompressedSize};fs=new Uint16Array(Tn(Kr).buffer),yn.value+=nr.dcCompressedSize}nr.rleRawSize>0&&(os=rn(Qr(vn.array.slice(yn.value,yn.value+nr.rleCompressedSize)).buffer),yn.value+=nr.rleCompressedSize);let ns=0;const xs=new Array(ts.length);for(let Kr=0;Kr<xs.length;++Kr)xs[Kr]=new Array;for(let Kr=0;Kr<vn.lines;++Kr)for(let Cs=0;Cs<ts.length;++Cs)xs[Cs].push(ns),ns+=ts[Cs].width*vn.type*2;(function(Kr,Cs,Rs,Qs,Kl,Rl){let Ms=new DataView(Rl.buffer);const Xs=Rs[Kr.idx[0]].width,Eo=Rs[Kr.idx[0]].height,gp=Math.floor(Xs/8),lv=Math.ceil(Xs/8),Ip=Math.ceil(Eo/8),fA=Xs-8*(lv-1),_1=Eo-8*(Ip-1),QF={value:0},AR=new Array(3),RM=new Array(3),kM=new Array(3),w0=new Array(3),sP=new Array(3);for(let hu=0;hu<3;++hu)sP[hu]=Cs[Kr.idx[hu]],AR[hu]=hu<1?0:AR[hu-1]+lv*Ip,RM[hu]=new Float32Array(64),kM[hu]=new Uint16Array(64),w0[hu]=new Uint16Array(64*lv);for(let hu=0;hu<Ip;++hu){let IS=8;hu==Ip-1&&(IS=_1);let PS=8;for(let Nl=0;Nl<lv;++Nl){Nl==lv-1&&(PS=fA);for(let tu=0;tu<3;++tu)kM[tu].fill(0),kM[tu][0]=Kl[AR[tu]++],fn(QF,Qs,kM[tu]),_s=kM[tu],(ys=RM[tu])[0]=yr(_s[0]),ys[1]=yr(_s[1]),ys[2]=yr(_s[5]),ys[3]=yr(_s[6]),ys[4]=yr(_s[14]),ys[5]=yr(_s[15]),ys[6]=yr(_s[27]),ys[7]=yr(_s[28]),ys[8]=yr(_s[2]),ys[9]=yr(_s[4]),ys[10]=yr(_s[7]),ys[11]=yr(_s[13]),ys[12]=yr(_s[16]),ys[13]=yr(_s[26]),ys[14]=yr(_s[29]),ys[15]=yr(_s[42]),ys[16]=yr(_s[3]),ys[17]=yr(_s[8]),ys[18]=yr(_s[12]),ys[19]=yr(_s[17]),ys[20]=yr(_s[25]),ys[21]=yr(_s[30]),ys[22]=yr(_s[41]),ys[23]=yr(_s[43]),ys[24]=yr(_s[9]),ys[25]=yr(_s[11]),ys[26]=yr(_s[18]),ys[27]=yr(_s[24]),ys[28]=yr(_s[31]),ys[29]=yr(_s[40]),ys[30]=yr(_s[44]),ys[31]=yr(_s[53]),ys[32]=yr(_s[10]),ys[33]=yr(_s[19]),ys[34]=yr(_s[23]),ys[35]=yr(_s[32]),ys[36]=yr(_s[39]),ys[37]=yr(_s[45]),ys[38]=yr(_s[52]),ys[39]=yr(_s[54]),ys[40]=yr(_s[20]),ys[41]=yr(_s[22]),ys[42]=yr(_s[33]),ys[43]=yr(_s[38]),ys[44]=yr(_s[46]),ys[45]=yr(_s[51]),ys[46]=yr(_s[55]),ys[47]=yr(_s[60]),ys[48]=yr(_s[21]),ys[49]=yr(_s[34]),ys[50]=yr(_s[37]),ys[51]=yr(_s[47]),ys[52]=yr(_s[50]),ys[53]=yr(_s[56]),ys[54]=yr(_s[59]),ys[55]=yr(_s[61]),ys[56]=yr(_s[35]),ys[57]=yr(_s[36]),ys[58]=yr(_s[48]),ys[59]=yr(_s[49]),ys[60]=yr(_s[57]),ys[61]=yr(_s[58]),ys[62]=yr(_s[62]),ys[63]=yr(_s[63]),wn(RM[tu]);Cn(RM);for(let tu=0;tu<3;++tu)bn(RM[tu],w0[tu],64*Nl)}let jv=0;for(let Nl=0;Nl<3;++Nl){const tu=Rs[Kr.idx[Nl]].type;for(let mA=8*hu;mA<8*hu+IS;++mA){jv=sP[Nl][mA];for(let BM=0;BM<gp;++BM){const Ey=64*BM+8*(7&mA);Ms.setUint16(jv+0*tu,w0[Nl][Ey+0],!0),Ms.setUint16(jv+2*tu,w0[Nl][Ey+1],!0),Ms.setUint16(jv+4*tu,w0[Nl][Ey+2],!0),Ms.setUint16(jv+6*tu,w0[Nl][Ey+3],!0),Ms.setUint16(jv+8*tu,w0[Nl][Ey+4],!0),Ms.setUint16(jv+10*tu,w0[Nl][Ey+5],!0),Ms.setUint16(jv+12*tu,w0[Nl][Ey+6],!0),Ms.setUint16(jv+14*tu,w0[Nl][Ey+7],!0),jv+=16*tu}}if(gp!=lv)for(let mA=8*hu;mA<8*hu+IS;++mA){const BM=sP[Nl][mA]+8*gp*2*tu,Ey=64*gp+8*(7&mA);for(let oP=0;oP<PS;++oP)Ms.setUint16(BM+2*oP*tu,w0[Nl][Ey+oP],!0)}}}var _s,ys;const KO=new Uint16Array(Xs);Ms=new DataView(Rl.buffer);for(let hu=0;hu<3;++hu){Rs[Kr.idx[hu]].decoded=!0;const IS=Rs[Kr.idx[hu]].type;if(Rs[hu].type==2)for(let PS=0;PS<Eo;++PS){const jv=sP[hu][PS];for(let Nl=0;Nl<Xs;++Nl)KO[Nl]=Ms.getUint16(jv+2*Nl*IS,!0);for(let Nl=0;Nl<Xs;++Nl)Ms.setFloat32(jv+2*Nl*IS,yr(KO[Nl]),!0)}}})(us,xs,ts,cs,fs,Hn);for(let Kr=0;Kr<ts.length;++Kr){const Cs=ts[Kr];if(!Cs.decoded){if(Cs.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Rs=0,Qs=0;for(let Kl=0;Kl<vn.lines;++Kl){let Rl=xs[Kr][Rs];for(let Ms=0;Ms<Cs.width;++Ms){for(let Xs=0;Xs<2*Cs.type;++Xs)Hn[Rl++]=os[Qs+Xs*Cs.width*Cs.height];Qs++}Rs++}}}}return new DataView(Hn.buffer)}function cr(vn,Fn){const yn=new Uint8Array(vn);let Hn=0;for(;yn[Fn.value+Hn]!=0;)Hn+=1;const nr=new TextDecoder().decode(yn.slice(Fn.value,Fn.value+Hn));return Fn.value=Fn.value+Hn+1,nr}function mr(vn,Fn){const yn=vn.getInt32(Fn.value,!0);return Fn.value=Fn.value+4,yn}function ir(vn,Fn){const yn=vn.getUint32(Fn.value,!0);return Fn.value=Fn.value+4,yn}function Dr(vn,Fn){const yn=vn[Fn.value];return Fn.value=Fn.value+1,yn}function Nr(vn,Fn){const yn=vn.getUint8(Fn.value);return Fn.value=Fn.value+1,yn}const Fr=function(vn,Fn){const yn=Number(vn.getBigInt64(Fn.value,!0));return Fn.value+=8,yn};function Vr(vn,Fn){const yn=vn.getFloat32(Fn.value,!0);return Fn.value+=4,yn}function ps(vn,Fn){return d.A5E.toHalfFloat(Vr(vn,Fn))}function yr(vn){const Fn=(31744&vn)>>10,yn=1023&vn;return(vn>>15?-1:1)*(Fn?Fn===31?yn?NaN:1/0:Math.pow(2,Fn-15)*(1+yn/1024):yn/1024*6103515625e-14)}function Ws(vn,Fn){const yn=vn.getUint16(Fn.value,!0);return Fn.value+=2,yn}function lo(vn,Fn){return yr(Ws(vn,Fn))}function qs(vn,Fn,yn,Hn,nr){return Hn==="string"||Hn==="stringvector"||Hn==="iccProfile"?function(Gn,hr,Hr){const ts=new TextDecoder().decode(new Uint8Array(Gn).slice(hr.value,hr.value+Hr));return hr.value=hr.value+Hr,ts}(Fn,yn,nr):Hn==="chlist"?function(Gn,hr,Hr,ts){const us=Hr.value,cs=[];for(;Hr.value<us+ts-1;){const fs=cr(hr,Hr),os=mr(Gn,Hr),ns=Nr(Gn,Hr);Hr.value+=3;const xs=mr(Gn,Hr),Kr=mr(Gn,Hr);cs.push({name:fs,pixelType:os,pLinear:ns,xSampling:xs,ySampling:Kr})}return Hr.value+=1,cs}(vn,Fn,yn,nr):Hn==="chromaticities"?function(Gn,hr){return{redX:Vr(Gn,hr),redY:Vr(Gn,hr),greenX:Vr(Gn,hr),greenY:Vr(Gn,hr),blueX:Vr(Gn,hr),blueY:Vr(Gn,hr),whiteX:Vr(Gn,hr),whiteY:Vr(Gn,hr)}}(vn,yn):Hn==="compression"?function(Gn,hr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Nr(Gn,hr)]}(vn,yn):Hn==="box2i"?function(Gn,hr){return{xMin:ir(Gn,hr),yMin:ir(Gn,hr),xMax:ir(Gn,hr),yMax:ir(Gn,hr)}}(vn,yn):Hn==="lineOrder"?function(Gn,hr){return["INCREASING_Y"][Nr(Gn,hr)]}(vn,yn):Hn==="float"?Vr(vn,yn):Hn==="v2f"?function(Gn,hr){return[Vr(Gn,hr),Vr(Gn,hr)]}(vn,yn):Hn==="v3f"?function(Gn,hr){return[Vr(Gn,hr),Vr(Gn,hr),Vr(Gn,hr)]}(vn,yn):Hn==="int"?mr(vn,yn):Hn==="rational"?function(Gn,hr){return[mr(Gn,hr),ir(Gn,hr)]}(vn,yn):Hn==="timecode"?function(Gn,hr){return[ir(Gn,hr),ir(Gn,hr)]}(vn,yn):Hn==="preview"?(yn.value+=nr,"skipped"):void(yn.value+=nr)}const Bo=new DataView(e),xa=new Uint8Array(e),dr={value:0},jr=function(vn,Fn,yn){const Hn={};if(vn.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Hn.version=vn.getUint8(4);const nr=vn.getUint8(5);Hn.spec={singleTile:!!(2&nr),longName:!!(4&nr),deepFormat:!!(8&nr),multiPart:!!(16&nr)},yn.value=8;let Gn=!0;for(;Gn;){const hr=cr(Fn,yn);if(hr==0)Gn=!1;else{const Hr=cr(Fn,yn),ts=qs(vn,Fn,yn,Hr,ir(vn,yn));ts===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Hr}'.`):Hn[hr]=ts}}if(-5&nr)throw console.error("EXRHeader:",Hn),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Hn}(Bo,e,dr),zr=function(vn,Fn,yn,Hn,nr){const Gn={size:0,viewer:Fn,array:yn,offset:Hn,width:vn.dataWindow.xMax-vn.dataWindow.xMin+1,height:vn.dataWindow.yMax-vn.dataWindow.yMin+1,channels:vn.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:vn.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(vn.compression){case"NO_COMPRESSION":Gn.lines=1,Gn.uncompress=Dn;break;case"RLE_COMPRESSION":Gn.lines=1,Gn.uncompress=En;break;case"ZIPS_COMPRESSION":Gn.lines=1,Gn.uncompress=Tn;break;case"ZIP_COMPRESSION":Gn.lines=16,Gn.uncompress=Tn;break;case"PIZ_COMPRESSION":Gn.lines=32,Gn.uncompress=Un;break;case"PXR24_COMPRESSION":Gn.lines=16,Gn.uncompress=Pn;break;case"DWAA_COMPRESSION":Gn.lines=32,Gn.uncompress=Yn;break;case"DWAB_COMPRESSION":Gn.lines=256,Gn.uncompress=Yn;break;default:throw new Error("EXRLoader.parse: "+vn.compression+" is unsupported")}if(Gn.scanlineBlockSize=Gn.lines,Gn.type==1)switch(nr){case d.VzW:Gn.getter=lo,Gn.inputSize=2;break;case d.cLu:Gn.getter=Ws,Gn.inputSize=2}else{if(Gn.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Gn.type+" for "+vn.compression+".");switch(nr){case d.VzW:Gn.getter=Vr,Gn.inputSize=4;break;case d.cLu:Gn.getter=ps,Gn.inputSize=4}}Gn.blockCount=(vn.dataWindow.yMax+1)/Gn.scanlineBlockSize;for(let Hr=0;Hr<Gn.blockCount;Hr++)Fr(Fn,Hn);Gn.outputChannels=Gn.channels==3?4:Gn.channels;const hr=Gn.width*Gn.height*Gn.outputChannels;switch(nr){case d.VzW:Gn.byteArray=new Float32Array(hr),Gn.channels<Gn.outputChannels&&Gn.byteArray.fill(1,0,hr);break;case d.cLu:Gn.byteArray=new Uint16Array(hr),Gn.channels<Gn.outputChannels&&Gn.byteArray.fill(15360,0,hr);break;default:console.error("THREE.EXRLoader: unsupported type: ",nr)}return Gn.bytesPerLine=Gn.width*Gn.inputSize*Gn.channels,Gn.outputChannels==4?(Gn.format=d.wk1,Gn.encoding=d.rnI):(Gn.format=d.hEm,Gn.encoding=d.rnI),Gn}(jr,Bo,xa,dr,this.type),Ys={value:0},Jo={R:0,G:1,B:2,A:3,Y:0};for(let vn=0;vn<zr.height/zr.scanlineBlockSize;vn++){const Fn=ir(Bo,dr);zr.size=ir(Bo,dr),zr.lines=Fn+zr.scanlineBlockSize>zr.height?zr.height-Fn:zr.scanlineBlockSize;const yn=zr.size<zr.lines*zr.bytesPerLine?zr.uncompress(zr):Dn(zr);dr.value+=zr.size;for(let Hn=0;Hn<zr.scanlineBlockSize;Hn++){const nr=Hn+vn*zr.scanlineBlockSize;if(nr>=zr.height)break;for(let Gn=0;Gn<zr.channels;Gn++){const hr=Jo[jr.channels[Gn].name];for(let Hr=0;Hr<zr.width;Hr++){Ys.value=(Hn*(zr.channels*zr.width)+Gn*zr.width+Hr)*zr.inputSize;const ts=(zr.height-1-nr)*(zr.width*zr.outputChannels)+Hr*zr.outputChannels+hr;zr.byteArray[ts]=zr.getter(yn,Ys)}}}}return{header:jr,width:zr.width,height:zr.height,data:zr.byteArray,format:zr.format,encoding:zr.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,g){h.encoding=g.encoding,h.minFilter=d.wem,h.magFilter=d.wem,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,g)},s,a)}}class jp extends _e{constructor(){super(...arguments),this.dependencies=[Jr]}async onAdded(e){this._importer||(this._importer=new Ul(class extends pI{constructor(i){super(i),this.setDataType(R1(e.renderer.rendererObject))}},["exr"],!1)),oo.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&oo.Importers.splice(oo.Importers.indexOf(this._importer),1),this._importer=void 0}}function qC(c,e,i){const s=i.length-c-1;if(e>=i[s])return s-1;if(e<=i[c])return c;let a=c,h=s,g=Math.floor((a+h)/2);for(;e<i[g]||e>=i[g+1];)e<i[g]?h=g:a=g,g=Math.floor((a+h)/2);return g}function fI(c,e){let i=1;for(let a=2;a<=c;++a)i*=a;let s=1;for(let a=2;a<=e;++a)s*=a;for(let a=2;a<=c-e;++a)s*=a;return i/s}jp.PluginType="EXRLoadPlugin";class YC extends d.Hyl{constructor(e,i,s,a,h){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=a||0,this.endKnot=h||this.knots.length-1;for(let g=0;g<s.length;++g){const $=s[g];this.controlPoints[g]=new d.Ltg($.x,$.y,$.z,$.w)}}getPoint(e,i=new d.Pa4){const s=i,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),h=function(g,$,nt,rt){const st=qC(g,rt,$),ut=function(gt,yt,wt,It){const Et=[],Ct=[],xt=[];Et[0]=1;for(let Bt=1;Bt<=wt;++Bt){Ct[Bt]=yt-It[gt+1-Bt],xt[Bt]=It[gt+Bt]-yt;let Lt=0;for(let Gt=0;Gt<Bt;++Gt){const Xt=xt[Gt+1],rn=Ct[Bt-Gt],fn=Et[Gt]/(Xt+rn);Et[Gt]=Lt+Xt*fn,Lt=rn*fn}Et[Bt]=Lt}return Et}(st,rt,g,$),mt=new d.Ltg(0,0,0,0);for(let gt=0;gt<=g;++gt){const yt=nt[st-g+gt],wt=ut[gt],It=yt.w*wt;mt.x+=yt.x*It,mt.y+=yt.y*It,mt.z+=yt.z*It,mt.w+=yt.w*wt}return mt}(this.degree,this.knots,this.controlPoints,a);return h.w!==1&&h.divideScalar(h.w),s.set(h.x,h.y,h.z)}getTangent(e,i=new d.Pa4){const s=i,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),h=function(g,$,nt,rt,st){const ut=function(mt,gt,yt,wt,It){const Et=It<mt?It:mt,Ct=[],xt=qC(mt,wt,gt),Bt=function(Gt,Xt,rn,fn,wn){const Cn=[];for(let Pn=0;Pn<=rn;++Pn)Cn[Pn]=0;const bn=[];for(let Pn=0;Pn<=fn;++Pn)bn[Pn]=Cn.slice(0);const Dn=[];for(let Pn=0;Pn<=rn;++Pn)Dn[Pn]=Cn.slice(0);Dn[0][0]=1;const En=Cn.slice(0),Tn=Cn.slice(0);for(let Pn=1;Pn<=rn;++Pn){En[Pn]=Xt-wn[Gt+1-Pn],Tn[Pn]=wn[Gt+Pn]-Xt;let Yn=0;for(let cr=0;cr<Pn;++cr){const mr=Tn[cr+1],ir=En[Pn-cr];Dn[Pn][cr]=mr+ir;const Dr=Dn[cr][Pn-1]/Dn[Pn][cr];Dn[cr][Pn]=Yn+mr*Dr,Yn=ir*Dr}Dn[Pn][Pn]=Yn}for(let Pn=0;Pn<=rn;++Pn)bn[0][Pn]=Dn[Pn][rn];for(let Pn=0;Pn<=rn;++Pn){let Yn=0,cr=1;const mr=[];for(let ir=0;ir<=rn;++ir)mr[ir]=Cn.slice(0);mr[0][0]=1;for(let ir=1;ir<=fn;++ir){let Dr=0;const Nr=Pn-ir,Fr=rn-ir;Pn>=ir&&(mr[cr][0]=mr[Yn][0]/Dn[Fr+1][Nr],Dr=mr[cr][0]*Dn[Nr][Fr]);const Vr=Pn-1<=Fr?ir-1:rn-Pn;for(let yr=Nr>=-1?1:-Nr;yr<=Vr;++yr)mr[cr][yr]=(mr[Yn][yr]-mr[Yn][yr-1])/Dn[Fr+1][Nr+yr],Dr+=mr[cr][yr]*Dn[Nr+yr][Fr];Pn<=Fr&&(mr[cr][ir]=-mr[Yn][ir-1]/Dn[Fr+1][Pn],Dr+=mr[cr][ir]*Dn[Pn][Fr]),bn[ir][Pn]=Dr;const ps=Yn;Yn=cr,cr=ps}}let Un=rn;for(let Pn=1;Pn<=fn;++Pn){for(let Yn=0;Yn<=rn;++Yn)bn[Pn][Yn]*=Un;Un*=rn-Pn}return bn}(xt,wt,mt,Et,gt),Lt=[];for(let Gt=0;Gt<yt.length;++Gt){const Xt=yt[Gt].clone(),rn=Xt.w;Xt.x*=rn,Xt.y*=rn,Xt.z*=rn,Lt[Gt]=Xt}for(let Gt=0;Gt<=Et;++Gt){const Xt=Lt[xt-mt].clone().multiplyScalar(Bt[Gt][0]);for(let rn=1;rn<=mt;++rn)Xt.add(Lt[xt-mt+rn].clone().multiplyScalar(Bt[Gt][rn]));Ct[Gt]=Xt}for(let Gt=Et+1;Gt<=It+1;++Gt)Ct[Gt]=new d.Ltg(0,0,0);return Ct}(g,$,nt,rt,st);return function(mt){const gt=mt.length,yt=[],wt=[];for(let Et=0;Et<gt;++Et){const Ct=mt[Et];yt[Et]=new d.Pa4(Ct.x,Ct.y,Ct.z),wt[Et]=Ct.w}const It=[];for(let Et=0;Et<gt;++Et){const Ct=yt[Et].clone();for(let xt=1;xt<=Et;++xt)Ct.sub(It[Et-xt].clone().multiplyScalar(fI(Et,xt)*wt[xt]));It[Et]=Ct.divideScalar(wt[0])}return It}(ut)}(this.degree,this.knots,this.controlPoints,a,1);return s.copy(h[1]).normalize(),s}}let bo,cu,zp;class mI extends d.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,g=h.path===""?d.Zp0.extractUrlBase(e):h.path,$=new d.hH6(this.manager);$.setPath(h.path),$.setResponseType("arraybuffer"),$.setRequestHeader(h.requestHeader),$.setWithCredentials(h.withCredentials),$.load(e,function(nt){try{i(h.parse(nt,g))}catch(rt){a?a(rt):console.error(rt),h.manager.itemError(e)}},s,a)}parse(e,i){if(function(a){const h="Kaydara FBX Binary  \0";return a.byteLength>=h.length&&h===Xl(a,0,h.length)}(e))bo=new bP().parse(e);else{const a=Xl(e);if(!function(h){const g=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let $=0;function nt(rt){const st=h[rt-1];return h=h.slice($+rt),$++,st}for(let rt=0;rt<g.length;++rt)if(nt(1)===g[rt])return!1;return!0}(a))throw new Error("THREE.FBXLoader: Unknown format.");if(In(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+In(a));bo=new QE().parse(a)}const s=new d.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new nA(s,this.manager).parse(bo)}}class nA{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){cu=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),a=this.parseDeformers(),h=new gI().parse(a);return this.parseScene(a,h,s),zp}parseConnections(){const e=new Map;return"Connections"in bo&&bo.Connections.connections.forEach(function(i){const s=i[0],a=i[1],h=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const g={ID:a,relationship:h};e.get(s).parents.push(g),e.has(a)||e.set(a,{parents:[],children:[]});const $={ID:s,relationship:h};e.get(a).children.push($)}),e}parseImages(){const e={},i={};if("Video"in bo.Objects){const s=bo.Objects.Video;for(const a in s){const h=s[a];if(e[parseInt(a)]=h.RelativeFilename||h.Filename,"Content"in h){const g=h.Content instanceof ArrayBuffer&&h.Content.byteLength>0,$=typeof h.Content=="string"&&h.Content!=="";if(g||$){const nt=this.parseImage(s[a]);i[h.RelativeFilename||h.Filename]=nt}}}}for(const s in e){const a=e[s];i[a]!==void 0?e[s]=i[a]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,a=s.slice(s.lastIndexOf(".")+1).toLowerCase();let h;switch(a){case"bmp":h="image/bmp";break;case"jpg":case"jpeg":h="image/jpeg";break;case"png":h="image/png";break;case"tif":h="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),h="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if(typeof i=="string")return"data:"+h+";base64,"+i;{const g=new Uint8Array(i);return window.URL.createObjectURL(new Blob([g],{type:h}))}}parseTextures(e){const i=new Map;if("Texture"in bo.Objects){const s=bo.Objects.Texture;for(const a in s){const h=this.parseTexture(s[a],e);i.set(parseInt(a),h)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const a=e.WrapModeU,h=e.WrapModeV,g=a!==void 0?a.value:0,$=h!==void 0?h.value:0;if(s.wrapS=g===0?d.rpg:d.uWy,s.wrapT=$===0?d.rpg:d.uWy,"Scaling"in e){const nt=e.Scaling.value;s.repeat.x=nt[0],s.repeat.y=nt[1]}if("Translation"in e){const nt=e.Translation.value;s.offset.x=nt[0],s.offset.y=nt[1]}return s}loadTexture(e,i){let s;const a=this.textureLoader.path,h=cu.get(e.id).children;let g;h!==void 0&&h.length>0&&i[h[0].ID]!==void 0&&(s=i[h[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const $=e.FileName.slice(-3).toLowerCase();if($==="tga"){const nt=this.manager.getHandler(".tga");nt===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),g=new d.xEZ):(nt.setPath(this.textureLoader.path),g=nt.load(s))}else $==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),g=new d.xEZ):g=this.textureLoader.load(s);return this.textureLoader.setPath(a),g}parseMaterials(e){const i=new Map;if("Material"in bo.Objects){const s=bo.Objects.Material;for(const a in s){const h=this.parseMaterial(s[a],e);h!==null&&i.set(parseInt(a),h)}}return i}parseMaterial(e,i){const s=e.id,a=e.attrName;let h=e.ShadingModel;if(typeof h=="object"&&(h=h.value),!cu.has(s))return null;const g=this.parseParameters(e,i,s);let $;switch(h.toLowerCase()){case"phong":$=new d.xoR;break;case"lambert":$=new d.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',h),$=new d.xoR}return $.setValues(g),$.name=a,$}parseParameters(e,i,s){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=new d.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(a.color=new d.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=new d.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(a.emissive=new d.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=new d.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(a.specular=new d.Ilk().fromArray(e.SpecularColor.value));const h=this;return cu.get(s).children.forEach(function(g){const $=g.relationship;switch($){case"Bump":a.bumpMap=h.getTexture(i,g.ID);break;case"Maya|TEX_ao_map":a.aoMap=h.getTexture(i,g.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=h.getTexture(i,g.ID),a.map!==void 0&&(a.map.encoding=d.knz);break;case"DisplacementColor":a.displacementMap=h.getTexture(i,g.ID);break;case"EmissiveColor":a.emissiveMap=h.getTexture(i,g.ID),a.emissiveMap!==void 0&&(a.emissiveMap.encoding=d.knz);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=h.getTexture(i,g.ID);break;case"ReflectionColor":a.envMap=h.getTexture(i,g.ID),a.envMap!==void 0&&(a.envMap.mapping=d.dSO,a.envMap.encoding=d.knz);break;case"SpecularColor":a.specularMap=h.getTexture(i,g.ID),a.specularMap!==void 0&&(a.specularMap.encoding=d.knz);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=h.getTexture(i,g.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",$)}}),a}getTexture(e,i){return"LayeredTexture"in bo.Objects&&i in bo.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=cu.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in bo.Objects){const s=bo.Objects.Deformer;for(const a in s){const h=s[a],g=cu.get(parseInt(a));if(h.attrType==="Skin"){const $=this.parseSkeleton(g,s);$.ID=a,g.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),$.geometryID=g.parents[0].ID,e[a]=$}else if(h.attrType==="BlendShape"){const $={id:a};$.rawTargets=this.parseMorphTargets(g,s),$.id=a,g.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[a]=$}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(a){const h=i[a.ID];if(h.attrType!=="Cluster")return;const g={ID:a.ID,indices:[],weights:[],transformLink:new d.yGw().fromArray(h.TransformLink.a)};"Indexes"in h&&(g.indices=h.Indexes.a,g.weights=h.Weights.a),s.push(g)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let a=0;a<e.children.length;a++){const h=e.children[a],g=i[h.ID],$={name:g.attrName,initialWeight:g.DeformPercent,id:g.id,fullWeights:g.FullWeights.a};if(g.attrType!=="BlendShapeChannel")return;$.geoID=cu.get(parseInt(h.ID)).children.filter(function(nt){return nt.relationship===void 0})[0].ID,s.push($)}return s}parseScene(e,i,s){zp=new d.ZAu;const a=this.parseModels(e.skeletons,i,s),h=bo.Objects.Model,g=this;a.forEach(function(nt){const rt=h[nt.ID];g.setLookAtProperties(nt,rt),cu.get(nt.ID).parents.forEach(function(st){const ut=a.get(st.ID);ut!==void 0&&ut.add(nt)}),nt.parent===null&&zp.add(nt)}),this.bindSkeleton(e.skeletons,i,a),this.createAmbientLight(),zp.traverse(function(nt){if(nt.userData.transformData){nt.parent&&(nt.userData.transformData.parentMatrix=nt.parent.matrix,nt.userData.transformData.parentMatrixWorld=nt.parent.matrixWorld);const rt=Ro(nt.userData.transformData);nt.applyMatrix4(rt),nt.updateWorldMatrix()}});const $=new vI().parse();zp.children.length===1&&zp.children[0].isGroup&&(zp.children[0].animations=$,zp=zp.children[0]),zp.animations=$}parseModels(e,i,s){const a=new Map,h=bo.Objects.Model;for(const g in h){const $=parseInt(g),nt=h[g],rt=cu.get($);let st=this.buildSkeleton(rt,e,$,nt.attrName);if(!st){switch(nt.attrType){case"Camera":st=this.createCamera(rt);break;case"Light":st=this.createLight(rt);break;case"Mesh":st=this.createMesh(rt,i,s);break;case"NurbsCurve":st=this.createCurve(rt,i);break;case"LimbNode":case"Root":st=new d.N$j;break;default:st=new d.ZAu}st.name=nt.attrName?d.iUV.sanitizeNodeName(nt.attrName):"",st.ID=$}this.getTransformData(st,nt),a.set($,st)}return a}buildSkeleton(e,i,s,a){let h=null;return e.parents.forEach(function(g){for(const $ in i){const nt=i[$];nt.rawBones.forEach(function(rt,st){if(rt.ID===g.ID){const ut=h;h=new d.N$j,h.matrixWorld.copy(rt.transformLink),h.name=a?d.iUV.sanitizeNodeName(a):"",h.ID=s,nt.bones[st]=h,ut!==null&&h.add(ut)}})}}),h}createCamera(e){let i,s;if(e.children.forEach(function(a){const h=bo.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new d.Tme;else{let a=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(a=1);let h=1;s.NearPlane!==void 0&&(h=s.NearPlane.value/1e3);let g=1e3;s.FarPlane!==void 0&&(g=s.FarPlane.value/1e3);let $=window.innerWidth,nt=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&($=s.AspectWidth.value,nt=s.AspectHeight.value);const rt=$/nt;let st=45;s.FieldOfView!==void 0&&(st=s.FieldOfView.value);const ut=s.FocalLength?s.FocalLength.value:null;switch(a){case 0:i=new d.cPb(st,rt,h,g),ut!==null&&i.setFocalLength(ut);break;case 1:i=new d.iKG(-$/2,$/2,nt/2,-nt/2,h,g);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),i=new d.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(a){const h=bo.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new d.Tme;else{s.LightType===void 0||s.LightType.value;let a=16777215;s.Color!==void 0&&(a=new d.Ilk().fromArray(s.Color.value));let h=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(h=0);let g=0;s.FarAttenuationEnd!==void 0&&(g=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const $=1;switch(e){case 0:i=new d.cek(a,h,g,$);break;case 1:i=new d.Ox3(a,h);break;case 2:let nt=Math.PI/3;s.InnerAngle!==void 0&&(nt=d.M8C.degToRad(s.InnerAngle.value));let rt=0;s.OuterAngle!==void 0&&(rt=d.M8C.degToRad(s.OuterAngle.value),rt=Math.max(rt,1)),i=new d.PMe(a,h,g,nt,rt,$);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new d.cek(a,h)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let a,h=null,g=null;const $=[];return e.children.forEach(function(nt){i.has(nt.ID)&&(h=i.get(nt.ID)),s.has(nt.ID)&&$.push(s.get(nt.ID))}),$.length>1?g=$:$.length>0?g=$[0]:(g=new d.xoR({color:13421772}),$.push(g)),"color"in h.attributes&&$.forEach(function(nt){nt.vertexColors=!0}),h.FBX_Deformer?(a=new d.TUv(h,g),a.normalizeSkinWeights()):a=new d.Kj0(h,g),a}createCurve(e,i){const s=e.children.reduce(function(h,g){return i.has(g.ID)&&(h=i.get(g.ID)),h},null),a=new d.nls({color:3342591,linewidth:1});return new d.x12(s,a)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?Ls(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&cu.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const a=bo.Objects.Model[s.ID];if("Lcl_Translation"in a){const h=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(h),zp.add(e.target)):e.lookAt(new d.Pa4().fromArray(h))}}})}bindSkeleton(e,i,s){const a=this.parsePoseNodes();for(const h in e){const g=e[h];cu.get(parseInt(g.ID)).parents.forEach(function($){if(i.has($.ID)){const nt=$.ID;cu.get(nt).parents.forEach(function(rt){s.has(rt.ID)&&s.get(rt.ID).bind(new d.OdW(g.bones),a[rt.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in bo.Objects){const i=bo.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const a=i[s].PoseNode;Array.isArray(a)?a.forEach(function(h){e[h.Node]=new d.yGw().fromArray(h.Matrix.a)}):e[a.Node]=new d.yGw().fromArray(a.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in bo&&"AmbientColor"in bo.GlobalSettings){const e=bo.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],a=e[2];if(i!==0||s!==0||a!==0){const h=new d.Ilk(i,s,a);zp.add(new d.Mig(h,1))}}}}class gI{parse(e){const i=new Map;if("Geometry"in bo.Objects){const s=bo.Objects.Geometry;for(const a in s){const h=cu.get(parseInt(a)),g=this.parseGeometry(h,s[a],e);i.set(parseInt(a),g)}}return i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const a=s.skeletons,h=[],g=e.parents.map(function(ut){return bo.Objects.Model[ut.ID]});if(g.length===0)return;const $=e.children.reduce(function(ut,mt){return a[mt.ID]!==void 0&&(ut=a[mt.ID]),ut},null);e.children.forEach(function(ut){s.morphTargets[ut.ID]!==void 0&&h.push(s.morphTargets[ut.ID])});const nt=g[0],rt={};"RotationOrder"in nt&&(rt.eulerOrder=Ls(nt.RotationOrder.value)),"InheritType"in nt&&(rt.inheritType=parseInt(nt.InheritType.value)),"GeometricTranslation"in nt&&(rt.translation=nt.GeometricTranslation.value),"GeometricRotation"in nt&&(rt.rotation=nt.GeometricRotation.value),"GeometricScaling"in nt&&(rt.scale=nt.GeometricScaling.value);const st=Ro(rt);return this.genGeometry(i,$,h,st)}genGeometry(e,i,s,a){const h=new d.u9r;e.attrName&&(h.name=e.attrName);const g=this.parseGeoNode(e,i),$=this.genBuffers(g),nt=new d.a$l($.vertex,3);if(nt.applyMatrix4(a),h.setAttribute("position",nt),$.colors.length>0&&h.setAttribute("color",new d.a$l($.colors,3)),i&&(h.setAttribute("skinIndex",new d.qlB($.weightsIndices,4)),h.setAttribute("skinWeight",new d.a$l($.vertexWeights,4)),h.FBX_Deformer=i),$.normal.length>0){const rt=new d.Vkp().getNormalMatrix(a),st=new d.a$l($.normal,3);st.applyNormalMatrix(rt),h.setAttribute("normal",st)}if($.uvs.forEach(function(rt,st){let ut="uv"+(st+1).toString();st===0&&(ut="uv"),h.setAttribute(ut,new d.a$l($.uvs[st],2))}),g.material&&g.material.mappingType!=="AllSame"){let rt=$.materialIndex[0],st=0;if($.materialIndex.forEach(function(ut,mt){ut!==rt&&(h.addGroup(st,mt-st,rt),rt=ut,st=mt)}),h.groups.length>0){const ut=h.groups[h.groups.length-1],mt=ut.start+ut.count;mt!==$.materialIndex.length&&h.addGroup(mt,$.materialIndex.length-mt,rt)}h.groups.length===0&&h.addGroup(0,$.materialIndex.length,$.materialIndex[0])}return this.addMorphTargets(h,e,s,a),h}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let a=0;for(;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(a,h){a.indices.forEach(function(g,$){s.weightTable[g]===void 0&&(s.weightTable[g]=[]),s.weightTable[g].push({id:h,weight:a.weights[$]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,a=0,h=!1,g=[],$=[],nt=[],rt=[],st=[],ut=[];const mt=this;return e.vertexIndices.forEach(function(gt,yt){let wt,It=!1;gt<0&&(gt^=-1,It=!0);let Et=[],Ct=[];if(g.push(3*gt,3*gt+1,3*gt+2),e.color){const xt=Ir(yt,s,gt,e.color);nt.push(xt[0],xt[1],xt[2])}if(e.skeleton){if(e.weightTable[gt]!==void 0&&e.weightTable[gt].forEach(function(xt){Ct.push(xt.weight),Et.push(xt.id)}),Ct.length>4){h||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),h=!0);const xt=[0,0,0,0],Bt=[0,0,0,0];Ct.forEach(function(Lt,Gt){let Xt=Lt,rn=Et[Gt];Bt.forEach(function(fn,wn,Cn){if(Xt>fn){Cn[wn]=Xt,Xt=fn;const bn=xt[wn];xt[wn]=rn,rn=bn}})}),Et=xt,Ct=Bt}for(;Ct.length<4;)Ct.push(0),Et.push(0);for(let xt=0;xt<4;++xt)st.push(Ct[xt]),ut.push(Et[xt])}if(e.normal){const xt=Ir(yt,s,gt,e.normal);$.push(xt[0],xt[1],xt[2])}e.material&&e.material.mappingType!=="AllSame"&&(wt=Ir(yt,s,gt,e.material)[0],wt<0&&(console.warn("THREE.FBXLoader: Invalid material index:",wt),wt=0)),e.uv&&e.uv.forEach(function(xt,Bt){const Lt=Ir(yt,s,gt,xt);rt[Bt]===void 0&&(rt[Bt]=[]),rt[Bt].push(Lt[0]),rt[Bt].push(Lt[1])}),a++,It&&(mt.genFace(i,e,g,wt,$,nt,rt,st,ut,a),s++,a=0,g=[],$=[],nt=[],rt=[],st=[],ut=[])}),i}genFace(e,i,s,a,h,g,$,nt,rt,st){for(let ut=2;ut<st;ut++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(ut-1)]]),e.vertex.push(i.vertexPositions[s[3*(ut-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(ut-1)+2]]),e.vertex.push(i.vertexPositions[s[3*ut]]),e.vertex.push(i.vertexPositions[s[3*ut+1]]),e.vertex.push(i.vertexPositions[s[3*ut+2]]),i.skeleton&&(e.vertexWeights.push(nt[0]),e.vertexWeights.push(nt[1]),e.vertexWeights.push(nt[2]),e.vertexWeights.push(nt[3]),e.vertexWeights.push(nt[4*(ut-1)]),e.vertexWeights.push(nt[4*(ut-1)+1]),e.vertexWeights.push(nt[4*(ut-1)+2]),e.vertexWeights.push(nt[4*(ut-1)+3]),e.vertexWeights.push(nt[4*ut]),e.vertexWeights.push(nt[4*ut+1]),e.vertexWeights.push(nt[4*ut+2]),e.vertexWeights.push(nt[4*ut+3]),e.weightsIndices.push(rt[0]),e.weightsIndices.push(rt[1]),e.weightsIndices.push(rt[2]),e.weightsIndices.push(rt[3]),e.weightsIndices.push(rt[4*(ut-1)]),e.weightsIndices.push(rt[4*(ut-1)+1]),e.weightsIndices.push(rt[4*(ut-1)+2]),e.weightsIndices.push(rt[4*(ut-1)+3]),e.weightsIndices.push(rt[4*ut]),e.weightsIndices.push(rt[4*ut+1]),e.weightsIndices.push(rt[4*ut+2]),e.weightsIndices.push(rt[4*ut+3])),i.color&&(e.colors.push(g[0]),e.colors.push(g[1]),e.colors.push(g[2]),e.colors.push(g[3*(ut-1)]),e.colors.push(g[3*(ut-1)+1]),e.colors.push(g[3*(ut-1)+2]),e.colors.push(g[3*ut]),e.colors.push(g[3*ut+1]),e.colors.push(g[3*ut+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),i.normal&&(e.normal.push(h[0]),e.normal.push(h[1]),e.normal.push(h[2]),e.normal.push(h[3*(ut-1)]),e.normal.push(h[3*(ut-1)+1]),e.normal.push(h[3*(ut-1)+2]),e.normal.push(h[3*ut]),e.normal.push(h[3*ut+1]),e.normal.push(h[3*ut+2])),i.uv&&i.uv.forEach(function(mt,gt){e.uvs[gt]===void 0&&(e.uvs[gt]=[]),e.uvs[gt].push($[gt][0]),e.uvs[gt].push($[gt][1]),e.uvs[gt].push($[gt][2*(ut-1)]),e.uvs[gt].push($[gt][2*(ut-1)+1]),e.uvs[gt].push($[gt][2*ut]),e.uvs[gt].push($[gt][2*ut+1])})}addMorphTargets(e,i,s,a){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const h=this;s.forEach(function(g){g.rawTargets.forEach(function($){const nt=bo.Objects.Geometry[$.geoID];nt!==void 0&&h.genMorphGeometry(e,i,nt,a,$.name)})})}genMorphGeometry(e,i,s,a,h){const g=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],$=s.Vertices!==void 0?s.Vertices.a:[],nt=s.Indexes!==void 0?s.Indexes.a:[],rt=3*e.attributes.position.count,st=new Float32Array(rt);for(let yt=0;yt<nt.length;yt++){const wt=3*nt[yt];st[wt]=$[3*yt],st[wt+1]=$[3*yt+1],st[wt+2]=$[3*yt+2]}const ut={vertexIndices:g,vertexPositions:st},mt=this.genBuffers(ut),gt=new d.a$l(mt.vertex,3);gt.name=h||s.attrName,gt.applyMatrix4(a),e.morphAttributes.position.push(gt)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Normals.a;let h=[];return s==="IndexToDirect"&&("NormalIndex"in e?h=e.NormalIndex.a:"NormalsIndex"in e&&(h=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:h,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.UV.a;let h=[];return s==="IndexToDirect"&&(h=e.UVIndex.a),{dataSize:2,buffer:a,indices:h,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Colors.a;let h=[];return s==="IndexToDirect"&&(h=e.ColorIndex.a),{dataSize:4,buffer:a,indices:h,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const a=e.Materials.a,h=[];for(let g=0;g<a.length;++g)h.push(g);return{dataSize:1,buffer:a,indices:h,mappingType:i,referenceType:s}}parseNurbsGeometry(e){if(YC===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new d.u9r;const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new d.u9r;const s=i-1,a=e.KnotVector.a,h=[],g=e.Points.a;for(let st=0,ut=g.length;st<ut;st+=4)h.push(new d.Ltg().fromArray(g,st));let $,nt;if(e.Form==="Closed")h.push(h[0]);else if(e.Form==="Periodic"){$=s,nt=a.length-1-$;for(let st=0;st<s;++st)h.push(h[st])}const rt=new YC(s,a,h,$,nt).getPoints(12*h.length);return new d.u9r().setFromPoints(rt)}}class vI{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const a=i[s],h=this.addClip(a);e.push(h)}return e}parseClips(){if(bo.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=bo.Objects.AnimationCurveNode,i=new Map;for(const s in e){const a=e[s];if(a.attrName.match(/S|R|T|DeformPercent/)!==null){const h={id:a.id,attr:a.attrName,curves:{}};i.set(h.id,h)}}return i}parseAnimationCurves(e){const i=bo.Objects.AnimationCurve;for(const s in i){const a={id:i[s].id,times:i[s].KeyTime.a.map(Ar),values:i[s].KeyValueFloat.a},h=cu.get(a.id);if(h!==void 0){const g=h.parents[0].ID,$=h.parents[0].relationship;$.match(/X/)?e.get(g).curves.x=a:$.match(/Y/)?e.get(g).curves.y=a:$.match(/Z/)?e.get(g).curves.z=a:$.match(/d|DeformPercent/)&&e.has(g)&&(e.get(g).curves.morph=a)}}}parseAnimationLayers(e){const i=bo.Objects.AnimationLayer,s=new Map;for(const a in i){const h=[],g=cu.get(parseInt(a));g!==void 0&&(g.children.forEach(function($,nt){if(e.has($.ID)){const rt=e.get($.ID);if(rt.curves.x!==void 0||rt.curves.y!==void 0||rt.curves.z!==void 0){if(h[nt]===void 0){const st=cu.get($.ID).parents.filter(function(ut){return ut.relationship!==void 0})[0].ID;if(st!==void 0){const ut=bo.Objects.Model[st.toString()];if(ut===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",$);const mt={modelName:ut.attrName?d.iUV.sanitizeNodeName(ut.attrName):"",ID:ut.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};zp.traverse(function(gt){gt.ID===ut.id&&(mt.transform=gt.matrix,gt.userData.transformData&&(mt.eulerOrder=gt.userData.transformData.eulerOrder))}),mt.transform||(mt.transform=new d.yGw),"PreRotation"in ut&&(mt.preRotation=ut.PreRotation.value),"PostRotation"in ut&&(mt.postRotation=ut.PostRotation.value),h[nt]=mt}}h[nt]&&(h[nt][rt.attr]=rt)}else if(rt.curves.morph!==void 0){if(h[nt]===void 0){const st=cu.get($.ID).parents.filter(function(It){return It.relationship!==void 0})[0].ID,ut=cu.get(st).parents[0].ID,mt=cu.get(ut).parents[0].ID,gt=cu.get(mt).parents[0].ID,yt=bo.Objects.Model[gt],wt={modelName:yt.attrName?d.iUV.sanitizeNodeName(yt.attrName):"",morphName:bo.Objects.Deformer[st].attrName};h[nt]=wt}h[nt][rt.attr]=rt}}}),s.set(parseInt(a),h))}return s}parseAnimStacks(e){const i=bo.Objects.AnimationStack,s={};for(const a in i){const h=cu.get(parseInt(a)).children;h.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const g=e.get(h[0].ID);s[a]={name:i[a].attrName,layer:g}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(a){i=i.concat(s.generateTracks(a))}),new d.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new d.Pa4,a=new d._fP,h=new d.Pa4;if(e.transform&&e.transform.decompose(s,a,h),s=s.toArray(),a=new d.USm().setFromQuaternion(a,e.eulerOrder).toArray(),h=h.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const g=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");g!==void 0&&i.push(g)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const g=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);g!==void 0&&i.push(g)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const g=this.generateVectorTrack(e.modelName,e.S.curves,h,"scale");g!==void 0&&i.push(g)}if(e.DeformPercent!==void 0){const g=this.generateMorphTrack(e);g!==void 0&&i.push(g)}return i}generateVectorTrack(e,i,s,a){const h=this.getTimesForAllAxes(i),g=this.getKeyframeTrackValues(h,i,s);return new d.yC1(e+"."+a,h,g)}generateRotationTrack(e,i,s,a,h,g){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(d.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(d.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(d.M8C.degToRad));const $=this.getTimesForAllAxes(i),nt=this.getKeyframeTrackValues($,i,s);a!==void 0&&((a=a.map(d.M8C.degToRad)).push(g),a=new d.USm().fromArray(a),a=new d._fP().setFromEuler(a)),h!==void 0&&((h=h.map(d.M8C.degToRad)).push(g),h=new d.USm().fromArray(h),h=new d._fP().setFromEuler(h).invert());const rt=new d._fP,st=new d.USm,ut=[];for(let mt=0;mt<nt.length;mt+=3)st.set(nt[mt],nt[mt+1],nt[mt+2],g),rt.setFromEuler(st),a!==void 0&&rt.premultiply(a),h!==void 0&&rt.multiply(h),rt.toArray(ut,mt/3*4);return new d.iLg(e+".quaternion",$,ut)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(h){return h/100}),a=zp.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new d.dUE(e.modelName+".morphTargetInfluences["+a+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,a){return s-a}),i.length>1){let s=1,a=i[0];for(let h=1;h<i.length;h++){const g=i[h];g!==a&&(i[s]=g,a=g,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const a=s,h=[];let g=-1,$=-1,nt=-1;return e.forEach(function(rt){if(i.x&&(g=i.x.times.indexOf(rt)),i.y&&($=i.y.times.indexOf(rt)),i.z&&(nt=i.z.times.indexOf(rt)),g!==-1){const st=i.x.values[g];h.push(st),a[0]=st}else h.push(a[0]);if($!==-1){const st=i.y.values[$];h.push(st),a[1]=st}else h.push(a[1]);if(nt!==-1){const st=i.z.values[nt];h.push(st),a[2]=st}else h.push(a[2])}),h}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],a=e.values[i]-s,h=Math.abs(a);if(h>=180){const g=h/180,$=a/g;let nt=s+$;const rt=e.times[i-1],st=(e.times[i]-rt)/g;let ut=rt+st;const mt=[],gt=[];for(;ut<e.times[i];)mt.push(ut),ut+=st,gt.push(nt),nt+=$;e.times=ko(e.times,i,mt),e.values=ko(e.values,i,gt)}}}}class QE{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new XC,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(a,h){const g=a.match(/^[\s\t]*;/),$=a.match(/^[\s\t]*$/);if(g||$)return;const nt=a.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),rt=a.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),st=a.match("^\\t{"+(i.currentIndent-1)+"}}");nt?i.parseNodeBegin(a,nt):rt?i.parseNodeProperty(a,rt,s[++h]):st?i.popStack():a.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),a=i[2].split(",").map(function(nt){return nt.trim().replace(/^"/,"").replace(/"$/,"")}),h={name:s},g=this.parseNodeAttr(a),$=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,h):s in $?(s==="PoseNode"?$.PoseNode.push(h):$[s].id!==void 0&&($[s]={},$[s][$[s].id]=$[s]),g.id!==""&&($[s][g.id]=h)):typeof g.id=="number"?($[s]={},$[s][g.id]=h):s!=="Properties70"&&($[s]=s==="PoseNode"?[h]:h),typeof g.id=="number"&&(h.id=g.id),g.name!==""&&(h.attrName=g.name),g.type!==""&&(h.attrType=g.type),this.pushStack(h)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",a="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:i,name:s,type:a}}parseNodeProperty(e,i,s){let a=i[1].replace(/^"/,"").replace(/"$/,"").trim(),h=i[2].replace(/^"/,"").replace(/"$/,"").trim();a==="Content"&&h===","&&(h=s.replace(/"/g,"").replace(/,$/,"").trim());const g=this.getCurrentNode();if(g.name!=="Properties70"){if(a==="C"){const $=h.split(",").slice(1),nt=parseInt($[0]),rt=parseInt($[1]);let st=h.split(",").slice(3);st=st.map(function(ut){return ut.trim().replace(/^"/,"")}),a="connections",h=[nt,rt],function(ut,mt){for(let gt=0,yt=ut.length,wt=mt.length;gt<wt;gt++,yt++)ut[yt]=mt[gt]}(h,st),g[a]===void 0&&(g[a]=[])}a==="Node"&&(g.id=h),a in g&&Array.isArray(g[a])?g[a].push(h):a!=="a"?g[a]=h:g.a=h,this.setCurrentProp(g,a),a==="a"&&h.slice(-1)!==","&&(g.a=mo(h))}else this.parseNodeSpecialProperty(e,a,h)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=mo(i.a))}parseNodeSpecialProperty(e,i,s){const a=s.split('",').map(function(st){return st.trim().replace(/^\"/,"").replace(/\s/,"_")}),h=a[0],g=a[1],$=a[2],nt=a[3];let rt=a[4];switch(g){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":rt=parseFloat(rt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":rt=mo(rt)}this.getPrevNode()[h]={type:g,type2:$,flag:nt,value:rt},this.setCurrentProp(this.getPrevNode(),h)}}class bP{parse(e){const i=new Gx(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const a=new XC;for(;!this.endOfContent(i);){const h=this.parseNode(i,s);h!==null&&a.add(h.name,h)}return a}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},a=i>=7500?e.getUint64():e.getUint32(),h=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const g=e.getUint8(),$=e.getString(g);if(a===0)return null;const nt=[];for(let mt=0;mt<h;mt++)nt.push(this.parseProperty(e));const rt=nt.length>0?nt[0]:"",st=nt.length>1?nt[1]:"",ut=nt.length>2?nt[2]:"";for(s.singleProperty=h===1&&e.getOffset()===a;a>e.getOffset();){const mt=this.parseNode(e,i);mt!==null&&this.parseSubNode($,s,mt)}return s.propertyList=nt,typeof rt=="number"&&(s.id=rt),st!==""&&(s.attrName=st),ut!==""&&(s.attrType=ut),$!==""&&(s.name=$),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const a=s.propertyList[0];Array.isArray(a)?(i[s.name]=s,s.a=a):i[s.name]=a}else if(e==="Connections"&&s.name==="C"){const a=[];s.propertyList.forEach(function(h,g){g!==0&&a.push(h)}),i.connections===void 0&&(i.connections=[]),i.connections.push(a)}else if(s.name==="Properties70")Object.keys(s).forEach(function(a){i[a]=s[a]});else if(e==="Properties70"&&s.name==="P"){let a=s.propertyList[0],h=s.propertyList[1];const g=s.propertyList[2],$=s.propertyList[3];let nt;a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),h.indexOf("Lcl ")===0&&(h=h.replace("Lcl ","Lcl_")),nt=h==="Color"||h==="ColorRGB"||h==="Vector"||h==="Vector3D"||h.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[a]={type:h,type2:g,flag:$,value:nt}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const a=e.getUint32(),h=e.getUint32(),g=e.getUint32();if(h===0)switch(i){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}_===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const $=Qr(new Uint8Array(e.getArrayBuffer(g))),nt=new Gx($.buffer);switch(i){case"b":case"c":return nt.getBooleanArray(a);case"d":return nt.getFloat64Array(a);case"f":return nt.getFloat32Array(a);case"i":return nt.getInt32Array(a);case"l":return nt.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class Gx{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){let i=[];for(let a=0;a<e;a++)i[a]=this.getUint8();const s=i.indexOf(0);return s>=0&&(i=i.slice(0,s)),d.Zp0.decodeText(new Uint8Array(i))}}class XC{add(e,i){this[e]=i}}function In(c){const e=c.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Ar(c){return c/46186158e3}const Rr=[];function Ir(c,e,i,s){let a;switch(s.mappingType){case"ByPolygonVertex":a=c;break;case"ByPolygon":a=e;break;case"ByVertice":a=i;break;case"AllSame":a=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(a=s.indices[a]);const h=a*s.dataSize,g=h+s.dataSize;return function($,nt,rt,st){for(let ut=rt,mt=0;ut<st;ut++,mt++)$[mt]=nt[ut];return $}(Rr,s.buffer,h,g)}const Gr=new d.USm,gs=new d.Pa4;function Ro(c){const e=new d.yGw,i=new d.yGw,s=new d.yGw,a=new d.yGw,h=new d.yGw,g=new d.yGw,$=new d.yGw,nt=new d.yGw,rt=new d.yGw,st=new d.yGw,ut=new d.yGw,mt=new d.yGw,gt=c.inheritType?c.inheritType:0;if(c.translation&&e.setPosition(gs.fromArray(c.translation)),c.preRotation){const wn=c.preRotation.map(d.M8C.degToRad);wn.push(c.eulerOrder||d.USm.DefaultOrder),i.makeRotationFromEuler(Gr.fromArray(wn))}if(c.rotation){const wn=c.rotation.map(d.M8C.degToRad);wn.push(c.eulerOrder||d.USm.DefaultOrder),s.makeRotationFromEuler(Gr.fromArray(wn))}if(c.postRotation){const wn=c.postRotation.map(d.M8C.degToRad);wn.push(c.eulerOrder||d.USm.DefaultOrder),a.makeRotationFromEuler(Gr.fromArray(wn)),a.invert()}c.scale&&h.scale(gs.fromArray(c.scale)),c.scalingOffset&&$.setPosition(gs.fromArray(c.scalingOffset)),c.scalingPivot&&g.setPosition(gs.fromArray(c.scalingPivot)),c.rotationOffset&&nt.setPosition(gs.fromArray(c.rotationOffset)),c.rotationPivot&&rt.setPosition(gs.fromArray(c.rotationPivot)),c.parentMatrixWorld&&(ut.copy(c.parentMatrix),st.copy(c.parentMatrixWorld));const yt=i.clone().multiply(s).multiply(a),wt=new d.yGw;wt.extractRotation(st);const It=new d.yGw;It.copyPosition(st);const Et=It.clone().invert().multiply(st),Ct=wt.clone().invert().multiply(Et),xt=h,Bt=new d.yGw;if(gt===0)Bt.copy(wt).multiply(yt).multiply(Ct).multiply(xt);else if(gt===1)Bt.copy(wt).multiply(Ct).multiply(yt).multiply(xt);else{const wn=new d.yGw().scale(new d.Pa4().setFromMatrixScale(ut)).clone().invert(),Cn=Ct.clone().multiply(wn);Bt.copy(wt).multiply(yt).multiply(Cn).multiply(xt)}const Lt=rt.clone().invert(),Gt=g.clone().invert();let Xt=e.clone().multiply(nt).multiply(rt).multiply(i).multiply(s).multiply(a).multiply(Lt).multiply($).multiply(g).multiply(h).multiply(Gt);const rn=new d.yGw().copyPosition(Xt),fn=st.clone().multiply(rn);return mt.copyPosition(fn),Xt=mt.clone().multiply(Bt),Xt.premultiply(st.invert()),Xt}function Ls(c){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(c=c||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[c]}function mo(c){return c.split(",").map(function(e){return parseFloat(e)})}function Xl(c,e,i){return e===void 0&&(e=0),i===void 0&&(i=c.byteLength),d.Zp0.decodeText(new Uint8Array(c,e,i))}function ko(c,e,i){return c.slice(0,e).concat(i).concat(c.slice(e))}class ao extends _e{constructor(){super(...arguments),this.dependencies=[Jr],this._importer=new Ul(mI,["fbx"],!0)}async onAdded(e){oo.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){oo.Importers.splice(oo.Importers.indexOf(this._importer),1)}}ao.PluginType="FBXLoadPlugin";const Eu=new WeakMap;class Hx extends d.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,a){const h=new d.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),this.url=e,h.load(e,g=>{if(Eu.has(g))return Eu.get(g).promise.then(i).catch(a);this.decodeObjects(g,e).then($=>{$.userData.warnings=this.warnings,i($)}).catch($=>a($))},s,a)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,a;const h=e.byteLength,g=this._getWorker(h).then($=>(s=$,a=this.workerNextTaskID++,new Promise((nt,rt)=>{s._callbacks[a]={resolve:nt,reject:rt},s.postMessage({type:"decode",id:a,buffer:e},[e])}))).then($=>this._createGeometry($.data)).catch($=>{throw $});return g.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),Eu.set(e,{url:i,promise:g}),g}parse(e,i,s){this.decodeObjects(e,"").then(a=>{a.userData.warnings=this.warnings,i(a)}).catch(a=>s(a))}_compareMaterials(e){const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;for(let s=0;s<this.materials.length;s++){const a=this.materials[s],h={};if(h.name=a.name,h.color={},h.color.r=a.color.r,h.color.g=a.color.g,h.color.b=a.color.b,h.type=a.type,JSON.stringify(i)===JSON.stringify(h))return a}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new d.Wid({color:new d.Ilk(1,1,1),metalness:.8,name:"default",side:2});const i=e.diffuseColor,s=new d.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const a=new d.Wid({color:s,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),h=new d.dpR;for(let g=0;g<e.textures.length;g++){const $=e.textures[g];if($.image!==null){const nt=h.load($.image);switch($.type){case"Diffuse":a.map=nt;break;case"Bump":a.bumpMap=nt;break;case"Transparency":a.alphaMap=nt,a.transparent=!0;break;case"Emap":a.envMap=nt}nt.wrapS=$.wrapU===0?d.rpg:d.uWy,nt.wrapT=$.wrapV===0?d.rpg:d.uWy,nt.repeat.set($.repeat[0],$.repeat[1])}}return a}_createGeometry(e){const i=new d.Tme,s=[],a=[],h=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let g=e.objects;const $=e.materials;for(let nt=0;nt<g.length;nt++){const rt=g[nt],st=rt.attributes;switch(rt.objectType){case"InstanceDefinition":a.push(rt);break;case"InstanceReference":h.push(rt);break;default:let ut;if(st.materialIndex>=0){const gt=$[st.materialIndex];let yt=this._createMaterial(gt);yt=this._compareMaterials(yt),ut=this._createObject(rt,yt)}else{const gt=this._createMaterial();ut=this._createObject(rt,gt)}if(ut===void 0)continue;const mt=e.layers[st.layerIndex];ut.visible=!mt||e.layers[st.layerIndex].visible,st.isInstanceDefinitionObject?s.push(ut):i.add(ut)}}for(let nt=0;nt<a.length;nt++){const rt=a[nt];g=[];for(let st=0;st<rt.attributes.objectIds.length;st++){const ut=rt.attributes.objectIds[st];for(let mt=0;mt<s.length;mt++)ut===s[mt].userData.attributes.id&&g.push(s[mt])}for(let st=0;st<h.length;st++){const ut=h[st];if(ut.geometry.parentIdefId===rt.attributes.id){const mt=new d.Tme,gt=ut.geometry.xform.array,yt=new d.yGw;yt.set(gt[0],gt[1],gt[2],gt[3],gt[4],gt[5],gt[6],gt[7],gt[8],gt[9],gt[10],gt[11],gt[12],gt[13],gt[14],gt[15]),mt.applyMatrix4(yt);for(let wt=0;wt<g.length;wt++)mt.add(g[wt].clone(!0));i.add(mt)}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new d.s4_,a=e.attributes;let h,g,$,nt;switch(e.objectType){case"Point":case"PointSet":h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")?g=new d.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):($=a.drawColor,nt=new d.Ilk($.r/255,$.g/255,$.b/255),g=new d.UY4({color:nt,sizeAttenuation:!1,size:2})),g=this._compareMaterials(g);const rt=new d.woe(h,g);return rt.userData.attributes=a,rt.userData.objectType=e.objectType,a.name&&(rt.name=a.name),rt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const st=new d.Kj0(h,i);return st.castShadow=a.castsShadows,st.receiveShadow=a.receivesShadows,st.userData.attributes=a,st.userData.objectType=e.objectType,a.name&&(st.name=a.name),st;case"Curve":h=s.parse(e.geometry),$=a.drawColor,nt=new d.Ilk($.r/255,$.g/255,$.b/255),g=new d.nls({color:nt}),g=this._compareMaterials(g);const ut=new d.x12(h,g);return ut.userData.attributes=a,ut.userData.objectType=e.objectType,a.name&&(ut.name=a.name),ut;case"TextDot":h=e.geometry;const mt=document.createElement("canvas").getContext("2d"),gt=`${h.fontHeight}px ${h.fontFace}`;mt.font=gt;const yt=mt.measureText(h.text).width+10,wt=h.fontHeight+10,It=window.devicePixelRatio;mt.canvas.width=yt*It,mt.canvas.height=wt*It,mt.canvas.style.width=yt+"px",mt.canvas.style.height=wt+"px",mt.setTransform(It,0,0,It,0,0),mt.font=gt,mt.textBaseline="middle",mt.textAlign="center",nt=a.drawColor,mt.fillStyle=`rgba(${nt.r},${nt.g},${nt.b},${nt.a})`,mt.fillRect(0,0,yt,wt),mt.fillStyle="white",mt.fillText(h.text,yt/2,wt/2);const Et=new d.ROQ(mt.canvas);Et.minFilter=d.wem,Et.wrapS=d.uWy,Et.wrapT=d.uWy,g=new d.xeV({map:Et,depthTest:!1});const Ct=new d.jyi(g);return Ct.position.set(h.point[0],h.point[1],h.point[2]),Ct.scale.set(yt/10,wt/10,1),Ct.userData.attributes=a,Ct.userData.objectType=e.objectType,a.name&&(Ct.name=a.name),Ct;case"Light":let xt;switch(h=e.geometry,h.lightStyle.name){case"LightStyle_WorldPoint":xt=new d.cek,xt.castShadow=a.castsShadows,xt.position.set(h.location[0],h.location[1],h.location[2]),xt.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":xt=new d.PMe,xt.castShadow=a.castsShadows,xt.position.set(h.location[0],h.location[1],h.location[2]),xt.target.position.set(h.direction[0],h.direction[1],h.direction[2]),xt.angle=h.spotAngleRadians,xt.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":xt=new d.T_f;const Bt=Math.abs(h.width[2]),Lt=Math.abs(h.length[0]);xt.position.set(h.location[0]-Lt/2,h.location[1],h.location[2]-Bt/2),xt.height=Lt,xt.width=Bt,xt.lookAt(new d.Pa4(h.direction[0],h.direction[1],h.direction[2]));break;case"LightStyle_WorldDirectional":xt=new d.Ox3,xt.castShadow=a.castsShadows,xt.position.set(h.location[0],h.location[1],h.location[2]),xt.target.position.set(h.direction[0],h.direction[1],h.direction[2]),xt.shadow.normalBias=.1}return xt&&(xt.intensity=h.intensity,$=h.diffuse,nt=new d.Ilk($.r/255,$.g/255,$.b/255),xt.color=nt,xt.userData.attributes=a,xt.userData.objectType=e.objectType),xt}}_initLibrary(){if(!this.libraryPending){const e=new d.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((h,g)=>{e.load("rhino3dm.js",h,void 0,g)}),s=new d.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const a=new Promise((h,g)=>{s.load("rhino3dm.wasm",h,void 0,g)});this.libraryPending=Promise.all([i,a]).then(([h,g])=>{this.libraryConfig.wasmBinary=g;const $=_g.toString(),nt=["/* rhino3dm.js */",h,"/* worker */",$.substring($.indexOf("{")+1,$.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([nt]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=a=>{const h=a.data;switch(h.type){case"warning":this.warnings.push(h.data),console.warn(h.data);break;case"decode":s._callbacks[h.id].resolve(h);break;case"error":s._callbacks[h.id].reject(h);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function _g(){let c,e,i,s;function a($,nt){const rt=$.geometry(),st=$.attributes();let ut,mt,gt,yt,wt,It=rt.objectType;switch(It){case i.ObjectType.Curve:const Et=g(rt,100);gt={},mt={},yt={},gt.itemSize=3,gt.type="Float32Array",gt.array=[];for(let Gt=0;Gt<Et.length;Gt++)gt.array.push(Et[Gt][0]),gt.array.push(Et[Gt][1]),gt.array.push(Et[Gt][2]);mt.position=gt,yt.attributes=mt,ut={data:yt};break;case i.ObjectType.Point:const Ct=rt.location;gt={};const xt={};mt={},yt={},gt.itemSize=3,gt.type="Float32Array",gt.array=[Ct[0],Ct[1],Ct[2]];const Bt=st.drawColor(nt);xt.itemSize=3,xt.type="Float32Array",xt.array=[Bt.r/255,Bt.g/255,Bt.b/255],mt.position=gt,mt.color=xt,yt.attributes=mt,ut={data:yt};break;case i.ObjectType.PointSet:case i.ObjectType.Mesh:ut=rt.toThreejsJSON();break;case i.ObjectType.Brep:const Lt=rt.faces();wt=new i.Mesh;for(let Gt=0;Gt<Lt.count;Gt++){const Xt=Lt.get(Gt),rn=Xt.getMesh(i.MeshType.Any);rn&&(wt.append(rn),rn.delete()),Xt.delete()}wt.faces().count>0&&(wt.compact(),ut=wt.toThreejsJSON(),Lt.delete()),wt.delete();break;case i.ObjectType.Extrusion:wt=rt.getMesh(i.MeshType.Any),wt&&(ut=wt.toThreejsJSON(),wt.delete());break;case i.ObjectType.TextDot:ut=h(rt);break;case i.ObjectType.Light:ut=h(rt),ut.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: No conversion exists for ${It.constructor.name} ${ut.lightStyle.name}`,type:"no conversion",guid:st.id}});break;case i.ObjectType.InstanceReference:ut=h(rt),ut.xform=h(rt.xform),ut.xform.array=rt.xform.toFloatArray(!0);break;case i.ObjectType.SubD:rt.subdivide(3),wt=i.Mesh.createFromSubDControlNet(rt),wt&&(ut=wt.toThreejsJSON(),wt.delete());break;default:self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Conversion not implemented for ${It.constructor.name}`,type:"not implemented",guid:st.id}})}if(ut)return mt=h(st),mt.geometry=h(rt),st.groupCount>0&&(mt.groupIds=st.getGroupList()),st.userStringCount>0&&(mt.userStrings=st.getUserStrings()),rt.userStringCount>0&&(mt.geometry.userStrings=rt.getUserStrings()),mt.drawColor=st.drawColor(nt),It=It.constructor.name,It=It.substring(11,It.length),{geometry:ut,attributes:mt,objectType:It};self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: ${It.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:st.id}})}function h($){const nt={};for(const rt in $){const st=$[rt];typeof st!="function"&&(typeof st=="object"&&st!==null&&st.hasOwnProperty("constructor")?nt[rt]={name:st.constructor.name,value:st.value}:nt[rt]=st)}return nt}function g($,nt){let rt=nt,st=[];const ut=[];if($ instanceof i.LineCurve)return[$.pointAtStart,$.pointAtEnd];if($ instanceof i.PolylineCurve){rt=$.pointCount;for(let yt=0;yt<rt;yt++)st.push($.point(yt));return st}if($ instanceof i.PolyCurve){const yt=$.segmentCount;for(let wt=0;wt<yt;wt++){const It=$.segmentCurve(wt),Et=g(It,rt);st=st.concat(Et),It.delete()}return st}if($ instanceof i.ArcCurve&&(rt=Math.floor($.angleDegrees/5),rt=rt<2?2:rt),$ instanceof i.NurbsCurve&&$.degree===1){const yt=$.tryGetPolyline();for(let wt=0;wt<yt.count;wt++)st.push(yt.get(wt));return yt.delete(),st}const mt=$.domain,gt=rt-1;for(let yt=0;yt<rt;yt++){const wt=mt[0]+yt/gt*(mt[1]-mt[0]);if(wt===mt[0]||wt===mt[1]){ut.push(wt);continue}const It=$.tangentAt(wt),Et=$.tangentAt(ut.slice(-1)[0]),Ct=It[0]*It[0]+It[1]*It[1]+It[2]*It[2],xt=Et[0]*Et[0]+Et[1]*Et[1]+Et[2]*Et[2],Bt=Math.sqrt(Ct*xt);let Lt;if(Bt===0)Lt=Math.PI/2;else{const Gt=(It.x*Et.x+It.y*Et.y+It.z*Et.z)/Bt;Lt=Math.acos(Math.max(-1,Math.min(1,Gt)))}Lt<.1||ut.push(wt)}return st=ut.map(yt=>$.pointAt(yt)),st}onmessage=function($){const nt=$.data;switch(nt.type){case"init":e=nt.libraryConfig;const rt=e.wasmBinary;let st;c=new Promise(function(mt){st={wasmBinary:rt,onRuntimeInitialized:mt},rhino3dm(st)}).then(()=>{i=st});break;case"decode":s=nt.id;const ut=nt.buffer;c.then(()=>{try{const mt=function(gt,yt){const wt=new Uint8Array(yt),It=gt.File3dm.fromByteArray(wt),Et=[],Ct=[],xt=[],Bt=[],Lt=[],Gt=[],Xt=[],rn=It.objects(),fn=rn.count;for(let En=0;En<fn;En++){const Tn=rn.get(En),Un=a(Tn,It);Tn.delete(),Un&&Et.push(Un)}for(let En=0;En<It.instanceDefinitions().count();En++){const Tn=It.instanceDefinitions().get(En),Un=h(Tn);Un.objectIds=Tn.getObjectIds(),Et.push({geometry:null,attributes:Un,objectType:"InstanceDefinition"})}const wn=[gt.TextureType.Diffuse,gt.TextureType.Bump,gt.TextureType.Transparency,gt.TextureType.Opacity,gt.TextureType.Emap],Cn=[gt.TextureType.PBR_BaseColor,gt.TextureType.PBR_Subsurface,gt.TextureType.PBR_SubsurfaceScattering,gt.TextureType.PBR_SubsurfaceScatteringRadius,gt.TextureType.PBR_Metallic,gt.TextureType.PBR_Specular,gt.TextureType.PBR_SpecularTint,gt.TextureType.PBR_Roughness,gt.TextureType.PBR_Anisotropic,gt.TextureType.PBR_Anisotropic_Rotation,gt.TextureType.PBR_Sheen,gt.TextureType.PBR_SheenTint,gt.TextureType.PBR_Clearcoat,gt.TextureType.PBR_ClearcoatBump,gt.TextureType.PBR_ClearcoatRoughness,gt.TextureType.PBR_OpacityIor,gt.TextureType.PBR_OpacityRoughness,gt.TextureType.PBR_Emission,gt.TextureType.PBR_AmbientOcclusion,gt.TextureType.PBR_Displacement];for(let En=0;En<It.materials().count();En++){const Tn=It.materials().get(En),Un=Tn.physicallyBased();let Pn=h(Tn);const Yn=[];for(let cr=0;cr<wn.length;cr++){const mr=Tn.getTexture(wn[cr]);if(mr){let ir=wn[cr].constructor.name;ir=ir.substring(12,ir.length);const Dr={type:ir},Nr=It.getEmbeddedFileAsBase64(mr.fileName);Dr.wrapU=mr.wrapU,Dr.wrapV=mr.wrapV,Dr.wrapW=mr.wrapW;const Fr=mr.uvwTransform.toFloatArray(!0);Dr.repeat=[Fr[0],Fr[5]],Nr?Dr.image="data:image/png;base64,"+Nr:(self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Image for ${ir} texture not embedded in file.`,type:"missing resource"}}),Dr.image=null),Yn.push(Dr),mr.delete()}}if(Pn.textures=Yn,Un.supported){for(let mr=0;mr<Cn.length;mr++){const ir=Tn.getTexture(Cn[mr]);if(ir){const Dr=It.getEmbeddedFileAsBase64(ir.fileName);let Nr=Cn[mr].constructor.name;Nr=Nr.substring(12,Nr.length);const Fr={type:Nr,image:"data:image/png;base64,"+Dr};Yn.push(Fr),ir.delete()}}const cr=h(Tn.physicallyBased());Pn=Object.assign(cr,Pn)}Ct.push(Pn),Tn.delete(),Un.delete()}for(let En=0;En<It.layers().count();En++){const Tn=It.layers().get(En),Un=h(Tn);xt.push(Un),Tn.delete()}for(let En=0;En<It.views().count();En++){const Tn=It.views().get(En),Un=h(Tn);Bt.push(Un),Tn.delete()}for(let En=0;En<It.namedViews().count();En++){const Tn=It.namedViews().get(En),Un=h(Tn);Lt.push(Un),Tn.delete()}for(let En=0;En<It.groups().count();En++){const Tn=It.groups().get(En),Un=h(Tn);Gt.push(Un),Tn.delete()}const bn=h(It.settings()),Dn=It.strings().count();for(let En=0;En<Dn;En++)Xt.push(It.strings().get(En));return It.delete(),{objects:Et,materials:Ct,layers:xt,views:Bt,namedViews:Lt,groups:Gt,strings:Xt,settings:bn}}(i,ut);self.postMessage({type:"decode",id:nt.id,data:mt})}catch(mt){self.postMessage({type:"error",id:nt.id,error:mt})}})}}}class GE extends Hx{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.11.1/")}async loadAsync(e,i){return await super.loadAsync(e,i)}}class d_ extends _e{constructor(){super(...arguments),this.dependencies=[Jr],this._importer=new Ul(GE,["3dm"],!0)}async onAdded(e){oo.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){oo.Importers.splice(oo.Importers.indexOf(this._importer),1)}}d_.PluginType="Rhino3dmLoadPlugin";class KC extends _e{constructor(){super(...arguments),this.dependencies=[Jr]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}KC.PluginType="GLTFMeshOptPlugin";class HE extends d.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,g=new d.hH6(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function($){try{i(h.parse($))}catch(nt){a?a(nt):console.error(nt),h.manager.itemError(e)}},s,a)}parse(e){function i(h,g,$){for(let nt=0,rt=h.length;nt<rt;nt++)if(h[nt]!==g.getUint8($+nt))return!1;return!0}const s=function(h){if(typeof h=="string"){const g=new Uint8Array(h.length);for(let $=0;$<h.length;$++)g[$]=255&h.charCodeAt($);return g.buffer||g}return h}(e);return function(h){const g=new DataView(h);if(84+50*g.getUint32(80,!0)===g.byteLength)return!0;const $=[115,111,108,105,100];for(let nt=0;nt<5;nt++)if(i($,g,nt))return!1;return!0}(s)?function(h){const g=new DataView(h),$=g.getUint32(80,!0);let nt,rt,st,ut,mt,gt,yt,wt,It=!1;for(let Bt=0;Bt<70;Bt++)g.getUint32(Bt,!1)==1129270351&&g.getUint8(Bt+4)==82&&g.getUint8(Bt+5)==61&&(It=!0,ut=new Float32Array(3*$*3),mt=g.getUint8(Bt+6)/255,gt=g.getUint8(Bt+7)/255,yt=g.getUint8(Bt+8)/255,wt=g.getUint8(Bt+9)/255);const Et=new d.u9r,Ct=new Float32Array(3*$*3),xt=new Float32Array(3*$*3);for(let Bt=0;Bt<$;Bt++){const Lt=84+50*Bt,Gt=g.getFloat32(Lt,!0),Xt=g.getFloat32(Lt+4,!0),rn=g.getFloat32(Lt+8,!0);if(It){const fn=g.getUint16(Lt+48,!0);32768&fn?(nt=mt,rt=gt,st=yt):(nt=(31&fn)/31,rt=(fn>>5&31)/31,st=(fn>>10&31)/31)}for(let fn=1;fn<=3;fn++){const wn=Lt+12*fn,Cn=3*Bt*3+3*(fn-1);Ct[Cn]=g.getFloat32(wn,!0),Ct[Cn+1]=g.getFloat32(wn+4,!0),Ct[Cn+2]=g.getFloat32(wn+8,!0),xt[Cn]=Gt,xt[Cn+1]=Xt,xt[Cn+2]=rn,It&&(ut[Cn]=nt,ut[Cn+1]=rt,ut[Cn+2]=st)}}return Et.setAttribute("position",new d.TlE(Ct,3)),Et.setAttribute("normal",new d.TlE(xt,3)),It&&(Et.setAttribute("color",new d.TlE(ut,3)),Et.hasColors=!0,Et.alpha=wt),Et}(s):function(h){const g=new d.u9r,$=/solid([\s\S]*?)endsolid/g,nt=/facet([\s\S]*?)endfacet/g;let rt=0;const st=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,ut=new RegExp("vertex"+st+st+st,"g"),mt=new RegExp("normal"+st+st+st,"g"),gt=[],yt=[],wt=new d.Pa4;let It,Et=0,Ct=0,xt=0;for(;(It=$.exec(h))!==null;){Ct=xt;const Bt=It[0];for(;(It=nt.exec(Bt))!==null;){let Xt=0,rn=0;const fn=It[0];for(;(It=mt.exec(fn))!==null;)wt.x=parseFloat(It[1]),wt.y=parseFloat(It[2]),wt.z=parseFloat(It[3]),rn++;for(;(It=ut.exec(fn))!==null;)gt.push(parseFloat(It[1]),parseFloat(It[2]),parseFloat(It[3])),yt.push(wt.x,wt.y,wt.z),Xt++,xt++;rn!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+rt),Xt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+rt),rt++}const Lt=Ct,Gt=xt-Ct;g.addGroup(Lt,Gt,Et),Et++}return g.setAttribute("position",new d.a$l(gt,3)),g.setAttribute("normal",new d.a$l(yt,3)),g}(typeof(a=e)!="string"?d.Zp0.decodeText(new Uint8Array(a)):a);var a}}class $C extends _e{constructor(){super(...arguments),this.dependencies=[Jr]}async onAdded(e){this._importer||(this._importer=new Ul(HE,["stl"],!0)),oo.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&oo.Importers.splice(oo.Importers.indexOf(this._importer),1),this._importer=void 0}}$C.PluginType="STLLoadPlugin";class Wx extends d.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,g=this.path===""?d.Zp0.extractUrlBase(e):this.path,$=new d.hH6(this.manager);$.setPath(this.path),$.setRequestHeader(this.requestHeader),$.setWithCredentials(this.withCredentials),$.load(e,function(nt){try{i(h.parse(nt,g))}catch(rt){a?a(rt):console.error(rt),h.manager.itemError(e)}},s,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let a={};const h=/\s+/,g={};for(let nt=0;nt<s.length;nt++){let rt=s[nt];if(rt=rt.trim(),rt.length===0||rt.charAt(0)==="#")continue;const st=rt.indexOf(" ");let ut=st>=0?rt.substring(0,st):rt;ut=ut.toLowerCase();let mt=st>=0?rt.substring(st+1):"";if(mt=mt.trim(),ut==="newmtl")a={name:mt},g[mt]=a;else if(ut==="ka"||ut==="kd"||ut==="ks"||ut==="ke"){const gt=mt.split(h,3);a[ut]=[parseFloat(gt[0]),parseFloat(gt[1]),parseFloat(gt[2])]}else a[ut]=mt}const $=new hp(this.resourcePath||i,this.materialOptions);return $.setCrossOrigin(this.crossOrigin),$.setManager(this.manager),$.setMaterials(g),$}}class hp{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:d.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:d.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const a=e[s],h={};i[s]=h;for(const g in a){let $=!0,nt=a[g];const rt=g.toLowerCase();switch(rt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(nt=[nt[0]/255,nt[1]/255,nt[2]/255]),this.options&&this.options.ignoreZeroRGBs&&nt[0]===0&&nt[1]===0&&nt[2]===0&&($=!1)}$&&(h[rt]=nt)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],a={name:e,side:this.side};async function h(nt,rt){if(a[nt])return;const st=i.getTextureParams(rt,a);return new Promise((ut,mt)=>{let gt=!1,yt=()=>!gt&&(gt=!0)&&ut();const wt=i.loadTexture((It=i.baseUrl,typeof(Et=st.url)!="string"||Et===""?"":/^https?:\/\//i.test(Et)?Et:It+Et),void 0,Ct=>{a[nt]=Ct,yt()},void 0,yt);var It,Et;setTimeout(yt,50),wt.repeat.copy(st.scale),wt.offset.copy(st.offset),wt.wrapS=i.wrap,wt.wrapT=i.wrap})}const g=Array.from(Object.keys(s||{}));let $=g.includes("d")||g.includes("D");for(const nt of g){const rt=s[nt];let st;if(rt!=="")switch(nt.toLowerCase()){case"kd":a.color=new d.Ilk().fromArray(rt);break;case"ks":a.specular=new d.Ilk().fromArray(rt);break;case"ke":a.emissive=new d.Ilk().fromArray(rt);break;case"map_kd":await h("map",rt);break;case"map_ks":await h("specularMap",rt);break;case"map_ke":await h("emissiveMap",rt);break;case"norm":await h("normalMap",rt);break;case"map_bump":case"bump":await h("bumpMap",rt);break;case"map_d":await h("alphaMap",rt),a.transparent=!0;break;case"ns":a.shininess=parseFloat(rt);break;case"d":st=parseFloat(rt),st<1&&(a.opacity=st,a.transparent=!0);break;case"tr":if($)break;st=parseFloat(rt),this.options&&this.options.invertTrProperty&&(st=1-st),st>0&&(a.opacity=1-st,a.transparent=!0)}}return this.materials[e]=new d.xoR(a),this.materials[e]}getTextureParams(e,i){const s={scale:new d.FM8(1,1),offset:new d.FM8(0,0)},a=e.split(/\s+/);let h;return h=a.indexOf("-bm"),h>=0&&(i.bumpScale=parseFloat(a[h+1]),a.splice(h,2)),h=a.indexOf("-s"),h>=0&&(s.scale.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),h=a.indexOf("-o"),h>=0&&(s.offset.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),s.url=a.join(" ").trim(),s}loadTexture(e,i,s,a,h){const g=this.manager!==void 0?this.manager:d.tEQ;let $=g.getHandler(e);$===null&&($=new d.dpR(g)),$.setCrossOrigin&&$.setCrossOrigin(this.crossOrigin);const nt=$.load(e,s,a,h);return i!==void 0&&(nt.mapping=i),nt}}const qx=/^[og]\s*(.+)?/,Rv=/^mtllib /,Hs=/^usemtl /,tp=/^usemap /,WE=new d.Pa4,JC=new d.Pa4,_I=new d.Pa4,Yx=new d.Pa4,ev=new d.Pa4;function EP(){const c={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,h){const g=this._finalize(!1);g&&(g.inherited||g.groupCount<=0)&&this.materials.splice(g.index,1);const $={index:this.materials.length,name:a||"",mtllib:Array.isArray(h)&&h.length>0?h[h.length-1]:"",smooth:g!==void 0?g.smooth:this.smooth,groupStart:g!==void 0?g.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(nt){const rt={index:typeof nt=="number"?nt:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return rt.clone=this.clone.bind(rt),rt}};return this.materials.push($),$},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const h=this.currentMaterial();if(h&&h.groupEnd===-1&&(h.groupEnd=this.geometry.vertices.length/3,h.groupCount=h.groupEnd-h.groupStart,h.inherited=!1),a&&this.materials.length>1)for(let g=this.materials.length-1;g>=0;g--)this.materials[g].groupCount<=0&&this.materials.splice(g,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),h}},s&&s.name&&typeof s.clone=="function"){const a=s.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const a=this.vertices,h=this.object.geometry.vertices;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const a=this.normals,h=this.object.geometry.normals;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addFaceNormal:function(e,i,s){const a=this.vertices,h=this.object.geometry.normals;WE.fromArray(a,e),JC.fromArray(a,i),_I.fromArray(a,s),ev.subVectors(_I,JC),Yx.subVectors(WE,JC),ev.cross(Yx),ev.normalize(),h.push(ev.x,ev.y,ev.z),h.push(ev.x,ev.y,ev.z),h.push(ev.x,ev.y,ev.z)},addColor:function(e,i,s){const a=this.colors,h=this.object.geometry.colors;a[e]!==void 0&&h.push(a[e+0],a[e+1],a[e+2]),a[i]!==void 0&&h.push(a[i+0],a[i+1],a[i+2]),a[s]!==void 0&&h.push(a[s+0],a[s+1],a[s+2])},addUV:function(e,i,s){const a=this.uvs,h=this.object.geometry.uvs;h.push(a[e+0],a[e+1]),h.push(a[i+0],a[i+1]),h.push(a[s+0],a[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,a,h,g,$,nt,rt){const st=this.vertices.length;let ut=this.parseVertexIndex(e,st),mt=this.parseVertexIndex(i,st),gt=this.parseVertexIndex(s,st);if(this.addVertex(ut,mt,gt),this.addColor(ut,mt,gt),$!==void 0&&$!==""){const yt=this.normals.length;ut=this.parseNormalIndex($,yt),mt=this.parseNormalIndex(nt,yt),gt=this.parseNormalIndex(rt,yt),this.addNormal(ut,mt,gt)}else this.addFaceNormal(ut,mt,gt);if(a!==void 0&&a!==""){const yt=this.uvs.length;ut=this.parseUVIndex(a,yt),mt=this.parseUVIndex(h,yt),gt=this.parseUVIndex(g,yt),this.addUV(ut,mt,gt),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,a=e.length;s<a;s++){const h=this.parseVertexIndex(e[s],i);this.addVertexPoint(h),this.addColor(h)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,a=this.uvs.length;for(let h=0,g=e.length;h<g;h++)this.addVertexLine(this.parseVertexIndex(e[h],s));for(let h=0,g=i.length;h<g;h++)this.addUVLine(this.parseUVIndex(i[h],a))}};return c.startObject("",!1),c}class yI extends d.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,a){const h=this,g=new d.hH6(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,async function($){try{i(await h.parse($))}catch(nt){a?a(nt):console.error(nt),h.manager.itemError(e)}},s,a)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new EP;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let a="",h="",g=0,$=[];const nt=typeof"".trimLeft=="function";for(let st=0,ut=s.length;st<ut;st++)if(a=s[st],a=nt?a.trimLeft():a.trim(),g=a.length,g!==0&&(h=a.charAt(0),h!=="#"))if(h==="v"){const mt=a.split(/\s+/);switch(mt[0]){case"v":i.vertices.push(parseFloat(mt[1]),parseFloat(mt[2]),parseFloat(mt[3])),mt.length>=7?i.colors.push(parseFloat(mt[4]),parseFloat(mt[5]),parseFloat(mt[6])):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(mt[1]),parseFloat(mt[2]),parseFloat(mt[3]));break;case"vt":i.uvs.push(parseFloat(mt[1]),parseFloat(mt[2]))}}else if(h==="f"){const mt=a.substr(1).trim().split(/\s+/),gt=[];for(let wt=0,It=mt.length;wt<It;wt++){const Et=mt[wt];if(Et.length>0){const Ct=Et.split("/");gt.push(Ct)}}const yt=gt[0];for(let wt=1,It=gt.length-1;wt<It;wt++){const Et=gt[wt],Ct=gt[wt+1];i.addFace(yt[0],Et[0],Ct[0],yt[1],Et[1],Ct[1],yt[2],Et[2],Ct[2])}}else if(h==="l"){const mt=a.substring(1).trim().split(" ");let gt=[];const yt=[];if(a.indexOf("/")===-1)gt=mt;else for(let wt=0,It=mt.length;wt<It;wt++){const Et=mt[wt].split("/");Et[0]!==""&&gt.push(Et[0]),Et[1]!==""&&yt.push(Et[1])}i.addLineGeometry(gt,yt)}else if(h==="p"){const mt=a.substr(1).trim().split(" ");i.addPointGeometry(mt)}else if(($=qx.exec(a))!==null){const mt=(" "+$[0].substr(1).trim()).substr(1);i.startObject(mt)}else if(Hs.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(Rv.test(a)){i.materialLibraries.push(a.substring(7).trim());const mt=a.substring(7).trim(),gt=this.manager.getHandler(mt);if(gt){const yt=await gt.loadAsync(mt).catch(wt=>{console.warn(wt)});yt&&this.setMaterials(yt)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(tp.test(a))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if($=a.split(" "),$.length>1){const gt=$[1].trim().toLowerCase();i.object.smooth=gt!=="0"&&gt!=="off"}else i.object.smooth=!0;const mt=i.object.currentMaterial();mt&&(mt.smooth=i.object.smooth)}else{if(a==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}i.finalize();const rt=new d.ZAu;if(rt.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let st=0,ut=i.objects.length;st<ut;st++){const mt=i.objects[st],gt=mt.geometry,yt=mt.materials,wt=gt.type==="Line",It=gt.type==="Points";let Et=!1;if(gt.vertices.length===0)continue;const Ct=new d.u9r;Ct.setAttribute("position",new d.a$l(gt.vertices,3)),gt.normals.length>0&&Ct.setAttribute("normal",new d.a$l(gt.normals,3)),gt.colors.length>0&&(Et=!0,Ct.setAttribute("color",new d.a$l(gt.colors,3))),gt.hasUVIndices===!0&&Ct.setAttribute("uv",new d.a$l(gt.uvs,2));const xt=[];for(let Lt=0,Gt=yt.length;Lt<Gt;Lt++){const Xt=yt[Lt],rn=Xt.name+"_"+Xt.smooth+"_"+Et;let fn=i.materials[rn];if(this.materials!==null)if(fn=await this.materials.create(Xt.name),!wt||!fn||fn instanceof d.nls){if(It&&fn&&!(fn instanceof d.UY4)){const wn=new d.UY4({size:10,sizeAttenuation:!1});d.F5T.prototype.copy.call(wn,fn),wn.color.copy(fn.color),wn.map=fn.map,fn=wn}}else{const wn=new d.nls;d.F5T.prototype.copy.call(wn,fn),wn.color.copy(fn.color),fn=wn}fn===void 0&&(fn=wt?new d.nls:It?new d.UY4({size:1,sizeAttenuation:!1}):new d.xoR,fn.name=Xt.name,fn.flatShading=!Xt.smooth,fn.vertexColors=Et,i.materials[rn]=fn),xt.push(fn)}let Bt;if(xt.length>1){for(let Lt=0,Gt=yt.length;Lt<Gt;Lt++){const Xt=yt[Lt];Ct.addGroup(Xt.groupStart,Xt.groupCount,Lt)}Bt=wt?new d.ejS(Ct,xt):It?new d.woe(Ct,xt):new d.Kj0(Ct,xt)}else Bt=wt?new d.ejS(Ct,xt[0]):It?new d.woe(Ct,xt[0]):new d.Kj0(Ct,xt[0]);Bt.name=mt.name,rt.add(Bt)}else if(i.vertices.length>0){const st=new d.UY4({size:1,sizeAttenuation:!1}),ut=new d.u9r;ut.setAttribute("position",new d.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(ut.setAttribute("color",new d.a$l(i.colors,3)),st.vertexColors=!0);const mt=new d.woe(ut,st);rt.add(mt)}return rt}}class ZC extends _e{constructor(){super(...arguments),this.dependencies=[Jr],this._importer1=new Ul(yI,["obj"],!0),this._importer2=new Ul(Wx,["mtl"],!1)}async onAdded(e){oo.Importers.push(this._importer1),oo.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){oo.Importers.splice(oo.Importers.indexOf(this._importer1),1),oo.Importers.splice(oo.Importers.indexOf(this._importer2),1)}}ZC.PluginType="ObjMtlLoadPlugin";class SP extends d.DqL{constructor(e){super(e)}parse(e,i){const s=new CP(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class CP{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const a=Uint32Array.BYTES_PER_ELEMENT,h=new DataView(this.arrayBuffer,12,13*a),g=h.getUint32(0,!0)===67305985;this.glType=h.getUint32(1*a,g),this.glTypeSize=h.getUint32(2*a,g),this.glFormat=h.getUint32(3*a,g),this.glInternalFormat=h.getUint32(4*a,g),this.glBaseInternalFormat=h.getUint32(5*a,g),this.pixelWidth=h.getUint32(6*a,g),this.pixelHeight=h.getUint32(7*a,g),this.pixelDepth=h.getUint32(8*a,g),this.numberOfArrayElements=h.getUint32(9*a,g),this.numberOfFaces=h.getUint32(10*a,g),this.numberOfMipmapLevels=h.getUint32(11*a,g),this.bytesOfKeyValueData=h.getUint32(12*a,g),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,a=this.pixelWidth,h=this.pixelHeight;const g=e?this.numberOfMipmapLevels:1;for(let $=0;$<g;$++){const nt=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let rt=0;rt<this.numberOfFaces;rt++){const st=new Uint8Array(this.arrayBuffer,s,nt);i.push({data:st,width:a,height:h}),s+=nt,s+=3-(nt+3)%4}a=Math.max(1,.5*a),h=Math.max(1,.5*h)}return i}}class qE extends _e{constructor(){super(...arguments),this.dependencies=[Jr]}async onAdded(e){this._importer||(this._importer=new Ul(SP,["ktx"],!1)),oo.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&oo.Importers.splice(oo.Importers.indexOf(this._importer),1),this._importer=void 0}}qE.PluginType="KTXLoadPlugin";class MP extends d.hH6{constructor(e){super(e),this.responseType="blob"}}class Sl extends d.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,a){return super.load(e,h=>{try{i==null||i(gu(h))}catch(g){a==null||a(g)}},s,a)}}class AI{async parseAsync(e,i){var s;return new Blob([JSON.stringify(e,null,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"application/json"})}}class p_{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}class f_{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Qp(e)}),this.register(function(e){return new Xx(e)}),this.register(function(e){return new TP(e)}),this.register(function(e){return new JO(e)}),this.register(function(e){return new ZO(e)}),this.register(function(e){return new wI(e)}),this.register(function(e){return new eL(e)}),this.register(function(e){return new $O(e)}),this.register(function(e){return new tL(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a,h){const g=h||new eM,$=[];for(let nt=0,rt=this.pluginCallbacks.length;nt<rt;nt++)$.push(this.pluginCallbacks[nt](g));g.setPlugins($),g.write(e,i,a).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,a,h,i)})}}const YE=5121,rA=5123,Vp={};Vp[d.TyD]=9728,Vp[d.YLQ]=9984,Vp[d.aH4]=9986,Vp[d.wem]=9729,Vp[d.qyh]=9985,Vp[d.D1R]=9987,Vp[d.uWy]=33071,Vp[d.rpg]=10497,Vp[d.OoA]=33648;const dp={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function kv(c,e){return c.length===e.length&&c.every(function(i,s){return i===e[s]})}function XE(c){return 4*Math.ceil(c/4)}function tv(c,e=0){const i=XE(c.byteLength);if(i!==c.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(c)),e!==0)for(let a=c.byteLength;a<i;a++)s[a]=e;return s.buffer}return c}function nv(c,e){if(c.toBlob!==void 0)return new Promise(s=>c.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),c.convertToBlob({type:e,quality:i})}class eM{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const a=this,h=a.buffers,g=a.json;s=a.options;const $=a.extensionsUsed,nt=new Blob(h,{type:"application/octet-stream"}),rt=Object.keys($);if(rt.length>0&&(g.extensionsUsed=rt),g.buffers&&g.buffers.length>0&&(g.buffers[0].byteLength=nt.size),s.binary===!0){const st=new FileReader;st.readAsArrayBuffer(nt),st.onloadend=function(){const ut=tv(st.result),mt=new DataView(new ArrayBuffer(8));mt.setUint32(0,ut.byteLength,!0),mt.setUint32(4,5130562,!0);const gt=tv((yt=JSON.stringify(g),new TextEncoder().encode(yt).buffer),32);var yt;const wt=new DataView(new ArrayBuffer(8));wt.setUint32(0,gt.byteLength,!0),wt.setUint32(4,1313821514,!0);const It=new ArrayBuffer(12),Et=new DataView(It);Et.setUint32(0,1179937895,!0),Et.setUint32(4,2,!0);const Ct=12+wt.byteLength+gt.byteLength+mt.byteLength+ut.byteLength;Et.setUint32(8,Ct,!0);const xt=new Blob([It,wt,gt,mt,ut],{type:"application/octet-stream"}),Bt=new FileReader;Bt.readAsArrayBuffer(xt),Bt.onloadend=function(){i(Bt.result)}}}else if(g.buffers&&g.buffers.length>0){const st=new FileReader;st.readAsDataURL(nt),st.onloadend=function(){const ut=st.result;g.buffers[0].uri=ut,i(g)}}else i(g)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,a=this.extensionsUsed;try{const h=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&h.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const g in h.gltfExtensions)i.extensions[g]=h.gltfExtensions[g],a[g]=!0;delete h.gltfExtensions}Object.keys(h).length>0&&(i.extras=h)}catch(h){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+h.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new d.Pa4;for(let s=0,a=e.count;s<a;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),a=new d.Pa4;for(let h=0,g=s.count;h<g;h++)a.fromBufferAttribute(s,h),a.x===0&&a.y===0&&a.z===0?a.setX(1):a.normalize(),s.setXYZ(h,a.x,a.y,a.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const a={};i.offset.x===0&&i.offset.y===0||(a.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(a.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(a.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(mt){return mt.encoding===d.knz?function(gt){return gt<.04045?.0773993808*gt:Math.pow(.9478672986*gt+.0521327014,2.4)}:function(gt){return gt}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const a=e?e.image:void 0,h=i?i.image:void 0,g=Math.max(a?a.width:0,h?h.width:0),$=Math.max(a?a.height:0,h?h.height:0),nt=document.createElement("canvas");nt.width=g,nt.height=$;const rt=nt.getContext("2d");rt.fillStyle="#00ffff",rt.fillRect(0,0,g,$);const st=rt.getImageData(0,0,g,$);if(a){rt.drawImage(a,0,0,g,$);const mt=s(e),gt=rt.getImageData(0,0,g,$).data;for(let yt=2;yt<gt.length;yt+=4)st.data[yt]=256*mt(gt[yt]/256)}if(h){rt.drawImage(h,0,0,g,$);const mt=s(i),gt=rt.getImageData(0,0,g,$).data;for(let yt=1;yt<gt.length;yt+=4)st.data[yt]=256*mt(gt[yt]/256)}rt.putImageData(st,0,0);const ut=(e||i).clone();return ut.source=new d.Hw6(nt),ut.encoding=d.rnI,ut}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,a,h){const g=this.json;let $;g.bufferViews||(g.bufferViews=[]),$=i===YE?1:i===rA?2:4;const nt=XE(a*e.itemSize*$),rt=new DataView(new ArrayBuffer(nt));let st=0;for(let mt=s;mt<s+a;mt++)for(let gt=0;gt<e.itemSize;gt++){let yt;e.itemSize>4?yt=e.array[mt*e.itemSize+gt]:gt===0?yt=e.getX(mt):gt===1?yt=e.getY(mt):gt===2?yt=e.getZ(mt):gt===3&&(yt=e.getW(mt)),i===5126?rt.setFloat32(st,yt,!0):i===5125?rt.setUint32(st,yt,!0):i===rA?rt.setUint16(st,yt,!0):i===YE&&rt.setUint8(st,yt),st+=$}const ut={buffer:this.processBuffer(rt.buffer),byteOffset:this.byteOffset,byteLength:nt};return h!==void 0&&(ut.target=h),h===34962&&(ut.byteStride=e.itemSize*$),this.byteOffset+=nt,g.bufferViews.push(ut),{id:g.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(a){const h=new FileReader;h.readAsArrayBuffer(e),h.onloadend=function(){const g=tv(h.result),$={buffer:i.processBuffer(g),byteOffset:i.byteOffset,byteLength:g.byteLength};i.byteOffset+=g.byteLength,a(s.bufferViews.push($)-1)}})}processAccessor(e,i,s,a){const h=this.options,g=this.json;let $;if(e.array.constructor===Float32Array)$=5126;else if(e.array.constructor===Uint32Array)$=5125;else if(e.array.constructor===Uint16Array)$=rA;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");$=YE}if(s===void 0&&(s=0),a===void 0&&(a=e.count),h.truncateDrawRange&&i!==void 0&&i.index===null){const mt=s+a,gt=i.drawRange.count===1/0?e.count:i.drawRange.start+i.drawRange.count;s=Math.max(s,i.drawRange.start),a=Math.min(mt,gt)-s,a<0&&(a=0)}if(a===0)return null;const nt=function(mt,gt,yt){const wt={min:new Array(mt.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(mt.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let It=gt;It<gt+yt;It++)for(let Et=0;Et<mt.itemSize;Et++){let Ct;mt.itemSize>4?Ct=mt.array[It*mt.itemSize+Et]:Et===0?Ct=mt.getX(It):Et===1?Ct=mt.getY(It):Et===2?Ct=mt.getZ(It):Et===3&&(Ct=mt.getW(It)),wt.min[Et]=Math.min(wt.min[Et],Ct),wt.max[Et]=Math.max(wt.max[Et],Ct)}return wt}(e,s,a);let rt;i!==void 0&&(rt=e===i.index?34963:34962);const st=this.processBufferView(e,$,s,a,rt),ut={bufferView:st.id,byteOffset:st.byteOffset,componentType:$,count:a,max:nt.max,min:nt.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return g.accessors||(g.accessors=[]),g.accessors.push(ut)-1}processImage(e,i,s,a="image/png"){const h=this,g=h.cache,$=h.json,nt=h.options,rt=h.pending;g.images.has(e)||g.images.set(e,{});const st=g.images.get(e),ut=a+":flipY/"+s.toString();if(st[ut]!==void 0)return st[ut];$.images||($.images=[]);const mt={mimeType:a},gt=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");gt.width=Math.min(e.width,nt.maxTextureSize),gt.height=Math.min(e.height,nt.maxTextureSize);const yt=gt.getContext("2d");if(s===!0&&(yt.translate(0,gt.height),yt.scale(1,-1)),e.data!==void 0){i!==d.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>nt.maxTextureSize||e.height>nt.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const It=new Uint8ClampedArray(e.height*e.width*4);for(let Et=0;Et<It.length;Et+=4)It[Et+0]=e.data[Et+0],It[Et+1]=e.data[Et+1],It[Et+2]=e.data[Et+2],It[Et+3]=e.data[Et+3];yt.putImageData(new ImageData(It,e.width,e.height),0,0)}else yt.drawImage(e,0,0,gt.width,gt.height);nt.binary===!0?rt.push(nv(gt,a).then(It=>h.processBufferViewImage(It)).then(It=>{mt.bufferView=It})):gt.toDataURL!==void 0?mt.uri=gt.toDataURL(a):rt.push(nv(gt,a).then(It=>new FileReader().readAsDataURL(It)).then(It=>{mt.uri=It}));const wt=$.images.push(mt)-1;return st[ut]=wt,wt}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:Vp[e.magFilter],minFilter:Vp[e.minFilter],wrapS:Vp[e.wrapS],wrapT:Vp[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let a=e.userData.mimeType;a==="image/webp"&&(a="image/png"),a==="image/jpg"&&(a="image/jpeg");const h=["image/jpeg","image/png"];a&&!h.includes(a)&&console.error("GLTFExporter: Unsupported mime type: "+a+". Cannot export texture.",e);const g={sampler:this.processSampler(e),source:!a||h.includes(a)?this.processImage(e.image,e.format,e.flipY,a):null};e.name&&(g.name=e.name),this._invokeAll(function(nt){nt.writeTexture&&nt.writeTexture(e,g)});const $=s.textures.push(g)-1;return i.textures.set(e,$),$}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const a={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const h=e.color.toArray().concat([e.opacity]);if(kv(h,[1,1,1,1])||(a.pbrMetallicRoughness.baseColorFactor=h),e.isMeshStandardMaterial?(a.pbrMetallicRoughness.metallicFactor=e.metalness,a.pbrMetallicRoughness.roughnessFactor=e.roughness):(a.pbrMetallicRoughness.metallicFactor=.5,a.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const $=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),nt={index:this.processTexture($)};this.applyTextureTransform(nt,$),a.pbrMetallicRoughness.metallicRoughnessTexture=nt}if(e.map){const $={index:this.processTexture(e.map)};this.applyTextureTransform($,e.map),a.pbrMetallicRoughness.baseColorTexture=$}if(e.emissive){const $=e.emissive.clone().multiplyScalar(e.emissiveIntensity),nt=Math.max($.r,$.g,$.b);if(nt>1&&($.multiplyScalar(1/nt),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),nt>0&&(a.emissiveFactor=$.toArray()),e.emissiveMap){const rt={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(rt,e.emissiveMap),a.emissiveTexture=rt}}if(e.normalMap){const $={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&($.scale=e.normalScale.x),this.applyTextureTransform($,e.normalMap),a.normalTexture=$}if(e.aoMap){const $={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&($.strength=e.aoMapIntensity),this.applyTextureTransform($,e.aoMap),a.occlusionTexture=$}e.transparent?a.alphaMode="BLEND":e.alphaTest>0&&(a.alphaMode="MASK",a.alphaCutoff=e.alphaTest),e.side===d.ehD&&(a.doubleSided=!0),e.name!==""&&(a.name=e.name),this.serializeUserData(e,a),this._invokeAll(function($){$.writeMaterial&&$.writeMaterial(e,a)});const g=s.materials.push(a)-1;return i.materials.set(e,g),g}processMesh(e){const i=this.cache,s=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let xt=0,Bt=e.material.length;xt<Bt;xt++)a.push(e.material[xt].uuid);else a.push(e.material.uuid);const h=a.join(":");if(i.meshes.has(h))return i.meshes.get(h);const g=e.geometry;let $;$=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const nt={},rt={},st=[],ut=[],mt={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},gt=g.getAttribute("normal");gt===void 0||this.isNormalizedNormalAttribute(gt)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),g.setAttribute("normal",this.createNormalizedNormalAttribute(gt)));let yt=null;for(let xt in g.attributes){if(xt.slice(0,5)==="morph")continue;const Bt=g.attributes[xt];if(xt=mt[xt]||xt.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(xt)||(xt="_"+xt),i.attributes.has(this.getUID(Bt))){rt[xt]=i.attributes.get(this.getUID(Bt));continue}yt=null;const Lt=Bt.array;xt!=="JOINTS_0"||Lt instanceof Uint16Array||Lt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),yt=new d.TlE(new Uint16Array(Lt),Bt.itemSize,Bt.normalized));const Gt=this.processAccessor(yt||Bt,g);Gt!==null&&(rt[xt]=Gt,i.attributes.set(this.getUID(Bt),Gt))}if(gt!==void 0&&g.setAttribute("normal",gt),Object.keys(rt).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const xt=[],Bt=[],Lt={};if(e.morphTargetDictionary!==void 0)for(const Gt in e.morphTargetDictionary)Lt[e.morphTargetDictionary[Gt]]=Gt;for(let Gt=0;Gt<e.morphTargetInfluences.length;++Gt){const Xt={};let rn=!1;for(const fn in g.morphAttributes){if(fn!=="position"&&fn!=="normal"){rn||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),rn=!0);continue}const wn=g.morphAttributes[fn][Gt],Cn=fn.toUpperCase(),bn=g.attributes[fn];if(i.attributes.has(this.getUID(wn,!0))){Xt[Cn]=i.attributes.get(this.getUID(wn,!0));continue}const Dn=wn.clone();if(!g.morphTargetsRelative)for(let En=0,Tn=wn.count;En<Tn;En++)Dn.setXYZ(En,wn.getX(En)-bn.getX(En),wn.getY(En)-bn.getY(En),wn.getZ(En)-bn.getZ(En));Xt[Cn]=this.processAccessor(Dn,g),i.attributes.set(this.getUID(bn,!0),Xt[Cn])}ut.push(Xt),xt.push(e.morphTargetInfluences[Gt]),e.morphTargetDictionary!==void 0&&Bt.push(Lt[Gt])}nt.weights=xt,Bt.length>0&&(nt.extras={},nt.extras.targetNames=Bt)}const wt=Array.isArray(e.material);if(wt&&g.groups.length===0)return null;const It=wt?e.material:[e.material],Et=wt?g.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let xt=0,Bt=Et.length;xt<Bt;xt++){const Lt={mode:$,attributes:rt};if(this.serializeUserData(g,Lt),ut.length>0&&(Lt.targets=ut),g.index!==null){let Xt=this.getUID(g.index);Et[xt].start===void 0&&Et[xt].count===void 0||(Xt+=":"+Et[xt].start+":"+Et[xt].count),i.attributes.has(Xt)?Lt.indices=i.attributes.get(Xt):(Lt.indices=this.processAccessor(g.index,g,Et[xt].start,Et[xt].count),i.attributes.set(Xt,Lt.indices)),Lt.indices===null&&delete Lt.indices}const Gt=this.processMaterial(It[Et[xt].materialIndex]);Gt!==null&&(Lt.material=Gt),st.push(Lt)}nt.primitives=st,s.meshes||(s.meshes=[]),this._invokeAll(function(xt){xt.writeMesh&&xt.writeMesh(e,nt)});const Ct=s.meshes.push(nt)-1;return i.meshes.set(h,Ct),Ct}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,a={type:s?"orthographic":"perspective"};return s?a.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:a.perspective={aspectRatio:e.aspect,yfov:d.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(a.name=e.type),i.cameras.push(a)-1}processAnimation(e,i){const s=this.json,a=this.nodeMap;s.animations||(s.animations=[]);const h=(e=f_.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,g=[],$=[];for(let nt=0;nt<h.length;++nt){const rt=h[nt],st=d.iUV.parseTrackName(rt.name);let ut=d.iUV.findNode(i,st.nodeName);const mt=dp[st.propertyName];if(st.objectName==="bones"&&(ut=ut.isSkinnedMesh===!0?ut.skeleton.getBoneByName(st.objectIndex):void 0),!ut||!mt)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',rt.name),null;const gt=1;let yt,wt=rt.values.length/rt.times.length;mt===dp.morphTargetInfluences&&(wt/=ut.morphTargetInfluences.length),rt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(yt="CUBICSPLINE",wt/=3):yt=rt.getInterpolation()===d.Syv?"STEP":"LINEAR",$.push({input:this.processAccessor(new d.TlE(rt.times,gt)),output:this.processAccessor(new d.TlE(rt.values,wt)),interpolation:yt}),g.push({sampler:$.length-1,target:{node:a.get(ut),path:mt}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:$,channels:g}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,a=i.nodes[s.get(e)],h=e.skeleton;if(h===void 0)return null;const g=e.skeleton.bones[0];if(g===void 0)return null;const $=[],nt=new Float32Array(16*h.bones.length),rt=new d.yGw;for(let st=0;st<h.bones.length;++st)$.push(s.get(h.bones[st])),rt.copy(h.boneInverses[st]),rt.multiply(e.bindMatrix).toArray(nt,16*st);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new d.TlE(nt,16)),joints:$,skeleton:s.get(g)}),a.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,a=this.nodeMap;i.nodes||(i.nodes=[]);const h={};if(s.trs){const $=e.quaternion.toArray(),nt=e.position.toArray(),rt=e.scale.toArray();kv($,[0,0,0,1])||(h.rotation=$),kv(nt,[0,0,0])||(h.translation=nt),kv(rt,[1,1,1])||(h.scale=rt)}else e.matrixAutoUpdate&&e.updateMatrix(),kv(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(h.matrix=e.matrix.elements);if(e.name!==""&&(h.name=String(e.name)),this.serializeUserData(e,h),e.isMesh||e.isLine||e.isPoints){const $=this.processMesh(e);$!==null&&(h.mesh=$)}else e.isCamera&&(h.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const $=[];for(let nt=0,rt=e.children.length;nt<rt;nt++){const st=e.children[nt];if(st.visible||s.onlyVisible===!1){const ut=this.processNode(st);ut!==null&&$.push(ut)}}$.length>0&&(h.children=$)}this._invokeAll(function($){$.writeNode&&$.writeNode(e,h)});const g=i.nodes.push(h)-1;return a.set(e,g),g}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const a={};e.name!==""&&(a.name=e.name),i.scenes.push(a);const h=[];for(let g=0,$=e.children.length;g<$;g++){const nt=e.children[g];if(nt.visible||s.onlyVisible===!1){const rt=this.processNode(nt);rt!==null&&h.push(rt)}}h.length>0&&(a.nodes=h),this.serializeUserData(e,a)}processObjects(e){const i=new d.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(a){a.beforeParse&&a.beforeParse(e)});const s=[];for(let a=0;a<e.length;a++)e[a]instanceof d.xsS?this.processScene(e[a]):s.push(e[a]);s.length>0&&this.processObjects(s);for(let a=0;a<this.skins.length;++a)this.processSkin(this.skins[a]);for(let a=0;a<i.animations.length;++a)this.processAnimation(i.animations[a],e[0]);this._invokeAll(function(a){a.afterParse&&a.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class Qp{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,a=s.json,h=s.extensionsUsed,g={};e.name&&(g.name=e.name),g.color=e.color.toArray(),g.intensity=e.intensity,e.isDirectionalLight?g.type="directional":e.isPointLight?(g.type="point",e.distance>0&&(g.range=e.distance)):e.isSpotLight&&(g.type="spot",e.distance>0&&(g.range=e.distance),g.spot={},g.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,g.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),h[this.name]||(a.extensions=a.extensions||{},a.extensions[this.name]={lights:[]},h[this.name]=!0);const $=a.extensions[this.name].lights;$.push(g),i.extensions=i.extensions||{},i.extensions[this.name]={light:$.length-1}}}class Xx{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class TP{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,i){if(!e.isGLTFSpecularGlossinessMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};i.pbrMetallicRoughness.baseColorFactor&&(h.diffuseFactor=i.pbrMetallicRoughness.baseColorFactor);const g=[1,1,1];if(e.specular.toArray(g,0),h.specularFactor=g,h.glossinessFactor=e.glossiness,i.pbrMetallicRoughness.baseColorTexture&&(h.diffuseTexture=i.pbrMetallicRoughness.baseColorTexture),e.specularMap){const $={index:s.processTexture(e.specularMap)};s.applyTextureTransform($,e.specularMap),h.specularGlossinessTexture=$}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class wI{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.clearcoatFactor=e.clearcoat,e.clearcoatMap){const g={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(g,e.clearcoatMap),h.clearcoatTexture=g}if(h.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const g={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(g,e.clearcoatRoughnessMap),h.clearcoatRoughnessTexture=g}if(e.clearcoatNormalMap){const g={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(g,e.clearcoatNormalMap),h.clearcoatNormalTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class $O{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.iridescenceFactor=e.iridescence,e.iridescenceMap){const g={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(g,e.iridescenceMap),h.iridescenceTexture=g}if(h.iridescenceIor=e.iridescenceIOR,h.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const g={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(g,e.iridescenceThicknessMap),h.iridescenceThicknessTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class JO{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.transmissionFactor=e.transmission,e.transmissionMap){const g={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(g,e.transmissionMap),h.transmissionTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class ZO{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.thicknessFactor=e.thickness,e.thicknessMap){const g={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(g,e.thicknessMap),h.thicknessTexture=g}h.attenuationDistance=e.attenuationDistance,h.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class eL{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const g={index:s.processTexture(e.sheenColorMap)};s.applyTextureTransform(g,e.sheenColorMap),h.sheenColorTexture=g}if(h.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const g={index:s.processTexture(e.sheenRoughnessMap)};s.applyTextureTransform(g,e.sheenRoughnessMap),h.sheenRoughnessTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,a[this.name]=!0}}class tL{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer.extensionsUsed,a={};a.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=a,s[this.name]=!0}}f_.Utils={GLTFWriter:eM,insertKeyframe:function(c,e){const s=c.getValueSize(),a=new c.TimeBufferType(c.times.length+1),h=new c.ValueBufferType(c.values.length+s),g=c.createInterpolant(new c.ValueBufferType(s));let $;if(c.times.length===0){a[0]=e;for(let nt=0;nt<s;nt++)h[nt]=0;$=0}else if(e<c.times[0]){if(Math.abs(c.times[0]-e)<.001)return 0;a[0]=e,a.set(c.times,1),h.set(g.evaluate(e),0),h.set(c.values,s),$=0}else if(e>c.times[c.times.length-1]){if(Math.abs(c.times[c.times.length-1]-e)<.001)return c.times.length-1;a[a.length-1]=e,a.set(c.times,0),h.set(c.values,0),h.set(g.evaluate(e),c.values.length),$=a.length-1}else for(let nt=0;nt<c.times.length;nt++){if(Math.abs(c.times[nt]-e)<.001)return nt;if(c.times[nt]<e&&c.times[nt+1]>e){a.set(c.times.slice(0,nt+1),0),a[nt+1]=e,a.set(c.times.slice(nt+1),nt+2),h.set(c.values.slice(0,(nt+1)*s),0),h.set(g.evaluate(e),(nt+1)*s),h.set(c.values.slice((nt+1)*s),(nt+2)*s),$=nt+1;break}}return c.times=a,c.values=h,$},mergeMorphTargetTracks:function(c,e){const i=[],s={},a=c.tracks;for(let h=0;h<a.length;++h){let g=a[h];const $=d.iUV.parseTrackName(g.name),nt=d.iUV.findNode(e,$.nodeName);if($.propertyName!=="morphTargetInfluences"||$.propertyIndex===void 0){i.push(g);continue}if(g.createInterpolant!==g.InterpolantFactoryMethodDiscrete&&g.createInterpolant!==g.InterpolantFactoryMethodLinear){if(g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),g=g.clone(),g.setInterpolation(d.NMF)}const rt=nt.morphTargetInfluences.length,st=nt.morphTargetDictionary[$.propertyIndex];if(st===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+$.propertyIndex);let ut;if(s[nt.uuid]===void 0){ut=g.clone();const gt=new ut.ValueBufferType(rt*ut.times.length);for(let yt=0;yt<ut.times.length;yt++)gt[yt*rt+st]=ut.values[yt];ut.name=($.nodeName||"")+".morphTargetInfluences",ut.values=gt,s[nt.uuid]=ut,i.push(ut);continue}const mt=g.createInterpolant(new g.ValueBufferType(1));ut=s[nt.uuid];for(let gt=0;gt<ut.times.length;gt++)ut.values[gt*rt+st]=mt.evaluate(ut.times[gt]);for(let gt=0;gt<g.times.length;gt++){const yt=this.insertKeyframe(ut,g.times[gt]);ut.values[yt*rt+st]=g.values[gt]}}return c.tracks=i,c}};class wR extends f_.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new d.Wid}serializeUserData(e,i){const s=e.userData,a={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([h,g])=>{(!g||typeof g=="function"||g.isObject3D||g.isTexture||g.isMaterial||g.assetType!=null||h.startsWith("_")||h!=="uuid"&&(Go.includes(h)||qu.includes(h)||$l.includes(h)))&&(a[h]=g,delete s[h])}),super.serializeUserData(e,i),Object.entries(a).forEach(([h,g])=>{s[h]=g,delete a[h]})}processObjects(e){var i;e.length===1&&(!((i=e[0])===null||i===void 0)&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(!e||i===e)return s;const a=JSON.stringify(this.json.materials[s]),h=JSON.parse(a);this.serializeUserData(e,h),this._invokeAll($=>{$.writeMaterial&&$.writeMaterial(e,h)});const g=this.json.materials.push(h)-1;return this.cache.materials.set(e,g),g}processImageBlob(e,i){if(!e)return-1;const s=this.cache,a=this.options,h=this.pending,g=this.json,$=i.image;s.images.has($)||s.images.set($,{});const nt=s.images.get($),rt=e.type+":flipY/"+i.flipY.toString();if(nt[rt]!==void 0)return nt[rt];g.images||(g.images=[]);const st={mimeType:e.type};a.binary===!0?h.push(new Promise(mt=>{this.processBufferViewImage(e).then(gt=>{st.bufferView=gt,mt()})})):h.push(gu(e).then(mt=>{st.uri=mt}));const ut=g.images.push(st)-1;return nt[rt]=ut,ut}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const a=e.source.data,h=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const g=super.processTexture(e),$=s.textures[g];if(!$)return console.error("No texture def",g,e),g;const nt=s.images?s.images[$.source]:null;if(nt&&(nt.extras||(nt.extras={}),e.source&&(nt.extras.uuid=e.source.uuid),nt.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=a,e.userData.mimeType=h,!$)return console.error("textureDef is null",g,e),g;$.source>=0?console.warn("textureDef.source is already set",g,e):$.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,h)}return $.source<0&&console.error("textureDef.source cannot be saved",$,e),g}processImage(e,i,s,a="image/png"){return e?super.processImage(e,i,s,a):-1}processImageUri(e,i,s,a="image/png"){const h=this.cache,g=this.json;h.images.has(e)||h.images.set(e,{});const $=h.images.get(e),nt=a+":flipY/"+s.toString();if($[nt]!==void 0)return $[nt];g.images||(g.images=[]);const rt={mimeType:a,uri:i,extras:{flipY:s}},st=g.images.push(rt)-1;return $[nt]=st,st}}class IP extends f_{register(e){return super.register(e)}async parseAsync(e,i){var s;if(!e)throw new Error("No object to export");const a=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((h,g)=>this.parse(e,h,g,i));if(a&&typeof a=="object"&&!a.byteLength)return new Blob([JSON.stringify(a,(h,g)=>h.startsWith("__")?void 0:g,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"model/gltf+json"});if(a)return new Blob([a],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,a={}){var h;const g={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!a.embedUrlImages&&a.externalImagesInExtras||!1,embedUrlImages:(h=a.embedUrlImages)!==null&&h!==void 0&&h,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return a.exportExt==="glb"&&(g.binary=!0),a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach($=>$.traverse(nt=>{nt.uuid&&(nt.userData.gltfUUID=nt.uuid)})),(Array.isArray(e)?e:[e]).forEach($=>$.traverse(nt=>{if(nt.animations)for(const rt of nt.animations)rt.__gltfExport===!1||g.animations.includes(rt)||g.animations.push(...nt.animations)})),super.parse(e,$=>{a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(nt=>nt.traverse(rt=>{delete rt.userData.gltfUUID})),i(Object.assign($,{__isGLTFOutput:!0}))},s,g,new wR)}}function xR(c,e){const i=c.getPlugin(Jr).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&Object.entries(i.resources.textures).forEach(([a,h])=>{e.json.textures.find($=>{var nt,rt,st,ut,mt;return((nt=$.extras)===null||nt===void 0?void 0:nt.uuid)===a||((st=(rt=e.json.samplers[$.sampler])===null||rt===void 0?void 0:rt.extras)===null||st===void 0?void 0:st.uuid)===a||((mt=(ut=e.json.images[$.source])===null||ut===void 0?void 0:ut.extras)===null||mt===void 0?void 0:mt.t_uuid)===a})&&(h.image&&i.resources.images&&i.resources.images[h.image]&&delete i.resources.images[h.image],i.resources.textures[a]={})}),e.json.materials&&i.resources.materials&&Object.entries(i.resources.materials).forEach(([a,h])=>{e.json.materials.find($=>{var nt;return((nt=$.extras)===null||nt===void 0?void 0:nt.uuid)===a})&&(i.resources.materials[a]={})});const s=[];Object.values(i.resources).forEach(a=>{Object.values(a).forEach(h=>{h.url&&(h.url.type==="Uint16Array"&&h.url.data&&(h.url.data instanceof Uint16Array||(h.url.data=new Uint16Array(h.url.data)),s.push(h.url)),h.url.type==="Uint8Array"&&h.url.data&&(h.url.data instanceof Uint8Array||(h.url.data=new Uint8Array(h.url.data)),s.push(h.url)))})});for(const a of s){let h="application/octet-stream";if(a.type==="Uint16Array"){const rt=nL(a.data,4),st=new ImageData(rt,a.width,a.height),ut=d.PpQ.getDataURL(st,!0).split(",")[1];h="image/png",a.data=atob(ut),a.encoding="rgbe"}const g=new Blob([a.data],{type:h});e.json.images||(e.json.images=[]);const $={mimeType:h},nt=e.json.images.push($)-1;a.data={image:nt},e.pending.push(e.processBufferViewImage(g).then(rt=>{$.bufferView=rt}))}return i}function nL(c,e=3,i){let s,a,h,g,$;const nt=c.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*nt);for(let rt=0;rt<nt;rt++){s=c[rt*e],a=c[rt*e+1],h=c[rt*e+2],g=Math.max(Math.max(s,a),h);const st=Math.ceil(Math.log2(g));$=Math.pow(2,st-8),i[4*rt]=s/$|0,i[4*rt+1]=a/$|0,i[4*rt+2]=h/$|0,i[4*rt+3]=st+128}return i}function PP(c,e=IP,i){var s;if(!c)return;const a=sy.Exporters.findIndex(g=>g.ext.includes("gltf")||g.ext.includes("glb")),h=[];a>=0?(h.push(...(s=sy.Exporters[a].extensions)!==null&&s!==void 0?s:[]),sy.Exporters.splice(a,1)):(h.push(sL),h.push(iL),h.push(rL),h.push(g=>new oL(g)),h.push(g=>new aL(g)),h.push(g=>new lL(g)),h.push(g=>new cL(g))),sy.Exporters.push({ctor:()=>{const g=new e;return h.forEach($=>g.register($)),g.register($=>({afterParse:nt=>{var rt,st;if(!(!((rt=(nt=Array.isArray(nt)?nt[0]:nt)==null?void 0:nt.userData)===null||rt===void 0)&&rt.rootSceneModelRoot)||((st=nt==null?void 0:nt.userData)===null||st===void 0?void 0:st.__exportViewerConfig)===!1)return;const ut=$.json.scenes[$.json.scene||0];ut.extensions||(ut.extensions={}),ut.extensions[$p]=xR(c,$),$.extensionsUsed[$p]=!0}})),i==null||i(g),g},ext:["gltf","glb"],extensions:h})}const rL=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[xn]=s,c.extensionsUsed[xn]=!0)}}),iL=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[fv]=s,c.extensionsUsed[fv]=!0)}}),sL=c=>({writeMaterial(e,i){var s;if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const a={};if(e.emissiveIntensity!==void 0&&(!((s=e.emissive)===null||s===void 0)&&s.isColor)){const g=e.emissive.clone().multiplyScalar(e.emissiveIntensity),$=Math.max(g.r,g.g,g.b);$>1&&(a.emissiveIntensity=$)}e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.side!==void 0&&e.side!==d.ehD&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped);const h=this.materialExternalResources[e.uuid];h&&Object.entries(h).forEach(([g,$])=>{g.startsWith("_")||(a[g]=Xr($,!1,this.serializedMeta))}),Object.keys(a).length>0&&(i.extensions[Jp]=a,c.extensionsUsed[Jp]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!c.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(a=>{var h;a&&(!((h=a.material)===null||h===void 0)&&h.isMaterial)&&i.push(a.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([a,h])=>{a.startsWith("_")||h&&h.isTexture&&h.userData.rootPath&&(s[a]=null,this.materialExternalResources[s.uuid][a]=h)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(a=>{const h=a.__materialRef;h&&(Object.entries(a).forEach(([g,$])=>{g.startsWith("_")||$&&(h[g]=$)}),delete this.materialExternalResources[h.uuid])});const s=c.json.scenes[c.json.scene||0];s.extensions||(s.extensions={}),s.extensions[Jp]={resources:this.serializedMeta},c.extensionsUsed[Jp]=!0}});class oL{constructor(e){this.writer=e,this.name=ym}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.bumpScale=e.bumpScale,e.bumpMap){const g={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(g,e.bumpMap),h.bumpTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class aL{constructor(e){this.writer=e,this.name=Yv}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.displacementScale=e.displacementScale,h.displacementBias=e.displacementBias,e.displacementMap){const g={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(g,e.displacementMap),h.displacementTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class lL{constructor(e){this.writer=e,this.name=Am}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.lightMapIntensity=e.lightMapIntensity,e.lightMap){const g={index:s.processTexture(e.lightMap)};s.applyTextureTransform(g,e.lightMap),h.lightMapTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class cL{constructor(e){this.writer=e,this.name=gv}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,a=s.extensionsUsed,h={};if(e.alphaMap){const g={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(g,e.alphaMap),h.alphaTexture=g}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class sy extends _e{constructor(e,i={}){super(),this._processors=new S0,this._cachedParsers=[],PP(e)}get processors(){return this._processors}getExporter(...e){return sy.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}async exportObject(e,i={}){var s,a,h,g;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((a=(s=e)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const $=await this._exportFile(e,i);return!((g=(h=e)===null||h===void 0?void 0:h.userData)===null||g===void 0)&&g.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,$}async _exportFile(e,i={}){var s,a,h;let g;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const $=await this.processBeforeExport(e,i),nt=(a=(s=i.exportExt)!==null&&s!==void 0?s:$==null?void 0:$.typeExt)!==null&&a!==void 0?a:$==null?void 0:$.ext;if(!$||!nt)throw new Error(`Unable to preprocess before export ${nt}`);const rt=this._getParser(nt);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const st=await rt.parseAsync($.obj,{exportExt:(h=$.ext)!==null&&h!==void 0?h:nt,...i});st.ext=$.ext,g=st}catch($){return console.error("AssetExporter: Unable to Export file",e),console.error($),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:$})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),g}_createParser(e){const i=sy.Exporters.find(a=>a.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i,s;return(s=(i=this._cachedParsers.find(a=>a.ext.includes(e)))===null||i===void 0?void 0:i.parser)!==null&&s!==void 0?s:this._createParser(e)}async processBeforeExport(e,i={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,i)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}sy.Exporters=[{ctor:()=>new AI,ext:["json"]},{ctor:()=>new p_,ext:["txt","text"]}];class tM extends Ks{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new sy(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var a;return s.convertMeshToIndexed&&((a=i.modelObject)===null||a===void 0||a.traverse(h=>{var g;h.geometry&&(h.geometry.attributes.index||(g=h.setGeometry)===null||g===void 0||g.call(h,Us(h.geometry)))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(i=this.exporter)===null||i===void 0?void 0:i.exportObject((s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var a;typeof((a=s.plugin)===null||a===void 0?void 0:a.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,a])=>typeof(a==null?void 0:a.toJSON)=="function").map(([s,a])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const s=await this.exportScene(this.exportOptions);s&&Tu(s,this.exportOptions.name+"."+s.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var a;s.value=!1,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var a;s.value=!0,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Jr).exportPluginPresets(i.filter(a=>!!a.value).map(a=>Ht(a.label)||"")),null,2)],{type:"application/json"});s&&Tu(s,this.exportOptions.name+"."+Jr.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Jr).exportViewerConfig(),null,2)],{type:"application/json"});s&&Tu(s,this.exportOptions.name+"."+Jr.ViewerTypeSlug)}}]}]}}}tM.PluginType="AssetExporterPlugin";class DP{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class oy extends DP{constructor(e,i,s,a={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=a,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class uL extends DP{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(a=>i(a.getParent()))),s.forEach(a=>a.dispose()),this}createEdge(e,i,s,a){return this._registerEdge(new oy(e,i,s,a))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function nM(){return nM=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c},nM.apply(this,arguments)}function RP(c){return c instanceof oy}function kP(c){return Array.isArray(c)&&c[0]instanceof oy}function BP(c){return!!(c&&typeof c=="object"&&Object.values(c)[0]instanceof oy)}const Ll=Symbol("attributes"),KE=Symbol("immutableKeys");class OP extends DP{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Ll]=void 0,this[KE]=void 0,this.graph=e,this[KE]=new Set,this[Ll]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const a=e[s];if(a instanceof OP){const h=this.graph.createEdge(s,this,a);h.addEventListener("dispose",()=>a.dispose()),this[KE].add(s),i[s]=h}else i[s]=a}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[Ll]){const a=this[Ll][s];if(RP(a)){const h=a;h.getChild()===e&&this.setRef(s,i,h.getAttributes())}else if(kP(a)){const h=a.find(g=>g.getChild()===e);if(h){const g=h.getAttributes();this.removeRef(s,e).addRef(s,i,g)}}else if(BP(a)){const h=a;for(const g in h){const $=h[g];$.getChild()===e&&this.setRefMap(s,g,i,$.getAttributes())}}}return this}get(e){return this[Ll][e]}set(e,i){return this[Ll][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[Ll][e];return i?i.getChild():null}setRef(e,i,s){if(this[KE].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const a=this[Ll][e];if(a&&a.dispose(),!i)return this;const h=this.graph.createEdge(e,this,i,s);return h.addEventListener("dispose",()=>{delete this[Ll][e],this.dispatchEvent({type:"change",attribute:e})}),this[Ll][e]=h,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Ll][e].map(i=>i.getChild())}addRef(e,i,s){const a=this.graph.createEdge(e,this,i,s),h=this[Ll][e];return h.push(a),a.addEventListener("dispose",()=>{const g=h.filter($=>$!==a);h.length=0;for(const $ of g)h.push($);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[Ll][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[Ll][e])}listRefMapValues(e){return Object.values(this[Ll][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[Ll][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,a){const h=this[Ll][e],g=h[i];if(g&&g.dispose(),!s)return this;a=Object.assign(a||{},{key:i});const $=this.graph.createEdge(e,this,s,nM({},a,{key:i}));return $.addEventListener("dispose",()=>{delete h[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),h[i]=$,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(nM({},e,{target:this})),this.graph.dispatchEvent(nM({},e,{target:this,type:`node:${e.type}`})),this}}var xI,$r,bI,p0,ju,m_,LP=typeof Float32Array<"u"?Float32Array:Array;function NP(c){var e=c[0],i=c[1],s=c[2];return Math.hypot(e,i,s)}function hL(c,e,i){var s=e[0],a=e[1],h=e[2],g=i[3]*s+i[7]*a+i[11]*h+i[15];return g=g||1,c[0]=(i[0]*s+i[4]*a+i[8]*h+i[12])/g,c[1]=(i[1]*s+i[5]*a+i[9]*h+i[13])/g,c[2]=(i[2]*s+i[6]*a+i[10]*h+i[14])/g,c}function dL(c,e,i){var s=e[0],a=e[1],h=e[2],g=e[3],$=e[4],nt=e[5],rt=e[6],st=e[7],ut=e[8],mt=e[9],gt=e[10],yt=e[11],wt=e[12],It=e[13],Et=e[14],Ct=e[15],xt=i[0],Bt=i[1],Lt=i[2],Gt=i[3];return c[0]=xt*s+Bt*$+Lt*ut+Gt*wt,c[1]=xt*a+Bt*nt+Lt*mt+Gt*It,c[2]=xt*h+Bt*rt+Lt*gt+Gt*Et,c[3]=xt*g+Bt*st+Lt*yt+Gt*Ct,xt=i[4],Bt=i[5],Lt=i[6],Gt=i[7],c[4]=xt*s+Bt*$+Lt*ut+Gt*wt,c[5]=xt*a+Bt*nt+Lt*mt+Gt*It,c[6]=xt*h+Bt*rt+Lt*gt+Gt*Et,c[7]=xt*g+Bt*st+Lt*yt+Gt*Ct,xt=i[8],Bt=i[9],Lt=i[10],Gt=i[11],c[8]=xt*s+Bt*$+Lt*ut+Gt*wt,c[9]=xt*a+Bt*nt+Lt*mt+Gt*It,c[10]=xt*h+Bt*rt+Lt*gt+Gt*Et,c[11]=xt*g+Bt*st+Lt*yt+Gt*Ct,xt=i[12],Bt=i[13],Lt=i[14],Gt=i[15],c[12]=xt*s+Bt*$+Lt*ut+Gt*wt,c[13]=xt*a+Bt*nt+Lt*mt+Gt*It,c[14]=xt*h+Bt*rt+Lt*gt+Gt*Et,c[15]=xt*g+Bt*st+Lt*yt+Gt*Ct,c}function pL(c,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of c.listPrimitives()){const a=s.getAttribute("POSITION");if(!a)continue;let h=[0,0,0],g=[0,0,0];for(let $=0;$<a.getCount();$++)h=a.getElement($,h),g=hL(g,h,e),FP(g,i)}return i}function FP(c,e){for(let i=0;i<3;i++)e.min[i]=Math.min(c[i],e.min[i]),e.max[i]=Math.max(c[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var c=0,e=arguments.length;e--;)c+=arguments[e]*arguments[e];return Math.sqrt(c)}),xI=new LP(3),LP!=Float32Array&&(xI[0]=0,xI[1]=0,xI[2]=0),function(c){c.ACCESSOR="Accessor",c.ANIMATION="Animation",c.ANIMATION_CHANNEL="AnimationChannel",c.ANIMATION_SAMPLER="AnimationSampler",c.BUFFER="Buffer",c.CAMERA="Camera",c.MATERIAL="Material",c.MESH="Mesh",c.PRIMITIVE="Primitive",c.PRIMITIVE_TARGET="PrimitiveTarget",c.NODE="Node",c.ROOT="Root",c.SCENE="Scene",c.SKIN="Skin",c.TEXTURE="Texture",c.TEXTURE_INFO="TextureInfo"}($r||($r={})),function(c){c.INTERLEAVED="interleaved",c.SEPARATE="separate"}(bI||(bI={})),function(c){c.ARRAY_BUFFER="ARRAY_BUFFER",c.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",c.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",c.OTHER="OTHER"}(p0||(p0={})),function(c){c[c.R=4096]="R",c[c.G=256]="G",c[c.B=16]="B",c[c.A=1]="A"}(ju||(ju={})),function(c){c.GLTF="GLTF",c.GLB="GLB"}(m_||(m_={}));class zo{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const h of e)i+=h.byteLength;const s=new Uint8Array(i);let a=0;for(const h of e)s.set(h,a),a+=h.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const a=new Uint8Array(s);if(a.set(e),i!==0)for(let h=e.byteLength;h<s;h++)a[h]=i;return a}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class rv{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,a,h]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*a<<8^255*h<<0}static convertSRGBToLinear(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.04045?.0773993808*s[h]:Math.pow(.9478672986*s[h]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.0031308?12.92*s[h]:1.055*Math.pow(s[h],.41666)-.055;return i}}class EI{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return zo.decodeText(e.slice(12,16))===EI.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}EI.PNG_FRIED_CHUNK_NAME="CgBI";class iA{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getMemSize(e,i){if(!this.impls[i])return null;if(this.impls[i].getGPUByteLength)return this.impls[i].getGPUByteLength(e);let s=0;const a=this.getSize(e,i);if(!a)return null;for(;a[0]>1||a[1]>1;)s+=a[0]*a[1]*4,a[0]=Math.max(Math.floor(a[0]/2),1),a[1]=Math.max(Math.floor(a[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function fL(c,e){if(e>c.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(c.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return c}iA.impls={"image/jpeg":new class{match(c){return c.length>=3&&c[0]===255&&c[1]===216&&c[2]===255}getSize(c){let e,i,s=new DataView(c.buffer,c.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),fL(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(c.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(c){return 3}},"image/png":new EI};class Kx{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return iA.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function bR(c){return Object.prototype.toString.call(c)==="[object Object]"}function sA(c){if(bR(c)===!1)return!1;const e=c.constructor;if(e===void 0)return!0;const i=e.prototype;return bR(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}class Bv{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Bv.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Bv.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Bv.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Bv.Verbosity.ERROR&&console.error(e)}}Bv.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},Bv.DEFAULT_INSTANCE=new Bv(Bv.Verbosity.INFO);class Su{static identity(e){return e}static eq(e,i){if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-i[s])>1e-5)return!1;return!0}static denormalize(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,i,s,a){let h=NP([e[0],e[1],e[2]]);const g=NP([e[4],e[5],e[6]]),$=NP([e[8],e[9],e[10]]);(function(mt){var gt=mt[0],yt=mt[1],wt=mt[2],It=mt[3],Et=mt[4],Ct=mt[5],xt=mt[6],Bt=mt[7],Lt=mt[8],Gt=mt[9],Xt=mt[10],rn=mt[11],fn=mt[12],wn=mt[13],Cn=mt[14],bn=mt[15];return(gt*Ct-yt*Et)*(Xt*bn-rn*Cn)-(gt*xt-wt*Et)*(Gt*bn-rn*wn)+(gt*Bt-It*Et)*(Gt*Cn-Xt*wn)+(yt*xt-wt*Ct)*(Lt*bn-rn*fn)-(yt*Bt-It*Ct)*(Lt*Cn-Xt*fn)+(wt*Bt-It*xt)*(Lt*wn-Gt*fn)})(e)<0&&(h=-h),i[0]=e[12],i[1]=e[13],i[2]=e[14];const nt=e.slice(),rt=1/h,st=1/g,ut=1/$;nt[0]*=rt,nt[1]*=rt,nt[2]*=rt,nt[4]*=st,nt[5]*=st,nt[6]*=st,nt[8]*=ut,nt[9]*=ut,nt[10]*=ut,function(mt,gt){var yt=new LP(3);(function(Dn,En){var Tn=En[0],Un=En[1],Pn=En[2],Yn=En[4],cr=En[5],mr=En[6],ir=En[8],Dr=En[9],Nr=En[10];Dn[0]=Math.hypot(Tn,Un,Pn),Dn[1]=Math.hypot(Yn,cr,mr),Dn[2]=Math.hypot(ir,Dr,Nr)})(yt,gt);var wt=1/yt[0],It=1/yt[1],Et=1/yt[2],Ct=gt[0]*wt,xt=gt[1]*It,Bt=gt[2]*Et,Lt=gt[4]*wt,Gt=gt[5]*It,Xt=gt[6]*Et,rn=gt[8]*wt,fn=gt[9]*It,wn=gt[10]*Et,Cn=Ct+Gt+wn,bn=0;Cn>0?(bn=2*Math.sqrt(Cn+1),mt[3]=.25*bn,mt[0]=(Xt-fn)/bn,mt[1]=(rn-Bt)/bn,mt[2]=(xt-Lt)/bn):Ct>Gt&&Ct>wn?(bn=2*Math.sqrt(1+Ct-Gt-wn),mt[3]=(Xt-fn)/bn,mt[0]=.25*bn,mt[1]=(xt+Lt)/bn,mt[2]=(rn+Bt)/bn):Gt>wn?(bn=2*Math.sqrt(1+Gt-Ct-wn),mt[3]=(rn-Bt)/bn,mt[0]=(xt+Lt)/bn,mt[1]=.25*bn,mt[2]=(Xt+fn)/bn):(bn=2*Math.sqrt(1+wn-Ct-Gt),mt[3]=(xt-Lt)/bn,mt[0]=(rn+Bt)/bn,mt[1]=(Xt+fn)/bn,mt[2]=.25*bn)}(s,nt),a[0]=h,a[1]=g,a[2]=$}static compose(e,i,s,a){const h=a,g=i[0],$=i[1],nt=i[2],rt=i[3],st=g+g,ut=$+$,mt=nt+nt,gt=g*st,yt=g*ut,wt=g*mt,It=$*ut,Et=$*mt,Ct=nt*mt,xt=rt*st,Bt=rt*ut,Lt=rt*mt,Gt=s[0],Xt=s[1],rn=s[2];return h[0]=(1-(It+Ct))*Gt,h[1]=(yt+Lt)*Gt,h[2]=(wt-Bt)*Gt,h[3]=0,h[4]=(yt-Lt)*Xt,h[5]=(1-(gt+Ct))*Xt,h[6]=(Et+xt)*Xt,h[7]=0,h[8]=(wt+Bt)*rn,h[9]=(Et-xt)*rn,h[10]=(1-(gt+It))*rn,h[11]=0,h[12]=e[0],h[13]=e[1],h[14]=e[2],h[15]=1,h}}function mL(c,e){if(!!c!=!!e)return!1;const i=c.getChild(),s=e.getChild();return i===s||i.equals(s)}function gL(c,e){if(!!c!=!!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++){const s=c[i],a=e[i];if(s.getChild()!==a.getChild()&&!s.getChild().equals(a.getChild()))return!1}return!0}function vL(c,e){if(!!c!=!!e)return!1;const i=Object.keys(c),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a in c){const h=c[a],g=e[a];if(!!h!=!!g)return!1;const $=h.getChild(),nt=g.getChild();if($!==nt&&!$.equals(nt))return!1}return!0}function ER(c,e){if(c===e)return!0;if(!!c!=!!e||!c||!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++)if(c[i]!==e[i])return!1;return!0}function SR(c,e){if(c===e)return!0;if(!!c!=!!e)return!1;if(!sA(c)||!sA(e))return c===e;const i=c,s=e;let a,h=0,g=0;for(a in i)h++;for(a in s)g++;if(h!==g)return!1;for(a in i){const $=i[a],nt=s[a];if(SI($)&&SI(nt)){if(!ER($,nt))return!1}else if(sA($)&&sA(nt)){if(!SR($,nt))return!1}else if($!==nt)return!1}return!0}function SI(c){return Array.isArray(c)||ArrayBuffer.isView(c)}const CR="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",MR=new Set,_L=function(){let c="";for(let e=0;e<6;e++)c+=CR.charAt(Math.floor(Math.random()*CR.length));return c};class vw{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return Kx.basename(new URL(e,"https://null.example").pathname)}static extension(e){return Kx.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),a=i.split("/");s.pop();for(let h=0;h<a.length;h++)a[h]!=="."&&(a[h]===".."?s.pop():s.push(a[h]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}vw.DEFAULT_INIT={},vw.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const ay=c=>c,yL=new Set;class UP extends OP{constructor(e,i=""){super(e),this[Ll].name=i,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,ay)}copy(e,i=ay){for(const s in this[Ll]){const a=this[Ll][s];if(a instanceof oy)this[KE].has(s)||a.dispose();else if(Array.isArray(a)&&a[0]instanceof oy)for(const h of a)h.dispose();else if(sA(a)&&Object.values(a)[0]instanceof oy)for(const h in a)a[h].dispose()}for(const s in e[Ll]){const a=this[Ll][s],h=e[Ll][s];if(h instanceof oy)this[KE].has(s)?a.getChild().copy(i(h.getChild()),i):this.setRef(s,i(h.getChild()),h.getAttributes());else if(Array.isArray(h)&&h[0]instanceof oy)for(const g of h)this.addRef(s,i(g.getChild()),g.getAttributes());else if(sA(h)&&Object.values(h)[0]instanceof oy)for(const g in h){const $=h[g];this.setRefMap(s,g,i($.getChild()),$.getAttributes())}else this[Ll][s]=sA(h)?JSON.parse(JSON.stringify(h)):Array.isArray(h)||h instanceof ArrayBuffer||ArrayBuffer.isView(h)?h.slice():h}return this}equals(e,i=yL){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[Ll]){if(i.has(s))continue;const a=this[Ll][s],h=e[Ll][s];if(RP(a)||RP(h)){if(!mL(a,h))return!1}else if(kP(a)||kP(h)){if(!gL(a,h))return!1}else if(BP(a)||BP(h)){if(!vL(a,h))return!1}else if(sA(a)||sA(h)){if(!SR(a,h))return!1}else if(SI(a)||SI(h)){if(!ER(a,h))return!1}else if(a!==h)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Pm extends UP{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class vs extends Pm{constructor(...e){super(...e),this.i=Su.identity,this.o=Su.identity}init(){this.propertyType=$r.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:vs.Type.SCALAR,componentType:vs.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,i=ay){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case vs.Type.SCALAR:return 1;case vs.Type.VEC2:return 2;case vs.Type.VEC3:return 3;case vs.Type.VEC4:case vs.Type.MAT2:return 4;case vs.Type.MAT3:return 9;case vs.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case vs.ComponentType.BYTE:case vs.ComponentType.UNSIGNED_BYTE:return 1;case vs.ComponentType.SHORT:case vs.ComponentType.UNSIGNED_SHORT:return 2;case vs.ComponentType.UNSIGNED_INT:case vs.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=1/0;for(let h=0;h<s*a;h+=a)for(let g=0;g<a;g++){const $=i[h+g];Number.isFinite($)&&(e[g]=Math.min(e[g],$))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=-1/0;for(let h=0;h<s*a;h+=a)for(let g=0;g<a;g++){const $=i[h+g];Number.isFinite($)&&(e[g]=Math.max(e[g],$))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return vs.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>Su.denormalize(i,this.get("componentType")),this.i=i=>Su.normalize(i,this.get("componentType"))):(this.o=Su.identity,this.i=Su.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)i[h]=this.o(a[e*s+h]);return i}setElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)a[e*s+h]=this.i(i[h]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return vs.ComponentType.FLOAT;case Uint32Array:return vs.ComponentType.UNSIGNED_INT;case Uint16Array:return vs.ComponentType.UNSIGNED_SHORT;case Uint8Array:return vs.ComponentType.UNSIGNED_BYTE;case Int16Array:return vs.ComponentType.SHORT;case Int8Array:return vs.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):vs.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}vs.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},vs.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class TR extends Pm{init(){this.propertyType=$r.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class jP extends Pm{init(){this.propertyType=$r.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}jP.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class $E extends Pm{init(){this.propertyType=$r.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:$E.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:p0.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:p0.OTHER})}}$E.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class IR extends Pm{init(){this.propertyType=$r.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class $x extends Pm{init(){this.propertyType=$r.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:$x.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}$x.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class zu extends UP{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}zu.EXTENSION_NAME=void 0;class uu extends Pm{init(){this.propertyType=$r.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:uu.WrapMode.REPEAT,wrapT:uu.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}uu.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},uu.MagFilter={NEAREST:9728,LINEAR:9729},uu.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:CI,G:MI,B:TI,A:AL}=ju;class Jx extends Pm{init(){this.propertyType=$r.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Jx.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new uu(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new uu(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new uu(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new uu(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new uu(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return rv.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",rv.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:CI|MI|TI|AL})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return rv.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",rv.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:CI|MI|TI})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:CI|MI|TI})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:CI})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:MI|TI})}}Jx.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class PR extends Pm{init(){this.propertyType=$r.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class II extends Pm{constructor(...e){super(...e),this.u=null}init(){this.propertyType=$r.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=ay){if(i===ay)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Su.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),a=this.get("scale").slice();return Su.decompose(e,i,s,a),this.set("translation",i).set("rotation",s).set("scale",a)}getWorldTranslation(){const e=[0,0,0];return Su.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Su.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Su.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let a=this;a instanceof II;a=a.u)e.push(a);let i;const s=e.pop().getMatrix();for(;i=e.pop();)dL(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Ll].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class Zx extends Pm{init(){this.propertyType=$r.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Zx.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:p0.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:p0.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Zx.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class wL extends UP{init(){this.propertyType=$r.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:p0.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function iv(){return(iv=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}class DR extends Pm{init(){this.propertyType=$r.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=ay){if(i===ay)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Ll].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class RR extends Pm{init(){this.propertyType=$r.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:p0.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class kR extends Pm{init(){this.propertyType=$r.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||iA.extensionToMimeType(Kx.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",iA.extensionToMimeType(Kx.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",zo.assertView(e))}getSize(){const e=this.get("image");return e?iA.getSize(e,this.getMimeType()):null}}class BR extends Pm{init(){this.propertyType=$r.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=ay){if(i===ay)throw new Error("Root cannot be copied.");this.set("asset",iv({},e.get("asset"))),this.setName(e.getName()),this.setExtras(iv({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const a=e.getExtension(s);this.setExtension(s,i(a))}return this}l(e){return e instanceof DR?this.addRef("scenes",e):e instanceof II?this.addRef("nodes",e):e instanceof $x?this.addRef("cameras",e):e instanceof RR?this.addRef("skins",e):e instanceof PR?this.addRef("meshes",e):e instanceof Jx?this.addRef("materials",e):e instanceof kR?this.addRef("textures",e):e instanceof TR?this.addRef("animations",e):e instanceof vs?this.addRef("accessors",e):e instanceof IR&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class zP{constructor(){this.m=new uL,this.T=new BR(this.m),this.v=Bv.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new zP().setLogger(this.v).merge(this)}merge(e){for(const h of e.getRoot().listExtensionsUsed()){const g=this.createExtension(h.constructor);h.isRequired()&&g.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const h of e.m.listEdges())for(const g of[h.getParent(),h.getChild()]){if(i.has(g))continue;let $;$=g.propertyType===$r.TEXTURE_INFO?g:new g.constructor(this.m),s.set(g,$),i.add(g)}const a=h=>{const g=s.get(h);if(!g)throw new Error("Could resolve property.");return g};for(const h of i){const g=s.get(h);if(!g)throw new Error("Could resolve property.");g.propertyType!==$r.TEXTURE_INFO&&g.copy(h,a)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new DR(this.m,e)}createNode(e=""){return new II(this.m,e)}createCamera(e=""){return new $x(this.m,e)}createSkin(e=""){return new RR(this.m,e)}createMesh(e=""){return new PR(this.m,e)}createPrimitive(){return new Zx(this.m)}createPrimitiveTarget(e=""){return new wL(this.m,e)}createMaterial(e=""){return new Jx(this.m,e)}createTexture(e=""){return new kR(this.m,e)}createAnimation(e=""){return new TR(this.m,e)}createAnimationChannel(e=""){return new jP(this.m,e)}createAnimationSampler(e=""){return new $E(this.m,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new vs(this.m,e).setBuffer(i)}createBuffer(e=""){return new IR(this.m,e)}}class _u{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const a=s,h=a.target;h instanceof zu&&h.extensionName===this.extensionName&&(a.type==="node:create"&&this.M(h),a.type==="node:dispose"&&this.I(h))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}_u.EXTENSION_NAME=void 0;class xL{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const a=this.jsonDoc.json.samplers[s.sampler];a.magFilter!==void 0&&e.setMagFilter(a.magFilter),a.minFilter!==void 0&&e.setMinFilter(a.minFilter),a.wrapS!==void 0&&e.setWrapS(a.wrapS),a.wrapT!==void 0&&e.setWrapT(a.wrapT)}}const VP={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OR={logger:Bv.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function PI(c,e){const i=e.bufferViews[c.bufferView],s=e.jsonDoc.json.bufferViews[c.bufferView],a=VP[c.componentType],h=vs.getElementSize(c.type),g=a.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==h*g)return function(nt,rt){const st=rt.bufferViews[nt.bufferView],ut=rt.jsonDoc.json.bufferViews[nt.bufferView],mt=VP[nt.componentType],gt=vs.getElementSize(nt.type),yt=mt.BYTES_PER_ELEMENT,wt=nt.byteOffset||0,It=new mt(nt.count*gt),Et=new DataView(st.buffer,st.byteOffset,st.byteLength),Ct=ut.byteStride;for(let xt=0;xt<nt.count;xt++)for(let Bt=0;Bt<gt;Bt++){const Lt=wt+xt*Ct+Bt*yt;let Gt;switch(nt.componentType){case vs.ComponentType.FLOAT:Gt=Et.getFloat32(Lt,!0);break;case vs.ComponentType.UNSIGNED_INT:Gt=Et.getUint32(Lt,!0);break;case vs.ComponentType.UNSIGNED_SHORT:Gt=Et.getUint16(Lt,!0);break;case vs.ComponentType.UNSIGNED_BYTE:Gt=Et.getUint8(Lt);break;case vs.ComponentType.SHORT:Gt=Et.getInt16(Lt,!0);break;case vs.ComponentType.BYTE:Gt=Et.getInt8(Lt);break;default:throw new Error(`Unexpected componentType "${nt.componentType}".`)}It[xt*gt+Bt]=Gt}return It}(c,e);const $=i.byteOffset+(c.byteOffset||0);return new a(i.buffer.slice($,$+c.count*h*g))}var rM;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER",c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(rM||(rM={}));class g_{constructor(e,i,s){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=i,this.options=s;const a=e.getRoot(),h=a.listBuffers().length,g=a.listTextures().length;this.bufferURIGenerator=new LR(h>1,s.basename),this.imageURIGenerator=new LR(g>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},a=JSON.stringify(s);this.samplerDefIndexMap.has(a)||(this.samplerDefIndexMap.set(a,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const h={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(a)},g=JSON.stringify(h);this.textureDefIndexMap.has(g)||(this.textureDefIndexMap.set(g,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(h));const $={index:this.textureDefIndexMap.get(g)};return i.getTexCoord()!==0&&($.texCoord=i.getTexCoord()),this.textureInfoDefMap.set(i,$),$}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===m_.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const a=iA.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,a),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.O.get(e);if(i)return i;for(const s of this.N.getGraph().listParentEdges(e)){const{usage:a}=s.getAttributes();if(a)return a;s.getParent().propertyType!==$r.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return g_.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,i){const s=this.O.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.O.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.O.entries()))e[s]=e[s]||[],e[s].push(i);return e}}g_.BufferViewTarget=rM,g_.BufferViewUsage=p0,g_.USAGE_TO_TARGET={[p0.ARRAY_BUFFER]:rM.ARRAY_BUFFER,[p0.ELEMENT_ARRAY_BUFFER]:rM.ELEMENT_ARRAY_BUFFER};class LR{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=i}createURI(e,i){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${i}`:`${this.basename}.${i}`}}const{BufferViewUsage:QP}=g_;var DI;(function(c){c[c.JSON=1313821514]="JSON",c[c.BIN=5130562]="BIN"})(DI||(DI={}));class bL extends class{constructor(){this.v=Bv.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=bI.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===m_.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(i,s=OR){const a=iv({},OR,s),{json:h}=i,g=new zP;this.validate(i,a);const $=new xL(i),nt=h.asset,rt=g.getRoot().getAsset();nt.copyright&&(rt.copyright=nt.copyright),nt.extras&&(rt.extras=nt.extras),h.extras!==void 0&&g.getRoot().setExtras(iv({},h.extras));const st=h.extensionsUsed||[],ut=h.extensionsRequired||[];for(const Ct of a.extensions)if(st.includes(Ct.EXTENSION_NAME)){const xt=g.createExtension(Ct).setRequired(ut.includes(Ct.EXTENSION_NAME));for(const Bt of xt.readDependencies)xt.install(Bt,a.dependencies[Bt])}const mt=h.buffers||[];g.getRoot().listExtensionsUsed().filter(Ct=>Ct.prereadTypes.includes($r.BUFFER)).forEach(Ct=>Ct.preread($,$r.BUFFER)),$.buffers=mt.map(Ct=>{const xt=g.createBuffer(Ct.name);return Ct.extras&&xt.setExtras(Ct.extras),Ct.uri&&Ct.uri.indexOf("__")!==0&&xt.setURI(Ct.uri),xt}),$.bufferViewBuffers=(h.bufferViews||[]).map((Ct,xt)=>{if(!$.bufferViews[xt]){const Bt=i.json.buffers[Ct.buffer];$.bufferViews[xt]=zo.toView(Bt.uri?i.resources[Bt.uri]:i.resources["@glb.bin"],Ct.byteOffset||0,Ct.byteLength)}return $.buffers[Ct.buffer]}),$.accessors=(h.accessors||[]).map(Ct=>{const xt=g.createAccessor(Ct.name,$.bufferViewBuffers[Ct.bufferView]).setType(Ct.type);if(Ct.extras&&xt.setExtras(Ct.extras),Ct.normalized!==void 0&&xt.setNormalized(Ct.normalized),Ct.bufferView===void 0&&!Ct.sparse)return xt;let Bt;return Bt=Ct.sparse!==void 0?function(Lt,Gt){const Xt=VP[Lt.componentType],rn=vs.getElementSize(Lt.type);let fn;fn=Lt.bufferView!==void 0?PI(Lt,Gt):new Xt(Lt.count*rn);const wn=Lt.sparse,Cn=wn.count,bn=iv({},Lt,wn.indices,{count:Cn,type:"SCALAR"}),Dn=iv({},Lt,wn.values,{count:Cn}),En=PI(bn,Gt),Tn=PI(Dn,Gt);for(let Un=0;Un<bn.count;Un++)for(let Pn=0;Pn<rn;Pn++)fn[En[Un]*rn+Pn]=Tn[Un*rn+Pn];return fn}(Ct,$):PI(Ct,$),xt.setArray(Bt),xt});const gt=h.images||[],yt=h.textures||[];g.getRoot().listExtensionsUsed().filter(Ct=>Ct.prereadTypes.includes($r.TEXTURE)).forEach(Ct=>Ct.preread($,$r.TEXTURE)),$.textures=gt.map(Ct=>{const xt=g.createTexture(Ct.name);if(Ct.extras&&xt.setExtras(Ct.extras),Ct.bufferView!==void 0){const Bt=h.bufferViews[Ct.bufferView],Lt=i.json.buffers[Bt.buffer],Gt=Bt.byteOffset||0,Xt=(Lt.uri?i.resources[Lt.uri]:i.resources["@glb.bin"]).slice(Gt,Gt+Bt.byteLength);xt.setImage(Xt)}else Ct.uri!==void 0&&(xt.setImage(i.resources[Ct.uri]),Ct.uri.indexOf("__")!==0&&xt.setURI(Ct.uri));if(Ct.mimeType!==void 0)xt.setMimeType(Ct.mimeType);else if(Ct.uri){const Bt=Kx.extension(Ct.uri);xt.setMimeType(iA.extensionToMimeType(Bt))}return xt}),$.materials=(h.materials||[]).map(Ct=>{const xt=g.createMaterial(Ct.name);Ct.extras&&xt.setExtras(Ct.extras),Ct.alphaMode!==void 0&&xt.setAlphaMode(Ct.alphaMode),Ct.alphaCutoff!==void 0&&xt.setAlphaCutoff(Ct.alphaCutoff),Ct.doubleSided!==void 0&&xt.setDoubleSided(Ct.doubleSided);const Bt=Ct.pbrMetallicRoughness||{};if(Bt.baseColorFactor!==void 0&&xt.setBaseColorFactor(Bt.baseColorFactor),Ct.emissiveFactor!==void 0&&xt.setEmissiveFactor(Ct.emissiveFactor),Bt.metallicFactor!==void 0&&xt.setMetallicFactor(Bt.metallicFactor),Bt.roughnessFactor!==void 0&&xt.setRoughnessFactor(Bt.roughnessFactor),Bt.baseColorTexture!==void 0){const Lt=Bt.baseColorTexture;xt.setBaseColorTexture($.textures[yt[Lt.index].source]),$.setTextureInfo(xt.getBaseColorTextureInfo(),Lt)}if(Ct.emissiveTexture!==void 0){const Lt=Ct.emissiveTexture;xt.setEmissiveTexture($.textures[yt[Lt.index].source]),$.setTextureInfo(xt.getEmissiveTextureInfo(),Lt)}if(Ct.normalTexture!==void 0){const Lt=Ct.normalTexture;xt.setNormalTexture($.textures[yt[Lt.index].source]),$.setTextureInfo(xt.getNormalTextureInfo(),Lt),Ct.normalTexture.scale!==void 0&&xt.setNormalScale(Ct.normalTexture.scale)}if(Ct.occlusionTexture!==void 0){const Lt=Ct.occlusionTexture;xt.setOcclusionTexture($.textures[yt[Lt.index].source]),$.setTextureInfo(xt.getOcclusionTextureInfo(),Lt),Ct.occlusionTexture.strength!==void 0&&xt.setOcclusionStrength(Ct.occlusionTexture.strength)}if(Bt.metallicRoughnessTexture!==void 0){const Lt=Bt.metallicRoughnessTexture;xt.setMetallicRoughnessTexture($.textures[yt[Lt.index].source]),$.setTextureInfo(xt.getMetallicRoughnessTextureInfo(),Lt)}return xt});const wt=h.meshes||[];g.getRoot().listExtensionsUsed().filter(Ct=>Ct.prereadTypes.includes($r.PRIMITIVE)).forEach(Ct=>Ct.preread($,$r.PRIMITIVE)),$.meshes=wt.map(Ct=>{const xt=g.createMesh(Ct.name);return Ct.extras&&xt.setExtras(Ct.extras),Ct.weights!==void 0&&xt.setWeights(Ct.weights),(Ct.primitives||[]).forEach(Bt=>{const Lt=g.createPrimitive();Bt.extras&&Lt.setExtras(Bt.extras),Bt.material!==void 0&&Lt.setMaterial($.materials[Bt.material]),Bt.mode!==void 0&&Lt.setMode(Bt.mode);for(const[Xt,rn]of Object.entries(Bt.attributes||{}))Lt.setAttribute(Xt,$.accessors[rn]);Bt.indices!==void 0&&Lt.setIndices($.accessors[Bt.indices]);const Gt=Ct.extras&&Ct.extras.targetNames||[];(Bt.targets||[]).forEach((Xt,rn)=>{const fn=Gt[rn]||rn.toString(),wn=g.createPrimitiveTarget(fn);for(const[Cn,bn]of Object.entries(Xt))wn.setAttribute(Cn,$.accessors[bn]);Lt.addTarget(wn)}),xt.addPrimitive(Lt)}),xt}),$.cameras=(h.cameras||[]).map(Ct=>{const xt=g.createCamera(Ct.name).setType(Ct.type);if(Ct.extras&&xt.setExtras(Ct.extras),Ct.type===$x.Type.PERSPECTIVE){const Bt=Ct.perspective;xt.setYFov(Bt.yfov),xt.setZNear(Bt.znear),Bt.zfar!==void 0&&xt.setZFar(Bt.zfar),Bt.aspectRatio!==void 0&&xt.setAspectRatio(Bt.aspectRatio)}else{const Bt=Ct.orthographic;xt.setZNear(Bt.znear).setZFar(Bt.zfar).setXMag(Bt.xmag).setYMag(Bt.ymag)}return xt});const It=h.nodes||[];g.getRoot().listExtensionsUsed().filter(Ct=>Ct.prereadTypes.includes($r.NODE)).forEach(Ct=>Ct.preread($,$r.NODE)),$.nodes=It.map(Ct=>{const xt=g.createNode(Ct.name);if(Ct.extras&&xt.setExtras(Ct.extras),Ct.translation!==void 0&&xt.setTranslation(Ct.translation),Ct.rotation!==void 0&&xt.setRotation(Ct.rotation),Ct.scale!==void 0&&xt.setScale(Ct.scale),Ct.matrix!==void 0){const Bt=[0,0,0],Lt=[0,0,0,1],Gt=[1,1,1];Su.decompose(Ct.matrix,Bt,Lt,Gt),xt.setTranslation(Bt),xt.setRotation(Lt),xt.setScale(Gt)}return Ct.weights!==void 0&&xt.setWeights(Ct.weights),xt}),$.skins=(h.skins||[]).map(Ct=>{const xt=g.createSkin(Ct.name);Ct.extras&&xt.setExtras(Ct.extras),Ct.inverseBindMatrices!==void 0&&xt.setInverseBindMatrices($.accessors[Ct.inverseBindMatrices]),Ct.skeleton!==void 0&&xt.setSkeleton($.nodes[Ct.skeleton]);for(const Bt of Ct.joints)xt.addJoint($.nodes[Bt]);return xt}),It.map((Ct,xt)=>{const Bt=$.nodes[xt];(Ct.children||[]).forEach(Lt=>Bt.addChild($.nodes[Lt])),Ct.mesh!==void 0&&Bt.setMesh($.meshes[Ct.mesh]),Ct.camera!==void 0&&Bt.setCamera($.cameras[Ct.camera]),Ct.skin!==void 0&&Bt.setSkin($.skins[Ct.skin])}),$.animations=(h.animations||[]).map(Ct=>{const xt=g.createAnimation(Ct.name);Ct.extras&&xt.setExtras(Ct.extras);const Bt=(Ct.samplers||[]).map(Lt=>{const Gt=g.createAnimationSampler().setInput($.accessors[Lt.input]).setOutput($.accessors[Lt.output]).setInterpolation(Lt.interpolation||$E.Interpolation.LINEAR);return Lt.extras&&Gt.setExtras(Lt.extras),xt.addSampler(Gt),Gt});return(Ct.channels||[]).forEach(Lt=>{const Gt=g.createAnimationChannel().setSampler(Bt[Lt.sampler]).setTargetPath(Lt.target.path);Lt.target.node!==void 0&&Gt.setTargetNode($.nodes[Lt.target.node]),Lt.extras&&Gt.setExtras(Lt.extras),xt.addChannel(Gt)}),xt});const Et=h.scenes||[];return g.getRoot().listExtensionsUsed().filter(Ct=>Ct.prereadTypes.includes($r.SCENE)).forEach(Ct=>Ct.preread($,$r.SCENE)),$.scenes=Et.map(Ct=>{const xt=g.createScene(Ct.name);return Ct.extras&&xt.setExtras(Ct.extras),(Ct.nodes||[]).map(Bt=>$.nodes[Bt]).forEach(Bt=>xt.addChild(Bt)),xt}),h.scene!==void 0&&g.getRoot().setDefaultScene($.scenes[h.scene]),g.getRoot().listExtensionsUsed().forEach(Ct=>Ct.read($)),g}static validate(i,s){const a=i.json;if(a.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${a.asset.version}".`);if(a.extensionsRequired){for(const h of a.extensionsRequired)if(!s.extensions.find(g=>g.EXTENSION_NAME===h))throw new Error(`Missing required extension, "${h}".`)}if(a.extensionsUsed)for(const h of a.extensionsUsed)s.extensions.find(g=>g.EXTENSION_NAME===h)||s.logger.warn(`Missing optional extension, "${h}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const i=this._(zo.assertView(e));this.L(i);const s=i.json;if(s.buffers&&s.buffers.some(a=>function(h,g){return g.uri!==void 0&&!(g.uri in h.resources)}(i,a)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(a=>function(h,g){return g.uri!==void 0&&!(g.uri in h.resources)&&g.bufferView===void 0}(i,a)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(zo.assertView(e)))}async writeJSON(e,i={}){if(i.format===m_.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return class{static write(s,a){const h=s.getRoot(),g={asset:iv({generator:"glTF-Transform v2.2.3"},h.getAsset()),extras:iv({},h.getExtras())},$={json:g,resources:{}},nt=new g_(s,$,a),rt=a.logger||Bv.DEFAULT_INSTANCE,st=new Set(a.extensions.map(Et=>Et.EXTENSION_NAME)),ut=s.getRoot().listExtensionsUsed().filter(Et=>st.has(Et.extensionName)),mt=s.getRoot().listExtensionsRequired().filter(Et=>st.has(Et.extensionName));ut.length<s.getRoot().listExtensionsUsed().length&&rt.debug("Some extensions were not registered for I/O, and will not be written.");for(const Et of ut)for(const Ct of Et.writeDependencies)Et.install(Ct,a.dependencies[Ct]);function gt(Et,Ct,xt,Bt){const Lt=[];let Gt=0;for(const rn of Et){const fn=nt.createAccessorDef(rn);fn.bufferView=g.bufferViews.length;const wn=rn.getArray(),Cn=zo.pad(zo.toView(wn));fn.byteOffset=Gt,Gt+=Cn.byteLength,Lt.push(Cn),nt.accessorIndexMap.set(rn,g.accessors.length),g.accessors.push(fn)}const Xt={buffer:Ct,byteOffset:xt,byteLength:zo.concat(Lt).byteLength};return Bt&&(Xt.target=Bt),g.bufferViews.push(Xt),{buffers:Lt,byteLength:Gt}}function yt(Et,Ct,xt){const Bt=Et[0].getCount();let Lt=0;for(const fn of Et){const wn=nt.createAccessorDef(fn);wn.bufferView=g.bufferViews.length,wn.byteOffset=Lt;const Cn=fn.getElementSize(),bn=fn.getComponentSize();Lt+=zo.padNumber(Cn*bn),nt.accessorIndexMap.set(fn,g.accessors.length),g.accessors.push(wn)}const Gt=Bt*Lt,Xt=new ArrayBuffer(Gt),rn=new DataView(Xt);for(let fn=0;fn<Bt;fn++){let wn=0;for(const Cn of Et){const bn=Cn.getElementSize(),Dn=Cn.getComponentSize(),En=Cn.getComponentType(),Tn=Cn.getArray();for(let Un=0;Un<bn;Un++){const Pn=fn*Lt+wn+Un*Dn,Yn=Tn[fn*bn+Un];switch(En){case vs.ComponentType.FLOAT:rn.setFloat32(Pn,Yn,!0);break;case vs.ComponentType.BYTE:rn.setInt8(Pn,Yn);break;case vs.ComponentType.SHORT:rn.setInt16(Pn,Yn,!0);break;case vs.ComponentType.UNSIGNED_BYTE:rn.setUint8(Pn,Yn);break;case vs.ComponentType.UNSIGNED_SHORT:rn.setUint16(Pn,Yn,!0);break;case vs.ComponentType.UNSIGNED_INT:rn.setUint32(Pn,Yn,!0);break;default:throw new Error("Unexpected component type: "+En)}}wn+=zo.padNumber(bn*Dn)}}return g.bufferViews.push({buffer:Ct,byteOffset:xt,byteLength:Gt,byteStride:Lt,target:g_.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Gt,buffers:[new Uint8Array(Xt)]}}const wt=new Map;for(const Et of s.getGraph().listEdges()){if(Et.getParent()===h)continue;const Ct=Et.getChild();if(Ct instanceof vs){const xt=wt.get(Ct)||[];xt.push(Et),wt.set(Ct,xt)}}if(g.accessors=[],g.bufferViews=[],g.samplers=[],g.textures=[],g.images=h.listTextures().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et);Et.getMimeType()&&(xt.mimeType=Et.getMimeType());const Bt=Et.getImage();return Bt&&nt.createImageData(xt,Bt,Et),nt.imageIndexMap.set(Et,Ct),xt}),ut.filter(Et=>Et.prewriteTypes.includes($r.ACCESSOR)).forEach(Et=>Et.prewrite(nt,$r.ACCESSOR)),h.listAccessors().forEach(Et=>{const Ct=nt.accessorUsageGroupedByParent,xt=nt.accessorParents;if(nt.accessorIndexMap.has(Et))return;const Bt=wt.get(Et)||[],Lt=nt.getAccessorUsage(Et);if(nt.addAccessorToUsageGroup(Et,Lt),Ct.has(Lt)){const Gt=Bt[0].getParent(),Xt=xt.get(Gt)||new Set;Xt.add(Et),xt.set(Gt,Xt)}}),ut.filter(Et=>Et.prewriteTypes.includes($r.BUFFER)).forEach(Et=>Et.prewrite(nt,$r.BUFFER)),(h.listAccessors().length>0||h.listTextures().length>0||nt.otherBufferViews.size>0)&&h.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");g.buffers=[],h.listBuffers().forEach((Et,Ct)=>{const xt=nt.createPropertyDef(Et),Bt=nt.accessorUsageGroupedByParent,Lt=nt.accessorParents,Gt=Et.listParents().filter(bn=>bn instanceof vs),Xt=new Set(Gt),rn=[],fn=g.buffers.length;let wn=0;const Cn=nt.listAccessorUsageGroups();for(const bn in Cn)if(Bt.has(bn))for(const Dn of Array.from(Lt.values())){const En=Array.from(Dn).filter(Tn=>Xt.has(Tn)).filter(Tn=>nt.getAccessorUsage(Tn)===bn);if(En.length)if(bn!==QP.ARRAY_BUFFER||a.vertexLayout===bI.INTERLEAVED){const Tn=bn===QP.ARRAY_BUFFER?yt(En,fn,wn):gt(En,fn,wn);wn+=Tn.byteLength,rn.push(...Tn.buffers)}else for(const Tn of En){const Un=yt([Tn],fn,wn);wn+=Un.byteLength,rn.push(...Un.buffers)}}else{const Dn=Cn[bn].filter(Tn=>Xt.has(Tn));if(!Dn.length)continue;const En=gt(Dn,fn,wn,bn===QP.ELEMENT_ARRAY_BUFFER?g_.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);wn+=En.byteLength,rn.push(...En.buffers)}if(nt.imageBufferViews.length&&Ct===0){for(let bn=0;bn<nt.imageBufferViews.length;bn++)if(g.bufferViews[g.images[bn].bufferView].byteOffset=wn,wn+=nt.imageBufferViews[bn].byteLength,rn.push(nt.imageBufferViews[bn]),wn%8){const Dn=8-wn%8;wn+=Dn,rn.push(new Uint8Array(Dn))}}if(nt.otherBufferViews.has(Et))for(const bn of nt.otherBufferViews.get(Et))g.bufferViews.push({buffer:fn,byteOffset:wn,byteLength:bn.byteLength}),nt.otherBufferViewsIndexMap.set(bn,g.bufferViews.length-1),wn+=bn.byteLength,rn.push(bn);if(wn){let bn;a.format===m_.GLB?bn="@glb.bin":(bn=nt.bufferURIGenerator.createURI(Et,"bin"),xt.uri=bn),xt.byteLength=wn,$.resources[bn]=zo.concat(rn)}g.buffers.push(xt),nt.bufferIndexMap.set(Et,Ct)}),h.listAccessors().find(Et=>!Et.getBuffer())&&rt.warn("Skipped writing one or more Accessors: no Buffer assigned."),g.materials=h.listMaterials().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et);if(Et.getAlphaMode()!==Jx.AlphaMode.OPAQUE&&(xt.alphaMode=Et.getAlphaMode()),Et.getAlphaMode()===Jx.AlphaMode.MASK&&(xt.alphaCutoff=Et.getAlphaCutoff()),Et.getDoubleSided()&&(xt.doubleSided=!0),xt.pbrMetallicRoughness={},Su.eq(Et.getBaseColorFactor(),[1,1,1,1])||(xt.pbrMetallicRoughness.baseColorFactor=Et.getBaseColorFactor()),Su.eq(Et.getEmissiveFactor(),[0,0,0])||(xt.emissiveFactor=Et.getEmissiveFactor()),Et.getRoughnessFactor()!==1&&(xt.pbrMetallicRoughness.roughnessFactor=Et.getRoughnessFactor()),Et.getMetallicFactor()!==1&&(xt.pbrMetallicRoughness.metallicFactor=Et.getMetallicFactor()),Et.getBaseColorTexture()){const Bt=Et.getBaseColorTexture(),Lt=Et.getBaseColorTextureInfo();xt.pbrMetallicRoughness.baseColorTexture=nt.createTextureInfoDef(Bt,Lt)}if(Et.getEmissiveTexture()){const Bt=Et.getEmissiveTexture(),Lt=Et.getEmissiveTextureInfo();xt.emissiveTexture=nt.createTextureInfoDef(Bt,Lt)}if(Et.getNormalTexture()){const Bt=Et.getNormalTexture(),Lt=Et.getNormalTextureInfo(),Gt=nt.createTextureInfoDef(Bt,Lt);Et.getNormalScale()!==1&&(Gt.scale=Et.getNormalScale()),xt.normalTexture=Gt}if(Et.getOcclusionTexture()){const Bt=Et.getOcclusionTexture(),Lt=Et.getOcclusionTextureInfo(),Gt=nt.createTextureInfoDef(Bt,Lt);Et.getOcclusionStrength()!==1&&(Gt.strength=Et.getOcclusionStrength()),xt.occlusionTexture=Gt}if(Et.getMetallicRoughnessTexture()){const Bt=Et.getMetallicRoughnessTexture(),Lt=Et.getMetallicRoughnessTextureInfo();xt.pbrMetallicRoughness.metallicRoughnessTexture=nt.createTextureInfoDef(Bt,Lt)}return nt.materialIndexMap.set(Et,Ct),xt}),g.meshes=h.listMeshes().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et);let Bt=null;return xt.primitives=Et.listPrimitives().map(Lt=>{const Gt={attributes:{}};Gt.mode=Lt.getMode();const Xt=Lt.getMaterial();Xt&&(Gt.material=nt.materialIndexMap.get(Xt)),Object.keys(Lt.getExtras()).length&&(Gt.extras=Lt.getExtras());const rn=Lt.getIndices();rn&&(Gt.indices=nt.accessorIndexMap.get(rn));for(const fn of Lt.listSemantics())Gt.attributes[fn]=nt.accessorIndexMap.get(Lt.getAttribute(fn));for(const fn of Lt.listTargets()){const wn={};for(const Cn of fn.listSemantics())wn[Cn]=nt.accessorIndexMap.get(fn.getAttribute(Cn));Gt.targets=Gt.targets||[],Gt.targets.push(wn)}return Lt.listTargets().length&&!Bt&&(Bt=Lt.listTargets().map(fn=>fn.getName())),Gt}),Et.getWeights().length&&(xt.weights=Et.getWeights()),Bt&&(xt.extras=xt.extras||{},xt.extras.targetNames=Bt),nt.meshIndexMap.set(Et,Ct),xt}),g.cameras=h.listCameras().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et);if(xt.type=Et.getType(),xt.type===$x.Type.PERSPECTIVE){xt.perspective={znear:Et.getZNear(),zfar:Et.getZFar(),yfov:Et.getYFov()};const Bt=Et.getAspectRatio();Bt!==null&&(xt.perspective.aspectRatio=Bt)}else xt.orthographic={znear:Et.getZNear(),zfar:Et.getZFar(),xmag:Et.getXMag(),ymag:Et.getYMag()};return nt.cameraIndexMap.set(Et,Ct),xt}),g.nodes=h.listNodes().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et);return Su.eq(Et.getTranslation(),[0,0,0])||(xt.translation=Et.getTranslation()),Su.eq(Et.getRotation(),[0,0,0,1])||(xt.rotation=Et.getRotation()),Su.eq(Et.getScale(),[1,1,1])||(xt.scale=Et.getScale()),Et.getWeights().length&&(xt.weights=Et.getWeights()),nt.nodeIndexMap.set(Et,Ct),xt}),g.skins=h.listSkins().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et),Bt=Et.getInverseBindMatrices();Bt&&(xt.inverseBindMatrices=nt.accessorIndexMap.get(Bt));const Lt=Et.getSkeleton();return Lt&&(xt.skeleton=nt.nodeIndexMap.get(Lt)),xt.joints=Et.listJoints().map(Gt=>nt.nodeIndexMap.get(Gt)),nt.skinIndexMap.set(Et,Ct),xt}),h.listNodes().forEach((Et,Ct)=>{const xt=g.nodes[Ct],Bt=Et.getMesh();Bt&&(xt.mesh=nt.meshIndexMap.get(Bt));const Lt=Et.getCamera();Lt&&(xt.camera=nt.cameraIndexMap.get(Lt));const Gt=Et.getSkin();Gt&&(xt.skin=nt.skinIndexMap.get(Gt)),Et.listChildren().length>0&&(xt.children=Et.listChildren().map(Xt=>nt.nodeIndexMap.get(Xt)))}),g.animations=h.listAnimations().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et),Bt=new Map;return xt.samplers=Et.listSamplers().map((Lt,Gt)=>{const Xt=nt.createPropertyDef(Lt);return Xt.input=nt.accessorIndexMap.get(Lt.getInput()),Xt.output=nt.accessorIndexMap.get(Lt.getOutput()),Xt.interpolation=Lt.getInterpolation(),Bt.set(Lt,Gt),Xt}),xt.channels=Et.listChannels().map(Lt=>{const Gt=nt.createPropertyDef(Lt);return Gt.sampler=Bt.get(Lt.getSampler()),Gt.target={node:nt.nodeIndexMap.get(Lt.getTargetNode()),path:Lt.getTargetPath()},Gt}),nt.animationIndexMap.set(Et,Ct),xt}),g.scenes=h.listScenes().map((Et,Ct)=>{const xt=nt.createPropertyDef(Et);return xt.nodes=Et.listChildren().map(Bt=>nt.nodeIndexMap.get(Bt)),nt.sceneIndexMap.set(Et,Ct),xt});const It=h.getDefaultScene();return It&&(g.scene=h.listScenes().indexOf(It)),g.extensionsUsed=ut.map(Et=>Et.extensionName),g.extensionsRequired=mt.map(Et=>Et.extensionName),ut.forEach(Et=>Et.write(nt)),function(Et){const Ct=[];for(const xt in Et){const Bt=Et[xt];(Array.isArray(Bt)&&Bt.length===0||Bt===null||Bt===""||Bt&&typeof Bt=="object"&&Object.keys(Bt).length===0)&&Ct.push(xt)}for(const xt of Ct)delete Et[xt]}(g),$}}.write(e,{format:i.format||m_.GLTF,basename:i.basename||"",logger:this.v,vertexLayout:this.F,dependencies:iv({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:m_.GLB}),a=new Uint32Array([1179937895,2,12]),h=JSON.stringify(i),g=zo.pad(zo.encodeText(h),32),$=zo.toView(new Uint32Array([g.byteLength,1313821514])),nt=zo.concat([$,g]);a[a.length-1]+=nt.byteLength;const rt=Object.values(s)[0];if(!rt||!rt.byteLength)return zo.concat([zo.toView(a),nt]);const st=zo.pad(rt,0),ut=zo.toView(new Uint32Array([st.byteLength,5130562])),mt=zo.concat([ut,st]);return a[a.length-1]+=mt.byteLength,zo.concat([zo.toView(a),nt,mt])}detectFormat(e){return(vw.isAbsoluteURL(e)?vw.extension(e):Kx.extension(e))==="glb"?m_.GLB:m_.GLTF}async P(e){this.lastReadBytes=0;const i=await this.readURI(e,"text");this.lastReadBytes+=i.length;const s={json:JSON.parse(i),resources:{}};return await this.D(s,this.dirname(e)),this.L(s),s}async U(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=this._(i);return await this.D(s,this.dirname(e)),this.L(s),s}async D(e,i){var s=this;const a=[...e.json.images||[],...e.json.buffers||[]].map(async function(h){const g=h.uri;if(!g||g.match(/data:/))return Promise.resolve();e.resources[g]=await s.readURI(s.resolve(i,g),"view"),s.lastReadBytes+=e.resources[g].byteLength});await Promise.all(a)}L(e){function i(s){if(s.uri){if(s.uri in e.resources)zo.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const a=`__${function(){for(let h=0;h<999;h++){const g=_L();if(!MR.has(g))return MR.add(g),g}return""}()}.${Kx.extension(s.uri)}`;e.resources[a]=zo.createBufferFromDataURI(s.uri),s.uri=a}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}j(e){const{images:i,buffers:s}=e.json;return e={json:iv({},e.json),resources:iv({},e.resources)},i&&(e.json.images=i.map(a=>iv({},a))),s&&(e.json.buffers=s.map(a=>iv({},a))),e}_(e){const i=new Uint32Array(e.buffer,e.byteOffset,3);if(i[0]!==1179937895)throw new Error("Invalid glTF asset.");if(i[1]!==2)throw new Error(`Unsupported glTF binary version, "${i[1]}".`);const s=new Uint32Array(e.buffer,e.byteOffset+12,2);if(s[1]!==DI.JSON)throw new Error("Missing required GLB JSON chunk.");const a=s[0],h=zo.decodeText(zo.toView(e,20,a)),g=JSON.parse(h),$=20+a;if(e.byteLength<=$)return{json:g,resources:{}};const nt=new Uint32Array(e.buffer,e.byteOffset+$,2);if(nt[1]!==DI.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:g,resources:{"@glb.bin":zo.toView(e,$+8,nt[0])}}}}{constructor(e=vw.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,i){const s=await fetch(e,this.V);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return vw.resolve(e,i)}dirname(e){return vw.dirname(e)}detectFormat(e){return vw.extension(e)==="glb"?m_.GLB:m_.GLTF}}class EL{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class iM{constructor(e,i,s,a){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const Dm=[171,75,84,88,32,50,48,187,13,10,26,10];function NR(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}function GP(c){const e=new Uint8Array(c.buffer,c.byteOffset,Dm.length);if(e[0]!==Dm[0]||e[1]!==Dm[1]||e[2]!==Dm[2]||e[3]!==Dm[3]||e[4]!==Dm[4]||e[5]!==Dm[5]||e[6]!==Dm[6]||e[7]!==Dm[7]||e[8]!==Dm[8]||e[9]!==Dm[9]||e[10]!==Dm[10]||e[11]!==Dm[11])throw new Error("Missing KTX 2.0 identifier.");const i=new EL,s=17*Uint32Array.BYTES_PER_ELEMENT,a=new iM(c,Dm.length,s,!0);i.vkFormat=a._nextUint32(),i.typeSize=a._nextUint32(),i.pixelWidth=a._nextUint32(),i.pixelHeight=a._nextUint32(),i.pixelDepth=a._nextUint32(),i.layerCount=a._nextUint32(),i.faceCount=a._nextUint32();const h=a._nextUint32();i.supercompressionScheme=a._nextUint32();const g=a._nextUint32(),$=a._nextUint32(),nt=a._nextUint32(),rt=a._nextUint32(),st=a._nextUint64(),ut=a._nextUint64(),mt=new iM(c,Dm.length+s,3*h*8,!0);for(let Pn=0;Pn<h;Pn++)i.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+mt._nextUint64(),mt._nextUint64()),uncompressedByteLength:mt._nextUint64()});const gt=new iM(c,g,$,!0),yt={vendorId:gt._skip(4)._nextUint16(),descriptorType:gt._nextUint16(),versionNumber:gt._nextUint16(),descriptorBlockSize:gt._nextUint16(),colorModel:gt._nextUint8(),colorPrimaries:gt._nextUint8(),transferFunction:gt._nextUint8(),flags:gt._nextUint8(),texelBlockDimension:[gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8()],bytesPlane:[gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8()],samples:[]},wt=(yt.descriptorBlockSize/4-6)/4;for(let Pn=0;Pn<wt;Pn++){const Yn={bitOffset:gt._nextUint16(),bitLength:gt._nextUint8(),channelType:gt._nextUint8(),samplePosition:[gt._nextUint8(),gt._nextUint8(),gt._nextUint8(),gt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Yn.channelType?(Yn.sampleLower=gt._nextInt32(),Yn.sampleUpper=gt._nextInt32()):(Yn.sampleLower=gt._nextUint32(),Yn.sampleUpper=gt._nextUint32()),yt.samples[Pn]=Yn}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(yt);const It=new iM(c,nt,rt,!0);for(;It._offset<rt;){const Pn=It._nextUint32(),Yn=It._scan(Pn),cr=NR(Yn),mr=It._scan(Pn-Yn.byteLength);i.keyValue[cr]=cr.match(/^ktx/i)?NR(mr):mr,It._offset%4&&It._skip(4-It._offset%4)}if(ut<=0)return i;const Et=new iM(c,st,ut,!0),Ct=Et._nextUint16(),xt=Et._nextUint16(),Bt=Et._nextUint32(),Lt=Et._nextUint32(),Gt=Et._nextUint32(),Xt=Et._nextUint32(),rn=[];for(let Pn=0;Pn<h;Pn++)rn.push({imageFlags:Et._nextUint32(),rgbSliceByteOffset:Et._nextUint32(),rgbSliceByteLength:Et._nextUint32(),alphaSliceByteOffset:Et._nextUint32(),alphaSliceByteLength:Et._nextUint32()});const fn=st+Et._offset,wn=fn+Bt,Cn=wn+Lt,bn=Cn+Gt,Dn=new Uint8Array(c.buffer,c.byteOffset+fn,Bt),En=new Uint8Array(c.buffer,c.byteOffset+wn,Lt),Tn=new Uint8Array(c.buffer,c.byteOffset+Cn,Gt),Un=new Uint8Array(c.buffer,c.byteOffset+bn,Xt);return i.globalData={endpointCount:Ct,selectorCount:xt,imageDescs:rn,endpointsData:Dn,selectorsData:En,tablesData:Tn,extendedData:Un},i}class FR extends zu{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[$r.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}FR.EXTENSION_NAME="EXT_mesh_gpu_instancing";const _b="EXT_mesh_gpu_instancing";function _w(){return(_w=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}var sM,JE,Vu;(class extends _u{constructor(...c){super(...c),this.extensionName=_b,this.provideTypes=[$r.NODE],this.prewriteTypes=[$r.ACCESSOR]}createInstancedMesh(){return new FR(this.document.getGraph())}read(c){return(c.jsonDoc.json.nodes||[]).forEach((e,i)=>{if(!e.extensions||!e.extensions[_b])return;const s=e.extensions[_b],a=this.createInstancedMesh();for(const h in s.attributes)a.setAttribute(h,c.accessors[s.attributes[h]]);c.nodes[i].setExtension(_b,a)}),this}prewrite(c){c.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const i of e.listAttributes())c.addAccessorToUsageGroup(i,"INSTANCE_ATTRIBUTE");return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listNodes().forEach(i=>{const s=i.getExtension(_b);if(s){const a=c.nodeIndexMap.get(i),h=e.json.nodes[a],g={attributes:{}};s.listSemantics().forEach($=>{const nt=s.getAttribute($);g.attributes[$]=c.accessorIndexMap.get(nt)}),h.extensions=h.extensions||{},h.extensions[_b]=g}}),this}}).EXTENSION_NAME=_b,function(c){c.QUANTIZE="quantize",c.FILTER="filter"}(sM||(sM={})),function(c){c.ATTRIBUTES="ATTRIBUTES",c.TRIANGLES="TRIANGLES",c.INDICES="INDICES"}(JE||(JE={})),function(c){c.NONE="NONE",c.OCTAHEDRAL="OCTAHEDRAL",c.QUATERNION="QUATERNION",c.EXPONENTIAL="EXPONENTIAL"}(Vu||(Vu={}));const{BYTE:SL,SHORT:UR,FLOAT:CL}=vs.ComponentType,{normalize:jR,denormalize:HP}=Su;function ML(c,e,i,s){const{filter:a,bits:h}=s,g={array:c.getArray(),byteStride:c.getElementSize()*c.getComponentSize(),componentType:c.getComponentType(),normalized:c.getNormalized()};if(i!==JE.ATTRIBUTES)return g;if(a!==Vu.NONE){let $=c.getNormalized()?function(nt){const rt=nt.getComponentType(),st=nt.getArray(),ut=new Float32Array(st.length);for(let mt=0;mt<st.length;mt++)ut[mt]=HP(st[mt],rt);return ut}(c):new Float32Array(g.array);switch(a){case Vu.EXPONENTIAL:g.byteStride=4*c.getElementSize(),g.componentType=CL,g.normalized=!1,g.array=e.encodeFilterExp($,c.getCount(),g.byteStride,h);break;case Vu.OCTAHEDRAL:g.byteStride=h>8?8:4,g.componentType=h>8?UR:SL,g.normalized=!0,$=c.getElementSize()===3?function(nt){const rt=new Float32Array(4*nt.length/3);for(let st=0,ut=nt.length/3;st<ut;st++)rt[4*st]=nt[3*st],rt[4*st+1]=nt[3*st+1],rt[4*st+2]=nt[3*st+2];return rt}($):$,g.array=e.encodeFilterOct($,c.getCount(),g.byteStride,h);break;case Vu.QUATERNION:g.byteStride=8,g.componentType=UR,g.normalized=!0,g.array=e.encodeFilterQuat($,c.getCount(),g.byteStride,h);break;default:throw new Error("Invalid filter.")}g.min=c.getMin([]),g.max=c.getMax([]),c.getNormalized()&&(g.min=g.min.map(nt=>HP(nt,c.getComponentType())),g.max=g.max.map(nt=>HP(nt,c.getComponentType()))),g.normalized&&(g.min=g.min.map(nt=>jR(nt,g.componentType)),g.max=g.max.map(nt=>jR(nt,g.componentType)))}else g.byteStride%4&&(g.array=function($,nt){const rt=zo.padNumber($.BYTES_PER_ELEMENT*nt)/$.BYTES_PER_ELEMENT,st=new $.constructor($.length/nt*rt);for(let ut=0;ut*nt<$.length;ut++)for(let mt=0;mt<nt;mt++)st[ut*rt+mt]=$[ut*nt+mt];return st}(g.array,c.getElementSize()),g.byteStride=g.array.byteLength/c.getCount());return g}function TL(c,e){return e===g_.BufferViewUsage.ELEMENT_ARRAY_BUFFER?c.listParents().some(i=>i instanceof Zx&&i.getMode()===Zx.Mode.TRIANGLES)?JE.TRIANGLES:JE.INDICES:JE.ATTRIBUTES}function IL(c,e){const i=e.getGraph().listParentEdges(c).filter(s=>!(s.getParent()instanceof BR));for(const s of i){const a=s.getName(),h=s.getAttributes().key||"";if(a==="indices")return{filter:Vu.NONE};if(a==="attributes"){if(h==="POSITION")return{filter:Vu.NONE};if(h==="TEXCOORD_0")return{filter:Vu.NONE};if(h==="NORMAL")return{filter:Vu.OCTAHEDRAL,bits:8};if(h==="TANGENT")return{filter:Vu.OCTAHEDRAL,bits:8};if(h.startsWith("JOINTS_"))return{filter:Vu.NONE};if(h.startsWith("WEIGHTS_"))return{filter:Vu.NONE}}if(a==="output"){const g=zR(c);return g==="rotation"?{filter:Vu.QUATERNION,bits:16}:g==="translation"||g==="scale"?{filter:Vu.EXPONENTIAL,bits:12}:{filter:Vu.NONE}}if(a==="input")return{filter:Vu.NONE};if(a==="inverseBindMatrices")return{filter:Vu.NONE}}return{filter:Vu.NONE}}function zR(c){for(const e of c.listParents())if(e instanceof $E){for(const i of e.listParents())if(i instanceof jP)return i.getTargetPath()}return null}const Rm="EXT_meshopt_compression",VR={method:sM.QUANTIZE};class QR extends _u{constructor(...e){super(...e),this.extensionName=Rm,this.prereadTypes=[$r.BUFFER,$r.PRIMITIVE],this.prewriteTypes=[$r.BUFFER,$r.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=VR,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=_w({},VR,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Rm}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Rm}]: Missing WASM support.`)}return i===$r.BUFFER?this._prereadBuffers(e):i===$r.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[Rm])return;const h=s.extensions[Rm],g=h.byteOffset||0,$=h.byteLength||0,nt=h.count,rt=h.byteStride,st=new Uint8Array(nt*rt),ut=i.json.buffers[s.buffer],mt=zo.toView(ut.uri?i.resources[ut.uri]:i.resources["@glb.bin"],g,$);this._decoder.decodeGltfBuffer(st,nt,rt,mt,h.mode,h.filter),e.bufferViews[a]=st})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var a;s.extensions&&s.extensions[Rm]&&(a=i.json.buffers[s.buffer]).extensions&&a.extensions.EXT_meshopt_compression&&a.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[Rm].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const a of i.listParents())a instanceof vs&&a.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===$r.ACCESSOR?this._prewriteAccessors(e):i===$r.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,a=this._encoderOptions,h=this.document.createBuffer(),g=this.document.getRoot().listBuffers().indexOf(h);this._encoderFallbackBuffer=h,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const $ of this.document.getRoot().listAccessors()){if(zR($)==="weights")continue;const nt=e.getAccessorUsage($),rt=TL($,nt),st=a.method===sM.FILTER?IL($,this.document):{filter:Vu.NONE},ut=ML($,s,rt,st),{array:mt,byteStride:gt}=ut,yt=$.getBuffer();if(!yt)throw new Error(`${Rm}: Missing buffer for accessor.`);const wt=this.document.getRoot().listBuffers().indexOf(yt),It=[nt,rt,st.filter,gt,wt].join(":");let Et=this._encoderBufferViews[It],Ct=this._encoderBufferViewData[It],xt=this._encoderBufferViewAccessors[It];Et&&Ct||(xt=this._encoderBufferViewAccessors[It]=[],Ct=this._encoderBufferViewData[It]=[],Et=this._encoderBufferViews[It]={buffer:g,target:g_.USAGE_TO_TARGET[nt],byteOffset:0,byteLength:0,byteStride:nt===g_.BufferViewUsage.ARRAY_BUFFER?gt:void 0,extensions:{[Rm]:{buffer:wt,byteOffset:0,byteLength:0,mode:rt,filter:st.filter!==Vu.NONE?st.filter:void 0,byteStride:gt,count:0}}});const Bt=e.createAccessorDef($);Bt.componentType=ut.componentType,Bt.normalized=ut.normalized,Bt.byteOffset=Et.byteLength,Bt.min&&ut.min&&(Bt.min=ut.min),Bt.max&&ut.max&&(Bt.max=ut.max),e.accessorIndexMap.set($,i.accessors.length),i.accessors.push(Bt),xt.push(Bt),Ct.push(new Uint8Array(mt.buffer,mt.byteOffset,mt.byteLength)),Et.byteLength+=mt.byteLength,Et.extensions.EXT_meshopt_compression.count+=$.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],h=this._encoderBufferViewData[s],g=this.document.getRoot().listBuffers()[a.extensions[Rm].buffer],$=e.otherBufferViews.get(g)||[],{count:nt,byteStride:rt,mode:st}=a.extensions[Rm],ut=zo.concat(h),mt=i.encodeGltfBuffer(ut,nt,rt,st),gt=zo.pad(mt);a.extensions[Rm].byteLength=mt.byteLength,h.length=0,h.push(gt),$.push(gt),e.otherBufferViews.set(g,$)}}write(e){let i=0;for(const g in this._encoderBufferViews){const $=this._encoderBufferViews[g],nt=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[g][0]),rt=this._encoderBufferViewAccessors[g];for(const mt of rt)mt.bufferView=nt;const st=e.jsonDoc.json.bufferViews[nt],ut=st.byteOffset||0;Object.assign(st,$),st.byteOffset=i,st.extensions[Rm].byteOffset=ut,i+=zo.padNumber($.byteLength)}const s=this._encoderFallbackBuffer,a=e.bufferIndexMap.get(s),h=e.jsonDoc.json.buffers[a];return h.byteLength=i,h.extensions={[Rm]:{fallback:!0}},s.dispose(),this}}QR.EXTENSION_NAME=Rm,QR.EncoderMethod=sM;const GR="EXT_texture_webp";class PL{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=zo.decodeText(e.slice(0,4)),s=zo.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const a=new DataView(e.buffer,e.byteOffset);let h=12;for(;h<a.byteLength;){const g=zo.decodeText(new Uint8Array([a.getUint8(h),a.getUint8(h+1),a.getUint8(h+2),a.getUint8(h+3)])),$=a.getUint32(h+4,!0);if(g==="VP8 ")return[16383&a.getInt16(h+14,!0),16383&a.getInt16(h+16,!0)];if(g==="VP8L"){const nt=a.getUint8(h+9),rt=a.getUint8(h+10),st=a.getUint8(h+11);return[1+((63&rt)<<8|nt),1+((15&a.getUint8(h+12))<<10|st<<2|(192&rt)>>6)]}h+=8+$+$%2}return null}getChannels(e){return 4}}(class extends _u{constructor(...c){super(...c),this.extensionName=GR,this.prereadTypes=[$r.TEXTURE]}static register(){iA.registerFormat("image/webp",new PL)}preread(c){return(c.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(c){return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/webp"){const s=c.imageIndexMap.get(i);(e.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions.EXT_texture_webp={source:a.source},delete a.source)})}}),this}}).EXTENSION_NAME=GR;const HR="KHR_draco_mesh_compression";let pp,WR,qR,sv;function DL(c,e){const i=new pp.DecoderBuffer;try{if(i.Init(e,e.length),c.GetEncodedGeometryType(i)!==pp.TRIANGULAR_MESH)throw new Error(`[${HR}] Unknown geometry type.`);const s=new pp.Mesh;if(!c.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${HR}] Decoding failure.`);return s}finally{pp.destroy(i)}}function RL(c,e){const i=3*e.num_faces();let s,a;if(e.num_points()<=65534){const h=i*Uint16Array.BYTES_PER_ELEMENT;s=pp._malloc(h),c.GetTrianglesUInt16Array(e,h,s),a=new Uint16Array(pp.HEAPU16.buffer,s,i).slice()}else{const h=i*Uint32Array.BYTES_PER_ELEMENT;s=pp._malloc(h),c.GetTrianglesUInt32Array(e,h,s),a=new Uint32Array(pp.HEAPU32.buffer,s,i).slice()}return pp._free(s),a}function kL(c,e,i,s){const a=qR[s.componentType],h=WR[s.componentType],g=i.num_components(),$=e.num_points()*g,nt=$*h.BYTES_PER_ELEMENT,rt=pp._malloc(nt);c.GetAttributeDataArrayForAllPoints(e,i,a,nt,rt);const st=new h(pp.HEAPF32.buffer,rt,$).slice();return pp._free(rt),st}var oM,v_;(function(c){c[c.EDGEBREAKER=1]="EDGEBREAKER",c[c.SEQUENTIAL=0]="SEQUENTIAL"})(oM||(oM={})),function(c){c.POSITION="POSITION",c.NORMAL="NORMAL",c.COLOR="COLOR",c.TEX_COORD="TEX_COORD",c.GENERIC="GENERIC"}(v_||(v_={}));const YR={[v_.POSITION]:14,[v_.NORMAL]:10,[v_.COLOR]:8,[v_.TEX_COORD]:12,[v_.GENERIC]:12},XR={decodeSpeed:5,encodeSpeed:5,method:oM.EDGEBREAKER,quantizationBits:YR,quantizationVolume:"mesh"};function BL(c,e=XR){const i=_w({},XR,e);i.quantizationBits=_w({},YR,e.quantizationBits);const s=new sv.Encoder,a=new sv.MeshBuilder,h=new sv.Mesh,g={},$=new sv.DracoInt8Array;for(const yt of c.listSemantics()){const wt=c.getAttribute(yt),It=OL(yt),Et=LL(a,wt.getComponentType(),h,sv[It],wt.getCount(),wt.getElementSize(),wt.getArray());if(Et===-1)throw new Error(`Error compressing "${yt}" attribute.`);if(g[yt]=Et,i.quantizationVolume==="mesh"||yt!=="POSITION")s.SetAttributeQuantization(sv[It],i.quantizationBits[It]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:Ct}=i,xt=Math.max(Ct.max[0]-Ct.min[0],Ct.max[1]-Ct.min[1],Ct.max[2]-Ct.min[2]);s.SetAttributeExplicitQuantization(sv[It],i.quantizationBits[It],wt.getElementSize(),Ct.min,xt)}}}const nt=c.getIndices();if(!nt)throw new Error("Primitive must have indices.");a.AddFacesToMesh(h,nt.getCount()/3,nt.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),i.method===oM.SEQUENTIAL||c.listTargets().length>0?s.SetEncodingMethod(sv.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(sv.MESH_EDGEBREAKER_ENCODING);const rt=s.EncodeMeshToDracoBuffer(h,$);if(rt<=0)throw new Error("Error applying Draco compression.");const st=new Uint8Array(rt);for(let yt=0;yt<rt;++yt)st[yt]=$.GetValue(yt);const ut=c.getAttribute("POSITION").getCount(),mt=s.GetNumberOfEncodedPoints(),gt=3*s.GetNumberOfEncodedFaces();if(c.listTargets().length>0&&mt!==ut)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return sv.destroy($),sv.destroy(h),sv.destroy(a),sv.destroy(s),{numVertices:mt,numIndices:gt,data:st,attributeIDs:g}}function OL(c){return c==="POSITION"?v_.POSITION:c==="NORMAL"?v_.NORMAL:c.startsWith("COLOR_")?v_.COLOR:c.startsWith("TEXCOORD_")?v_.TEX_COORD:v_.GENERIC}function LL(c,e,i,s,a,h,g){switch(e){case vs.ComponentType.UNSIGNED_BYTE:return c.AddUInt8Attribute(i,s,a,h,g);case vs.ComponentType.BYTE:return c.AddInt8Attribute(i,s,a,h,g);case vs.ComponentType.UNSIGNED_SHORT:return c.AddUInt16Attribute(i,s,a,h,g);case vs.ComponentType.SHORT:return c.AddInt16Attribute(i,s,a,h,g);case vs.ComponentType.UNSIGNED_INT:return c.AddUInt32Attribute(i,s,a,h,g);case vs.ComponentType.FLOAT:return c.AddFloatAttribute(i,s,a,h,g);default:throw new Error(`Unexpected component type, "${e}".`)}}const np="KHR_draco_mesh_compression";class aM extends _u{constructor(...e){super(...e),this.extensionName=np,this.prereadTypes=[$r.PRIMITIVE],this.prewriteTypes=[$r.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,pp=this._decoderModule,WR={[vs.ComponentType.FLOAT]:Float32Array,[vs.ComponentType.UNSIGNED_INT]:Uint32Array,[vs.ComponentType.UNSIGNED_SHORT]:Uint16Array,[vs.ComponentType.UNSIGNED_BYTE]:Uint8Array,[vs.ComponentType.SHORT]:Int16Array,[vs.ComponentType.BYTE]:Int8Array},qR={[vs.ComponentType.FLOAT]:pp.DT_FLOAT32,[vs.ComponentType.UNSIGNED_INT]:pp.DT_UINT32,[vs.ComponentType.UNSIGNED_SHORT]:pp.DT_UINT16,[vs.ComponentType.UNSIGNED_BYTE]:pp.DT_UINT8,[vs.ComponentType.SHORT]:pp.DT_INT16,[vs.ComponentType.BYTE]:pp.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,sv=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${np}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,a=new Map;try{const h=s.json.meshes||[];for(const g of h)for(const $ of g.primitives){if(!$.extensions||!$.extensions[np])continue;const nt=$.extensions[np];let[rt,st]=a.get(nt.bufferView)||[];if(!st||!rt){const ut=s.json.bufferViews[nt.bufferView],mt=s.json.buffers[ut.buffer],gt=zo.toView(mt.uri?s.resources[mt.uri]:s.resources["@glb.bin"],ut.byteOffset||0,ut.byteLength);rt=new this._decoderModule.Decoder,st=DL(rt,gt),a.set(nt.bufferView,[rt,st]),i.debug(`[${np}] Decompressed ${gt.byteLength} bytes.`)}for(const ut in $.attributes){const mt=e.jsonDoc.json.accessors[$.attributes[ut]],gt=rt.GetAttributeByUniqueId(st,nt.attributes[ut]),yt=kL(rt,st,gt,mt);e.accessors[$.attributes[ut]].setArray(yt)}$.indices!==void 0&&e.accessors[$.indices].setArray(RL(rt,st))}}finally{for(const[h,g]of Array.from(a.values()))this._decoderModule.destroy(h),this._decoderModule.destroy(g)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${np}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${np}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const a=function($){const nt=$.getLogger(),rt=new Set,st=new Set;for(const It of $.getRoot().listMeshes())for(const Et of It.listPrimitives())Et.getIndices()?Et.getMode()!==Zx.Mode.TRIANGLES?(st.add(Et),nt.warn(`[${np}] Skipping Draco compression on non-TRIANGLES primitive.`)):rt.add(Et):(st.add(Et),nt.warn(`[${np}] Skipping Draco compression on non-indexed primitive.`));const ut=$.getRoot().listAccessors(),mt=new Map;for(let It=0;It<ut.length;It++)mt.set(ut[It],It);const gt=new Map,yt=new Set,wt=new Map;for(const It of Array.from(rt)){let Et=KR(It,mt);if(yt.has(Et))wt.set(It,Et);else{if(gt.has(It.getIndices())){const Ct=It.getIndices(),xt=Ct.clone();mt.set(xt,$.getRoot().listAccessors().length-1),It.swap(Ct,xt)}for(const Ct of It.listAttributes())if(gt.has(Ct)){const xt=Ct.clone();mt.set(xt,$.getRoot().listAccessors().length-1),It.swap(Ct,xt)}Et=KR(It,mt),yt.add(Et),wt.set(It,Et),gt.set(It.getIndices(),Et);for(const Ct of It.listAttributes())gt.set(Ct,Et)}}for(const It of Array.from(gt.keys())){const Et=new Set(It.listParents().map(Ct=>Ct.propertyType));if(Et.size!==2||!Et.has($r.PRIMITIVE)||!Et.has($r.ROOT))throw new Error(`[${np}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const It of Array.from(rt)){const Et=wt.get(It),Ct=It.getIndices();if(gt.get(Ct)!==Et||It.listAttributes().some(xt=>gt.get(xt)!==Et))throw new Error(`[${np}] Draco primitives must share all, or no, accessors.`)}for(const It of Array.from(st)){const Et=It.getIndices();if(gt.has(Et)||It.listAttributes().some(Ct=>gt.has(Ct)))throw new Error(`[${np}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return wt}(this.document),h=new Map;let g="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${np}]: quantizationVolume=scene requires exactly 1 scene.`):g=function($){const nt={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},rt=$.propertyType===$r.NODE?[$]:$.listChildren();for(const st of rt)st.traverse(ut=>{const mt=ut.getMesh();if(!mt)return;const gt=pL(mt,ut.getWorldMatrix());FP(gt.min,nt),FP(gt.max,nt)});return nt}(this.document.getRoot().listScenes().pop()));for(const $ of Array.from(a.keys())){const nt=a.get($);if(!nt)throw new Error("Unexpected primitive.");if(h.has(nt)){h.set(nt,h.get(nt));continue}const rt=$.getIndices(),st=e.jsonDoc.json.accessors,ut=BL($,_w({},this._encoderOptions,{quantizationVolume:g}));h.set(nt,ut);const mt=e.createAccessorDef(rt);mt.count=ut.numIndices,e.accessorIndexMap.set(rt,st.length),st.push(mt);for(const yt of $.listSemantics()){const wt=$.getAttribute(yt),It=e.createAccessorDef(wt);It.count=ut.numVertices,e.accessorIndexMap.set(wt,st.length),st.push(It)}const gt=$.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(gt)||e.otherBufferViews.set(gt,[]),e.otherBufferViews.get(gt).push(ut.data)}return s.debug(`[${np}] Compressed ${a.size} primitives.`),e.extensionData[np]={primitiveHashMap:a,primitiveEncodingMap:h},this}write(e){const i=e.extensionData[np];for(const s of this.document.getRoot().listMeshes()){const a=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let h=0;h<s.listPrimitives().length;h++){const g=s.listPrimitives()[h],$=a.primitives[h],nt=i.primitiveHashMap.get(g);if(!nt)continue;const rt=i.primitiveEncodingMap.get(nt);$.extensions=$.extensions||{},$.extensions[np]={bufferView:e.otherBufferViewsIndexMap.get(rt.data),attributes:rt.attributeIDs}}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(a=>a!==np),s.extensionsRequired=(s.extensionsRequired||[]).filter(a=>a!==np)}return this}}function KR(c,e){const i=[],s=c.getIndices();i.push(e.get(s));for(const a of c.listAttributes())i.push(e.get(a));return i.sort().join("|")}aM.EXTENSION_NAME=np,aM.EncoderMethod=oM;class ZE extends zu{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[$r.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ZE.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return rv.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return rv.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ZE.EXTENSION_NAME="KHR_lights_punctual",ZE.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const RI="KHR_lights_punctual";class $R extends _u{constructor(...e){super(...e),this.extensionName=RI}createLight(e=""){return new ZE(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions.KHR_lights_punctual)return this;const s=(i.json.extensions.KHR_lights_punctual.lights||[]).map(a=>{var h,g;const $=this.createLight().setName(a.name||"").setType(a.type);return a.color!==void 0&&$.setColor(a.color),a.intensity!==void 0&&$.setIntensity(a.intensity),a.range!==void 0&&$.setRange(a.range),((h=a.spot)==null?void 0:h.innerConeAngle)!==void 0&&$.setInnerConeAngle(a.spot.innerConeAngle),((g=a.spot)==null?void 0:g.outerConeAngle)!==void 0&&$.setOuterConeAngle(a.spot.outerConeAngle),$});return i.json.nodes.forEach((a,h)=>{a.extensions&&a.extensions.KHR_lights_punctual&&e.nodes[h].setExtension(RI,s[a.extensions.KHR_lights_punctual.light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],a=new Map;for(const h of this.properties){const g=h,$={type:g.getType()};Su.eq(g.getColor(),[1,1,1])||($.color=g.getColor()),g.getIntensity()!==1&&($.intensity=g.getIntensity()),g.getRange()!=null&&($.range=g.getRange()),g.getName()&&($.name=g.getName()),g.getType()===ZE.Type.SPOT&&($.spot={innerConeAngle:g.getInnerConeAngle(),outerConeAngle:g.getOuterConeAngle()}),s.push($),a.set(g,s.length-1)}return this.document.getRoot().listNodes().forEach(h=>{const g=h.getExtension(RI);if(g){const $=e.nodeIndexMap.get(h),nt=i.json.nodes[$];nt.extensions=nt.extensions||{},nt.extensions.KHR_lights_punctual={light:a.get(g)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions.KHR_lights_punctual={lights:s},this}}$R.EXTENSION_NAME=RI;const{R:JR,G:ZR,B:NL}=ju;class _k extends zu{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new uu(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new uu(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new uu(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:JR})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ZR})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:JR|ZR|NL})}}_k.EXTENSION_NAME="KHR_materials_clearcoat";const e1="KHR_materials_clearcoat";class eB extends _u{constructor(...e){super(...e),this.extensionName=e1}createClearcoat(){return new _k(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[e1]){const g=this.createClearcoat();e.materials[h].setExtension(e1,g);const $=a.extensions[e1];if($.clearcoatFactor!==void 0&&g.setClearcoatFactor($.clearcoatFactor),$.clearcoatRoughnessFactor!==void 0&&g.setClearcoatRoughnessFactor($.clearcoatRoughnessFactor),$.clearcoatTexture!==void 0){const nt=$.clearcoatTexture;g.setClearcoatTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getClearcoatTextureInfo(),nt)}if($.clearcoatRoughnessTexture!==void 0){const nt=$.clearcoatRoughnessTexture;g.setClearcoatRoughnessTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getClearcoatRoughnessTextureInfo(),nt)}if($.clearcoatNormalTexture!==void 0){const nt=$.clearcoatNormalTexture;g.setClearcoatNormalTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getClearcoatNormalTextureInfo(),nt),nt.scale!==void 0&&g.setClearcoatNormalScale(nt.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(e1);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions[e1]={clearcoatFactor:a.getClearcoatFactor(),clearcoatRoughnessFactor:a.getClearcoatRoughnessFactor()};if(a.getClearcoatTexture()){const nt=a.getClearcoatTexture(),rt=a.getClearcoatTextureInfo();$.clearcoatTexture=e.createTextureInfoDef(nt,rt)}if(a.getClearcoatRoughnessTexture()){const nt=a.getClearcoatRoughnessTexture(),rt=a.getClearcoatRoughnessTextureInfo();$.clearcoatRoughnessTexture=e.createTextureInfoDef(nt,rt)}if(a.getClearcoatNormalTexture()){const nt=a.getClearcoatNormalTexture(),rt=a.getClearcoatNormalTextureInfo();$.clearcoatNormalTexture=e.createTextureInfoDef(nt,rt),a.getClearcoatNormalScale()!==1&&($.clearcoatNormalTexture.scale=a.getClearcoatNormalScale())}}}),this}}eB.EXTENSION_NAME=e1;class tB extends zu{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}tB.EXTENSION_NAME="KHR_materials_emissive_strength";const t1="KHR_materials_emissive_strength";class nB extends _u{constructor(...e){super(...e),this.extensionName=t1}createEmissiveStrength(){return new tB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[t1]){const a=this.createEmissiveStrength();e.materials[s].setExtension(t1,a);const h=i.extensions[t1];h.emissiveStrength!==void 0&&a.setEmissiveStrength(h.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(t1);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{},g.extensions[t1]={emissiveStrength:a.getEmissiveStrength()}}}),this}}nB.EXTENSION_NAME=t1;class rB extends zu{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}rB.EXTENSION_NAME="KHR_materials_ior";const kI="KHR_materials_ior";class iB extends _u{constructor(...e){super(...e),this.extensionName=kI}createIOR(){return new rB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions.KHR_materials_ior){const a=this.createIOR();e.materials[s].setExtension(kI,a);const h=i.extensions.KHR_materials_ior;h.ior!==void 0&&a.setIOR(h.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(kI);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{},g.extensions.KHR_materials_ior={ior:a.getIOR()}}}),this}}iB.EXTENSION_NAME=kI;const{R:FL,G:UL}=ju;class sB extends zu{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new uu(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new uu(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:FL})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:UL})}}sB.EXTENSION_NAME="KHR_materials_iridescence";const n1="KHR_materials_iridescence";class oB extends _u{constructor(...e){super(...e),this.extensionName=n1}createIridescence(){return new sB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[n1]){const g=this.createIridescence();e.materials[h].setExtension(n1,g);const $=a.extensions[n1];if($.iridescenceFactor!==void 0&&g.setIridescenceFactor($.iridescenceFactor),$.iridescenceIor!==void 0&&g.setIridescenceIOR($.iridescenceIor),$.iridescenceThicknessMinimum!==void 0&&g.setIridescenceThicknessMinimum($.iridescenceThicknessMinimum),$.iridescenceThicknessMaximum!==void 0&&g.setIridescenceThicknessMaximum($.iridescenceThicknessMaximum),$.iridescenceTexture!==void 0){const nt=$.iridescenceTexture;g.setIridescenceTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getIridescenceTextureInfo(),nt)}if($.iridescenceThicknessTexture!==void 0){const nt=$.iridescenceThicknessTexture;g.setIridescenceThicknessTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getIridescenceThicknessTextureInfo(),nt)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(n1);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions[n1]={};if(a.getIridescenceFactor()>0&&($.iridescenceFactor=a.getIridescenceFactor()),a.getIridescenceIOR()!==1.3&&($.iridescenceIor=a.getIridescenceIOR()),a.getIridescenceThicknessMinimum()!==100&&($.iridescenceThicknessMinimum=a.getIridescenceThicknessMinimum()),a.getIridescenceThicknessMaximum()!==400&&($.iridescenceThicknessMaximum=a.getIridescenceThicknessMaximum()),a.getIridescenceTexture()){const nt=a.getIridescenceTexture(),rt=a.getIridescenceTextureInfo();$.iridescenceTexture=e.createTextureInfoDef(nt,rt)}if(a.getIridescenceThicknessTexture()){const nt=a.getIridescenceThicknessTexture(),rt=a.getIridescenceThicknessTextureInfo();$.iridescenceThicknessTexture=e.createTextureInfoDef(nt,rt)}}}),this}}oB.EXTENSION_NAME=n1;const{R:aB,G:lB,B:cB,A:uB}=ju;class hB extends zu{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new uu(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new uu(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return rv.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(rv.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:aB|lB|cB|uB})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:aB|lB|cB|uB})}}hB.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const r1="KHR_materials_pbrSpecularGlossiness";class dB extends _u{constructor(...e){super(...e),this.extensionName=r1}createPBRSpecularGlossiness(){return new hB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[r1]){const g=this.createPBRSpecularGlossiness();e.materials[h].setExtension(r1,g);const $=a.extensions[r1];if($.diffuseFactor!==void 0&&g.setDiffuseFactor($.diffuseFactor),$.specularFactor!==void 0&&g.setSpecularFactor($.specularFactor),$.glossinessFactor!==void 0&&g.setGlossinessFactor($.glossinessFactor),$.diffuseTexture!==void 0){const nt=$.diffuseTexture;g.setDiffuseTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getDiffuseTextureInfo(),nt)}if($.specularGlossinessTexture!==void 0){const nt=$.specularGlossinessTexture;g.setSpecularGlossinessTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getSpecularGlossinessTextureInfo(),nt)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(r1);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions[r1]={diffuseFactor:a.getDiffuseFactor(),specularFactor:a.getSpecularFactor(),glossinessFactor:a.getGlossinessFactor()};if(a.getDiffuseTexture()){const nt=a.getDiffuseTexture(),rt=a.getDiffuseTextureInfo();$.diffuseTexture=e.createTextureInfoDef(nt,rt)}if(a.getSpecularGlossinessTexture()){const nt=a.getSpecularGlossinessTexture(),rt=a.getSpecularGlossinessTextureInfo();$.specularGlossinessTexture=e.createTextureInfoDef(nt,rt)}}}),this}}dB.EXTENSION_NAME=r1;const{R:jL,G:zL,B:VL,A:QL}=ju;class pB extends zu{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new uu(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new uu(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return rv.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",rv.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:jL|zL|VL})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:QL})}}pB.EXTENSION_NAME="KHR_materials_sheen";const BI="KHR_materials_sheen";class fB extends _u{constructor(...e){super(...e),this.extensionName=BI}createSheen(){return new pB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_sheen){const g=this.createSheen();e.materials[h].setExtension(BI,g);const $=a.extensions.KHR_materials_sheen;if($.sheenColorFactor!==void 0&&g.setSheenColorFactor($.sheenColorFactor),$.sheenRoughnessFactor!==void 0&&g.setSheenRoughnessFactor($.sheenRoughnessFactor),$.sheenColorTexture!==void 0){const nt=$.sheenColorTexture;g.setSheenColorTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getSheenColorTextureInfo(),nt)}if($.sheenRoughnessTexture!==void 0){const nt=$.sheenRoughnessTexture;g.setSheenRoughnessTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getSheenRoughnessTextureInfo(),nt)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(BI);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions.KHR_materials_sheen={sheenColorFactor:a.getSheenColorFactor(),sheenRoughnessFactor:a.getSheenRoughnessFactor()};if(a.getSheenColorTexture()){const nt=a.getSheenColorTexture(),rt=a.getSheenColorTextureInfo();$.sheenColorTexture=e.createTextureInfoDef(nt,rt)}if(a.getSheenRoughnessTexture()){const nt=a.getSheenRoughnessTexture(),rt=a.getSheenRoughnessTextureInfo();$.sheenRoughnessTexture=e.createTextureInfoDef(nt,rt)}}}),this}}fB.EXTENSION_NAME=BI;const{R:GL,G:HL,B:WL,A:qL}=ju;class mB extends zu{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new uu(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new uu(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return rv.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",rv.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:qL})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:GL|HL|WL})}}mB.EXTENSION_NAME="KHR_materials_specular";const i1="KHR_materials_specular";class gB extends _u{constructor(...e){super(...e),this.extensionName=i1}createSpecular(){return new mB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[i1]){const g=this.createSpecular();e.materials[h].setExtension(i1,g);const $=a.extensions[i1];if($.specularFactor!==void 0&&g.setSpecularFactor($.specularFactor),$.specularColorFactor!==void 0&&g.setSpecularColorFactor($.specularColorFactor),$.specularTexture!==void 0){const nt=$.specularTexture;g.setSpecularTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getSpecularTextureInfo(),nt)}if($.specularColorTexture!==void 0){const nt=$.specularColorTexture;g.setSpecularColorTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getSpecularColorTextureInfo(),nt)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(i1);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions[i1]={};if(a.getSpecularFactor()!==1&&($.specularFactor=a.getSpecularFactor()),Su.eq(a.getSpecularColorFactor(),[1,1,1])||($.specularColorFactor=a.getSpecularColorFactor()),a.getSpecularTexture()){const nt=a.getSpecularTexture(),rt=a.getSpecularTextureInfo();$.specularTexture=e.createTextureInfoDef(nt,rt)}if(a.getSpecularColorTexture()){const nt=a.getSpecularColorTexture(),rt=a.getSpecularColorTextureInfo();$.specularColorTexture=e.createTextureInfoDef(nt,rt)}}}),this}}gB.EXTENSION_NAME=i1;const{R:YL}=ju;class vB extends zu{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new uu(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:YL})}}vB.EXTENSION_NAME="KHR_materials_transmission";const s1="KHR_materials_transmission";class _B extends _u{constructor(...e){super(...e),this.extensionName=s1}createTransmission(){return new vB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[s1]){const g=this.createTransmission();e.materials[h].setExtension(s1,g);const $=a.extensions[s1];if($.transmissionFactor!==void 0&&g.setTransmissionFactor($.transmissionFactor),$.transmissionTexture!==void 0){const nt=$.transmissionTexture;g.setTransmissionTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getTransmissionTextureInfo(),nt)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(s1);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions[s1]={transmissionFactor:a.getTransmissionFactor()};if(a.getTransmissionTexture()){const nt=a.getTransmissionTexture(),rt=a.getTransmissionTextureInfo();$.transmissionTexture=e.createTextureInfoDef(nt,rt)}}}),this}}_B.EXTENSION_NAME=s1;class yB extends zu{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[$r.MATERIAL]}}yB.EXTENSION_NAME="KHR_materials_unlit";const OI="KHR_materials_unlit";class AB extends _u{constructor(...e){super(...e),this.extensionName=OI}createUnlit(){return new yB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions.KHR_materials_unlit&&e.materials[s].setExtension(OI,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(OI)){const a=e.materialIndexMap.get(s),h=i.json.materials[a];h.extensions=h.extensions||{},h.extensions.KHR_materials_unlit={}}}),this}}AB.EXTENSION_NAME=OI;class wB extends zu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}wB.EXTENSION_NAME="KHR_materials_variants";class xB extends zu{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[$r.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}xB.EXTENSION_NAME="KHR_materials_variants";class WP extends zu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}WP.EXTENSION_NAME="KHR_materials_variants";const ly="KHR_materials_variants";class bB extends _u{constructor(...e){super(...e),this.extensionName=ly}createMappingList(){return new xB(this.document.getGraph())}createVariant(e=""){return new WP(this.document.getGraph(),e)}createMapping(){return new wB(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof WP)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[ly])return this;const s=(i.json.extensions[ly].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(i.json.meshes||[]).forEach((a,h)=>{const g=e.meshes[h];(a.primitives||[]).forEach(($,nt)=>{if(!$.extensions||!$.extensions[ly])return;const rt=this.createMappingList(),st=$.extensions[ly];for(const ut of st.mappings){const mt=this.createMapping();ut.material!==void 0&&mt.setMaterial(e.materials[ut.material]);for(const gt of ut.variants||[])mt.addVariant(s[gt]);rt.addMapping(mt)}g.listPrimitives()[nt].setExtension(ly,rt)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const a=[],h=new Map;for(const g of s)h.set(g,a.length),a.push(e.createPropertyDef(g));for(const g of this.document.getRoot().listMeshes()){const $=e.meshIndexMap.get(g);g.listPrimitives().forEach((nt,rt)=>{const st=nt.getExtension(ly);if(!st)return;const ut=e.jsonDoc.json.meshes[$].primitives[rt],mt=st.listMappings().map(gt=>{const yt=e.createPropertyDef(gt),wt=gt.getMaterial();return wt&&(yt.material=e.materialIndexMap.get(wt)),yt.variants=gt.listVariants().map(It=>h.get(It)),yt});ut.extensions=ut.extensions||{},ut.extensions[ly]={mappings:mt}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[ly]={variants:a},this}}bB.EXTENSION_NAME=ly;const{G:XL}=ju;class EB extends zu{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[$r.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new uu(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:XL})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return rv.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",rv.hexToFactor(e,i))}}EB.EXTENSION_NAME="KHR_materials_volume";const LI="KHR_materials_volume";class SB extends _u{constructor(...e){super(...e),this.extensionName=LI}createVolume(){return new EB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_volume){const g=this.createVolume();e.materials[h].setExtension(LI,g);const $=a.extensions.KHR_materials_volume;if($.thicknessFactor!==void 0&&g.setThicknessFactor($.thicknessFactor),$.attenuationDistance!==void 0&&g.setAttenuationDistance($.attenuationDistance),$.attenuationColor!==void 0&&g.setAttenuationColor($.attenuationColor),$.thicknessTexture!==void 0){const nt=$.thicknessTexture;g.setThicknessTexture(e.textures[s[nt.index].source]),e.setTextureInfo(g.getThicknessTextureInfo(),nt)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(LI);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $=g.extensions.KHR_materials_volume={};if(a.getThicknessFactor()>0&&($.thicknessFactor=a.getThicknessFactor()),Number.isFinite(a.getAttenuationDistance())&&($.attenuationDistance=a.getAttenuationDistance()),Su.eq(a.getAttenuationColor(),[1,1,1])||($.attenuationColor=a.getAttenuationColor()),a.getThicknessTexture()){const nt=a.getThicknessTexture(),rt=a.getThicknessTextureInfo();$.thicknessTexture=e.createTextureInfoDef(nt,rt)}}}),this}}SB.EXTENSION_NAME=LI;const CB="KHR_mesh_quantization";class MB extends _u{constructor(...e){super(...e),this.extensionName=CB}read(e){return this}write(e){return this}}MB.EXTENSION_NAME=CB;const TB="KHR_texture_basisu";class KL{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=GP(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=GP(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getGPUByteLength(e){const i=GP(e),s=this.getChannels(e)>3;let a=0;for(let h=0;h<i.levels.length;h++){const g=i.levels[h];a+=g.uncompressedByteLength?g.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,h)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,h)))/4)*(s?16:8)}return a}}class IB extends _u{constructor(...e){super(...e),this.extensionName=TB,this.prereadTypes=[$r.TEXTURE]}static register(){iA.registerFormat("image/ktx2",new KL)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions.KHR_texture_basisu&&(i.source=i.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const a=e.imageIndexMap.get(s);i.json.textures.forEach(h=>{h.source===a&&(h.extensions=h.extensions||{},h.extensions.KHR_texture_basisu={source:h.source},delete h.source)})}}),this}}IB.EXTENSION_NAME=TB;class PB extends zu{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[$r.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}PB.EXTENSION_NAME="KHR_texture_transform";const NI="KHR_texture_transform";class DB extends _u{constructor(...e){super(...e),this.extensionName=NI}createTransform(){return new PB(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions.KHR_texture_transform)continue;const a=this.createTransform(),h=s.extensions.KHR_texture_transform;h.offset!==void 0&&a.setOffset(h.offset),h.rotation!==void 0&&a.setRotation(h.rotation),h.scale!==void 0&&a.setScale(h.scale),h.texCoord!==void 0&&a.setTexCoord(h.texCoord),i.setExtension(NI,a)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,a]of i){const h=s.getExtension(NI);if(!h)continue;a.extensions=a.extensions||{};const g={},$=Su.eq;$(h.getOffset(),[0,0])||(g.offset=h.getOffset()),h.getRotation()!==0&&(g.rotation=h.getRotation()),$(h.getScale(),[1,1])||(g.scale=h.getScale()),h.getTexCoord()!=null&&(g.texCoord=h.getTexCoord()),a.extensions.KHR_texture_transform=g}return this}}DB.EXTENSION_NAME=NI;const $L=[$r.ROOT,$r.SCENE,$r.NODE,$r.MESH,$r.MATERIAL,$r.TEXTURE,$r.ANIMATION];class RB extends zu{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=$L}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",_w({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=_w({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return _w({"@context":qP(this.get("context"))},qP(this.get("properties")))}fromJSONLD(e){const i=(e=qP(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function qP(c){return JSON.parse(JSON.stringify(c))}RB.EXTENSION_NAME="KHR_xmp_json_ld";const YP="KHR_xmp_json_ld";class kB extends _u{constructor(...e){super(...e),this.extensionName=YP}createPacket(){return new RB(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i.KHR_xmp_json_ld;if(!s||!s.packets)return this;const a=e.jsonDoc.json,h=this.document.getRoot(),g=s.packets.map(rt=>this.createPacket().fromJSONLD(rt)),$=[[a.asset],a.scenes,a.nodes,a.meshes,a.materials,a.images,a.animations],nt=[[h],h.listScenes(),h.listNodes(),h.listMeshes(),h.listMaterials(),h.listTextures(),h.listAnimations()];for(let rt=0;rt<$.length;rt++){const st=$[rt]||[];for(let ut=0;ut<st.length;ut++){const mt=st[ut];mt.extensions&&mt.extensions.KHR_xmp_json_ld&&nt[rt][ut].setExtension(YP,g[mt.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const a of this.properties){s.push(a.toJSONLD());for(const h of a.listParents()){let g;switch(h.propertyType){case $r.ROOT:g=i.asset;break;case $r.SCENE:g=i.scenes[e.sceneIndexMap.get(h)];break;case $r.NODE:g=i.nodes[e.nodeIndexMap.get(h)];break;case $r.MESH:g=i.meshes[e.meshIndexMap.get(h)];break;case $r.MATERIAL:g=i.materials[e.materialIndexMap.get(h)];break;case $r.TEXTURE:g=i.images[e.imageIndexMap.get(h)];break;case $r.ANIMATION:g=i.animations[e.animationIndexMap.get(h)];break;default:g=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${h.propertyType}"`)}g&&(g.extensions=g.extensions||{},g.extensions.KHR_xmp_json_ld={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions.KHR_xmp_json_ld={packets:s}),this}}kB.EXTENSION_NAME=YP;const JL=[aM,$R,eB,nB,iB,oB,dB,gB,fB,_B,AB,bB,SB,MB,IB,DB,kB];let XP=class extends Wo{constructor(c,e,i){super(c,e,i??new ZL,new hs(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){this.enabled&&super.render(c,e,i,s,a)}};XP=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g}([ho("High precision Normal Buffer")],XP);class ZL extends d.RSm{constructor(){super()}onBeforeRender(e,i,s,a,h){var g,$;let nt=h.material;Array.isArray(nt)&&(nt=nt[0]),this.normalMap=(g=nt==null?void 0:nt.normalMap)!==null&&g!==void 0?g:null,this.needsUpdate=!0,this.side=($=nt.side)!==null&&$!==void 0?$:d.ehD}}class eS extends Av{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:d.cLu,minFilter:d.TyD,magFilter:d.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,a=new Set;return new class extends XP{render(h,g,$,nt,rt){const st=h.getRenderTarget(),ut=h.getActiveCubeFace(),mt=h.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:gt})=>{gt&&((gt.transparent&&gt.userData.renderToDepth||!gt.transparent&&gt.transmission===0&&gt.userData.renderToDepth===!1)&&(s.add(gt),gt.transparent=!gt.transparent),Math.abs(gt.transmission||0)>0&&gt.userData.renderToDepth&&(a.add([gt,gt.transmission]),gt.transmission=0))}),Br(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,g,i,nt,rt)),s.forEach(gt=>gt.transparent=!gt.transparent),s.clear(),a.forEach(([gt,yt])=>gt.transmission=yt),a.clear(),h.setRenderTarget(st,ut,mt))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)===null||i===void 0?void 0:i.dispose)===null||s===void 0?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(s=(i=this.getNormalBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}eS.PluginType="NormalBufferPlugin";function BB(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),c.isMaterial&&(c.needsUpdate=!0),!0}let KP=class extends Au{constructor(c,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new d.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new d.Pa4(1,1,1)}},vertexShader:xv,fragmentShader:`

            ${i}

            ${bv}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=mask.g*255.*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,g)=>{var $,nt;this.enabled&&(!((nt=($=h.materialObject.userData)===null||$===void 0?void 0:$._ssBevel)===null||nt===void 0)&&nt.hasSSBevel)&&(a.fragmentShader=Fl(a.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(a,h,g)=>{var $,nt;if(!this.enabled||!(!((nt=($=h.materialObject.userData)===null||$===void 0?void 0:$._ssBevel)===null||nt===void 0)&&nt.hasSSBevel))return;const rt=h.materialObject,st=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==st&&(this.materialExtension.extraUniforms.tSSBevelMap.value=st,rt.needsUpdate=!0)},getUiConfig:a=>{const h={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var g;return((g=a.materialObject.userData._ssBevel)===null||g===void 0?void 0:g.hasSSBevel)||!1},set value(g){var $,nt;g!==(($=a.materialObject.userData._ssBevel)===null||$===void 0?void 0:$.hasSSBevel)&&(g?BB(a.materialObject)||alert("Cannot add screen space bevel."):(a.materialObject.userData._ssBevel.hasSSBevel=!1,a.materialObject.needsUpdate=!0),(nt=h.uiRefresh)===null||nt===void 0||nt.call(h,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var g;return!(!((g=a.materialObject.userData._ssBevel)===null||g===void 0)&&g.hasSSBevel)},property:[a.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return h},parsFragmentSnippet:(a,h)=>{var g,$;return this.enabled&&(!(($=(g=h==null?void 0:h.materialObject.userData)===null||g===void 0?void 0:g._ssBevel)===null||$===void 0)&&$.hasSSBevel)?zt`
            uniform sampler2D tSSBevelMap;
            ${L1}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:a=>{var h,g;return(this.enabled?"1":"0")+(!((g=(h=a.materialObject.userData)===null||h===void 0?void 0:h._ssBevel)===null||g===void 0)&&g.hasSSBevel?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new T_({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new d.FM8(1,1)},cameraPositionWorld:{value:new d.Pa4(1,1,1)}},vertexShader:xv,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new T_({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new d.FM8(.5,.5)},direction:{value:new d.FM8(.5,.5)}},vertexShader:xv,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(c,e,i,s,a){var h,g;if(!this.enabled)return;const $=c.baseRenderer,nt={minFilter:d.wem,magFilter:d.wem,isAntialiased:!1,format:d.wk1,depthBuffer:!1,generateMipmaps:!1},rt=$.getTempTarget(nt);this._renderEdges($,rt),this._blurEdges($,rt),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(h=this._viewerApp.getPlugin(El))===null||h===void 0||h.updateShaderProperties(this.material),(g=this._viewerApp.getPlugin(eS))===null||g===void 0||g.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=rt.texture,super.render(c,this._target,rt,s,a),$.releaseTempTarget(rt)}_initsamples(){const c=[];return c.push(new d.FM8(-8,0).multiplyScalar(.125)),c.push(new d.FM8(-6,-4).multiplyScalar(.125)),c.push(new d.FM8(-3,-2).multiplyScalar(.125)),c.push(new d.FM8(-2,-6).multiplyScalar(.125)),c.push(new d.FM8(1,-1).multiplyScalar(.125)),c.push(new d.FM8(2,-5).multiplyScalar(.125)),c.push(new d.FM8(6,-7).multiplyScalar(.125)),c.push(new d.FM8(5,-3).multiplyScalar(.125)),c.push(new d.FM8(4,1).multiplyScalar(.125)),c.push(new d.FM8(7,4).multiplyScalar(.125)),c.push(new d.FM8(3,5).multiplyScalar(.125)),c.push(new d.FM8(0,7).multiplyScalar(.125)),c.push(new d.FM8(-1,3).multiplyScalar(.125)),c.push(new d.FM8(-4,6).multiplyScalar(.125)),c.push(new d.FM8(-7,8).multiplyScalar(.125)),c.push(new d.FM8(-5,2).multiplyScalar(.125)),c}_blurEdges(c,e){var i,s;const a={minFilter:d.wem,magFilter:d.wem,isAntialiased:!1,format:d.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},h=c.getTempTarget(a),g=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,$=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new d.FM8(g,$),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new d.FM8(1,0),c.blit(void 0,h,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new d.FM8(g/2,$/2),this._separableBlurMaterial.uniforms.colorTexture.value=h.texture,this._separableBlurMaterial.uniforms.direction.value=new d.FM8(0,1),c.blit(void 0,e,{material:this._separableBlurMaterial}),c.releaseTempTarget(h)}_renderEdges(c,e){var i,s,a,h;const g=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,$=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._edgeMaterial.uniforms.screenSize.value=new d.FM8(g,$),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(a=this._viewerApp.getPlugin(El))===null||a===void 0||a.updateShaderProperties(this._edgeMaterial),(h=this._viewerApp.getPlugin(eS))===null||h===void 0||h.updateShaderProperties(this._edgeMaterial),c.blit(void 0,e,{material:this._edgeMaterial})}};KP=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g}([ho("SSBevel")],KP);class yw extends Av{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Jr,El,eS],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new eN(i))}passCtor(e){var i,s;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:d.cLu,minFilter:d.TyD,magFilter:d.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const a=e.getPluginByType("debug");return a&&a.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new KP(e.renderer,this._bevelTarget,(s=(i=e.getPlugin(El))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",e)}async onAdded(e){var i,s,a,h,g,$,nt;await super.onAdded(e);const rt=e.getPlugin(Jr);return!((i=this.pass)===null||i===void 0)&&i.passObject.materialExtension&&((s=rt==null?void 0:rt.materials)===null||s===void 0||s.registerMaterialExtension((a=this.pass)===null||a===void 0?void 0:a.passObject.materialExtension)),(h=rt==null?void 0:rt.importer)===null||h===void 0||h.addEventListener("loaderCreate",this._loaderCreate),(nt=($=(g=rt==null?void 0:rt.exporter)===null||g===void 0?void 0:g.getExporter("gltf","glb"))===null||$===void 0?void 0:$.extensions)===null||nt===void 0||nt.push(tN),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,a;(e=this._viewer)===null||e===void 0||e.setDirty(),(a=(i=this.pass)===null||i===void 0?void 0:(s=i.passObject.materialExtension).setDirty)===null||a===void 0||a.call(s)}_update(e){var i;let s=this.enabled;if(s&&!this._lastEnabled){const a=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?a.enabled=!0:(this.enabled=!1,a.enabled=!1,s=!1)}return this._lastEnabled=s,s}get uiConfig(){var e,i,s,a,h;const g=(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=g.children)===null||a===void 0?void 0:a.map($=>Ht($)))===null||h===void 0||h.flat(2).forEach($=>$&&($.onChange=this.setDirty)),g}}yw.PluginType="SSBevelPlugin",yw.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class eN{constructor(e){this.parser=e,this.name=yw.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),BB(i),i.userData._ssBevel=br(a,i.userData._ssBevel,!1,{}),Promise.resolve()}}const tN=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=Xr(e.userData._ssBevel,!1);i.extensions[yw.SSBEVEL_GLTF_EXTENSION]=s,c.extensionsUsed[yw.SSBEVEL_GLTF_EXTENSION]=!0}});class OB extends IP{constructor(e){super(),this._loadedLibs=!1,e=e||{method:aM.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new bL().registerExtensions(JL).registerExtensions([LB,VI,UI,jI,zI,QI,GI,HI,WI,qI,YI,XI,KI,$I,JI]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,...s}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,s);await this._loadLibs();const a={...s};i&&(a.externalImagesInExtras=!0);const h=await new Promise((ut,mt)=>this.parse(e,ut,mt,a)),g=await super.parseAsync(h,a);if(!i)return g;if(!h)throw new Error("GLTFDracoExporter: gltf is null");let $=h;const nt=$.byteLength||1/0,rt=await(typeof $!="object"||$.byteLength?this._io.readBinary(new Uint8Array($)):this._io.readJSON({json:$,resources:{}}));if(rt.createExtension(aM).setRequired(!0).setEncoderOptions(this._encoderOptions),a.exportExt==="glb")$=await this._io.writeBinary(rt),isFinite(nt)&&console.log("DRACO Compression ratio: "+($.byteLength/nt).toFixed(5));else{const ut=await this._io.writeJSON(rt);$=ut.json,Object.values(ut.resources).filter(mt=>mt).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),$.resources=ut.resources)}$.__isGLTFOutput=!0;const st=await super.parseAsync($,a);return st.__uncompressed=g,st}}class $P extends Ks{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Jr,tM]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(s,a){PP(s,OB,h=>{const g=Ao()+".drc",$=h;$.loader=a.registerFile(g),$.loader.setDecoderConfig({type:"js"}),$.loader.preload(!0,!0)})})(e,i)}}$P.PluginType="GLTFDracoExportPlugin";class nN extends zu{constructor(){super(...arguments),this.extensionName=$p,this.parentTypes=[$r.SCENE],this.propertyType="ViewerJSON"}init(){}}class LB extends _u{constructor(){super(...arguments),this.extensionName=$p,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)===null||i===void 0||i.forEach((s,a)=>{if(s.extensions&&s.extensions[$p]){const h=new nN(this.document.getGraph());e.scenes[a].setExtension($p,h);const g=s.extensions[$p];this._viewerConfig=g}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension($p)){const a=(s=e.jsonDoc.json.scenes)===null||s===void 0?void 0:s[e.jsonDoc.json.scene||0];a&&this._viewerConfig!=={}&&(a.extensions=a.extensions||{},a.extensions[$p]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}LB.EXTENSION_NAME=$p;class FI extends zu{constructor(e,i,s){super(e,i),this.parentTypes=[$r.MATERIAL,$r.MESH,$r.NODE,$r.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}addTexture(e,i,s,a=4369){this.setRef(e,s,{channels:a}),this.textures[e]=[i,s]}copy(e,i=ay){return super.copy(e,i),this}dispose(){Object.values(this.textures).forEach(([e,i])=>{e==null||e.dispose()}),super.dispose()}init(){}}class ov extends _u{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],a=i.json.textures||[];return s.forEach((h,g)=>{var $,nt;if(h.extensions&&h.extensions[this.extensionName]){const rt=new FI(this.document.getGraph(),"",this.extensionName);e.materials[g].setExtension(this.extensionName,rt);const st={...h.extensions[this.extensionName]};for(const[ut,mt]of Object.entries(st))if(typeof(mt==null?void 0:mt.index)=="number"){const gt=mt,yt=($=a[gt.index])===null||$===void 0?void 0:$.source;if(typeof yt!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",gt);continue}const wt=e.textures[yt],It=new uu(this.document.getGraph()),Et=(nt=this.textureChannels[ut])!==null&&nt!==void 0?nt:4369;rt.addTexture(ut,It,wt,Et),e.setTextureInfo(It,gt),delete st[ut]}rt.setExtras(st)}}),(i.json.meshes||[]).forEach((h,g)=>{if(h.extensions&&h.extensions[this.extensionName]){const $=new FI(this.document.getGraph(),"",this.extensionName);e.meshes[g].setExtension(this.extensionName,$);const nt=h.extensions[this.extensionName];$.setExtras(nt)}}),(i.json.nodes||[]).forEach((h,g)=>{if(h.extensions&&h.extensions[this.extensionName]){const $=new FI(this.document.getGraph(),"",this.extensionName);e.nodes[g].setExtension(this.extensionName,$);const nt=h.extensions[this.extensionName];$.setExtras(nt)}}),(i.json.scenes||[]).forEach((h,g)=>{if(h.extensions&&h.extensions[this.extensionName]){const $=new FI(this.document.getGraph(),"",this.extensionName);e.scenes[g].setExtension(this.extensionName,$);const nt=h.extensions[this.extensionName];$.setExtras(nt)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.materialIndexMap.get(s),g=i.json.materials[h];g.extensions=g.extensions||{};const $={...a.getExtras()};for(const[nt,rt]of Object.entries(a.textures)){const st=rt[0],ut=rt[1];ut&&($[nt]=e.createTextureInfoDef(ut,st))}g.extensions[this.extensionName]=$}}),this.document.getRoot().listMeshes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.meshIndexMap.get(s),g=i.json.meshes[h];g.extensions=g.extensions||{},g.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.nodeIndexMap.get(s),g=i.json.nodes[h];g.extensions=g.extensions||{},g.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.jsonDoc.json.scene||0,g=i.json.scenes[h];if(!g)return;g.extensions=g.extensions||{},g.extensions[this.extensionName]=a.getExtras()}}),this}}class UI extends ov{constructor(){super(...arguments),this.extensionName=UI.EXTENSION_NAME,this.textureChannels={bumpTexture:ju.R}}}UI.EXTENSION_NAME=ym;class jI extends ov{constructor(){super(...arguments),this.extensionName=jI.EXTENSION_NAME,this.textureChannels={lightMapTexture:ju.R|ju.G|ju.B}}}jI.EXTENSION_NAME=Am;class zI extends ov{constructor(){super(...arguments),this.extensionName=zI.EXTENSION_NAME,this.textureChannels={alphaTexture:ju.G}}}zI.EXTENSION_NAME=gv;class VI extends ov{constructor(){super(...arguments),this.extensionName=VI.EXTENSION_NAME}}VI.EXTENSION_NAME=Yl.DIAMOND_GLTF_EXTENSION;class QI extends ov{constructor(){super(...arguments),this.extensionName=QI.EXTENSION_NAME}}QI.EXTENSION_NAME=Ol.AnimationMarkersExtension;class GI extends ov{constructor(){super(...arguments),this.extensionName=GI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:ju.R|ju.G|ju.B}}}GI.EXTENSION_NAME=dm.ANISOTROPY_GLTF_EXTENSION;class HI extends ov{constructor(){super(...arguments),this.extensionName=HI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:ju.R|ju.G|ju.B}}}HI.EXTENSION_NAME=_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class WI extends ov{constructor(){super(...arguments),this.extensionName=WI.EXTENSION_NAME}}WI.EXTENSION_NAME=xn;class qI extends ov{constructor(){super(...arguments),this.extensionName=qI.EXTENSION_NAME}}qI.EXTENSION_NAME=fv;class YI extends ov{constructor(){super(...arguments),this.extensionName=YI.EXTENSION_NAME}}YI.EXTENSION_NAME=Jp;class XI extends ov{constructor(){super(...arguments),this.extensionName=XI.EXTENSION_NAME}}XI.EXTENSION_NAME=Xm.CLEARCOAT_TINT_GLTF_EXTENSION;class KI extends ov{constructor(){super(...arguments),this.extensionName=KI.EXTENSION_NAME}}KI.EXTENSION_NAME=Cm.THIN_FILM_LAYER_GLTF_EXTENSION;class $I extends ov{constructor(){super(...arguments),this.extensionName=$I.EXTENSION_NAME}}$I.EXTENSION_NAME=yw.SSBEVEL_GLTF_EXTENSION;class JI extends ov{constructor(){super(...arguments),this.extensionName=JI.EXTENSION_NAME}}JI.EXTENSION_NAME=up.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class NB extends _e{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}NB.PluginType="PMREMGenerator";const FB=new d.Pa4,rN=new d._fP,UB=new d.Pa4;class iN extends d.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const cy=new d.yGw,sN=new d.yGw;class oN{constructor(e={}){const i=this;let s,a,h,g;const $={camera:{fov:0,style:""},objects:new WeakMap},nt=e.element!==void 0?e.element:document.createElement("div");nt.style.overflow="hidden",this.domElement=nt;const rt=document.createElement("div");function st(yt){return Math.abs(yt)<1e-10?0:yt}function ut(yt){const wt=yt.elements;return"matrix3d("+st(wt[0])+","+st(-wt[1])+","+st(wt[2])+","+st(wt[3])+","+st(wt[4])+","+st(-wt[5])+","+st(wt[6])+","+st(wt[7])+","+st(wt[8])+","+st(-wt[9])+","+st(wt[10])+","+st(wt[11])+","+st(wt[12])+","+st(-wt[13])+","+st(wt[14])+","+st(wt[15])+")"}function mt(yt){const wt=yt.elements;return"translate(-50%,-50%)matrix3d("+st(wt[0])+","+st(wt[1])+","+st(wt[2])+","+st(wt[3])+","+st(-wt[4])+","+st(-wt[5])+","+st(-wt[6])+","+st(-wt[7])+","+st(wt[8])+","+st(wt[9])+","+st(wt[10])+","+st(wt[11])+","+st(wt[12])+","+st(wt[13])+","+st(wt[14])+","+st(wt[15])+")"}function gt(yt,wt,It,Et){if(yt.isCSS3DObject){const Ct=yt.visible===!0&&yt.layers.test(It.layers)===!0;if(yt.element.style.display=Ct===!0?"":"none",Ct===!0){let xt;yt.onBeforeRender(i,wt,It),yt.isCSS3DSprite?(cy.copy(It.matrixWorldInverse),cy.transpose(),yt.rotation2D!==0&&cy.multiply(sN.makeRotationZ(yt.rotation2D)),yt.matrixWorld.decompose(FB,rN,UB),cy.setPosition(FB),cy.scale(UB),cy.elements[3]=0,cy.elements[7]=0,cy.elements[11]=0,cy.elements[15]=1,xt=mt(cy)):xt=mt(yt.matrixWorld);const Bt=yt.element,Lt=$.objects.get(yt);if(Lt===void 0||Lt.style!==xt){Bt.style.transform=xt;const Gt={style:xt};$.objects.set(yt,Gt)}Bt.parentNode!==rt&&rt.appendChild(Bt),yt.onAfterRender(i,wt,It)}}for(let Ct=0,xt=yt.children.length;Ct<xt;Ct++)gt(yt.children[Ct],wt,It)}rt.style.transformStyle="preserve-3d",rt.style.pointerEvents="none",nt.appendChild(rt),this.getSize=function(){return{width:s,height:a}},this.render=function(yt,wt){const It=wt.projectionMatrix.elements[5]*g;let Et,Ct;$.camera.fov!==It&&(nt.style.perspective=wt.isPerspectiveCamera?It+"px":"",$.camera.fov=It),yt.matrixWorldAutoUpdate===!0&&yt.updateMatrixWorld(),wt.parent===null&&wt.matrixWorldAutoUpdate===!0&&wt.updateMatrixWorld(),wt.isOrthographicCamera&&(Et=-(wt.right+wt.left)/2,Ct=(wt.top+wt.bottom)/2);const xt=wt.isOrthographicCamera?"scale("+It+")translate("+st(Et)+"px,"+st(Ct)+"px)"+ut(wt.matrixWorldInverse):"translateZ("+It+"px)"+ut(wt.matrixWorldInverse),Bt=xt+"translate("+h+"px,"+g+"px)";$.camera.style!==Bt&&(rt.style.transform=Bt,$.camera.style=Bt),gt(yt,yt,wt)},this.setSize=function(yt,wt){s=yt,a=wt,h=s/2,g=a/2,nt.style.width=yt+"px",nt.style.height=wt+"px",rt.style.width=yt+"px",rt.style.height=wt+"px"}}}var ZI,e2=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let oA=ZI=class extends Ks{constructor(c=!0){super(),this._scene=new d.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,i,s,a,h;const g=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();if(!(g!=null&&g.geometry))return void await((s=this._viewer)===null||s===void 0?void 0:s.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const $=await((a=this._viewer)===null||a===void 0?void 0:a.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!$)return;const nt=await((h=this._viewer)===null||h===void 0?void 0:h.prompt("Width: Enter the width for the object.","512",!1))||"512";nt&&this.attachIFrame(g,$,parseInt(nt))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=c,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const c=this._viewer;c&&this._renderer&&(c.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",c.canvas):this._renderer.domElement.appendChild(c.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new oN;const c=this._viewer.renderer.rendererObject.getSize(new d.FM8);this._renderer.setSize(c.width,c.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new d.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(c){await super.onAdded(c);let e=!0,i=!0;c.addEventListener("postFrame",h=>{var g,$;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(nt=>{var rt,st;let ut=!0;const mt=nt.modelObj.material.side;if(mt!==d.ehD){const gt=new d.Pa4(0,0,1).applyQuaternion(nt.cssObj.quaternion),yt=(st=(rt=this._viewer)===null||rt===void 0?void 0:rt.scene.activeCamera)===null||st===void 0?void 0:st.cameraObject,wt=gt.dot(yt.getWorldDirection(new d.Pa4));ut=mt===d._Li?wt>0:wt<0}nt.cssObj.element.style.visibility=ut?"visible":"hidden"}),this._trackers.filter(nt=>nt.dirty).forEach(nt=>this._syncProperties(nt)),(g=this._renderer)===null||g===void 0||g.render(this._scene,($=c.scene.activeCamera)===null||$===void 0?void 0:$.cameraObject),e=!1))}),c.addEventListener("update",h=>{this.enabled&&(e=this._trackers.length>0)}),c.scene.addEventListener("sceneUpdate",h=>{this.enabled&&(this._trackers.forEach(g=>g.dirty=!0),e=this._trackers.length>0)}),c.scene.addEventListener("activeCameraUpdate",h=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const a=new d.iMs;c.container.addEventListener("mousemove",h=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const g=this._viewer.canvas.getBoundingClientRect(),$=(h.clientX-g.x)/g.width*2-1,nt=-(h.clientY-g.y)/g.height*2+1;a.setFromCamera({x:$,y:nt},this._viewer.scene.activeCamera.cameraObject);const rt=this._trackers.map(ut=>ut.modelObj),st=a.intersectObjects(rt,!1);if(console.log(st),st.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(c,e,i){const s=n2(c.modelObject),a=jB(e,i,i*s.y/s.x,()=>{var h;return(h=c.setDirty)===null||h===void 0?void 0:h.call(c)});return this.attachCSS3DObject(a,c),a}attachCSS3DObject(c,e){var i,s,a,h,g;if(this._trackers.push({cssObj:c,modelObj:e.modelObject,dirty:!0}),c.element&&(this._resizeObserver.observe(c.element),c.element.__isCSS3DObjectElement=!0,console.log(c.element,c.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const $=(i=this._viewer)===null||i===void 0?void 0:i.createMaterial("basic",{opacity:0,color:new d.Ilk("black"),blending:d.jFi,side:d.Wl3});if(!$)throw"cannot create mat";$.userData.forcedLinearDepth=0,(s=e.setMaterial)===null||s===void 0||s.call(e,$),t2(e.modelObject),JP(e.modelObject),n2(e.modelObject),this._scene.add(c),(h=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a),(g=e.setDirty)===null||g===void 0||g.call(e)}_syncProperties(c){const e=c.modelObj,i=c.cssObj;e.updateMatrixWorld();const s=c.cssObj.element.clientWidth<1.5?0:(c.cssObj.element.clientWidth-1.5)/n2(e).x,a=t2(e);i.quaternion.setFromUnitVectors(new d.Pa4(0,0,1),a),i.position.copy(JP(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),c.dirty=!1}async onDispose(c){return this._resizeObserver.disconnect(),super.onDispose(c)}};function jB(c,e,i,s){const a=document.createElement("div");a.style.width=e.toString()+"px",a.style.height=i.toString()+"px",a.style.backgroundColor="transparent";const h=document.createElement("iframe",{is:"x-frame-bypass"});h.style.width="100%",h.style.height="100%",h.style.border="0px";const g=()=>{var $,nt;try{h.contentWindow.name}catch(rt){(typeof rt=="string"?rt:(nt=($=rt==null?void 0:rt.toString)===null||$===void 0?void 0:$.call(rt))!==null&&nt!==void 0?nt:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(rt)}s(),h.removeEventListener("load",g)};return h.addEventListener("load",g),h.src=c,a.appendChild(h),new iN(a)}function t2(c){if(c.geometry.userData.geometryNormal)return c.geometry.userData.geometryNormal;const e=c.geometry.attributes.normal,i=new d.Pa4,s=new d.Pa4;for(let a=0,h=e.count;a<h;a++)i.fromBufferAttribute(e,a),s.add(i);return s.normalize(),c.geometry.userData.geometryNormal=s,s}function JP(c){if(c.geometry.userData.geometryCenter)return c.geometry.userData.geometryCenter;const e=c.geometry;if(!e)return new d.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new d.Pa4);return c.geometry.userData.geometryCenter=i,i}function n2(c,e=new d.Pa4(0,0,1)){if(c.geometry.userData.geometrySize)return c.geometry.userData.geometrySize;const i=c.geometry;if(!i)return new d.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new d.yGw().makeRotationFromQuaternion(new d._fP().setFromUnitVectors(e,t2(c)).invert())),s.computeBoundingBox();const a=s.boundingBox.getSize(new d.Pa4);return c.geometry.userData.geometrySize=a,s.dispose(),a}oA.PluginType="CSS3DRenderer",e2([rs("Enabled"),hn(ZI.prototype._refreshEnabled),Qn()],oA.prototype,"enabled",void 0),e2([rs("Over canvas"),hn(ZI.prototype._refreshCanvasInDOM),Qn()],oA.prototype,"overCanvas",void 0),e2([No("Attach iframe")],oA.prototype,"attachIFrameToSelected",void 0),oA=ZI=e2([ho("CSS3D Renderer")],oA);const aN=1e4,zB=50;class tS{constructor(e=zB){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,i,s,a){const h=2e-4*this.naturalFrequency;if(e==null||a===0||e===i&&this.velocity===0)return i;if(s<0)return e;const g=e-i,$=this.velocity+this.naturalFrequency*g,nt=g+s*$,rt=Math.exp(-this.naturalFrequency*s),st=($-this.naturalFrequency*nt)*rt,ut=-this.naturalFrequency*(st+$*rt);return Math.abs(st)<h*Math.abs(a)&&ut*g>=0?(this.velocity=0,i):(this.velocity=st,i+nt*rt)}}const ZP=new d.Pa4;class VB{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new d.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new d.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new d.Pa4,this._hitMatrix=new d.yGw,this.xDamper=new tS,this.yDamper=new tS,this.zDamper=new tS,this.yawDamper=new tS,this.scaleDamper=new tS,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),a=this.presentedScene,h=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:g}=this.inputSource.gamepad||{axes:[0,0]},$=h.getHit(a,g[0],g[1]);h.show=!0,$!=null?(this.isTranslating=!0,this.lastDragPosition.copy($)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*g[0])}else if(s.length===2){h.show=!0,this.isTwoFingering=!0;const{separation:g}=this.fingerPolar(s);this.firstRatio=g/a.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s,a){var h;this.transientHitTestSource=await((h=e.requestHitTestSourceForTransientInput)===null||h===void 0?void 0:h.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=a,this.xr=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const s=(i=this.xr)===null||i===void 0?void 0:i.getReferenceSpace(),a=s?e.getPose(s):null;return a?(this._hitMatrix.fromArray(a.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,a=i.rotation.y,h=this.placementBox,g=Math.max(h.boundingSize.x,h.boundingSize.y,h.boundingSize.z)/2,$=this.goalPosition,nt=i.scale.x;if(!$.equals(s)||this.goalScale!==nt){let{x:rt,y:st,z:ut}=s;rt=this.xDamper.update(rt,$.x,e,g),st=this.yDamper.update(st,$.y,e,g),ut=this.zDamper.update(ut,$.z,e,g),s.set(rt,st,ut);const mt=this.scaleDamper.update(nt,this.goalScale,e,1);if(i.scale.set(mt,mt,mt),!this.isTranslating){const gt=$.y-st;this.placementComplete&&!this.placeOnWall?h.offsetHeight=gt/mt:gt===0&&(this.placementComplete=!0,h.show=!1)}}h.updateOpacity(e),i.rotation.y=this.yawDamper.update(a,this.goalYaw,e,Math.PI)}processInput(e){var i;this.frame=e;const s=this.transientHitTestSource;if(!s||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const a=e.getHitTestResultsForTransientInput(s),h=this.presentedScene,g=h.scale.x;if(this.isTwoFingering)if(a.length<2)this.isTwoFingering=!1;else{const{separation:$,deltaYaw:nt}=this.fingerPolar(a);if(this.placeOnWall||(this.goalYaw+=nt),!h.userData.__scaleDisabled){const rt=$/this.firstRatio;this.goalScale=rt<1.3&&rt>.7692307692307692?1:rt}}else if(a.length!==2)if(this.isRotating&&(!((i=this.inputSource)===null||i===void 0)&&i.gamepad)){const $=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=$-this.lastAngle,this.lastAngle=$}else this.isTranslating&&(console.log("translating"),a.forEach($=>{if($.inputSource!==this.inputSource)return;let nt=null;if($.results.length>0&&(nt=this.getHitPoint($.results[0])),nt==null&&(nt=this.getTouchLocation()),nt!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const rt=nt.y-this.lastDragPosition.y;if(rt<0){this.placementBox.offsetHeight=rt/g;const st=ZP.copy(this.xr.getCamera().position),ut=-rt/(st.y-nt.y);st.multiplyScalar(ut),nt.multiplyScalar(1-ut).add(st)}}this.goalPosition.add(nt),this.lastDragPosition.copy(nt)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:$}=this.fingerPolar(a);this.firstRatio=$/g}}getTouchLocation(){var e,i;const{axes:s}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},a=this.placementBox.getExpandedHit(this.presentedScene,s[0],s[1]);return a!=null&&(ZP.copy(a).sub((i=this.xr)===null||i===void 0?void 0:i.getCamera().position),ZP.length()>10)?null:a}fingerPolar(e){var i,s,a,h,g,$;const nt=(a=(s=(i=e[0].inputSource)===null||i===void 0?void 0:i.gamepad)===null||s===void 0?void 0:s.axes)!==null&&a!==void 0?a:[0,0],rt=($=(g=(h=e[1].inputSource)===null||h===void 0?void 0:h.gamepad)===null||g===void 0?void 0:g.axes)!==null&&$!==void 0?$:[0,0],st=rt[0]-nt[0],ut=rt[1]-nt[1],mt=Math.atan2(ut,st);let gt=this.lastAngle-mt;return gt>Math.PI?gt-=2*Math.PI:gt<-Math.PI&&(gt+=2*Math.PI),this.lastAngle=mt,{separation:Math.sqrt(st*st+ut*ut),deltaYaw:gt}}}const r2=.2,lN=Math.PI/24,QB=new d.FM8,i2=(c,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let a=0;a<=12;++a)c.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+r2*Math.cos(s),i+r2*Math.sin(s),0),s+=lN};class GB extends d.Kj0{constructor(e,i,s=!1){super(((nt,rt)=>{const st=new d.u9r,ut=[],mt=[],gt=nt.getSize(new d.Pa4),yt=gt.x/2,wt=(rt?gt.y:gt.z)/2;i2(mt,yt,wt),i2(mt,-yt,wt),i2(mt,-yt,-wt),i2(mt,yt,-wt);const It=mt.length/3;for(let Ct=0;Ct<It-2;Ct+=2)ut.push(Ct,Ct+1,Ct+3,Ct,Ct+3,Ct+2);const Et=It-2;return ut.push(Et,Et+1,1,Et,1,0),st.setAttribute("position",new d.a$l(mt,3)),st.setIndex(ut),st})(e,s)),this.boundingSize=new d.Pa4,this._raycaster=new d.iMs,this._camera=i,this._placeOnWall=s;const a=this.material;a.side=d.Wl3,a.color=new hs(16711935),a.opacity=0,this.userData.bboxVisible=!1;const h=e.getSize(this.boundingSize);console.log(e,s,h,this);const g=h.x/2,$=(s?h.y:h.z)/2;this.hitPlane=new d.Kj0(new d._12(2*(g+r2),2*($+r2))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){QB.set(i,-s),this.hitPlane.visible=!0;const a=this._positionAndNormalFromPoint(QB,this.hitPlane);return this.hitPlane.visible=!1,a==null?null:a.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const a=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),a}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var e;const{geometry:i,material:s}=this.hitPlane;i.dispose(),s.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const a=s[0];return a.face==null?null:a.uv==null?{position:a.point,normal:a.face.normal,uv:null}:(a.face.normal.applyNormalMatrix(new d.Vkp().getNormalMatrix(a.object.matrixWorld)),{position:a.point,normal:a.face.normal,uv:a.uv})}}class HB extends Ks{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new VB,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),i=e.cameras[0]||e,s=this._viewer.scene.activeCamera;s.cameraObject.projectionMatrix.copy(i.projectionMatrix),s.cameraObject.projectionMatrixInverse.copy(s.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,i;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,a=(i=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||i===void 0?void 0:i.cameras[0].viewport;a?s.rendererObject.setViewport(a):console.warn("no viewport for ar camera"),Br(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{s2.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:i})=>{var s,a;if(this.dirty=!!e&&((s=this._xrManager)===null||s===void 0?void 0:s.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const h=this._xrManager.getReferenceSpace(),g=e.getViewerPose(h);if(g==null&&this._frameCount,g==null||((a=this._viewer)===null||a===void 0?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const $=this._viewer.scene.activeCamera;this._xrManager.updateCamera($.cameraObject),$.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(i),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new d.Pa4(1,1,1),modelPosition:new d.Pa4,modelRotation:new d._fP,cameraPosition:new d.Pa4(0,0,5),cameraTarget:new d.Pa4,cameraUp:new d.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new d.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,i=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(i.position),this._preXRState.cameraTarget.copy(i.target),this._preXRState.cameraUp.copy(i.cameraObject.up),i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=i.cameraObject.fov,this._preXRState.cameraAspect=i.cameraObject.aspect),this._preXRState.cameraZoom=i.cameraObject.zoom,this._preXRState.cameraNear=i.cameraObject.near,this._preXRState.cameraFar=i.cameraObject.far;const s=this._viewer.getPluginByType("Ground");s!=null&&s.mesh&&(this._preXRState.groundOffset.subVectors(e.position,s.mesh.modelObject.position),this._preXRState.groundScale=s.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),s.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,i=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var s,a;if(this._xrSession){const h=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((a=(s=this._xrSession).requestHitTestSource)===null||a===void 0?void 0:a.call(s,{space:h,offsetRay:i}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const i=e.renderer.rendererObject.xr;i.enabled=!0,i.cameraAutoUpdate=!1,this._xrManager=i;const s=document.getElementById("tweakpaneUiContainer"),a=s?{root:s}:void 0;document.body.appendChild(class{static createButton(h,g={}){const $=document.createElement("button");function nt(){$.style.display="",$.style.cursor="auto",$.style.left="calc(50% - 75px)",$.style.width="150px",$.onmouseenter=null,$.onmouseleave=null,$.onclick=null}function rt(st){st.style.position="absolute",st.style.bottom="20px",st.style.padding="12px 6px",st.style.border="1px solid #fff",st.style.borderRadius="4px",st.style.background="rgba(0,0,0,0.1)",st.style.color="#fff",st.style.font="normal 13px sans-serif",st.style.textAlign="center",st.style.opacity="0.5",st.style.outline="none",st.style.zIndex="999"}if("xr"in navigator)return $.id="ARButton",$.style.display="none",rt($),navigator.xr.isSessionSupported("immersive-ar").then(function(st){st?function(){if(g.domOverlay===void 0){const yt=document.createElement("div");yt.style.display="none",document.body.appendChild(yt);const wt=document.createElementNS("http://www.w3.org/2000/svg","svg");wt.setAttribute("width",38),wt.setAttribute("height",38),wt.style.position="absolute",wt.style.right="20px",wt.style.top="20px",wt.addEventListener("click",function(){ut.end()}),yt.appendChild(wt);const It=document.createElementNS("http://www.w3.org/2000/svg","path");It.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),It.setAttribute("stroke","#fff"),It.setAttribute("stroke-width",2),wt.appendChild(It),g.optionalFeatures===void 0&&(g.optionalFeatures=[]),g.optionalFeatures.push("dom-overlay"),g.domOverlay={root:yt}}let ut=null;async function mt(yt){yt.addEventListener("end",gt),h.xr.setReferenceSpaceType("local"),await h.xr.setSession(yt),$.textContent="STOP AR",g.domOverlay.root.style.display="",ut=yt}function gt(){ut.removeEventListener("end",gt),$.textContent="START AR",g.domOverlay.root.style.display="none",ut=null}$.style.display="",$.style.cursor="pointer",$.style.left="calc(50% - 50px)",$.style.width="100px",$.textContent="START AR",$.onmouseenter=function(){$.style.opacity="1.0"},$.onmouseleave=function(){$.style.opacity="0.5"},$.onclick=function(){ut===null?navigator.xr.requestSession("immersive-ar",g).then(mt):ut.end()}}():(nt(),$.textContent="AR NOT SUPPORTED")}).catch(function(st){nt(),console.warn("Exception when trying to call xr.isSessionSupported",st),$.textContent="AR NOT ALLOWED"}),$;{const st=document.createElement("a");return window.isSecureContext===!1?(st.href=document.location.href.replace(/^http:/,"https:"),st.innerHTML="WEBXR NEEDS HTTPS"):(st.href="https://immersiveweb.dev/",st.innerHTML="WEBXR NOT AVAILABLE"),st.style.left="calc(50% - 90px)",st.style.width="180px",st.style.textDecoration="none",rt(st),st}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:a})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,i=this._viewer.getPluginByType("Ground");i&&(i.groundReflection=!1,i.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),i.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const i=e.getHitTestResults(this._hitTestSource);if(!i.length)return;const s=i[0],a=this._touchInputHelper.getHitPoint(s);a&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(a):this._touchInputHelper.goalPosition.y=a.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",a))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const i=this._viewer.scene.modelRoot,s=this._viewer.scene.activeCamera,a=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),h=a.cameras[0]||a;this._removePlacementBox();const g=this._viewer.scene.getBounds(!0,!0);g.getSize(new d.Pa4).length()>.01&&(this._placementBox=new GB(g,a,this.placeOnWall),i.add(this._placementBox),this._placementBox.show=!1);const $=a.getWorldDirection(new d.Pa4);i.rotation.y=Math.atan2(-$.x,-$.z)-0,s.cameraObject.zoom=h.zoom,s.cameraObject.near=h.near,s.cameraObject.far=h.far,s.cameraObject.isPerspectiveCamera?(s.cameraObject.fov=h.fov,s.cameraObject.aspect=h.viewport.width/h.viewport.height):console.warn("Perspective camera required."),s.cameraObject.updateProjectionMatrix(),i.position.set(0,0,0);const nt=i.userData.arScale||1;i.scale.set(nt,nt,nt),i.position.copy(a.position).add($.multiplyScalar(5)),i.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const i=this._viewer.scene.activeCamera;i.position.copy(this._preXRState.cameraPosition),i.target.copy(this._preXRState.cameraTarget),i.cameraObject.up.copy(this._preXRState.cameraUp),i.cameraObject.near=this._preXRState.cameraNear,i.cameraObject.far=this._preXRState.cameraFar,i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(i.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(i.cameraObject.aspect=this._preXRState.cameraAspect)),i.positionUpdated(!1),i.targetUpdated(!0),i.cameraObject.updateMatrixWorld(!0),i.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}HB.PluginType="WEBXR_ARPlugin";const s2=new Ot({vertexShader:it.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:it.uniforms});async function WB(c,e){if(c.createWriter){const s=await c.createWriter();return await s.write(0,e),void await s.close()}const i=await c.createWritable();await i.write(e),await i.close()}async function cN(c,e){const i={};return e&&(i.writable=!0,i.mode="readwrite"),await c.queryPermission(i)==="granted"||await c.requestPermission(i)==="granted"}s2.renderToScreen=!1,s2.useExistingRenderTarget=!0,s2.clear=!1;class lM extends _e{constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=a=>{var h;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const g=new Blob(this._currentRecording,{type:this._options.mimeType});(h=this._recordingCallback)===null||h===void 0||h.call(this,g)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=a=>{var h;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((h=this._recorder)===null||h===void 0||h.pause())},this._onresume=a=>{if(!this.stepMode)return;const h=()=>{var $;this._state==="recording"&&(($=this._recorder)===null||$===void 0||$.pause())},g=Math.min(this._resumeSyncTime-po(),0)+1e3/this._options.frameRate;g>0?ou(g).then(h):h()},this._onpause=a=>{},this._ondataavailable=a=>{a.data&&a.data.size>0&&this._currentRecording.push(a.data)},this._onerror=a=>{this._state="error",this._console.error(a),this.dispatchEvent({type:"error",error:a}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30},this._setOptions(i||this._options)}_setOptions(e){var i,s;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(i=lM.GetSupportedMimeTypes([],["h264"],!0))!==null&&i!==void 0?i:lM.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((s=this._options.mimeType)===null||s===void 0)&&s.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,i,s;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const a={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=a.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const h=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),g=(i=h.getVideoTracks())===null||i===void 0?void 0:i[0];this._track=g,this._recorder=new window.MediaRecorder(h,a),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(s=this._recorder)===null||s===void 0||s.start()):window.showDirectoryPicker&&window.showDirectoryPicker().then(async h=>{const g=await(h==null?void 0:h.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=g,this._state="recording",this._onstart({})}).catch(h=>{this._onerror({detail:h})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=po(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([a,h])=>await(await fetch(h)).blob())),s=[];for(let a=0;a<e.length;a++){const h=await this._imgDirectory.getFileHandle(e[a][0],{create:!0});s.push(WB(h,i[a]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const a=["webm","ogg","mp4","x-matroska"].filter($=>!e||e.length<1||e.includes($)),h=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter($=>!i||i.length<1||i.includes($)),g=[];return a.forEach($=>{const nt=`video/${$}`;h.forEach(rt=>{[`${nt};codecs=${rt}`,`${nt};codecs:${rt}`,`${nt};codecs=${rt.toUpperCase()}`,`${nt};codecs:${rt.toUpperCase()}`,`${nt}`].forEach(st=>{MediaRecorder.isTypeSupported(st)&&g.push(st)})})}),s?g.length>0?g[0]:void 0:g}}var eD=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class uy extends Ks{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const a=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0?void 0:s.isConverged())||!1,a&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0)&&s.isConverged(!0))){const a=()=>{var h;return(h=this._recorder)===null||h===void 0?void 0:h.requestFrame()};this.convergeMode?ou(1).then(a):a()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)}}get recorder(){return this._recorder}isRecording(){var e,i;return(i=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&i!==void 0&&i}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new lM(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var i,s,a;this.dirty=e,(i=this._viewer)===null||i===void 0||i.setDirty(),(a=(s=this._uiConfig)===null||s===void 0?void 0:s.children)===null||a===void 0||a.map(h=>Ht(h)).flat(2).forEach(h=>{var g;return(g=h==null?void 0:h.uiRefresh)===null||g===void 0?void 0:g.call(h)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),(i=this._recorder)===null||i===void 0||i.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((i,s)=>{var a;return(a=this.recorder)===null||a===void 0?void 0:a.stop(i)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(i=>({label:i[0],value:i[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var i,s;return(s=(i=e.recorder)===null||i===void 0?void 0:i.state)!==null&&s!==void 0?s:"not initialized"},set value(i){}},{type:"button",get label(){var i;return!((i=e.recorder)===null||i===void 0)&&i.isRecording()?"Stop":"Start"},value:()=>{var i;!((i=e.recorder)===null||i===void 0)&&i.isRecording()?this.stopRecording().then(s=>{if(s){console.log(s);const a=s.type.split(";")[0].split("/").pop()||"mp4";Tu(s,"test."+a)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var i,s;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))},value:()=>{var i,s;(s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews"))===null||s===void 0||s.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var i,s,a,h;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))||!(!((h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("GLTFAnimation"))===null||h===void 0)&&h.animations.length)},value:()=>{var i,s,a,h;const g=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("GLTFAnimation"))===null||s===void 0?void 0:s.animationState)==="playing";(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("CameraViews"))===null||h===void 0||h.recordAllViews(()=>{var $,nt;(nt=($=this._viewer)===null||$===void 0?void 0:$.getPluginByType("GLTFAnimation"))===null||nt===void 0||nt.playAnimation()}).then(()=>{var $,nt;g||(nt=($=this._viewer)===null||$===void 0?void 0:$.getPluginByType("GLTFAnimation"))===null||nt===void 0||nt.stopAnimation()})}}]}}}uy.PluginType="CanvasRecorder",eD([hn(uy.prototype.refreshRecorderOptions),Qn()],uy.prototype,"convergeMode",void 0),eD([hn(uy.prototype.refreshRecorderOptions),Qn()],uy.prototype,"mimeType",void 0),eD([hn(uy.prototype.refreshRecorderOptions),Qn()],uy.prototype,"videoFrameRate",void 0);var o2=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const tD=new d.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});tD.depthTest=!1;const nD=new d.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});nD.depthTest=!1;class hy extends Cp{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new d.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push(Mv)}async onAdded(e){const i=e.renderer.createTarget({type:d.ywz,format:d.wk1,encoding:d.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:d.wem,magFilter:d.wem});i.texture.name="groundContactDepthTexture";const s=new d.lRF({depthPacking:d.z81});s.onBeforeCompile=function(h){h.uniforms.opacity.value=1,h.fragmentShader=`
						${h.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const a=new VM(i,s);this._depthPass=a,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:d.ywz,format:d.wk1,encoding:d.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:d.wem,magFilter:d.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(tD.uniforms.h.value=i*this.blurAmount/256,nD.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:tD,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:nD,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new d.Pa4)),this.shadowCamera.setRotationFromEuler(new d.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const i=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,i&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),i}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}hy.PluginType="ContactShadowGroundPlugin",o2([hn(hy.prototype.refreshOptions),Qn()],hy.prototype,"contactShadows",void 0),o2([Qn(),hn(hy.prototype._setDirty)],hy.prototype,"blurAmount",void 0),o2([Qn(),hn(hy.prototype._refreshShadowCameraFrustum)],hy.prototype,"shadowScale",void 0),o2([Qn(),hn(hy.prototype._refreshShadowCameraFrustum)],hy.prototype,"shadowHeight",void 0);const nS=new d.cPb(45,1,.1,1e3);function rD(c,e,i,s=7,a=new d.Pa4(0,0,1.5)){i=i??c.scene.modelObject;const h=new ar().expandByObject(i??e,!0,!0),g=h.getCenter(new d.Pa4),$=h.getSize(new d.Pa4);nS.position.copy(g).add(a.clone().multiplyScalar(Math.max($.x,$.y,$.z))),nS.lookAt(g),e&&e.traverseVisible(st=>{st.layers.enable(s)}),s>0?nS.layers.set(s):nS.layers.enableAll();const nt=e==null?void 0:e.visible;e&&(e.visible=!0),c.renderer.rendererObject.setRenderTarget(null),c.renderer.rendererObject.render(i,nS);const rt=c.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=nt,e.traverseVisible(st=>{st.layers.disable(s)}),nS.layers.enableAll()),c.setDirty(),rt}class iD{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new d.Kj0(new d.xo$(1)),cube:new d.Kj0(new d.DvJ(1,1,1)),cylinder:new d.Kj0(new d.fHI(.5,.5,1))};const i=new d.xsS;this._channel=7;const s=new d.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new d.Kj0(new d.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const a=s.material.envMapIntensity;typeof a=="number"&&(s.material.envMapIntensity=Math.max(a,2));const h=rD(this.viewer,s,this._scene,this._channel,new d.Pa4(0,0,1.5));return typeof a=="number"&&(s.material.envMapIntensity=a),this._scene.remove(s),s.material=void 0,h}}class a2 extends Ks{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e))},this.dependencies=[Jr],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Dw).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new iD(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())===null||i===void 0?void 0:i.name)}applyVariation(e,i){var s,a;const h=e.materials.find(g=>g.uuid===i);if(h){const g=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials;let $=g==null?void 0:g.findMaterialsByName(e.uuid);(!$||$.length<1)&&($=[g==null?void 0:g.findMaterial(e.uuid)]),$.forEach(nt=>{if(!nt)return;const rt=nt.name;nt.copyProps(h),nt.name=rt})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var i;const s=(i=e==null?void 0:e.clone)===null||i===void 0?void 0:i.call(e);if(e&&s){let a=this.findVariation(e.uuid);!a&&e.name.length>0&&(a=this.findVariation(e.name)),a||this.variations.push(a={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),a.materials.push(s),this.refreshUi()}}}a2.PluginType="MaterialConfiguratorBasePlugin",function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)}([Qn()],a2.prototype,"variations",void 0);const qB=(c,e=!0)=>{const i=new hs().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},YB=(c,e=!0)=>{const i=new hs().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},cM=c=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${c}%3C/text%3E%3C/svg%3E%0A`,sD=async(c,e)=>Iu(await _A(c),e),XB=async(c,e)=>await sD(c,e).then(i=>i.toDataURL("image/png"));class f0{static _initialize(){this._inited=!0,Gv(Wt`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,i,s,a,h,g,$){var nt;this._inited||this._initialize();const rt=Pw(),st=rt?.15:.25,ut=rt?1.5:2.5,mt=Ml({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});mt.style.top=h+"px",mt.style.left=a+"px",mt.style.gap=st+"rem",mt.style.width=(ut+st)*s-st+"rem",mt.dataset.tag=e;for(const gt of g){const yt=Ml({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${gt.image}" class="customContextGridItemImage">
            `});yt.style.width=ut+"rem",yt.style.height=ut+"rem",mt.appendChild(yt),yt.onclick=()=>{var wt;return(wt=gt.onClick)===null||wt===void 0?void 0:wt.call(gt,gt.id)},$(yt,gt)}return(nt=this.Elements)===null||nt===void 0||nt.push(mt),mt}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const s of this.Elements)s.remove();let i=20;for(const s of this.Elements)s.style.top=i+"px",e.appendChild(s),i+=s.clientHeight+20}}function m0(c){if(c==null)return window;if(c.toString()!=="[object Window]"){var e=c.ownerDocument;return e&&e.defaultView||window}return c}function rS(c){return c instanceof m0(c).Element||c instanceof Element}function __(c){return c instanceof m0(c).HTMLElement||c instanceof HTMLElement}function oD(c){return typeof ShadowRoot<"u"&&(c instanceof m0(c).ShadowRoot||c instanceof ShadowRoot)}f0.Elements=[],f0._inited=!1;var o1=Math.max,l2=Math.min,iS=Math.round;function sS(c,e){e===void 0&&(e=!1);var i=c.getBoundingClientRect(),s=1,a=1;if(__(c)&&e){var h=c.offsetHeight,g=c.offsetWidth;g>0&&(s=iS(i.width)/g||1),h>0&&(a=iS(i.height)/h||1)}return{width:i.width/s,height:i.height/a,top:i.top/a,right:i.right/s,bottom:i.bottom/a,left:i.left/s,x:i.left/s,y:i.top/a}}function aD(c){var e=m0(c);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function dy(c){return c?(c.nodeName||"").toLowerCase():null}function Aw(c){return((rS(c)?c.ownerDocument:c.document)||window.document).documentElement}function lD(c){return sS(Aw(c)).left+aD(c).scrollLeft}function aA(c){return m0(c).getComputedStyle(c)}function cD(c){var e=aA(c),i=e.overflow,s=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+a+s)}function uN(c,e,i){i===void 0&&(i=!1);var s,a,h=__(e),g=__(e)&&function(ut){var mt=ut.getBoundingClientRect(),gt=iS(mt.width)/ut.offsetWidth||1,yt=iS(mt.height)/ut.offsetHeight||1;return gt!==1||yt!==1}(e),$=Aw(e),nt=sS(c,g),rt={scrollLeft:0,scrollTop:0},st={x:0,y:0};return(h||!h&&!i)&&((dy(e)!=="body"||cD($))&&(rt=(s=e)!==m0(s)&&__(s)?{scrollLeft:(a=s).scrollLeft,scrollTop:a.scrollTop}:aD(s)),__(e)?((st=sS(e,!0)).x+=e.clientLeft,st.y+=e.clientTop):$&&(st.x=lD($))),{x:nt.left+rt.scrollLeft-st.x,y:nt.top+rt.scrollTop-st.y,width:nt.width,height:nt.height}}function uD(c){var e=sS(c),i=c.offsetWidth,s=c.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:c.offsetLeft,y:c.offsetTop,width:i,height:s}}function c2(c){return dy(c)==="html"?c:c.assignedSlot||c.parentNode||(oD(c)?c.host:null)||Aw(c)}function KB(c){return["html","body","#document"].indexOf(dy(c))>=0?c.ownerDocument.body:__(c)&&cD(c)?c:KB(c2(c))}function uM(c,e){var i;e===void 0&&(e=[]);var s=KB(c),a=s===((i=c.ownerDocument)==null?void 0:i.body),h=m0(s),g=a?[h].concat(h.visualViewport||[],cD(s)?s:[]):s,$=e.concat(g);return a?$:$.concat(uM(c2(g)))}function hN(c){return["table","td","th"].indexOf(dy(c))>=0}function $B(c){return __(c)&&aA(c).position!=="fixed"?c.offsetParent:null}function hM(c){for(var e=m0(c),i=$B(c);i&&hN(i)&&aA(i).position==="static";)i=$B(i);return i&&(dy(i)==="html"||dy(i)==="body"&&aA(i).position==="static")?e:i||function(s){var a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&__(s)&&aA(s).position==="fixed")return null;var h=c2(s);for(oD(h)&&(h=h.host);__(h)&&["html","body"].indexOf(dy(h))<0;){var g=aA(h);if(g.transform!=="none"||g.perspective!=="none"||g.contain==="paint"||["transform","perspective"].indexOf(g.willChange)!==-1||a&&g.willChange==="filter"||a&&g.filter&&g.filter!=="none")return h;h=h.parentNode}return null}(c)||e}var km="top",Ov="bottom",Lv="right",Bm="left",u2="auto",oS=[km,Ov,Lv,Bm],a1="start",aS="end",JB="clippingParents",hD="viewport",lS="popper",ZB="reference",dD=oS.reduce(function(c,e){return c.concat([e+"-"+a1,e+"-"+aS])},[]),pD=[].concat(oS,[u2]).reduce(function(c,e){return c.concat([e,e+"-"+a1,e+"-"+aS])},[]),e3="beforeRead",t3="read",n3="afterRead",r3="beforeMain",i3="main",s3="afterMain",o3="beforeWrite",a3="write",l3="afterWrite",c3=[e3,t3,n3,r3,i3,s3,o3,a3,l3];function dN(c){var e=new Map,i=new Set,s=[];function a(h){i.add(h.name),[].concat(h.requires||[],h.requiresIfExists||[]).forEach(function(g){if(!i.has(g)){var $=e.get(g);$&&a($)}}),s.push(h)}return c.forEach(function(h){e.set(h.name,h)}),c.forEach(function(h){i.has(h.name)||a(h)}),s}var u3={placement:"bottom",modifiers:[],strategy:"absolute"};function h3(){for(var c=arguments.length,e=new Array(c),i=0;i<c;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function h2(c){c===void 0&&(c={});var e=c,i=e.defaultModifiers,s=i===void 0?[]:i,a=e.defaultOptions,h=a===void 0?u3:a;return function(g,$,nt){nt===void 0&&(nt=h);var rt,st,ut={placement:"bottom",orderedModifiers:[],options:Object.assign({},u3,h),modifiersData:{},elements:{reference:g,popper:$},attributes:{},styles:{}},mt=[],gt=!1,yt={state:ut,setOptions:function(It){var Et=typeof It=="function"?It(ut.options):It;wt(),ut.options=Object.assign({},h,ut.options,Et),ut.scrollParents={reference:rS(g)?uM(g):g.contextElement?uM(g.contextElement):[],popper:uM($)};var Ct,xt,Bt=function(Lt){var Gt=dN(Lt);return c3.reduce(function(Xt,rn){return Xt.concat(Gt.filter(function(fn){return fn.phase===rn}))},[])}((Ct=[].concat(s,ut.options.modifiers),xt=Ct.reduce(function(Lt,Gt){var Xt=Lt[Gt.name];return Lt[Gt.name]=Xt?Object.assign({},Xt,Gt,{options:Object.assign({},Xt.options,Gt.options),data:Object.assign({},Xt.data,Gt.data)}):Gt,Lt},{}),Object.keys(xt).map(function(Lt){return xt[Lt]})));return ut.orderedModifiers=Bt.filter(function(Lt){return Lt.enabled}),ut.orderedModifiers.forEach(function(Lt){var Gt=Lt.name,Xt=Lt.options,rn=Xt===void 0?{}:Xt,fn=Lt.effect;if(typeof fn=="function"){var wn=fn({state:ut,name:Gt,instance:yt,options:rn});mt.push(wn||function(){})}}),yt.update()},forceUpdate:function(){if(!gt){var It=ut.elements,Et=It.reference,Ct=It.popper;if(h3(Et,Ct)){ut.rects={reference:uN(Et,hM(Ct),ut.options.strategy==="fixed"),popper:uD(Ct)},ut.reset=!1,ut.placement=ut.options.placement,ut.orderedModifiers.forEach(function(fn){return ut.modifiersData[fn.name]=Object.assign({},fn.data)});for(var xt=0;xt<ut.orderedModifiers.length;xt++)if(ut.reset!==!0){var Bt=ut.orderedModifiers[xt],Lt=Bt.fn,Gt=Bt.options,Xt=Gt===void 0?{}:Gt,rn=Bt.name;typeof Lt=="function"&&(ut=Lt({state:ut,options:Xt,name:rn,instance:yt})||ut)}else ut.reset=!1,xt=-1}}},update:(rt=function(){return new Promise(function(It){yt.forceUpdate(),It(ut)})},function(){return st||(st=new Promise(function(It){Promise.resolve().then(function(){st=void 0,It(rt())})})),st}),destroy:function(){wt(),gt=!0}};if(!h3(g,$))return yt;function wt(){mt.forEach(function(It){return It()}),mt=[]}return yt.setOptions(nt).then(function(It){!gt&&nt.onFirstUpdate&&nt.onFirstUpdate(It)}),yt}}var pN=h2(),d2={passive:!0},fD={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(c){var e=c.state,i=c.instance,s=c.options,a=s.scroll,h=a===void 0||a,g=s.resize,$=g===void 0||g,nt=m0(e.elements.popper),rt=[].concat(e.scrollParents.reference,e.scrollParents.popper);return h&&rt.forEach(function(st){st.addEventListener("scroll",i.update,d2)}),$&&nt.addEventListener("resize",i.update,d2),function(){h&&rt.forEach(function(st){st.removeEventListener("scroll",i.update,d2)}),$&&nt.removeEventListener("resize",i.update,d2)}},data:{}};function py(c){return c.split("-")[0]}function cS(c){return c.split("-")[1]}function mD(c){return["top","bottom"].indexOf(c)>=0?"x":"y"}function d3(c){var e,i=c.reference,s=c.element,a=c.placement,h=a?py(a):null,g=a?cS(a):null,$=i.x+i.width/2-s.width/2,nt=i.y+i.height/2-s.height/2;switch(h){case km:e={x:$,y:i.y-s.height};break;case Ov:e={x:$,y:i.y+i.height};break;case Lv:e={x:i.x+i.width,y:nt};break;case Bm:e={x:i.x-s.width,y:nt};break;default:e={x:i.x,y:i.y}}var rt=h?mD(h):null;if(rt!=null){var st=rt==="y"?"height":"width";switch(g){case a1:e[rt]=e[rt]-(i[st]/2-s[st]/2);break;case aS:e[rt]=e[rt]+(i[st]/2-s[st]/2)}}return e}var gD={name:"popperOffsets",enabled:!0,phase:"read",fn:function(c){var e=c.state,i=c.name;e.modifiersData[i]=d3({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},fN={top:"auto",right:"auto",bottom:"auto",left:"auto"};function p3(c){var e,i=c.popper,s=c.popperRect,a=c.placement,h=c.variation,g=c.offsets,$=c.position,nt=c.gpuAcceleration,rt=c.adaptive,st=c.roundOffsets,ut=c.isFixed,mt=g.x,gt=mt===void 0?0:mt,yt=g.y,wt=yt===void 0?0:yt,It=typeof st=="function"?st({x:gt,y:wt}):{x:gt,y:wt};gt=It.x,wt=It.y;var Et=g.hasOwnProperty("x"),Ct=g.hasOwnProperty("y"),xt=Bm,Bt=km,Lt=window;if(rt){var Gt=hM(i),Xt="clientHeight",rn="clientWidth";Gt===m0(i)&&aA(Gt=Aw(i)).position!=="static"&&$==="absolute"&&(Xt="scrollHeight",rn="scrollWidth"),(a===km||(a===Bm||a===Lv)&&h===aS)&&(Bt=Ov,wt-=(ut&&Gt===Lt&&Lt.visualViewport?Lt.visualViewport.height:Gt[Xt])-s.height,wt*=nt?1:-1),a!==Bm&&(a!==km&&a!==Ov||h!==aS)||(xt=Lv,gt-=(ut&&Gt===Lt&&Lt.visualViewport?Lt.visualViewport.width:Gt[rn])-s.width,gt*=nt?1:-1)}var fn,wn=Object.assign({position:$},rt&&fN),Cn=st===!0?function(bn){var Dn=bn.x,En=bn.y,Tn=window.devicePixelRatio||1;return{x:iS(Dn*Tn)/Tn||0,y:iS(En*Tn)/Tn||0}}({x:gt,y:wt}):{x:gt,y:wt};return gt=Cn.x,wt=Cn.y,nt?Object.assign({},wn,((fn={})[Bt]=Ct?"0":"",fn[xt]=Et?"0":"",fn.transform=(Lt.devicePixelRatio||1)<=1?"translate("+gt+"px, "+wt+"px)":"translate3d("+gt+"px, "+wt+"px, 0)",fn)):Object.assign({},wn,((e={})[Bt]=Ct?wt+"px":"",e[xt]=Et?gt+"px":"",e.transform="",e))}var vD={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(c){var e=c.state,i=c.options,s=i.gpuAcceleration,a=s===void 0||s,h=i.adaptive,g=h===void 0||h,$=i.roundOffsets,nt=$===void 0||$,rt={placement:py(e.placement),variation:cS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,p3(Object.assign({},rt,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:g,roundOffsets:nt})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,p3(Object.assign({},rt,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:nt})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},p2={name:"applyStyles",enabled:!0,phase:"write",fn:function(c){var e=c.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},a=e.attributes[i]||{},h=e.elements[i];__(h)&&dy(h)&&(Object.assign(h.style,s),Object.keys(a).forEach(function(g){var $=a[g];$===!1?h.removeAttribute(g):h.setAttribute(g,$===!0?"":$)}))})},effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var a=e.elements[s],h=e.attributes[s]||{},g=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function($,nt){return $[nt]="",$},{});__(a)&&dy(a)&&(Object.assign(a.style,g),Object.keys(h).forEach(function($){a.removeAttribute($)}))})}},requires:["computeStyles"]},f3={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.offset,h=a===void 0?[0,0]:a,g=pD.reduce(function(st,ut){return st[ut]=function(mt,gt,yt){var wt=py(mt),It=[Bm,km].indexOf(wt)>=0?-1:1,Et=typeof yt=="function"?yt(Object.assign({},gt,{placement:mt})):yt,Ct=Et[0],xt=Et[1];return Ct=Ct||0,xt=(xt||0)*It,[Bm,Lv].indexOf(wt)>=0?{x:xt,y:Ct}:{x:Ct,y:xt}}(ut,e.rects,h),st},{}),$=g[e.placement],nt=$.x,rt=$.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=nt,e.modifiersData.popperOffsets.y+=rt),e.modifiersData[s]=g}},mN={left:"right",right:"left",bottom:"top",top:"bottom"};function f2(c){return c.replace(/left|right|bottom|top/g,function(e){return mN[e]})}var gN={start:"end",end:"start"};function m3(c){return c.replace(/start|end/g,function(e){return gN[e]})}function g3(c,e){var i=e.getRootNode&&e.getRootNode();if(c.contains(e))return!0;if(i&&oD(i)){var s=e;do{if(s&&c.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function _D(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}function v3(c,e){return e===hD?_D(function(i){var s=m0(i),a=Aw(i),h=s.visualViewport,g=a.clientWidth,$=a.clientHeight,nt=0,rt=0;return h&&(g=h.width,$=h.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(nt=h.offsetLeft,rt=h.offsetTop)),{width:g,height:$,x:nt+lD(i),y:rt}}(c)):rS(e)?function(i){var s=sS(i);return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}(e):_D(function(i){var s,a=Aw(i),h=aD(i),g=(s=i.ownerDocument)==null?void 0:s.body,$=o1(a.scrollWidth,a.clientWidth,g?g.scrollWidth:0,g?g.clientWidth:0),nt=o1(a.scrollHeight,a.clientHeight,g?g.scrollHeight:0,g?g.clientHeight:0),rt=-h.scrollLeft+lD(i),st=-h.scrollTop;return aA(g||a).direction==="rtl"&&(rt+=o1(a.clientWidth,g?g.clientWidth:0)-$),{width:$,height:nt,x:rt,y:st}}(Aw(c)))}function _3(c){return Object.assign({},{top:0,right:0,bottom:0,left:0},c)}function y3(c,e){return e.reduce(function(i,s){return i[s]=c,i},{})}function uS(c,e){e===void 0&&(e={});var i=e,s=i.placement,a=s===void 0?c.placement:s,h=i.boundary,g=h===void 0?JB:h,$=i.rootBoundary,nt=$===void 0?hD:$,rt=i.elementContext,st=rt===void 0?lS:rt,ut=i.altBoundary,mt=ut!==void 0&&ut,gt=i.padding,yt=gt===void 0?0:gt,wt=_3(typeof yt!="number"?yt:y3(yt,oS)),It=st===lS?ZB:lS,Et=c.rects.popper,Ct=c.elements[mt?It:st],xt=function(Cn,bn,Dn){var En=bn==="clippingParents"?function(Yn){var cr=uM(c2(Yn)),mr=["absolute","fixed"].indexOf(aA(Yn).position)>=0&&__(Yn)?hM(Yn):Yn;return rS(mr)?cr.filter(function(ir){return rS(ir)&&g3(ir,mr)&&dy(ir)!=="body"}):[]}(Cn):[].concat(bn),Tn=[].concat(En,[Dn]),Un=Tn[0],Pn=Tn.reduce(function(Yn,cr){var mr=v3(Cn,cr);return Yn.top=o1(mr.top,Yn.top),Yn.right=l2(mr.right,Yn.right),Yn.bottom=l2(mr.bottom,Yn.bottom),Yn.left=o1(mr.left,Yn.left),Yn},v3(Cn,Un));return Pn.width=Pn.right-Pn.left,Pn.height=Pn.bottom-Pn.top,Pn.x=Pn.left,Pn.y=Pn.top,Pn}(rS(Ct)?Ct:Ct.contextElement||Aw(c.elements.popper),g,nt),Bt=sS(c.elements.reference),Lt=d3({reference:Bt,element:Et,strategy:"absolute",placement:a}),Gt=_D(Object.assign({},Et,Lt)),Xt=st===lS?Gt:Bt,rn={top:xt.top-Xt.top+wt.top,bottom:Xt.bottom-xt.bottom+wt.bottom,left:xt.left-Xt.left+wt.left,right:Xt.right-xt.right+wt.right},fn=c.modifiersData.offset;if(st===lS&&fn){var wn=fn[a];Object.keys(rn).forEach(function(Cn){var bn=[Lv,Ov].indexOf(Cn)>=0?1:-1,Dn=[km,Ov].indexOf(Cn)>=0?"y":"x";rn[Cn]+=wn[Dn]*bn})}return rn}var A3={name:"flip",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name;if(!e.modifiersData[s]._skip){for(var a=i.mainAxis,h=a===void 0||a,g=i.altAxis,$=g===void 0||g,nt=i.fallbackPlacements,rt=i.padding,st=i.boundary,ut=i.rootBoundary,mt=i.altBoundary,gt=i.flipVariations,yt=gt===void 0||gt,wt=i.allowedAutoPlacements,It=e.options.placement,Et=py(It),Ct=nt||(Et!==It&&yt?function(ir){if(py(ir)===u2)return[];var Dr=f2(ir);return[m3(ir),Dr,m3(Dr)]}(It):[f2(It)]),xt=[It].concat(Ct).reduce(function(ir,Dr){return ir.concat(py(Dr)===u2?function(Nr,Fr){Fr===void 0&&(Fr={});var Vr=Fr,ps=Vr.placement,yr=Vr.boundary,Ws=Vr.rootBoundary,lo=Vr.padding,qs=Vr.flipVariations,Bo=Vr.allowedAutoPlacements,xa=Bo===void 0?pD:Bo,dr=cS(ps),jr=dr?qs?dD:dD.filter(function(Jo){return cS(Jo)===dr}):oS,zr=jr.filter(function(Jo){return xa.indexOf(Jo)>=0});zr.length===0&&(zr=jr);var Ys=zr.reduce(function(Jo,vn){return Jo[vn]=uS(Nr,{placement:vn,boundary:yr,rootBoundary:Ws,padding:lo})[py(vn)],Jo},{});return Object.keys(Ys).sort(function(Jo,vn){return Ys[Jo]-Ys[vn]})}(e,{placement:Dr,boundary:st,rootBoundary:ut,padding:rt,flipVariations:yt,allowedAutoPlacements:wt}):Dr)},[]),Bt=e.rects.reference,Lt=e.rects.popper,Gt=new Map,Xt=!0,rn=xt[0],fn=0;fn<xt.length;fn++){var wn=xt[fn],Cn=py(wn),bn=cS(wn)===a1,Dn=[km,Ov].indexOf(Cn)>=0,En=Dn?"width":"height",Tn=uS(e,{placement:wn,boundary:st,rootBoundary:ut,altBoundary:mt,padding:rt}),Un=Dn?bn?Lv:Bm:bn?Ov:km;Bt[En]>Lt[En]&&(Un=f2(Un));var Pn=f2(Un),Yn=[];if(h&&Yn.push(Tn[Cn]<=0),$&&Yn.push(Tn[Un]<=0,Tn[Pn]<=0),Yn.every(function(ir){return ir})){rn=wn,Xt=!1;break}Gt.set(wn,Yn)}if(Xt)for(var cr=function(ir){var Dr=xt.find(function(Nr){var Fr=Gt.get(Nr);if(Fr)return Fr.slice(0,ir).every(function(Vr){return Vr})});if(Dr)return rn=Dr,"break"},mr=yt?3:1;mr>0&&cr(mr)!=="break";mr--);e.placement!==rn&&(e.modifiersData[s]._skip=!0,e.placement=rn,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function dM(c,e,i){return o1(c,l2(e,i))}var w3={name:"preventOverflow",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.mainAxis,h=a===void 0||a,g=i.altAxis,$=g!==void 0&&g,nt=i.boundary,rt=i.rootBoundary,st=i.altBoundary,ut=i.padding,mt=i.tether,gt=mt===void 0||mt,yt=i.tetherOffset,wt=yt===void 0?0:yt,It=uS(e,{boundary:nt,rootBoundary:rt,padding:ut,altBoundary:st}),Et=py(e.placement),Ct=cS(e.placement),xt=!Ct,Bt=mD(Et),Lt=Bt==="x"?"y":"x",Gt=e.modifiersData.popperOffsets,Xt=e.rects.reference,rn=e.rects.popper,fn=typeof wt=="function"?wt(Object.assign({},e.rects,{placement:e.placement})):wt,wn=typeof fn=="number"?{mainAxis:fn,altAxis:fn}:Object.assign({mainAxis:0,altAxis:0},fn),Cn=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,bn={x:0,y:0};if(Gt){if(h){var Dn,En=Bt==="y"?km:Bm,Tn=Bt==="y"?Ov:Lv,Un=Bt==="y"?"height":"width",Pn=Gt[Bt],Yn=Pn+It[En],cr=Pn-It[Tn],mr=gt?-rn[Un]/2:0,ir=Ct===a1?Xt[Un]:rn[Un],Dr=Ct===a1?-rn[Un]:-Xt[Un],Nr=e.elements.arrow,Fr=gt&&Nr?uD(Nr):{width:0,height:0},Vr=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},ps=Vr[En],yr=Vr[Tn],Ws=dM(0,Xt[Un],Fr[Un]),lo=xt?Xt[Un]/2-mr-Ws-ps-wn.mainAxis:ir-Ws-ps-wn.mainAxis,qs=xt?-Xt[Un]/2+mr+Ws+yr+wn.mainAxis:Dr+Ws+yr+wn.mainAxis,Bo=e.elements.arrow&&hM(e.elements.arrow),xa=Bo?Bt==="y"?Bo.clientTop||0:Bo.clientLeft||0:0,dr=(Dn=Cn==null?void 0:Cn[Bt])!=null?Dn:0,jr=Pn+qs-dr,zr=dM(gt?l2(Yn,Pn+lo-dr-xa):Yn,Pn,gt?o1(cr,jr):cr);Gt[Bt]=zr,bn[Bt]=zr-Pn}if($){var Ys,Jo=Bt==="x"?km:Bm,vn=Bt==="x"?Ov:Lv,Fn=Gt[Lt],yn=Lt==="y"?"height":"width",Hn=Fn+It[Jo],nr=Fn-It[vn],Gn=[km,Bm].indexOf(Et)!==-1,hr=(Ys=Cn==null?void 0:Cn[Lt])!=null?Ys:0,Hr=Gn?Hn:Fn-Xt[yn]-rn[yn]-hr+wn.altAxis,ts=Gn?Fn+Xt[yn]+rn[yn]-hr-wn.altAxis:nr,us=gt&&Gn?function(cs,fs,os){var ns=dM(cs,fs,os);return ns>os?os:ns}(Hr,Fn,ts):dM(gt?Hr:Hn,Fn,gt?ts:nr);Gt[Lt]=us,bn[Lt]=us-Fn}e.modifiersData[s]=bn}},requiresIfExists:["offset"]},x3={name:"arrow",enabled:!0,phase:"main",fn:function(c){var e,i=c.state,s=c.name,a=c.options,h=i.elements.arrow,g=i.modifiersData.popperOffsets,$=py(i.placement),nt=mD($),rt=[Bm,Lv].indexOf($)>=0?"height":"width";if(h&&g){var st=function(rn,fn){return _3(typeof(rn=typeof rn=="function"?rn(Object.assign({},fn.rects,{placement:fn.placement})):rn)!="number"?rn:y3(rn,oS))}(a.padding,i),ut=uD(h),mt=nt==="y"?km:Bm,gt=nt==="y"?Ov:Lv,yt=i.rects.reference[rt]+i.rects.reference[nt]-g[nt]-i.rects.popper[rt],wt=g[nt]-i.rects.reference[nt],It=hM(h),Et=It?nt==="y"?It.clientHeight||0:It.clientWidth||0:0,Ct=yt/2-wt/2,xt=st[mt],Bt=Et-ut[rt]-st[gt],Lt=Et/2-ut[rt]/2+Ct,Gt=dM(xt,Lt,Bt),Xt=nt;i.modifiersData[s]=((e={})[Xt]=Gt,e.centerOffset=Gt-Lt,e)}},effect:function(c){var e=c.state,i=c.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&g3(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function b3(c,e,i){return i===void 0&&(i={x:0,y:0}),{top:c.top-e.height-i.y,right:c.right-e.width+i.x,bottom:c.bottom-e.height+i.y,left:c.left-e.width-i.x}}function E3(c){return[km,Lv,Ov,Bm].some(function(e){return c[e]>=0})}var S3={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(c){var e=c.state,i=c.name,s=e.rects.reference,a=e.rects.popper,h=e.modifiersData.preventOverflow,g=uS(e,{elementContext:"reference"}),$=uS(e,{altBoundary:!0}),nt=b3(g,s),rt=b3($,a,h),st=E3(nt),ut=E3(rt);e.modifiersData[i]={referenceClippingOffsets:nt,popperEscapeOffsets:rt,isReferenceHidden:st,hasPopperEscaped:ut},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":st,"data-popper-escaped":ut})}},C3=h2({defaultModifiers:[fD,gD,vD,p2,f3,A3,w3,x3,S3]}),M3="tippy-content",T3="tippy-arrow",I3="tippy-svg-arrow",l1={passive:!0,capture:!0},P3=function(){return document.body};function yD(c,e,i){if(Array.isArray(c)){var s=c[e];return s??(Array.isArray(i)?i[e]:i)}return c}function AD(c,e){var i={}.toString.call(c);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function D3(c,e){return typeof c=="function"?c.apply(void 0,e):c}function R3(c,e){return e===0?c:function(s){clearTimeout(i),i=setTimeout(function(){c(s)},e)};var i}function hS(c){return[].concat(c)}function k3(c,e){c.indexOf(e)===-1&&c.push(e)}function m2(c){return[].slice.call(c)}function B3(c){return Object.keys(c).reduce(function(e,i){return c[i]!==void 0&&(e[i]=c[i]),e},{})}function pM(){return document.createElement("div")}function g2(c){return["Element","Fragment"].some(function(e){return AD(c,e)})}function wD(c,e){c.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function O3(c,e){c.forEach(function(i){i&&i.setAttribute("data-state",e)})}function xD(c,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){c[s](a,i)})}function L3(c,e){for(var i=e;i;){var s;if(c.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var fy={isTouch:!1},N3=0;function vN(){fy.isTouch||(fy.isTouch=!0,window.performance&&document.addEventListener("mousemove",F3))}function F3(){var c=performance.now();c-N3<20&&(fy.isTouch=!1,document.removeEventListener("mousemove",F3)),N3=c}function _N(){var c,e=document.activeElement;if((c=e)&&c._tippy&&c._tippy.reference===c){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var yN=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),g0=Object.assign({appendTo:P3,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),AN=Object.keys(g0);function U3(c){var e=(c.plugins||[]).reduce(function(i,s){var a,h=s.name,g=s.defaultValue;return h&&(i[h]=c[h]!==void 0?c[h]:(a=g0[h])!=null?a:g),i},{});return Object.assign({},c,e)}function j3(c,e){var i=Object.assign({},e,{content:D3(e.content,[c])},e.ignoreAttributes?{}:function(s,a){return(a?Object.keys(U3(Object.assign({},g0,{plugins:a}))):AN).reduce(function(h,g){var $=(s.getAttribute("data-tippy-"+g)||"").trim();if(!$)return h;if(g==="content")h[g]=$;else try{h[g]=JSON.parse($)}catch{h[g]=$}return h},{})}(c,e.plugins));return i.aria=Object.assign({},g0.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}function bD(c,e){c.innerHTML=e}function z3(c){var e=pM();return c===!0?e.className=T3:(e.className=I3,g2(c)?e.appendChild(c):bD(e,c)),e}function V3(c,e){g2(e.content)?(bD(c,""),c.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?bD(c,e.content):c.textContent=e.content)}function ED(c){var e=c.firstElementChild,i=m2(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(M3)}),arrow:i.find(function(s){return s.classList.contains(T3)||s.classList.contains(I3)}),backdrop:i.find(function(s){return s.classList.contains("tippy-backdrop")})}}function Q3(c){var e=pM(),i=pM();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=pM();function a(h,g){var $=ED(e),nt=$.box,rt=$.content,st=$.arrow;g.theme?nt.setAttribute("data-theme",g.theme):nt.removeAttribute("data-theme"),typeof g.animation=="string"?nt.setAttribute("data-animation",g.animation):nt.removeAttribute("data-animation"),g.inertia?nt.setAttribute("data-inertia",""):nt.removeAttribute("data-inertia"),nt.style.maxWidth=typeof g.maxWidth=="number"?g.maxWidth+"px":g.maxWidth,g.role?nt.setAttribute("role",g.role):nt.removeAttribute("role"),h.content===g.content&&h.allowHTML===g.allowHTML||V3(rt,c.props),g.arrow?st?h.arrow!==g.arrow&&(nt.removeChild(st),nt.appendChild(z3(g.arrow))):nt.appendChild(z3(g.arrow)):st&&nt.removeChild(st)}return s.className=M3,s.setAttribute("data-state","hidden"),V3(s,c.props),e.appendChild(i),i.appendChild(s),a(c.props,c.props),{popper:e,onUpdate:a}}Q3.$$tippy=!0;var wN=1,v2=[],SD=[];function xN(c,e){var i,s,a,h,g,$,nt,rt,st=j3(c,Object.assign({},g0,U3(B3(e)))),ut=!1,mt=!1,gt=!1,yt=!1,wt=[],It=R3(Bo,st.interactiveDebounce),Et=wN++,Ct=(rt=st.plugins).filter(function(yn,Hn){return rt.indexOf(yn)===Hn}),xt={id:Et,reference:c,popper:pM(),popperInstance:null,props:st,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:Ct,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(a)},setProps:function(yn){if(!xt.state.isDestroyed){Pn("onBeforeUpdate",[xt,yn]),lo();var Hn=xt.props,nr=j3(c,Object.assign({},Hn,B3(yn),{ignoreAttributes:!0}));xt.props=nr,Ws(),Hn.interactiveDebounce!==nr.interactiveDebounce&&(mr(),It=R3(Bo,nr.interactiveDebounce)),Hn.triggerTarget&&!nr.triggerTarget?hS(Hn.triggerTarget).forEach(function(Gn){Gn.removeAttribute("aria-expanded")}):nr.triggerTarget&&c.removeAttribute("aria-expanded"),cr(),Un(),Gt&&Gt(Hn,nr),xt.popperInstance&&(zr(),Jo().forEach(function(Gn){requestAnimationFrame(Gn._tippy.popperInstance.forceUpdate)})),Pn("onAfterUpdate",[xt,yn])}},setContent:function(yn){xt.setProps({content:yn})},show:function(){var yn=xt.state.isVisible,Hn=xt.state.isDestroyed,nr=!xt.state.isEnabled,Gn=fy.isTouch&&!xt.props.touch,hr=yD(xt.props.duration,0,g0.duration);if(!(yn||Hn||nr||Gn||bn().hasAttribute("disabled")||(Pn("onShow",[xt],!1),xt.props.onShow(xt)===!1))){if(xt.state.isVisible=!0,Cn()&&(Lt.style.visibility="visible"),Un(),Fr(),xt.state.isMounted||(Lt.style.transition="none"),Cn()){var Hr=En();wD([Hr.box,Hr.content],0)}var ts,us,cs;$=function(){var fs;if(xt.state.isVisible&&!yt){if(yt=!0,Lt.offsetHeight,Lt.style.transition=xt.props.moveTransition,Cn()&&xt.props.animation){var os=En(),ns=os.box,xs=os.content;wD([ns,xs],hr),O3([ns,xs],"visible")}Yn(),cr(),k3(SD,xt),(fs=xt.popperInstance)==null||fs.forceUpdate(),Pn("onMount",[xt]),xt.props.animation&&Cn()&&function(Kr,Cs){ps(Kr,function(){xt.state.isShown=!0,Pn("onShown",[xt])})}(hr)}},us=xt.props.appendTo,cs=bn(),(ts=xt.props.interactive&&us===P3||us==="parent"?cs.parentNode:D3(us,[cs])).contains(Lt)||ts.appendChild(Lt),xt.state.isMounted=!0,zr()}},hide:function(){var yn=!xt.state.isVisible,Hn=xt.state.isDestroyed,nr=!xt.state.isEnabled,Gn=yD(xt.props.duration,1,g0.duration);if(!(yn||Hn||nr)&&(Pn("onHide",[xt],!1),xt.props.onHide(xt)!==!1)){if(xt.state.isVisible=!1,xt.state.isShown=!1,yt=!1,ut=!1,Cn()&&(Lt.style.visibility="hidden"),mr(),Vr(),Un(!0),Cn()){var hr=En(),Hr=hr.box,ts=hr.content;xt.props.animation&&(wD([Hr,ts],Gn),O3([Hr,ts],"hidden"))}Yn(),cr(),xt.props.animation?Cn()&&function(us,cs){ps(us,function(){!xt.state.isVisible&&Lt.parentNode&&Lt.parentNode.contains(Lt)&&cs()})}(Gn,xt.unmount):xt.unmount()}},hideWithInteractivity:function(yn){Dn().addEventListener("mousemove",It),k3(v2,It),It(yn)},enable:function(){xt.state.isEnabled=!0},disable:function(){xt.hide(),xt.state.isEnabled=!1},unmount:function(){xt.state.isVisible&&xt.hide(),xt.state.isMounted&&(Ys(),Jo().forEach(function(yn){yn._tippy.unmount()}),Lt.parentNode&&Lt.parentNode.removeChild(Lt),SD=SD.filter(function(yn){return yn!==xt}),xt.state.isMounted=!1,Pn("onHidden",[xt]))},destroy:function(){xt.state.isDestroyed||(xt.clearDelayTimeouts(),xt.unmount(),lo(),delete c._tippy,xt.state.isDestroyed=!0,Pn("onDestroy",[xt]))}};if(!st.render)return xt;var Bt=st.render(xt),Lt=Bt.popper,Gt=Bt.onUpdate;Lt.setAttribute("data-tippy-root",""),Lt.id="tippy-"+xt.id,xt.popper=Lt,c._tippy=xt,Lt._tippy=xt;var Xt=Ct.map(function(yn){return yn.fn(xt)}),rn=c.hasAttribute("aria-expanded");return Ws(),cr(),Un(),Pn("onCreate",[xt]),st.showOnCreate&&vn(),Lt.addEventListener("mouseenter",function(){xt.props.interactive&&xt.state.isVisible&&xt.clearDelayTimeouts()}),Lt.addEventListener("mouseleave",function(){xt.props.interactive&&xt.props.trigger.indexOf("mouseenter")>=0&&Dn().addEventListener("mousemove",It)}),xt;function fn(){var yn=xt.props.touch;return Array.isArray(yn)?yn:[yn,0]}function wn(){return fn()[0]==="hold"}function Cn(){var yn;return!((yn=xt.props.render)==null||!yn.$$tippy)}function bn(){return nt||c}function Dn(){var yn,Hn,nr=bn().parentNode;return nr&&(Hn=hS(nr)[0])!=null&&(yn=Hn.ownerDocument)!=null&&yn.body?Hn.ownerDocument:document}function En(){return ED(Lt)}function Tn(yn){return xt.state.isMounted&&!xt.state.isVisible||fy.isTouch||h&&h.type==="focus"?0:yD(xt.props.delay,yn?0:1,g0.delay)}function Un(yn){yn===void 0&&(yn=!1),Lt.style.pointerEvents=xt.props.interactive&&!yn?"":"none",Lt.style.zIndex=""+xt.props.zIndex}function Pn(yn,Hn,nr){var Gn;nr===void 0&&(nr=!0),Xt.forEach(function(hr){hr[yn]&&hr[yn].apply(hr,Hn)}),nr&&(Gn=xt.props)[yn].apply(Gn,Hn)}function Yn(){var yn=xt.props.aria;if(yn.content){var Hn="aria-"+yn.content,nr=Lt.id;hS(xt.props.triggerTarget||c).forEach(function(Gn){var hr=Gn.getAttribute(Hn);if(xt.state.isVisible)Gn.setAttribute(Hn,hr?hr+" "+nr:nr);else{var Hr=hr&&hr.replace(nr,"").trim();Hr?Gn.setAttribute(Hn,Hr):Gn.removeAttribute(Hn)}})}}function cr(){!rn&&xt.props.aria.expanded&&hS(xt.props.triggerTarget||c).forEach(function(yn){xt.props.interactive?yn.setAttribute("aria-expanded",xt.state.isVisible&&yn===bn()?"true":"false"):yn.removeAttribute("aria-expanded")})}function mr(){Dn().removeEventListener("mousemove",It),v2=v2.filter(function(yn){return yn!==It})}function ir(yn){if(!fy.isTouch||!gt&&yn.type!=="mousedown"){var Hn=yn.composedPath&&yn.composedPath()[0]||yn.target;if(!xt.props.interactive||!L3(Lt,Hn)){if(hS(xt.props.triggerTarget||c).some(function(nr){return L3(nr,Hn)})){if(fy.isTouch||xt.state.isVisible&&xt.props.trigger.indexOf("click")>=0)return}else Pn("onClickOutside",[xt,yn]);xt.props.hideOnClick===!0&&(xt.clearDelayTimeouts(),xt.hide(),mt=!0,setTimeout(function(){mt=!1}),xt.state.isMounted||Vr())}}}function Dr(){gt=!0}function Nr(){gt=!1}function Fr(){var yn=Dn();yn.addEventListener("mousedown",ir,!0),yn.addEventListener("touchend",ir,l1),yn.addEventListener("touchstart",Nr,l1),yn.addEventListener("touchmove",Dr,l1)}function Vr(){var yn=Dn();yn.removeEventListener("mousedown",ir,!0),yn.removeEventListener("touchend",ir,l1),yn.removeEventListener("touchstart",Nr,l1),yn.removeEventListener("touchmove",Dr,l1)}function ps(yn,Hn){var nr=En().box;function Gn(hr){hr.target===nr&&(xD(nr,"remove",Gn),Hn())}if(yn===0)return Hn();xD(nr,"remove",g),xD(nr,"add",Gn),g=Gn}function yr(yn,Hn,nr){nr===void 0&&(nr=!1),hS(xt.props.triggerTarget||c).forEach(function(Gn){Gn.addEventListener(yn,Hn,nr),wt.push({node:Gn,eventType:yn,handler:Hn,options:nr})})}function Ws(){var yn;wn()&&(yr("touchstart",qs,{passive:!0}),yr("touchend",xa,{passive:!0})),(yn=xt.props.trigger,yn.split(/\s+/).filter(Boolean)).forEach(function(Hn){if(Hn!=="manual")switch(yr(Hn,qs),Hn){case"mouseenter":yr("mouseleave",xa);break;case"focus":yr(yN?"focusout":"blur",dr);break;case"focusin":yr("focusout",dr)}})}function lo(){wt.forEach(function(yn){var Hn=yn.node,nr=yn.eventType,Gn=yn.handler,hr=yn.options;Hn.removeEventListener(nr,Gn,hr)}),wt=[]}function qs(yn){var Hn,nr=!1;if(xt.state.isEnabled&&!jr(yn)&&!mt){var Gn=((Hn=h)==null?void 0:Hn.type)==="focus";h=yn,nt=yn.currentTarget,cr(),!xt.state.isVisible&&AD(yn,"MouseEvent")&&v2.forEach(function(hr){return hr(yn)}),yn.type==="click"&&(xt.props.trigger.indexOf("mouseenter")<0||ut)&&xt.props.hideOnClick!==!1&&xt.state.isVisible?nr=!0:vn(yn),yn.type==="click"&&(ut=!nr),nr&&!Gn&&Fn(yn)}}function Bo(yn){var Hn=yn.target,nr=bn().contains(Hn)||Lt.contains(Hn);if(yn.type!=="mousemove"||!nr){var Gn=Jo().concat(Lt).map(function(hr){var Hr,ts=(Hr=hr._tippy.popperInstance)==null?void 0:Hr.state;return ts?{popperRect:hr.getBoundingClientRect(),popperState:ts,props:st}:null}).filter(Boolean);(function(hr,Hr){var ts=Hr.clientX,us=Hr.clientY;return hr.every(function(cs){var fs=cs.popperRect,os=cs.popperState,ns=cs.props.interactiveBorder,xs=os.placement.split("-")[0],Kr=os.modifiersData.offset;if(!Kr)return!0;var Cs=xs==="bottom"?Kr.top.y:0,Rs=xs==="top"?Kr.bottom.y:0,Qs=xs==="right"?Kr.left.x:0,Kl=xs==="left"?Kr.right.x:0,Rl=fs.top-us+Cs>ns,Ms=us-fs.bottom-Rs>ns,Xs=fs.left-ts+Qs>ns,Eo=ts-fs.right-Kl>ns;return Rl||Ms||Xs||Eo})})(Gn,yn)&&(mr(),Fn(yn))}}function xa(yn){jr(yn)||xt.props.trigger.indexOf("click")>=0&&ut||(xt.props.interactive?xt.hideWithInteractivity(yn):Fn(yn))}function dr(yn){xt.props.trigger.indexOf("focusin")<0&&yn.target!==bn()||xt.props.interactive&&yn.relatedTarget&&Lt.contains(yn.relatedTarget)||Fn(yn)}function jr(yn){return!!fy.isTouch&&wn()!==yn.type.indexOf("touch")>=0}function zr(){Ys();var yn=xt.props,Hn=yn.popperOptions,nr=yn.placement,Gn=yn.offset,hr=yn.getReferenceClientRect,Hr=yn.moveTransition,ts=Cn()?ED(Lt).arrow:null,us=hr?{getBoundingClientRect:hr,contextElement:hr.contextElement||bn()}:c,cs=[{name:"offset",options:{offset:Gn}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Hr}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(fs){var os=fs.state;if(Cn()){var ns=En().box;["placement","reference-hidden","escaped"].forEach(function(xs){xs==="placement"?ns.setAttribute("data-placement",os.placement):os.attributes.popper["data-popper-"+xs]?ns.setAttribute("data-"+xs,""):ns.removeAttribute("data-"+xs)}),os.attributes.popper={}}}}];Cn()&&ts&&cs.push({name:"arrow",options:{element:ts,padding:3}}),cs.push.apply(cs,(Hn==null?void 0:Hn.modifiers)||[]),xt.popperInstance=C3(us,Lt,Object.assign({},Hn,{placement:nr,onFirstUpdate:$,modifiers:cs}))}function Ys(){xt.popperInstance&&(xt.popperInstance.destroy(),xt.popperInstance=null)}function Jo(){return m2(Lt.querySelectorAll("[data-tippy-root]"))}function vn(yn){xt.clearDelayTimeouts(),yn&&Pn("onTrigger",[xt,yn]),Fr();var Hn=Tn(!0),nr=fn(),Gn=nr[0],hr=nr[1];fy.isTouch&&Gn==="hold"&&hr&&(Hn=hr),Hn?i=setTimeout(function(){xt.show()},Hn):xt.show()}function Fn(yn){if(xt.clearDelayTimeouts(),Pn("onUntrigger",[xt,yn]),xt.state.isVisible){if(!(xt.props.trigger.indexOf("mouseenter")>=0&&xt.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(yn.type)>=0&&ut)){var Hn=Tn(!1);Hn?s=setTimeout(function(){xt.state.isVisible&&xt.hide()},Hn):a=requestAnimationFrame(function(){xt.hide()})}}else Vr()}}function fM(c,e){e===void 0&&(e={});var i=g0.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",vN,l1),window.addEventListener("blur",_N);var s,a=Object.assign({},e,{plugins:i}),h=(s=c,g2(s)?[s]:function(g){return AD(g,"NodeList")}(s)?m2(s):Array.isArray(s)?s:m2(document.querySelectorAll(s))).reduce(function(g,$){var nt=$&&xN($,a);return nt&&g.push(nt),g},[]);return g2(c)?h[0]:h}fM.defaultProps=g0,fM.setDefaultProps=function(c){Object.keys(c).forEach(function(e){g0[e]=c[e]})},fM.currentInput=fy,Object.assign({},p2,{effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),fM.setDefaultProps({render:Q3});var CD=fM;class c1 extends a2{async _refreshUi(){var e;if(!await super._refreshUi())return!1;f0.RemoveAll(c1.PluginType);for(const i of this.variations)f0.Create(c1.PluginType,i.title,5,20,0,i.materials.map(s=>{let a;if(i.preview.startsWith("generate:"))a=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const h=s[i.preview]||"#ff00ff";a=h.image?C_(h.image,100):void 0,a||(a=YB(h,!0))}return{id:s.uuid,image:a,onClick:h=>this.applyVariation(i,h),tooltip:s.name||s.uuid}}),(s,a)=>CD(s,{placement:"bottom",content:a.tooltip}));return f0.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}c1.PluginType="MaterialConfiguratorPlugin";class _2 extends Ks{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))},this.dependencies=[Jr],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new iD(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}_2.PluginType="MaterialLibraryBasePlugin",function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)}([rs("Enabled")],_2.prototype,"enabled",void 0);class ww extends _2{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Ao(),children:[...zv(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Jr).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(i=>({label:i.name||i.uuid,value:i.uuid}))||[]]],getValue:()=>{var i;return(i=this._selectedMaterial())===null||i===void 0?void 0:i.uuid},setValue:i=>{var s,a,h,g,$;const nt=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Jr))===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i);if(nt)if(this.replaceMaterial)($=(g=this._selectedObject())===null||g===void 0?void 0:g.setMaterial)===null||$===void 0||$.call(g,nt);else{const rt=this._selectedMaterial();if(rt){const st=rt.name,ut=rt.uuid;rt.copyProps(nt),rt.name=st,rt.uuid=ut,rt.userData.uuid&&(rt.userData.uuid=ut)}}this._refreshUi()}}}]}}async _refreshUi(){var e,i,s,a;if(!await super._refreshUi())return!1;const h=[Yu.TypeSlug,Pl.TypeSlug],g=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Jr))===null||i===void 0?void 0:i.materials,$=h.map(nt=>[nt,g==null?void 0:g.getMaterialsOfType(nt)]);f0.RemoveAll(ww.PluginType);for(const[nt,rt]of $)f0.Create(ww.PluginType,nt,5,20,0,(s=rt)===null||s===void 0?void 0:s.filter(st=>!st.userData.__runtimeMaterial).map(st=>{let ut;const mt="generate:sphere";if(mt.startsWith("generate:"))ut=this._previewGenerator.generate(st,mt.split(":")[1]);else{const gt=st[mt]||"#ff00ff";ut=gt.image?C_(gt.image,100):void 0,ut||(ut=qB(gt,!0))}return{id:st.uuid,image:ut,onClick:gt=>{const yt=g==null?void 0:g.findMaterial(gt);if(console.log(yt==null?void 0:yt.name),yt){const wt=yt.userData.__appliedMeshes;if(wt!=null&&wt.size){const It=wt.keys().next().value;It.dispatchEvent({type:"select",value:It})}}},tooltip:st.name||st.uuid}}),(st,ut)=>CD(st,{placement:"bottom",content:ut.tooltip}));return f0.RebuildUi((a=this._viewer)===null||a===void 0?void 0:a.container),!0}}function G3(c,e,i,s){c.traverse(a=>{a&&(a.userData.cloneRotI=e,a.userData.rotationCount=i,a.userData.rotationAxis=s,a.addEventListener("beforeRender",h=>function(g,$){var nt;$&&(!((nt=$.map)===null||nt===void 0)&&nt.isTexture)&&($.extraUniformsToUpload||($.extraUniformsToUpload={}),$.extraUniformsToUpload.uvTransform||($.extraUniformsToUpload.uvTransform={value:new d.Vkp}),$.extraUniformsToUpload.uvTransform.value.setUvTransform($.map.offset.x*$.map.repeat.x*g.userData.cloneRotI/(g.userData.rotationCount||1),$.map.offset.y*$.map.repeat.y*g.userData.cloneRotI/(g.userData.rotationCount||1),$.map.repeat.x,$.map.repeat.y,$.map.rotation,$.map.center.x,$.map.center.y))}(a,h.material)))})}function H3(c,e,i,s="x"){var a;if(c.userData.rotationCount>1&&!c.userData.rotationRoot)return c;const h=c.parent;if(!h)throw new Error("No parent");if(c.userData.cloneParent){const $=c.userData.cloneParent;if(!(c=h.children.find(nt=>$===nt.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",$,h),c}let g=h.children.filter($=>{var nt;return((nt=$.userData)===null||nt===void 0?void 0:nt.cloneParent)===c.uuid}).sort(($,nt)=>$.userData.cloneRotI-nt.userData.cloneRotI);if(c.userData.rotationCount===e&&e===g.length&&i===void 0&&c.userData.rotationAxis===s)return c;if(i==null&&(i=(a=c.userData.rotationSkips)!==null&&a!==void 0?a:[]),i!==c.userData.rotationSkips&&(c.userData.rotationSkips=[...i]),G3(c,0,e,s),c.userData.rotationRoot=!0,c.visible=!0,e<=g.length){for(let $=e-1;$<g.length;$++)h.remove(g[$]),g[$].traverse(nt=>nt.userData={__disposed:!0});g=g.slice(0,e)}for(let $=1;$<e;$++){const nt=$<=g.length?g[$-1]:c.clone();nt.rotation.copy(c.rotation),nt.rotation[s]+=$/e*Math.PI*2,G3(nt,$,e,s),$>g.length&&h.add(nt),nt.visible=!i.includes($)}return c.visible=!i.includes(0),c}ww.PluginType="MaterialLibraryPlugin",function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)}([rs("Replace Material")],ww.prototype,"replaceMaterial",void 0);var dS,mM=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let my=dS=class extends Ks{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h,g,$,nt;if(!this.enabled)return;const rt=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!rt)return void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));const st=rt.userData.rotationRoot&&(a=rt.userData.rotationCount)!==null&&a!==void 0?a:1;this.rotations=st,this.skips=(g=(h=rt.userData.rotationSkips)===null||h===void 0?void 0:h.join(","))!==null&&g!==void 0?g:"",this.axis=rt.userData.rotationAxis||"x",(nt=($=this.uiConfig).uiRefresh)===null||nt===void 0||nt.call($,"postFrame",!0)}_paramsChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const g=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(g){if(this.rotations>1||g.userData.rotationCount){const $=g.userData.rotationCount,nt=H3(g,this.rotations,this.skips.split(",").map(st=>parseInt(st)).filter(st=>isFinite(st)),this.axis),rt=nt==null?void 0:nt.userData.rotationCount;if(rt&&rt!==$){const st=[];nt==null||nt.traverseAncestors(ut=>{st.push(ut)});for(const ut of st)if(ut.userData.autoScaled){is(ut),(i=this._viewer)===null||i===void 0||i.resetCamera({rootObject:ut,centerOffset:new d.Pa4(4,4,4)});break}}g.parent&&!g.userData.__disposed||(a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||a===void 0||a.setSelectedObject(nt,!0)}(h=this._viewer)===null||h===void 0||h.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};my.PluginType="ObjectRotationPlugin",mM([Qn(),rs("Enabled"),hn(dS.prototype._paramsChanged)],my.prototype,"enabled",void 0),mM([ls("Rotation Count",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),hn(dS.prototype._paramsChanged)],my.prototype,"rotations",void 0),mM([yp("Axis",["x","y","z"].map(c=>({label:c})),c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),hn(dS.prototype._paramsChanged)],my.prototype,"axis",void 0),mM([uo("Rotation Skips",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),hn(dS.prototype._paramsChanged)],my.prototype,"skips",void 0),my=dS=mM([ho("Object Rotations")],my);var u1,pS=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let v0=u1=class extends Ks{constructor(c=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const a of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${a}>`,d.WdD[a].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",d.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)===null||i===void 0?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{for(const[a,h]of Object.entries(this._defines)){const g=typeof h=="number"?h:h?1:0;i.defines[a]!==g&&(i.defines[a]=g,i.needsUpdate=!0)}}},this.dependencies=[Jr],this.enabled=c,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var c,e,i;(e=(c=this._bumpMapExtension)===null||c===void 0?void 0:c.setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()}async onAdded(c){var e,i;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(c)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Jr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(c)}};v0.PluginType="ReliefParallaxMapping",pS([hn(u1.prototype._updateExtension),rs("Enabled")],v0.prototype,"enabled",void 0),pS([hn(u1.prototype._updateExtension),rs("Debug Normals")],v0.prototype,"debugNormals",void 0),pS([hn(u1.prototype._updateExtension),rs("Debug Hit Height")],v0.prototype,"debugHitHeight",void 0),pS([On("PARALLAX_MAP_STEPS",void 0,!0,u1.prototype._updateExtension),ls("Step count",[1,32],1),Qn()],v0.prototype,"stepCount",void 0),pS([On("PARALLAX_MAP_B_STEPS",void 0,!0,u1.prototype._updateExtension),ls("Binary search steps",[1,8],1),Qn()],v0.prototype,"binaryStepCount",void 0),v0=u1=pS([ho("Parallax Mapping")],v0);var y_=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};class Nv extends Au{constructor(e,i,s,a=!1){super({vertexShader:xv,fragmentShader:`

${B1}
${qw}
${bv}
${HS}
${s}

${O1}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!a},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new d.yGw},screenSize:{value:new d.FM8},cameraPositionWorld:{value:new d.Pa4},cameraNearFar:{value:new d.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:a?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(h,g,$)=>{if(!h.defines.SSRTAO_ENABLED)return;const nt="vec3 totalDiffuse =";h.fragmentShader=h.fragmentShader.replace(nt,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${nt}`),h.fragmentShader=h.fragmentShader.replace("#include <aomap_fragment>",""),h.vertexUvs=!0},onObjectRender:(h,g,$)=>{var nt,rt,st;this.materialExtension.extraUniforms.tSSGIMap.value=(nt=this._target)===null||nt===void 0?void 0:nt.texture;const ut=g.materialObject,mt=!ut.transparent&&ut.transmission<.001;let gt=this.enabled&&mt&&(this.renderWithCamera||this._renderer.frameCount>1)&&$.userData.screenSpaceRendering!==!1&&!(!((rt=ut.userData)===null||rt===void 0)&&rt.ssrtaoDisabled)&&!(!((st=ut.userData)===null||st===void 0)&&st.ssaoDisabled)?1:0;ut.defines.SSRTAO_ENABLED!==gt&&(ut.defines.SSRTAO_ENABLED=gt,ut.needsUpdate=!0),gt=this.material.defines.SSGI_ENABLED,ut.defines.SSGI_ENABLED!==gt&&(ut.defines.SSGI_ENABLED=gt,ut.needsUpdate=!0),gt=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==gt&&(this.materialExtension.extraUniforms.tSSGIMap.value=gt,ut.needsUpdate=!0)},parsFragmentSnippet:h=>{var g;return zt`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${$n("tSSGIMap",(g=this._target)===null||g===void 0?void 0:g.texture,h.capabilities.isWebGL2)}

            ${L1}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:h=>{var g,$;return this.enabled?"1":"0"+(($=(g=this._target)===null||g===void 0?void 0:g.texture)===null||$===void 0?void 0:$.encoding)},isCompatible:h=>{var g;return!(!((g=h.materialObject.userData)===null||g===void 0)&&g.ssaoDisabled)&&h.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...zv(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=a,this.ssgiEnabled=a,this.bilateralPass=new F1(this._target,s,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,i,s,a,h){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this.smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}}y_([Qn()],Nv.prototype,"bilateralPass",void 0),y_([ls("Intensity",[0,4]),Qn(),pn()],Nv.prototype,"intensity",void 0),y_([ls("Power",[0,3]),Qn(),pn()],Nv.prototype,"power",void 0),y_([rs("Auto radius"),Qn(),pn()],Nv.prototype,"autoRadius",void 0),y_([ls("Object Radius",[.01,10]),Qn(),pn()],Nv.prototype,"objectRadius",void 0),y_([ls("Tolerance",[.1,5]),Qn(),pn()],Nv.prototype,"tolerance",void 0),y_([ls("Bias",[-.3,.3]),Qn(),pn()],Nv.prototype,"bias",void 0),y_([ls("Falloff",[1e-4,4]),Qn(),pn()],Nv.prototype,"falloff",void 0),y_([ls("Ray Count",[1,5],1),Qn(),pn()],Nv.prototype,"rayCount",void 0),y_([ls("Step count",[1,16],1),Qn(),On("RTAO_STEP_COUNT")],Nv.prototype,"stepCount",void 0),y_([rs("Smooth Enabled"),Qn()],Nv.prototype,"smoothEnabled",void 0),y_([rs("Render with Camera")],Nv.prototype,"renderWithCamera",void 0);class y2 extends Ww{constructor(e=!0){super(),this.dependencies=[Jr,El,cp],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssrtgi)===null||i===void 0)&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s,a;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let h=!1;return(i=this._viewer)===null||i===void 0||i.getPluginByType("debug"),[zA(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Nv(e.renderer,this._rtgiTarget,(a=(s=e.getPlugin(El))===null||s===void 0?void 0:s.getUnpackSnippet())!==null&&a!==void 0?a:"",!0),update:()=>{var g;let $=this.enabled;if($&&!h){const nt=(g=this._viewer)===null||g===void 0?void 0:g.getPluginByType("SSAO");nt!=null&&nt.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?nt.enabled=!1:(this.enabled=!1,$=!1))}h=$,$&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(El)])}},()=>[e.getPlugin(El),e.getPlugin(cp),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const g=(s=(i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=g.children)===null||a===void 0?void 0:a.map($=>Ht($)))===null||h===void 0||h.flat(2).forEach($=>$&&($.onChange=this.setDirty)),g}}y2.PluginType="SSGI";class xw extends Ks{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[Jr],this.variations=[],this._selectedSwitchNode=()=>{var e;const i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;const s=this.variations.map(h=>h.name);let a;return i.traverseAncestors(h=>{a||s.includes(h.name)&&(a=h)}),a},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var a,h;(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;a.selected||(a.selected=h.children[0].name||h.children[0].uuid);for(const g of h.children)g.visible=(g.name||g.uuid)===a.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;for(const g of h.children)g.visible=!0}}),this.addEventListener("deserialize",async()=>{await ou(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i,s;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,f0.RemoveAll(xw.PluginType);for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);h?(h.children.length<1&&console.warn("SwitchNode does not have enough children",a),f0.Create(xw.PluginType,a.title,Math.min(5,h.children.length),20,0,h.children.map(g=>{const $=a.camView,nt=new d.Pa4(($.includes("right")?1:0)-($.includes("left")?1:0),($.includes("top")?1:0)-($.includes("bottom")?1:0),($.includes("front")?1:0)-($.includes("back")?1:0));a.camDistance||(a.camDistance=1);const rt=rD(this._viewer,g,void 0,7,nt.multiplyScalar(.5*a.camDistance));return{id:g.uuid,image:rt,onClick:()=>{var st;a.selected=g.name||g.uuid,(st=this._viewer)===null||st===void 0||st.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:g.name||g.uuid}}),(g,$)=>CD(g,{placement:"bottom",content:$.tooltip}))):console.warn("no object found for variation, skipping",a)}f0.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}}}xw.PluginType="SwitchNodePlugin",function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);h>3&&g&&Object.defineProperty(e,i,g)}([Qn()],xw.prototype,"variations",void 0);class MD extends d.u9r{constructor(e,i,s=32,a=64,h=!1,g=new d.FM8(1,1),$="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:a,closed:h,primary:$,shapeScale:g.clone()};const nt=i.computeFrenetFrames(a,h);this.frames=nt;const rt=new d.Pa4,st=new d.Pa4,ut=new d.Pa4,mt=new d.FM8;let gt=new d.Pa4;const yt=[],wt=[],It=[],Et=e.getSpacedPoints(s);for(const Bt of Et)Bt.multiply(g);(function(){for(let Bt=0;Bt<a;Bt++)xt(Bt);xt(h===!1?a:0),function(){for(let Bt=0;Bt<=a;Bt++)for(let Lt=0;Lt<=s;Lt++)mt.x=Bt/a,mt.y=Lt/s,wt.push(mt.x,mt.y)}(),function(){const Bt=$==="shape",Lt=Bt?s:a,Gt=Bt?a:s;for(let Xt=1;Xt<=Lt;Xt++)for(let rn=1;rn<=Gt;rn++){const[fn,wn]=Bt?[rn,Xt]:[Xt,rn],Cn=(s+1)*(fn-1)+(wn-1),bn=(s+1)*fn+(wn-1),Dn=(s+1)*fn+wn,En=(s+1)*(fn-1)+wn;It.push(Cn,bn,En),It.push(bn,Dn,En)}}()})(),this.setIndex(It),this.setAttribute("position",new d.a$l(yt,3)),this.setAttribute("uv",new d.a$l(wt,2)),this.computeVertexNormals();const Ct=this.attributes.normal;function xt(Bt){gt=i.getPointAt(Bt/a,gt);const Lt=nt.normals[Bt],Gt=nt.binormals[Bt];for(let Xt=0;Xt<=s;Xt++){const rn=Et[Xt%s];st.set(0,0,0).addScaledVector(Lt,rn.x).addScaledVector(Gt,rn.y),rt.copy(gt).add(st),yt.push(rt.x,rt.y,rt.z)}}(function(){for(let Lt=1;Lt<s;Lt++){const Gt=Lt+a*(s+1);st.fromBufferAttribute(Ct,Lt),ut.fromBufferAttribute(Ct,Gt),st.add(ut).normalize(),Ct.setXYZ(Lt,st.x,st.y,st.z),Ct.setXYZ(Gt,st.x,st.y,st.z)}for(let Lt=1;Lt<a;Lt++){const Gt=Lt*(s+1),Xt=Gt+s;st.fromBufferAttribute(Ct,Gt),ut.fromBufferAttribute(Ct,Xt),st.add(ut).normalize(),Ct.setXYZ(Gt,st.x,st.y,st.z),Ct.setXYZ(Xt,st.x,st.y,st.z)}st.fromBufferAttribute(Ct,0),ut.fromBufferAttribute(Ct,s),st.add(ut);const Bt=a*(s+1);ut.fromBufferAttribute(Ct,Bt),st.add(ut),ut.fromBufferAttribute(Ct,Bt+s),st.add(ut),st.normalize(),Ct.setXYZ(0,st.x,st.y,st.z),Ct.setXYZ(s,st.x,st.y,st.z),Ct.setXYZ(Bt,st.x,st.y,st.z),Ct.setXYZ(Bt+s,st.x,st.y,st.z),Ct.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,a=[...e,1].sort();let h=0,g=0;for(const $ of a){const nt=Math.round(i*$)*s/i;this.addGroup(h,nt-h,g++),h=nt}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var TD,bw=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let Fv=TD=class extends Ks{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new d.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var c,e;const i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(jo))===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;let s=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!s)return;s=parseFloat(s);const a=new ID(0,0,s,s,0,2*Math.PI,!0,0);await this.extrudeObject(i,a)}}async onAdded(c){await super.onAdded(c)}static CreateCurve(c,e){var i,s;if(c==="circle")return new ID(0,0,(i=e.radius)!==null&&i!==void 0?i:1,(s=e.radius)!==null&&s!==void 0?s:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(c,e,i=this.shapeSegments,s=this.tubularSegments,a=this.shapeScale,h=this.materialSplits.split(",").map($=>parseFloat($.trim())),g=this.horizontalSplits){var $,nt,rt,st,ut,mt,gt,yt;if(c.userData.isExtrudedTube,c.userData._extrudeSource){const Bt=c.userData._extrudeSource;if(c=($=c.parent)===null||$===void 0?void 0:$.children.find(Lt=>Bt===Lt.uuid),!c)return void console.warn("Could not find extrude source with uuid",Bt)}if(c.userData.extrudedObject){const Bt=c.userData.extrudedObject,Lt=(nt=c.parent)===null||nt===void 0?void 0:nt.children.find(Gt=>Bt===Gt.uuid);Lt&&(Lt.removeFromParent(),Lt.geometry.dispose(),Lt.geometry=null,Lt.material=null),delete c.userData.extrudedObject}const wt=c.geometry;if(!wt)return void((rt=this._viewer)===null||rt===void 0||rt.alert("Extrude: No geometry to extrude"));const It=[c.material];let Et;try{const Bt=TD.ConvertGeometryToFlatShape(wt);Et=new MD(Bt,e,i,s,!0,a,g?"shape":"path"),Et.computeBoundingBox(),Et.createSplits(h)}catch(Bt){return void((st=this._viewer)===null||st===void 0||st.alert(typeof Bt=="string"?Bt:Bt==null?void 0:Bt.message))}It[0].color.set(16777215);for(let Bt=It.length;Bt<Et.groups.length;Bt++){const Lt=It[0].clone();It.push(Lt),Lt.color.set(16777215*Math.random())}const Ct=new d.Kj0(Et,It);Ct.userData._extrudeSource=c.uuid,Ct.userData.isExtrudedTube=!0,c.visible=!1,c.userData.bboxVisible=!1,Ct.name=c.name+"_extruded";const xt=await((gt=(mt=(ut=this._viewer)===null||ut===void 0?void 0:ut.getManager())===null||mt===void 0?void 0:mt.importer)===null||gt===void 0?void 0:gt.processImportedSingle(Ct,{autoCenter:!1,autoScale:!1}));xt&&((yt=c.parent)===null||yt===void 0||yt.add(xt.modelObject),c.userData.extrudedObject=xt.modelObject.uuid,xt.dispatchEvent({type:"select",ui:!0,value:xt}))}static ExtrudeShape(c,e,i,s,a,h,g,$){const nt=new MD(c,s,e,i,!0,new d.FM8(a,h),$?"shape":"path");nt.computeBoundingBox(),nt.createSplits(g);const rt=new d.Kj0(nt,[]);return rt.userData.isExtrudedTube=!0,rt}static ConvertGeometryToFlatShape(c,e=!0){if(c.userData.__planarShape)return c.userData.__planarShape;let i=c.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=c;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const a=s.boundingBox.getSize(new d.Pa4),h=a.x<.001?"x":a.y<.001?"y":a.z<.001?"z":null;if(!h)throw"geometry is not axis aligned not planar";let g=[];for(let nt=0;nt<i.count;nt++){const rt=new d.FM8;h==="x"?rt.set(i.getY(nt),i.getZ(nt)):h==="y"?rt.set(i.getX(nt),i.getZ(nt)):rt.set(i.getX(nt),i.getY(nt)),g.push(rt)}if(e){let nt=0;for(let rt=0;rt<g.length;rt++)(g[rt].x<g[nt].x||g[rt].x===g[nt].x&&g[rt].y<g[nt].y)&&(nt=rt);nt!==0&&(g=g.slice(nt).concat(g.slice(0,nt)))}const $=new d.bnF(g);return c.userData.__planarShape=$,$}};Fv.PluginType="ShapeTubeExtrudePlugin",bw([rs("Enabled")],Fv.prototype,"enabled",void 0),bw([ls("Shape Segments (X)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0)&&i.getSelectedObject())}}))],Fv.prototype,"shapeSegments",void 0),bw([ls("Tube Segments (Y)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0)&&i.getSelectedObject())}}))],Fv.prototype,"tubularSegments",void 0),bw([Jl("Shape scale",[.01,10],.01,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0)&&i.getSelectedObject())}}))],Fv.prototype,"shapeScale",void 0),bw([uo("Material Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0)&&i.getSelectedObject())}}))],Fv.prototype,"materialSplits",void 0),bw([rs("Horizontal Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0)&&i.getSelectedObject())}}))],Fv.prototype,"horizontalSplits",void 0),bw([No("Extrude Circle Tube",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0)&&i.getSelectedObject())}}))],Fv.prototype,"extrudeCirceTube",void 0),Fv=TD=bw([ho("Extrude Tube Shapes")],Fv);class ID extends d.Ny0{getPoint(e,i){return super.getPoint(e,i||new d.Pa4)}}class gM extends Ks{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var i,s;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(gM.PluginType),this._fadeDisabled=!1));const a=po()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/60);let h=a-this._lastFrameTime;this._lastFrameTime=a;const g=(s=this._viewer.getPluginByType("Progressive"))===null||s===void 0?void 0:s.postFrameConvergedRecordingDelta();if(g&&g>0&&(h=g),g!==0&&(h*=1e3,!(h<=.001)&&(this._updaters.forEach($=>{let nt=h;$.time+nt<0&&(nt=-$.time),$.time+=nt,Math.abs(nt)>.001&&$.u(nt)}),!this._fadeDisabled&&this.disableFrameFade))){const $=this._viewer.getPluginByType("FrameFade");$&&($.disable(gM.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=Ao(),s={id:i,options:e,stop:()=>{var a,h,g;!((a=this.animations[i])===null||a===void 0)&&a._stop?(g=(h=this.animations[i])===null||h===void 0?void 0:h._stop)===null||g===void 0||g.call(h):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((a,h)=>{const g={driver:this.defaultDriver,onComplete:()=>{var nt;(nt=e.onComplete)===null||nt===void 0||nt.call(e),a()},onStop:()=>{var nt;(nt=e.onStop)===null||nt===void 0||nt.call(e),a()},...e},$=$A(g);this.animations[i]._stop=$.stop,this.animations[i].options=g}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}gM.PluginType="PopmotionPlugin";const bN=async c=>gu(await(await fetch(c)).blob());async function W3(c,e=bN){const i=c.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(i)for(const s of i){const a=await e(s);c=c.replace(s,a)}return c}function PD(c,e,{width:i,height:s},a=!0){const h=`
<svg viewBox="0 0 ${i} ${s}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${c}
        </div>
    </foreignObject>
</svg>
    `;return a?mn(h):h}async function EN(c,e,i){const s=PD(c,e,i);return await sD(s,i)}async function SN(c,e,i){const s=PD(c,e,i);return await XB(s,i)}var DD,_0,yu=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const Om=c=>({onChange:e=>{e.last&&c.onChange()}});let fp=DD=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(c){Object.assign(this,c)}reset(){const c=this.onChange;Object.assign(this,new DD),this.onChange=c}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};yu([uo("Text",Om)],fp.prototype,"text",void 0),yu([ls("Font Size",[2,400],1,Om)],fp.prototype,"fontSize",void 0),yu([ls("Width",[2,4096],1,Om)],fp.prototype,"width",void 0),yu([ls("Height",[2,4096],1,Om)],fp.prototype,"height",void 0),yu([ls("X Offset",[-1024,1024],1,Om)],fp.prototype,"xOffset",void 0),yu([ls("Y Offset",[-1024,1024],1,Om)],fp.prototype,"yOffset",void 0),yu([ls("V-Width",[2,4096],1,Om)],fp.prototype,"boxWidth",void 0),yu([ls("V-Height",[2,4096],1,Om)],fp.prototype,"boxHeight",void 0),yu([uo("Font",Om)],fp.prototype,"fontFamily",void 0),yu([uo("Font Url",Om)],fp.prototype,"fontPath",void 0),yu([rs("Mask Text",Om)],fp.prototype,"maskText",void 0),yu([rs("Inner Shadow",Om)],fp.prototype,"innerShadow",void 0),yu([cv("Text Color",Om)],fp.prototype,"textColor",void 0),yu([cv("BG Fill",Om)],fp.prototype,"bgFillColor",void 0),yu([cv("SVG BG",Om)],fp.prototype,"svgBackground",void 0),fp=DD=yu([ho("Text SVG Options")],fp);const q3={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},vM=c=>({hidden:()=>{const e=c.getSelected();return!e||!e.userData[Uv.PluginType]}});let Uv=_0=class extends Ks{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var c,e;return(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new fp,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const g=this.getSelected();if(!g)return void((e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0));const $=g.userData[_0.PluginType];if(!$)return this.options.reset(),this._lastMeta=void 0,void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));this._lastMeta!==$&&(this.options.set($),this._lastMeta=$),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const c=this.getSelected();c&&c.isMesh&&c.userData[_0.PluginType]&&this.updateText(c,this.options.toJSON())}async addTextToSelected(){var c;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[_0.PluginType]||!e.material.map||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(c,e){return this.updateText(c,Object.assign(this.options.toJSON(),e))}async updateText(c,e){var i,s;if(!c.isMesh)return;if(!c.material)return void console.error("updateText: no material on mesh");let a=c.userData[_0.PluginType];a||(c.userData[_0.PluginType]=a={}),Object.assign(a,e);const h=c.material;h.map&&(h.map._isSimpleTextTexture&&h.map.dispose(),h.map=void 0),h.alphaMap&&(h.alphaMap._isSimpleTextTexture&&h.alphaMap.dispose(),h.alphaMap=void 0),h.bumpMap&&(h.bumpMap._isSimpleTextTexture&&h.bumpMap.dispose(),h.bumpMap=void 0);const g=await this.makeTextSvg(a);this.applyToMap&&(h.map=g),this.applyToAlphaMap&&(h.alphaMap=g,h.transparent=!0),this.applyToBumpMap&&(h.bumpMap=g),h.userData.inverseAlphaMap=this.inverseAlphaMap,h.setDirty(),h.needsUpdate=!0,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async makeTextSvg(c){const e=c.fontFamily||"Arial",i=c.fontPath||this.fonts[e]||"";let s=c.style;if(i.length>0){const g=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${q3[g]||g});
            }`:"")}let a=function({text:g="Custom Text",svgBackground:$="#ffffff",xOffset:nt=0,yOffset:rt=0,width:st=1024,height:ut=1024,boxWidth:mt=1024,boxHeight:gt=1024,fontFamily:yt="",fontSize:wt=32,maskText:It=!0,innerShadow:Et=!0,bgFillColor:Ct="#000000",textColor:xt="#ffffff",style:Bt=""}){return`
<svg style="background-color:${$}" width="${st}" height="${ut}" viewBox="0 0 ${mt} ${gt}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${Bt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${wt}px; font-family: ${yt||"Arial"}">
        <defs>

`+(It?`
<mask id="textMask">
<text style="fill:white; font-size: ${wt}px;" x="${nt+mt/2}" y="${gt/2+rt+wt/4}" > ${g} </text>
</mask>
`:"")+`

`+(Et?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(It?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${mt}" height="${gt}" style="fill:${Ct}"/>
        <text style="${Et?"filter: url(#innerShadow);":""} fill:${xt};" x="${nt+mt/2}" y="${gt/2+rt+wt/4}"> ${g} </text>

`+(It?`
        </g>
`:"")+`

    </g>
</svg>
`}({...c,fontFamily:e,style:s});a=await W3(a,async g=>this._getAssetData(g)),a=mn(a);const h=await this._viewer.getManager().importer.importSinglePath(a,{generateMipmaps:!1,minFilter:d.wem});return h._isSimpleTextTexture=!0,h.flipY=!1,h.needsUpdate=!0,h}async _getAssetData(c){var e,i;if(c.startsWith("http://www.w3.org"))return c;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||i===void 0?void 0:i.importer;if(!s)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new Sl(s.loadingManager),processImported:!1};try{return await s.importPath(c,this._assetLoadOptions)}catch(a){return console.error(a),""}}};Uv.PluginType="SimpleTextPlugin",yu([xl(void 0,{params:vM})],Uv.prototype,"options",void 0),yu([rs("Apply Map",vM),hn(_0.prototype._paramsChanged)],Uv.prototype,"applyToMap",void 0),yu([rs("Apply Bump Map",vM),hn(_0.prototype._paramsChanged)],Uv.prototype,"applyToBumpMap",void 0),yu([rs("Apply Alpha Map",vM),hn(_0.prototype._paramsChanged)],Uv.prototype,"applyToAlphaMap",void 0),yu([rs("Invert Alpha Map",vM),hn(_0.prototype._paramsChanged)],Uv.prototype,"inverseAlphaMap",void 0),yu([No("Add Text",c=>({hidden:()=>!c.getSelected()}))],Uv.prototype,"addTextToSelected",null),Uv=_0=yu([ho("Simple Text")],Uv);class RD{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class CN{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class gy{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new gy;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new gy),this.front.build(i)),s.length&&(this.back||(this.back=new gy),this.back.build(s))}}class av{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new av(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new av().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,a=i.y,h=i.z,g=e.x,$=e.y,nt=e.z;return this.x=a*nt-h*$,this.y=h*g-s*nt,this.z=s*$-a*g,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new d.Pa4(this.x,this.y,this.z)}}class h1{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new h1(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,a,h){let g=0;const $=[];for(let nt=0;nt<e.vertices.length;nt++){const rt=this.normal.dot(e.vertices[nt].pos)-this.w,st=rt<-h1.EPSILON?2:rt>h1.EPSILON?1:0;g|=st,$.push(st)}switch(g){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:a.push(e);break;case 2:h.push(e);break;case 3:{const nt=[],rt=[];for(let st=0;st<e.vertices.length;st++){const ut=(st+1)%e.vertices.length,mt=$[st],gt=$[ut],yt=e.vertices[st],wt=e.vertices[ut];if(mt!=2&&nt.push(yt),mt!=1&&rt.push(mt!=2?yt.clone():yt),(mt|gt)==3){const It=(this.w-this.normal.dot(yt.pos))/this.normal.dot(new av().copy(wt.pos).sub(yt.pos)),Et=yt.interpolate(wt,It);nt.push(Et),rt.push(Et.clone())}}nt.length>=3&&a.push(new fS(nt,e.shared)),rt.length>=3&&h.push(new fS(rt,e.shared));break}}}static fromPoints(e,i,s){const a=new av().copy(i).sub(e).cross(new av().copy(s).sub(e)).normalize();return new h1(a.clone(),a.dot(e))}}h1.EPSILON=1e-5;class fS{constructor(e,i){this.vertices=e,this.shared=i,this.plane=h1.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new fS(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class A2{constructor(e,i,s,a){this.pos=new av().copy(e),this.normal=new av().copy(i),this.uv=new av().copy(s),this.uv.z=0,a&&(this.color=new av().copy(a))}clone(){return new A2(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new A2(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class Cu{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new Cu;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const a=e.attributes.position,h=e.attributes.normal,g=e.attributes.uv,$=e.attributes.color,nt=e.groups;let rt;if(e.index)rt=e.index.array;else{rt=new Array(a.array.length/a.itemSize|0);for(let ut=0;ut<rt.length;ut++)rt[ut]=ut}const st=rt.length/3|0;s=new Array(st);for(let ut=0,mt=0,gt=rt.length;ut<gt;ut+=3,mt++){const yt=new Array(3);for(let wt=0;wt<3;wt++){const It=rt[ut+wt],Et=3*It,Ct=2*It,xt=a.array[Et],Bt=a.array[Et+1],Lt=a.array[Et+2],Gt=h.array[Et],Xt=h.array[Et+1],rn=h.array[Et+2],fn=g==null?void 0:g.array[Ct],wn=g==null?void 0:g.array[Ct+1];yt[wt]=new A2(new av(xt,Bt,Lt),new av(Gt,Xt,rn),new av(fn,wn,0),$&&new av($.array[Ct],$.array[Ct+1],$.array[Ct+2]))}if(i===void 0&&nt&&nt.length>0)for(const wt of nt)ut>=wt.start&&ut<wt.start+wt.count&&(s[mt]=new fS(yt,wt.materialIndex));else s[mt]=new fS(yt,i)}return Cu.fromPolygons(s.filter(ut=>!isNaN(ut.plane.normal.x)))}static toGeometry(e,i){let s=0;const a=e.polygons;for(const gt of a)s+=gt.vertices.length-2;const h=new d.u9r,g=new RD(3*s*3),$=new RD(3*s*3),nt=new CN(2*s*3);let rt;const st=[],ut=[];for(const gt of a){const yt=gt.vertices,wt=yt.length;gt.shared!==void 0&&(st[gt.shared]||(st[gt.shared]=[])),wt&&yt[0].color!==void 0&&(rt||(rt=new RD(3*s*3)));for(let It=3;It<=wt;It++)(gt.shared===void 0?ut:st[gt.shared]).push(g.top/3,g.top/3+1,g.top/3+2),g.write(yt[0].pos),g.write(yt[It-2].pos),g.write(yt[It-1].pos),$.write(yt[0].normal),$.write(yt[It-2].normal),$.write(yt[It-1].normal),nt&&(nt.write(yt[0].uv),nt.write(yt[It-2].uv),nt.write(yt[It-1].uv)),rt&&(rt.write(yt[0].color),rt.write(yt[It-2].color),rt.write(yt[It-1].color))}h.setAttribute("position",new d.TlE(g.array,3)),h.setAttribute("normal",new d.TlE($.array,3)),nt&&h.setAttribute("uv",new d.TlE(nt.array,2)),rt&&h.setAttribute("color",new d.TlE(rt.array,3));for(let gt=0;gt<st.length;gt++)st[gt]===void 0&&(st[gt]=[]);if(st.length){let gt=[],yt=0;for(let wt=0;wt<st.length;wt++)h.addGroup(yt,st[wt].length,wt),yt+=st[wt].length,gt=gt.concat(st[wt]);h.addGroup(yt,ut.length,st.length),gt=gt.concat(ut),h.setIndex(gt)}const mt=new d.yGw().copy(i).invert();return h.applyMatrix4(mt),h.computeBoundingSphere(),h.computeBoundingBox(),h}static fromMesh(e,i){const s=Cu.fromGeometry(e.geometry,i),a=new d.Pa4,h=new d.Vkp;h.getNormalMatrix(e.matrix);for(let g=0;g<s.polygons.length;g++){const $=s.polygons[g];for(let nt=0;nt<$.vertices.length;nt++){const rt=$.vertices[nt];rt.pos.copy(a.copy(rt.pos.toVector3()).applyMatrix4(e.matrix)),rt.normal.copy(a.copy(rt.normal.toVector3()).applyMatrix3(h))}}return s}static toMesh(e,i,s){const a=Cu.toGeometry(e,i),h=new d.Kj0(a,s);return h.matrix.copy(i),h.matrix.decompose(h.position,h.quaternion,h.scale),h.rotation.setFromQuaternion(h.quaternion),h.updateMatrixWorld(),h.castShadow=h.receiveShadow=!0,h}static union(e,i){const s=Cu.fromMesh(e),a=Cu.fromMesh(i);return Cu.toMesh(s.union(a),e.matrix,e.material)}static subtract(e,i){const s=Cu.fromMesh(e),a=Cu.fromMesh(i);return Cu.toMesh(s.subtract(a),e.matrix,e.material)}static intersect(e,i){const s=Cu.fromMesh(e),a=Cu.fromMesh(i);return Cu.toMesh(s.intersect(a),e.matrix,e.material)}clone(){const e=new Cu;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new gy(this.clone().polygons),s=new gy(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),Cu.fromPolygons(i.allPolygons())}subtract(e){const i=new gy(this.clone().polygons),s=new gy(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),Cu.fromPolygons(i.allPolygons())}intersect(e){const i=new gy(this.clone().polygons),s=new gy(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),Cu.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return Cu.toMesh(this,e,i)}toGeometry(e){return Cu.toGeometry(this,e)}}var mS=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const kD=["union","subtract","intersect"];class lA extends Ks{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[jo],this.rootMesh=new d.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(jo))===null||i===void 0||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();s&&s.geometry&&(s.userData._isCSGMesh||(s.userData.csgBrush||(s.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&Tu(e,"csg."+e.ext)}async exportObject(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter;if(!s||!this.rootObject)return;const a=this.rootMesh.visible;this.rootMesh.visible=!0;const h=await s.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=a,h}_updateSelectedProperties(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();s&&s.userData.csgBrush&&(s.userData.csgBrush.enabled=this.csgSelectedEnabled,s.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,i,s,a,h,g,$,nt;const rt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();rt&&(this.csgSelectedEnabled=(a=(s=rt.userData.csgBrush)===null||s===void 0?void 0:s.enabled)!==null&&a!==void 0&&a,this.csgSelectedOperation=(g=(h=rt.userData.csgBrush)===null||h===void 0?void 0:h.operation)!==null&&g!==void 0?g:"union"),(nt=($=this.uiConfig)===null||$===void 0?void 0:$.uiRefresh)===null||nt===void 0||nt.call($,"postFrame",!0)}_preFrame(){var e,i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const a=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((i=this.rootMesh.userData.dispose)!==null&&i!==void 0?i:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(a)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)===null||s===void 0||s.modelObject.add(this.rootMesh)),this.showResult?(a.forEach(h=>{h[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(a.forEach(h=>{h[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const i=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(s=>{var a;s.isMesh&&s.geometry&&(!((a=s.userData.csgBrush)===null||a===void 0)&&a.enabled)&&i.push([s,s.userData.csgBrush.operation])}),i}_sceneUpdate(e){var i,s;!((s=(i=e==null?void 0:e.object)===null||i===void 0?void 0:i.userData)===null||s===void 0)&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}mS([rs("Show Result",c=>({onChange:()=>{var e;return(e=c._viewer)===null||e===void 0?void 0:e.setDirty()}}))],lA.prototype,"showResult",void 0),mS([No("Make CSG Brush",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();return!(s!=null&&s.userData)||!!s.userData.csgBrush||s.userData._isCSGMesh}}))],lA.prototype,"makeSelectedCSGBrush",null),mS([rs("Enabled",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],lA.prototype,"csgSelectedEnabled",void 0),mS([yp("Operation",kD.map(c=>({label:c})),c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(jo))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],lA.prototype,"csgSelectedOperation",void 0),mS([No("Refresh CSG")],lA.prototype,"refreshCSG",null),mS([No("Export Result",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],lA.prototype,"downloadObject",null);function Y3(c,e){let i=new Cu;const s=c.map(h=>h[0].material).flatMap(h=>h);c.forEach(([h,g])=>{if(!kD.includes(g))return void console.error(`Unknown operation ${g}`);h.updateMatrix(),h.updateMatrixWorld();const $=h.matrix;h.matrix=h.matrixWorld;let nt=0;nt=Array.isArray(h.material)?void 0:s.indexOf(h.material),i=i[g](Cu.fromMesh(h,nt)),h.matrix=$});const a=i.toMesh(e??new d.yGw().identity(),s);return a.userData._isCSGMesh=!0,a.geometry.groups=a.geometry.groups.filter(h=>h.count>0),a}let w2=class extends lA{_buildCSGMesh(c){return Y3(c)}};w2.PluginType="CSGPluginBSP",w2=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g}([ho("CSG Plugin (BSP)")],w2);class cA{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,a=-1/0;for(let h=0,g=e.length;h<g;h++){const $=e[h][i];s=$<s?$:s,a=$>a?$:a}this.min=s,this.max=a}setFromPoints(e,i){let s=1/0,a=-1/0;for(let h=0,g=i.length;h<g;h++){const $=i[h],nt=e.dot($);s=nt<s?nt:s,a=nt>a?nt:a}this.min=s,this.max=a}isSeparated(e){return this.min>e.max||e.min>this.max}}cA.prototype.setFromBox=function(){const c=new d.Pa4;return function(e,i){const s=i.min,a=i.max;let h=1/0,g=-1/0;for(let $=0;$<=1;$++)for(let nt=0;nt<=1;nt++)for(let rt=0;rt<=1;rt++){c.x=s.x*$+a.x*(1-$),c.y=s.y*nt+a.y*(1-nt),c.z=s.z*rt+a.z*(1-rt);const st=e.dot(c);h=Math.min(st,h),g=Math.max(st,g)}this.min=h,this.max=g}}();const MN=function(){const c=new d.Pa4,e=new d.Pa4,i=new d.Pa4;return function(s,a,h){const g=s.start,$=c,nt=a.start,rt=e;i.subVectors(g,nt),c.subVectors(s.end,a.start),e.subVectors(a.end,a.start);const st=i.dot(rt),ut=rt.dot($),mt=rt.dot(rt),gt=i.dot($),yt=$.dot($)*mt-ut*ut;let wt,It;wt=yt!==0?(st*ut-gt*mt)/yt:0,It=(st+wt*ut)/mt,h.x=wt,h.y=It}}(),BD=function(){const c=new d.FM8,e=new d.Pa4,i=new d.Pa4;return function(s,a,h,g){MN(s,a,c);let $=c.x,nt=c.y;if($>=0&&$<=1&&nt>=0&&nt<=1)return s.at($,h),void a.at(nt,g);if($>=0&&$<=1)return nt<0?a.at(0,g):a.at(1,g),void s.closestPointToPoint(g,!0,h);if(nt>=0&&nt<=1)return $<0?s.at(0,h):s.at(1,h),void a.closestPointToPoint(h,!0,g);{let rt,st;rt=$<0?s.start:s.end,st=nt<0?a.start:a.end;const ut=e,mt=i;return s.closestPointToPoint(st,!0,e),a.closestPointToPoint(rt,!0,i),ut.distanceToSquared(st)<=mt.distanceToSquared(rt)?(h.copy(ut),void g.copy(st)):(h.copy(rt),void g.copy(mt))}}}(),TN=function(){const c=new d.Pa4,e=new d.Pa4,i=new d.JOQ,s=new d.Zzh;return function(a,h){const{radius:g,center:$}=a,{a:nt,b:rt,c:st}=h;if(s.start=nt,s.end=rt,s.closestPointToPoint($,!0,c).distanceTo($)<=g||(s.start=nt,s.end=st,s.closestPointToPoint($,!0,c).distanceTo($)<=g)||(s.start=rt,s.end=st,s.closestPointToPoint($,!0,c).distanceTo($)<=g))return!0;const ut=h.getPlane(i);if(Math.abs(ut.distanceToPoint($))<=g){const mt=ut.projectPoint($,e);if(h.containsPoint(mt))return!0}return!1}}();function gS(c){return Math.abs(c)<1e-15}class vy extends d.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new d.Pa4),this.satBounds=new Array(4).fill().map(()=>new cA),this.points=[this.a,this.b,this.c],this.sphere=new d.aLr,this.plane=new d.JOQ,this.needsUpdate=!0}intersectsSphere(e){return TN(e,this)}update(){const e=this.a,i=this.b,s=this.c,a=this.points,h=this.satAxes,g=this.satBounds,$=h[0],nt=g[0];this.getNormal($),nt.setFromPoints($,a);const rt=h[1],st=g[1];rt.subVectors(e,i),st.setFromPoints(rt,a);const ut=h[2],mt=g[2];ut.subVectors(i,s),mt.setFromPoints(ut,a);const gt=h[3],yt=g[3];gt.subVectors(s,e),yt.setFromPoints(gt,a),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint($,e),this.needsUpdate=!1}}vy.prototype.closestPointToSegment=function(){const c=new d.Pa4,e=new d.Pa4,i=new d.Zzh;return function(s,a=null,h=null){const{start:g,end:$}=s,nt=this.points;let rt,st=1/0;for(let ut=0;ut<3;ut++){const mt=(ut+1)%3;i.start.copy(nt[ut]),i.end.copy(nt[mt]),BD(i,s,c,e),rt=c.distanceToSquared(e),rt<st&&(st=rt,a&&a.copy(c),h&&h.copy(e))}return this.closestPointToPoint(g,c),rt=g.distanceToSquared(c),rt<st&&(st=rt,a&&a.copy(c),h&&h.copy(g)),this.closestPointToPoint($,c),rt=$.distanceToSquared(c),rt<st&&(st=rt,a&&a.copy(c),h&&h.copy($)),Math.sqrt(st)}}(),vy.prototype.intersectsTriangle=function(){const c=new vy,e=new Array(3),i=new Array(3),s=new cA,a=new cA,h=new d.Pa4,g=new d.Pa4,$=new d.Pa4,nt=new d.Pa4,rt=new d.Zzh,st=new d.Zzh,ut=new d.Zzh;return function(mt,gt=null){this.needsUpdate&&this.update(),mt.isExtendedTriangle?mt.needsUpdate&&mt.update():(c.copy(mt),c.update(),mt=c);const yt=this.plane,wt=mt.plane;if(Math.abs(yt.normal.dot(wt.normal))>1-1e-10){const It=this.satBounds,Et=this.satAxes;i[0]=mt.a,i[1]=mt.b,i[2]=mt.c;for(let Bt=0;Bt<4;Bt++){const Lt=It[Bt],Gt=Et[Bt];if(s.setFromPoints(Gt,i),Lt.isSeparated(s))return!1}const Ct=mt.satBounds,xt=mt.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let Bt=0;Bt<4;Bt++){const Lt=Ct[Bt],Gt=xt[Bt];if(s.setFromPoints(Gt,e),Lt.isSeparated(s))return!1}for(let Bt=0;Bt<4;Bt++){const Lt=Et[Bt];for(let Gt=0;Gt<4;Gt++){const Xt=xt[Gt];if(h.crossVectors(Lt,Xt),s.setFromPoints(h,e),a.setFromPoints(h,i),s.isSeparated(a))return!1}}return gt&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),gt.start.set(0,0,0),gt.end.set(0,0,0)),!0}{const It=this.points;let Et=!1,Ct=0;for(let bn=0;bn<3;bn++){const Dn=It[bn],En=It[(bn+1)%3];rt.start.copy(Dn),rt.end.copy(En),rt.delta(g);const Tn=Et?st.start:st.end,Un=gS(wt.distanceToPoint(Dn));if(gS(wt.normal.dot(g))&&Un){st.copy(rt),Ct=2;break}if((wt.intersectLine(rt,Tn)||Un)&&!gS(Tn.distanceTo(En))){if(Ct++,Et)break;Et=!0}}if(Ct===1&&this.containsPoint(st.start))return gt&&(gt.start.copy(st.start),gt.end.copy(st.start)),!0;if(Ct!==2)return!1;const xt=mt.points;let Bt=!1,Lt=0;for(let bn=0;bn<3;bn++){const Dn=xt[bn],En=xt[(bn+1)%3];rt.start.copy(Dn),rt.end.copy(En),rt.delta($);const Tn=Bt?ut.start:ut.end,Un=gS(yt.distanceToPoint(Dn));if(gS(yt.normal.dot($))&&Un){ut.copy(rt),Lt=2;break}if((yt.intersectLine(rt,Tn)||Un)&&!gS(Tn.distanceTo(En))){if(Lt++,Bt)break;Bt=!0}}if(Lt===1&&this.containsPoint(ut.start))return gt&&(gt.start.copy(ut.start),gt.end.copy(ut.start)),!0;if(Lt!==2)return!1;if(st.delta(g),ut.delta($),g.dot($)<0){let bn=ut.start;ut.start=ut.end,ut.end=bn}const Gt=st.start.dot(g),Xt=st.end.dot(g),rn=ut.start.dot(g),fn=ut.end.dot(g),wn=Xt<rn,Cn=Gt<fn;return(Gt===fn||rn===Xt||wn!==Cn)&&(gt&&(nt.subVectors(st.start,ut.start),nt.dot(g)>0?gt.start.copy(st.start):gt.start.copy(ut.start),nt.subVectors(st.end,ut.end),nt.dot(g)<0?gt.end.copy(st.end):gt.end.copy(ut.end)),!0)}}}(),vy.prototype.distanceToPoint=function(){const c=new d.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),vy.prototype.distanceToTriangle=function(){const c=new d.Pa4,e=new d.Pa4,i=["a","b","c"],s=new d.Zzh,a=new d.Zzh;return function(h,g=null,$=null){const nt=g||$?s:null;if(this.intersectsTriangle(h,nt))return(g||$)&&(g&&nt.getCenter(g),$&&nt.getCenter($)),0;let rt=1/0;for(let st=0;st<3;st++){let ut;const mt=i[st],gt=h[mt];this.closestPointToPoint(gt,c),ut=gt.distanceToSquared(c),ut<rt&&(rt=ut,g&&g.copy(c),$&&$.copy(gt));const yt=this[mt];h.closestPointToPoint(yt,c),ut=yt.distanceToSquared(c),ut<rt&&(rt=ut,g&&g.copy(yt),$&&$.copy(c))}for(let st=0;st<3;st++){const ut=i[st],mt=i[(st+1)%3];s.set(this[ut],this[mt]);for(let gt=0;gt<3;gt++){const yt=i[gt],wt=i[(gt+1)%3];a.set(h[yt],h[wt]),BD(s,a,c,e);const It=c.distanceToSquared(e);It<rt&&(rt=It,g&&g.copy(c),$&&$.copy(e))}}return Math.sqrt(rt)}}();class X3{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:a}=this;s[e]||(s[e]=[],a.push(e)),s[e].push(i)}}const d1=new d.zHn,K3=new d.yGw,Lm=new d.CJI,uA=new d.Pa4,$3=new d.Ltg,J3=new d.Ltg,Z3=new d.Ltg,OD=new d.Ltg,x2=new d.Ltg,b2=new d.Ltg,LD=new d.Zzh,ND=1e-8;let E2=null;function eO(c){E2=c}function tO(c,e){function i(){return Math.random()-.5}d1.origin.copy(c.a).add(c.b).add(c.c).multiplyScalar(1/3),c.getNormal(d1.direction);let s=0,a=1/0;for(let h=0;h<3;h++){d1.direction.x+=i()*ND,d1.direction.y+=i()*ND,d1.direction.z+=i()*ND;const g=e.raycastFirst(d1,d.ehD);if(Boolean(g&&d1.direction.dot(g.face.normal)>0)&&s++,g!==null&&(a=Math.min(a,g.distance)),a===0||s/3>.5||(h-s+1)/3>.5)break}return a===0?0:s/3>.5?-1:1}function nO(c,e,i,s,a,h,g=!1){const $=i.attributes,nt=i.index,rt=3*c,st=nt.getX(rt+0),ut=nt.getX(rt+1),mt=nt.getX(rt+2);for(const gt in h){const yt=$[gt],wt=h[gt];if(!(gt in $))throw new Error(`CSG Operations: Attribute ${gt} not available on geometry.`);const It=yt.itemSize;gt==="position"?(Lm.a.fromBufferAttribute(yt,st).applyMatrix4(s),Lm.b.fromBufferAttribute(yt,ut).applyMatrix4(s),Lm.c.fromBufferAttribute(yt,mt).applyMatrix4(s),FD(Lm.a,Lm.b,Lm.c,e,3,wt,g)):gt==="normal"?(Lm.a.fromBufferAttribute(yt,st).applyNormalMatrix(a),Lm.b.fromBufferAttribute(yt,ut).applyNormalMatrix(a),Lm.c.fromBufferAttribute(yt,mt).applyNormalMatrix(a),g&&(Lm.a.multiplyScalar(-1),Lm.b.multiplyScalar(-1),Lm.c.multiplyScalar(-1)),FD(Lm.a,Lm.b,Lm.c,e,3,wt,g,!0)):($3.fromBufferAttribute(yt,st),J3.fromBufferAttribute(yt,ut),Z3.fromBufferAttribute(yt,mt),FD($3,J3,Z3,e,It,wt,g))}}function rO(c,e,i,s,a,h,g,$=!1){UD(c,s,a,h,g,$),UD(e,s,a,h,g,$),UD(i,s,a,h,g,$)}function iO(c,e,i=!1){switch(c){case 0:if(e===1||e===0&&i)return 1;break;case 1:if(i){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&i)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${c}".`)}return 2}function FD(c,e,i,s,a,h,g=!1,$=!1){const nt=rt=>{h.push(rt.x),a>1&&h.push(rt.y),a>2&&h.push(rt.z),a>3&&h.push(rt.w)};OD.set(0,0,0,0).addScaledVector(c,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),x2.set(0,0,0,0).addScaledVector(c,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),b2.set(0,0,0,0).addScaledVector(c,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),$&&(OD.normalize(),x2.normalize(),b2.normalize()),nt(OD),g?(nt(b2),nt(x2)):(nt(x2),nt(b2))}function UD(c,e,i,s,a,h=!1){for(const g in a){const $=e[g],nt=a[g];if(!(g in e))throw new Error(`CSG Operations: Attribute ${g} no available on geometry.`);const rt=$.itemSize;g==="position"?(uA.fromBufferAttribute($,c).applyMatrix4(i),nt.push(uA.x,uA.y,uA.z)):g==="normal"?(uA.fromBufferAttribute($,c).applyNormalMatrix(s),h&&uA.multiplyScalar(-1),nt.push(uA.x,uA.y,uA.z)):(nt.push($.getX(c)),rt>1&&nt.push($.getY(c)),rt>2&&nt.push($.getZ(c)),rt>3&&nt.push($.getW(c)))}}const Ew=1e-14,S2=1e-7,_y=new d.Zzh,Qu=new d.Zzh,y0=new d.Pa4,sO=new d.Pa4,_M=new d.JOQ,IN=new vy;function yM(c){return c.a.distanceToSquared(c.b)<Ew||c.a.distanceToSquared(c.c)<Ew||c.b.distanceToSquared(c.c)<Ew}class PN extends d.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,i=null,s=-1){if(this.originalSide!==null&&this.side===null)return;y0.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const a=e.distanceToPoint(y0)<0?-1:1;i&&s!==-1?a===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=a,this.side=a),a!==this.side&&(this.side=null))}}class DN{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new PN);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class RN{constructor(){this.trianglePool=new DN,this.triangles=[],this.normal=new d.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:a}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let h=0,g=e.length;h<g;h++){const $=e[h];if(h===0)$.getNormal(a);else if(Math.abs(1-$.getNormal(y0).dot(a))>Ew)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const nt=s.getTriangle();nt.copy($),i.push(nt)}else{e.getNormal(a);const h=s.getTriangle();h.copy(e),i.push(h)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(_M),Math.abs(1-Math.abs(_M.normal.dot(i)))<S2){const a=[e.a,e.b,e.c];for(let h=0;h<3;h++){const g=(h+1)%3,$=a[h],nt=a[g];y0.subVectors(nt,$).normalize(),sO.crossVectors(i,y0),_M.setFromNormalAndCoplanarPoint(sO,$),this.splitByPlane(_M,e,h)}for(let h=0,g=s.length;h<g;h++)s[h].coplanarCount=0}else this.splitByPlane(_M,e)}splitByPlane(e,i=null,s=-1){const{triangles:a,trianglePool:h}=this;let g=null;i!==null&&(g=IN,g.copy(i),g.needsUpdate=!0);for(let $=0,nt=a.length;$<nt;$++){const rt=a[$],{a:st,b:ut,c:mt}=rt;if(g&&(!g.intersectsTriangle(rt,_y)||_y.distance()<1e-5)){rt.updateSide(e,g,s),rt.side=null;continue}let gt=0,yt=-1,wt=0,It=0,Et=!1;const Ct=[st,ut,mt];for(let xt=0;xt<3;xt++){const Bt=(xt+1)%3;_y.start.copy(Ct[xt]),_y.end.copy(Ct[Bt]);const Lt=e.distanceToPoint(_y.start),Gt=e.distanceToPoint(_y.end);Math.abs(Lt)<Ew?It++:Lt>0&&wt++,Math.abs(Lt)<S2&&Math.abs(Gt)<S2&&(Et=!0);let Xt=!!e.intersectLine(_y,y0);!Xt&&Math.abs(Gt)<Ew&&(y0.copy(_y.end),Xt=!0),!Xt||y0.distanceTo(_y.start)<Ew||(y0.distanceTo(_y.end)<Ew&&(yt=xt),gt===0?Qu.start.copy(y0):Qu.end.copy(y0),gt++)}if(!Et&&It<2&&gt===2&&Qu.distance()>S2)if(yt!==-1){yt=(yt+1)%3;let xt=0;xt===yt&&(xt=(xt+1)%3);let Bt=xt+1;Bt===yt&&(Bt=(Bt+1)%3);const Lt=h.getTriangle();Lt.a.copy(Ct[Bt]),Lt.b.copy(Qu.end),Lt.c.copy(Qu.start),yM(Lt)||(a.push(Lt),Lt.initFrom(rt),Lt.updateSide(e,g,s)),rt.a.copy(Ct[xt]),rt.b.copy(Qu.start),rt.c.copy(Qu.end),yM(rt)?(a.splice($,1),$--,nt--):rt.updateSide(e,g,s)}else{const xt=Ct.findIndex(rn=>wt>=2?e.distanceToPoint(rn)<0:e.distanceToPoint(rn)>0);if(xt===0){let rn=Qu.start;Qu.start=Qu.end,Qu.end=rn}else if(xt===-1)continue;const Bt=(xt+1)%3,Lt=(xt+2)%3,Gt=h.getTriangle(),Xt=h.getTriangle();Ct[Bt].distanceToSquared(Qu.start)<Ct[Lt].distanceToSquared(Qu.end)?(Gt.a.copy(Ct[Bt]),Gt.b.copy(Qu.start),Gt.c.copy(Qu.end),Xt.a.copy(Ct[Bt]),Xt.b.copy(Ct[Lt]),Xt.c.copy(Qu.start)):(Gt.a.copy(Ct[Lt]),Gt.b.copy(Qu.start),Gt.c.copy(Qu.end),Xt.a.copy(Ct[Bt]),Xt.b.copy(Ct[Lt]),Xt.c.copy(Qu.end)),rt.a.copy(Ct[xt]),rt.b.copy(Qu.end),rt.c.copy(Qu.start),yM(Gt)||(a.push(Gt),Gt.initFrom(rt),Gt.updateSide(e,g,s)),yM(Xt)||(a.push(Xt),Xt.initFrom(rt),Xt.updateSide(e,g,s)),yM(rt)?(a.splice($,1),$--,nt--):rt.updateSide(e,g,s)}else gt===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function oO(){return typeof SharedArrayBuffer<"u"}function kN(c){if(c.buffer instanceof SharedArrayBuffer)return c;const e=c.constructor,i=c.buffer,s=new SharedArrayBuffer(i.byteLength),a=new Uint8Array(i);return new Uint8Array(s).set(a,0),new e(s)}class aO{constructor(e,i=500){const s=oO()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:a}=this;e===null&&(e=~~(s.length*a));const h=new i(e);h.set(s,0),this.array=h}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let a=0,h=e.length;a<h;a++)i[s+a]=e[a];this.length+=e.length}clear(){this.length=0}}class BN{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let a=0;for(let h=0;h<i;h++)a+=s[h][e].length;return a}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const a={};i.push(a);for(const h in s)a[h]=new aO(s[h].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,a=s[0][e];if(a){if(a.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let h=0,g=s.length;h<g;h++)s[h][e]=new aO(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class ON{constructor(e){this.triangle=new d.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new d.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class lO{constructor(){this.data={}}addTriangleIntersection(e,i,s,a){const{data:h}=this;h[e]||(h[e]=new ON(i)),h[e].addTriangle(s,a)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const a in i)s.push(i[a].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,a=new Set,h=[],g=$=>{if(s[$])if(i!==null)s[$].intersects[i]&&h.push(s[$].intersects[i]);else{const nt=s[$].intersects;for(const rt in nt)a.has(rt)||(a.add(rt),h.push(nt[rt]))}};if(e!==null)g(e);else for(const $ in s)g($);return h}reset(){this.data={}}}class LN{constructor(){this.enabled=!1,this.triangleIntersectsA=new lO,this.triangleIntersectsB=new lO,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,a){const{triangleIntersectsA:h,triangleIntersectsB:g}=this;h.addTriangleIntersection(e,i,s,a),g.addTriangleIntersection(s,a,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const Sw=new d.yGw,vS=new d.Vkp,p1=new d.CJI,C2=new d.CJI,M2=new d.CJI,AM=new d.CJI;function NN(c){for(const e of c)return e}function cO(c,e,i,s,a,h,g,$=0){Sw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),vS.getNormalMatrix(c.matrixWorld);const nt=c.geometry.groupIndices,rt=c.geometry.index,st=c.geometry.attributes.position,ut=e.geometry.boundsTree,mt=e.geometry.index,gt=e.geometry.attributes.position,yt=i.ids,wt=i.intersectionSet;for(let It=0,Et=yt.length;It<Et;It++){const Ct=yt[It],xt=$===-1?0:nt[Ct]+$,Bt=g.getGroupSet(xt),Lt=3*Ct,Gt=rt.getX(Lt+0),Xt=rt.getX(Lt+1),rn=rt.getX(Lt+2);p1.a.fromBufferAttribute(st,Gt).applyMatrix4(Sw),p1.b.fromBufferAttribute(st,Xt).applyMatrix4(Sw),p1.c.fromBufferAttribute(st,rn).applyMatrix4(Sw),h.initialize(p1);const fn=wt[Ct];for(let Cn=0,bn=fn.length;Cn<bn;Cn++){const Dn=3*fn[Cn],En=mt.getX(Dn+0),Tn=mt.getX(Dn+1),Un=mt.getX(Dn+2);C2.a.fromBufferAttribute(gt,En),C2.b.fromBufferAttribute(gt,Tn),C2.c.fromBufferAttribute(gt,Un),h.splitByTriangle(C2)}const wn=h.triangles;for(let Cn=0,bn=wn.length;Cn<bn;Cn++){const Dn=wn[Cn],En=iO(s,tO(Dn,ut),a);if(En!==2)switch(p1.getBarycoord(Dn.a,AM.a),p1.getBarycoord(Dn.b,AM.b),p1.getBarycoord(Dn.c,AM.c),En){case 1:nO(Ct,AM,c.geometry,c.matrixWorld,vS,Bt);break;case 0:nO(Ct,AM,c.geometry,c.matrixWorld,vS,Bt,!0)}}}return yt.length}function uO(c,e,i,s,a,h,g=0){Sw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),vS.getNormalMatrix(c.matrixWorld);const $=e.geometry.boundsTree,nt=c.geometry.groupIndices,rt=c.geometry.index,st=c.geometry.attributes,ut=st.position,mt=[],gt=c.geometry.halfEdges,yt=new Set;for(let wt=0,It=rt.count/3;wt<It;wt++)wt in i.intersectionSet||yt.add(wt);for(;yt.size>0;){const wt=NN(yt);yt.delete(wt),mt.push(wt);const It=3*wt,Et=rt.getX(It+0),Ct=rt.getX(It+1),xt=rt.getX(It+2);M2.a.fromBufferAttribute(ut,Et).applyMatrix4(Sw),M2.b.fromBufferAttribute(ut,Ct).applyMatrix4(Sw),M2.c.fromBufferAttribute(ut,xt).applyMatrix4(Sw);const Bt=iO(s,tO(M2,$),a);for(;mt.length>0;){const Lt=mt.pop(),Gt=g===-1?0:nt[Lt]+g,Xt=h.getGroupSet(Gt);for(let bn=0;bn<3;bn++){const Dn=gt.getSiblingTriangleIndex(Lt,bn);Dn!==-1&&yt.has(Dn)&&(mt.push(Dn),yt.delete(Dn))}const rn=3*Lt,fn=rt.getX(rn+0),wn=rt.getX(rn+1),Cn=rt.getX(rn+2);switch(Bt){case 1:rO(fn,wn,Cn,st,c.matrixWorld,vS,Xt);break;case 0:rO(Cn,wn,fn,st,c.matrixWorld,vS,Xt,a)}}}}const jD=1.25,zD=65535,FN=Math.pow(2,-24);class T2{constructor(){}}function yy(c,e,i){return i.min.x=e[c],i.min.y=e[c+1],i.min.z=e[c+2],i.max.x=e[c+3],i.max.y=e[c+4],i.max.z=e[c+5],i}function hO(c){let e=-1,i=-1/0;for(let s=0;s<3;s++){const a=c[s+3]-c[s];a>i&&(i=a,e=s)}return e}function dO(c,e){e.set(c)}function pO(c,e,i){let s,a;for(let h=0;h<3;h++){const g=h+3;s=c[h],a=e[h],i[h]=s<a?s:a,s=c[g],a=e[g],i[g]=s>a?s:a}}function I2(c,e,i){for(let s=0;s<3;s++){const a=e[c+2*s],h=e[c+2*s+1],g=a-h,$=a+h;g<i[s]&&(i[s]=g),$>i[s+3]&&(i[s+3]=$)}}function wM(c){const e=c[3]-c[0],i=c[4]-c[1],s=c[5]-c[2];return 2*(e*i+i*s+s*e)}function VD(c,e,i,s,a=null){let h=1/0,g=1/0,$=1/0,nt=-1/0,rt=-1/0,st=-1/0,ut=1/0,mt=1/0,gt=1/0,yt=-1/0,wt=-1/0,It=-1/0;const Et=a!==null;for(let Ct=6*e,xt=6*(e+i);Ct<xt;Ct+=6){const Bt=c[Ct+0],Lt=c[Ct+1],Gt=Bt-Lt,Xt=Bt+Lt;Gt<h&&(h=Gt),Xt>nt&&(nt=Xt),Et&&Bt<ut&&(ut=Bt),Et&&Bt>yt&&(yt=Bt);const rn=c[Ct+2],fn=c[Ct+3],wn=rn-fn,Cn=rn+fn;wn<g&&(g=wn),Cn>rt&&(rt=Cn),Et&&rn<mt&&(mt=rn),Et&&rn>wt&&(wt=rn);const bn=c[Ct+4],Dn=c[Ct+5],En=bn-Dn,Tn=bn+Dn;En<$&&($=En),Tn>st&&(st=Tn),Et&&bn<gt&&(gt=bn),Et&&bn>It&&(It=bn)}s[0]=h,s[1]=g,s[2]=$,s[3]=nt,s[4]=rt,s[5]=st,Et&&(a[0]=ut,a[1]=mt,a[2]=gt,a[3]=yt,a[4]=wt,a[5]=It)}const UN=(c,e)=>c.candidate-e.candidate,Cw=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),P2=new Float32Array(6);class Ay extends d.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new d.yGw,this.invMatrix=new d.yGw,this.points=new Array(8).fill().map(()=>new d.Pa4),this.satAxes=new Array(3).fill().map(()=>new d.Pa4),this.satBounds=new Array(3).fill().map(()=>new cA),this.alignedSatBounds=new Array(3).fill().map(()=>new cA),this.needsUpdate=!1}set(e,i,s){super.set(e,i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ay.prototype.update=function(){const c=this.matrix,e=this.min,i=this.max,s=this.points;for(let nt=0;nt<=1;nt++)for(let rt=0;rt<=1;rt++)for(let st=0;st<=1;st++){const ut=s[1*nt|2*rt|4*st];ut.x=nt?i.x:e.x,ut.y=rt?i.y:e.y,ut.z=st?i.z:e.z,ut.applyMatrix4(c)}const a=this.satBounds,h=this.satAxes,g=s[0];for(let nt=0;nt<3;nt++){const rt=h[nt],st=a[nt],ut=s[1<<nt];rt.subVectors(g,ut),st.setFromPoints(rt,s)}const $=this.alignedSatBounds;$[0].setFromPointsField(s,"x"),$[1].setFromPointsField(s,"y"),$[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Ay.prototype.intersectsBox=function(){const c=new cA;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,a=this.satBounds,h=this.satAxes,g=this.alignedSatBounds;if(c.min=i.x,c.max=s.x,g[0].isSeparated(c)||(c.min=i.y,c.max=s.y,g[1].isSeparated(c))||(c.min=i.z,c.max=s.z,g[2].isSeparated(c)))return!1;for(let $=0;$<3;$++){const nt=h[$],rt=a[$];if(c.setFromBox(nt,e),rt.isSeparated(c))return!1}return!0}}(),Ay.prototype.intersectsTriangle=function(){const c=new vy,e=new Array(3),i=new cA,s=new cA,a=new d.Pa4;return function(h){this.needsUpdate&&this.update(),h.isExtendedTriangle?h.needsUpdate&&h.update():(c.copy(h),c.update(),h=c);const g=this.satBounds,$=this.satAxes;e[0]=h.a,e[1]=h.b,e[2]=h.c;for(let ut=0;ut<3;ut++){const mt=g[ut],gt=$[ut];if(i.setFromPoints(gt,e),mt.isSeparated(i))return!1}const nt=h.satBounds,rt=h.satAxes,st=this.points;for(let ut=0;ut<3;ut++){const mt=nt[ut],gt=rt[ut];if(i.setFromPoints(gt,st),mt.isSeparated(i))return!1}for(let ut=0;ut<3;ut++){const mt=$[ut];for(let gt=0;gt<4;gt++){const yt=rt[gt];if(a.crossVectors(mt,yt),i.setFromPoints(a,e),s.setFromPoints(a,st),i.isSeparated(s))return!1}}return!0}}(),Ay.prototype.closestPointToPoint=function(c,e){return this.needsUpdate&&this.update(),e.copy(c).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},Ay.prototype.distanceToPoint=function(){const c=new d.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),Ay.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new d.Zzh),i=new Array(12).fill().map(()=>new d.Zzh),s=new d.Pa4,a=new d.Pa4;return function(h,g=0,$=null,nt=null){if(this.needsUpdate&&this.update(),this.intersectsBox(h))return($||nt)&&(h.getCenter(a),this.closestPointToPoint(a,s),h.closestPointToPoint(s,a),$&&$.copy(s),nt&&nt.copy(a)),0;const rt=g*g,st=h.min,ut=h.max,mt=this.points;let gt=1/0;for(let wt=0;wt<8;wt++){const It=mt[wt];a.copy(It).clamp(st,ut);const Et=It.distanceToSquared(a);if(Et<gt&&(gt=Et,$&&$.copy(It),nt&&nt.copy(a),Et<rt))return Math.sqrt(Et)}let yt=0;for(let wt=0;wt<3;wt++)for(let It=0;It<=1;It++)for(let Et=0;Et<=1;Et++){const Ct=(wt+1)%3,xt=(wt+2)%3,Bt=1<<wt|It<<Ct|Et<<xt,Lt=mt[It<<Ct|Et<<xt],Gt=mt[Bt];e[yt].set(Lt,Gt);const Xt=c[wt],rn=c[Ct],fn=c[xt],wn=i[yt],Cn=wn.start,bn=wn.end;Cn[Xt]=st[Xt],Cn[rn]=It?st[rn]:ut[rn],Cn[fn]=Et?st[fn]:ut[rn],bn[Xt]=ut[Xt],bn[rn]=It?st[rn]:ut[rn],bn[fn]=Et?st[fn]:ut[rn],yt++}for(let wt=0;wt<=1;wt++)for(let It=0;It<=1;It++)for(let Et=0;Et<=1;Et++){a.x=wt?ut.x:st.x,a.y=It?ut.y:st.y,a.z=Et?ut.z:st.z,this.closestPointToPoint(a,s);const Ct=a.distanceToSquared(s);if(Ct<gt&&(gt=Ct,$&&$.copy(s),nt&&nt.copy(a),Ct<rt))return Math.sqrt(Ct)}for(let wt=0;wt<12;wt++){const It=e[wt];for(let Et=0;Et<12;Et++){const Ct=i[Et];BD(It,Ct,s,a);const xt=s.distanceToSquared(a);if(xt<gt&&(gt=xt,$&&$.copy(s),nt&&nt.copy(a),xt<rt))return Math.sqrt(xt)}}return Math.sqrt(gt)}}();const D2=new d.Pa4,R2=new d.Pa4,k2=new d.Pa4,fO=new d.FM8,mO=new d.FM8,gO=new d.FM8,vO=new d.Pa4;function _O(c,e,i,s,a){const h=3*s,g=c.index.getX(h),$=c.index.getX(h+1),nt=c.index.getX(h+2),rt=function(st,ut,mt,gt,yt,wt,It){D2.fromBufferAttribute(ut,gt),R2.fromBufferAttribute(ut,yt),k2.fromBufferAttribute(ut,wt);const Et=function(Ct,xt,Bt,Lt,Gt,Xt){let rn;return rn=Xt===d._Li?Ct.intersectTriangle(Lt,Bt,xt,!0,Gt):Ct.intersectTriangle(xt,Bt,Lt,Xt!==d.ehD,Gt),rn===null?null:{distance:Ct.origin.distanceTo(Gt),point:Gt.clone()}}(st,D2,R2,k2,vO,It);if(Et){mt&&(fO.fromBufferAttribute(mt,gt),mO.fromBufferAttribute(mt,yt),gO.fromBufferAttribute(mt,wt),Et.uv=d.CJI.getUV(vO,D2,R2,k2,fO,mO,gO,new d.FM8));const Ct={a:gt,b:yt,c:wt,normal:new d.Pa4,materialIndex:0};d.CJI.getNormal(D2,R2,k2,Ct.normal),Et.face=Ct,Et.faceIndex=gt}return Et}(i,c.attributes.position,c.attributes.uv,g,$,nt,e);return rt?(rt.faceIndex=s,a&&a.push(rt),rt):null}function yO(c,e,i){return c===null?null:(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(i.ray.origin),c.object=e,c.distance<i.near||c.distance>i.far?null:c)}function wy(c,e,i,s){const a=c.a,h=c.b,g=c.c;let $=e,nt=e+1,rt=e+2;i&&($=i.getX(e),nt=i.getX(e+1),rt=i.getX(e+2)),a.x=s.getX($),a.y=s.getY($),a.z=s.getZ($),h.x=s.getX(nt),h.y=s.getY(nt),h.z=s.getZ(nt),g.x=s.getX(rt),g.y=s.getY(rt),g.z=s.getZ(rt)}function AO(c,e,i,s,a,h,g){const $=i.index,nt=i.attributes.position;for(let rt=c,st=e+c;rt<st;rt++)if(wy(g,3*rt,$,nt),g.needsUpdate=!0,s(g,rt,a,h))return!0;return!1}class wO{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Mw(c,e){return e[c+15]===65535}function _S(c,e){return e[c+6]}function xM(c,e){return e[c+14]}function bM(c){return c+8}function EM(c,e){return e[c+6]}const yS=new d.ZzF,B2=new d.Pa4,jN=["x","y","z"];function QD(c,e,i,s,a){let h=2*c,g=AS,$=Tw,nt=Iw;if(Mw(h,$))(function(rt,st,ut,mt,gt,yt){for(let wt=mt,It=mt+gt;wt<It;wt++)_O(rt,st,ut,wt,yt)})(e,i,s,_S(c,nt),xM(h,$),a);else{const rt=bM(c);O2(rt,g,s,B2)&&QD(rt,e,i,s,a);const st=EM(c,nt);O2(st,g,s,B2)&&QD(st,e,i,s,a)}}function GD(c,e,i,s){let a=2*c,h=AS,g=Tw,$=Iw;if(Mw(a,g))return function(nt,rt,st,ut,mt){let gt=1/0,yt=null;for(let wt=ut,It=ut+mt;wt<It;wt++){const Et=_O(nt,rt,st,wt);Et&&Et.distance<gt&&(yt=Et,gt=Et.distance)}return yt}(e,i,s,_S(c,$),xM(a,g));{const nt=function(wt,It){return It[wt+7]}(c,$),rt=jN[nt],st=s.direction[rt]>=0;let ut,mt;st?(ut=bM(c),mt=EM(c,$)):(ut=EM(c,$),mt=bM(c));const gt=O2(ut,h,s,B2)?GD(ut,e,i,s):null;if(gt){const wt=gt.point[rt];if(st?wt<=h[mt+nt]:wt>=h[mt+nt+3])return gt}const yt=O2(mt,h,s,B2)?GD(mt,e,i,s):null;return gt&&yt?gt.distance<=yt.distance?gt:yt:gt||yt||null}}const zN=function(){let c,e;const i=[],s=new wO(()=>new d.ZzF);return function(...h){c=s.getPrimitive(),e=s.getPrimitive(),i.push(c,e);const g=a(...h);s.releasePrimitive(c),s.releasePrimitive(e),i.pop(),i.pop();const $=i.length;return $>0&&(e=i[$-1],c=i[$-2]),g};function a(h,g,$,nt,rt=null,st=0,ut=0){function mt(Ct){let xt=2*Ct,Bt=Tw,Lt=Iw;for(;!Mw(xt,Bt);)xt=2*(Ct=bM(Ct));return _S(Ct,Lt)}function gt(Ct){let xt=2*Ct,Bt=Tw,Lt=Iw;for(;!Mw(xt,Bt);)xt=2*(Ct=EM(Ct,Lt));return _S(Ct,Lt)+xM(xt,Bt)}let yt=2*h,wt=AS,It=Tw,Et=Iw;if(Mw(yt,It)){const Ct=_S(h,Et),xt=xM(yt,It);return yy(h,wt,c),nt(Ct,xt,!1,ut,st+h,c)}{const Ct=bM(h),xt=EM(h,Et);let Bt,Lt,Gt,Xt,rn=Ct,fn=xt;if(rt&&(Gt=c,Xt=e,yy(rn,wt,Gt),yy(fn,wt,Xt),Bt=rt(Gt),Lt=rt(Xt),Lt<Bt)){rn=xt,fn=Ct;const En=Bt;Bt=Lt,Lt=En,Gt=Xt}Gt||(Gt=c,yy(rn,wt,Gt));const wn=$(Gt,Mw(2*rn,It),Bt,ut+1,st+rn);let Cn;if(wn===2){const En=mt(rn);Cn=nt(En,gt(rn)-En,!0,ut+1,st+rn,Gt)}else Cn=wn&&a(rn,g,$,nt,rt,st,ut+1);if(Cn)return!0;Xt=e,yy(fn,wt,Xt);const bn=$(Xt,Mw(2*fn,It),Lt,ut+1,st+fn);let Dn;if(bn===2){const En=mt(fn);Dn=nt(En,gt(fn)-En,!0,ut+1,st+fn,Xt)}else Dn=bn&&a(fn,g,$,nt,rt,st,ut+1);return!!Dn}}}(),VN=function(){const c=new vy,e=new vy,i=new d.yGw,s=new Ay,a=new Ay;return function h(g,$,nt,rt,st=null){let ut=2*g,mt=AS,gt=Tw,yt=Iw;if(st===null&&(nt.boundingBox||nt.computeBoundingBox(),s.set(nt.boundingBox.min,nt.boundingBox.max,rt),st=s),!Mw(ut,gt)){const wt=g+8,It=yt[g+6];return yy(wt,mt,yS),st.intersectsBox(yS)&&h(wt,$,nt,rt,st)?!0:(yy(It,mt,yS),!(!st.intersectsBox(yS)||!h(It,$,nt,rt,st)))}{const wt=$,It=wt.index,Et=wt.attributes.position,Ct=nt.index,xt=nt.attributes.position,Bt=_S(g,yt),Lt=xM(ut,gt);if(i.copy(rt).invert(),nt.boundsTree)return yy(g,mt,a),a.matrix.copy(i),a.needsUpdate=!0,nt.boundsTree.shapecast({intersectsBounds:Xt=>a.intersectsBox(Xt),intersectsTriangle:Xt=>{Xt.a.applyMatrix4(rt),Xt.b.applyMatrix4(rt),Xt.c.applyMatrix4(rt),Xt.needsUpdate=!0;for(let rn=3*Bt,fn=3*(Lt+Bt);rn<fn;rn+=3)if(wy(e,rn,It,Et),e.needsUpdate=!0,Xt.intersectsTriangle(e))return!0;return!1}});for(let Gt=3*Bt,Xt=Lt+3*Bt;Gt<Xt;Gt+=3){wy(c,Gt,It,Et),c.a.applyMatrix4(i),c.b.applyMatrix4(i),c.c.applyMatrix4(i),c.needsUpdate=!0;for(let rn=0,fn=Ct.count;rn<fn;rn+=3)if(wy(e,rn,Ct,xt),e.needsUpdate=!0,c.intersectsTriangle(e))return!0}}}}();function O2(c,e,i,s){return yy(c,e,yS),i.intersectBox(yS,s)}const HD=[];let L2,AS,Tw,Iw;function SM(c){L2&&HD.push(L2),L2=c,AS=new Float32Array(c),Tw=new Uint16Array(c),Iw=new Uint32Array(c)}function N2(){L2=null,AS=null,Tw=null,Iw=null,HD.length&&SM(HD.pop())}const WD=Symbol("skip tree generation"),qD=new d.ZzF,YD=new d.ZzF,wS=new d.yGw,f1=new Ay,CM=new Ay,MM=new d.Pa4,F2=new d.Pa4,QN=new d.Pa4,GN=new d.Pa4,HN=new d.Pa4,xO=new d.ZzF,xy=new wO(()=>new vy);class Gp{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Gp.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,a=e._roots,h=s.getIndex();let g;return g=i.cloneBuffers?{roots:a.map($=>$.slice()),index:h.array.slice()}:{roots:a,index:h.array},g}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Gp.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:a,roots:h}=e,g=new Gp(i,{...s,[WD]:!0});if(g._roots=h,s.setIndex){const $=i.getIndex();if($===null){const nt=new d.TlE(e.index,1,!1);i.setIndex(nt)}else $.array!==a&&($.array.set(a),$.needsUpdate=!0)}return g}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[WD]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[WD]||(this._roots=function(s,a){const h=function(gt,yt){function wt(En){fn&&fn(En/wn)}function It(En,Tn,Un,Pn=null,Yn=0){if(!Cn&&Yn>=Lt&&(Cn=!0,Gt&&(console.warn(`MeshBVH: Max depth of ${Lt} reached when generating BVH. Consider increasing maxDepth.`),console.warn(gt))),Un<=Xt||Yn>=Lt)return wt(Tn+Un),En.offset=Tn,En.count=Un,En;const cr=function(ir,Dr,Nr,Fr,Vr,ps){let yr=-1,Ws=0;if(ps===0)yr=hO(Dr),yr!==-1&&(Ws=(Dr[yr]+Dr[yr+3])/2);else if(ps===1)yr=hO(ir),yr!==-1&&(Ws=function(lo,qs,Bo,xa){let dr=0;for(let jr=qs,zr=qs+Bo;jr<zr;jr++)dr+=lo[6*jr+2*xa];return dr/Bo}(Nr,Fr,Vr,yr));else if(ps===2){const lo=wM(ir);let qs=jD*Vr;const Bo=6*Fr,xa=6*(Fr+Vr);for(let dr=0;dr<3;dr++){const jr=Dr[dr],zr=(Dr[dr+3]-jr)/32;if(Vr<8){const Ys=[...Cw];Ys.length=Vr;let Jo=0;for(let Fn=Bo;Fn<xa;Fn+=6,Jo++){const yn=Ys[Jo];yn.candidate=Nr[Fn+2*dr],yn.count=0;const{bounds:Hn,leftCacheBounds:nr,rightCacheBounds:Gn}=yn;for(let hr=0;hr<3;hr++)Gn[hr]=1/0,Gn[hr+3]=-1/0,nr[hr]=1/0,nr[hr+3]=-1/0,Hn[hr]=1/0,Hn[hr+3]=-1/0;I2(Fn,Nr,Hn)}Ys.sort(UN);let vn=Vr;for(let Fn=0;Fn<vn;Fn++){const yn=Ys[Fn];for(;Fn+1<vn&&Ys[Fn+1].candidate===yn.candidate;)Ys.splice(Fn+1,1),vn--}for(let Fn=Bo;Fn<xa;Fn+=6){const yn=Nr[Fn+2*dr];for(let Hn=0;Hn<vn;Hn++){const nr=Ys[Hn];yn>=nr.candidate?I2(Fn,Nr,nr.rightCacheBounds):(I2(Fn,Nr,nr.leftCacheBounds),nr.count++)}}for(let Fn=0;Fn<vn;Fn++){const yn=Ys[Fn],Hn=yn.count,nr=Vr-yn.count,Gn=yn.leftCacheBounds,hr=yn.rightCacheBounds;let Hr=0;Hn!==0&&(Hr=wM(Gn)/lo);let ts=0;nr!==0&&(ts=wM(hr)/lo);const us=1+jD*(Hr*Hn+ts*nr);us<qs&&(yr=dr,qs=us,Ws=yn.candidate)}}else{for(let vn=0;vn<32;vn++){const Fn=Cw[vn];Fn.count=0,Fn.candidate=jr+zr+vn*zr;const yn=Fn.bounds;for(let Hn=0;Hn<3;Hn++)yn[Hn]=1/0,yn[Hn+3]=-1/0}for(let vn=Bo;vn<xa;vn+=6){let Fn=~~((Nr[vn+2*dr]-jr)/zr);Fn>=32&&(Fn=31);const yn=Cw[Fn];yn.count++,I2(vn,Nr,yn.bounds)}const Ys=Cw[31];dO(Ys.bounds,Ys.rightCacheBounds);for(let vn=30;vn>=0;vn--){const Fn=Cw[vn],yn=Cw[vn+1];pO(Fn.bounds,yn.rightCacheBounds,Fn.rightCacheBounds)}let Jo=0;for(let vn=0;vn<31;vn++){const Fn=Cw[vn],yn=Fn.count,Hn=Fn.bounds,nr=Cw[vn+1].rightCacheBounds;yn!==0&&(Jo===0?dO(Hn,P2):pO(Hn,P2,P2)),Jo+=yn;let Gn=0,hr=0;Jo!==0&&(Gn=wM(P2)/lo);const Hr=Vr-Jo;Hr!==0&&(hr=wM(nr)/lo);const ts=1+jD*(Gn*Jo+hr*Hr);ts<qs&&(yr=dr,qs=ts,Ws=Fn.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${ps} used.`);return{axis:yr,pos:Ws}}(En.boundingData,Pn,xt,Tn,Un,rn);if(cr.axis===-1)return wt(Tn+Un),En.offset=Tn,En.count=Un,En;const mr=function(ir,Dr,Nr,Fr,Vr){let ps=Nr,yr=Nr+Fr-1;const Ws=Vr.pos,lo=2*Vr.axis;for(;;){for(;ps<=yr&&Dr[6*ps+lo]<Ws;)ps++;for(;ps<=yr&&Dr[6*yr+lo]>=Ws;)yr--;if(!(ps<yr))return ps;for(let qs=0;qs<3;qs++){let Bo=ir[3*ps+qs];ir[3*ps+qs]=ir[3*yr+qs],ir[3*yr+qs]=Bo;let xa=Dr[6*ps+2*qs+0];Dr[6*ps+2*qs+0]=Dr[6*yr+2*qs+0],Dr[6*yr+2*qs+0]=xa;let dr=Dr[6*ps+2*qs+1];Dr[6*ps+2*qs+1]=Dr[6*yr+2*qs+1],Dr[6*yr+2*qs+1]=dr}ps++,yr--}}(Bt,xt,Tn,Un,cr);if(mr===Tn||mr===Tn+Un)wt(Tn+Un),En.offset=Tn,En.count=Un;else{En.splitAxis=cr.axis;const ir=new T2,Dr=Tn,Nr=mr-Tn;En.left=ir,ir.boundingData=new Float32Array(6),VD(xt,Dr,Nr,ir.boundingData,Ct),It(ir,Dr,Nr,Ct,Yn+1);const Fr=new T2,Vr=mr,ps=Un-Nr;En.right=Fr,Fr.boundingData=new Float32Array(6),VD(xt,Vr,ps,Fr.boundingData,Ct),It(Fr,Vr,ps,Ct,Yn+1)}return En}(function(En,Tn){if(!En.index){const Un=En.attributes.position.count,Pn=Tn.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Yn;Yn=Un>65535?new Uint32Array(new Pn(4*Un)):new Uint16Array(new Pn(2*Un)),En.setIndex(new d.TlE(Yn,1));for(let cr=0;cr<Un;cr++)Yn[cr]=cr}})(gt,yt);const Et=new Float32Array(6),Ct=new Float32Array(6),xt=function(En,Tn){const Un=En.attributes.position,Pn=Un.array,Yn=En.index.array,cr=Yn.length/3,mr=new Float32Array(6*cr),ir=Un.offset||0;let Dr=3;Un.isInterleavedBufferAttribute&&(Dr=Un.data.stride);for(let Nr=0;Nr<cr;Nr++){const Fr=3*Nr,Vr=6*Nr,ps=Yn[Fr+0]*Dr+ir,yr=Yn[Fr+1]*Dr+ir,Ws=Yn[Fr+2]*Dr+ir;for(let lo=0;lo<3;lo++){const qs=Pn[ps+lo],Bo=Pn[yr+lo],xa=Pn[Ws+lo];let dr=qs;Bo<dr&&(dr=Bo),xa<dr&&(dr=xa);let jr=qs;Bo>jr&&(jr=Bo),xa>jr&&(jr=xa);const zr=(jr-dr)/2,Ys=2*lo;mr[Vr+Ys+0]=dr+zr,mr[Vr+Ys+1]=zr+(Math.abs(dr)+zr)*FN,dr<Tn[lo]&&(Tn[lo]=dr),jr>Tn[lo+3]&&(Tn[lo+3]=jr)}}return mr}(gt,Et),Bt=gt.index.array,Lt=yt.maxDepth,Gt=yt.verbose,Xt=yt.maxLeafTris,rn=yt.strategy,fn=yt.onProgress,wn=gt.index.count/3;let Cn=!1;const bn=[],Dn=function(En){if(!En.groups||!En.groups.length)return[{offset:0,count:En.index.count/3}];const Tn=[],Un=new Set;for(const Yn of En.groups)Un.add(Yn.start),Un.add(Yn.start+Yn.count);const Pn=Array.from(Un.values()).sort((Yn,cr)=>Yn-cr);for(let Yn=0;Yn<Pn.length-1;Yn++){const cr=Pn[Yn],mr=Pn[Yn+1];Tn.push({offset:cr/3,count:(mr-cr)/3})}return Tn}(gt);if(Dn.length===1){const En=Dn[0],Tn=new T2;Tn.boundingData=Et,function(Un,Pn,Yn,cr){let mr=1/0,ir=1/0,Dr=1/0,Nr=-1/0,Fr=-1/0,Vr=-1/0;for(let ps=6*Pn,yr=6*(Pn+Yn);ps<yr;ps+=6){const Ws=Un[ps+0];Ws<mr&&(mr=Ws),Ws>Nr&&(Nr=Ws);const lo=Un[ps+2];lo<ir&&(ir=lo),lo>Fr&&(Fr=lo);const qs=Un[ps+4];qs<Dr&&(Dr=qs),qs>Vr&&(Vr=qs)}cr[0]=mr,cr[1]=ir,cr[2]=Dr,cr[3]=Nr,cr[4]=Fr,cr[5]=Vr}(xt,En.offset,En.count,Ct),It(Tn,En.offset,En.count,Ct),bn.push(Tn)}else for(let En of Dn){const Tn=new T2;Tn.boundingData=new Float32Array(6),VD(xt,En.offset,En.count,Tn.boundingData,Ct),It(Tn,En.offset,En.count,Ct),bn.push(Tn)}return bn}(s,a);let g,$,nt;const rt=[],st=a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let gt=0;gt<h.length;gt++){const yt=h[gt],wt=new st(32*ut(yt));g=new Float32Array(wt),$=new Uint32Array(wt),nt=new Uint16Array(wt),mt(0,yt),rt.push(wt)}return rt;function ut(gt){return gt.count?1:1+ut(gt.left)+ut(gt.right)}function mt(gt,yt){const wt=gt/4,It=gt/2,Et=!!yt.count,Ct=yt.boundingData;for(let xt=0;xt<6;xt++)g[wt+xt]=Ct[xt];if(Et){const xt=yt.offset,Bt=yt.count;return $[wt+6]=xt,nt[It+14]=Bt,nt[It+15]=zD,gt+32}{const xt=yt.left,Bt=yt.right,Lt=yt.splitAxis;let Gt;if(Gt=mt(gt+32,xt),Gt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return $[wt+6]=Gt/4,Gt=mt(Gt,Bt),$[wt+7]=Lt,Gt}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new d.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,a=i.attributes.position,h=a.array,g=a.offset||0;let $,nt,rt,st,ut=3;a.isInterleavedBufferAttribute&&(ut=a.data.stride);let mt=0;const gt=this._roots;for(let wt=0,It=gt.length;wt<It;wt++)$=gt[wt],nt=new Uint32Array($),rt=new Uint16Array($),st=new Float32Array($),yt(0,mt),mt+=$.byteLength;function yt(wt,It,Et=!1){const Ct=2*wt;if(rt[Ct+15]===zD){const xt=nt[wt+6];let Bt=1/0,Lt=1/0,Gt=1/0,Xt=-1/0,rn=-1/0,fn=-1/0;for(let wn=3*xt,Cn=3*(xt+rt[Ct+14]);wn<Cn;wn++){const bn=s[wn]*ut+g,Dn=h[bn+0],En=h[bn+1],Tn=h[bn+2];Dn<Bt&&(Bt=Dn),Dn>Xt&&(Xt=Dn),En<Lt&&(Lt=En),En>rn&&(rn=En),Tn<Gt&&(Gt=Tn),Tn>fn&&(fn=Tn)}return(st[wt+0]!==Bt||st[wt+1]!==Lt||st[wt+2]!==Gt||st[wt+3]!==Xt||st[wt+4]!==rn||st[wt+5]!==fn)&&(st[wt+0]=Bt,st[wt+1]=Lt,st[wt+2]=Gt,st[wt+3]=Xt,st[wt+4]=rn,st[wt+5]=fn,!0)}{const xt=wt+8,Bt=nt[wt+6],Lt=xt+It,Gt=Bt+It;let Xt=Et,rn=!1,fn=!1;e?Xt||(rn=e.has(Lt),fn=e.has(Gt),Xt=!rn&&!fn):(rn=!0,fn=!0);const wn=Xt||fn;let Cn=!1;(Xt||rn)&&(Cn=yt(xt,It,Xt));let bn=!1;wn&&(bn=yt(Bt,It,Xt));const Dn=Cn||bn;if(Dn)for(let En=0;En<3;En++){const Tn=xt+En,Un=Bt+En,Pn=st[Tn],Yn=st[Tn+3],cr=st[Un],mr=st[Un+3];st[wt+En]=Pn<cr?Pn:cr,st[wt+En+3]=Yn>mr?Yn:mr}return Dn}}}traverse(e,i=0){const s=this._roots[i],a=new Uint32Array(s),h=new Uint16Array(s);(function g($,nt=0){const rt=2*$,st=h[rt+15]===zD;if(st){const ut=a[$+6],mt=h[rt+14];e(nt,st,new Float32Array(s,4*$,6),ut,mt)}else{const ut=$+8,mt=a[$+6],gt=a[$+7];e(nt,st,new Float32Array(s,4*$,6),gt)||(g(ut,nt+1),g(mt,nt+1))}})(0)}raycast(e,i=d.Wl3){const s=this._roots,a=this.geometry,h=[],g=i.isMaterial,$=Array.isArray(i),nt=a.groups,rt=g?i.side:i;for(let st=0,ut=s.length;st<ut;st++){const mt=$?i[nt[st].materialIndex].side:rt,gt=h.length;if(SM(s[st]),QD(0,a,mt,e,h),N2(),$){const yt=nt[st].materialIndex;for(let wt=gt,It=h.length;wt<It;wt++)h[wt].face.materialIndex=yt}}return h}raycastFirst(e,i=d.Wl3){const s=this._roots,a=this.geometry,h=i.isMaterial,g=Array.isArray(i);let $=null;const nt=a.groups,rt=h?i.side:i;for(let st=0,ut=s.length;st<ut;st++){const mt=g?i[nt[st].materialIndex].side:rt;SM(s[st]);const gt=GD(0,a,mt,e);N2(),gt!=null&&($==null||gt.distance<$.distance)&&($=gt,g&&(gt.face.materialIndex=nt[st].materialIndex))}return $}intersectsGeometry(e,i){const s=this.geometry;let a=!1;for(const h of this._roots)if(SM(h),a=VN(0,s,e,i),N2(),a)break;return a}shapecast(e,i,s){const a=this.geometry;if(e instanceof Function){if(i){const mt=i;i=(gt,yt,wt,It)=>{const Et=3*yt;return mt(gt,Et,Et+1,Et+2,wt,It)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const h=xy.getPrimitive();let{boundsTraverseOrder:g,intersectsBounds:$,intersectsRange:nt,intersectsTriangle:rt}=e;if(nt&&rt){const mt=nt;nt=(gt,yt,wt,It,Et)=>!!mt(gt,yt,wt,It,Et)||AO(gt,yt,a,rt,wt,It,h)}else nt||(nt=rt?(mt,gt,yt,wt)=>AO(mt,gt,a,rt,yt,wt,h):(mt,gt,yt)=>yt);let st=!1,ut=0;for(const mt of this._roots){if(SM(mt),st=zN(0,a,$,nt,g,ut),N2(),st)break;ut+=mt.byteLength}return xy.releasePrimitive(h),st}bvhcast(e,i,s){let{intersectsRanges:a,intersectsTriangles:h}=s;const g=this.geometry.index,$=this.geometry.attributes.position,nt=e.geometry.index,rt=e.geometry.attributes.position;wS.copy(i).invert();const st=xy.getPrimitive(),ut=xy.getPrimitive();if(h){let yt=function(wt,It,Et,Ct,xt,Bt,Lt,Gt){for(let Xt=Et,rn=Et+Ct;Xt<rn;Xt++){wy(ut,3*Xt,nt,rt),ut.a.applyMatrix4(i),ut.b.applyMatrix4(i),ut.c.applyMatrix4(i),ut.needsUpdate=!0;for(let fn=wt,wn=wt+It;fn<wn;fn++)if(wy(st,3*fn,g,$),st.needsUpdate=!0,h(st,ut,fn,Xt,xt,Bt,Lt,Gt))return!0}return!1};var gt=yt;if(a){const wt=a;a=function(It,Et,Ct,xt,Bt,Lt,Gt,Xt){return!!wt(It,Et,Ct,xt,Bt,Lt,Gt,Xt)||yt(It,Et,Ct,xt,Bt,Lt,Gt,Xt)}}else a=yt}e.getBoundingBox(YD),YD.applyMatrix4(i);const mt=this.shapecast({intersectsBounds:yt=>YD.intersectsBox(yt),intersectsRange:(yt,wt,It,Et,Ct,xt)=>(qD.copy(xt),qD.applyMatrix4(wS),e.shapecast({intersectsBounds:Bt=>qD.intersectsBox(Bt),intersectsRange:(Bt,Lt,Gt,Xt,rn)=>a(yt,wt,Bt,Lt,Et,Ct,Xt,rn)}))});return xy.releasePrimitive(st),xy.releasePrimitive(ut),mt}intersectsBox(e,i){return f1.set(e.min,e.max,i),f1.needsUpdate=!0,this.shapecast({intersectsBounds:s=>f1.intersectsBox(s),intersectsTriangle:s=>f1.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},a={},h=0,g=1/0){e.boundingBox||e.computeBoundingBox(),f1.set(e.boundingBox.min,e.boundingBox.max,i),f1.needsUpdate=!0;const $=this.geometry,nt=$.attributes.position,rt=$.index,st=e.attributes.position,ut=e.index,mt=xy.getPrimitive(),gt=xy.getPrimitive();let yt=F2,wt=QN,It=null,Et=null;a&&(It=GN,Et=HN);let Ct=1/0,xt=null,Bt=null;return wS.copy(i).invert(),CM.matrix.copy(wS),this.shapecast({boundsTraverseOrder:Lt=>f1.distanceToBox(Lt),intersectsBounds:(Lt,Gt,Xt)=>Xt<Ct&&Xt<g&&(Gt&&(CM.min.copy(Lt.min),CM.max.copy(Lt.max),CM.needsUpdate=!0),!0),intersectsRange:(Lt,Gt)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Xt=>CM.distanceToBox(Xt),intersectsBounds:(Xt,rn,fn)=>fn<Ct&&fn<g,intersectsRange:(Xt,rn)=>{for(let fn=3*Xt,wn=3*(Xt+rn);fn<wn;fn+=3){wy(gt,fn,ut,st),gt.a.applyMatrix4(i),gt.b.applyMatrix4(i),gt.c.applyMatrix4(i),gt.needsUpdate=!0;for(let Cn=3*Lt,bn=3*(Lt+Gt);Cn<bn;Cn+=3){wy(mt,Cn,rt,nt),mt.needsUpdate=!0;const Dn=mt.distanceToTriangle(gt,yt,It);if(Dn<Ct&&(wt.copy(yt),Et&&Et.copy(It),Ct=Dn,xt=Cn/3,Bt=fn/3),Dn<h)return!0}}}});for(let Xt=0,rn=ut?ut.count:st.count;Xt<rn;Xt+=3){wy(gt,Xt,ut,st),gt.a.applyMatrix4(i),gt.b.applyMatrix4(i),gt.c.applyMatrix4(i),gt.needsUpdate=!0;for(let fn=3*Lt,wn=3*(Lt+Gt);fn<wn;fn+=3){wy(mt,fn,rt,nt),mt.needsUpdate=!0;const Cn=mt.distanceToTriangle(gt,yt,It);if(Cn<Ct&&(wt.copy(yt),Et&&Et.copy(It),Ct=Cn,xt=fn/3,Bt=Xt/3),Cn<h)return!0}}}}),xy.releasePrimitive(mt),xy.releasePrimitive(gt),Ct===1/0?null:(s.point?s.point.copy(wt):s.point=wt.clone(),s.distance=Ct,s.faceIndex=xt,a&&(a.point?a.point.copy(Et):a.point=Et.clone(),a.point.applyMatrix4(wS),wt.applyMatrix4(wS),a.distance=wt.sub(a.point).length(),a.faceIndex=Bt),s)}closestPointToPoint(e,i={},s=0,a=1/0){const h=s*s,g=a*a;let $=1/0,nt=null;if(this.shapecast({boundsTraverseOrder:st=>(MM.copy(e).clamp(st.min,st.max),MM.distanceToSquared(e)),intersectsBounds:(st,ut,mt)=>mt<$&&mt<g,intersectsTriangle:(st,ut)=>{st.closestPointToPoint(e,MM);const mt=e.distanceToSquared(MM);return mt<$&&(F2.copy(MM),$=mt,nt=ut),mt<h}}),$===1/0)return null;const rt=Math.sqrt($);return i.point?i.point.copy(F2):i.point=F2.clone(),i.distance=rt,i.faceIndex=nt,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{yy(0,new Float32Array(i),xO),e.union(xO)}),e}}const bO=Gp.prototype.raycast;Gp.prototype.raycast=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,i,s,a]=c;return bO.call(this,s,e.material).forEach(h=>{(h=yO(h,e,i))&&a.push(h)}),a}return bO.apply(this,c)};const EO=Gp.prototype.raycastFirst;Gp.prototype.raycastFirst=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,i,s]=c;return yO(EO.call(this,s,e.material),e,i)}return EO.apply(this,c)};const SO=Gp.prototype.closestPointToPoint;Gp.prototype.closestPointToPoint=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),c.unshift();const e=c[1],i={};return c[1]=i,SO.apply(this,c),e&&e.copy(i.point),i.distance}return SO.apply(this,c)};const CO=Gp.prototype.closestPointToGeometry;Gp.prototype.closestPointToGeometry=function(...c){const e=c[2],i=c[3];if(e&&e.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const s={},a={},h=c[1];return c[2]=s,c[3]=a,CO.apply(this,c),e&&e.copy(s.point),i&&i.copy(a.point).applyMatrix4(h),s.distance}return CO.apply(this,c)};const MO=Gp.prototype.refit;Gp.prototype.refit=function(...c){const e=c[0],i=c[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const s=new Set;i.forEach(a=>s.add(a)),e&&e.forEach(a=>s.add(a)),MO.call(this,s)}else MO.apply(this,c)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(c=>{const e=Gp.prototype[c];Gp.prototype[c]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${c}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,i)}});const XD=[new d.Pa4,new d.Pa4,new d.Pa4];function KD(c){return~~(1e4*c)}function TO(c){return`${KD(c.x)},${KD(c.y)},${KD(c.z)}`}class WN{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,a=e.index,h=s.position;let g=a?a.count/3:h.count/3;const $=g;let nt=0;this.useDrawRange&&(nt=e.drawRange.start,e.drawRange.count!==1/0&&(g=~~(e.drawRange.count/3)));let rt=this.data;(!rt||rt.length<3*$)&&(rt=new Int32Array(3*$)),rt.fill(-1);let st=0,ut=0;for(let mt=0;mt<g;mt++){const gt=3*mt+nt;for(let yt=0;yt<3;yt++){let wt=gt+yt;a&&(wt=a.getX(wt)),XD[yt].fromBufferAttribute(h,wt)}for(let yt=0;yt<3;yt++){const wt=(yt+1)%3,It=XD[yt],Et=XD[wt],Ct=TO(It),xt=TO(Et),Bt=`${xt}_${Ct}`;if(i.has(Bt)){const Lt=i.get(Bt);rt[gt+yt]=Lt,rt[Lt]=gt+yt,i.delete(Bt),st--,ut++}else{const Lt=`${Ct}_${xt}`;i.set(Lt,gt+yt),st++}}}this.matchedEdges=ut,this.unmatchedEdges=st,this.data=rt}}class U2 extends d.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new d.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,a=i.elements;for(let h=0;h<16;h++)if(s[h]!==a[h])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(oO())for(const s in i){const a=i[s];if(a.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");a.array=kN(a.array)}if(e.boundsTree||(e.boundsTree=new Gp(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new WN(e)),!e.groupIndices){const s=e.index.count/3,a=new Uint16Array(s),h=e.groups;for(let g=0,$=h.length;g<$;g++){const{start:nt,count:rt}=h[g];for(let st=nt/3,ut=(nt+rt)/3;st<ut;st++)a[st]=g}e.groupIndices=a}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function IO(c,e){let i=e;return Array.isArray(e)||(i=[],c.forEach(s=>{i[s.materialIndex]=e})),i}class qN{constructor(){this.triangleSplitter=new RN,this.attributeData=new BN,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new LN}evaluate(e,i,s,a=new U2){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:h,attributeData:g,attributes:$,useGroups:nt,debug:rt}=this,st=a.geometry,ut=e.geometry.attributes;for(let Et=0,Ct=$.length;Et<Ct;Et++){const xt=$[Et],Bt=ut[xt];g.initializeArray(xt,Bt.array.constructor)}for(const Et in g.attributes)$.includes(Et)||g.delete(Et);for(const Et in st.attributes)$.includes(Et)||(st.deleteAttribute(Et),st.dispose());g.clear(),rt.enabled&&(rt.reset(),eO(rt)),function(Et,Ct,xt,Bt,Lt,Gt){const{useGroups:Xt=!0}=Gt,{aIntersections:rn,bIntersections:fn}=function(Cn,bn){const Dn=new X3,En=new X3;return K3.copy(Cn.matrixWorld).invert().multiply(bn.matrixWorld),Cn.geometry.boundsTree.bvhcast(bn.geometry.boundsTree,K3,{intersectsTriangles:(Tn,Un,Pn,Yn)=>(Tn.intersectsTriangle(Un,LD)&&LD.distance()>1e-5&&(Dn.add(Pn,Yn),En.add(Yn,Pn),E2&&(E2.addEdge(LD),E2.addIntersectingTriangles(Pn,Tn,Yn,Un))),!1)}),{aIntersections:Dn,bIntersections:En}}(Et,Ct);let wn;wn=Xt?0:-1,uO(Et,Ct,rn,xt,!1,Lt,wn),cO(Et,Ct,rn,xt,!1,Bt,Lt,wn),wn=Xt?Et.geometry.groups.length||1:-1,uO(Ct,Et,fn,xt,!0,Lt,wn),cO(Ct,Et,fn,xt,!0,Bt,Lt,wn)}(e,i,s,h,g,{useGroups:nt}),rt.enabled&&eO(null);const mt=nt&&e.geometry.groups.length!==0?e.geometry.groups.map(Et=>({...Et})):[{start:0,count:1/0,materialIndex:0}],gt=nt&&i.geometry.groups.length!==0?i.geometry.groups.map(Et=>({...Et})):[{start:0,count:1/0,materialIndex:0}],yt=IO(mt,e.material),wt=IO(gt,i.material);gt.forEach(Et=>{Et.materialIndex+=yt.length}),function(Et,Ct,xt,Bt){let Lt=!1,Gt=-1;const Xt=Bt.groupCount,rn=Et.attributes,fn=Bt.groupAttributes[0];for(const Cn in fn){const bn=Bt.getTotalLength(Cn,Xt),Dn=fn[Cn].type;let En=rn[Cn];if(!En||En.array.length<bn){const Un=Ct.attributes[Cn];En=new d.TlE(new Dn(bn),Un.itemSize,Un.normalized),Et.setAttribute(Cn,En),Lt=!0}let Tn=0;for(let Un=0;Un<Xt;Un++){const{array:Pn,type:Yn,length:cr}=Bt.groupAttributes[Un][Cn],mr=new Yn(Pn.buffer,0,cr);En.array.set(mr,Tn),Tn+=mr.length}En.needsUpdate=!0,Gt=bn/En.itemSize}Et.setDrawRange(0,Gt),Et.clearGroups();let wn=0;for(let Cn=0;Cn<Xt;Cn++){const bn=Bt.getGroupArray("position",Cn).length/3;if(bn!==0){const Dn=xt[Cn];Et.addGroup(wn,bn,Dn.materialIndex),wn+=bn}}if(Et.index){const Cn=Et.index.array;if(Cn.length<Gt)Et.index=null,Lt=!0;else for(let bn=0,Dn=Cn.length;bn<Dn;bn++)Cn[bn]=bn}Et.boundsTree=null,Lt&&Et.dispose()}(st,e.geometry,[...mt,...gt],g);const It=st.groups;if(nt){const Et=new Map,Ct=[...yt,...wt];let xt=0;for(let Bt=0,Lt=Ct.length;Bt<Lt;Bt++)Boolean(It.find(Gt=>Gt.materialIndex===Bt))?(Et.set(Bt,xt),xt++):Ct[Bt]=null;for(let Bt=0,Lt=It.length;Bt<Lt;Bt++){const Gt=It[Bt];Gt.materialIndex=Et.get(Gt.materialIndex)}a.material=Ct.filter(Bt=>Bt)}return a}evaluateHierarchy(e,i=new U2){e.updateMatrixWorld(!0);const s=(h,g)=>{const $=h.children;for(let nt=0,rt=$.length;nt<rt;nt++){const st=$[nt];st.isOperationGroup?s(st,g):g(st)}},a=h=>{const g=h.children;let $=!1;for(let rt=0,st=g.length;rt<st;rt++){const ut=g[rt];$=a(ut)||$}const nt=h.isDirty();if(nt&&h.markUpdated(),$&&!h.isOperationGroup){let rt;return s(h,st=>{rt=rt?this.evaluate(rt,st,st.operation):this.evaluate(h,st,st.operation)}),h._cachedGeometry=rt.geometry,h._cachedMaterials=rt.material,!0}return $||nt};return a(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const PO={union:0,subtract:1,intersect:4,difference:3};function DO(c,e){const i=new qN;i.useGroups=!0,i.attributes=["position","normal","uv"],c.forEach(h=>{for(const g of[...i.attributes])h[0].geometry.getAttribute(g)||i.attributes.splice(i.attributes.indexOf(g),1)});let s=new U2(new d._12(.01,.01,2,2));c.forEach(([h,g])=>{if(!Object.keys(PO).includes(g))return void console.error(`Unknown operation ${g}`);h.updateMatrix(),h.updateMatrixWorld();const $=new U2;$.geometry=h.geometry,$.material=h.material,h.matrixWorld.decompose($.position,$.quaternion,$.scale),$.updateMatrix(),$.updateMatrixWorld(),s=i.evaluate(s,$,PO[g])});const a=s;return a.userData._isCSGMesh=!0,a}let j2=class extends lA{_buildCSGMesh(c){return DO(c)}};j2.PluginType="CSGPluginBVH",j2=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g}([ho("CSG Plugin (BVH)")],j2);var RO=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const YN=new d.Pa4(0,0,1),kO=new d.USm,XN=new d._fP,KN=new d._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),xS=new d._fP,$N={type:"change"};let TM=class extends _e{constructor(c){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new d._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new d._fP,this._initQuaternionInvert=new d._fP,this._initQuaternionDest=new d._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=c,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(c=>{c=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(c=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",c)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new d._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const c=this.deviceOrientation;if(c){const e=c.alpha!==null?d.M8C.degToRad(c.alpha):0,i=c.beta!==null?d.M8C.degToRad(c.beta):0,s=c.gamma!==null?d.M8C.degToRad(c.gamma):0,a=this.screenOrientation?d.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,a),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent($N))}}dispose(){this.disconnect()}setObjectQuaternion(c,e,i,s){const a=po()/1e3;kO.set(e,c,-i,"YXZ"),xS.setFromEuler(kO),xS.multiply(KN),xS.multiply(XN.setFromAxisAngle(YN,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(xS).invert(),this._initQuaternionDest.__init=!0),xS.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(xS,this.dampingFactor/(Math.min(1,a-this._lastTime)/(1/60))),this._lastTime=a}};RO([Qn(),ls("Damping",[0,1],.01)],TM.prototype,"dampingFactor",void 0),TM=RO([ho("Device Orientation Controls")],TM);class $D extends Ks{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,a,h;(s=(i=e.lastCamera)===null||i===void 0?void 0:i.removeControlsCtor)===null||s===void 0||s.call(i,this.controlsKey),(h=(a=e.camera)===null||a===void 0?void 0:a.setControlsCtor)===null||h===void 0||h.call(a,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}class JD extends $D{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new TM(e)}}JD.PluginType="DeviceOrientationControlsPlugin";var gm=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const BO=new d.Pa4,ZD=new d.$V,eR=new d.Pa4,JN={type:"change"};let mp=class extends _e{constructor(c,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new d.Pa4,this._lastTime=-1,this.object=c,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const c=this.object.quaternion;BO.set(0,0,-1).applyQuaternion(c),ZD.setFromVector3(BO),this.lat=90-d.M8C.radToDeg(ZD.phi),this.lon=d.M8C.radToDeg(ZD.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(c){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(c){if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(c,e,i){return c.isVector3?eR.copy(c):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):eR.set(c,e,i),this.object.lookAt(eR),this.setOrientation(),this}update(){const c=po(),e=(this._lastTime<0?16:Math.min(c-this._lastTime,1e3))/1e3;if(this._lastTime=c,!this.enabled)return;if(this.heightSpeed){const nt=d.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(nt*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*a),this.lat=Math.max(-85,Math.min(85,this.lat));let h=d.M8C.degToRad(90-this.lat);const g=d.M8C.degToRad(this.lon);this.constrainVertical&&(h=d.M8C.mapLinear(h,0,Math.PI,this.verticalMin,this.verticalMax));const $=this.object.position;this.targetPosition.setFromSphericalCoords(1,h,g).add($),this.object.lookAt(this.targetPosition),this.dispatchEvent(JN)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(c){this.enableKeys&&c.preventDefault()}};gm([Qn(),rs()],mp.prototype,"enabled",void 0),gm([Qn(),rs()],mp.prototype,"enableKeys",void 0),gm([Qn(),uo()],mp.prototype,"movementSpeed",void 0),gm([Qn(),uo()],mp.prototype,"lookSpeed",void 0),gm([Qn(),rs()],mp.prototype,"lookVertical",void 0),gm([Qn(),rs()],mp.prototype,"autoForward",void 0),gm([Qn(),rs()],mp.prototype,"activeLook",void 0),gm([Qn(),rs()],mp.prototype,"heightSpeed",void 0),gm([Qn(),uo()],mp.prototype,"heightCoef",void 0),gm([Qn(),uo()],mp.prototype,"heightMin",void 0),gm([Qn(),uo()],mp.prototype,"heightMax",void 0),gm([Qn(),rs()],mp.prototype,"constrainVertical",void 0),gm([Qn(),uo()],mp.prototype,"verticalMin",void 0),gm([Qn(),uo()],mp.prototype,"verticalMax",void 0),gm([Qn(),rs()],mp.prototype,"mouseDragOn",void 0),mp=gm([ho("First Person Controls")],mp);class tR extends $D{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new mp(e,i)}}tR.PluginType="FirstPersonControlsPlugin";var bS=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};const ES=new d.USm(0,0,0,"YXZ"),SS=new d.Pa4,ZN={type:"change"},eF={type:"lock"},tF={type:"unlock"},OO=Math.PI/2;let hA=class extends _e{constructor(c,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new d.Pa4(0,0,-1),this.domElement=e,this.object=c,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(c){this.isLocked||this.autoLockOnClick&&(c.preventDefault(),this.lock())}onMouseMove(c){this.isLocked&&(this._movementX+=c.movementX||c.mozMovementX||c.webkitMovementX||0,this._movementY+=c.movementY||c.mozMovementY||c.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(eF),this.isLocked=!0):(this.dispatchEvent(tF),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(c){return c.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(c){SS.setFromMatrixColumn(this.object.matrix,0),SS.crossVectors(this.object.up,SS),this.object.position.addScaledVector(SS,c)}moveRight(c){SS.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(SS,c)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){ES.setFromQuaternion(this.object.quaternion),ES.y-=.002*this._movementX*this.pointerSpeed,ES.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,ES.x=Math.max(OO-this.maxPolarAngle,Math.min(OO-this.minPolarAngle,ES.x)),this.object.quaternion.setFromEuler(ES),this.dispatchEvent(ZN)}};bS([rs(),Qn()],hA.prototype,"enabled",void 0),bS([uo(),Qn()],hA.prototype,"minPolarAngle",void 0),bS([uo(),Qn()],hA.prototype,"maxPolarAngle",void 0),bS([uo(),Qn()],hA.prototype,"pointerSpeed",void 0),bS([rs(),Qn()],hA.prototype,"autoLockOnClick",void 0),hA=bS([ho("Pointer Lock Controls")],hA);class nR extends $D{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new hA(e,i.ownerDocument?i:i.documentElement)}}nR.PluginType="PointerLockControlsPlugin";var nF=__webpackgi_require__(819);class A_{static _initialize(){this._inited=!0,Gv(Wt`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const a=Ml({id:"customContextMenu",addToBody:!1});a.style.top=s+"px",a.style.left=i+"px";for(const[h,g]of Object.entries(e)){const $=Ml({classList:["customContextMenuItems"],addToBody:!1,innerHTML:h});a.appendChild($),$.onclick=g}return this.Element=a,a}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}A_.Element=void 0,A_._inited=!1;var rF=__webpackgi_require__(665);const iF=(c,e,i)=>{var s,a,h;const g=c.controller_,$=(a=(s=g.parent)===null||s===void 0?void 0:s.children)===null||a===void 0?void 0:a.indexOf(g);return!(((rt,st)=>st.controller_.rackController.rack===rt.controller_.parent)(c,e)&&$===i||($!==void 0&&$>=0&&((h=g.parent)===null||h===void 0||h.remove(c)),e.add(c,i),0))},sF=(c,e,i,s)=>{var a,h,g,$,nt;let rt=e.uiRef;const st=rt==null?void 0:rt.expanded;if(rt||(rt=c.addFolder({title:""}),rt.on("fold",It=>{var Et,Ct,xt;let Bt=rt.expanded;sn(e,"expanded",Bt,!0),Bt=(Et=Ht(e.expanded))!==null&&Et!==void 0?Et:Bt,Bt!==rt.expanded&&(rt.expanded=Bt),(Ct=e.uiRefresh)===null||Ct===void 0||Ct.call(e,"postFrame",!0),Bt&&((xt=e.onExpand)===null||xt===void 0||xt.call(e,e))})),!rt)return rt;rt.expanded=(h=(a=Ht(e.expanded))!==null&&a!==void 0?a:st)!==null&&h!==void 0&&h;const ut=((g=e.children)!==null&&g!==void 0?g:[]).map(It=>It&&Ht(It)).flat(2).filter(It=>It);let mt=0;for(const It of ut){let Et=It.uiRef;Et&&Et.controller_.viewProps.get("disposed")&&(It.uiRef=void 0),Et=It.uiRef,Et||(i.appendUiObject({uiConfig:It},rt),Et=It.uiRef),Et&&iF(Et,rt,mt++)&&i.appendUiObject({uiConfig:It},rt)}let gt=rt.children;for(;gt.length>mt;){const It=gt[gt.length-1];rt.remove(It),gt=rt.children}rt.controller_.props.set("title",($=Ht(e.label))!==null&&$!==void 0?$:"");const yt=rt.controller_.view.containerElement,wt=Ht(e.domChildren,[]);if((wt==null?void 0:wt.length)!==void 0){const It=[];for(let Et=0;Et<yt.children.length;Et++){const Ct=yt.children[Et];!((nt=Ct.dataset)===null||nt===void 0)&&nt.tpCustomDOM&&It.push(Ct)}for(const Et of It)yt.removeChild(Et);for(const Et of wt)Et.parentElement!==yt&&(yt.appendChild(Et),Et.dataset.tpCustomDOM="true");rt.controller_.foldable.cleanUpTransition()}return rt},oF=(c,e,i,s)=>{var a,h;const[g,$]=(a=e.property)!==null&&a!==void 0?a:[void 0,void 0],nt=(h=Ht(e.label))!==null&&h!==void 0?h:$;let rt=e.uiRef;return rt||(rt=c.addButton({title:""}),rt.on("click",async()=>{var st;const ut=[];e.prompt&&ut.push(await i.prompt(...e.prompt));const mt=(st=g&&$?g[$]:void 0)!==null&&st!==void 0?st:e.value;if(typeof mt=="function"){const gt=()=>{i.removeEventListener("postFrame",gt),mt(...ut)};i.addEventListener("postFrame",gt)}else console.warn("Invalid action type for button")})),rt&&(rt.title=nt??"click me"),rt},aF=(c,e,i,s)=>{var a;const h=Object.fromEntries(((a=Ht(e.children))!==null&&a!==void 0?a:[]).map(g=>Ht(g)).flat(2).filter(g=>g).map(g=>{var $;const nt=Ht(g.label);return[nt,($=g.value)!==null&&$!==void 0?$:nt]}));return by(c,e,i,{options:h,...s??{}})},lF=(c,e,i,s)=>{var a,h;const g=Ht(e.bounds),$=((a=g==null?void 0:g.length)!==null&&a!==void 0?a:0)>=2?g[1]:1,nt=((h=g==null?void 0:g.length)!==null&&h!==void 0?h:0)>=1?g[0]:0,rt=e.stepSize||void 0;return by(c,e,i,{min:nt,max:$,step:rt,...s??{}})},z2=(c,e,i,s)=>{var a,h,g;const $=Ht(e.bounds);if(!$||$.length<1)return by(c,e,i,{...s??{}});const nt=((a=$.length)!==null&&a!==void 0?a:0)>=2?$[1]:1,rt=((h=$.length)!==null&&h!==void 0?h:0)>=1?$[0]:0,st={min:rt,max:nt,step:(g=e.stepSize)!==null&&g!==void 0?g:(nt-rt)/100},ut={x:st,y:st};e.type!=="vec3"&&e.type!=="vec4"||(ut.z=st),e.type==="vec4"&&(ut.w=st);const mt=e.property;if(e.value===void 0&&mt&&mt[0]&&typeof mt[0]=="object"&&mt[0][mt[1]]&&Array.isArray(mt[0][mt[1]])){const[gt,yt]=mt,wt=gt[yt],It=wt.length,Et=new(It===2?d.FM8:It===3?d.Pa4:d.Ltg)().fromArray(wt);e.value=Et,e.property=void 0,e.onChange=[()=>{gt[yt]=Et.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(Ct=>Ct),e.label===void 0&&(e.label=yt)}return by(c,e,i,{...ut,...s??{}})},cF=(c,e,i,s)=>{var a;const h=e.property;if(e.value===void 0&&h&&typeof h[0]=="object"&&(!((a=h[0][h[1]])===null||a===void 0)&&a.isColor)){const[g,$]=h,nt=new hs().set(g[$]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const rt=g[$];return rt?nt.set(rt).convertLinearToSRGB().getHex():0},set:rt=>{const st=g[$];nt.setHex(rt).convertSRGBToLinear(),st.isColor?st.copy(nt):typeof st=="number"?g[$]=nt.getHex():typeof st=="string"&&(g[$]="#"+nt.getHexString()),typeof(g==null?void 0:g.setDirty)=="function"&&g.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(rt=>rt),e.label===void 0&&(e.label=$)}return(s=s??{}).view="color",Ht(e.inlinePicker)&&(s.picker="inline"),by(c,e,i,s)},by=(c,e,i,s)=>{var a;let h=Ht(e.property);if((e.getValue||e.setValue)&&h&&console.error("specify either property or value, or getValue and setValue",e),h)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var nt;return(nt=e.getValue)===null||nt===void 0?void 0:nt.call(e)},set:nt=>{var rt;return(rt=e.setValue)===null||rt===void 0?void 0:rt.call(e,nt)}}),h=[e,"value"]),h||e.value===void 0||(h=[e,"value"]),!h)return void console.error("cannot determine property",e);s=s??{};const g={label:(a=Ht(e.label))!==null&&a!==void 0?a:h[1],...s};let $=e.uiRef;if(!$&&typeof h[0]=="object"&&h[0]){const[nt,rt]=h;try{$=e.isMonitor?c.addMonitor(nt,rt,g):c.addInput(nt,rt,g).on("change",st=>{[e.onChange].flat().forEach(ut=>typeof ut=="function"&&(ut==null?void 0:ut(st))),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(st)})}catch(st){if(!st.message.startsWith("No matching controller for"))throw st;$=void 0}}if($){for(const[nt,rt]of Object.entries(g)){const st=$.controller_.props.value(nt);st!==void 0&&st.rawValue!==rt&&$.controller_.props.set(nt,rt)}e.type==="slider"&&(g.min!==void 0&&$.controller_.valueController.sliderController.props.set("minValue",g.min),g.max!==void 0&&$.controller_.valueController.sliderController.props.set("maxValue",g.max)),$.refresh()}return $};class LO extends _e{constructor(e=!1,i=!1,s=!1,a=!0,h=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={folder:sF,input:by,slider:lF,dropdown:aF,checkbox:by,color:cF,vec:z2,vec2:z2,vec3:z2,vec4:z2,button:oF,monitor:($,nt,rt,st)=>(nt.isMonitor=!0,by($,nt,rt,st)),dummy:($,nt,rt,st)=>by($,nt,rt,st)},this.alert=async $=>alert($),this.confirm=async $=>confirm($),this.prompt=async($,nt,rt=!0)=>prompt($,nt),this._expand=e,this._limitedOptions=s;const g=this._createUiContainer();h.appendChild(g),this._pane=new rF.Pane({title:"Configuration",container:g}),this._pane.expanded=this._expand,a&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],a=po(),h=a-this._lastModeTime[e];i.forEach(g=>{g[2]>.001?(g[2]-=h,s.push(g)):this._refreshUiObject(g[0],g[1],g[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=a}addToRefreshQueue(e,i){var s;const a=(s=i[0])===null||s===void 0?void 0:s.uiConfig,h=a==null?void 0:a.uuid,g=this._refreshQueue[e],$=g.find(nt=>nt[3]===h);$?$[2]=Math.max($[2],i[2]):g.push([...i,h]),this._refreshQueue[e]=g}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var s,a,h,g;const{uiConfig:$}=e??{};if($&&(!this._limitedOptions||$.limitedUi)&&(i=i??this._pane,$.type)){$.uuid||($.uuid=Ao()),$.uiRef&&$.uiRefType!==$.type&&(console.log("Removing UI object because of type mismatch",$.uiRef),this.removeUiConfig($));const nt=(a=(s=this._typeGenerators)[$.type])===null||a===void 0?void 0:a.call(s,i,$,this);nt&&(nt.hidden=(h=Ht($.hidden))!==null&&h!==void 0&&h,nt.disabled=(g=Ht($.disabled))!==null&&g!==void 0&&g),$.uiRef=nt,$.uiRefType=nt?$.type:void 0,$.uiRefresh=(rt="postFrame",st=!1,ut=0)=>{var mt;return this._uiObjectRefresh(rt,(mt=e==null?void 0:e.uiConfig)!==null&&mt!==void 0?mt:$,i,st,ut)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)===null||s===void 0||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,a,h){(a?rR(i,s):[{uiConfig:i,parentFolder:s}]).forEach(g=>{const $=[{uiConfig:g.uiConfig},g.parentFolder,h];e==="immediate"?this._refreshUiObject(...$):this.addToRefreshQueue(e,$)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=Ml({id:"tweakpaneUiContainer",addToBody:!1});return Gv(Wt`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function rR(c,e,i){var s;return i=i??[],c&&(i.push({uiConfig:c,parentFolder:e}),(s=c.children)===null||s===void 0||s.forEach(a=>i=rR(a,c.uiRef,i))),i}class iR{constructor(){iR.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,a,h,g,$,nt,rt){const st=this.elements;return st[0]=e,st[1]=a,st[2]=$,st[3]=i,st[4]=h,st[5]=nt,st[6]=s,st[7]=g,st[8]=rt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,a=i.elements,h=this.elements,g=s[0],$=s[3],nt=s[6],rt=s[1],st=s[4],ut=s[7],mt=s[2],gt=s[5],yt=s[8],wt=a[0],It=a[3],Et=a[6],Ct=a[1],xt=a[4],Bt=a[7],Lt=a[2],Gt=a[5],Xt=a[8];return h[0]=g*wt+$*Ct+nt*Lt,h[3]=g*It+$*xt+nt*Gt,h[6]=g*Et+$*Bt+nt*Xt,h[1]=rt*wt+st*Ct+ut*Lt,h[4]=rt*It+st*xt+ut*Gt,h[7]=rt*Et+st*Bt+ut*Xt,h[2]=mt*wt+gt*Ct+yt*Lt,h[5]=mt*It+gt*xt+yt*Gt,h[8]=mt*Et+gt*Bt+yt*Xt,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],g=e[4],$=e[5],nt=e[6],rt=e[7],st=e[8];return i*g*st-i*$*rt-s*h*st+s*$*nt+a*h*rt-a*g*nt}invert(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],g=e[4],$=e[5],nt=e[6],rt=e[7],st=e[8],ut=st*g-$*rt,mt=$*nt-st*h,gt=rt*h-g*nt,yt=i*ut+s*mt+a*gt;if(yt===0)return this.set(0,0,0,0,0,0,0,0,0);const wt=1/yt;return e[0]=ut*wt,e[1]=(a*rt-st*s)*wt,e[2]=($*s-a*g)*wt,e[3]=mt*wt,e[4]=(st*i-a*nt)*wt,e[5]=(a*h-$*i)*wt,e[6]=gt*wt,e[7]=(s*nt-rt*i)*wt,e[8]=(g*i-s*h)*wt,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,a,h,g,$){const nt=Math.cos(h),rt=Math.sin(h);return this.set(s*nt,s*rt,-s*(nt*g+rt*$)+g+e,-a*rt,a*nt,-a*(-rt*g+nt*$)+$+i,0,0,1),this}scale(e,i){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=i,s[4]*=i,s[7]*=i,this}rotate(e){const i=Math.cos(e),s=Math.sin(e),a=this.elements,h=a[0],g=a[3],$=a[6],nt=a[1],rt=a[4],st=a[7];return a[0]=i*h+s*nt,a[3]=i*g+s*rt,a[6]=i*$+s*st,a[1]=-s*h+i*nt,a[4]=-s*g+i*rt,a[7]=-s*$+i*st,this}translate(e,i){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=i*s[2],s[4]+=i*s[5],s[7]+=i*s[8],this}equals(e){const i=this.elements,s=e.elements;for(let a=0;a<9;a++)if(i[a]!==s[a])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function NO(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}let CS;class uF{constructor(e=null){this.isSource=!0,this.uuid=or(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let h;if(Array.isArray(a)){h=[];for(let g=0,$=a.length;g<$;g++)a[g].isDataTexture?h.push(sR(a[g].image)):h.push(sR(a[g]))}else h=sR(a);s.url=h}return i||(e.images[this.uuid]=s),s}}function sR(c){if(typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap)return class{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{CS===void 0&&(CS=NO("canvas")),CS.width=e.width,CS.height=e.height;const a=CS.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height),s=CS}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=NO("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const a=s.getImageData(0,0,e.width,e.height),h=a.data;for(let g=0;g<h.length;g++)h[g]=255*no(h[g]/255);return s.putImageData(a,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*no(i[s]/255)):i[s]=no(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(c);if(c.data){let e=[];try{e=Array.from(c.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=c.data}return{data:e,width:c.width,height:c.height,type:c.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let hF=0;class MS extends class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e);e.target=null}}}{constructor(e=MS.DEFAULT_IMAGE,i=MS.DEFAULT_MAPPING,s=1001,a=1001,h=Io,g=1008,$=1023,nt=1009,rt=1,st=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hF++}),this.uuid=or(),this.name="",this.source=new uF(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=a,this.magFilter=h,this.minFilter=g,this.anisotropy=rt,this.format=$,this.internalFormat=null,this.type=nt,this.offset=new lr(0,0),this.repeat=new lr(1,1),this.center=new lr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new iR,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=st,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}MS.DEFAULT_IMAGE=null,MS.DEFAULT_MAPPING=300;var V2=__webpackgi_require__(898),IM={};V2.Z&&V2.Z.locals&&(IM.locals=V2.Z.locals);var oR,aR=0,m1={};m1.styleTagTransform=LC(),m1.setAttributes=OC(),m1.insert=function(c,e){(e.target||document.head).appendChild(c)},m1.domAPI=EE(),m1.insertStyleElement=Rx(),IM.use=function(c){return m1.options=c||{},aR++||(oR=BC()(V2.Z,m1)),IM},IM.unuse=function(){aR>0&&!--aR&&(oR(),oR=null)};var dF=IM;class lR extends LO{constructor(e=!1,i=!1,s=!1,a=document.body){super(e,i,s,!1),this.dependencies=[Jr],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=h=>{this.dispatchEvent(h),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async h=>this._viewer?this._viewer.alert(h):super.alert(h),this.confirm=async h=>this._viewer?this._viewer.confirm(h):super.confirm(h),this.prompt=async(h,g,$=!0)=>this._viewer?this._viewer.prompt(h,g,$):super.prompt(h,g,$),this._pane.registerPlugin(nF),dF.use({target:a})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,a,h,g)=>{const $=a.property,nt="placeholder";if(a.value===void 0&&$&&typeof $[0]=="object"){const[rt,st]=$,ut=cM("Render Target"),mt=cM("Data Texture"),gt=cM("CUBE Texture"),yt=cM("Compressed Texture"),wt={},It={};Object.defineProperty(a,"value",{get:()=>{var Et;let Ct,xt=rt[st];if(xt!=null&&xt.get&&(xt=xt.get()),!xt)return nt;if(xt.isRenderTargetTexture&&!xt.image.tp_src&&(xt.image.tp_src=ut),xt.isDataTexture&&!xt.image.tp_src&&(xt.image.tp_src=mt),xt.isCompressedTexture&&!xt.image.tp_src&&(xt.image.tp_src=yt),xt.isTexture?(xt.image&&(xt.image instanceof ImageBitmap||xt.image instanceof HTMLImageElement||xt.image instanceof HTMLVideoElement)&&!xt.image.tp_src&&(xt.image.tp_src=C_(xt.image,160)),xt.image&&(Ct=xt.image.tp_src_uuid,Ct=Ct?wt[Ct]:void 0,Ct||(Ct=xt.image.tp_src||xt.image.src))):typeof xt=="string"?Ct=xt:xt.domainMin?(Ct=xt.texture,xt.texture.image&&!xt.texture.image.tp_src&&(xt.texture.image.tp_src=gt),xt.texture.image&&(Ct=xt.texture.image.tp_src_uuid,Ct=Ct?wt[Ct]:void 0,Ct||(Ct=xt.texture.image.tp_src||xt.texture.image.src))):xt&&console.error("unknown value",xt),Ct||(Ct=nt),xt.image&&!xt.image.tp_src_uuid){const Bt=Ao();xt.image.tp_src_uuid=Bt,It[Ct]=Bt}return typeof Ct=="string"&&(Ct=(Et=wt[Ct])!==null&&Et!==void 0?Et:Ct),Ct},set:Et=>{var Ct,xt,Bt,Lt,Gt,Xt,rn,fn,wn,Cn,bn;const Dn=rt[st],En=Un=>{var Pn;rt[st]=Un,Un!=null&&Un.isTexture&&(Un.flipY=Un.isDataTexture?Un.flipY:(Pn=Dn==null?void 0:Dn.flipY)===null||Pn===void 0||Pn)};if(typeof Et=="string")return void(typeof Dn=="string"&&En(Et));if(!Et)return void(a.value=nt);if(Et.isPlaceholder)return void(Dn&&(En(typeof Dn=="string"?"":null),typeof(rt==null?void 0:rt.setDirty)=="function"&&rt.setDirty()));let Tn=Et.tp_src_uuid;if(Tn||(Tn=(Ct=Et.src)!==null&&Ct!==void 0?Ct:Et.tp_src,Tn=(xt=It[Tn])!==null&&xt!==void 0?xt:Tn,delete It[Tn],Et.tp_src_uuid=Tn),Tn&&(wt[Tn]=Et),typeof Dn!="string"){if(!((Dn==null?void 0:Dn.image)===Et||((Bt=Dn==null?void 0:Dn.image)===null||Bt===void 0?void 0:Bt.src)===Et.src||((Lt=Dn==null?void 0:Dn.image)===null||Lt===void 0?void 0:Lt.tp_src)===Et.tp_src&&Et.tp_src!=null||((Gt=Dn==null?void 0:Dn.image)===null||Gt===void 0?void 0:Gt.tp_src)===Et.src&&Et.src!=null||((Xt=Dn==null?void 0:Dn.image)===null||Xt===void 0?void 0:Xt.src)===Et.tp_src&&Et.tp_src!=null))if(Et instanceof File){const Un=i==null?void 0:i.getPlugin(Jr);if(!Un)throw"Viewer or AssetManagerPlugin not found";(rn=Un.importer)===null||rn===void 0||rn.importSingle({file:Et,path:Et.src}).then(Pn=>{var Yn,cr,mr,ir;if(Pn){Pn.isDataTexture&&(Pn.needsUpdate=!0);const Dr=(mr=(cr=(Yn=Et.src)===null||Yn===void 0?void 0:Yn.split("?"))===null||cr===void 0?void 0:cr[0])===null||mr===void 0?void 0:mr.split(".").pop();Pn.userData&&(Pn.userData.mimeType||(Pn.userData.mimeType="image/"+(["jpg","jpeg"].includes(Dr)?"jpeg":"png"))),En(Pn),[a.onChange].flat().forEach(Nr=>typeof Nr=="function"&&(Nr==null?void 0:Nr())),typeof(rt==null?void 0:rt.setDirty)=="function"&&rt.setDirty(),(ir=a.uiRefresh)===null||ir===void 0||ir.call(a,"postFrame",!1)}})}else{const Un=new MS(Et);Un.assetType="texture",Un.needsUpdate=!0;const Pn=(Cn=(wn=(fn=Et.src)===null||fn===void 0?void 0:fn.split("?"))===null||wn===void 0?void 0:wn[0])===null||Cn===void 0?void 0:Cn.split(".").pop();Un.userData.mimeType||(Un.userData.mimeType="image/"+(["jpg","jpeg"].includes(Pn)?"jpeg":"png")),En(Un);const Yn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(st);Un.encoding=Yn?d.rnI:d.knz,Un.wrapS=d.rpg,Un.wrapT=d.rpg,[a.onChange].flat().forEach(cr=>typeof cr=="function"&&(cr==null?void 0:cr())),typeof(rt==null?void 0:rt.setDirty)=="function"&&rt.setDirty(),(bn=a.uiRefresh)===null||bn===void 0||bn.call(a,"postFrame",!1)}}else En(Tn)}}),a.property=void 0,a.label===void 0&&(a.label=st)}return(g=g??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],g.imageFit===void 0&&(g.imageFit="contain"),g.clickCallback===void 0&&(g.clickCallback=(rt,st)=>{var ut;const mt=rt==null?void 0:rt.target,gt=mt==null?void 0:mt.getBoundingClientRect();if(!gt)return void st.click();const yt=a.uiRef.controller_.valueController.value.rawValue,wt=yt===nt||yt!=null&&yt.isPlaceholder?{}:{"remove image":()=>{var Et;a.uiRef.controller_.valueController.value.setRawValue("");const[Ct,xt]=$||[a,"value"],Bt=typeof Ct[xt]=="string";Ct[xt]=Bt?"":null,[a.onChange].flat().forEach(Lt=>typeof Lt=="function"&&(Lt==null?void 0:Lt())),typeof(Ct==null?void 0:Ct.setDirty)=="function"&&Ct.setDirty(),(Et=a.uiRefresh)===null||Et===void 0||Et.call(a,"postFrame",!1),A_.Remove()},"download image":()=>{var Et,Ct,xt;const[Bt,Lt]=$||[a,"value"];let Gt=(Ct=(Et=Bt[Lt])===null||Et===void 0?void 0:Et.image)!==null&&Ct!==void 0?Ct:a.uiRef.controller_.valueController.value.rawValue;Gt&&(Gt instanceof ImageBitmap||Gt instanceof HTMLImageElement||Gt instanceof HTMLVideoElement)&&!Gt.src&&(Gt=C_(Gt));const Xt=document.createElement("a");document.body.appendChild(Xt),Xt.style.display="none",Xt.href=(xt=Gt==null?void 0:Gt.src)!==null&&xt!==void 0?xt:Gt,Xt.download="image.png",Xt.click(),document.body.removeChild(Xt),A_.Remove()}},It=A_.Create({...wt,"set/replace image":()=>{st.click(),A_.Remove()},"from url":async()=>{var Et,Ct;let xt="";if(xt&&(xt.startsWith("http")||xt.startsWith("data:image"))||(xt=""),xt=await h.prompt("Load texture: Enter Image/Texture URL",xt,!0),!xt||!xt.startsWith("http")&&!xt.startsWith("data:image"))return xt!==null&&await h.alert("Loading Image: Invalid URL"),void A_.Remove();const[Bt,Lt]=$||[a,"value"],Gt=Bt[Lt];if(typeof Gt=="string")Bt[Lt]=xt,[a.onChange].flat().forEach(Xt=>typeof Xt=="function"&&(Xt==null?void 0:Xt())),typeof(Bt==null?void 0:Bt.setDirty)=="function"&&Bt.setDirty(),(Et=a.uiRefresh)===null||Et===void 0||Et.call(a,"postFrame",!1);else{const Xt=i==null?void 0:i.getPlugin(Jr);if(!Xt)throw"Viewer or AssetManagerPlugin not found";(Ct=Xt.importer)===null||Ct===void 0||Ct.importSinglePath(xt).then(rn=>{var fn;if(rn){rn.isDataTexture?rn.needsUpdate=!0:rn&&(Gt==null?void 0:Gt.flipY)!==void 0&&(rn.flipY=Gt.flipY),Bt[Lt]=rn;const wn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(Lt);rn.encoding=wn?d.rnI:d.knz,[a.onChange].flat().forEach(Cn=>typeof Cn=="function"&&(Cn==null?void 0:Cn())),typeof(Bt==null?void 0:Bt.setDirty)=="function"&&Bt.setDirty(),(fn=a.uiRefresh)===null||fn===void 0||fn.call(a,"postFrame",!1)}})}A_.Remove()},cancel:()=>{A_.Remove()}},2,gt.height+8);(ut=mt.parentElement)===null||ut===void 0||ut.appendChild(It),gt.y>.7*document.body.clientHeight&&(It.style.top="auto",It.style.bottom=gt.height+8+"px")}),g.view="input-image",by(s,a,h,g)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(e);if(!s)return void console.warn("plugin not found:",e);this._plugins.push(s),s.uiConfig&&(s.uiConfig.limitedUi=!0),s.uiConfig&&s.uiConfig.hidden===void 0&&(s.uiConfig.hidden=!1),this._appendUiObject(s);const a=s.uiConfig;if(a!=null&&a.uiRef&&s.toJSON){const h=a.uiRef.controller_.view.element,g=Ml({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});g.onclick=$=>{const nt={};typeof s.toJSON=="function"&&(nt["download preset"]=async()=>{var st,ut;const mt=(ut=(st=this._viewer)===null||st===void 0?void 0:st.getPlugin(Jr))===null||ut===void 0?void 0:ut.exportPluginPreset(s);await Tu(new Blob([JSON.stringify(mt,null,2)],{type:"application/json"}),"preset."+s.constructor.PluginType+".json"),A_.Remove()}),typeof s.fromJSON=="function"&&(nt["upload preset"]=async()=>{var st,ut;A_.Remove();const mt=await S_(!1,!1);if(mt.length===0)return;const gt=mt[0],yt=await gt.text(),wt=JSON.parse(yt);await((ut=(st=this._viewer)===null||st===void 0?void 0:st.getPlugin(Jr))===null||ut===void 0?void 0:ut.importPluginPreset(wt,s))});const rt=A_.Create(nt,h.clientWidth-120,12);h.append(rt),$.preventDefault()},h.appendChild(g)}return a}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var i;const s=e.uiConfig;s&&(Ht(s.hidden)!==!0?(i=s.uiRefresh)===null||i===void 0||i.call(s,"postFrame",!0):s.uiRef&&(s.uiRef.hidden=!0))})}}lR.PluginType="TweakpaneUi";class Q2 extends Ks{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,onChange:()=>{if(!this._viewer)return;const e=new hs(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return i&&(i.isTexture||i.assetType==="texture")?i:null}set sceneBackground(e){var i,s;e?(i=this._viewer)===null||i===void 0||i.setBackground(e):(s=this._viewer)===null||s===void 0||s.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var i;(i=this._viewer)===null||i===void 0||i.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,i,s;return(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||i===void 0?void 0:i.rotation)!==null&&s!==void 0?s:0}set sceneEnvironmentRotation(e){var i,s;const a=(i=this._viewer)===null||i===void 0?void 0:i.scene.getEnvironment();a&&(a.rotation=e,(s=this._viewer)===null||s===void 0||s.scene.setDirty())}get sceneEnvironmentIntensity(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&i!==void 0?i:1}set sceneEnvironmentIntensity(e){var i;!((i=this._viewer)===null||i===void 0)&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===wv}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.getBackground(!0);i&&i!==wv&&(this.lastBgVal=i),this._viewer.setBackground(wv)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var i;await super.onAdded(e);const s=e.getBackground();this.bgUIConfig.value=typeof s=="string"&&s!==wv||typeof s=="number"||!((i=s)===null||i===void 0)&&i.isColor?"#"+new hs(s).getHexString():"#000000",this.lastBgVal=s}}Q2.PluginType="SimpleBackgroundEnvUiPlugin1";class G2 extends Ks{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||i===void 0?void 0:i.map(a=>a.assetType==="light"?null:a.uiConfig).filter(a=>a!=null))!==null&&s!==void 0?s:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}}G2.PluginType="SimpleUi";var pF=__webpackgi_require__(1),fF=__webpackgi_require__.n(pF)();class H2 extends Ks{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=Ml({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s,a,h;const g=(s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot;if(!g||i==null)return;const $=new Set;g.traverse(nt=>{nt!==g&&(nt.visible=i.includes(nt.uuid),nt.visible&&nt.traverseAncestors(rt=>$.add(rt)))}),$.forEach(nt=>nt.visible=!0),(h=(a=this._viewer)===null||a===void 0?void 0:a.scene)===null||h===void 0||h.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),Gv(Wt`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var i;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot;if(!s)return;const a=s.children.reduce(this._buildData,[]),h=s.children.reduce(this._findVisible,[]);let g=!1;return new Promise(($,nt)=>{this.treeView=new fF(this.hierarchyDiv,{closeDepth:1,data:a,loaded:function(){this.values=h,$()},onChange:()=>{g?ou(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):g=!0},onItemLabelClick:rt=>{var st;const ut=(st=this._viewer)===null||st===void 0?void 0:st.scene.modelRoot.modelObject.getObjectByProperty("uuid",rt);ut&&s.visible&&ut.dispatchEvent({type:"select",value:ut,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}H2.PluginType="HierarchyUiPlugin";class W2 extends Ks{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new n_;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Jr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(g=>{if(!g.lightObject)return;const $=g.uiConfig;$&&!h.includes($)&&h.push($)}),[...this.uiConfig.children].forEach(g=>{var $;(($=g)===null||$===void 0?void 0:$.type)==="button"||h.includes(g)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(g),1)}),h.forEach(g=>{this.uiConfig.children.includes(g)||this.uiConfig.children.push(g)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}W2.PluginType="SimpleLightsUi";class q2 extends Ks{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[Jr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(g=>{if(!g.cameraObject)return;const $=g.uiConfig;$&&!h.includes($)&&h.push($)}),[...this.uiConfig.children].forEach(g=>{var $;(($=g)===null||$===void 0?void 0:$.type)==="button"||h.includes(g)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(g),1)}),h.forEach(g=>{this.uiConfig.children.includes(g)||this.uiConfig.children.push(g)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}q2.PluginType="SimpleSceneCamerasUi";var PM,Y2=function(c,e,i,s){var a,h=arguments.length,g=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(c,e,i,s);else for(var $=c.length-1;$>=0;$--)(a=c[$])&&(g=(h<3?a(g):h>3?a(e,i,g):a(e,i))||g);return h>3&&g&&Object.defineProperty(e,i,g),g};let dA=PM=class extends Ks{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var c;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},i=this._viewer.container.getBoundingClientRect();e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,(c=this._viewer)===null||c===void 0||c.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(c){await super.onAdded(c);const e=c.canvas.clientWidth,i=c.canvas.clientHeight,s=c.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,c.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(c){return this.removeEventListener("deserialize",this._sizeChanged),c.renderer.removeEventListener("resize",this._refresh),super.onRemove(c)}_refresh(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0)}};dA.PluginType="RendererParamsUiPlugin",Y2([Qn(),hn(PM.prototype._sizeChanged),ls("Width",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],dA.prototype,"width",void 0),Y2([Qn(),hn(PM.prototype._sizeChanged),ls("Height",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],dA.prototype,"height",void 0),Y2([Qn(),hn(PM.prototype._sizeChanged),ls("Scale",[.25,4],.25,{limitedUi:!0})],dA.prototype,"scale",void 0),dA=PM=Y2([ho("Renderer")],dA);class X2 extends Ks{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var i;const s=super.toJSON(e);return s.activeCamera=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera.toJSON(),s}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)===null||s===void 0||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}X2.PluginType="CameraUiPlugin";var mF={create:c=>{let e="button"+(c.type?" "+c.type:""),i=Vs.createDiv(e,c.text);return i.addEventListener("click",c.onClick),i}};let Nm={createElement:(c,e,i,s)=>{let a=document.createElement(c);if(e&&(a.className=e),i&&(a.innerHTML=i),s)for(let h in s)a.setAttribute(h,s[h]);return a},createDiv:(c,e,i)=>Nm.createElement("div",c,e,i),createDomTree:c=>{if(!c||!c.hasOwnProperty("dom"))return c;let e=c.dom;if(c.children)for(let i in c.children)c.children[i]&&e.appendChild(Nm.createDomTree(c.children[i]));return e},removeElement:c=>{c!=null&&c.parentNode.removeChild(c)},appendToBody:c=>{document.body.appendChild(c)},makeIconHTML:c=>{let e="";return c=="ok"&&(e="#tick"),c=="error"&&(e="#cancel"),c=="info"&&(e="#info-button"),c=="caution"&&(e="#danger"),c=="min"&&(e="#line"),c=="close"&&(e="#close"),`<svg class="icon ${c}"><use xlink:href="${e}" /></svg>`},makeNftContent:c=>{let e=null;if(c.type){let i=null;i=typeof c.content=="string"?Nm.createDiv("inner-content",c.content):Nm.createDomTree({dom:Nm.createDiv("inner-content"),children:[c.content]}),e=c.type=="text"?Nm.createDomTree({dom:Nm.createDiv("content text"),children:[i]}):Nm.createDomTree({dom:Nm.createDiv("content"),children:[Nm.createDiv("state",Nm.makeIconHTML(c.type)),i]})}else typeof c.content=="string"&&(e=Nm.createDiv("content",c.content));return e},standardizeButtons:(c,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:c.close.bind(c,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:c.close.bind(c,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=c.close.bind(c,i[s].id));return i},makeButtons:c=>{let e=[];if(c)for(let i in c)e.push(mF.create({text:c[i].text?c[i].text:"OK",type:c[i].normal?null:"main",onClick:c[i].onClick}));return Nm.createDomTree({dom:Nm.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:c=>{let e=i=>{for(let s in c)if(c[s].key===i.keyCode)return void c[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:c=>{window.removeEventListener("keydown",c)}};var Vs=Nm,Gu=__webpackgi_require__(476),Hp={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let A0={};A0.overlay_in=[new Gu.Frame(Hp["wwise-overlay-in-1"],0),new Gu.Frame(Hp["wwise-overlay-in-2"],400)],A0.overlay_out=[new Gu.Frame(Hp["wwise-overlay-out-1"],300)],A0.pop_in=[new Gu.Frame(Hp["wwise-pop-in-1"],0),new Gu.Frame(Hp["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new Gu.Frame(Hp["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new Gu.Frame(Hp["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],A0.pop_out=[new Gu.Frame(Hp["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],A0.flip_in=[new Gu.Frame(Hp["wwise-flip-in-1"],0),new Gu.Frame(Hp["wwise-flip-in-2"],500)],A0.flip_out=[new Gu.Frame(Hp["wwise-flip-out-1"],400)],A0.min_in=[new Gu.Frame(Hp["wwise-min-in-1"],0),new Gu.Frame(Hp["wwise-min-in-2"],350)],A0.min_out=[new Gu.Frame(Hp["wwise-min-out-1"],400)];let FO=["top","bottom","left","right"];for(let c in FO){let e=FO[c];A0[e+"_in"]=[new Gu.Frame(Hp["wwise-"+e+"-in-1"],0),new Gu.Frame(Hp["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],A0[e+"_out"]=[new Gu.Frame(Hp["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var K2=A0;let gF={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class cR{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let a=e.getElementsByClassName("content")[0];return a&&(a=a.innerHTML),Vs.removeElement(e),i.title=s,i.content=a,new cR(i)}constructor(e){this.options=JSON.parse(JSON.stringify(gF));for(let nt in e)e[nt]!=null&&(this.options[nt]=e[nt]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let nt=document.getElementsByClassName("wwise-overlay");nt.length?(this.overlay=nt[0],this.hasOverlay=!0):(this.overlay=Vs.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let nt=[];this.options.topbar.showMin&&(nt.push(Vs.createDiv(null,Vs.makeIconHTML("min"))),nt[nt.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(nt.push(Vs.createDiv(null,Vs.makeIconHTML("close"))),nt[nt.length-1].addEventListener("click",this.close.bind(this,void 0)));let rt=null;rt=typeof this.options.title=="string"?Vs.createDiv("title",this.options.title):Vs.createDomTree({dom:Vs.createDiv("title"),children:[this.options.title]}),this.topbar=Vs.createDomTree({dom:Vs.createDiv("topbar"),children:[{dom:Vs.createDiv("control"),children:nt.map(st=>({dom:st}))},{dom:rt},{dom:Vs.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=Vs.createDomTree({dom:Vs.createDiv(s,this.options.content)}):this.content=Vs.createDomTree({dom:Vs.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Vs.createDomTree({dom:Vs.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let a=Vs.createDiv("wwise-wrapper");this.options.zIndex&&(a.style.zIndex=this.options.zIndex),this.wrapper=Vs.createDomTree({dom:a,children:[this.window]}),this.dom=Vs.createDomTree({dom:Vs.createDiv(),children:[this.wrapper]});let h=this.options.position.split(" "),g=-50,$=-50;if(h[0]=="left"?(g=0,this.wrapper.classList.add("left")):h[0]=="right"?(g=-100,this.wrapper.classList.add("right")):h[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=h[0],h[1]=="top"?($=0,this.wrapper.classList.add("top")):h[1]=="bottom"?($=-100,this.wrapper.classList.add("bottom")):h[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${g}%, ${$}%)`,this.options.style)for(let nt in this.options.style)this.window.style[nt]=this.options.style[nt];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new Gu.Queue(this.wrapper,K2[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new Gu.Queue(this.overlay,K2.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new Gu.Queue(this.wrapper,K2[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new Gu.Queue(this.overlay,K2.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Vs.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Vs.appendToBody(this.dom)}removeDoms(){Vs.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Vs.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),a=this.options.draggable,h=parseFloat(s.left),g=parseFloat(s.top);if(s.left.indexOf("%")!=-1){h=s.left,h=h.substr(0,h.length-1),h=parseInt(h);let $=window,nt=document,rt=nt.documentElement,st=nt.getElementsByTagName("body")[0];h=h*($.innerWidth||rt.clientWidth||st.clientWidth)/100}if(s.top.indexOf("%")!=-1){g=s.top,g=g.substr(0,g.length-1),g=parseInt(g);let $=window,nt=document,rt=nt.documentElement,st=nt.getElementsByTagName("body")[0];g=g*($.innerHeight||rt.clientHeight||st.clientHeight)/100}a!=1&&a!="horizontal"||(this.wrapper.style.left=h+i.x+"px"),a!=1&&a!="vertical"||(this.wrapper.style.top=g+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var vF=cR,uR=class{constructor(c){let e=this.options=c;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new vF(i)}constructContent(c){let e=Vs.createDiv("modal"),i=Vs.createDomTree({dom:Vs.createDiv("main "+c.type),children:[Vs.createDiv(null,Vs.makeIconHTML(c.type)),Vs.createDiv("title",c.title),Vs.createDiv("text",c.text)]});this.buttonArr=Vs.standardizeButtons(this,c);let s=Vs.makeButtons(this.buttonArr),a=null;c.content&&(a=typeof c.content=="string"?Vs.createDiv(null,c.content):c.content);let h=null;return s.innerHTML&&(h=Vs.createDomTree({dom:Vs.createDiv("operation "+c.type),children:[s]})),a||h||i.classList.add("no-op"),Vs.createDomTree({dom:e,children:[i,a,h]})}open(){if(this.wwise.opened)return;let c=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Vs.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),c}close(c){if(this.wwise.opened)return this.value=c,Vs.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let _F={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},yF={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var $2=__webpackgi_require__(513),DM={};$2.Z&&$2.Z.locals&&(DM.locals=$2.Z.locals);var hR,dR=0,g1={};g1.styleTagTransform=LC(),g1.setAttributes=OC(),g1.insert=function(c,e){(e.target||document.head).appendChild(c)},g1.domAPI=EE(),g1.insertStyleElement=Rx(),DM.use=function(c){return g1.options=c||{},dR++||(hR=BC()($2.Z,g1)),DM},DM.unuse=function(){dR>0&&!--dR&&(hR(),hR=null)};var AF=DM;class pR extends Ks{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Vs.appendToBody=i=>{e.container.appendChild(i)},Vs.makeIconHTML=i=>"",AF.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],a=new uR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return a.open(),a.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],a=new uR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return a.open(),await a.getPromise()==="yes"},e.prompt=async(i,s,a=!0)=>{const h=i==null?void 0:i.split(":")[0],g=new class{constructor($){this.options=JSON.parse(JSON.stringify(_F));for(let ut in $)$[ut]!=null&&(this.options[ut]=$[ut]);let nt=this.options,rt=JSON.parse(JSON.stringify(yF));for(let ut in rt)nt.hasOwnProperty(ut)&&(rt[ut]=nt[ut]);let st=[];nt.showCancel&&st.push({key:27,text:nt.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),st.push({key:13,text:nt.okText,onClick:this.handleOk.bind(this)}),rt.buttons=st,this.input=Vs.createElement("input","input",null,{placeholder:nt.placeholder}),this.error=Vs.createDiv("error"),rt.content=Vs.createDomTree({dom:Vs.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new uR(rt)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},$=>{this.error.innerText=$}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let $=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((nt,rt)=>{this.promiseResolve=nt,this.promiseReject=rt}),$}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:h??"&ndsp;",placeholder:s??"",showCancel:a,animation:"overlay",text:(i==null?void 0:i.replace(h||"","").replace(":",""))||""});return g.open(),await g.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}pR.PluginType="WindowiseDialogPlugin";var wF=h2({defaultModifiers:[fD,gD,vD,p2]}),xF=__webpackgi_require__(388),bF=__webpackgi_require__.n(xF);function EF(c){const e=[];c.traverse(a=>{a.geometry&&e.push(a)});const i={},s={};e.forEach(a=>{var h;if(!i[a.geometry.uuid]){const nt=a.geometry.toJSON().data,rt=nt?bF()({a:nt.attributes||{},b:nt.index||[]}):"";i[a.geometry.uuid]=rt}const g=i[a.geometry.uuid],$=(h=s[g])!==null&&h!==void 0?h:s[g]=[];$.includes(a)||$.push(a)}),Object.values(s).forEach(a=>{if(a.length<2)return;const h=a[0].geometry;a.forEach((g,$)=>{$<1||(g.geometry.dispose(),g.geometry=h)})})}const pA=new d.Pa4,v1=new d.Pa4,J2=new d.Pa4,fR=new d.Pa4,Z2=new d.Pa4,TS=new d.Pa4;let mR=1;const SF=new d.Pa4(0,1,0);class CF extends Qv{constructor(e,i){super(e,i),this.targetOffset=new d.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),pA.copy(this.object.position).sub(this.target),mR=pA.length(),TS.copy(this.target);const i=e();return TS.sub(this.target),pA.copy(this.object.position).sub(this.target),mR/=pA.length(),this.target.add(TS),this.object.position.copy(this.target).add(pA),pA.normalize(),v1.crossVectors(SF,pA).normalize(),J2.crossVectors(pA,v1).normalize(),fR.crossVectors(v1,J2).normalize().negate(),v1.length()>.1&&this.object.up.crossVectors(pA.clone().normalize(),v1),this.enablePan&&(Z2.set(0,0,0).addScaledVector(v1,TS.x).addScaledVector(J2,TS.y).addScaledVector(fR,TS.z),this.targetOffset.add(Z2),this.targetOffset.multiplyScalar(1/mR)),Z2.set(0,0,0).addScaledVector(v1,-this.targetOffset.x).addScaledVector(J2,-this.targetOffset.y).addScaledVector(fR,-this.targetOffset.z),this.object.lookAt(Z2.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class MF extends JS{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new d.cJO(1,0))}}function gR(c,e){var i,s;const a=Array.from(((i=c.access)!==null&&i!==void 0?i:"").split(".")),h=a.pop();let g=(s=c.targetObject)!==null&&s!==void 0?s:e;if(!h||h.length===0)return{key:void 0,tar:g};if(g=Ft(a,g),g&&!(h in g))throw console.error("invalid key",h,g,e,c),"";return{key:h,tar:g}}function vR(c,e,i,s){const{key:a,tar:h}=gR(c,e);return a&&h?cx(h,a,()=>{var g;i&&(!((g=c.updater)===null||g===void 0)&&g.length)&&c.updater.forEach($=>i[$]()),s==null||s()}):g=>console.warn("Unable to set ",g,a,h,c,e)}async function eP(c,e,i){var s,a,h,g;const{key:$,tar:nt}=gR(e,c),rt=e.animSet?[UO(nt,e.animSet,i,(s=e.animSetParallel)!==null&&s!==void 0&&s)]:[];if($&&nt){const st=(g=e.updater)!==null&&g!==void 0?g:[],ut=async()=>ux(nt,$,{...e,onUpdate:mt=>{var gt;(gt=e.onUpdate)===null||gt===void 0||gt.call(e,mt),st.forEach(yt=>{var wt;return(wt=i[yt])===null||wt===void 0?void 0:wt.call(i)})}});e.delay?rt.push(ou(e.delay).then(ut)):rt.push(ut())}else(e.duration||e.delay)&&rt.push(ou(((a=e.delay)!==null&&a!==void 0?a:0)+((h=e.duration)!==null&&h!==void 0?h:0)));return rt.length===1?rt[0]:Promise.all(rt)}async function UO(c,e,i,s=!1){if(s)return Promise.all(e.map(async a=>eP(c,a,i)));for(const a of e)await eP(c,a,i)}function jO(c,e,i,s){var a,h,g,$,nt,rt,st;if(!c)return;e||(e=[]);const ut=s??{},mt=c;for(let gt=0,yt=e.length;gt<yt;gt++){const wt=e[gt];if(wt.uiRef){const Et=(nt=mt==null?void 0:mt.indexOf(wt.uiRef))!==null&&nt!==void 0?nt:-1;Et!==gt&&(Et>=0&&(mt==null||mt.splice(Et,1)),mt==null||mt.splice(gt,0,wt.uiRef))}else{wt.uiRef={type:"folder",label:(a=wt.name)!==null&&a!==void 0?a:"Animation "+gt,children:[]};const Et=[{type:"button",label:"animate",value:()=>{eP(i,wt,ut).then(()=>{var Ct;return console.log(((Ct=wt.uiRef)===null||Ct===void 0?void 0:Ct.label)+" finished")})}}];wt.access!==void 0&&Et.push({type:"input",property:[wt,"access"]}),wt.from!==void 0&&Et.push({type:(h=wt.uiObjectType)!==null&&h!==void 0?h:"input",property:[wt,"from"],onChange:()=>{var Ct;vR(wt,i)(wt.from),(Ct=wt.updater)===null||Ct===void 0||Ct.forEach(xt=>xt in ut&&ut[xt]())}}),wt.to!==void 0&&Et.push({type:(g=wt.uiObjectType)!==null&&g!==void 0?g:"input",property:[wt,"to"],onChange:()=>{var Ct;vR(wt,i)(wt.to),(Ct=wt.updater)===null||Ct===void 0||Ct.forEach(xt=>xt in ut&&ut[xt]())}}),wt.duration!==void 0&&Et.push({type:"input",property:[wt,"duration"]}),wt.animSet&&(wt.animSetParallel||(wt.animSetParallel=!1),Et.push({type:"input",label:"run parallel",property:[wt,"animSetParallel"]})),wt.animSet&&Et.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),($=wt.uiRef.children)===null||$===void 0||$.push(...Et),mt==null||mt.splice(gt,0,wt.uiRef)}const It=(rt=wt.uiRef.children)===null||rt===void 0?void 0:rt.map(Et=>Ht(Et)).flat(2).find(Et=>Et==null?void 0:Et.animSetContainer);wt.animSet&&It&&jO(It.children,wt.animSet,(st=wt.targetObject)!==null&&st!==void 0?st:i,s)}}function zO(c,e){return e?c*(1e3/e):0}function TF(c){var e,i=c.from,s=i===void 0?0:i,a=c.velocity,h=a===void 0?0:a,g=c.min,$=c.max,nt=c.power,rt=nt===void 0?.8:nt,st=c.timeConstant,ut=st===void 0?750:st,mt=c.bounceStiffness,gt=mt===void 0?500:mt,yt=c.bounceDamping,wt=yt===void 0?10:yt,It=c.restDelta,Et=It===void 0?1:It,Ct=c.modifyTarget,xt=c.driver,Bt=c.onUpdate,Lt=c.onComplete;function Gt(Tn){return g!==void 0&&Tn<g||$!==void 0&&Tn>$}function Xt(Tn){return g===void 0?$:$===void 0||Math.abs(g-Tn)<Math.abs($-Tn)?g:$}function rn(Tn){e==null||e.stop(),e=$A(su(su({},Tn),{driver:xt,onUpdate:function(Un){var Pn;Bt==null||Bt(Un),(Pn=Tn.onUpdate)===null||Pn===void 0||Pn.call(Tn,Un)},onComplete:Lt}))}function fn(Tn){rn(su({type:"spring",stiffness:gt,damping:wt,restDelta:Et},Tn))}if(Gt(s))fn({from:s,velocity:h,to:Xt(s)});else{var wn=rt*h+s;Ct!==void 0&&(wn=Ct(wn));var Cn,bn,Dn=Xt(wn),En=Dn===g?-1:1;rn({type:"decay",from:s,velocity:h,timeConstant:ut,power:rt,restDelta:Et,modifyTarget:Ct,onUpdate:Gt(wn)?function(Tn){Cn=bn,bn=Tn,h=zO(Tn-Cn,uE().delta),(En===1&&Tn>Dn||En===-1&&Tn<Dn)&&fn({from:Tn,to:Dn,velocity:h})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var VO=function(c){return 180*c/Math.PI},IF=function(c,e){return e===void 0&&(e=ix),VO(Math.atan2(e.y-c.y,e.x-c.x))},PF=function(c,e){var i=!0;return e===void 0&&(e=c,i=!1),function(s){return i?s-c+e:(c=s,i=!0,e)}},DF=function(c){return c},_R=function(c){return c===void 0&&(c=DF),function(e,i,s){var a=i-s,h=-(0-e+1)*(0-c(Math.abs(a)));return a<=0?i+h:i-h}},RF=_R(),kF=_R(Math.sqrt),QO=function(c){return c*Math.PI/180},tP=function(c){return c.hasOwnProperty("x")&&c.hasOwnProperty("y")},yR=function(c){return tP(c)&&c.hasOwnProperty("z")},nP=function(c,e){return Math.abs(c-e)};function BF(c,e){if(eE(c)&&eE(e))return nP(c,e);if(tP(c)&&tP(e)){var i=nP(c.x,e.x),s=nP(c.y,e.y),a=yR(c)&&yR(e)?nP(c.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(a,2))}}var OF=function(c,e,i){return e=QO(e),{x:i*Math.cos(e)+c.x,y:i*Math.sin(e)+c.y}},GO=function(c,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(c*e)/e},HO=function(c,e,i,s){return s===void 0&&(s=0),GO(c+i*(e-c)/Math.max(s,i))},LF=function(c){c===void 0&&(c=50);var e=0,i=0;return function(s){var a=uE().timestamp,h=a!==i?a-i:0,g=h?HO(e,s,h,c):e;return i=a,e=g,g}},NF=function(c){if(typeof c=="number")return function(s){return Math.round(s/c)*c};var e=0,i=c.length;return function(s){var a=Math.abs(c[0]-s);for(e=1;e<i;e++){var h=c[e],g=Math.abs(h-s);if(g===0)return h;if(g>a)return c[e-1];if(e===i-1)return h;a=g}}};function FF(c,e){return c/(1e3/e)}var UF=function(c,e,i){var s=e-c;return((i-c)%s+s)%s+c},WO=function(c,e){return 1-3*e+3*c},qO=function(c,e){return 3*e-6*c},YO=function(c){return 3*c},rP=function(c,e,i){return((WO(e,i)*c+qO(e,i))*c+YO(e))*c},XO=function(c,e,i){return 3*WO(e,i)*c*c+2*qO(e,i)*c+YO(e)},iP=.1;function jF(c,e,i,s){if(c===e&&i===s)return Zw;for(var a=new Float32Array(11),h=0;h<11;++h)a[h]=rP(h*iP,c,i);return function(g){return g===0||g===1?g:rP(function($){for(var nt=0,rt=1;rt!==10&&a[rt]<=$;++rt)nt+=iP;--rt;var st=nt+($-a[rt])/(a[rt+1]-a[rt])*iP,ut=XO(st,c,i);return ut>=.001?function(mt,gt,yt,wt){for(var It=0;It<8;++It){var Et=XO(gt,yt,wt);if(Et===0)return gt;gt-=(rP(gt,yt,wt)-mt)/Et}return gt}($,st,c,i):ut===0?st:function(mt,gt,yt,wt,It){var Et,Ct,xt=0;do(Et=rP(Ct=gt+(yt-gt)/2,wt,It)-mt)>0?yt=Ct:gt=Ct;while(Math.abs(Et)>1e-7&&++xt<10);return Ct}($,nt,nt+iP,c,i)}(g),e,s)}}var zF=function(c,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*c,a=e==="end"?Math.floor(s):Math.ceil(s);return G0(0,1,a/c)}};async function VF(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,caching:g=!0}){const $=new Wm(c);$.enabled=!1,e&&await $.addPlugin(Mv),await $.addPlugin(Jr,void 0,void 0,{storage:g&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await $.addPlugin(tM),await $.addPlugin($P),h&&await $.addPlugin(a0),await $.addPlugin(pR),await $.addPlugin(ZC),await $.addPlugin(ao),await $.addPlugin(d_),await $.addPlugin($C),await $.addPlugin(jp),await $.addPlugin(qE),await $.addPlugin(KC),await $.addPlugin(Hw),await $.addPlugin(jo,ZS,!1,!0),await LE($,{ground:i,bloom:s,depthTonemap:a}),await $.addPlugin(y2,!1),await $.addPlugin(v0,!1),await $.addPlugin(eS,!1),await $.addPlugin(yw,!1),await $.addPlugin(JD),await $.addPlugin(tR),await $.addPlugin(nR),await $.addPlugin(oA,!1),await $.addPlugin(my),await $.addPlugin(Fv),await $.addPlugin(Uv),await $.addPlugin(c1),await $.addPlugin(xw),await $.addPlugin(ww),await $.addPlugin(uy),await $.addPlugin(pm),await $.addPlugin(H2),await $.addPlugin(G2),await $.addPlugin(W2),await $.addPlugin(q2),await $.addPlugin(dA),await $.addPlugin(X2),await $.addPlugin(Q2);const nt=await $.addPlugin(new lR(!Pw()));return $.renderer.refreshPipeline(),$.scene.addEventListener("textureAdded",rt=>{rt.texture&&$.scene.setEnvironment(rt.texture)}),nt.setupPluginUi(iu),nt.setupPluginUi(dA),nt.setupPluginUi(X2),nt.setupPluginUi(Hw),nt.setupPluginUi(Q2),nt.setupPluginUi(tM),nt.setupPluginUi(Ol),nt.setupPluginUi(Z_),nt.setupPluginUi(xw),nt.setupPluginUi(c1),nt.setupPluginUi(H2),nt.setupPluginUi(ww),nt.setupPluginUi(Yl),nt.setupPluginUi(jo),i&&nt.setupPluginUi(um),nt.setupPluginUi(N1),nt.setupPluginUi(au),nt.setupPluginUi(uy),nt.setupPluginUi(Bx),nt.setupPluginUi(kE),nt.setupPluginUi(OE),nt.setupPluginUi(PE),nt.setupPluginUi(DE),nt.setupPluginUi(n0),nt.setupPluginUi(U1),nt.setupPluginUi(eS),nt.setupPluginUi(yw),nt.setupPluginUi(G2),nt.setupPluginUi(my),nt.setupPluginUi(Fv),nt.setupPluginUi(cp),nt.setupPluginUi(W2),nt.setupPluginUi(q2),nt.setupPluginUi(Cm),nt.setupPluginUi(up),s&&nt.setupPluginUi(K0),nt.setupPluginUi(pm),nt.setupPluginUi(dm),nt.setupPluginUi(bx),nt.setupPluginUi(fm),nt.setupPluginUi(y2),nt.setupPluginUi(Uv),nt.setupPluginUi(K_),nt.setupPluginUi(xx),nt.setupPluginUi(s0),nt.setupPluginUi(_d),nt.setupPluginUi(v0),nt.setupPluginUi(a0),nt.setupPluginUi(mm),nt.setupPluginUi(oA),$.enabled=!0,$}})();__webpackgi_exports__.LY2;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;var __webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;var __webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;var __webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;var __webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function _assertThisInitialized(j){if(j===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j}function _inheritsLoose(j,_){j.prototype=Object.create(_.prototype),j.prototype.constructor=j,j.__proto__=_}/*!
 * GSAP 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults$1={duration:.5,overwrite:!1,delay:0},_suppressOverwrites$1,_reverting$1,_context$2,_bigNum$1=1e8,_tinyNum=1/_bigNum$1,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString$1=function j(_){return typeof _=="string"},_isFunction$1=function j(_){return typeof _=="function"},_isNumber$1=function j(_){return typeof _=="number"},_isUndefined=function j(_){return typeof _>"u"},_isObject$1=function j(_){return typeof _=="object"},_isNotFalse=function j(_){return _!==!1},_windowExists$2=function j(){return typeof window<"u"},_isFuncOrString=function j(_){return _isFunction$1(_)||_isString$1(_)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline,_win$3,_coreInitted$2,_doc$3,_globals={},_installScope={},_coreReady,_install=function j(_){return(_installScope=_merge(_,_globals))&&gsap$2},_missingPlugin=function j(_,_e){return console.warn("Invalid property",_,"set to",_e,"Missing plugin? gsap.registerPlugin()")},_warn=function j(_,_e){return!_e&&console.warn(_)},_addGlobal=function j(_,_e){return _&&(_globals[_]=_e)&&_installScope&&(_installScope[_]=_e)||_globals},_emptyFunc=function j(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function j(_){var _e=_[0],d,it;if(_isObject$1(_e)||_isFunction$1(_e)||(_=[_]),!(d=(_e._gsap||{}).harness)){for(it=_harnessPlugins.length;it--&&!_harnessPlugins[it].targetTest(_e););d=_harnessPlugins[it]}for(it=_.length;it--;)_[it]&&(_[it]._gsap||(_[it]._gsap=new GSCache(_[it],d)))||_.splice(it,1);return _},_getCache=function j(_){return _._gsap||_harness(toArray(_))[0]._gsap},_getProperty=function j(_,_e,d){return(d=_[_e])&&_isFunction$1(d)?_[_e]():_isUndefined(d)&&_.getAttribute&&_.getAttribute(_e)||d},_forEachName=function j(_,_e){return(_=_.split(",")).forEach(_e)||_},_round$1=function j(_){return Math.round(_*1e5)/1e5||0},_roundPrecise=function j(_){return Math.round(_*1e7)/1e7||0},_parseRelative=function j(_,_e){var d=_e.charAt(0),it=parseFloat(_e.substr(2));return _=parseFloat(_),d==="+"?_+it:d==="-"?_-it:d==="*"?_*it:_/it},_arrayContainsAny=function j(_,_e){for(var d=_e.length,it=0;_.indexOf(_e[it])<0&&++it<d;);return it<d},_lazyRender=function j(){var _=_lazyTweens.length,_e=_lazyTweens.slice(0),d,it;for(_lazyLookup={},_lazyTweens.length=0,d=0;d<_;d++)it=_e[d],it&&it._lazy&&(it.render(it._lazy[0],it._lazy[1],!0)._lazy=0)},_lazySafeRender=function j(_,_e,d,it){_lazyTweens.length&&!_reverting$1&&_lazyRender(),_.render(_e,d,it||_reverting$1&&_e<0&&(_._initted||_._startAt)),_lazyTweens.length&&!_reverting$1&&_lazyRender()},_numericIfPossible=function j(_){var _e=parseFloat(_);return(_e||_e===0)&&(_+"").match(_delimitedValueExp).length<2?_e:_isString$1(_)?_.trim():_},_passThrough$1=function j(_){return _},_setDefaults$1=function j(_,_e){for(var d in _e)d in _||(_[d]=_e[d]);return _},_setKeyframeDefaults=function j(_){return function(_e,d){for(var it in d)it in _e||it==="duration"&&_||it==="ease"||(_e[it]=d[it])}},_merge=function j(_,_e){for(var d in _e)_[d]=_e[d];return _},_mergeDeep=function j(_,_e){for(var d in _e)d!=="__proto__"&&d!=="constructor"&&d!=="prototype"&&(_[d]=_isObject$1(_e[d])?j(_[d]||(_[d]={}),_e[d]):_e[d]);return _},_copyExcluding=function j(_,_e){var d={},it;for(it in _)it in _e||(d[it]=_[it]);return d},_inheritDefaults=function j(_){var _e=_.parent||_globalTimeline,d=_.keyframes?_setKeyframeDefaults(_isArray(_.keyframes)):_setDefaults$1;if(_isNotFalse(_.inherit))for(;_e;)d(_,_e.vars.defaults),_e=_e.parent||_e._dp;return _},_arraysMatch=function j(_,_e){for(var d=_.length,it=d===_e.length;it&&d--&&_[d]===_e[d];);return d<0},_addLinkedListItem=function j(_,_e,d,it,ct){d===void 0&&(d="_first"),it===void 0&&(it="_last");var pt=_[it],At;if(ct)for(At=_e[ct];pt&&pt[ct]>At;)pt=pt._prev;return pt?(_e._next=pt._next,pt._next=_e):(_e._next=_[d],_[d]=_e),_e._next?_e._next._prev=_e:_[it]=_e,_e._prev=pt,_e.parent=_e._dp=_,_e},_removeLinkedListItem=function j(_,_e,d,it){d===void 0&&(d="_first"),it===void 0&&(it="_last");var ct=_e._prev,pt=_e._next;ct?ct._next=pt:_[d]===_e&&(_[d]=pt),pt?pt._prev=ct:_[it]===_e&&(_[it]=ct),_e._next=_e._prev=_e.parent=null},_removeFromParent=function j(_,_e){_.parent&&(!_e||_.parent.autoRemoveChildren)&&_.parent.remove(_),_._act=0},_uncache=function j(_,_e){if(_&&(!_e||_e._end>_._dur||_e._start<0))for(var d=_;d;)d._dirty=1,d=d.parent;return _},_recacheAncestors=function j(_){for(var _e=_.parent;_e&&_e.parent;)_e._dirty=1,_e.totalDuration(),_e=_e.parent;return _},_rewindStartAt=function j(_,_e,d,it){return _._startAt&&(_reverting$1?_._startAt.revert(_revertConfigNoKill):_.vars.immediateRender&&!_.vars.autoRevert||_._startAt.render(_e,!0,it))},_hasNoPausedAncestors=function j(_){return!_||_._ts&&j(_.parent)},_elapsedCycleDuration=function j(_){return _._repeat?_animationCycle(_._tTime,_=_.duration()+_._rDelay)*_:0},_animationCycle=function j(_,_e){var d=Math.floor(_/=_e);return _&&d===_?d-1:d},_parentToChildTotalTime=function j(_,_e){return(_-_e._start)*_e._ts+(_e._ts>=0?0:_e._dirty?_e.totalDuration():_e._tDur)},_setEnd=function j(_){return _._end=_roundPrecise(_._start+(_._tDur/Math.abs(_._ts||_._rts||_tinyNum)||0))},_alignPlayhead=function j(_,_e){var d=_._dp;return d&&d.smoothChildTiming&&_._ts&&(_._start=_roundPrecise(d._time-(_._ts>0?_e/_._ts:((_._dirty?_.totalDuration():_._tDur)-_e)/-_._ts)),_setEnd(_),d._dirty||_uncache(d,_)),_},_postAddChecks=function j(_,_e){var d;if((_e._time||_e._initted&&!_e._dur)&&(d=_parentToChildTotalTime(_.rawTime(),_e),(!_e._dur||_clamp$1(0,_e.totalDuration(),d)-_e._tTime>_tinyNum)&&_e.render(d,!0)),_uncache(_,_e)._dp&&_._initted&&_._time>=_._dur&&_._ts){if(_._dur<_.duration())for(d=_;d._dp;)d.rawTime()>=0&&d.totalTime(d._tTime),d=d._dp;_._zTime=-_tinyNum}},_addToTimeline=function j(_,_e,d,it){return _e.parent&&_removeFromParent(_e),_e._start=_roundPrecise((_isNumber$1(d)?d:d||_!==_globalTimeline?_parsePosition$1(_,d,_e):_._time)+_e._delay),_e._end=_roundPrecise(_e._start+(_e.totalDuration()/Math.abs(_e.timeScale())||0)),_addLinkedListItem(_,_e,"_first","_last",_._sort?"_start":0),_isFromOrFromStart(_e)||(_._recent=_e),it||_postAddChecks(_,_e),_._ts<0&&_alignPlayhead(_,_._tTime),_},_scrollTrigger=function j(_,_e){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",_e))&&_globals.ScrollTrigger.create(_e,_)},_attemptInitTween=function j(_,_e,d,it,ct){if(_initTween(_,_e,ct),!_._initted)return 1;if(!d&&_._pt&&!_reverting$1&&(_._dur&&_.vars.lazy!==!1||!_._dur&&_.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(_),_._lazy=[ct,it],1},_parentPlayheadIsBeforeStart=function j(_){var _e=_.parent;return _e&&_e._ts&&_e._initted&&!_e._lock&&(_e.rawTime()<0||j(_e))},_isFromOrFromStart=function j(_){var _e=_.data;return _e==="isFromStart"||_e==="isStart"},_renderZeroDurationTween=function j(_,_e,d,it){var ct=_.ratio,pt=_e<0||!_e&&(!_._start&&_parentPlayheadIsBeforeStart(_)&&!(!_._initted&&_isFromOrFromStart(_))||(_._ts<0||_._dp._ts<0)&&!_isFromOrFromStart(_))?0:1,At=_._rDelay,St=0,Ot,Qt,Yt;if(At&&_._repeat&&(St=_clamp$1(0,_._tDur,_e),Qt=_animationCycle(St,At),_._yoyo&&Qt&1&&(pt=1-pt),Qt!==_animationCycle(_._tTime,At)&&(ct=1-pt,_.vars.repeatRefresh&&_._initted&&_.invalidate())),pt!==ct||_reverting$1||it||_._zTime===_tinyNum||!_e&&_._zTime){if(!_._initted&&_attemptInitTween(_,_e,it,d,St))return;for(Yt=_._zTime,_._zTime=_e||(d?_tinyNum:0),d||(d=_e&&!Yt),_.ratio=pt,_._from&&(pt=1-pt),_._time=0,_._tTime=St,Ot=_._pt;Ot;)Ot.r(pt,Ot.d),Ot=Ot._next;_e<0&&_rewindStartAt(_,_e,d,!0),_._onUpdate&&!d&&_callback$1(_,"onUpdate"),St&&_._repeat&&!d&&_.parent&&_callback$1(_,"onRepeat"),(_e>=_._tDur||_e<0)&&_.ratio===pt&&(pt&&_removeFromParent(_,1),!d&&!_reverting$1&&(_callback$1(_,pt?"onComplete":"onReverseComplete",!0),_._prom&&_._prom()))}else _._zTime||(_._zTime=_e)},_findNextPauseTween=function j(_,_e,d){var it;if(d>_e)for(it=_._first;it&&it._start<=d;){if(it.data==="isPause"&&it._start>_e)return it;it=it._next}else for(it=_._last;it&&it._start>=d;){if(it.data==="isPause"&&it._start<_e)return it;it=it._prev}},_setDuration=function j(_,_e,d,it){var ct=_._repeat,pt=_roundPrecise(_e)||0,At=_._tTime/_._tDur;return At&&!it&&(_._time*=pt/_._dur),_._dur=pt,_._tDur=ct?ct<0?1e10:_roundPrecise(pt*(ct+1)+_._rDelay*ct):pt,At>0&&!it&&_alignPlayhead(_,_._tTime=_._tDur*At),_.parent&&_setEnd(_),d||_uncache(_.parent,_),_},_onUpdateTotalDuration=function j(_){return _ instanceof Timeline?_uncache(_):_setDuration(_,_._dur)},_zeroPosition={_start:0,endTime:_emptyFunc,totalDuration:_emptyFunc},_parsePosition$1=function j(_,_e,d){var it=_.labels,ct=_._recent||_zeroPosition,pt=_.duration()>=_bigNum$1?ct.endTime(!1):_._dur,At,St,Ot;return _isString$1(_e)&&(isNaN(_e)||_e in it)?(St=_e.charAt(0),Ot=_e.substr(-1)==="%",At=_e.indexOf("="),St==="<"||St===">"?(At>=0&&(_e=_e.replace(/=/,"")),(St==="<"?ct._start:ct.endTime(ct._repeat>=0))+(parseFloat(_e.substr(1))||0)*(Ot?(At<0?ct:d).totalDuration()/100:1)):At<0?(_e in it||(it[_e]=pt),it[_e]):(St=parseFloat(_e.charAt(At-1)+_e.substr(At+1)),Ot&&d&&(St=St/100*(_isArray(d)?d[0]:d).totalDuration()),At>1?j(_,_e.substr(0,At-1),d)+St:pt+St)):_e==null?pt:+_e},_createTweenType=function j(_,_e,d){var it=_isNumber$1(_e[1]),ct=(it?2:1)+(_<2?0:1),pt=_e[ct],At,St;if(it&&(pt.duration=_e[1]),pt.parent=d,_){for(At=pt,St=d;St&&!("immediateRender"in At);)At=St.vars.defaults||{},St=_isNotFalse(St.vars.inherit)&&St.parent;pt.immediateRender=_isNotFalse(At.immediateRender),_<2?pt.runBackwards=1:pt.startAt=_e[ct-1]}return new Tween(_e[0],pt,_e[ct+1])},_conditionalReturn=function j(_,_e){return _||_===0?_e(_):_e},_clamp$1=function j(_,_e,d){return d<_?_:d>_e?_e:d},getUnit=function j(_,_e){return!_isString$1(_)||!(_e=_unitExp.exec(_))?"":_e[1]},clamp=function j(_,_e,d){return _conditionalReturn(d,function(it){return _clamp$1(_,_e,it)})},_slice=[].slice,_isArrayLike=function j(_,_e){return _&&_isObject$1(_)&&"length"in _&&(!_e&&!_.length||_.length-1 in _&&_isObject$1(_[0]))&&!_.nodeType&&_!==_win$3},_flatten=function j(_,_e,d){return d===void 0&&(d=[]),_.forEach(function(it){var ct;return _isString$1(it)&&!_e||_isArrayLike(it,1)?(ct=d).push.apply(ct,toArray(it)):d.push(it)})||d},toArray=function j(_,_e,d){return _context$2&&!_e&&_context$2.selector?_context$2.selector(_):_isString$1(_)&&!d&&(_coreInitted$2||!_wake())?_slice.call((_e||_doc$3).querySelectorAll(_),0):_isArray(_)?_flatten(_,d):_isArrayLike(_)?_slice.call(_,0):_?[_]:[]},selector=function j(_){return _=toArray(_)[0]||_warn("Invalid scope")||{},function(_e){var d=_.current||_.nativeElement||_;return toArray(_e,d.querySelectorAll?d:d===_?_warn("Invalid scope")||_doc$3.createElement("div"):_)}},shuffle=function j(_){return _.sort(function(){return .5-Math.random()})},distribute=function j(_){if(_isFunction$1(_))return _;var _e=_isObject$1(_)?_:{each:_},d=_parseEase(_e.ease),it=_e.from||0,ct=parseFloat(_e.base)||0,pt={},At=it>0&&it<1,St=isNaN(it)||At,Ot=_e.axis,Qt=it,Yt=it;return _isString$1(it)?Qt=Yt={center:.5,edges:.5,end:1}[it]||0:!At&&St&&(Qt=it[0],Yt=it[1]),function(Vt,qt,Jt){var jt=(Jt||_e).length,sn=pt[jt],Ft,Ut,Ht,an,nn,dn,zt,Wt,Zt;if(!sn){if(Zt=_e.grid==="auto"?0:(_e.grid||[1,_bigNum$1])[1],!Zt){for(zt=-_bigNum$1;zt<(zt=Jt[Zt++].getBoundingClientRect().left)&&Zt<jt;);Zt--}for(sn=pt[jt]=[],Ft=St?Math.min(Zt,jt)*Qt-.5:it%Zt,Ut=Zt===_bigNum$1?0:St?jt*Yt/Zt-.5:it/Zt|0,zt=0,Wt=_bigNum$1,dn=0;dn<jt;dn++)Ht=dn%Zt-Ft,an=Ut-(dn/Zt|0),sn[dn]=nn=Ot?Math.abs(Ot==="y"?an:Ht):_sqrt(Ht*Ht+an*an),nn>zt&&(zt=nn),nn<Wt&&(Wt=nn);it==="random"&&shuffle(sn),sn.max=zt-Wt,sn.min=Wt,sn.v=jt=(parseFloat(_e.amount)||parseFloat(_e.each)*(Zt>jt?jt-1:Ot?Ot==="y"?jt/Zt:Zt:Math.max(Zt,jt/Zt))||0)*(it==="edges"?-1:1),sn.b=jt<0?ct-jt:ct,sn.u=getUnit(_e.amount||_e.each)||0,d=d&&jt<0?_invertEase(d):d}return jt=(sn[Vt]-sn.min)/sn.max||0,_roundPrecise(sn.b+(d?d(jt):jt)*sn.v)+sn.u}},_roundModifier=function j(_){var _e=Math.pow(10,((_+"").split(".")[1]||"").length);return function(d){var it=_roundPrecise(Math.round(parseFloat(d)/_)*_*_e);return(it-it%1)/_e+(_isNumber$1(d)?0:getUnit(d))}},snap=function j(_,_e){var d=_isArray(_),it,ct;return!d&&_isObject$1(_)&&(it=d=_.radius||_bigNum$1,_.values?(_=toArray(_.values),(ct=!_isNumber$1(_[0]))&&(it*=it)):_=_roundModifier(_.increment)),_conditionalReturn(_e,d?_isFunction$1(_)?function(pt){return ct=_(pt),Math.abs(ct-pt)<=it?ct:pt}:function(pt){for(var At=parseFloat(ct?pt.x:pt),St=parseFloat(ct?pt.y:0),Ot=_bigNum$1,Qt=0,Yt=_.length,Vt,qt;Yt--;)ct?(Vt=_[Yt].x-At,qt=_[Yt].y-St,Vt=Vt*Vt+qt*qt):Vt=Math.abs(_[Yt]-At),Vt<Ot&&(Ot=Vt,Qt=Yt);return Qt=!it||Ot<=it?_[Qt]:pt,ct||Qt===pt||_isNumber$1(pt)?Qt:Qt+getUnit(pt)}:_roundModifier(_))},random=function j(_,_e,d,it){return _conditionalReturn(_isArray(_)?!_e:d===!0?!!(d=0):!it,function(){return _isArray(_)?_[~~(Math.random()*_.length)]:(d=d||1e-5)&&(it=d<1?Math.pow(10,(d+"").length-2):1)&&Math.floor(Math.round((_-d/2+Math.random()*(_e-_+d*.99))/d)*d*it)/it})},pipe=function j(){for(var _=arguments.length,_e=new Array(_),d=0;d<_;d++)_e[d]=arguments[d];return function(it){return _e.reduce(function(ct,pt){return pt(ct)},it)}},unitize=function j(_,_e){return function(d){return _(parseFloat(d))+(_e||getUnit(d))}},normalize=function j(_,_e,d){return mapRange(_,_e,0,1,d)},_wrapArray=function j(_,_e,d){return _conditionalReturn(d,function(it){return _[~~_e(it)]})},wrap=function j(_,_e,d){var it=_e-_;return _isArray(_)?_wrapArray(_,j(0,_.length),_e):_conditionalReturn(d,function(ct){return(it+(ct-_)%it)%it+_})},wrapYoyo=function j(_,_e,d){var it=_e-_,ct=it*2;return _isArray(_)?_wrapArray(_,j(0,_.length-1),_e):_conditionalReturn(d,function(pt){return pt=(ct+(pt-_)%ct)%ct||0,_+(pt>it?ct-pt:pt)})},_replaceRandom=function j(_){for(var _e=0,d="",it,ct,pt,At;~(it=_.indexOf("random(",_e));)pt=_.indexOf(")",it),At=_.charAt(it+7)==="[",ct=_.substr(it+7,pt-it-7).match(At?_delimitedValueExp:_strictNumExp),d+=_.substr(_e,it-_e)+random(At?ct:+ct[0],At?0:+ct[1],+ct[2]||1e-5),_e=pt+1;return d+_.substr(_e,_.length-_e)},mapRange=function j(_,_e,d,it,ct){var pt=_e-_,At=it-d;return _conditionalReturn(ct,function(St){return d+((St-_)/pt*At||0)})},interpolate=function j(_,_e,d,it){var ct=isNaN(_+_e)?0:function(qt){return(1-qt)*_+qt*_e};if(!ct){var pt=_isString$1(_),At={},St,Ot,Qt,Yt,Vt;if(d===!0&&(it=1)&&(d=null),pt)_={p:_},_e={p:_e};else if(_isArray(_)&&!_isArray(_e)){for(Qt=[],Yt=_.length,Vt=Yt-2,Ot=1;Ot<Yt;Ot++)Qt.push(j(_[Ot-1],_[Ot]));Yt--,ct=function(Jt){Jt*=Yt;var jt=Math.min(Vt,~~Jt);return Qt[jt](Jt-jt)},d=_e}else it||(_=_merge(_isArray(_)?[]:{},_));if(!Qt){for(St in _e)_addPropTween.call(At,_,St,"get",_e[St]);ct=function(Jt){return _renderPropTweens(Jt,At)||(pt?_.p:_)}}}return _conditionalReturn(d,ct)},_getLabelInDirection=function j(_,_e,d){var it=_.labels,ct=_bigNum$1,pt,At,St;for(pt in it)At=it[pt]-_e,At<0==!!d&&At&&ct>(At=Math.abs(At))&&(St=pt,ct=At);return St},_callback$1=function j(_,_e,d){var it=_.vars,ct=it[_e],pt=_context$2,At=_._ctx,St,Ot,Qt;if(ct)return St=it[_e+"Params"],Ot=it.callbackScope||_,d&&_lazyTweens.length&&_lazyRender(),At&&(_context$2=At),Qt=St?ct.apply(Ot,St):ct.call(Ot),_context$2=pt,Qt},_interrupt=function j(_){return _removeFromParent(_),_.scrollTrigger&&_.scrollTrigger.kill(!!_reverting$1),_.progress()<1&&_callback$1(_,"onInterrupt"),_},_quickTween,_createPlugin=function j(_){_=!_.name&&_.default||_;var _e=_.name,d=_isFunction$1(_),it=_e&&!d&&_.init?function(){this._props=[]}:_,ct={init:_emptyFunc,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},pt={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),_!==it){if(_plugins[_e])return;_setDefaults$1(it,_setDefaults$1(_copyExcluding(_,ct),pt)),_merge(it.prototype,_merge(ct,_copyExcluding(_,pt))),_plugins[it.prop=_e]=it,_.targetTest&&(_harnessPlugins.push(it),_reservedProps[_e]=1),_e=(_e==="css"?"CSS":_e.charAt(0).toUpperCase()+_e.substr(1))+"Plugin"}_addGlobal(_e,it),_.register&&_.register(gsap$2,it,PropTween)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function j(_,_e,d){return _+=_<0?1:_>1?-1:0,(_*6<1?_e+(d-_e)*_*6:_<.5?d:_*3<2?_e+(d-_e)*(2/3-_)*6:_e)*_255+.5|0},splitColor=function j(_,_e,d){var it=_?_isNumber$1(_)?[_>>16,_>>8&_255,_&_255]:0:_colorLookup.black,ct,pt,At,St,Ot,Qt,Yt,Vt,qt,Jt;if(!it){if(_.substr(-1)===","&&(_=_.substr(0,_.length-1)),_colorLookup[_])it=_colorLookup[_];else if(_.charAt(0)==="#"){if(_.length<6&&(ct=_.charAt(1),pt=_.charAt(2),At=_.charAt(3),_="#"+ct+ct+pt+pt+At+At+(_.length===5?_.charAt(4)+_.charAt(4):"")),_.length===9)return it=parseInt(_.substr(1,6),16),[it>>16,it>>8&_255,it&_255,parseInt(_.substr(7),16)/255];_=parseInt(_.substr(1),16),it=[_>>16,_>>8&_255,_&_255]}else if(_.substr(0,3)==="hsl"){if(it=Jt=_.match(_strictNumExp),!_e)St=+it[0]%360/360,Ot=+it[1]/100,Qt=+it[2]/100,pt=Qt<=.5?Qt*(Ot+1):Qt+Ot-Qt*Ot,ct=Qt*2-pt,it.length>3&&(it[3]*=1),it[0]=_hue(St+1/3,ct,pt),it[1]=_hue(St,ct,pt),it[2]=_hue(St-1/3,ct,pt);else if(~_.indexOf("="))return it=_.match(_numExp),d&&it.length<4&&(it[3]=1),it}else it=_.match(_strictNumExp)||_colorLookup.transparent;it=it.map(Number)}return _e&&!Jt&&(ct=it[0]/_255,pt=it[1]/_255,At=it[2]/_255,Yt=Math.max(ct,pt,At),Vt=Math.min(ct,pt,At),Qt=(Yt+Vt)/2,Yt===Vt?St=Ot=0:(qt=Yt-Vt,Ot=Qt>.5?qt/(2-Yt-Vt):qt/(Yt+Vt),St=Yt===ct?(pt-At)/qt+(pt<At?6:0):Yt===pt?(At-ct)/qt+2:(ct-pt)/qt+4,St*=60),it[0]=~~(St+.5),it[1]=~~(Ot*100+.5),it[2]=~~(Qt*100+.5)),d&&it.length<4&&(it[3]=1),it},_colorOrderData=function j(_){var _e=[],d=[],it=-1;return _.split(_colorExp).forEach(function(ct){var pt=ct.match(_numWithUnitExp)||[];_e.push.apply(_e,pt),d.push(it+=pt.length+1)}),_e.c=d,_e},_formatColors=function j(_,_e,d){var it="",ct=(_+it).match(_colorExp),pt=_e?"hsla(":"rgba(",At=0,St,Ot,Qt,Yt;if(!ct)return _;if(ct=ct.map(function(Vt){return(Vt=splitColor(Vt,_e,1))&&pt+(_e?Vt[0]+","+Vt[1]+"%,"+Vt[2]+"%,"+Vt[3]:Vt.join(","))+")"}),d&&(Qt=_colorOrderData(_),St=d.c,St.join(it)!==Qt.c.join(it)))for(Ot=_.replace(_colorExp,"1").split(_numWithUnitExp),Yt=Ot.length-1;At<Yt;At++)it+=Ot[At]+(~St.indexOf(At)?ct.shift()||pt+"0,0,0,0)":(Qt.length?Qt:ct.length?ct:d).shift());if(!Ot)for(Ot=_.split(_colorExp),Yt=Ot.length-1;At<Yt;At++)it+=Ot[At]+ct[At];return it+Ot[Yt]},_colorExp=function(){var j="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",_;for(_ in _colorLookup)j+="|"+_+"\\b";return new RegExp(j+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function j(_){var _e=_.join(" "),d;if(_colorExp.lastIndex=0,_colorExp.test(_e))return d=_hslExp.test(_e),_[1]=_formatColors(_[1],d),_[0]=_formatColors(_[0],d,_colorOrderData(_[1])),!0},_tickerActive,_ticker=function(){var j=Date.now,_=500,_e=33,d=j(),it=d,ct=1e3/240,pt=ct,At=[],St,Ot,Qt,Yt,Vt,qt,Jt=function jt(sn){var Ft=j()-it,Ut=sn===!0,Ht,an,nn,dn;if(Ft>_&&(d+=Ft-_e),it+=Ft,nn=it-d,Ht=nn-pt,(Ht>0||Ut)&&(dn=++Yt.frame,Vt=nn-Yt.time*1e3,Yt.time=nn=nn/1e3,pt+=Ht+(Ht>=ct?4:ct-Ht),an=1),Ut||(St=Ot(jt)),an)for(qt=0;qt<At.length;qt++)At[qt](nn,Vt,dn,sn)};return Yt={time:0,frame:0,tick:function(){Jt(!0)},deltaRatio:function(sn){return Vt/(1e3/(sn||60))},wake:function(){_coreReady&&(!_coreInitted$2&&_windowExists$2()&&(_win$3=_coreInitted$2=window,_doc$3=_win$3.document||{},_globals.gsap=gsap$2,(_win$3.gsapVersions||(_win$3.gsapVersions=[])).push(gsap$2.version),_install(_installScope||_win$3.GreenSockGlobals||!_win$3.gsap&&_win$3||{}),Qt=_win$3.requestAnimationFrame),St&&Yt.sleep(),Ot=Qt||function(sn){return setTimeout(sn,pt-Yt.time*1e3+1|0)},_tickerActive=1,Jt(2))},sleep:function(){(Qt?_win$3.cancelAnimationFrame:clearTimeout)(St),_tickerActive=0,Ot=_emptyFunc},lagSmoothing:function(sn,Ft){_=sn||1/0,_e=Math.min(Ft||33,_)},fps:function(sn){ct=1e3/(sn||240),pt=Yt.time*1e3+ct},add:function(sn,Ft,Ut){var Ht=Ft?function(an,nn,dn,zt){sn(an,nn,dn,zt),Yt.remove(Ht)}:sn;return Yt.remove(sn),At[Ut?"unshift":"push"](Ht),_wake(),Ht},remove:function(sn,Ft){~(Ft=At.indexOf(sn))&&At.splice(Ft,1)&&qt>=Ft&&qt--},_listeners:At},Yt}(),_wake=function j(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function j(_){for(var _e={},d=_.substr(1,_.length-3).split(":"),it=d[0],ct=1,pt=d.length,At,St,Ot;ct<pt;ct++)St=d[ct],At=ct!==pt-1?St.lastIndexOf(","):St.length,Ot=St.substr(0,At),_e[it]=isNaN(Ot)?Ot.replace(_quotesExp,"").trim():+Ot,it=St.substr(At+1).trim();return _e},_valueInParentheses=function j(_){var _e=_.indexOf("(")+1,d=_.indexOf(")"),it=_.indexOf("(",_e);return _.substring(_e,~it&&it<d?_.indexOf(")",d+1):d)},_configEaseFromString=function j(_){var _e=(_+"").split("("),d=_easeMap[_e[0]];return d&&_e.length>1&&d.config?d.config.apply(null,~_.indexOf("{")?[_parseObjectInString(_e[1])]:_valueInParentheses(_).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(_)?_easeMap._CE("",_):d},_invertEase=function j(_){return function(_e){return 1-_(1-_e)}},_propagateYoyoEase=function j(_,_e){for(var d=_._first,it;d;)d instanceof Timeline?j(d,_e):d.vars.yoyoEase&&(!d._yoyo||!d._repeat)&&d._yoyo!==_e&&(d.timeline?j(d.timeline,_e):(it=d._ease,d._ease=d._yEase,d._yEase=it,d._yoyo=_e)),d=d._next},_parseEase=function j(_,_e){return _&&(_isFunction$1(_)?_:_easeMap[_]||_configEaseFromString(_))||_e},_insertEase=function j(_,_e,d,it){d===void 0&&(d=function(St){return 1-_e(1-St)}),it===void 0&&(it=function(St){return St<.5?_e(St*2)/2:1-_e((1-St)*2)/2});var ct={easeIn:_e,easeOut:d,easeInOut:it},pt;return _forEachName(_,function(At){_easeMap[At]=_globals[At]=ct,_easeMap[pt=At.toLowerCase()]=d;for(var St in ct)_easeMap[pt+(St==="easeIn"?".in":St==="easeOut"?".out":".inOut")]=_easeMap[At+"."+St]=ct[St]}),ct},_easeInOutFromOut=function j(_){return function(_e){return _e<.5?(1-_(1-_e*2))/2:.5+_((_e-.5)*2)/2}},_configElastic=function j(_,_e,d){var it=_e>=1?_e:1,ct=(d||(_?.3:.45))/(_e<1?_e:1),pt=ct/_2PI*(Math.asin(1/it)||0),At=function(Qt){return Qt===1?1:it*Math.pow(2,-10*Qt)*_sin((Qt-pt)*ct)+1},St=_==="out"?At:_==="in"?function(Ot){return 1-At(1-Ot)}:_easeInOutFromOut(At);return ct=_2PI/ct,St.config=function(Ot,Qt){return j(_,Ot,Qt)},St},_configBack=function j(_,_e){_e===void 0&&(_e=1.70158);var d=function(pt){return pt?--pt*pt*((_e+1)*pt+_e)+1:0},it=_==="out"?d:_==="in"?function(ct){return 1-d(1-ct)}:_easeInOutFromOut(d);return it.config=function(ct){return j(_,ct)},it};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function(j,_){var _e=_<5?_+1:_;_insertEase(j+",Power"+(_e-1),_?function(d){return Math.pow(d,_e)}:function(d){return d},function(d){return 1-Math.pow(1-d,_e)},function(d){return d<.5?Math.pow(d*2,_e)/2:1-Math.pow((1-d)*2,_e)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function(j,_){var _e=1/_,d=2*_e,it=2.5*_e,ct=function(At){return At<_e?j*At*At:At<d?j*Math.pow(At-1.5/_,2)+.75:At<it?j*(At-=2.25/_)*At+.9375:j*Math.pow(At-2.625/_,2)+.984375};_insertEase("Bounce",function(pt){return 1-ct(1-pt)},ct)})(7.5625,2.75);_insertEase("Expo",function(j){return j?Math.pow(2,10*(j-1)):0});_insertEase("Circ",function(j){return-(_sqrt(1-j*j)-1)});_insertEase("Sine",function(j){return j===1?1:-_cos(j*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function j(_,_e){_===void 0&&(_=1);var d=1/_,it=_+(_e?0:1),ct=_e?1:0,pt=1-_tinyNum;return function(At){return((it*_clamp$1(0,pt,At)|0)+ct)*d}}};_defaults$1.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(j){return _callbackNames+=j+","+j+"Params,"});var GSCache=function j(_,_e){this.id=_gsID++,_._gsap=this,this.target=_,this.harness=_e,this.get=_e?_e.get:_getProperty,this.set=_e?_e.getSetter:_getSetter},Animation=function(){function j(_e){this.vars=_e,this._delay=+_e.delay||0,(this._repeat=_e.repeat===1/0?-2:_e.repeat||0)&&(this._rDelay=_e.repeatDelay||0,this._yoyo=!!_e.yoyo||!!_e.yoyoEase),this._ts=1,_setDuration(this,+_e.duration,1,1),this.data=_e.data,_context$2&&(this._ctx=_context$2,_context$2.data.push(this)),_tickerActive||_ticker.wake()}var _=j.prototype;return _.delay=function(d){return d||d===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+d-this._delay),this._delay=d,this):this._delay},_.duration=function(d){return arguments.length?this.totalDuration(this._repeat>0?d+(d+this._rDelay)*this._repeat:d):this.totalDuration()&&this._dur},_.totalDuration=function(d){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?d:(d-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},_.totalTime=function(d,it){if(_wake(),!arguments.length)return this._tTime;var ct=this._dp;if(ct&&ct.smoothChildTiming&&this._ts){for(_alignPlayhead(this,d),!ct._dp||ct.parent||_postAddChecks(ct,this);ct&&ct.parent;)ct.parent._time!==ct._start+(ct._ts>=0?ct._tTime/ct._ts:(ct.totalDuration()-ct._tTime)/-ct._ts)&&ct.totalTime(ct._tTime,!0),ct=ct.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&d<this._tDur||this._ts<0&&d>0||!this._tDur&&!d)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==d||!this._dur&&!it||this._initted&&Math.abs(this._zTime)===_tinyNum||!d&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=d),_lazySafeRender(this,d,it)),this},_.time=function(d,it){return arguments.length?this.totalTime(Math.min(this.totalDuration(),d+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(d?this._dur:0),it):this._time},_.totalProgress=function(d,it){return arguments.length?this.totalTime(this.totalDuration()*d,it):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},_.progress=function(d,it){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-d:d)+_elapsedCycleDuration(this),it):this.duration()?Math.min(1,this._time/this._dur):this.ratio},_.iteration=function(d,it){var ct=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(d-1)*ct,it):this._repeat?_animationCycle(this._tTime,ct)+1:1},_.timeScale=function(d){if(!arguments.length)return this._rts===-_tinyNum?0:this._rts;if(this._rts===d)return this;var it=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+d||0,this._ts=this._ps||d===-_tinyNum?0:this._rts,this.totalTime(_clamp$1(-this._delay,this._tDur,it),!0),_setEnd(this),_recacheAncestors(this)},_.paused=function(d){return arguments.length?(this._ps!==d&&(this._ps=d,d?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},_.startTime=function(d){if(arguments.length){this._start=d;var it=this.parent||this._dp;return it&&(it._sort||!this.parent)&&_addToTimeline(it,this,d-this._delay),this}return this._start},_.endTime=function(d){return this._start+(_isNotFalse(d)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},_.rawTime=function(d){var it=this.parent||this._dp;return it?d&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(it.rawTime(d),this):this._tTime:this._tTime},_.revert=function(d){d===void 0&&(d=_revertConfig);var it=_reverting$1;return _reverting$1=d,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(d),this.totalTime(-.01,d.suppressEvents)),this.data!=="nested"&&d.kill!==!1&&this.kill(),_reverting$1=it,this},_.globalTime=function(d){for(var it=this,ct=arguments.length?d:it.rawTime();it;)ct=it._start+ct/(it._ts||1),it=it._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(d):ct},_.repeat=function(d){return arguments.length?(this._repeat=d===1/0?-2:d,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},_.repeatDelay=function(d){if(arguments.length){var it=this._time;return this._rDelay=d,_onUpdateTotalDuration(this),it?this.time(it):this}return this._rDelay},_.yoyo=function(d){return arguments.length?(this._yoyo=d,this):this._yoyo},_.seek=function(d,it){return this.totalTime(_parsePosition$1(this,d),_isNotFalse(it))},_.restart=function(d,it){return this.play().totalTime(d?-this._delay:0,_isNotFalse(it))},_.play=function(d,it){return d!=null&&this.seek(d,it),this.reversed(!1).paused(!1)},_.reverse=function(d,it){return d!=null&&this.seek(d||this.totalDuration(),it),this.reversed(!0).paused(!1)},_.pause=function(d,it){return d!=null&&this.seek(d,it),this.paused(!0)},_.resume=function(){return this.paused(!1)},_.reversed=function(d){return arguments.length?(!!d!==this.reversed()&&this.timeScale(-this._rts||(d?-_tinyNum:0)),this):this._rts<0},_.invalidate=function(){return this._initted=this._act=0,this._zTime=-_tinyNum,this},_.isActive=function(){var d=this.parent||this._dp,it=this._start,ct;return!!(!d||this._ts&&this._initted&&d.isActive()&&(ct=d.rawTime(!0))>=it&&ct<this.endTime(!0)-_tinyNum)},_.eventCallback=function(d,it,ct){var pt=this.vars;return arguments.length>1?(it?(pt[d]=it,ct&&(pt[d+"Params"]=ct),d==="onUpdate"&&(this._onUpdate=it)):delete pt[d],this):pt[d]},_.then=function(d){var it=this;return new Promise(function(ct){var pt=_isFunction$1(d)?d:_passThrough$1,At=function(){var Ot=it.then;it.then=null,_isFunction$1(pt)&&(pt=pt(it))&&(pt.then||pt===it)&&(it.then=Ot),ct(pt),it.then=Ot};it._initted&&it.totalProgress()===1&&it._ts>=0||!it._tTime&&it._ts<0?At():it._prom=At})},_.kill=function(){_interrupt(this)},j}();_setDefaults$1(Animation.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_tinyNum,_prom:0,_ps:!1,_rts:1});var Timeline=function(j){_inheritsLoose(_,j);function _(d,it){var ct;return d===void 0&&(d={}),ct=j.call(this,d)||this,ct.labels={},ct.smoothChildTiming=!!d.smoothChildTiming,ct.autoRemoveChildren=!!d.autoRemoveChildren,ct._sort=_isNotFalse(d.sortChildren),_globalTimeline&&_addToTimeline(d.parent||_globalTimeline,_assertThisInitialized(ct),it),d.reversed&&ct.reverse(),d.paused&&ct.paused(!0),d.scrollTrigger&&_scrollTrigger(_assertThisInitialized(ct),d.scrollTrigger),ct}var _e=_.prototype;return _e.to=function(it,ct,pt){return _createTweenType(0,arguments,this),this},_e.from=function(it,ct,pt){return _createTweenType(1,arguments,this),this},_e.fromTo=function(it,ct,pt,At){return _createTweenType(2,arguments,this),this},_e.set=function(it,ct,pt){return ct.duration=0,ct.parent=this,_inheritDefaults(ct).repeatDelay||(ct.repeat=0),ct.immediateRender=!!ct.immediateRender,new Tween(it,ct,_parsePosition$1(this,pt),1),this},_e.call=function(it,ct,pt){return _addToTimeline(this,Tween.delayedCall(0,it,ct),pt)},_e.staggerTo=function(it,ct,pt,At,St,Ot,Qt){return pt.duration=ct,pt.stagger=pt.stagger||At,pt.onComplete=Ot,pt.onCompleteParams=Qt,pt.parent=this,new Tween(it,pt,_parsePosition$1(this,St)),this},_e.staggerFrom=function(it,ct,pt,At,St,Ot,Qt){return pt.runBackwards=1,_inheritDefaults(pt).immediateRender=_isNotFalse(pt.immediateRender),this.staggerTo(it,ct,pt,At,St,Ot,Qt)},_e.staggerFromTo=function(it,ct,pt,At,St,Ot,Qt,Yt){return At.startAt=pt,_inheritDefaults(At).immediateRender=_isNotFalse(At.immediateRender),this.staggerTo(it,ct,At,St,Ot,Qt,Yt)},_e.render=function(it,ct,pt){var At=this._time,St=this._dirty?this.totalDuration():this._tDur,Ot=this._dur,Qt=it<=0?0:_roundPrecise(it),Yt=this._zTime<0!=it<0&&(this._initted||!Ot),Vt,qt,Jt,jt,sn,Ft,Ut,Ht,an,nn,dn,zt;if(this!==_globalTimeline&&Qt>St&&it>=0&&(Qt=St),Qt!==this._tTime||pt||Yt){if(At!==this._time&&Ot&&(Qt+=this._time-At,it+=this._time-At),Vt=Qt,an=this._start,Ht=this._ts,Ft=!Ht,Yt&&(Ot||(At=this._zTime),(it||!ct)&&(this._zTime=it)),this._repeat){if(dn=this._yoyo,sn=Ot+this._rDelay,this._repeat<-1&&it<0)return this.totalTime(sn*100+it,ct,pt);if(Vt=_roundPrecise(Qt%sn),Qt===St?(jt=this._repeat,Vt=Ot):(jt=~~(Qt/sn),jt&&jt===Qt/sn&&(Vt=Ot,jt--),Vt>Ot&&(Vt=Ot)),nn=_animationCycle(this._tTime,sn),!At&&this._tTime&&nn!==jt&&(nn=jt),dn&&jt&1&&(Vt=Ot-Vt,zt=1),jt!==nn&&!this._lock){var Wt=dn&&nn&1,Zt=Wt===(dn&&jt&1);if(jt<nn&&(Wt=!Wt),At=Wt?0:Ot,this._lock=1,this.render(At||(zt?0:_roundPrecise(jt*sn)),ct,!Ot)._lock=0,this._tTime=Qt,!ct&&this.parent&&_callback$1(this,"onRepeat"),this.vars.repeatRefresh&&!zt&&(this.invalidate()._lock=1),At&&At!==this._time||Ft!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(Ot=this._dur,St=this._tDur,Zt&&(this._lock=2,At=Wt?Ot:-1e-4,this.render(At,!0),this.vars.repeatRefresh&&!zt&&this.invalidate()),this._lock=0,!this._ts&&!Ft)return this;_propagateYoyoEase(this,zt)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Ut=_findNextPauseTween(this,_roundPrecise(At),_roundPrecise(Vt)),Ut&&(Qt-=Vt-(Vt=Ut._start))),this._tTime=Qt,this._time=Vt,this._act=!Ht,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=it,At=0),!At&&Vt&&!ct&&(_callback$1(this,"onStart"),this._tTime!==Qt))return this;if(Vt>=At&&it>=0)for(qt=this._first;qt;){if(Jt=qt._next,(qt._act||Vt>=qt._start)&&qt._ts&&Ut!==qt){if(qt.parent!==this)return this.render(it,ct,pt);if(qt.render(qt._ts>0?(Vt-qt._start)*qt._ts:(qt._dirty?qt.totalDuration():qt._tDur)+(Vt-qt._start)*qt._ts,ct,pt),Vt!==this._time||!this._ts&&!Ft){Ut=0,Jt&&(Qt+=this._zTime=-_tinyNum);break}}qt=Jt}else{qt=this._last;for(var mn=it<0?it:Vt;qt;){if(Jt=qt._prev,(qt._act||mn<=qt._end)&&qt._ts&&Ut!==qt){if(qt.parent!==this)return this.render(it,ct,pt);if(qt.render(qt._ts>0?(mn-qt._start)*qt._ts:(qt._dirty?qt.totalDuration():qt._tDur)+(mn-qt._start)*qt._ts,ct,pt||_reverting$1&&(qt._initted||qt._startAt)),Vt!==this._time||!this._ts&&!Ft){Ut=0,Jt&&(Qt+=this._zTime=mn?-_tinyNum:_tinyNum);break}}qt=Jt}}if(Ut&&!ct&&(this.pause(),Ut.render(Vt>=At?0:-_tinyNum)._zTime=Vt>=At?1:-1,this._ts))return this._start=an,_setEnd(this),this.render(it,ct,pt);this._onUpdate&&!ct&&_callback$1(this,"onUpdate",!0),(Qt===St&&this._tTime>=this.totalDuration()||!Qt&&At)&&(an===this._start||Math.abs(Ht)!==Math.abs(this._ts))&&(this._lock||((it||!Ot)&&(Qt===St&&this._ts>0||!Qt&&this._ts<0)&&_removeFromParent(this,1),!ct&&!(it<0&&!At)&&(Qt||At||!St)&&(_callback$1(this,Qt===St&&it>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(Qt<St&&this.timeScale()>0)&&this._prom())))}return this},_e.add=function(it,ct){var pt=this;if(_isNumber$1(ct)||(ct=_parsePosition$1(this,ct,it)),!(it instanceof Animation)){if(_isArray(it))return it.forEach(function(At){return pt.add(At,ct)}),this;if(_isString$1(it))return this.addLabel(it,ct);if(_isFunction$1(it))it=Tween.delayedCall(0,it);else return this}return this!==it?_addToTimeline(this,it,ct):this},_e.getChildren=function(it,ct,pt,At){it===void 0&&(it=!0),ct===void 0&&(ct=!0),pt===void 0&&(pt=!0),At===void 0&&(At=-_bigNum$1);for(var St=[],Ot=this._first;Ot;)Ot._start>=At&&(Ot instanceof Tween?ct&&St.push(Ot):(pt&&St.push(Ot),it&&St.push.apply(St,Ot.getChildren(!0,ct,pt)))),Ot=Ot._next;return St},_e.getById=function(it){for(var ct=this.getChildren(1,1,1),pt=ct.length;pt--;)if(ct[pt].vars.id===it)return ct[pt]},_e.remove=function(it){return _isString$1(it)?this.removeLabel(it):_isFunction$1(it)?this.killTweensOf(it):(_removeLinkedListItem(this,it),it===this._recent&&(this._recent=this._last),_uncache(this))},_e.totalTime=function(it,ct){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?it/this._ts:(this.totalDuration()-it)/-this._ts))),j.prototype.totalTime.call(this,it,ct),this._forcing=0,this):this._tTime},_e.addLabel=function(it,ct){return this.labels[it]=_parsePosition$1(this,ct),this},_e.removeLabel=function(it){return delete this.labels[it],this},_e.addPause=function(it,ct,pt){var At=Tween.delayedCall(0,ct||_emptyFunc,pt);return At.data="isPause",this._hasPause=1,_addToTimeline(this,At,_parsePosition$1(this,it))},_e.removePause=function(it){var ct=this._first;for(it=_parsePosition$1(this,it);ct;)ct._start===it&&ct.data==="isPause"&&_removeFromParent(ct),ct=ct._next},_e.killTweensOf=function(it,ct,pt){for(var At=this.getTweensOf(it,pt),St=At.length;St--;)_overwritingTween!==At[St]&&At[St].kill(it,ct);return this},_e.getTweensOf=function(it,ct){for(var pt=[],At=toArray(it),St=this._first,Ot=_isNumber$1(ct),Qt;St;)St instanceof Tween?_arrayContainsAny(St._targets,At)&&(Ot?(!_overwritingTween||St._initted&&St._ts)&&St.globalTime(0)<=ct&&St.globalTime(St.totalDuration())>ct:!ct||St.isActive())&&pt.push(St):(Qt=St.getTweensOf(At,ct)).length&&pt.push.apply(pt,Qt),St=St._next;return pt},_e.tweenTo=function(it,ct){ct=ct||{};var pt=this,At=_parsePosition$1(pt,it),St=ct,Ot=St.startAt,Qt=St.onStart,Yt=St.onStartParams,Vt=St.immediateRender,qt,Jt=Tween.to(pt,_setDefaults$1({ease:ct.ease||"none",lazy:!1,immediateRender:!1,time:At,overwrite:"auto",duration:ct.duration||Math.abs((At-(Ot&&"time"in Ot?Ot.time:pt._time))/pt.timeScale())||_tinyNum,onStart:function(){if(pt.pause(),!qt){var sn=ct.duration||Math.abs((At-(Ot&&"time"in Ot?Ot.time:pt._time))/pt.timeScale());Jt._dur!==sn&&_setDuration(Jt,sn,0,1).render(Jt._time,!0,!0),qt=1}Qt&&Qt.apply(Jt,Yt||[])}},ct));return Vt?Jt.render(0):Jt},_e.tweenFromTo=function(it,ct,pt){return this.tweenTo(ct,_setDefaults$1({startAt:{time:_parsePosition$1(this,it)}},pt))},_e.recent=function(){return this._recent},_e.nextLabel=function(it){return it===void 0&&(it=this._time),_getLabelInDirection(this,_parsePosition$1(this,it))},_e.previousLabel=function(it){return it===void 0&&(it=this._time),_getLabelInDirection(this,_parsePosition$1(this,it),1)},_e.currentLabel=function(it){return arguments.length?this.seek(it,!0):this.previousLabel(this._time+_tinyNum)},_e.shiftChildren=function(it,ct,pt){pt===void 0&&(pt=0);for(var At=this._first,St=this.labels,Ot;At;)At._start>=pt&&(At._start+=it,At._end+=it),At=At._next;if(ct)for(Ot in St)St[Ot]>=pt&&(St[Ot]+=it);return _uncache(this)},_e.invalidate=function(it){var ct=this._first;for(this._lock=0;ct;)ct.invalidate(it),ct=ct._next;return j.prototype.invalidate.call(this,it)},_e.clear=function(it){it===void 0&&(it=!0);for(var ct=this._first,pt;ct;)pt=ct._next,this.remove(ct),ct=pt;return this._dp&&(this._time=this._tTime=this._pTime=0),it&&(this.labels={}),_uncache(this)},_e.totalDuration=function(it){var ct=0,pt=this,At=pt._last,St=_bigNum$1,Ot,Qt,Yt;if(arguments.length)return pt.timeScale((pt._repeat<0?pt.duration():pt.totalDuration())/(pt.reversed()?-it:it));if(pt._dirty){for(Yt=pt.parent;At;)Ot=At._prev,At._dirty&&At.totalDuration(),Qt=At._start,Qt>St&&pt._sort&&At._ts&&!pt._lock?(pt._lock=1,_addToTimeline(pt,At,Qt-At._delay,1)._lock=0):St=Qt,Qt<0&&At._ts&&(ct-=Qt,(!Yt&&!pt._dp||Yt&&Yt.smoothChildTiming)&&(pt._start+=Qt/pt._ts,pt._time-=Qt,pt._tTime-=Qt),pt.shiftChildren(-Qt,!1,-1/0),St=0),At._end>ct&&At._ts&&(ct=At._end),At=Ot;_setDuration(pt,pt===_globalTimeline&&pt._time>ct?pt._time:ct,1,1),pt._dirty=0}return pt._tDur},_.updateRoot=function(it){if(_globalTimeline._ts&&(_lazySafeRender(_globalTimeline,_parentToChildTotalTime(it,_globalTimeline)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var ct=_globalTimeline._first;if((!ct||!ct._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;ct&&!ct._ts;)ct=ct._next;ct||_ticker.sleep()}}},_}(Animation);_setDefaults$1(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function j(_,_e,d,it,ct,pt,At){var St=new PropTween(this._pt,_,_e,0,1,_renderComplexString,null,ct),Ot=0,Qt=0,Yt,Vt,qt,Jt,jt,sn,Ft,Ut;for(St.b=d,St.e=it,d+="",it+="",(Ft=~it.indexOf("random("))&&(it=_replaceRandom(it)),pt&&(Ut=[d,it],pt(Ut,_,_e),d=Ut[0],it=Ut[1]),Vt=d.match(_complexStringNumExp)||[];Yt=_complexStringNumExp.exec(it);)Jt=Yt[0],jt=it.substring(Ot,Yt.index),qt?qt=(qt+1)%5:jt.substr(-5)==="rgba("&&(qt=1),Jt!==Vt[Qt++]&&(sn=parseFloat(Vt[Qt-1])||0,St._pt={_next:St._pt,p:jt||Qt===1?jt:",",s:sn,c:Jt.charAt(1)==="="?_parseRelative(sn,Jt)-sn:parseFloat(Jt)-sn,m:qt&&qt<4?Math.round:0},Ot=_complexStringNumExp.lastIndex);return St.c=Ot<it.length?it.substring(Ot,it.length):"",St.fp=At,(_relExp.test(it)||Ft)&&(St.e=0),this._pt=St,St},_addPropTween=function j(_,_e,d,it,ct,pt,At,St,Ot,Qt){_isFunction$1(it)&&(it=it(ct||0,_,pt));var Yt=_[_e],Vt=d!=="get"?d:_isFunction$1(Yt)?Ot?_[_e.indexOf("set")||!_isFunction$1(_["get"+_e.substr(3)])?_e:"get"+_e.substr(3)](Ot):_[_e]():Yt,qt=_isFunction$1(Yt)?Ot?_setterFuncWithParam:_setterFunc:_setterPlain,Jt;if(_isString$1(it)&&(~it.indexOf("random(")&&(it=_replaceRandom(it)),it.charAt(1)==="="&&(Jt=_parseRelative(Vt,it)+(getUnit(Vt)||0),(Jt||Jt===0)&&(it=Jt))),!Qt||Vt!==it||_forceAllPropTweens)return!isNaN(Vt*it)&&it!==""?(Jt=new PropTween(this._pt,_,_e,+Vt||0,it-(Vt||0),typeof Yt=="boolean"?_renderBoolean:_renderPlain,0,qt),Ot&&(Jt.fp=Ot),At&&Jt.modifier(At,this,_),this._pt=Jt):(!Yt&&!(_e in _)&&_missingPlugin(_e,it),_addComplexStringPropTween.call(this,_,_e,Vt,it,qt,St||_config.stringFilter,Ot))},_processVars=function j(_,_e,d,it,ct){if(_isFunction$1(_)&&(_=_parseFuncOrString(_,ct,_e,d,it)),!_isObject$1(_)||_.style&&_.nodeType||_isArray(_)||_isTypedArray(_))return _isString$1(_)?_parseFuncOrString(_,ct,_e,d,it):_;var pt={},At;for(At in _)pt[At]=_parseFuncOrString(_[At],ct,_e,d,it);return pt},_checkPlugin=function j(_,_e,d,it,ct,pt){var At,St,Ot,Qt;if(_plugins[_]&&(At=new _plugins[_]).init(ct,At.rawVars?_e[_]:_processVars(_e[_],it,ct,pt,d),d,it,pt)!==!1&&(d._pt=St=new PropTween(d._pt,ct,_,0,1,At.render,At,0,At.priority),d!==_quickTween))for(Ot=d._ptLookup[d._targets.indexOf(ct)],Qt=At._props.length;Qt--;)Ot[At._props[Qt]]=St;return At},_overwritingTween,_forceAllPropTweens,_initTween=function j(_,_e,d){var it=_.vars,ct=it.ease,pt=it.startAt,At=it.immediateRender,St=it.lazy,Ot=it.onUpdate,Qt=it.onUpdateParams,Yt=it.callbackScope,Vt=it.runBackwards,qt=it.yoyoEase,Jt=it.keyframes,jt=it.autoRevert,sn=_._dur,Ft=_._startAt,Ut=_._targets,Ht=_.parent,an=Ht&&Ht.data==="nested"?Ht.vars.targets:Ut,nn=_._overwrite==="auto"&&!_suppressOverwrites$1,dn=_.timeline,zt,Wt,Zt,mn,hn,zn,lr,ar,ur,Zn,wr,Vn,Kn;if(dn&&(!Jt||!ct)&&(ct="none"),_._ease=_parseEase(ct,_defaults$1.ease),_._yEase=qt?_invertEase(_parseEase(qt===!0?ct:qt,_defaults$1.ease)):0,qt&&_._yoyo&&!_._repeat&&(qt=_._yEase,_._yEase=_._ease,_._ease=qt),_._from=!dn&&!!it.runBackwards,!dn||Jt&&!it.stagger){if(ar=Ut[0]?_getCache(Ut[0]).harness:0,Vn=ar&&it[ar.prop],zt=_copyExcluding(it,_reservedProps),Ft&&(Ft._zTime<0&&Ft.progress(1),_e<0&&Vt&&At&&!jt?Ft.render(-1,!0):Ft.revert(Vt&&sn?_revertConfigNoKill:_startAtRevertConfig),Ft._lazy=0),pt){if(_removeFromParent(_._startAt=Tween.set(Ut,_setDefaults$1({data:"isStart",overwrite:!1,parent:Ht,immediateRender:!0,lazy:!Ft&&_isNotFalse(St),startAt:null,delay:0,onUpdate:Ot,onUpdateParams:Qt,callbackScope:Yt,stagger:0},pt))),_._startAt._dp=0,_._startAt._sat=_,_e<0&&(_reverting$1||!At&&!jt)&&_._startAt.revert(_revertConfigNoKill),At&&sn&&_e<=0&&d<=0){_e&&(_._zTime=_e);return}}else if(Vt&&sn&&!Ft){if(_e&&(At=!1),Zt=_setDefaults$1({overwrite:!1,data:"isFromStart",lazy:At&&!Ft&&_isNotFalse(St),immediateRender:At,stagger:0,parent:Ht},zt),Vn&&(Zt[ar.prop]=Vn),_removeFromParent(_._startAt=Tween.set(Ut,Zt)),_._startAt._dp=0,_._startAt._sat=_,_e<0&&(_reverting$1?_._startAt.revert(_revertConfigNoKill):_._startAt.render(-1,!0)),_._zTime=_e,!At)j(_._startAt,_tinyNum,_tinyNum);else if(!_e)return}for(_._pt=_._ptCache=0,St=sn&&_isNotFalse(St)||St&&!sn,Wt=0;Wt<Ut.length;Wt++){if(hn=Ut[Wt],lr=hn._gsap||_harness(Ut)[Wt]._gsap,_._ptLookup[Wt]=Zn={},_lazyLookup[lr.id]&&_lazyTweens.length&&_lazyRender(),wr=an===Ut?Wt:an.indexOf(hn),ar&&(ur=new ar).init(hn,Vn||zt,_,wr,an)!==!1&&(_._pt=mn=new PropTween(_._pt,hn,ur.name,0,1,ur.render,ur,0,ur.priority),ur._props.forEach(function(un){Zn[un]=mn}),ur.priority&&(zn=1)),!ar||Vn)for(Zt in zt)_plugins[Zt]&&(ur=_checkPlugin(Zt,zt,_,wr,hn,an))?ur.priority&&(zn=1):Zn[Zt]=mn=_addPropTween.call(_,hn,Zt,"get",zt[Zt],wr,an,0,it.stringFilter);_._op&&_._op[Wt]&&_.kill(hn,_._op[Wt]),nn&&_._pt&&(_overwritingTween=_,_globalTimeline.killTweensOf(hn,Zn,_.globalTime(_e)),Kn=!_.parent,_overwritingTween=0),_._pt&&St&&(_lazyLookup[lr.id]=1)}zn&&_sortPropTweensByPriority(_),_._onInit&&_._onInit(_)}_._onUpdate=Ot,_._initted=(!_._op||_._pt)&&!Kn,Jt&&_e<=0&&dn.render(_bigNum$1,!0,!0)},_updatePropTweens=function j(_,_e,d,it,ct,pt,At){var St=(_._pt&&_._ptCache||(_._ptCache={}))[_e],Ot,Qt,Yt,Vt;if(!St)for(St=_._ptCache[_e]=[],Yt=_._ptLookup,Vt=_._targets.length;Vt--;){if(Ot=Yt[Vt][_e],Ot&&Ot.d&&Ot.d._pt)for(Ot=Ot.d._pt;Ot&&Ot.p!==_e&&Ot.fp!==_e;)Ot=Ot._next;if(!Ot)return _forceAllPropTweens=1,_.vars[_e]="+=0",_initTween(_,At),_forceAllPropTweens=0,1;St.push(Ot)}for(Vt=St.length;Vt--;)Qt=St[Vt],Ot=Qt._pt||Qt,Ot.s=(it||it===0)&&!ct?it:Ot.s+(it||0)+pt*Ot.c,Ot.c=d-Ot.s,Qt.e&&(Qt.e=_round$1(d)+getUnit(Qt.e)),Qt.b&&(Qt.b=Ot.s+getUnit(Qt.b))},_addAliasesToVars=function j(_,_e){var d=_[0]?_getCache(_[0]).harness:0,it=d&&d.aliases,ct,pt,At,St;if(!it)return _e;ct=_merge({},_e);for(pt in it)if(pt in ct)for(St=it[pt].split(","),At=St.length;At--;)ct[St[At]]=ct[pt];return ct},_parseKeyframe=function j(_,_e,d,it){var ct=_e.ease||it||"power1.inOut",pt,At;if(_isArray(_e))At=d[_]||(d[_]=[]),_e.forEach(function(St,Ot){return At.push({t:Ot/(_e.length-1)*100,v:St,e:ct})});else for(pt in _e)At=d[pt]||(d[pt]=[]),pt==="ease"||At.push({t:parseFloat(_),v:_e[pt],e:ct})},_parseFuncOrString=function j(_,_e,d,it,ct){return _isFunction$1(_)?_.call(_e,d,it,ct):_isString$1(_)&&~_.indexOf("random(")?_replaceRandom(_):_},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function(j){return _staggerPropsToSkip[j]=1});var Tween=function(j){_inheritsLoose(_,j);function _(d,it,ct,pt){var At;typeof it=="number"&&(ct.duration=it,it=ct,ct=null),At=j.call(this,pt?it:_inheritDefaults(it))||this;var St=At.vars,Ot=St.duration,Qt=St.delay,Yt=St.immediateRender,Vt=St.stagger,qt=St.overwrite,Jt=St.keyframes,jt=St.defaults,sn=St.scrollTrigger,Ft=St.yoyoEase,Ut=it.parent||_globalTimeline,Ht=(_isArray(d)||_isTypedArray(d)?_isNumber$1(d[0]):"length"in it)?[d]:toArray(d),an,nn,dn,zt,Wt,Zt,mn,hn;if(At._targets=Ht.length?_harness(Ht):_warn("GSAP target "+d+" not found. https://greensock.com",!_config.nullTargetWarn)||[],At._ptLookup=[],At._overwrite=qt,Jt||Vt||_isFuncOrString(Ot)||_isFuncOrString(Qt)){if(it=At.vars,an=At.timeline=new Timeline({data:"nested",defaults:jt||{},targets:Ut&&Ut.data==="nested"?Ut.vars.targets:Ht}),an.kill(),an.parent=an._dp=_assertThisInitialized(At),an._start=0,Vt||_isFuncOrString(Ot)||_isFuncOrString(Qt)){if(zt=Ht.length,mn=Vt&&distribute(Vt),_isObject$1(Vt))for(Wt in Vt)~_staggerTweenProps.indexOf(Wt)&&(hn||(hn={}),hn[Wt]=Vt[Wt]);for(nn=0;nn<zt;nn++)dn=_copyExcluding(it,_staggerPropsToSkip),dn.stagger=0,Ft&&(dn.yoyoEase=Ft),hn&&_merge(dn,hn),Zt=Ht[nn],dn.duration=+_parseFuncOrString(Ot,_assertThisInitialized(At),nn,Zt,Ht),dn.delay=(+_parseFuncOrString(Qt,_assertThisInitialized(At),nn,Zt,Ht)||0)-At._delay,!Vt&&zt===1&&dn.delay&&(At._delay=Qt=dn.delay,At._start+=Qt,dn.delay=0),an.to(Zt,dn,mn?mn(nn,Zt,Ht):0),an._ease=_easeMap.none;an.duration()?Ot=Qt=0:At.timeline=0}else if(Jt){_inheritDefaults(_setDefaults$1(an.vars.defaults,{ease:"none"})),an._ease=_parseEase(Jt.ease||it.ease||"none");var zn=0,lr,ar,ur;if(_isArray(Jt))Jt.forEach(function(Zn){return an.to(Ht,Zn,">")}),an.duration();else{dn={};for(Wt in Jt)Wt==="ease"||Wt==="easeEach"||_parseKeyframe(Wt,Jt[Wt],dn,Jt.easeEach);for(Wt in dn)for(lr=dn[Wt].sort(function(Zn,wr){return Zn.t-wr.t}),zn=0,nn=0;nn<lr.length;nn++)ar=lr[nn],ur={ease:ar.e,duration:(ar.t-(nn?lr[nn-1].t:0))/100*Ot},ur[Wt]=ar.v,an.to(Ht,ur,zn),zn+=ur.duration;an.duration()<Ot&&an.to({},{duration:Ot-an.duration()})}}Ot||At.duration(Ot=an.duration())}else At.timeline=0;return qt===!0&&!_suppressOverwrites$1&&(_overwritingTween=_assertThisInitialized(At),_globalTimeline.killTweensOf(Ht),_overwritingTween=0),_addToTimeline(Ut,_assertThisInitialized(At),ct),it.reversed&&At.reverse(),it.paused&&At.paused(!0),(Yt||!Ot&&!Jt&&At._start===_roundPrecise(Ut._time)&&_isNotFalse(Yt)&&_hasNoPausedAncestors(_assertThisInitialized(At))&&Ut.data!=="nested")&&(At._tTime=-_tinyNum,At.render(Math.max(0,-Qt)||0)),sn&&_scrollTrigger(_assertThisInitialized(At),sn),At}var _e=_.prototype;return _e.render=function(it,ct,pt){var At=this._time,St=this._tDur,Ot=this._dur,Qt=it<0,Yt=it>St-_tinyNum&&!Qt?St:it<_tinyNum?0:it,Vt,qt,Jt,jt,sn,Ft,Ut,Ht,an;if(!Ot)_renderZeroDurationTween(this,it,ct,pt);else if(Yt!==this._tTime||!it||pt||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==Qt){if(Vt=Yt,Ht=this.timeline,this._repeat){if(jt=Ot+this._rDelay,this._repeat<-1&&Qt)return this.totalTime(jt*100+it,ct,pt);if(Vt=_roundPrecise(Yt%jt),Yt===St?(Jt=this._repeat,Vt=Ot):(Jt=~~(Yt/jt),Jt&&Jt===Yt/jt&&(Vt=Ot,Jt--),Vt>Ot&&(Vt=Ot)),Ft=this._yoyo&&Jt&1,Ft&&(an=this._yEase,Vt=Ot-Vt),sn=_animationCycle(this._tTime,jt),Vt===At&&!pt&&this._initted)return this._tTime=Yt,this;Jt!==sn&&(Ht&&this._yEase&&_propagateYoyoEase(Ht,Ft),this.vars.repeatRefresh&&!Ft&&!this._lock&&(this._lock=pt=1,this.render(_roundPrecise(jt*Jt),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,Qt?it:Vt,pt,ct,Yt))return this._tTime=0,this;if(At!==this._time)return this;if(Ot!==this._dur)return this.render(it,ct,pt)}if(this._tTime=Yt,this._time=Vt,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Ut=(an||this._ease)(Vt/Ot),this._from&&(this.ratio=Ut=1-Ut),Vt&&!At&&!ct&&(_callback$1(this,"onStart"),this._tTime!==Yt))return this;for(qt=this._pt;qt;)qt.r(Ut,qt.d),qt=qt._next;Ht&&Ht.render(it<0?it:!Vt&&Ft?-_tinyNum:Ht._dur*Ht._ease(Vt/this._dur),ct,pt)||this._startAt&&(this._zTime=it),this._onUpdate&&!ct&&(Qt&&_rewindStartAt(this,it,ct,pt),_callback$1(this,"onUpdate")),this._repeat&&Jt!==sn&&this.vars.onRepeat&&!ct&&this.parent&&_callback$1(this,"onRepeat"),(Yt===this._tDur||!Yt)&&this._tTime===Yt&&(Qt&&!this._onUpdate&&_rewindStartAt(this,it,!0,!0),(it||!Ot)&&(Yt===this._tDur&&this._ts>0||!Yt&&this._ts<0)&&_removeFromParent(this,1),!ct&&!(Qt&&!At)&&(Yt||At||Ft)&&(_callback$1(this,Yt===St?"onComplete":"onReverseComplete",!0),this._prom&&!(Yt<St&&this.timeScale()>0)&&this._prom()))}return this},_e.targets=function(){return this._targets},_e.invalidate=function(it){return(!it||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(it),j.prototype.invalidate.call(this,it)},_e.resetTo=function(it,ct,pt,At){_tickerActive||_ticker.wake(),this._ts||this.play();var St=Math.min(this._dur,(this._dp._time-this._start)*this._ts),Ot;return this._initted||_initTween(this,St),Ot=this._ease(St/this._dur),_updatePropTweens(this,it,ct,pt,At,Ot,St)?this.resetTo(it,ct,pt,At):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},_e.kill=function(it,ct){if(ct===void 0&&(ct="all"),!it&&(!ct||ct==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this;if(this.timeline){var pt=this.timeline.totalDuration();return this.timeline.killTweensOf(it,ct,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&pt!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/pt,0,1),this}var At=this._targets,St=it?toArray(it):At,Ot=this._ptLookup,Qt=this._pt,Yt,Vt,qt,Jt,jt,sn,Ft;if((!ct||ct==="all")&&_arraysMatch(At,St))return ct==="all"&&(this._pt=0),_interrupt(this);for(Yt=this._op=this._op||[],ct!=="all"&&(_isString$1(ct)&&(jt={},_forEachName(ct,function(Ut){return jt[Ut]=1}),ct=jt),ct=_addAliasesToVars(At,ct)),Ft=At.length;Ft--;)if(~St.indexOf(At[Ft])){Vt=Ot[Ft],ct==="all"?(Yt[Ft]=ct,Jt=Vt,qt={}):(qt=Yt[Ft]=Yt[Ft]||{},Jt=ct);for(jt in Jt)sn=Vt&&Vt[jt],sn&&((!("kill"in sn.d)||sn.d.kill(jt)===!0)&&_removeLinkedListItem(this,sn,"_pt"),delete Vt[jt]),qt!=="all"&&(qt[jt]=1)}return this._initted&&!this._pt&&Qt&&_interrupt(this),this},_.to=function(it,ct){return new _(it,ct,arguments[2])},_.from=function(it,ct){return _createTweenType(1,arguments)},_.delayedCall=function(it,ct,pt,At){return new _(ct,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:it,onComplete:ct,onReverseComplete:ct,onCompleteParams:pt,onReverseCompleteParams:pt,callbackScope:At})},_.fromTo=function(it,ct,pt){return _createTweenType(2,arguments)},_.set=function(it,ct){return ct.duration=0,ct.repeatDelay||(ct.repeat=0),new _(it,ct)},_.killTweensOf=function(it,ct,pt){return _globalTimeline.killTweensOf(it,ct,pt)},_}(Animation);_setDefaults$1(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function(j){Tween[j]=function(){var _=new Timeline,_e=_slice.call(arguments,0);return _e.splice(j==="staggerFromTo"?5:4,0,0),_[j].apply(_,_e)}});var _setterPlain=function j(_,_e,d){return _[_e]=d},_setterFunc=function j(_,_e,d){return _[_e](d)},_setterFuncWithParam=function j(_,_e,d,it){return _[_e](it.fp,d)},_setterAttribute=function j(_,_e,d){return _.setAttribute(_e,d)},_getSetter=function j(_,_e){return _isFunction$1(_[_e])?_setterFunc:_isUndefined(_[_e])&&_.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function j(_,_e){return _e.set(_e.t,_e.p,Math.round((_e.s+_e.c*_)*1e6)/1e6,_e)},_renderBoolean=function j(_,_e){return _e.set(_e.t,_e.p,!!(_e.s+_e.c*_),_e)},_renderComplexString=function j(_,_e){var d=_e._pt,it="";if(!_&&_e.b)it=_e.b;else if(_===1&&_e.e)it=_e.e;else{for(;d;)it=d.p+(d.m?d.m(d.s+d.c*_):Math.round((d.s+d.c*_)*1e4)/1e4)+it,d=d._next;it+=_e.c}_e.set(_e.t,_e.p,it,_e)},_renderPropTweens=function j(_,_e){for(var d=_e._pt;d;)d.r(_,d.d),d=d._next},_addPluginModifier=function j(_,_e,d,it){for(var ct=this._pt,pt;ct;)pt=ct._next,ct.p===it&&ct.modifier(_,_e,d),ct=pt},_killPropTweensOf=function j(_){for(var _e=this._pt,d,it;_e;)it=_e._next,_e.p===_&&!_e.op||_e.op===_?_removeLinkedListItem(this,_e,"_pt"):_e.dep||(d=1),_e=it;return!d},_setterWithModifier=function j(_,_e,d,it){it.mSet(_,_e,it.m.call(it.tween,d,it.mt),it)},_sortPropTweensByPriority=function j(_){for(var _e=_._pt,d,it,ct,pt;_e;){for(d=_e._next,it=ct;it&&it.pr>_e.pr;)it=it._next;(_e._prev=it?it._prev:pt)?_e._prev._next=_e:ct=_e,(_e._next=it)?it._prev=_e:pt=_e,_e=d}_._pt=ct},PropTween=function(){function j(_e,d,it,ct,pt,At,St,Ot,Qt){this.t=d,this.s=ct,this.c=pt,this.p=it,this.r=At||_renderPlain,this.d=St||this,this.set=Ot||_setterPlain,this.pr=Qt||0,this._next=_e,_e&&(_e._prev=this)}var _=j.prototype;return _.modifier=function(d,it,ct){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=d,this.mt=ct,this.tween=it},j}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(j){return _reservedProps[j]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline=new Timeline({sortChildren:!1,defaults:_defaults$1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners$1={},_emptyArray$1=[],_lastMediaTime=0,_dispatch$1=function j(_){return(_listeners$1[_]||_emptyArray$1).map(function(_e){return _e()})},_onMediaChange=function j(){var _=Date.now(),_e=[];_-_lastMediaTime>2&&(_dispatch$1("matchMediaInit"),_media.forEach(function(d){var it=d.queries,ct=d.conditions,pt,At,St,Ot;for(At in it)pt=_win$3.matchMedia(it[At]).matches,pt&&(St=1),pt!==ct[At]&&(ct[At]=pt,Ot=1);Ot&&(d.revert(),St&&_e.push(d))}),_dispatch$1("matchMediaRevert"),_e.forEach(function(d){return d.onMatch(d)}),_lastMediaTime=_,_dispatch$1("matchMedia"))},Context=function(){function j(_e,d){this.selector=d&&selector(d),this.data=[],this._r=[],this.isReverted=!1,_e&&this.add(_e)}var _=j.prototype;return _.add=function(d,it,ct){_isFunction$1(d)&&(ct=it,it=d,d=_isFunction$1);var pt=this,At=function(){var Ot=_context$2,Qt=pt.selector,Yt;return Ot&&Ot!==pt&&Ot.data.push(pt),ct&&(pt.selector=selector(ct)),_context$2=pt,Yt=it.apply(pt,arguments),_isFunction$1(Yt)&&pt._r.push(Yt),_context$2=Ot,pt.selector=Qt,pt.isReverted=!1,Yt};return pt.last=At,d===_isFunction$1?At(pt):d?pt[d]=At:At},_.ignore=function(d){var it=_context$2;_context$2=null,d(this),_context$2=it},_.getTweens=function(){var d=[];return this.data.forEach(function(it){return it instanceof j?d.push.apply(d,it.getTweens()):it instanceof Tween&&!(it.parent&&it.parent.data==="nested")&&d.push(it)}),d},_.clear=function(){this._r.length=this.data.length=0},_.kill=function(d,it){var ct=this;if(d){var pt=this.getTweens();this.data.forEach(function(St){St.data==="isFlip"&&(St.revert(),St.getChildren(!0,!0,!1).forEach(function(Ot){return pt.splice(pt.indexOf(Ot),1)}))}),pt.map(function(St){return{g:St.globalTime(0),t:St}}).sort(function(St,Ot){return Ot.g-St.g||-1}).forEach(function(St){return St.t.revert(d)}),this.data.forEach(function(St){return!(St instanceof Animation)&&St.revert&&St.revert(d)}),this._r.forEach(function(St){return St(d,ct)}),this.isReverted=!0}else this.data.forEach(function(St){return St.kill&&St.kill()});if(this.clear(),it){var At=_media.indexOf(this);~At&&_media.splice(At,1)}},_.revert=function(d){this.kill(d||{})},j}(),MatchMedia=function(){function j(_e){this.contexts=[],this.scope=_e}var _=j.prototype;return _.add=function(d,it,ct){_isObject$1(d)||(d={matches:d});var pt=new Context(0,ct||this.scope),At=pt.conditions={},St,Ot,Qt;this.contexts.push(pt),it=pt.add("onMatch",it),pt.queries=d;for(Ot in d)Ot==="all"?Qt=1:(St=_win$3.matchMedia(d[Ot]),St&&(_media.indexOf(pt)<0&&_media.push(pt),(At[Ot]=St.matches)&&(Qt=1),St.addListener?St.addListener(_onMediaChange):St.addEventListener("change",_onMediaChange)));return Qt&&it(pt),this},_.revert=function(d){this.kill(d||{})},_.kill=function(d){this.contexts.forEach(function(it){return it.kill(d,!0)})},j}(),_gsap={registerPlugin:function j(){for(var _=arguments.length,_e=new Array(_),d=0;d<_;d++)_e[d]=arguments[d];_e.forEach(function(it){return _createPlugin(it)})},timeline:function j(_){return new Timeline(_)},getTweensOf:function j(_,_e){return _globalTimeline.getTweensOf(_,_e)},getProperty:function j(_,_e,d,it){_isString$1(_)&&(_=toArray(_)[0]);var ct=_getCache(_||{}).get,pt=d?_passThrough$1:_numericIfPossible;return d==="native"&&(d=""),_&&(_e?pt((_plugins[_e]&&_plugins[_e].get||ct)(_,_e,d,it)):function(At,St,Ot){return pt((_plugins[At]&&_plugins[At].get||ct)(_,At,St,Ot))})},quickSetter:function j(_,_e,d){if(_=toArray(_),_.length>1){var it=_.map(function(Qt){return gsap$2.quickSetter(Qt,_e,d)}),ct=it.length;return function(Qt){for(var Yt=ct;Yt--;)it[Yt](Qt)}}_=_[0]||{};var pt=_plugins[_e],At=_getCache(_),St=At.harness&&(At.harness.aliases||{})[_e]||_e,Ot=pt?function(Qt){var Yt=new pt;_quickTween._pt=0,Yt.init(_,d?Qt+d:Qt,_quickTween,0,[_]),Yt.render(1,Yt),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:At.set(_,St);return pt?Ot:function(Qt){return Ot(_,St,d?Qt+d:Qt,At,1)}},quickTo:function j(_,_e,d){var it,ct=gsap$2.to(_,_merge((it={},it[_e]="+=0.1",it.paused=!0,it),d||{})),pt=function(St,Ot,Qt){return ct.resetTo(_e,St,Ot,Qt)};return pt.tween=ct,pt},isTweening:function j(_){return _globalTimeline.getTweensOf(_,!0).length>0},defaults:function j(_){return _&&_.ease&&(_.ease=_parseEase(_.ease,_defaults$1.ease)),_mergeDeep(_defaults$1,_||{})},config:function j(_){return _mergeDeep(_config,_||{})},registerEffect:function j(_){var _e=_.name,d=_.effect,it=_.plugins,ct=_.defaults,pt=_.extendTimeline;(it||"").split(",").forEach(function(At){return At&&!_plugins[At]&&!_globals[At]&&_warn(_e+" effect requires "+At+" plugin.")}),_effects[_e]=function(At,St,Ot){return d(toArray(At),_setDefaults$1(St||{},ct),Ot)},pt&&(Timeline.prototype[_e]=function(At,St,Ot){return this.add(_effects[_e](At,_isObject$1(St)?St:(Ot=St)&&{},this),Ot)})},registerEase:function j(_,_e){_easeMap[_]=_parseEase(_e)},parseEase:function j(_,_e){return arguments.length?_parseEase(_,_e):_easeMap},getById:function j(_){return _globalTimeline.getById(_)},exportRoot:function j(_,_e){_===void 0&&(_={});var d=new Timeline(_),it,ct;for(d.smoothChildTiming=_isNotFalse(_.smoothChildTiming),_globalTimeline.remove(d),d._dp=0,d._time=d._tTime=_globalTimeline._time,it=_globalTimeline._first;it;)ct=it._next,(_e||!(!it._dur&&it instanceof Tween&&it.vars.onComplete===it._targets[0]))&&_addToTimeline(d,it,it._start-it._delay),it=ct;return _addToTimeline(_globalTimeline,d,0),d},context:function j(_,_e){return _?new Context(_,_e):_context$2},matchMedia:function j(_){return new MatchMedia(_)},matchMediaRefresh:function j(){return _media.forEach(function(_){var _e=_.conditions,d,it;for(it in _e)_e[it]&&(_e[it]=!1,d=1);d&&_.revert()})||_onMediaChange()},addEventListener:function j(_,_e){var d=_listeners$1[_]||(_listeners$1[_]=[]);~d.indexOf(_e)||d.push(_e)},removeEventListener:function j(_,_e){var d=_listeners$1[_],it=d&&d.indexOf(_e);it>=0&&d.splice(it,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize,getUnit,clamp,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation,getCache:_getCache,_removeLinkedListItem,reverting:function j(){return _reverting$1},context:function j(_){return _&&_context$2&&(_context$2.data.push(_),_._ctx=_context$2),_context$2},suppressOverwrites:function j(_){return _suppressOverwrites$1=_}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function(j){return _gsap[j]=Tween[j]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function j(_,_e){for(var d=_._pt;d&&d.p!==_e&&d.op!==_e&&d.fp!==_e;)d=d._next;return d},_addModifiers=function j(_,_e){var d=_._targets,it,ct,pt;for(it in _e)for(ct=d.length;ct--;)pt=_._ptLookup[ct][it],pt&&(pt=pt.d)&&(pt._pt&&(pt=_getPluginPropTween(pt,it)),pt&&pt.modifier&&pt.modifier(_e[it],_,d[ct],it))},_buildModifierPlugin=function j(_,_e){return{name:_,rawVars:1,init:function(it,ct,pt){pt._onInit=function(At){var St,Ot;if(_isString$1(ct)&&(St={},_forEachName(ct,function(Qt){return St[Qt]=1}),ct=St),_e){St={};for(Ot in ct)St[Ot]=_e(ct[Ot]);ct=St}_addModifiers(At,ct)}}}},gsap$2=_gsap.registerPlugin({name:"attr",init:function j(_,_e,d,it,ct){var pt,At,St;this.tween=d;for(pt in _e)St=_.getAttribute(pt)||"",At=this.add(_,"setAttribute",(St||0)+"",_e[pt],it,ct,0,0,pt),At.op=pt,At.b=St,this._props.push(pt)},render:function j(_,_e){for(var d=_e._pt;d;)_reverting$1?d.set(d.t,d.p,d.b,d):d.r(_,d.d),d=d._next}},{name:"endArray",init:function j(_,_e){for(var d=_e.length;d--;)this.add(_,d,_[d]||0,_e[d],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap$2.version="3.11.4";_coreReady=1;_windowExists$2()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.11.4
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _win$2,_doc$2,_docElement,_pluginInitted,_tempDiv,_recentSetterPlugin,_reverting,_windowExists$1=function j(){return typeof window<"u"},_transformProps={},_RAD2DEG=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum=1e8,_capsExp$1=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function j(_,_e){return _e.set(_e.t,_e.p,Math.round((_e.s+_e.c*_)*1e4)/1e4+_e.u,_e)},_renderPropWithEnd=function j(_,_e){return _e.set(_e.t,_e.p,_===1?_e.e:Math.round((_e.s+_e.c*_)*1e4)/1e4+_e.u,_e)},_renderCSSPropWithBeginning=function j(_,_e){return _e.set(_e.t,_e.p,_?Math.round((_e.s+_e.c*_)*1e4)/1e4+_e.u:_e.b,_e)},_renderRoundedCSSProp=function j(_,_e){var d=_e.s+_e.c*_;_e.set(_e.t,_e.p,~~(d+(d<0?-.5:.5))+_e.u,_e)},_renderNonTweeningValue=function j(_,_e){return _e.set(_e.t,_e.p,_?_e.e:_e.b,_e)},_renderNonTweeningValueOnlyAtEnd=function j(_,_e){return _e.set(_e.t,_e.p,_!==1?_e.b:_e.e,_e)},_setterCSSStyle=function j(_,_e,d){return _.style[_e]=d},_setterCSSProp=function j(_,_e,d){return _.style.setProperty(_e,d)},_setterTransform=function j(_,_e,d){return _._gsap[_e]=d},_setterScale=function j(_,_e,d){return _._gsap.scaleX=_._gsap.scaleY=d},_setterScaleWithRender=function j(_,_e,d,it,ct){var pt=_._gsap;pt.scaleX=pt.scaleY=d,pt.renderTransform(ct,pt)},_setterTransformWithRender=function j(_,_e,d,it,ct){var pt=_._gsap;pt[_e]=d,pt.renderTransform(ct,pt)},_transformProp$1="transform",_transformOriginProp=_transformProp$1+"Origin",_saveStyle=function j(_,_e){var d=this,it=this.target,ct=it.style;if(_ in _transformProps){if(this.tfm=this.tfm||{},_!=="transform"&&(_=_propertyAliases[_]||_,~_.indexOf(",")?_.split(",").forEach(function(pt){return d.tfm[pt]=_get(it,pt)}):this.tfm[_]=it._gsap.x?it._gsap[_]:_get(it,_)),this.props.indexOf(_transformProp$1)>=0)return;it._gsap.svg&&(this.svgo=it.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp,_e,"")),_=_transformProp$1}(ct||_e)&&this.props.push(_,_e,ct[_])},_removeIndependentTransforms=function j(_){_.translate&&(_.removeProperty("translate"),_.removeProperty("scale"),_.removeProperty("rotate"))},_revertStyle=function j(){var _=this.props,_e=this.target,d=_e.style,it=_e._gsap,ct,pt;for(ct=0;ct<_.length;ct+=3)_[ct+1]?_e[_[ct]]=_[ct+2]:_[ct+2]?d[_[ct]]=_[ct+2]:d.removeProperty(_[ct].replace(_capsExp$1,"-$1").toLowerCase());if(this.tfm){for(pt in this.tfm)it[pt]=this.tfm[pt];it.svg&&(it.renderTransform(),_e.setAttribute("data-svg-origin",this.svgo||"")),ct=_reverting(),ct&&!ct.isStart&&!d[_transformProp$1]&&(_removeIndependentTransforms(d),it.uncache=1)}},_getStyleSaver=function j(_,_e){var d={target:_,props:[],revert:_revertStyle,save:_saveStyle};return _e&&_e.split(",").forEach(function(it){return d.save(it)}),d},_supports3D,_createElement=function j(_,_e){var d=_doc$2.createElementNS?_doc$2.createElementNS((_e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),_):_doc$2.createElement(_);return d.style?d:_doc$2.createElement(_)},_getComputedProperty=function j(_,_e,d){var it=getComputedStyle(_);return it[_e]||it.getPropertyValue(_e.replace(_capsExp$1,"-$1").toLowerCase())||it.getPropertyValue(_e)||!d&&j(_,_checkPropPrefix(_e)||_e,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function j(_,_e,d){var it=_e||_tempDiv,ct=it.style,pt=5;if(_ in ct&&!d)return _;for(_=_.charAt(0).toUpperCase()+_.substr(1);pt--&&!(_prefixes[pt]+_ in ct););return pt<0?null:(pt===3?"ms":pt>=0?_prefixes[pt]:"")+_},_initCore$1=function j(){_windowExists$1()&&window.document&&(_win$2=window,_doc$2=_win$2.document,_docElement=_doc$2.documentElement,_tempDiv=_createElement("div")||{style:{}},_createElement("div"),_transformProp$1=_checkPropPrefix(_transformProp$1),_transformOriginProp=_transformProp$1+"Origin",_tempDiv.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D=!!_checkPropPrefix("perspective"),_reverting=gsap$2.core.reverting,_pluginInitted=1)},_getBBoxHack=function j(_){var _e=_createElement("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),d=this.parentNode,it=this.nextSibling,ct=this.style.cssText,pt;if(_docElement.appendChild(_e),_e.appendChild(this),this.style.display="block",_)try{pt=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=j}catch{}else this._gsapBBox&&(pt=this._gsapBBox());return d&&(it?d.insertBefore(this,it):d.appendChild(this)),_docElement.removeChild(_e),this.style.cssText=ct,pt},_getAttributeFallbacks=function j(_,_e){for(var d=_e.length;d--;)if(_.hasAttribute(_e[d]))return _.getAttribute(_e[d])},_getBBox=function j(_){var _e;try{_e=_.getBBox()}catch{_e=_getBBoxHack.call(_,!0)}return _e&&(_e.width||_e.height)||_.getBBox===_getBBoxHack||(_e=_getBBoxHack.call(_,!0)),_e&&!_e.width&&!_e.x&&!_e.y?{x:+_getAttributeFallbacks(_,["x","cx","x1"])||0,y:+_getAttributeFallbacks(_,["y","cy","y1"])||0,width:0,height:0}:_e},_isSVG=function j(_){return!!(_.getCTM&&(!_.parentNode||_.ownerSVGElement)&&_getBBox(_))},_removeProperty=function j(_,_e){if(_e){var d=_.style;_e in _transformProps&&_e!==_transformOriginProp&&(_e=_transformProp$1),d.removeProperty?((_e.substr(0,2)==="ms"||_e.substr(0,6)==="webkit")&&(_e="-"+_e),d.removeProperty(_e.replace(_capsExp$1,"-$1").toLowerCase())):d.removeAttribute(_e)}},_addNonTweeningPT=function j(_,_e,d,it,ct,pt){var At=new PropTween(_._pt,_e,d,0,1,pt?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return _._pt=At,At.b=it,At.e=ct,_._props.push(d),At},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function j(_,_e,d,it){var ct=parseFloat(d)||0,pt=(d+"").trim().substr((ct+"").length)||"px",At=_tempDiv.style,St=_horizontalExp.test(_e),Ot=_.tagName.toLowerCase()==="svg",Qt=(Ot?"client":"offset")+(St?"Width":"Height"),Yt=100,Vt=it==="px",qt=it==="%",Jt,jt,sn,Ft;return it===pt||!ct||_nonConvertibleUnits[it]||_nonConvertibleUnits[pt]?ct:(pt!=="px"&&!Vt&&(ct=j(_,_e,d,"px")),Ft=_.getCTM&&_isSVG(_),(qt||pt==="%")&&(_transformProps[_e]||~_e.indexOf("adius"))?(Jt=Ft?_.getBBox()[St?"width":"height"]:_[Qt],_round$1(qt?ct/Jt*Yt:ct/100*Jt)):(At[St?"width":"height"]=Yt+(Vt?pt:it),jt=~_e.indexOf("adius")||it==="em"&&_.appendChild&&!Ot?_:_.parentNode,Ft&&(jt=(_.ownerSVGElement||{}).parentNode),(!jt||jt===_doc$2||!jt.appendChild)&&(jt=_doc$2.body),sn=jt._gsap,sn&&qt&&sn.width&&St&&sn.time===_ticker.time&&!sn.uncache?_round$1(ct/sn.width*Yt):((qt||pt==="%")&&!_nonStandardLayouts[_getComputedProperty(jt,"display")]&&(At.position=_getComputedProperty(_,"position")),jt===_&&(At.position="static"),jt.appendChild(_tempDiv),Jt=_tempDiv[Qt],jt.removeChild(_tempDiv),At.position="absolute",St&&qt&&(sn=_getCache(jt),sn.time=_ticker.time,sn.width=jt[Qt]),_round$1(Vt?Jt*ct/Yt:Jt&&ct?Yt/Jt*ct:0))))},_get=function j(_,_e,d,it){var ct;return _pluginInitted||_initCore$1(),_e in _propertyAliases&&_e!=="transform"&&(_e=_propertyAliases[_e],~_e.indexOf(",")&&(_e=_e.split(",")[0])),_transformProps[_e]&&_e!=="transform"?(ct=_parseTransform(_,it),ct=_e!=="transformOrigin"?ct[_e]:ct.svg?ct.origin:_firstTwoOnly(_getComputedProperty(_,_transformOriginProp))+" "+ct.zOrigin+"px"):(ct=_.style[_e],(!ct||ct==="auto"||it||~(ct+"").indexOf("calc("))&&(ct=_specialProps[_e]&&_specialProps[_e](_,_e,d)||_getComputedProperty(_,_e)||_getProperty(_,_e)||(_e==="opacity"?1:0))),d&&!~(ct+"").trim().indexOf(" ")?_convertToUnit(_,_e,ct,d)+d:ct},_tweenComplexCSSString=function j(_,_e,d,it){if(!d||d==="none"){var ct=_checkPropPrefix(_e,_,1),pt=ct&&_getComputedProperty(_,ct,1);pt&&pt!==d?(_e=ct,d=pt):_e==="borderColor"&&(d=_getComputedProperty(_,"borderTopColor"))}var At=new PropTween(this._pt,_.style,_e,0,1,_renderComplexString),St=0,Ot=0,Qt,Yt,Vt,qt,Jt,jt,sn,Ft,Ut,Ht,an,nn;if(At.b=d,At.e=it,d+="",it+="",it==="auto"&&(_.style[_e]=it,it=_getComputedProperty(_,_e)||it,_.style[_e]=d),Qt=[d,it],_colorStringFilter(Qt),d=Qt[0],it=Qt[1],Vt=d.match(_numWithUnitExp)||[],nn=it.match(_numWithUnitExp)||[],nn.length){for(;Yt=_numWithUnitExp.exec(it);)sn=Yt[0],Ut=it.substring(St,Yt.index),Jt?Jt=(Jt+1)%5:(Ut.substr(-5)==="rgba("||Ut.substr(-5)==="hsla(")&&(Jt=1),sn!==(jt=Vt[Ot++]||"")&&(qt=parseFloat(jt)||0,an=jt.substr((qt+"").length),sn.charAt(1)==="="&&(sn=_parseRelative(qt,sn)+an),Ft=parseFloat(sn),Ht=sn.substr((Ft+"").length),St=_numWithUnitExp.lastIndex-Ht.length,Ht||(Ht=Ht||_config.units[_e]||an,St===it.length&&(it+=Ht,At.e+=Ht)),an!==Ht&&(qt=_convertToUnit(_,_e,jt,Ht)||0),At._pt={_next:At._pt,p:Ut||Ot===1?Ut:",",s:qt,c:Ft-qt,m:Jt&&Jt<4||_e==="zIndex"?Math.round:0});At.c=St<it.length?it.substring(St,it.length):""}else At.r=_e==="display"&&it==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(it)&&(At.e=0),this._pt=At,At},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function j(_){var _e=_.split(" "),d=_e[0],it=_e[1]||"50%";return(d==="top"||d==="bottom"||it==="left"||it==="right")&&(_=d,d=it,it=_),_e[0]=_keywordToPercent[d]||d,_e[1]=_keywordToPercent[it]||it,_e.join(" ")},_renderClearProps=function j(_,_e){if(_e.tween&&_e.tween._time===_e.tween._dur){var d=_e.t,it=d.style,ct=_e.u,pt=d._gsap,At,St,Ot;if(ct==="all"||ct===!0)it.cssText="",St=1;else for(ct=ct.split(","),Ot=ct.length;--Ot>-1;)At=ct[Ot],_transformProps[At]&&(St=1,At=At==="transformOrigin"?_transformOriginProp:_transformProp$1),_removeProperty(d,At);St&&(_removeProperty(d,_transformProp$1),pt&&(pt.svg&&d.removeAttribute("transform"),_parseTransform(d,1),pt.uncache=1,_removeIndependentTransforms(it)))}},_specialProps={clearProps:function j(_,_e,d,it,ct){if(ct.data!=="isFromStart"){var pt=_._pt=new PropTween(_._pt,_e,d,0,0,_renderClearProps);return pt.u=it,pt.pr=-10,pt.tween=ct,_._props.push(d),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function j(_){return _==="matrix(1, 0, 0, 1, 0, 0)"||_==="none"||!_},_getComputedTransformMatrixAsArray=function j(_){var _e=_getComputedProperty(_,_transformProp$1);return _isNullTransform(_e)?_identity2DMatrix:_e.substr(7).match(_numExp).map(_round$1)},_getMatrix=function j(_,_e){var d=_._gsap||_getCache(_),it=_.style,ct=_getComputedTransformMatrixAsArray(_),pt,At,St,Ot;return d.svg&&_.getAttribute("transform")?(St=_.transform.baseVal.consolidate().matrix,ct=[St.a,St.b,St.c,St.d,St.e,St.f],ct.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:ct):(ct===_identity2DMatrix&&!_.offsetParent&&_!==_docElement&&!d.svg&&(St=it.display,it.display="block",pt=_.parentNode,(!pt||!_.offsetParent)&&(Ot=1,At=_.nextElementSibling,_docElement.appendChild(_)),ct=_getComputedTransformMatrixAsArray(_),St?it.display=St:_removeProperty(_,"display"),Ot&&(At?pt.insertBefore(_,At):pt?pt.appendChild(_):_docElement.removeChild(_))),_e&&ct.length>6?[ct[0],ct[1],ct[4],ct[5],ct[12],ct[13]]:ct)},_applySVGOrigin=function j(_,_e,d,it,ct,pt){var At=_._gsap,St=ct||_getMatrix(_,!0),Ot=At.xOrigin||0,Qt=At.yOrigin||0,Yt=At.xOffset||0,Vt=At.yOffset||0,qt=St[0],Jt=St[1],jt=St[2],sn=St[3],Ft=St[4],Ut=St[5],Ht=_e.split(" "),an=parseFloat(Ht[0])||0,nn=parseFloat(Ht[1])||0,dn,zt,Wt,Zt;d?St!==_identity2DMatrix&&(zt=qt*sn-Jt*jt)&&(Wt=an*(sn/zt)+nn*(-jt/zt)+(jt*Ut-sn*Ft)/zt,Zt=an*(-Jt/zt)+nn*(qt/zt)-(qt*Ut-Jt*Ft)/zt,an=Wt,nn=Zt):(dn=_getBBox(_),an=dn.x+(~Ht[0].indexOf("%")?an/100*dn.width:an),nn=dn.y+(~(Ht[1]||Ht[0]).indexOf("%")?nn/100*dn.height:nn)),it||it!==!1&&At.smooth?(Ft=an-Ot,Ut=nn-Qt,At.xOffset=Yt+(Ft*qt+Ut*jt)-Ft,At.yOffset=Vt+(Ft*Jt+Ut*sn)-Ut):At.xOffset=At.yOffset=0,At.xOrigin=an,At.yOrigin=nn,At.smooth=!!it,At.origin=_e,At.originIsAbsolute=!!d,_.style[_transformOriginProp]="0px 0px",pt&&(_addNonTweeningPT(pt,At,"xOrigin",Ot,an),_addNonTweeningPT(pt,At,"yOrigin",Qt,nn),_addNonTweeningPT(pt,At,"xOffset",Yt,At.xOffset),_addNonTweeningPT(pt,At,"yOffset",Vt,At.yOffset)),_.setAttribute("data-svg-origin",an+" "+nn)},_parseTransform=function j(_,_e){var d=_._gsap||new GSCache(_);if("x"in d&&!_e&&!d.uncache)return d;var it=_.style,ct=d.scaleX<0,pt="px",At="deg",St=getComputedStyle(_),Ot=_getComputedProperty(_,_transformOriginProp)||"0",Qt,Yt,Vt,qt,Jt,jt,sn,Ft,Ut,Ht,an,nn,dn,zt,Wt,Zt,mn,hn,zn,lr,ar,ur,Zn,wr,Vn,Kn,un,er,$n,xr,Wn,on;return Qt=Yt=Vt=jt=sn=Ft=Ut=Ht=an=0,qt=Jt=1,d.svg=!!(_.getCTM&&_isSVG(_)),St.translate&&((St.translate!=="none"||St.scale!=="none"||St.rotate!=="none")&&(it[_transformProp$1]=(St.translate!=="none"?"translate3d("+(St.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(St.rotate!=="none"?"rotate("+St.rotate+") ":"")+(St.scale!=="none"?"scale("+St.scale.split(" ").join(",")+") ":"")+(St[_transformProp$1]!=="none"?St[_transformProp$1]:"")),it.scale=it.rotate=it.translate="none"),zt=_getMatrix(_,d.svg),d.svg&&(d.uncache?(Vn=_.getBBox(),Ot=d.xOrigin-Vn.x+"px "+(d.yOrigin-Vn.y)+"px",wr=""):wr=!_e&&_.getAttribute("data-svg-origin"),_applySVGOrigin(_,wr||Ot,!!wr||d.originIsAbsolute,d.smooth!==!1,zt)),nn=d.xOrigin||0,dn=d.yOrigin||0,zt!==_identity2DMatrix&&(hn=zt[0],zn=zt[1],lr=zt[2],ar=zt[3],Qt=ur=zt[4],Yt=Zn=zt[5],zt.length===6?(qt=Math.sqrt(hn*hn+zn*zn),Jt=Math.sqrt(ar*ar+lr*lr),jt=hn||zn?_atan2(zn,hn)*_RAD2DEG:0,Ut=lr||ar?_atan2(lr,ar)*_RAD2DEG+jt:0,Ut&&(Jt*=Math.abs(Math.cos(Ut*_DEG2RAD))),d.svg&&(Qt-=nn-(nn*hn+dn*lr),Yt-=dn-(nn*zn+dn*ar))):(on=zt[6],xr=zt[7],un=zt[8],er=zt[9],$n=zt[10],Wn=zt[11],Qt=zt[12],Yt=zt[13],Vt=zt[14],Wt=_atan2(on,$n),sn=Wt*_RAD2DEG,Wt&&(Zt=Math.cos(-Wt),mn=Math.sin(-Wt),wr=ur*Zt+un*mn,Vn=Zn*Zt+er*mn,Kn=on*Zt+$n*mn,un=ur*-mn+un*Zt,er=Zn*-mn+er*Zt,$n=on*-mn+$n*Zt,Wn=xr*-mn+Wn*Zt,ur=wr,Zn=Vn,on=Kn),Wt=_atan2(-lr,$n),Ft=Wt*_RAD2DEG,Wt&&(Zt=Math.cos(-Wt),mn=Math.sin(-Wt),wr=hn*Zt-un*mn,Vn=zn*Zt-er*mn,Kn=lr*Zt-$n*mn,Wn=ar*mn+Wn*Zt,hn=wr,zn=Vn,lr=Kn),Wt=_atan2(zn,hn),jt=Wt*_RAD2DEG,Wt&&(Zt=Math.cos(Wt),mn=Math.sin(Wt),wr=hn*Zt+zn*mn,Vn=ur*Zt+Zn*mn,zn=zn*Zt-hn*mn,Zn=Zn*Zt-ur*mn,hn=wr,ur=Vn),sn&&Math.abs(sn)+Math.abs(jt)>359.9&&(sn=jt=0,Ft=180-Ft),qt=_round$1(Math.sqrt(hn*hn+zn*zn+lr*lr)),Jt=_round$1(Math.sqrt(Zn*Zn+on*on)),Wt=_atan2(ur,Zn),Ut=Math.abs(Wt)>2e-4?Wt*_RAD2DEG:0,an=Wn?1/(Wn<0?-Wn:Wn):0),d.svg&&(wr=_.getAttribute("transform"),d.forceCSS=_.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(_,_transformProp$1)),wr&&_.setAttribute("transform",wr))),Math.abs(Ut)>90&&Math.abs(Ut)<270&&(ct?(qt*=-1,Ut+=jt<=0?180:-180,jt+=jt<=0?180:-180):(Jt*=-1,Ut+=Ut<=0?180:-180)),_e=_e||d.uncache,d.x=Qt-((d.xPercent=Qt&&(!_e&&d.xPercent||(Math.round(_.offsetWidth/2)===Math.round(-Qt)?-50:0)))?_.offsetWidth*d.xPercent/100:0)+pt,d.y=Yt-((d.yPercent=Yt&&(!_e&&d.yPercent||(Math.round(_.offsetHeight/2)===Math.round(-Yt)?-50:0)))?_.offsetHeight*d.yPercent/100:0)+pt,d.z=Vt+pt,d.scaleX=_round$1(qt),d.scaleY=_round$1(Jt),d.rotation=_round$1(jt)+At,d.rotationX=_round$1(sn)+At,d.rotationY=_round$1(Ft)+At,d.skewX=Ut+At,d.skewY=Ht+At,d.transformPerspective=an+pt,(d.zOrigin=parseFloat(Ot.split(" ")[2])||0)&&(it[_transformOriginProp]=_firstTwoOnly(Ot)),d.xOffset=d.yOffset=0,d.force3D=_config.force3D,d.renderTransform=d.svg?_renderSVGTransforms:_supports3D?_renderCSSTransforms:_renderNon3DTransforms,d.uncache=0,d},_firstTwoOnly=function j(_){return(_=_.split(" "))[0]+" "+_[1]},_addPxTranslate=function j(_,_e,d){var it=getUnit(_e);return _round$1(parseFloat(_e)+parseFloat(_convertToUnit(_,"x",d+"px",it)))+it},_renderNon3DTransforms=function j(_,_e){_e.z="0px",_e.rotationY=_e.rotationX="0deg",_e.force3D=0,_renderCSSTransforms(_,_e)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function j(_,_e){var d=_e||this,it=d.xPercent,ct=d.yPercent,pt=d.x,At=d.y,St=d.z,Ot=d.rotation,Qt=d.rotationY,Yt=d.rotationX,Vt=d.skewX,qt=d.skewY,Jt=d.scaleX,jt=d.scaleY,sn=d.transformPerspective,Ft=d.force3D,Ut=d.target,Ht=d.zOrigin,an="",nn=Ft==="auto"&&_&&_!==1||Ft===!0;if(Ht&&(Yt!==_zeroDeg||Qt!==_zeroDeg)){var dn=parseFloat(Qt)*_DEG2RAD,zt=Math.sin(dn),Wt=Math.cos(dn),Zt;dn=parseFloat(Yt)*_DEG2RAD,Zt=Math.cos(dn),pt=_addPxTranslate(Ut,pt,zt*Zt*-Ht),At=_addPxTranslate(Ut,At,-Math.sin(dn)*-Ht),St=_addPxTranslate(Ut,St,Wt*Zt*-Ht+Ht)}sn!==_zeroPx&&(an+="perspective("+sn+_endParenthesis),(it||ct)&&(an+="translate("+it+"%, "+ct+"%) "),(nn||pt!==_zeroPx||At!==_zeroPx||St!==_zeroPx)&&(an+=St!==_zeroPx||nn?"translate3d("+pt+", "+At+", "+St+") ":"translate("+pt+", "+At+_endParenthesis),Ot!==_zeroDeg&&(an+="rotate("+Ot+_endParenthesis),Qt!==_zeroDeg&&(an+="rotateY("+Qt+_endParenthesis),Yt!==_zeroDeg&&(an+="rotateX("+Yt+_endParenthesis),(Vt!==_zeroDeg||qt!==_zeroDeg)&&(an+="skew("+Vt+", "+qt+_endParenthesis),(Jt!==1||jt!==1)&&(an+="scale("+Jt+", "+jt+_endParenthesis),Ut.style[_transformProp$1]=an||"translate(0, 0)"},_renderSVGTransforms=function j(_,_e){var d=_e||this,it=d.xPercent,ct=d.yPercent,pt=d.x,At=d.y,St=d.rotation,Ot=d.skewX,Qt=d.skewY,Yt=d.scaleX,Vt=d.scaleY,qt=d.target,Jt=d.xOrigin,jt=d.yOrigin,sn=d.xOffset,Ft=d.yOffset,Ut=d.forceCSS,Ht=parseFloat(pt),an=parseFloat(At),nn,dn,zt,Wt,Zt;St=parseFloat(St),Ot=parseFloat(Ot),Qt=parseFloat(Qt),Qt&&(Qt=parseFloat(Qt),Ot+=Qt,St+=Qt),St||Ot?(St*=_DEG2RAD,Ot*=_DEG2RAD,nn=Math.cos(St)*Yt,dn=Math.sin(St)*Yt,zt=Math.sin(St-Ot)*-Vt,Wt=Math.cos(St-Ot)*Vt,Ot&&(Qt*=_DEG2RAD,Zt=Math.tan(Ot-Qt),Zt=Math.sqrt(1+Zt*Zt),zt*=Zt,Wt*=Zt,Qt&&(Zt=Math.tan(Qt),Zt=Math.sqrt(1+Zt*Zt),nn*=Zt,dn*=Zt)),nn=_round$1(nn),dn=_round$1(dn),zt=_round$1(zt),Wt=_round$1(Wt)):(nn=Yt,Wt=Vt,dn=zt=0),(Ht&&!~(pt+"").indexOf("px")||an&&!~(At+"").indexOf("px"))&&(Ht=_convertToUnit(qt,"x",pt,"px"),an=_convertToUnit(qt,"y",At,"px")),(Jt||jt||sn||Ft)&&(Ht=_round$1(Ht+Jt-(Jt*nn+jt*zt)+sn),an=_round$1(an+jt-(Jt*dn+jt*Wt)+Ft)),(it||ct)&&(Zt=qt.getBBox(),Ht=_round$1(Ht+it/100*Zt.width),an=_round$1(an+ct/100*Zt.height)),Zt="matrix("+nn+","+dn+","+zt+","+Wt+","+Ht+","+an+")",qt.setAttribute("transform",Zt),Ut&&(qt.style[_transformProp$1]=Zt)},_addRotationalPropTween=function j(_,_e,d,it,ct){var pt=360,At=_isString$1(ct),St=parseFloat(ct)*(At&&~ct.indexOf("rad")?_RAD2DEG:1),Ot=St-it,Qt=it+Ot+"deg",Yt,Vt;return At&&(Yt=ct.split("_")[1],Yt==="short"&&(Ot%=pt,Ot!==Ot%(pt/2)&&(Ot+=Ot<0?pt:-pt)),Yt==="cw"&&Ot<0?Ot=(Ot+pt*_bigNum)%pt-~~(Ot/pt)*pt:Yt==="ccw"&&Ot>0&&(Ot=(Ot-pt*_bigNum)%pt-~~(Ot/pt)*pt)),_._pt=Vt=new PropTween(_._pt,_e,d,it,Ot,_renderPropWithEnd),Vt.e=Qt,Vt.u="deg",_._props.push(d),Vt},_assign=function j(_,_e){for(var d in _e)_[d]=_e[d];return _},_addRawTransformPTs=function j(_,_e,d){var it=_assign({},d._gsap),ct="perspective,force3D,transformOrigin,svgOrigin",pt=d.style,At,St,Ot,Qt,Yt,Vt,qt,Jt;it.svg?(Ot=d.getAttribute("transform"),d.setAttribute("transform",""),pt[_transformProp$1]=_e,At=_parseTransform(d,1),_removeProperty(d,_transformProp$1),d.setAttribute("transform",Ot)):(Ot=getComputedStyle(d)[_transformProp$1],pt[_transformProp$1]=_e,At=_parseTransform(d,1),pt[_transformProp$1]=Ot);for(St in _transformProps)Ot=it[St],Qt=At[St],Ot!==Qt&&ct.indexOf(St)<0&&(qt=getUnit(Ot),Jt=getUnit(Qt),Yt=qt!==Jt?_convertToUnit(d,St,Ot,Jt):parseFloat(Ot),Vt=parseFloat(Qt),_._pt=new PropTween(_._pt,At,St,Yt,Vt-Yt,_renderCSSProp),_._pt.u=Jt||0,_._props.push(St));_assign(At,it)};_forEachName("padding,margin,Width,Radius",function(j,_){var _e="Top",d="Right",it="Bottom",ct="Left",pt=(_<3?[_e,d,it,ct]:[_e+ct,_e+d,it+d,it+ct]).map(function(At){return _<2?j+At:"border"+At+j});_specialProps[_>1?"border"+j:j]=function(At,St,Ot,Qt,Yt){var Vt,qt;if(arguments.length<4)return Vt=pt.map(function(Jt){return _get(At,Jt,Ot)}),qt=Vt.join(" "),qt.split(Vt[0]).length===5?Vt[0]:qt;Vt=(Qt+"").split(" "),qt={},pt.forEach(function(Jt,jt){return qt[Jt]=Vt[jt]=Vt[jt]||Vt[(jt-1)/2|0]}),At.init(St,qt,Yt)}});var CSSPlugin={name:"css",register:_initCore$1,targetTest:function j(_){return _.style&&_.nodeType},init:function j(_,_e,d,it,ct){var pt=this._props,At=_.style,St=d.vars.startAt,Ot,Qt,Yt,Vt,qt,Jt,jt,sn,Ft,Ut,Ht,an,nn,dn,zt,Wt;_pluginInitted||_initCore$1(),this.styles=this.styles||_getStyleSaver(_),Wt=this.styles.props,this.tween=d;for(jt in _e)if(jt!=="autoRound"&&(Qt=_e[jt],!(_plugins[jt]&&_checkPlugin(jt,_e,d,it,_,ct)))){if(qt=typeof Qt,Jt=_specialProps[jt],qt==="function"&&(Qt=Qt.call(d,it,_,ct),qt=typeof Qt),qt==="string"&&~Qt.indexOf("random(")&&(Qt=_replaceRandom(Qt)),Jt)Jt(this,_,jt,Qt,d)&&(zt=1);else if(jt.substr(0,2)==="--")Ot=(getComputedStyle(_).getPropertyValue(jt)+"").trim(),Qt+="",_colorExp.lastIndex=0,_colorExp.test(Ot)||(sn=getUnit(Ot),Ft=getUnit(Qt)),Ft?sn!==Ft&&(Ot=_convertToUnit(_,jt,Ot,Ft)+Ft):sn&&(Qt+=sn),this.add(At,"setProperty",Ot,Qt,it,ct,0,0,jt),pt.push(jt),Wt.push(jt,0,At[jt]);else if(qt!=="undefined"){if(St&&jt in St?(Ot=typeof St[jt]=="function"?St[jt].call(d,it,_,ct):St[jt],_isString$1(Ot)&&~Ot.indexOf("random(")&&(Ot=_replaceRandom(Ot)),getUnit(Ot+"")||(Ot+=_config.units[jt]||getUnit(_get(_,jt))||""),(Ot+"").charAt(1)==="="&&(Ot=_get(_,jt))):Ot=_get(_,jt),Vt=parseFloat(Ot),Ut=qt==="string"&&Qt.charAt(1)==="="&&Qt.substr(0,2),Ut&&(Qt=Qt.substr(2)),Yt=parseFloat(Qt),jt in _propertyAliases&&(jt==="autoAlpha"&&(Vt===1&&_get(_,"visibility")==="hidden"&&Yt&&(Vt=0),Wt.push("visibility",0,At.visibility),_addNonTweeningPT(this,At,"visibility",Vt?"inherit":"hidden",Yt?"inherit":"hidden",!Yt)),jt!=="scale"&&jt!=="transform"&&(jt=_propertyAliases[jt],~jt.indexOf(",")&&(jt=jt.split(",")[0]))),Ht=jt in _transformProps,Ht){if(this.styles.save(jt),an||(nn=_._gsap,nn.renderTransform&&!_e.parseTransform||_parseTransform(_,_e.parseTransform),dn=_e.smoothOrigin!==!1&&nn.smooth,an=this._pt=new PropTween(this._pt,At,_transformProp$1,0,1,nn.renderTransform,nn,0,-1),an.dep=1),jt==="scale")this._pt=new PropTween(this._pt,nn,"scaleY",nn.scaleY,(Ut?_parseRelative(nn.scaleY,Ut+Yt):Yt)-nn.scaleY||0,_renderCSSProp),this._pt.u=0,pt.push("scaleY",jt),jt+="X";else if(jt==="transformOrigin"){Wt.push(_transformOriginProp,0,At[_transformOriginProp]),Qt=_convertKeywordsToPercentages(Qt),nn.svg?_applySVGOrigin(_,Qt,0,dn,0,this):(Ft=parseFloat(Qt.split(" ")[2])||0,Ft!==nn.zOrigin&&_addNonTweeningPT(this,nn,"zOrigin",nn.zOrigin,Ft),_addNonTweeningPT(this,At,jt,_firstTwoOnly(Ot),_firstTwoOnly(Qt)));continue}else if(jt==="svgOrigin"){_applySVGOrigin(_,Qt,1,dn,0,this);continue}else if(jt in _rotationalProperties){_addRotationalPropTween(this,nn,jt,Vt,Ut?_parseRelative(Vt,Ut+Qt):Qt);continue}else if(jt==="smoothOrigin"){_addNonTweeningPT(this,nn,"smooth",nn.smooth,Qt);continue}else if(jt==="force3D"){nn[jt]=Qt;continue}else if(jt==="transform"){_addRawTransformPTs(this,Qt,_);continue}}else jt in At||(jt=_checkPropPrefix(jt)||jt);if(Ht||(Yt||Yt===0)&&(Vt||Vt===0)&&!_complexExp.test(Qt)&&jt in At)sn=(Ot+"").substr((Vt+"").length),Yt||(Yt=0),Ft=getUnit(Qt)||(jt in _config.units?_config.units[jt]:sn),sn!==Ft&&(Vt=_convertToUnit(_,jt,Ot,Ft)),this._pt=new PropTween(this._pt,Ht?nn:At,jt,Vt,(Ut?_parseRelative(Vt,Ut+Yt):Yt)-Vt,!Ht&&(Ft==="px"||jt==="zIndex")&&_e.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=Ft||0,sn!==Ft&&Ft!=="%"&&(this._pt.b=Ot,this._pt.r=_renderCSSPropWithBeginning);else if(jt in At)_tweenComplexCSSString.call(this,_,jt,Ot,Ut?Ut+Qt:Qt);else if(jt in _)this.add(_,jt,Ot||_[jt],Ut?Ut+Qt:Qt,it,ct);else if(jt!=="parseTransform"){_missingPlugin(jt,Qt);continue}Ht||(jt in At?Wt.push(jt,0,At[jt]):Wt.push(jt,1,Ot||_[jt])),pt.push(jt)}}zt&&_sortPropTweensByPriority(this)},render:function j(_,_e){if(_e.tween._time||!_reverting())for(var d=_e._pt;d;)d.r(_,d.d),d=d._next;else _e.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function j(_,_e,d){var it=_propertyAliases[_e];return it&&it.indexOf(",")<0&&(_e=it),_e in _transformProps&&_e!==_transformOriginProp&&(_._gsap.x||_get(_,"x"))?d&&_recentSetterPlugin===d?_e==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=d||{})&&(_e==="scale"?_setterScaleWithRender:_setterTransformWithRender):_.style&&!_isUndefined(_.style[_e])?_setterCSSStyle:~_e.indexOf("-")?_setterCSSProp:_getSetter(_,_e)},core:{_removeProperty,_getMatrix}};gsap$2.utils.checkPrefix=_checkPropPrefix;gsap$2.core.getStyleSaver=_getStyleSaver;(function(j,_,_e,d){var it=_forEachName(j+","+_+","+_e,function(ct){_transformProps[ct]=1});_forEachName(_,function(ct){_config.units[ct]="deg",_rotationalProperties[ct]=1}),_propertyAliases[it[13]]=j+","+_,_forEachName(d,function(ct){var pt=ct.split(":");_propertyAliases[pt[1]]=it[pt[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(j){_config.units[j]="px"});gsap$2.registerPlugin(CSSPlugin);var gsapWithCSS=gsap$2.registerPlugin(CSSPlugin)||gsap$2;gsapWithCSS.core.Tween;function _defineProperties(j,_){for(var _e=0;_e<_.length;_e++){var d=_[_e];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(j,d.key,d)}}function _createClass(j,_,_e){return _&&_defineProperties(j.prototype,_),_e&&_defineProperties(j,_e),j}/*!
 * Observer 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$1,_coreInitted$1,_win$1,_doc$1,_docEl$1,_body$1,_isTouch,_pointerType,ScrollTrigger$1,_root$1,_normalizer$1,_eventTypes,_context$1,_getGSAP$1=function j(){return gsap$1||typeof window<"u"&&(gsap$1=window.gsap)&&gsap$1.registerPlugin&&gsap$1},_startup$1=1,_observers=[],_scrollers=[],_proxies=[],_getTime$1=Date.now,_bridge=function j(_,_e){return _e},_integrate=function j(){var _=ScrollTrigger$1.core,_e=_.bridge||{},d=_._scrollers,it=_._proxies;d.push.apply(d,_scrollers),it.push.apply(it,_proxies),_scrollers=d,_proxies=it,_bridge=function(pt,At){return _e[pt](At)}},_getProxyProp=function j(_,_e){return~_proxies.indexOf(_)&&_proxies[_proxies.indexOf(_)+1][_e]},_isViewport$1=function j(_){return!!~_root$1.indexOf(_)},_addListener$1=function j(_,_e,d,it,ct){return _.addEventListener(_e,d,{passive:!it,capture:!!ct})},_removeListener$1=function j(_,_e,d,it){return _.removeEventListener(_e,d,!!it)},_scrollLeft="scrollLeft",_scrollTop="scrollTop",_onScroll$1=function j(){return _normalizer$1&&_normalizer$1.isPressed||_scrollers.cache++},_scrollCacheFunc=function j(_,_e){var d=function it(ct){if(ct||ct===0){_startup$1&&(_win$1.history.scrollRestoration="manual");var pt=_normalizer$1&&_normalizer$1.isPressed;ct=it.v=Math.round(ct)||(_normalizer$1&&_normalizer$1.iOS?1:0),_(ct),it.cacheID=_scrollers.cache,pt&&_bridge("ss",ct)}else(_e||_scrollers.cache!==it.cacheID||_bridge("ref"))&&(it.cacheID=_scrollers.cache,it.v=_());return it.v+it.offset};return d.offset=0,_&&d},_horizontal={s:_scrollLeft,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:_scrollCacheFunc(function(j){return arguments.length?_win$1.scrollTo(j,_vertical.sc()):_win$1.pageXOffset||_doc$1[_scrollLeft]||_docEl$1[_scrollLeft]||_body$1[_scrollLeft]||0})},_vertical={s:_scrollTop,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_horizontal,sc:_scrollCacheFunc(function(j){return arguments.length?_win$1.scrollTo(_horizontal.sc(),j):_win$1.pageYOffset||_doc$1[_scrollTop]||_docEl$1[_scrollTop]||_body$1[_scrollTop]||0})},_getTarget=function j(_){return gsap$1.utils.toArray(_)[0]||(typeof _=="string"&&gsap$1.config().nullTargetWarn!==!1?console.warn("Element not found:",_):null)},_getScrollFunc=function j(_,_e){var d=_e.s,it=_e.sc;_isViewport$1(_)&&(_=_doc$1.scrollingElement||_docEl$1);var ct=_scrollers.indexOf(_),pt=it===_vertical.sc?1:2;!~ct&&(ct=_scrollers.push(_)-1),_scrollers[ct+pt]||_.addEventListener("scroll",_onScroll$1);var At=_scrollers[ct+pt],St=At||(_scrollers[ct+pt]=_scrollCacheFunc(_getProxyProp(_,d),!0)||(_isViewport$1(_)?it:_scrollCacheFunc(function(Ot){return arguments.length?_[d]=Ot:_[d]})));return St.target=_,At||(St.smooth=gsap$1.getProperty(_,"scrollBehavior")==="smooth"),St},_getVelocityProp=function j(_,_e,d){var it=_,ct=_,pt=_getTime$1(),At=pt,St=_e||50,Ot=Math.max(500,St*3),Qt=function(Jt,jt){var sn=_getTime$1();jt||sn-pt>St?(ct=it,it=Jt,At=pt,pt=sn):d?it+=Jt:it=ct+(Jt-ct)/(sn-At)*(pt-At)},Yt=function(){ct=it=d?0:it,At=pt=0},Vt=function(Jt){var jt=At,sn=ct,Ft=_getTime$1();return(Jt||Jt===0)&&Jt!==it&&Qt(Jt),pt===At||Ft-At>Ot?0:(it+(d?sn:-sn))/((d?Ft:pt)-jt)*1e3};return{update:Qt,reset:Yt,getVelocity:Vt}},_getEvent=function j(_,_e){return _e&&!_._gsapAllow&&_.preventDefault(),_.changedTouches?_.changedTouches[0]:_},_getAbsoluteMax=function j(_){var _e=Math.max.apply(Math,_),d=Math.min.apply(Math,_);return Math.abs(_e)>=Math.abs(d)?_e:d},_setScrollTrigger=function j(){ScrollTrigger$1=gsap$1.core.globals().ScrollTrigger,ScrollTrigger$1&&ScrollTrigger$1.core&&_integrate()},_initCore=function j(_){return gsap$1=_||_getGSAP$1(),gsap$1&&typeof document<"u"&&document.body&&(_win$1=window,_doc$1=document,_docEl$1=_doc$1.documentElement,_body$1=_doc$1.body,_root$1=[_win$1,_doc$1,_docEl$1,_body$1],gsap$1.utils.clamp,_context$1=gsap$1.core.context||function(){},_pointerType="onpointerenter"in _body$1?"pointer":"mouse",_isTouch=Observer.isTouch=_win$1.matchMedia&&_win$1.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in _win$1||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_eventTypes=Observer.eventTypes=("ontouchstart"in _docEl$1?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in _docEl$1?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return _startup$1=0},500),_setScrollTrigger(),_coreInitted$1=1),_coreInitted$1};_horizontal.op=_vertical;_scrollers.cache=0;var Observer=function(){function j(_e){this.init(_e)}var _=j.prototype;return _.init=function(d){_coreInitted$1||_initCore(gsap$1)||console.warn("Please gsap.registerPlugin(Observer)"),ScrollTrigger$1||_setScrollTrigger();var it=d.tolerance,ct=d.dragMinimum,pt=d.type,At=d.target,St=d.lineHeight,Ot=d.debounce,Qt=d.preventDefault,Yt=d.onStop,Vt=d.onStopDelay,qt=d.ignore,Jt=d.wheelSpeed,jt=d.event,sn=d.onDragStart,Ft=d.onDragEnd,Ut=d.onDrag,Ht=d.onPress,an=d.onRelease,nn=d.onRight,dn=d.onLeft,zt=d.onUp,Wt=d.onDown,Zt=d.onChangeX,mn=d.onChangeY,hn=d.onChange,zn=d.onToggleX,lr=d.onToggleY,ar=d.onHover,ur=d.onHoverEnd,Zn=d.onMove,wr=d.ignoreCheck,Vn=d.isNormalizer,Kn=d.onGestureStart,un=d.onGestureEnd,er=d.onWheel,$n=d.onEnable,xr=d.onDisable,Wn=d.onClick,on=d.scrollSpeed,pn=d.capture,On=d.allowClicks,Tr=d.lockAxis,kr=d.onLockAxis;this.target=At=_getTarget(At)||_docEl$1,this.vars=d,qt&&(qt=gsap$1.utils.toArray(qt)),it=it||1e-9,ct=ct||0,Jt=Jt||1,on=on||1,pt=pt||"wheel,touch,pointer",Ot=Ot!==!1,St||(St=parseFloat(_win$1.getComputedStyle(_body$1).lineHeight)||22);var Br,ds,is,Us,Os,go,ks,or=this,to=0,co=0,Bl=_getScrollFunc(At,_horizontal),Oo=_getScrollFunc(At,_vertical),Mo=Bl(),To=Oo(),Io=~pt.indexOf("touch")&&!~pt.indexOf("pointer")&&_eventTypes[0]==="pointerdown",Hl=_isViewport$1(At),vo=At.ownerDocument||_doc$1,no=[0,0,0],Al=[0,0,0],qo=0,Lo=function(){return qo=_getTime$1()},Pp=function(Xr,br){return(or.event=Xr)&&qt&&~qt.indexOf(Xr.target)||br&&Io&&Xr.pointerType!=="touch"||wr&&wr(Xr,br)},Yo=function(){or._vx.reset(),or._vy.reset(),ds.pause(),Yt&&Yt(or)},du=function(){var Xr=or.deltaX=_getAbsoluteMax(no),br=or.deltaY=_getAbsoluteMax(Al),Is=Math.abs(Xr)>=it,Ps=Math.abs(br)>=it;hn&&(Is||Ps)&&hn(or,Xr,br,no,Al),Is&&(nn&&or.deltaX>0&&nn(or),dn&&or.deltaX<0&&dn(or),Zt&&Zt(or),zn&&or.deltaX<0!=to<0&&zn(or),to=or.deltaX,no[0]=no[1]=no[2]=0),Ps&&(Wt&&or.deltaY>0&&Wt(or),zt&&or.deltaY<0&&zt(or),mn&&mn(or),lr&&or.deltaY<0!=co<0&&lr(or),co=or.deltaY,Al[0]=Al[1]=Al[2]=0),(Us||is)&&(Zn&&Zn(or),is&&(Ut(or),is=!1),Us=!1),go&&!(go=!1)&&kr&&kr(or),Os&&(er(or),Os=!1),Br=0},Vo=function(Xr,br,Is){no[Is]+=Xr,Al[Is]+=br,or._vx.update(Xr),or._vy.update(br),Ot?Br||(Br=requestAnimationFrame(du)):du()},Mu=function(Xr,br){Tr&&!ks&&(or.axis=ks=Math.abs(Xr)>Math.abs(br)?"x":"y",go=!0),ks!=="y"&&(no[2]+=Xr,or._vx.update(Xr,!0)),ks!=="x"&&(Al[2]+=br,or._vy.update(br,!0)),Ot?Br||(Br=requestAnimationFrame(du)):du()},Dp=function(Xr){if(!Pp(Xr,1)){Xr=_getEvent(Xr,Qt);var br=Xr.clientX,Is=Xr.clientY,Ps=br-or.x,bs=Is-or.y,Qo=or.isDragging;or.x=br,or.y=Is,(Qo||Math.abs(or.startX-br)>=ct||Math.abs(or.startY-Is)>=ct)&&(Ut&&(is=!0),Qo||(or.isDragging=!0),Mu(Ps,bs),Qo||sn&&sn(or))}},hs=or.onPress=function(Gs){Pp(Gs,1)||(or.axis=ks=null,ds.pause(),or.isPressed=!0,Gs=_getEvent(Gs),to=co=0,or.startX=or.x=Gs.clientX,or.startY=or.y=Gs.clientY,or._vx.reset(),or._vy.reset(),_addListener$1(Vn?At:vo,_eventTypes[1],Dp,Qt,!0),or.deltaX=or.deltaY=0,Ht&&Ht(or))},So=function(Xr){if(!Pp(Xr,1)){_removeListener$1(Vn?At:vo,_eventTypes[1],Dp,!0);var br=!isNaN(or.y-or.startY),Is=or.isDragging&&(Math.abs(or.x-or.startX)>3||Math.abs(or.y-or.startY)>3),Ps=_getEvent(Xr);!Is&&br&&(or._vx.reset(),or._vy.reset(),Qt&&On&&gsap$1.delayedCall(.08,function(){if(_getTime$1()-qo>300&&!Xr.defaultPrevented){if(Xr.target.click)Xr.target.click();else if(vo.createEvent){var bs=vo.createEvent("MouseEvents");bs.initMouseEvent("click",!0,!0,_win$1,1,Ps.screenX,Ps.screenY,Ps.clientX,Ps.clientY,!1,!1,!1,!1,0,null),Xr.target.dispatchEvent(bs)}}})),or.isDragging=or.isGesturing=or.isPressed=!1,Yt&&!Vn&&ds.restart(!0),Ft&&Is&&Ft(or),an&&an(or,Is)}},$l=function(Xr){return Xr.touches&&Xr.touches.length>1&&(or.isGesturing=!0)&&Kn(Xr,or.isDragging)},Cl=function(){return(or.isGesturing=!1)||un(or)},rp=function(Xr){if(!Pp(Xr)){var br=Bl(),Is=Oo();Vo((br-Mo)*on,(Is-To)*on,1),Mo=br,To=Is,Yt&&ds.restart(!0)}},Hu=function(Xr){if(!Pp(Xr)){Xr=_getEvent(Xr,Qt),er&&(Os=!0);var br=(Xr.deltaMode===1?St:Xr.deltaMode===2?_win$1.innerHeight:1)*Jt;Vo(Xr.deltaX*br,Xr.deltaY*br,0),Yt&&!Vn&&ds.restart(!0)}},vp=function(Xr){if(!Pp(Xr)){var br=Xr.clientX,Is=Xr.clientY,Ps=br-or.x,bs=Is-or.y;or.x=br,or.y=Is,Us=!0,(Ps||bs)&&Mu(Ps,bs)}},Qn=function(Xr){or.event=Xr,ar(or)},ba=function(Xr){or.event=Xr,ur(or)},Wu=function(Xr){return Pp(Xr)||_getEvent(Xr,Qt)&&Wn(or)};ds=or._dc=gsap$1.delayedCall(Vt||.25,Yo).pause(),or.deltaX=or.deltaY=0,or._vx=_getVelocityProp(0,50,!0),or._vy=_getVelocityProp(0,50,!0),or.scrollX=Bl,or.scrollY=Oo,or.isDragging=or.isGesturing=or.isPressed=!1,_context$1(this),or.enable=function(Gs){return or.isEnabled||(_addListener$1(Hl?vo:At,"scroll",_onScroll$1),pt.indexOf("scroll")>=0&&_addListener$1(Hl?vo:At,"scroll",rp,Qt,pn),pt.indexOf("wheel")>=0&&_addListener$1(At,"wheel",Hu,Qt,pn),(pt.indexOf("touch")>=0&&_isTouch||pt.indexOf("pointer")>=0)&&(_addListener$1(At,_eventTypes[0],hs,Qt,pn),_addListener$1(vo,_eventTypes[2],So),_addListener$1(vo,_eventTypes[3],So),On&&_addListener$1(At,"click",Lo,!1,!0),Wn&&_addListener$1(At,"click",Wu),Kn&&_addListener$1(vo,"gesturestart",$l),un&&_addListener$1(vo,"gestureend",Cl),ar&&_addListener$1(At,_pointerType+"enter",Qn),ur&&_addListener$1(At,_pointerType+"leave",ba),Zn&&_addListener$1(At,_pointerType+"move",vp)),or.isEnabled=!0,Gs&&Gs.type&&hs(Gs),$n&&$n(or)),or},or.disable=function(){or.isEnabled&&(_observers.filter(function(Gs){return Gs!==or&&_isViewport$1(Gs.target)}).length||_removeListener$1(Hl?vo:At,"scroll",_onScroll$1),or.isPressed&&(or._vx.reset(),or._vy.reset(),_removeListener$1(Vn?At:vo,_eventTypes[1],Dp,!0)),_removeListener$1(Hl?vo:At,"scroll",rp,pn),_removeListener$1(At,"wheel",Hu,pn),_removeListener$1(At,_eventTypes[0],hs,pn),_removeListener$1(vo,_eventTypes[2],So),_removeListener$1(vo,_eventTypes[3],So),_removeListener$1(At,"click",Lo,!0),_removeListener$1(At,"click",Wu),_removeListener$1(vo,"gesturestart",$l),_removeListener$1(vo,"gestureend",Cl),_removeListener$1(At,_pointerType+"enter",Qn),_removeListener$1(At,_pointerType+"leave",ba),_removeListener$1(At,_pointerType+"move",vp),or.isEnabled=or.isPressed=or.isDragging=!1,xr&&xr(or))},or.kill=or.revert=function(){or.disable();var Gs=_observers.indexOf(or);Gs>=0&&_observers.splice(Gs,1),_normalizer$1===or&&(_normalizer$1=0)},_observers.push(or),Vn&&_isViewport$1(At)&&(_normalizer$1=or),or.enable(jt)},_createClass(j,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),j}();Observer.version="3.11.4";Observer.create=function(j){return new Observer(j)};Observer.register=_initCore;Observer.getAll=function(){return _observers.slice()};Observer.getById=function(j){return _observers.filter(function(_){return _.vars.id===j})[0]};_getGSAP$1()&&gsap$1.registerPlugin(Observer);/*!
 * ScrollTrigger 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap,_coreInitted,_win,_doc,_docEl,_body,_root,_resizeDelay,_toArray,_clamp,_time2,_syncInterval,_refreshing,_pointerIsDown,_transformProp,_i,_prevWidth,_prevHeight,_autoRefresh,_sort,_suppressOverwrites,_ignoreResize,_normalizer,_ignoreMobileResize,_baseScreenHeight,_baseScreenWidth,_fixIOSBug,_context,_scrollRestoration,_limitCallbacks,_startup=1,_getTime=Date.now,_time1=_getTime(),_lastScrollTime=0,_enabled=0,_pointerDownHandler=function j(){return _pointerIsDown=1},_pointerUpHandler=function j(){return _pointerIsDown=0},_passThrough=function j(_){return _},_round=function j(_){return Math.round(_*1e5)/1e5||0},_windowExists=function j(){return typeof window<"u"},_getGSAP=function j(){return gsap||_windowExists()&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_isViewport=function j(_){return!!~_root.indexOf(_)},_getBoundsFunc=function j(_){return _getProxyProp(_,"getBoundingClientRect")||(_isViewport(_)?function(){return _winOffsets.width=_win.innerWidth,_winOffsets.height=_win.innerHeight,_winOffsets}:function(){return _getBounds(_)})},_getSizeFunc=function j(_,_e,d){var it=d.d,ct=d.d2,pt=d.a;return(pt=_getProxyProp(_,"getBoundingClientRect"))?function(){return pt()[it]}:function(){return(_e?_win["inner"+ct]:_["client"+ct])||0}},_getOffsetsFunc=function j(_,_e){return!_e||~_proxies.indexOf(_)?_getBoundsFunc(_):function(){return _winOffsets}},_maxScroll=function j(_,_e){var d=_e.s,it=_e.d2,ct=_e.d,pt=_e.a;return(d="scroll"+it)&&(pt=_getProxyProp(_,d))?pt()-_getBoundsFunc(_)()[ct]:_isViewport(_)?(_docEl[d]||_body[d])-(_win["inner"+it]||_docEl["client"+it]||_body["client"+it]):_[d]-_["offset"+it]},_iterateAutoRefresh=function j(_,_e){for(var d=0;d<_autoRefresh.length;d+=3)(!_e||~_e.indexOf(_autoRefresh[d+1]))&&_(_autoRefresh[d],_autoRefresh[d+1],_autoRefresh[d+2])},_isString=function j(_){return typeof _=="string"},_isFunction=function j(_){return typeof _=="function"},_isNumber=function j(_){return typeof _=="number"},_isObject=function j(_){return typeof _=="object"},_endAnimation=function j(_,_e,d){return _&&_.progress(_e?0:1)&&d&&_.pause()},_callback=function j(_,_e){if(_.enabled){var d=_e(_);d&&d.totalTime&&(_.callbackAnimation=d)}},_abs=Math.abs,_left="left",_top="top",_right="right",_bottom="bottom",_width="width",_height="height",_Right="Right",_Left="Left",_Top="Top",_Bottom="Bottom",_padding="padding",_margin="margin",_Width="Width",_Height="Height",_px="px",_getComputedStyle=function j(_){return _win.getComputedStyle(_)},_makePositionable=function j(_){var _e=_getComputedStyle(_).position;_.style.position=_e==="absolute"||_e==="fixed"?_e:"relative"},_setDefaults=function j(_,_e){for(var d in _e)d in _||(_[d]=_e[d]);return _},_getBounds=function j(_,_e){var d=_e&&_getComputedStyle(_)[_transformProp]!=="matrix(1, 0, 0, 1, 0, 0)"&&gsap.to(_,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),it=_.getBoundingClientRect();return d&&d.progress(0).kill(),it},_getSize=function j(_,_e){var d=_e.d2;return _["offset"+d]||_["client"+d]||0},_getLabelRatioArray=function j(_){var _e=[],d=_.labels,it=_.duration(),ct;for(ct in d)_e.push(d[ct]/it);return _e},_getClosestLabel=function j(_){return function(_e){return gsap.utils.snap(_getLabelRatioArray(_),_e)}},_snapDirectional=function j(_){var _e=gsap.utils.snap(_),d=Array.isArray(_)&&_.slice(0).sort(function(it,ct){return it-ct});return d?function(it,ct,pt){pt===void 0&&(pt=.001);var At;if(!ct)return _e(it);if(ct>0){for(it-=pt,At=0;At<d.length;At++)if(d[At]>=it)return d[At];return d[At-1]}else for(At=d.length,it+=pt;At--;)if(d[At]<=it)return d[At];return d[0]}:function(it,ct,pt){pt===void 0&&(pt=.001);var At=_e(it);return!ct||Math.abs(At-it)<pt||At-it<0==ct<0?At:_e(ct<0?it-_:it+_)}},_getLabelAtDirection=function j(_){return function(_e,d){return _snapDirectional(_getLabelRatioArray(_))(_e,d.direction)}},_multiListener=function j(_,_e,d,it){return d.split(",").forEach(function(ct){return _(_e,ct,it)})},_addListener=function j(_,_e,d,it,ct){return _.addEventListener(_e,d,{passive:!it,capture:!!ct})},_removeListener=function j(_,_e,d,it){return _.removeEventListener(_e,d,!!it)},_wheelListener=function j(_,_e,d){return d&&d.wheelHandler&&_(_e,"wheel",d)},_markerDefaults={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},_defaults={toggleActions:"play",anticipatePin:0},_keywords={top:0,left:0,center:.5,bottom:1,right:1},_offsetToPx=function j(_,_e){if(_isString(_)){var d=_.indexOf("="),it=~d?+(_.charAt(d-1)+1)*parseFloat(_.substr(d+1)):0;~d&&(_.indexOf("%")>d&&(it*=_e/100),_=_.substr(0,d-1)),_=it+(_ in _keywords?_keywords[_]*_e:~_.indexOf("%")?parseFloat(_)*_e/100:parseFloat(_)||0)}return _},_createMarker=function j(_,_e,d,it,ct,pt,At,St){var Ot=ct.startColor,Qt=ct.endColor,Yt=ct.fontSize,Vt=ct.indent,qt=ct.fontWeight,Jt=_doc.createElement("div"),jt=_isViewport(d)||_getProxyProp(d,"pinType")==="fixed",sn=_.indexOf("scroller")!==-1,Ft=jt?_body:d,Ut=_.indexOf("start")!==-1,Ht=Ut?Ot:Qt,an="border-color:"+Ht+";font-size:"+Yt+";color:"+Ht+";font-weight:"+qt+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return an+="position:"+((sn||St)&&jt?"fixed;":"absolute;"),(sn||St||!jt)&&(an+=(it===_vertical?_right:_bottom)+":"+(pt+parseFloat(Vt))+"px;"),At&&(an+="box-sizing:border-box;text-align:left;width:"+At.offsetWidth+"px;"),Jt._isStart=Ut,Jt.setAttribute("class","gsap-marker-"+_+(_e?" marker-"+_e:"")),Jt.style.cssText=an,Jt.innerText=_e||_e===0?_+"-"+_e:_,Ft.children[0]?Ft.insertBefore(Jt,Ft.children[0]):Ft.appendChild(Jt),Jt._offset=Jt["offset"+it.op.d2],_positionMarker(Jt,0,it,Ut),Jt},_positionMarker=function j(_,_e,d,it){var ct={display:"block"},pt=d[it?"os2":"p2"],At=d[it?"p2":"os2"];_._isFlipped=it,ct[d.a+"Percent"]=it?-100:0,ct[d.a]=it?"1px":0,ct["border"+pt+_Width]=1,ct["border"+At+_Width]=0,ct[d.p]=_e+"px",gsap.set(_,ct)},_triggers=[],_ids={},_rafID,_sync=function j(){return _getTime()-_lastScrollTime>34&&(_rafID||(_rafID=requestAnimationFrame(_updateAll)))},_onScroll=function j(){(!_normalizer||!_normalizer.isPressed||_normalizer.startX>_body.clientWidth)&&(_scrollers.cache++,_normalizer?_rafID||(_rafID=requestAnimationFrame(_updateAll)):_updateAll(),_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime())},_setBaseDimensions=function j(){_baseScreenWidth=_win.innerWidth,_baseScreenHeight=_win.innerHeight},_onResize=function j(){_scrollers.cache++,!_refreshing&&!_ignoreResize&&!_doc.fullscreenElement&&!_doc.webkitFullscreenElement&&(!_ignoreMobileResize||_baseScreenWidth!==_win.innerWidth||Math.abs(_win.innerHeight-_baseScreenHeight)>_win.innerHeight*.25)&&_resizeDelay.restart(!0)},_listeners={},_emptyArray=[],_softRefresh=function j(){return _removeListener(ScrollTrigger,"scrollEnd",j)||_refreshAll(!0)},_dispatch=function j(_){return _listeners[_]&&_listeners[_].map(function(_e){return _e()})||_emptyArray},_savedStyles=[],_revertRecorded=function j(_){for(var _e=0;_e<_savedStyles.length;_e+=5)(!_||_savedStyles[_e+4]&&_savedStyles[_e+4].query===_)&&(_savedStyles[_e].style.cssText=_savedStyles[_e+1],_savedStyles[_e].getBBox&&_savedStyles[_e].setAttribute("transform",_savedStyles[_e+2]||""),_savedStyles[_e+3].uncache=1)},_revertAll=function j(_,_e){var d;for(_i=0;_i<_triggers.length;_i++)d=_triggers[_i],d&&(!_e||d._ctx===_e)&&(_?d.kill(1):d.revert(!0,!0));_e&&_revertRecorded(_e),_e||_dispatch("revert")},_clearScrollMemory=function j(_,_e){_scrollers.cache++,(_e||!_refreshingAll)&&_scrollers.forEach(function(d){return _isFunction(d)&&d.cacheID++&&(d.rec=0)}),_isString(_)&&(_win.history.scrollRestoration=_scrollRestoration=_)},_refreshingAll,_refreshID=0,_queueRefreshID,_queueRefreshAll=function j(){if(_queueRefreshID!==_refreshID){var _=_queueRefreshID=_refreshID;requestAnimationFrame(function(){return _===_refreshID&&_refreshAll(!0)})}},_refreshAll=function j(_,_e){if(_lastScrollTime&&!_){_addListener(ScrollTrigger,"scrollEnd",_softRefresh);return}_refreshingAll=ScrollTrigger.isRefreshing=!0,_scrollers.forEach(function(it){return _isFunction(it)&&it.cacheID++&&(it.rec=it())});var d=_dispatch("refreshInit");_sort&&ScrollTrigger.sort(),_e||_revertAll(),_scrollers.forEach(function(it){_isFunction(it)&&(it.smooth&&(it.target.style.scrollBehavior="auto"),it(0))}),_triggers.slice(0).forEach(function(it){return it.refresh()}),_triggers.forEach(function(it,ct){if(it._subPinOffset&&it.pin){var pt=it.vars.horizontal?"offsetWidth":"offsetHeight",At=it.pin[pt];it.revert(!0,1),it.adjustPinSpacing(it.pin[pt]-At),it.revert(!1,1)}}),_triggers.forEach(function(it){return it.vars.end==="max"&&it.setPositions(it.start,Math.max(it.start+1,_maxScroll(it.scroller,it._dir)))}),d.forEach(function(it){return it&&it.render&&it.render(-1)}),_scrollers.forEach(function(it){_isFunction(it)&&(it.smooth&&requestAnimationFrame(function(){return it.target.style.scrollBehavior="smooth"}),it.rec&&it(it.rec))}),_clearScrollMemory(_scrollRestoration,1),_resizeDelay.pause(),_refreshID++,_updateAll(2),_triggers.forEach(function(it){return _isFunction(it.vars.onRefresh)&&it.vars.onRefresh(it)}),_refreshingAll=ScrollTrigger.isRefreshing=!1,_dispatch("refresh")},_lastScroll=0,_direction=1,_primary,_updateAll=function j(_){if(!_refreshingAll||_===2){ScrollTrigger.isUpdating=!0,_primary&&_primary.update(0);var _e=_triggers.length,d=_getTime(),it=d-_time1>=50,ct=_e&&_triggers[0].scroll();if(_direction=_lastScroll>ct?-1:1,_lastScroll=ct,it&&(_lastScrollTime&&!_pointerIsDown&&d-_lastScrollTime>200&&(_lastScrollTime=0,_dispatch("scrollEnd")),_time2=_time1,_time1=d),_direction<0){for(_i=_e;_i-- >0;)_triggers[_i]&&_triggers[_i].update(0,it);_direction=1}else for(_i=0;_i<_e;_i++)_triggers[_i]&&_triggers[_i].update(0,it);ScrollTrigger.isUpdating=!1}_rafID=0},_propNamesToCopy=[_left,_top,_bottom,_right,_margin+_Bottom,_margin+_Right,_margin+_Top,_margin+_Left,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],_stateProps=_propNamesToCopy.concat([_width,_height,"boxSizing","max"+_Width,"max"+_Height,"position",_margin,_padding,_padding+_Top,_padding+_Right,_padding+_Bottom,_padding+_Left]),_swapPinOut=function j(_,_e,d){_setState(d);var it=_._gsap;if(it.spacerIsNative)_setState(it.spacerState);else if(_._gsap.swappedIn){var ct=_e.parentNode;ct&&(ct.insertBefore(_,_e),ct.removeChild(_e))}_._gsap.swappedIn=!1},_swapPinIn=function j(_,_e,d,it){if(!_._gsap.swappedIn){for(var ct=_propNamesToCopy.length,pt=_e.style,At=_.style,St;ct--;)St=_propNamesToCopy[ct],pt[St]=d[St];pt.position=d.position==="absolute"?"absolute":"relative",d.display==="inline"&&(pt.display="inline-block"),At[_bottom]=At[_right]="auto",pt.flexBasis=d.flexBasis||"auto",pt.overflow="visible",pt.boxSizing="border-box",pt[_width]=_getSize(_,_horizontal)+_px,pt[_height]=_getSize(_,_vertical)+_px,pt[_padding]=At[_margin]=At[_top]=At[_left]="0",_setState(it),At[_width]=At["max"+_Width]=d[_width],At[_height]=At["max"+_Height]=d[_height],At[_padding]=d[_padding],_.parentNode!==_e&&(_.parentNode.insertBefore(_e,_),_e.appendChild(_)),_._gsap.swappedIn=!0}},_capsExp=/([A-Z])/g,_setState=function j(_){if(_){var _e=_.t.style,d=_.length,it=0,ct,pt;for((_.t._gsap||gsap.core.getCache(_.t)).uncache=1;it<d;it+=2)pt=_[it+1],ct=_[it],pt?_e[ct]=pt:_e[ct]&&_e.removeProperty(ct.replace(_capsExp,"-$1").toLowerCase())}},_getState=function j(_){for(var _e=_stateProps.length,d=_.style,it=[],ct=0;ct<_e;ct++)it.push(_stateProps[ct],d[_stateProps[ct]]);return it.t=_,it},_copyState=function j(_,_e,d){for(var it=[],ct=_.length,pt=d?8:0,At;pt<ct;pt+=2)At=_[pt],it.push(At,At in _e?_e[At]:_[pt+1]);return it.t=_.t,it},_winOffsets={left:0,top:0},_parsePosition=function j(_,_e,d,it,ct,pt,At,St,Ot,Qt,Yt,Vt,qt){_isFunction(_)&&(_=_(St)),_isString(_)&&_.substr(0,3)==="max"&&(_=Vt+(_.charAt(4)==="="?_offsetToPx("0"+_.substr(3),d):0));var Jt=qt?qt.time():0,jt,sn,Ft;if(qt&&qt.seek(0),_isNumber(_))At&&_positionMarker(At,d,it,!0);else{_isFunction(_e)&&(_e=_e(St));var Ut=(_||"0").split(" "),Ht,an,nn,dn;Ft=_getTarget(_e)||_body,Ht=_getBounds(Ft)||{},(!Ht||!Ht.left&&!Ht.top)&&_getComputedStyle(Ft).display==="none"&&(dn=Ft.style.display,Ft.style.display="block",Ht=_getBounds(Ft),dn?Ft.style.display=dn:Ft.style.removeProperty("display")),an=_offsetToPx(Ut[0],Ht[it.d]),nn=_offsetToPx(Ut[1]||"0",d),_=Ht[it.p]-Ot[it.p]-Qt+an+ct-nn,At&&_positionMarker(At,nn,it,d-nn<20||At._isStart&&nn>20),d-=d-nn}if(pt){var zt=_+d,Wt=pt._isStart;jt="scroll"+it.d2,_positionMarker(pt,zt,it,Wt&&zt>20||!Wt&&(Yt?Math.max(_body[jt],_docEl[jt]):pt.parentNode[jt])<=zt+1),Yt&&(Ot=_getBounds(At),Yt&&(pt.style[it.op.p]=Ot[it.op.p]-it.op.m-pt._offset+_px))}return qt&&Ft&&(jt=_getBounds(Ft),qt.seek(Vt),sn=_getBounds(Ft),qt._caScrollDist=jt[it.p]-sn[it.p],_=_/qt._caScrollDist*Vt),qt&&qt.seek(Jt),qt?_:Math.round(_)},_prefixExp=/(webkit|moz|length|cssText|inset)/i,_reparent=function j(_,_e,d,it){if(_.parentNode!==_e){var ct=_.style,pt,At;if(_e===_body){_._stOrig=ct.cssText,At=_getComputedStyle(_);for(pt in At)!+pt&&!_prefixExp.test(pt)&&At[pt]&&typeof ct[pt]=="string"&&pt!=="0"&&(ct[pt]=At[pt]);ct.top=d,ct.left=it}else ct.cssText=_._stOrig;gsap.core.getCache(_).uncache=1,_e.appendChild(_)}},_getTweenCreator=function j(_,_e){var d=_getScrollFunc(_,_e),it="_scroll"+_e.p2,ct,pt,At=function St(Ot,Qt,Yt,Vt,qt){var Jt=St.tween,jt=Qt.onComplete,sn={};return Yt=Yt||d(),qt=Vt&&qt||0,Vt=Vt||Ot-Yt,Jt&&Jt.kill(),ct=Math.round(Yt),Qt[it]=Ot,Qt.modifiers=sn,sn[it]=function(Ft){return Ft=Math.round(d()),Ft!==ct&&Ft!==pt&&Math.abs(Ft-ct)>3&&Math.abs(Ft-pt)>3?(Jt.kill(),St.tween=0):Ft=Yt+Vt*Jt.ratio+qt*Jt.ratio*Jt.ratio,pt=ct,ct=Math.round(Ft)},Qt.onUpdate=function(){_scrollers.cache++,_updateAll()},Qt.onComplete=function(){St.tween=0,jt&&jt.call(Jt)},Jt=St.tween=gsap.to(_,Qt),Jt};return _[it]=d,d.wheelHandler=function(){return At.tween&&At.tween.kill()&&(At.tween=0)},_addListener(_,"wheel",d.wheelHandler),At},ScrollTrigger=function(){function j(_e,d){_coreInitted||j.register(gsap)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(_e,d)}var _=j.prototype;return _.init=function(d,it){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!_enabled){this.update=this.refresh=this.kill=_passThrough;return}d=_setDefaults(_isString(d)||_isNumber(d)||d.nodeType?{trigger:d}:d,_defaults);var ct=d,pt=ct.onUpdate,At=ct.toggleClass,St=ct.id,Ot=ct.onToggle,Qt=ct.onRefresh,Yt=ct.scrub,Vt=ct.trigger,qt=ct.pin,Jt=ct.pinSpacing,jt=ct.invalidateOnRefresh,sn=ct.anticipatePin,Ft=ct.onScrubComplete,Ut=ct.onSnapComplete,Ht=ct.once,an=ct.snap,nn=ct.pinReparent,dn=ct.pinSpacer,zt=ct.containerAnimation,Wt=ct.fastScrollEnd,Zt=ct.preventOverlaps,mn=d.horizontal||d.containerAnimation&&d.horizontal!==!1?_horizontal:_vertical,hn=!Yt&&Yt!==0,zn=_getTarget(d.scroller||_win),lr=gsap.core.getCache(zn),ar=_isViewport(zn),ur=("pinType"in d?d.pinType:_getProxyProp(zn,"pinType")||ar&&"fixed")==="fixed",Zn=[d.onEnter,d.onLeave,d.onEnterBack,d.onLeaveBack],wr=hn&&d.toggleActions.split(" "),Vn="markers"in d?d.markers:_defaults.markers,Kn=ar?0:parseFloat(_getComputedStyle(zn)["border"+mn.p2+_Width])||0,un=this,er=d.onRefreshInit&&function(){return d.onRefreshInit(un)},$n=_getSizeFunc(zn,ar,mn),xr=_getOffsetsFunc(zn,ar),Wn=0,on=0,pn=_getScrollFunc(zn,mn),On,Tr,kr,Br,ds,is,Us,Os,go,ks,or,to,co,Bl,Oo,Mo,To,Io,Hl,vo,no,Al,qo,Lo,Pp,Yo,du,Vo,Mu,Dp,hs,So,$l,Cl,rp,Hu,vp,Qn,ba;if(_context(un),un._dir=mn,sn*=45,un.scroller=zn,un.scroll=zt?zt.time.bind(zt):pn,Br=pn(),un.vars=d,it=it||d.animation,"refreshPriority"in d&&(_sort=1,d.refreshPriority===-9999&&(_primary=un)),lr.tweenScroll=lr.tweenScroll||{top:_getTweenCreator(zn,_vertical),left:_getTweenCreator(zn,_horizontal)},un.tweenTo=On=lr.tweenScroll[mn.p],un.scrubDuration=function(br){So=_isNumber(br)&&br,So?hs?hs.duration(br):hs=gsap.to(it,{ease:"expo",totalProgress:"+=0.001",duration:So,paused:!0,onComplete:function(){return Ft&&Ft(un)}}):(hs&&hs.progress(1).kill(),hs=0)},it&&(it.vars.lazy=!1,it._initted||it.vars.immediateRender!==!1&&d.immediateRender!==!1&&it.duration()&&it.render(0,!0,!0),un.animation=it.pause(),it.scrollTrigger=un,un.scrubDuration(Yt),Mu=0,St||(St=it.vars.id)),_triggers.push(un),an&&((!_isObject(an)||an.push)&&(an={snapTo:an}),"scrollBehavior"in _body.style&&gsap.set(ar?[_body,_docEl]:zn,{scrollBehavior:"auto"}),_scrollers.forEach(function(br){return _isFunction(br)&&br.target===(ar?_doc.scrollingElement||_docEl:zn)&&(br.smooth=!1)}),kr=_isFunction(an.snapTo)?an.snapTo:an.snapTo==="labels"?_getClosestLabel(it):an.snapTo==="labelsDirectional"?_getLabelAtDirection(it):an.directional!==!1?function(br,Is){return _snapDirectional(an.snapTo)(br,_getTime()-on<500?0:Is.direction)}:gsap.utils.snap(an.snapTo),$l=an.duration||{min:.1,max:2},$l=_isObject($l)?_clamp($l.min,$l.max):_clamp($l,$l),Cl=gsap.delayedCall(an.delay||So/2||.1,function(){var br=pn(),Is=_getTime()-on<500,Ps=On.tween;if((Is||Math.abs(un.getVelocity())<10)&&!Ps&&!_pointerIsDown&&Wn!==br){var bs=(br-is)/co,Qo=it&&!hn?it.totalProgress():bs,Js=Is?0:(Qo-Dp)/(_getTime()-_time2)*1e3||0,Do=gsap.utils.clamp(-bs,1-bs,_abs(Js/2)*Js/.185),Go=bs+(an.inertia===!1?0:Do),qu=_clamp(0,1,kr(Go,un)),ro=Math.round(is+qu*co),Wl=an,_p=Wl.onStart,Ho=Wl.onInterrupt,yo=Wl.onComplete;if(br<=Us&&br>=is&&ro!==br){if(Ps&&!Ps._initted&&Ps.data<=_abs(ro-br))return;an.inertia===!1&&(Do=qu-bs),On(ro,{duration:$l(_abs(Math.max(_abs(Go-Qo),_abs(qu-Qo))*.185/Js/.05||0)),ease:an.ease||"power3",data:_abs(ro-br),onInterrupt:function(){return Cl.restart(!0)&&Ho&&Ho(un)},onComplete:function(){un.update(),Wn=pn(),Mu=Dp=it&&!hn?it.totalProgress():un.progress,Ut&&Ut(un),yo&&yo(un)}},br,Do*co,ro-br-Do*co),_p&&_p(un,On.tween)}}else un.isActive&&Wn!==br&&Cl.restart(!0)}).pause()),St&&(_ids[St]=un),Vt=un.trigger=_getTarget(Vt||qt),ba=Vt&&Vt._gsap&&Vt._gsap.stRevert,ba&&(ba=ba(un)),qt=qt===!0?Vt:_getTarget(qt),_isString(At)&&(At={targets:Vt,className:At}),qt&&(Jt===!1||Jt===_margin||(Jt=!Jt&&qt.parentNode&&qt.parentNode.style&&_getComputedStyle(qt.parentNode).display==="flex"?!1:_padding),un.pin=qt,Tr=gsap.core.getCache(qt),Tr.spacer?Bl=Tr.pinState:(dn&&(dn=_getTarget(dn),dn&&!dn.nodeType&&(dn=dn.current||dn.nativeElement),Tr.spacerIsNative=!!dn,dn&&(Tr.spacerState=_getState(dn))),Tr.spacer=To=dn||_doc.createElement("div"),To.classList.add("pin-spacer"),St&&To.classList.add("pin-spacer-"+St),Tr.pinState=Bl=_getState(qt)),d.force3D!==!1&&gsap.set(qt,{force3D:!0}),un.spacer=To=Tr.spacer,Vo=_getComputedStyle(qt),qo=Vo[Jt+mn.os2],Hl=gsap.getProperty(qt),vo=gsap.quickSetter(qt,mn.a,_px),_swapPinIn(qt,To,Vo),Mo=_getState(qt)),Vn){to=_isObject(Vn)?_setDefaults(Vn,_markerDefaults):_markerDefaults,ks=_createMarker("scroller-start",St,zn,mn,to,0),or=_createMarker("scroller-end",St,zn,mn,to,0,ks),Io=ks["offset"+mn.op.d2];var Wu=_getTarget(_getProxyProp(zn,"content")||zn);Os=this.markerStart=_createMarker("start",St,Wu,mn,to,Io,0,zt),go=this.markerEnd=_createMarker("end",St,Wu,mn,to,Io,0,zt),zt&&(Qn=gsap.quickSetter([Os,go],mn.a,_px)),!ur&&!(_proxies.length&&_getProxyProp(zn,"fixedMarkers")===!0)&&(_makePositionable(ar?_body:zn),gsap.set([ks,or],{force3D:!0}),Pp=gsap.quickSetter(ks,mn.a,_px),du=gsap.quickSetter(or,mn.a,_px))}if(zt){var Gs=zt.vars.onUpdate,Xr=zt.vars.onUpdateParams;zt.eventCallback("onUpdate",function(){un.update(0,0,1),Gs&&Gs.apply(Xr||[])})}un.previous=function(){return _triggers[_triggers.indexOf(un)-1]},un.next=function(){return _triggers[_triggers.indexOf(un)+1]},un.revert=function(br,Is){if(!Is)return un.kill(!0);var Ps=br!==!1||!un.enabled,bs=_refreshing;Ps!==un.isReverted&&(Ps&&(Hu=Math.max(pn(),un.scroll.rec||0),rp=un.progress,vp=it&&it.progress()),Os&&[Os,go,ks,or].forEach(function(Qo){return Qo.style.display=Ps?"none":"block"}),Ps&&(_refreshing=1,un.update(Ps)),qt&&(!nn||!un.isActive)&&(Ps?_swapPinOut(qt,To,Bl):_swapPinIn(qt,To,_getComputedStyle(qt),Lo)),Ps||un.update(Ps),_refreshing=bs,un.isReverted=Ps)},un.refresh=function(br,Is){if(!((_refreshing||!un.enabled)&&!Is)){if(qt&&br&&_lastScrollTime){_addListener(j,"scrollEnd",_softRefresh);return}!_refreshingAll&&er&&er(un),_refreshing=1,on=_getTime(),On.tween&&(On.tween.kill(),On.tween=0),hs&&hs.pause(),jt&&it&&it.revert({kill:!1}).invalidate(),un.isReverted||un.revert(!0,!0),un._subPinOffset=!1;for(var Ps=$n(),bs=xr(),Qo=zt?zt.duration():_maxScroll(zn,mn),Js=0,Do=0,Go=d.end,qu=d.endTrigger||Vt,ro=d.start||(d.start===0||!Vt?0:qt?"0 0":"0 100%"),Wl=un.pinnedContainer=d.pinnedContainer&&_getTarget(d.pinnedContainer),_p=Vt&&Math.max(0,_triggers.indexOf(un))||0,Ho=_p,yo,Zo,_o,pu,Ao,na,xl,rs,Fm,ls,Jl;Ho--;)na=_triggers[Ho],na.end||na.refresh(0,1)||(_refreshing=1),xl=na.pin,xl&&(xl===Vt||xl===qt)&&!na.isReverted&&(ls||(ls=[]),ls.unshift(na),na.revert(!0,!0)),na!==_triggers[Ho]&&(_p--,Ho--);for(_isFunction(ro)&&(ro=ro(un)),is=_parsePosition(ro,Vt,Ps,mn,pn(),Os,ks,un,bs,Kn,ur,Qo,zt)||(qt?-.001:0),_isFunction(Go)&&(Go=Go(un)),_isString(Go)&&!Go.indexOf("+=")&&(~Go.indexOf(" ")?Go=(_isString(ro)?ro.split(" ")[0]:"")+Go:(Js=_offsetToPx(Go.substr(2),Ps),Go=_isString(ro)?ro:is+Js,qu=Vt)),Us=Math.max(is,_parsePosition(Go||(qu?"100% 0":Qo),qu,Ps,mn,pn()+Js,go,or,un,bs,Kn,ur,Qo,zt))||-.001,co=Us-is||(is-=.01)&&.001,Js=0,Ho=_p;Ho--;)na=_triggers[Ho],xl=na.pin,xl&&na.start-na._pinPush<=is&&!zt&&na.end>0&&(yo=na.end-na.start,(xl===Vt&&na.start-na._pinPush<is||xl===Wl)&&!_isNumber(ro)&&(Js+=yo*(1-na.progress)),xl===qt&&(Do+=yo));if(is+=Js,Us+=Js,un._pinPush=Do,Os&&Js&&(yo={},yo[mn.a]="+="+Js,Wl&&(yo[mn.p]="-="+pn()),gsap.set([Os,go],yo)),qt)yo=_getComputedStyle(qt),pu=mn===_vertical,_o=pn(),no=parseFloat(Hl(mn.a))+Do,!Qo&&Us>1&&(Jl=(ar?_doc.scrollingElement||_docEl:zn).style,Jl={style:Jl,value:Jl["overflow"+mn.a.toUpperCase()]},Jl["overflow"+mn.a.toUpperCase()]="scroll"),_swapPinIn(qt,To,yo),Mo=_getState(qt),Zo=_getBounds(qt,!0),rs=ur&&_getScrollFunc(zn,pu?_horizontal:_vertical)(),Jt&&(Lo=[Jt+mn.os2,co+Do+_px],Lo.t=To,Ho=Jt===_padding?_getSize(qt,mn)+co+Do:0,Ho&&Lo.push(mn.d,Ho+_px),_setState(Lo),Wl&&_triggers.forEach(function(yp){yp.pin===Wl&&yp.vars.pinSpacing!==!1&&(yp._subPinOffset=!0)}),ur&&pn(Hu)),ur&&(Ao={top:Zo.top+(pu?_o-is:rs)+_px,left:Zo.left+(pu?rs:_o-is)+_px,boxSizing:"border-box",position:"fixed"},Ao[_width]=Ao["max"+_Width]=Math.ceil(Zo.width)+_px,Ao[_height]=Ao["max"+_Height]=Math.ceil(Zo.height)+_px,Ao[_margin]=Ao[_margin+_Top]=Ao[_margin+_Right]=Ao[_margin+_Bottom]=Ao[_margin+_Left]="0",Ao[_padding]=yo[_padding],Ao[_padding+_Top]=yo[_padding+_Top],Ao[_padding+_Right]=yo[_padding+_Right],Ao[_padding+_Bottom]=yo[_padding+_Bottom],Ao[_padding+_Left]=yo[_padding+_Left],Oo=_copyState(Bl,Ao,nn),_refreshingAll&&pn(0)),it?(Fm=it._initted,_suppressOverwrites(1),it.render(it.duration(),!0,!0),Al=Hl(mn.a)-no+co+Do,Yo=Math.abs(co-Al)>1,ur&&Yo&&Oo.splice(Oo.length-2,2),it.render(0,!0,!0),Fm||it.invalidate(!0),it.parent||it.totalTime(it.totalTime()),_suppressOverwrites(0)):Al=co,Jl&&(Jl.value?Jl.style["overflow"+mn.a.toUpperCase()]=Jl.value:Jl.style.removeProperty("overflow-"+mn.a));else if(Vt&&pn()&&!zt)for(Zo=Vt.parentNode;Zo&&Zo!==_body;)Zo._pinOffset&&(is-=Zo._pinOffset,Us-=Zo._pinOffset),Zo=Zo.parentNode;ls&&ls.forEach(function(yp){return yp.revert(!1,!0)}),un.start=is,un.end=Us,Br=ds=_refreshingAll?Hu:pn(),!zt&&!_refreshingAll&&(Br<Hu&&pn(Hu),un.scroll.rec=0),un.revert(!1,!0),Cl&&(Wn=-1,un.isActive&&pn(is+co*rp),Cl.restart(!0)),_refreshing=0,it&&hn&&(it._initted||vp)&&it.progress()!==vp&&it.progress(vp,!0).render(it.time(),!0,!0),(rp!==un.progress||zt)&&(it&&!hn&&it.totalProgress(rp,!0),un.progress=(Br-is)/co===rp?0:rp),qt&&Jt&&(To._pinOffset=Math.round(un.progress*Al)),Qt&&!_refreshingAll&&Qt(un)}},un.getVelocity=function(){return(pn()-ds)/(_getTime()-_time2)*1e3||0},un.endAnimation=function(){_endAnimation(un.callbackAnimation),it&&(hs?hs.progress(1):it.paused()?hn||_endAnimation(it,un.direction<0,1):_endAnimation(it,it.reversed()))},un.labelToScroll=function(br){return it&&it.labels&&(is||un.refresh()||is)+it.labels[br]/it.duration()*co||0},un.getTrailing=function(br){var Is=_triggers.indexOf(un),Ps=un.direction>0?_triggers.slice(0,Is).reverse():_triggers.slice(Is+1);return(_isString(br)?Ps.filter(function(bs){return bs.vars.preventOverlaps===br}):Ps).filter(function(bs){return un.direction>0?bs.end<=is:bs.start>=Us})},un.update=function(br,Is,Ps){if(!(zt&&!Ps&&!br)){var bs=_refreshingAll?Hu:un.scroll(),Qo=br?0:(bs-is)/co,Js=Qo<0?0:Qo>1?1:Qo||0,Do=un.progress,Go,qu,ro,Wl,_p,Ho,yo,Zo;if(Is&&(ds=Br,Br=zt?pn():bs,an&&(Dp=Mu,Mu=it&&!hn?it.totalProgress():Js)),sn&&!Js&&qt&&!_refreshing&&!_startup&&_lastScrollTime&&is<bs+(bs-ds)/(_getTime()-_time2)*sn&&(Js=1e-4),Js!==Do&&un.enabled){if(Go=un.isActive=!!Js&&Js<1,qu=!!Do&&Do<1,Ho=Go!==qu,_p=Ho||!!Js!=!!Do,un.direction=Js>Do?1:-1,un.progress=Js,_p&&!_refreshing&&(ro=Js&&!Do?0:Js===1?1:Do===1?2:3,hn&&(Wl=!Ho&&wr[ro+1]!=="none"&&wr[ro+1]||wr[ro],Zo=it&&(Wl==="complete"||Wl==="reset"||Wl in it))),Zt&&(Ho||Zo)&&(Zo||Yt||!it)&&(_isFunction(Zt)?Zt(un):un.getTrailing(Zt).forEach(function(na){return na.endAnimation()})),hn||(hs&&!_refreshing&&!_startup?(hs._dp._time-hs._start!==hs._time&&hs.render(hs._dp._time-hs._start),hs.resetTo?hs.resetTo("totalProgress",Js,it._tTime/it._tDur):(hs.vars.totalProgress=Js,hs.invalidate().restart())):it&&it.totalProgress(Js,!!_refreshing)),qt){if(br&&Jt&&(To.style[Jt+mn.os2]=qo),!ur)vo(_round(no+Al*Js));else if(_p){if(yo=!br&&Js>Do&&Us+1>bs&&bs+1>=_maxScroll(zn,mn),nn)if(!br&&(Go||yo)){var _o=_getBounds(qt,!0),pu=bs-is;_reparent(qt,_body,_o.top+(mn===_vertical?pu:0)+_px,_o.left+(mn===_vertical?0:pu)+_px)}else _reparent(qt,To);_setState(Go||yo?Oo:Mo),Yo&&Js<1&&Go||vo(no+(Js===1&&!yo?Al:0))}}an&&!On.tween&&!_refreshing&&!_startup&&Cl.restart(!0),At&&(Ho||Ht&&Js&&(Js<1||!_limitCallbacks))&&_toArray(At.targets).forEach(function(na){return na.classList[Go||Ht?"add":"remove"](At.className)}),pt&&!hn&&!br&&pt(un),_p&&!_refreshing?(hn&&(Zo&&(Wl==="complete"?it.pause().totalProgress(1):Wl==="reset"?it.restart(!0).pause():Wl==="restart"?it.restart(!0):it[Wl]()),pt&&pt(un)),(Ho||!_limitCallbacks)&&(Ot&&Ho&&_callback(un,Ot),Zn[ro]&&_callback(un,Zn[ro]),Ht&&(Js===1?un.kill(!1,1):Zn[ro]=0),Ho||(ro=Js===1?1:3,Zn[ro]&&_callback(un,Zn[ro]))),Wt&&!Go&&Math.abs(un.getVelocity())>(_isNumber(Wt)?Wt:2500)&&(_endAnimation(un.callbackAnimation),hs?hs.progress(1):_endAnimation(it,Wl==="reverse"?1:!Js,1))):hn&&pt&&!_refreshing&&pt(un)}if(du){var Ao=zt?bs/zt.duration()*(zt._caScrollDist||0):bs;Pp(Ao+(ks._isFlipped?1:0)),du(Ao)}Qn&&Qn(-bs/zt.duration()*(zt._caScrollDist||0))}},un.enable=function(br,Is){un.enabled||(un.enabled=!0,_addListener(zn,"resize",_onResize),_addListener(ar?_doc:zn,"scroll",_onScroll),er&&_addListener(j,"refreshInit",er),br!==!1&&(un.progress=rp=0,Br=ds=Wn=pn()),Is!==!1&&un.refresh())},un.getTween=function(br){return br&&On?On.tween:hs},un.setPositions=function(br,Is){qt&&(no+=br-is,Al+=Is-br-co,Jt===_padding&&un.adjustPinSpacing(Is-br-co)),un.start=is=br,un.end=Us=Is,co=Is-br,un.update()},un.adjustPinSpacing=function(br){if(Lo){var Is=Lo.indexOf(mn.d)+1;Lo[Is]=parseFloat(Lo[Is])+br+_px,Lo[1]=parseFloat(Lo[1])+br+_px,_setState(Lo)}},un.disable=function(br,Is){if(un.enabled&&(br!==!1&&un.revert(!0,!0),un.enabled=un.isActive=!1,Is||hs&&hs.pause(),Hu=0,Tr&&(Tr.uncache=1),er&&_removeListener(j,"refreshInit",er),Cl&&(Cl.pause(),On.tween&&On.tween.kill()&&(On.tween=0)),!ar)){for(var Ps=_triggers.length;Ps--;)if(_triggers[Ps].scroller===zn&&_triggers[Ps]!==un)return;_removeListener(zn,"resize",_onResize),_removeListener(zn,"scroll",_onScroll)}},un.kill=function(br,Is){un.disable(br,Is),hs&&!Is&&hs.kill(),St&&delete _ids[St];var Ps=_triggers.indexOf(un);Ps>=0&&_triggers.splice(Ps,1),Ps===_i&&_direction>0&&_i--,Ps=0,_triggers.forEach(function(bs){return bs.scroller===un.scroller&&(Ps=1)}),Ps||_refreshingAll||(un.scroll.rec=0),it&&(it.scrollTrigger=null,br&&it.revert({kill:!1}),Is||it.kill()),Os&&[Os,go,ks,or].forEach(function(bs){return bs.parentNode&&bs.parentNode.removeChild(bs)}),_primary===un&&(_primary=0),qt&&(Tr&&(Tr.uncache=1),Ps=0,_triggers.forEach(function(bs){return bs.pin===qt&&Ps++}),Ps||(Tr.spacer=0)),d.onKill&&d.onKill(un)},un.enable(!1,!1),ba&&ba(un),!it||!it.add||co?un.refresh():gsap.delayedCall(.01,function(){return is||Us||un.refresh()})&&(co=.01)&&(is=Us=0),qt&&_queueRefreshAll()},j.register=function(d){return _coreInitted||(gsap=d||_getGSAP(),_windowExists()&&window.document&&j.enable(),_coreInitted=_enabled),_coreInitted},j.defaults=function(d){if(d)for(var it in d)_defaults[it]=d[it];return _defaults},j.disable=function(d,it){_enabled=0,_triggers.forEach(function(pt){return pt[it?"kill":"disable"](d)}),_removeListener(_win,"wheel",_onScroll),_removeListener(_doc,"scroll",_onScroll),clearInterval(_syncInterval),_removeListener(_doc,"touchcancel",_passThrough),_removeListener(_body,"touchstart",_passThrough),_multiListener(_removeListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_removeListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_resizeDelay.kill(),_iterateAutoRefresh(_removeListener);for(var ct=0;ct<_scrollers.length;ct+=3)_wheelListener(_removeListener,_scrollers[ct],_scrollers[ct+1]),_wheelListener(_removeListener,_scrollers[ct],_scrollers[ct+2])},j.enable=function(){if(_win=window,_doc=document,_docEl=_doc.documentElement,_body=_doc.body,gsap&&(_toArray=gsap.utils.toArray,_clamp=gsap.utils.clamp,_context=gsap.core.context||_passThrough,_suppressOverwrites=gsap.core.suppressOverwrites||_passThrough,_scrollRestoration=_win.history.scrollRestoration||"auto",gsap.core.globals("ScrollTrigger",j),_body)){_enabled=1,Observer.register(gsap),j.isTouch=Observer.isTouch,_fixIOSBug=Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_addListener(_win,"wheel",_onScroll),_root=[_win,_doc,_docEl,_body],gsap.matchMedia?(j.matchMedia=function(St){var Ot=gsap.matchMedia(),Qt;for(Qt in St)Ot.add(Qt,St[Qt]);return Ot},gsap.addEventListener("matchMediaInit",function(){return _revertAll()}),gsap.addEventListener("matchMediaRevert",function(){return _revertRecorded()}),gsap.addEventListener("matchMedia",function(){_refreshAll(0,1),_dispatch("matchMedia")}),gsap.matchMedia("(orientation: portrait)",function(){return _setBaseDimensions(),_setBaseDimensions})):console.warn("Requires GSAP 3.11.0 or later"),_setBaseDimensions(),_addListener(_doc,"scroll",_onScroll);var d=_body.style,it=d.borderTopStyle,ct=gsap.core.Animation.prototype,pt,At;for(ct.revert||Object.defineProperty(ct,"revert",{value:function(){return this.time(-.01,!0)}}),d.borderTopStyle="solid",pt=_getBounds(_body),_vertical.m=Math.round(pt.top+_vertical.sc())||0,_horizontal.m=Math.round(pt.left+_horizontal.sc())||0,it?d.borderTopStyle=it:d.removeProperty("border-top-style"),_syncInterval=setInterval(_sync,250),gsap.delayedCall(.5,function(){return _startup=0}),_addListener(_doc,"touchcancel",_passThrough),_addListener(_body,"touchstart",_passThrough),_multiListener(_addListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_addListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_transformProp=gsap.utils.checkPrefix("transform"),_stateProps.push(_transformProp),_coreInitted=_getTime(),_resizeDelay=gsap.delayedCall(.2,_refreshAll).pause(),_autoRefresh=[_doc,"visibilitychange",function(){var St=_win.innerWidth,Ot=_win.innerHeight;_doc.hidden?(_prevWidth=St,_prevHeight=Ot):(_prevWidth!==St||_prevHeight!==Ot)&&_onResize()},_doc,"DOMContentLoaded",_refreshAll,_win,"load",_refreshAll,_win,"resize",_onResize],_iterateAutoRefresh(_addListener),_triggers.forEach(function(St){return St.enable(0,1)}),At=0;At<_scrollers.length;At+=3)_wheelListener(_removeListener,_scrollers[At],_scrollers[At+1]),_wheelListener(_removeListener,_scrollers[At],_scrollers[At+2])}},j.config=function(d){"limitCallbacks"in d&&(_limitCallbacks=!!d.limitCallbacks);var it=d.syncInterval;it&&clearInterval(_syncInterval)||(_syncInterval=it)&&setInterval(_sync,it),"ignoreMobileResize"in d&&(_ignoreMobileResize=j.isTouch===1&&d.ignoreMobileResize),"autoRefreshEvents"in d&&(_iterateAutoRefresh(_removeListener)||_iterateAutoRefresh(_addListener,d.autoRefreshEvents||"none"),_ignoreResize=(d.autoRefreshEvents+"").indexOf("resize")===-1)},j.scrollerProxy=function(d,it){var ct=_getTarget(d),pt=_scrollers.indexOf(ct),At=_isViewport(ct);~pt&&_scrollers.splice(pt,At?6:2),it&&(At?_proxies.unshift(_win,it,_body,it,_docEl,it):_proxies.unshift(ct,it))},j.clearMatchMedia=function(d){_triggers.forEach(function(it){return it._ctx&&it._ctx.query===d&&it._ctx.kill(!0,!0)})},j.isInViewport=function(d,it,ct){var pt=(_isString(d)?_getTarget(d):d).getBoundingClientRect(),At=pt[ct?_width:_height]*it||0;return ct?pt.right-At>0&&pt.left+At<_win.innerWidth:pt.bottom-At>0&&pt.top+At<_win.innerHeight},j.positionInViewport=function(d,it,ct){_isString(d)&&(d=_getTarget(d));var pt=d.getBoundingClientRect(),At=pt[ct?_width:_height],St=it==null?At/2:it in _keywords?_keywords[it]*At:~it.indexOf("%")?parseFloat(it)*At/100:parseFloat(it)||0;return ct?(pt.left+St)/_win.innerWidth:(pt.top+St)/_win.innerHeight},j.killAll=function(d){if(_triggers.slice(0).forEach(function(ct){return ct.vars.id!=="ScrollSmoother"&&ct.kill()}),d!==!0){var it=_listeners.killAll||[];_listeners={},it.forEach(function(ct){return ct()})}},j}();ScrollTrigger.version="3.11.4";ScrollTrigger.saveStyles=function(j){return j?_toArray(j).forEach(function(_){if(_&&_.style){var _e=_savedStyles.indexOf(_);_e>=0&&_savedStyles.splice(_e,5),_savedStyles.push(_,_.style.cssText,_.getBBox&&_.getAttribute("transform"),gsap.core.getCache(_),_context())}}):_savedStyles};ScrollTrigger.revert=function(j,_){return _revertAll(!j,_)};ScrollTrigger.create=function(j,_){return new ScrollTrigger(j,_)};ScrollTrigger.refresh=function(j){return j?_onResize():(_coreInitted||ScrollTrigger.register())&&_refreshAll(!0)};ScrollTrigger.update=function(j){return++_scrollers.cache&&_updateAll(j===!0?2:0)};ScrollTrigger.clearScrollMemory=_clearScrollMemory;ScrollTrigger.maxScroll=function(j,_){return _maxScroll(j,_?_horizontal:_vertical)};ScrollTrigger.getScrollFunc=function(j,_){return _getScrollFunc(_getTarget(j),_?_horizontal:_vertical)};ScrollTrigger.getById=function(j){return _ids[j]};ScrollTrigger.getAll=function(){return _triggers.filter(function(j){return j.vars.id!=="ScrollSmoother"})};ScrollTrigger.isScrolling=function(){return!!_lastScrollTime};ScrollTrigger.snapDirectional=_snapDirectional;ScrollTrigger.addEventListener=function(j,_){var _e=_listeners[j]||(_listeners[j]=[]);~_e.indexOf(_)||_e.push(_)};ScrollTrigger.removeEventListener=function(j,_){var _e=_listeners[j],d=_e&&_e.indexOf(_);d>=0&&_e.splice(d,1)};ScrollTrigger.batch=function(j,_){var _e=[],d={},it=_.interval||.016,ct=_.batchMax||1e9,pt=function(Ot,Qt){var Yt=[],Vt=[],qt=gsap.delayedCall(it,function(){Qt(Yt,Vt),Yt=[],Vt=[]}).pause();return function(Jt){Yt.length||qt.restart(!0),Yt.push(Jt.trigger),Vt.push(Jt),ct<=Yt.length&&qt.progress(1)}},At;for(At in _)d[At]=At.substr(0,2)==="on"&&_isFunction(_[At])&&At!=="onRefreshInit"?pt(At,_[At]):_[At];return _isFunction(ct)&&(ct=ct(),_addListener(ScrollTrigger,"refresh",function(){return ct=_.batchMax()})),_toArray(j).forEach(function(St){var Ot={};for(At in d)Ot[At]=d[At];Ot.trigger=St,_e.push(ScrollTrigger.create(Ot))}),_e};var _clampScrollAndGetDurationMultiplier=function j(_,_e,d,it){return _e>it?_(it):_e<0&&_(0),d>it?(it-_e)/(d-_e):d<0?_e/(_e-d):1},_allowNativePanning=function j(_,_e){_e===!0?_.style.removeProperty("touch-action"):_.style.touchAction=_e===!0?"auto":_e?"pan-"+_e+(Observer.isTouch?" pinch-zoom":""):"none",_===_docEl&&j(_body,_e)},_overflow={auto:1,scroll:1},_nestedScroll=function j(_){var _e=_.event,d=_.target,it=_.axis,ct=(_e.changedTouches?_e.changedTouches[0]:_e).target,pt=ct._gsap||gsap.core.getCache(ct),At=_getTime(),St;if(!pt._isScrollT||At-pt._isScrollT>2e3){for(;ct&&ct!==_body&&(ct.scrollHeight<=ct.clientHeight&&ct.scrollWidth<=ct.clientWidth||!(_overflow[(St=_getComputedStyle(ct)).overflowY]||_overflow[St.overflowX]));)ct=ct.parentNode;pt._isScroll=ct&&ct!==d&&!_isViewport(ct)&&(_overflow[(St=_getComputedStyle(ct)).overflowY]||_overflow[St.overflowX]),pt._isScrollT=At}(pt._isScroll||it==="x")&&(_e.stopPropagation(),_e._gsapAllow=!0)},_inputObserver=function j(_,_e,d,it){return Observer.create({target:_,capture:!0,debounce:!1,lockAxis:!0,type:_e,onWheel:it=it&&_nestedScroll,onPress:it,onDrag:it,onScroll:it,onEnable:function(){return d&&_addListener(_doc,Observer.eventTypes[0],_captureInputs,!1,!0)},onDisable:function(){return _removeListener(_doc,Observer.eventTypes[0],_captureInputs,!0)}})},_inputExp=/(input|label|select|textarea)/i,_inputIsFocused,_captureInputs=function j(_){var _e=_inputExp.test(_.target.tagName);(_e||_inputIsFocused)&&(_._gsapAllow=!0,_inputIsFocused=_e)},_getScrollNormalizer=function j(_){_isObject(_)||(_={}),_.preventDefault=_.isNormalizer=_.allowClicks=!0,_.type||(_.type="wheel,touch"),_.debounce=!!_.debounce,_.id=_.id||"normalizer";var _e=_,d=_e.normalizeScrollX,it=_e.momentum,ct=_e.allowNestedScroll,pt,At,St=_getTarget(_.target)||_docEl,Ot=gsap.core.globals().ScrollSmoother,Qt=Ot&&Ot.get(),Yt=_fixIOSBug&&(_.content&&_getTarget(_.content)||Qt&&_.content!==!1&&!Qt.smooth()&&Qt.content()),Vt=_getScrollFunc(St,_vertical),qt=_getScrollFunc(St,_horizontal),Jt=1,jt=(Observer.isTouch&&_win.visualViewport?_win.visualViewport.scale*_win.visualViewport.width:_win.outerWidth)/_win.innerWidth,sn=0,Ft=_isFunction(it)?function(){return it(pt)}:function(){return it||2.8},Ut,Ht,an=_inputObserver(St,_.type,!0,ct),nn=function(){return Ht=!1},dn=_passThrough,zt=_passThrough,Wt=function(){At=_maxScroll(St,_vertical),zt=_clamp(_fixIOSBug?1:0,At),d&&(dn=_clamp(0,_maxScroll(St,_horizontal))),Ut=_refreshID},Zt=function(){Yt._gsap.y=_round(parseFloat(Yt._gsap.y)+Vt.offset)+"px",Yt.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(Yt._gsap.y)+", 0, 1)",Vt.offset=Vt.cacheID=0},mn=function(){if(Ht){requestAnimationFrame(nn);var wr=_round(pt.deltaY/2),Vn=zt(Vt.v-wr);if(Yt&&Vn!==Vt.v+Vt.offset){Vt.offset=Vn-Vt.v;var Kn=_round((parseFloat(Yt&&Yt._gsap.y)||0)-Vt.offset);Yt.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+Kn+", 0, 1)",Yt._gsap.y=Kn+"px",Vt.cacheID=_scrollers.cache,_updateAll()}return!0}Vt.offset&&Zt(),Ht=!0},hn,zn,lr,ar,ur=function(){Wt(),hn.isActive()&&hn.vars.scrollY>At&&(Vt()>At?hn.progress(1)&&Vt(At):hn.resetTo("scrollY",At))};return Yt&&gsap.set(Yt,{y:"+=0"}),_.ignoreCheck=function(Zn){return _fixIOSBug&&Zn.type==="touchmove"&&mn()||Jt>1.05&&Zn.type!=="touchstart"||pt.isGesturing||Zn.touches&&Zn.touches.length>1},_.onPress=function(){var Zn=Jt;Jt=_round((_win.visualViewport&&_win.visualViewport.scale||1)/jt),hn.pause(),Zn!==Jt&&_allowNativePanning(St,Jt>1.01?!0:d?!1:"x"),zn=qt(),lr=Vt(),Wt(),Ut=_refreshID},_.onRelease=_.onGestureStart=function(Zn,wr){if(Vt.offset&&Zt(),!wr)ar.restart(!0);else{_scrollers.cache++;var Vn=Ft(),Kn,un;d&&(Kn=qt(),un=Kn+Vn*.05*-Zn.velocityX/.227,Vn*=_clampScrollAndGetDurationMultiplier(qt,Kn,un,_maxScroll(St,_horizontal)),hn.vars.scrollX=dn(un)),Kn=Vt(),un=Kn+Vn*.05*-Zn.velocityY/.227,Vn*=_clampScrollAndGetDurationMultiplier(Vt,Kn,un,_maxScroll(St,_vertical)),hn.vars.scrollY=zt(un),hn.invalidate().duration(Vn).play(.01),(_fixIOSBug&&hn.vars.scrollY>=At||Kn>=At-1)&&gsap.to({},{onUpdate:ur,duration:Vn})}},_.onWheel=function(){hn._ts&&hn.pause(),_getTime()-sn>1e3&&(Ut=0,sn=_getTime())},_.onChange=function(Zn,wr,Vn,Kn,un){if(_refreshID!==Ut&&Wt(),wr&&d&&qt(dn(Kn[2]===wr?zn+(Zn.startX-Zn.x):qt()+wr-Kn[1])),Vn){Vt.offset&&Zt();var er=un[2]===Vn,$n=er?lr+Zn.startY-Zn.y:Vt()+Vn-un[1],xr=zt($n);er&&$n!==xr&&(lr+=xr-$n),Vt(xr)}(Vn||wr)&&_updateAll()},_.onEnable=function(){_allowNativePanning(St,d?!1:"x"),ScrollTrigger.addEventListener("refresh",ur),_addListener(_win,"resize",ur),Vt.smooth&&(Vt.target.style.scrollBehavior="auto",Vt.smooth=qt.smooth=!1),an.enable()},_.onDisable=function(){_allowNativePanning(St,!0),_removeListener(_win,"resize",ur),ScrollTrigger.removeEventListener("refresh",ur),an.kill()},_.lockAxis=_.lockAxis!==!1,pt=new Observer(_),pt.iOS=_fixIOSBug,_fixIOSBug&&!Vt()&&Vt(1),_fixIOSBug&&gsap.ticker.add(_passThrough),ar=pt._dc,hn=gsap.to(pt,{ease:"power4",paused:!0,scrollX:d?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:ar.vars.onComplete}),pt};ScrollTrigger.sort=function(j){return _triggers.sort(j||function(_,_e){return(_.vars.refreshPriority||0)*-1e6+_.start-(_e.start+(_e.vars.refreshPriority||0)*-1e6)})};ScrollTrigger.observe=function(j){return new Observer(j)};ScrollTrigger.normalizeScroll=function(j){if(typeof j>"u")return _normalizer;if(j===!0&&_normalizer)return _normalizer.enable();if(j===!1)return _normalizer&&_normalizer.kill();var _=j instanceof Observer?j:_getScrollNormalizer(j);return _normalizer&&_normalizer.target===_.target&&_normalizer.kill(),_isViewport(_.target)&&(_normalizer=_),_};ScrollTrigger.core={_getVelocityProp,_inputObserver,_scrollers,_proxies,bridge:{ss:function j(){_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime()},ref:function j(){return _refreshing}}};_getGSAP()&&gsap.registerPlugin(ScrollTrigger);const scrollAnimation=(j,_,_e,d)=>{gsapWithCSS.timeline().to(j,{x:_e?-7:-3.38,y:_e?-12.2:-10.74,z:_e?-6:-5.93,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:d}).to(_,{x:_e?.7:1.52,y:_e?1.9:.77,z:_e?.7:-1.08,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".jumbotron-section",{opacity:0,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".sound-section-content",{opacity:1,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(j,{x:_e?9.36:1.56,y:_e?10.95:5,z:_e?.09:.01,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:d}).to(_,{x:_e?-1.62:-.55,y:_e?.02:.32,z:_e?-.06:0,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".display-section",{opacity:1,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}})};gsapWithCSS.registerPlugin(ScrollTrigger);const WebgiViewer=reactExports.forwardRef((j,_)=>{const _e=reactExports.useRef(null),[d,it]=reactExports.useState(null),[ct,pt]=reactExports.useState(null),[At,St]=reactExports.useState(null),[Ot,Qt]=reactExports.useState(null),Yt=reactExports.useRef(null),[Vt,qt]=reactExports.useState(!1),[Jt,jt]=reactExports.useState(null);reactExports.useImperativeHandle(_,()=>({triggerPreview(){qt(!0),Yt.current.style.pointerEvents="all",j.contentRef.current.style.opacity="0",gsapWithCSS.to(Ot,{x:13.04,y:-2.01,z:2.29,duration:2,onUpdate:()=>{d.setDirty(),At.positionTargetUpdated(!0)}}),gsapWithCSS.to(ct,{x:.11,y:0,z:0,duration:2}),d.scene.activeCamera.setCameraOptions({controlsEnabled:!0})}}));const sn=reactExports.useCallback((Ht,an,nn,dn)=>{Ht&&an&&dn&&scrollAnimation(Ht,an,nn,dn)},[]),Ft=reactExports.useCallback(async()=>{const Ht=new __webpackgi_exports__ViewerApp({canvas:_e.current});it(Ht);const an=__webpackgi_exports__mobileAndTabletCheck();jt(an);const nn=await Ht.addPlugin(__webpackgi_exports__AssetManagerPlugin),dn=Ht.scene.activeCamera,zt=dn.position,Wt=dn.target;St(dn),Qt(zt),pt(Wt),await Ht.addPlugin(__webpackgi_exports__GBufferPlugin),await Ht.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await Ht.addPlugin(new __webpackgi_exports__TonemapPlugin(!0)),await Ht.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await Ht.addPlugin(__webpackgi_exports__SSRPlugin),await Ht.addPlugin(__webpackgi_exports__SSAOPlugin),await Ht.addPlugin(__webpackgi_exports__BloomPlugin),Ht.renderer.refreshPipeline(),await nn.addFromPath("scene-black.glb"),Ht.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0,Ht.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),Jt&&(zt.set(-16.7,1.17,11.7),Wt.set(0,1.37,0),j.contentRef.current.className="mobile-or-tablet"),window.scrollTo(0,0);let Zt=!0;const mn=()=>{Zt=!0,Ht.setDirty()};Ht.addEventListener("preFrame",()=>{Zt&&(dn.positionTargetUpdated(!0),Zt=!1)}),sn(zt,Wt,an,mn)},[]);reactExports.useEffect(()=>{Ft()},[]);const Ut=reactExports.useCallback(()=>{Yt.current.style.pointerEvents="none",j.contentRef.current.style.opacity="1",d.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),qt(!1),gsapWithCSS.to(Ot,{x:Jt?9.36:1.56,y:Jt?10.95:5,z:Jt?.09:.01,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:()=>{d.setDirty(),At.positionTargetUpdated(!0)}}),gsapWithCSS.to(ct,{x:Jt?-1.62:-.55,y:Jt?.02:.32,z:Jt?-.06:0,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}})},[Yt,d,Ot,At,ct]);return jsxs("div",{ref:Yt,id:"webgi-canvas-container",children:[jsx("canvas",{id:"webgi-canvas",ref:_e}),Vt&&jsx("button",{className:"button",onClick:Ut,children:"Exit"})]})}),AnimatedLogo="/assets/logo-animated-fcde50a7.gif";function Loader(j){return jsx("div",{className:"loader",children:jsx("img",{src:AnimatedLogo,className:"logo",alt:"apple loader"})})}function App(){const j=reactExports.useRef(),_=reactExports.useRef();return jsxs("div",{children:[jsx(Loader,{}),jsxs("div",{ref:_,id:"content",children:[jsx(Nav,{}),jsx(Jumbotron,{}),jsx(SoundSection,{}),jsx(DisplaySection,{triggerPreview:()=>{j.current.triggerPreview()}})]}),jsx(WebgiViewer,{contentRef:_,ref:j})]})}const index="";client.createRoot(document.getElementById("root")).render(jsx(App,{}));
